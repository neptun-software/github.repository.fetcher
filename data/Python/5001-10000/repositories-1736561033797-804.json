{
  "metadata": {
    "timestamp": 1736561033797,
    "page": 804,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjgxMA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "tychxn/jd-assistant",
      "stars": 5183,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.041015625,
          "content": "__pycache__/\n.idea/\ncookies/\n\n*.log\n*.png\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.0380859375,
          "content": "MIT License\n\nCopyright (c) 2018 Tychxn\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 3.9814453125,
          "content": "# JD-Assistant\n\n[![version](https://img.shields.io/badge/python-3.4+-blue.svg)](https://www.python.org/download/releases/3.4.0/) \n[![status](https://img.shields.io/badge/status-stable-green.svg)](https://github.com/tychxn/jd-assistant)\n[![license](https://img.shields.io/badge/license-MIT-blue.svg)](./LICENSE)\n[![star, issue](https://img.shields.io/badge/star%2C%20issue-welcome-brightgreen.svg)](https://github.com/tychxn/jd-assistant)\n\näº¬ä¸œæŠ¢è´­åŠ©æ‰‹ï¼ˆçŸ­æœŸå†…ä¸å†æ›´æ–°ï¼‰\n\n## ä¸»è¦åŠŸèƒ½\n\n- ç™»é™†äº¬ä¸œå•†åŸï¼ˆ[www.jd.com](http://www.jd.com/)ï¼‰\n  - æ‰‹æœºæ‰«ç ç™»å½•\n  - ä¿å­˜/åŠ è½½ç™»å½•cookies (å¯éªŒè¯cookiesæ˜¯å¦è¿‡æœŸ)\n- å•†å“æŸ¥è¯¢æ“ä½œ\n  - æä¾›å®Œæ•´çš„[`åœ°å€â‡”ID`](./area_id/)å¯¹åº”å…³ç³»\n  - æ ¹æ®å•†å“IDå’Œåœ°å€IDæŸ¥è¯¢åº“å­˜\n  - æ ¹æ®å•†å“IDæŸ¥è¯¢ä»·æ ¼\n- è´­ç‰©è½¦æ“ä½œ\n  - æ¸…ç©º/æ·»åŠ è´­ç‰©è½¦ (æ— è´§å•†å“ä¹Ÿå¯ä»¥åŠ å…¥è´­ç‰©è½¦ï¼Œé¢„çº¦å•†å“æ— æ³•åŠ å…¥)\n  - è·å–è´­ç‰©è½¦å•†å“è¯¦æƒ…\n- è®¢å•æ“ä½œ\n  - è·å–è®¢å•ç»“ç®—é¡µé¢ä¿¡æ¯ (å•†å“è¯¦æƒ…, åº”ä»˜æ€»é¢, æ”¶è´§åœ°å€, æ”¶è´§äººç­‰)\n  - æäº¤è®¢å•ï¼ˆä½¿ç”¨é»˜è®¤åœ°å€ï¼‰\n    - ç›´æ¥æäº¤\n    - æœ‰è´§æäº¤\n    - å®šæ—¶æäº¤\n  - æŸ¥è¯¢è®¢å• (å¯é€‰æ‹©åªæ˜¾ç¤ºæœªä»˜æ¬¾è®¢å•)\n- å…¶ä»–\n  - å•†å“é¢„çº¦\n  - ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢\n\n## è¿è¡Œç¯å¢ƒ\n\n- [Python 3](https://www.python.org/)\n\n## ç¬¬ä¸‰æ–¹åº“\n\n- [Requests](http://docs.python-requests.org/en/master/)\n- [Beautiful Soup](https://www.crummy.com/software/BeautifulSoup/bs4/doc/)\n- [PyCryptodome](https://github.com/Legrandin/pycryptodome)\n\nå®‰è£…ï¼š\n```sh\npip install -r requirements.txt\n```\n\n## ä½¿ç”¨æ•™ç¨‹\n\nç¨‹åºä¸»å…¥å£åœ¨ `main.py`\n\nğŸ‘‰ [ä½¿ç”¨æ•™ç¨‹è¯·å‚çœ‹Wiki](https://github.com/tychxn/jd-assistant/wiki/1.-%E4%BA%AC%E4%B8%9C%E6%8A%A2%E8%B4%AD%E5%8A%A9%E6%89%8B%E7%94%A8%E6%B3%95)\n\n\n## æ›´æ–°è®°å½•\n\n- ã€2020.03.10ã€‘ä¿®å¤äº†ä¸€äº›å°é—®é¢˜ã€‚\n- ã€2020.02.08ã€‘ä¿®å¤äº†æŸ¥è¯¢åº“å­˜æ¥å£å“åº”æ•°æ®ç»“æ„å˜åŒ–å¯¼è‡´çš„é—®é¢˜ã€‚\n- ã€2020.02.06ã€‘æ·»åŠ ä¸‹å•æˆåŠŸæ¶ˆæ¯æ¨é€åŠŸèƒ½ï¼›æ–°å¢é…ç½®å‚æ•°ä»¥å‡å°‘å„ç§å¼‚å¸¸æƒ…å†µã€‚\n- ã€2020.02.03ã€‘æŸ¥è¯¢å•†å“åº“å­˜æ–¹æ³•æ·»åŠ è¶…æ—¶ï¼Œé¿å…å°‘æ•°æƒ…å†µä¸‹çš„å¡æ­»é—®é¢˜ï¼›å¯¹éƒ¨åˆ†ä»£ç è¿›è¡Œäº†ä¼˜åŒ–ã€‚\n- ã€2020.02.02ã€‘é‡å†™äº†ç›‘æ§åº“å­˜æäº¤è®¢å•åŠŸèƒ½ï¼šç›‘æ§å¤šå•†å“æ—¶å¯ä»¥ä¸‹å•ä»»ä¸€æœ‰åº“å­˜å•†å“ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒwikiã€‚\n- ã€2020.01.29ã€‘ä¿®å¤äº†è‡ªå®šä¹‰å•†å“æ•°é‡æ—¶çš„bugã€‚\n- ã€2020.01.28ã€‘å®Œå–„äº†ç›‘æ§åº“å­˜æäº¤è®¢å•åŠŸèƒ½çš„ä»£ç ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒwikiã€‚\n- ã€2020.01.24ã€‘ä¿®å¤äº†æŸ¥è¯¢å•ä¸ªå•†å“åº“å­˜æ¥å£éœ€è¦æ·»åŠ é¢å¤–å‚æ•°çš„é—®é¢˜ã€‚\n- ã€2020.01.15ã€‘æå‡äº†éƒ¨åˆ†ä»£ç è´¨é‡ã€‚\n- ã€2019.12.14ã€‘è§£å†³æŸ¥è¯¢å•ä¸ªå•†å“åº“å­˜æ¥å£å˜åŠ¨çš„é—®é¢˜ã€‚\n- ã€2019.11.10ã€‘ä¸´æ—¶å¢åŠ é¢„çº¦å•†å“æŠ¢è´­åŠŸèƒ½ã€‚\n- ã€2019.02.16ã€‘æ›´æ–°äº†æ™®é€šå•†å“çš„æŠ¢è´­ä»£ç ï¼Œåœ¨Wikiä¸­å†™äº†ä¸€ä»½ä½¿ç”¨æ•™ç¨‹ã€‚\n- ã€2018.11.29ã€‘äº¬ä¸œæ›´æ–°äº†æŠ¢è´­å•†å“çš„ä¸‹å•æ¥å£ï¼Œä»£ç å·²æ›´æ–°ï¼Œæ”¯æŒå®šæ—¶æŠ¢è´­ã€‚\n- ã€2018.09.26ã€‘äº¬ä¸œå·²ä¸‹çº¿`å­—ç¬¦éªŒè¯ç `æ¥å£ï¼Œ`è´¦å·å¯†ç ç™»å½•`åŠŸèƒ½å¤±æ•ˆï¼Œè¯·ä½¿ç”¨æ‰«ç ç™»å½•`asst.login_by_QRcode()`ã€‚\n- ã€2018.07.28ã€‘äº¬ä¸œå·²é‡‡ç”¨`æ»‘åŠ¨éªŒè¯ç `æ›¿æ¢ç™»å½•æ—¶å‡ºç°çš„`å­—ç¬¦éªŒè¯ç `ï¼Œä½†è¿˜æ²¡æœ‰ä¸‹çº¿`å­—ç¬¦éªŒè¯ç `æ¥å£ï¼Œ`è´¦å·å¯†ç ç™»å½•`åŠŸèƒ½ä¾æ—§å¯ç”¨ã€‚ç­‰å¾…åç»­æ›´æ–°æ»‘åŠ¨éªŒè¯æ–¹å¼ï¼Œæ¨èä½¿ç”¨`æ‰«ç ç™»å½•`ã€‚\n\n## å¤‡æ³¨\n\n- ğŸŒŸå¼ºçƒˆå»ºè®®å¤§å®¶åœ¨éƒ¨ç½²ä»£ç å‰ä½¿ç”¨æœ‰è´§çš„å•†å“æµ‹è¯•ä¸‹å•æµç¨‹ï¼Œå¹¶ä¸”ï¼šåœ¨äº¬ä¸œè´­ç‰©è½¦ç»“ç®—é¡µé¢è®¾ç½®å‘ç¥¨ä¸º`ç”µå­æ™®é€šå‘ç¥¨-ä¸ªäºº`ï¼Œè®¾ç½®æ”¯ä»˜æ–¹å¼ä¸º`åœ¨çº¿æ”¯ä»˜`ï¼Œå¦åˆ™å¯èƒ½å‡ºç°å„ç§æœªçŸ¥çš„ä¸‹å•å¤±è´¥é—®é¢˜ã€‚ğŸŒŸ\n- äº¬ä¸œå•†åŸçš„ç™»é™†/ä¸‹å•æœºåˆ¶ç»å¸¸æ”¹åŠ¨ï¼Œå½“å‰æµ‹è¯•æ—¶é—´`2020.02.08`ã€‚å¦‚æœå¤±æ•ˆï¼Œæ¬¢è¿æissueï¼Œæˆ‘ä¼šæ¥æ›´æ–°ã€‚\n- ä»£ç åœ¨`macOS`ä¸­ç¼–å†™ï¼Œå¦‚æœåœ¨å…¶ä»–å¹³å°ä¸Šè¿è¡Œå‡ºè¡Œé—®é¢˜ï¼Œæ¬¢è¿æissueã€‚\n\n## å¾…å®Œæˆçš„åŠŸèƒ½\n\n- [ ] Keep session alive\n- [ ] æŠ¢ä¼˜æƒ åˆ¸\n\n## ä¸è€ƒè™‘çš„åŠŸèƒ½\n\n- âœ–ï¸ æ”¯ä»˜åŠŸèƒ½\n- âœ–ï¸ å¤šè´¦å·æŠ¢è´­\n\n## Sponsor\n\n[![JetBrains](./docs/jetbrains.svg)](https://www.jetbrains.com/?from=jd-assistant)\n"
        },
        {
          "name": "area_id",
          "type": "tree",
          "content": null
        },
        {
          "name": "config.ini",
          "type": "blob",
          "size": 1.0166015625,
          "content": "[account]\n# æ”¯ä»˜å¯†ç \n# å¦‚æœä½ çš„è´¦æˆ·ä¸­æœ‰å¯ç”¨çš„äº¬åˆ¸ï¼ˆæ³¨æ„ä¸æ˜¯ä¸œåˆ¸ï¼‰æˆ– åœ¨ä¸Šæ¬¡è´­ä¹°è®¢å•ä¸­ä½¿ç”¨äº†äº¬è±†ï¼Œ\n# é‚£ä¹ˆäº¬ä¸œå¯èƒ½ä¼šåœ¨ä¸‹å•æ—¶è‡ªåŠ¨é€‰æ‹©äº¬åˆ¸æ”¯ä»˜ æˆ– è‡ªåŠ¨å‹¾é€‰äº¬è±†æ”¯ä»˜ã€‚\n# æ­¤æ—¶ä¸‹å•ä¼šè¦æ±‚è¾“å…¥å…­ä½æ•°å­—çš„æ”¯ä»˜å¯†ç ã€‚è¯·åœ¨ä¸‹æ–¹é…ç½®ä½ çš„æ”¯ä»˜å¯†ç ï¼Œå¦‚ 123456 ã€‚\n# å¦‚æœæ²¡æœ‰ä¸Šè¿°æƒ…å†µï¼Œä¸‹æ–¹è¯·ç•™ç©ºã€‚\npayment_pwd =\n\n[config]\n# eid, fp, track_id, risk_control å››ä¸ªå‚æ•°å¿…é¡»å¡«å†™ï¼Œå…·ä½“è¯·å‚è€ƒ wiki-å¸¸è§é—®é¢˜\n# éšæ„å¡«å†™å¯èƒ½å¯¼è‡´è®¢å•æ— æ³•æäº¤ç­‰é—®é¢˜\neid =\nfp =\ntrack_id =\nrisk_control =\n\n# æŸ¥è¯¢åº“å­˜è¯·æ±‚è¶…æ—¶(ç§’)ï¼Œå¯é€‰é…ç½®ï¼Œé»˜è®¤10ç§’\ntimeout =\n\n# æ˜¯å¦ä½¿ç”¨éšæœº useragentï¼Œé»˜è®¤ä¸º false\nrandom_useragent = false\n\n[messenger]\n# ä½¿ç”¨äº†Serveré…±çš„æ¨é€æœåŠ¡\n# å¦‚æœæƒ³å¼€å¯ä¸‹å•æˆåŠŸåæ¶ˆæ¯æ¨é€ï¼Œåˆ™å°† enable è®¾ç½®ä¸º trueï¼Œé»˜è®¤ä¸º false ä¸å¼€å¯æ¨é€\n# å¼€å¯æ¶ˆæ¯æ¨é€å¿…é¡»å¡«å…¥ sckeyï¼Œå¦‚ä½•è·å–è¯·å‚è€ƒ http://sc.ftqq.com/3.versionã€‚æ„Ÿè°¢Serveré…±ï½\nenable = false\nsckey ="
        },
        {
          "name": "config.py",
          "type": "blob",
          "size": 0.755859375,
          "content": "# -*- coding: utf-8 -*-\nimport os\n\nimport configparser\n\n\nclass Config(object):\n\n    def __init__(self, config_file='config.ini'):\n        self._path = os.path.join(os.getcwd(), config_file)\n        if not os.path.exists(self._path):\n            raise FileNotFoundError(\"No such file: config.ini\")\n        self._config = configparser.ConfigParser()\n        self._config.read(self._path, encoding='utf-8')\n\n    def get(self, section, name, strip_blank=True, strip_quote=True):\n        s = self._config.get(section, name)\n        if strip_blank:\n            s = s.strip()\n        if strip_quote:\n            s = s.strip('\"').strip(\"'\")\n\n        return s\n\n    def getboolean(self, section, name):\n        return self._config.getboolean(section, name)\n\n\nglobal_config = Config()\n"
        },
        {
          "name": "docs",
          "type": "tree",
          "content": null
        },
        {
          "name": "exception.py",
          "type": "blob",
          "size": 0.1962890625,
          "content": "#!/usr/bin/env python\n# -*- encoding=utf8 -*-\nfrom log import logger\n\n\nclass AsstException(Exception):\n\n    def __init__(self, message):\n        super().__init__(message)\n        logger.error(message)\n"
        },
        {
          "name": "get_eid_fp.html",
          "type": "blob",
          "size": 0.72265625,
          "content": "<html>\n    <head></head>\n    <body>\n        <div id=\"info\">è·å–ä¸­â€¦â€¦</div>\n        <hr>\n        <div id=\"eid\"></div>\n        <div id=\"fp\"></div>\n    </body>\n</html>\n\n<script src=\"https://gias.jd.com/js/td.js\"></script>\n\n<script>\n    setTimeout(function () {\n        try {\n            getJdEid(function (eid, fp, udfp) {\n                document.getElementById('info').innerText = 'è¯·æŠŠä¸‹é¢çš„å†…å®¹å¤åˆ¶åˆ°é…ç½®æ–‡ä»¶ config.ini ä¸­çš„å¯¹åº”ä½ç½®';\n                document.getElementById('eid').innerText = 'eid = ' + eid;\n                document.getElementById('fp').innerText = 'fp = ' + fp;\n            });\n        } catch (e) {\n            document.getElementById('info').innerText = e;\n        }\n    }, 1000);\n</script>\n"
        },
        {
          "name": "jd_assistant.py",
          "type": "blob",
          "size": 62.6376953125,
          "content": "#!/usr/bin/env python\n# -*- coding: utf-8 -*-\nimport json\nimport os\nimport pickle\nimport re\nimport random\nimport time\n\nimport requests\nfrom bs4 import BeautifulSoup\n\nfrom config import global_config\nfrom exception import AsstException\nfrom log import logger\nfrom messenger import Messenger\nfrom timer import Timer\nfrom util import (\n    DEFAULT_TIMEOUT,\n    DEFAULT_USER_AGENT,\n    check_login,\n    deprecated,\n    encrypt_pwd,\n    encrypt_payment_pwd,\n    get_tag_value,\n    get_random_useragent,\n    open_image,\n    parse_area_id,\n    parse_json,\n    parse_sku_id,\n    parse_items_dict,\n    response_status,\n    save_image,\n    split_area_id\n)\n\n\nclass Assistant(object):\n\n    def __init__(self):\n        use_random_ua = global_config.getboolean('config', 'random_useragent')\n        self.user_agent = DEFAULT_USER_AGENT if not use_random_ua else get_random_useragent()\n        self.headers = {'User-Agent': self.user_agent}\n        self.eid = global_config.get('config', 'eid')\n        self.fp = global_config.get('config', 'fp')\n        self.track_id = global_config.get('config', 'track_id')\n        self.risk_control = global_config.get('config', 'risk_control')\n        if not self.eid or not self.fp or not self.track_id or not self.risk_control:\n            raise AsstException('è¯·åœ¨ config.ini ä¸­é…ç½® eid, fp, track_id, risk_control å‚æ•°ï¼Œå…·ä½“è¯·å‚è€ƒ wiki-å¸¸è§é—®é¢˜')\n\n        self.timeout = float(global_config.get('config', 'timeout') or DEFAULT_TIMEOUT)\n        self.send_message = global_config.getboolean('messenger', 'enable')\n        self.messenger = Messenger(global_config.get('messenger', 'sckey')) if self.send_message else None\n\n        self.item_cat = dict()\n        self.item_vender_ids = dict()  # è®°å½•å•†å®¶id\n\n        self.seckill_init_info = dict()\n        self.seckill_order_data = dict()\n        self.seckill_url = dict()\n\n        self.username = ''\n        self.nick_name = ''\n        self.is_login = False\n        self.sess = requests.session()\n        try:\n            self._load_cookies()\n        except Exception:\n            pass\n\n    def _load_cookies(self):\n        cookies_file = ''\n        for name in os.listdir('./cookies'):\n            if name.endswith('.cookies'):\n                cookies_file = './cookies/{0}'.format(name)\n                break\n        with open(cookies_file, 'rb') as f:\n            local_cookies = pickle.load(f)\n        self.sess.cookies.update(local_cookies)\n        self.is_login = self._validate_cookies()\n\n    def _save_cookies(self):\n        cookies_file = './cookies/{0}.cookies'.format(self.nick_name)\n        directory = os.path.dirname(cookies_file)\n        if not os.path.exists(directory):\n            os.makedirs(directory)\n        with open(cookies_file, 'wb') as f:\n            pickle.dump(self.sess.cookies, f)\n\n    def _validate_cookies(self):\n        \"\"\"éªŒè¯cookiesæ˜¯å¦æœ‰æ•ˆï¼ˆæ˜¯å¦ç™»é™†ï¼‰\n        é€šè¿‡è®¿é—®ç”¨æˆ·è®¢å•åˆ—è¡¨é¡µè¿›è¡Œåˆ¤æ–­ï¼šè‹¥æœªç™»å½•ï¼Œå°†ä¼šé‡å®šå‘åˆ°ç™»é™†é¡µé¢ã€‚\n        :return: cookiesæ˜¯å¦æœ‰æ•ˆ True/False\n        \"\"\"\n        url = 'https://order.jd.com/center/list.action'\n        payload = {\n            'rid': str(int(time.time() * 1000)),\n        }\n        try:\n            resp = self.sess.get(url=url, params=payload, allow_redirects=False)\n            if resp.status_code == requests.codes.OK:\n                return True\n        except Exception as e:\n            logger.error(e)\n\n        self.sess = requests.session()\n        return False\n\n    @deprecated\n    def _need_auth_code(self, username):\n        url = 'https://passport.jd.com/uc/showAuthCode'\n        data = {\n            'loginName': username,\n        }\n        payload = {\n            'version': 2015,\n            'r': random.random(),\n        }\n        resp = self.sess.post(url, params=payload, data=data, headers=self.headers)\n        if not response_status(resp):\n            logger.error('è·å–æ˜¯å¦éœ€è¦éªŒè¯ç å¤±è´¥')\n            return False\n\n        resp_json = json.loads(resp.text[1:-1])  # ({\"verifycode\":true})\n        return resp_json['verifycode']\n\n    @deprecated\n    def _get_auth_code(self, uuid):\n        image_file = os.path.join(os.getcwd(), 'jd_authcode.jpg')\n\n        url = 'https://authcode.jd.com/verify/image'\n        payload = {\n            'a': 1,\n            'acid': uuid,\n            'uid': uuid,\n            'yys': str(int(time.time() * 1000)),\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://passport.jd.com/uc/login',\n        }\n        resp = self.sess.get(url, params=payload, headers=headers)\n\n        if not response_status(resp):\n            logger.error('è·å–éªŒè¯ç å¤±è´¥')\n            return ''\n\n        save_image(resp, image_file)\n        open_image(image_file)\n        return input('éªŒè¯ç :')\n\n    def _get_login_page(self):\n        url = \"https://passport.jd.com/new/login.aspx\"\n        page = self.sess.get(url, headers=self.headers)\n        return page\n\n    @deprecated\n    def _get_login_data(self):\n        page = self._get_login_page()\n        soup = BeautifulSoup(page.text, \"html.parser\")\n        input_list = soup.select('.form input')\n\n        # eid & fp are generated by local javascript code according to browser environment\n        return {\n            'sa_token': input_list[0]['value'],\n            'uuid': input_list[1]['value'],\n            '_t': input_list[4]['value'],\n            'loginType': input_list[5]['value'],\n            'pubKey': input_list[7]['value'],\n            'eid': self.eid,\n            'fp': self.fp,\n        }\n\n    @deprecated\n    def login_by_username(self):\n        if self.is_login:\n            logger.info('ç™»å½•æˆåŠŸ')\n            return True\n\n        username = input('è´¦å·:')\n        password = input('å¯†ç :')\n        if (not username) or (not password):\n            logger.error('ç”¨æˆ·åæˆ–å¯†ç ä¸èƒ½ä¸ºç©º')\n            return False\n        self.username = username\n\n        data = self._get_login_data()\n        uuid = data['uuid']\n\n        auth_code = ''\n        if self._need_auth_code(username):\n            logger.info('æœ¬æ¬¡ç™»å½•éœ€è¦éªŒè¯ç ')\n            auth_code = self._get_auth_code(uuid)\n        else:\n            logger.info('æœ¬æ¬¡ç™»å½•ä¸éœ€è¦éªŒè¯ç ')\n\n        login_url = \"https://passport.jd.com/uc/loginService\"\n        payload = {\n            'uuid': uuid,\n            'version': 2015,\n            'r': random.random(),\n        }\n        data['authcode'] = auth_code\n        data['loginname'] = username\n        data['nloginpwd'] = encrypt_pwd(password)\n        headers = {\n            'User-Agent': self.user_agent,\n            'Origin': 'https://passport.jd.com',\n        }\n        resp = self.sess.post(url=login_url, data=data, headers=headers, params=payload)\n\n        if not response_status(resp):\n            logger.error('ç™»å½•å¤±è´¥')\n            return False\n\n        if not self._get_login_result(resp):\n            return False\n\n        # login success\n        logger.info('ç™»å½•æˆåŠŸ')\n        self.nick_name = self.get_user_info()\n        self._save_cookies()\n        self.is_login = True\n        return True\n\n    @deprecated\n    def _get_login_result(self, resp):\n        resp_json = parse_json(resp.text)\n        error_msg = ''\n        if 'success' in resp_json:\n            # {\"success\":\"http://www.jd.com\"}\n            return True\n        elif 'emptyAuthcode' in resp_json:\n            # {'_t': '_t', 'emptyAuthcode': 'è¯·è¾“å…¥éªŒè¯ç '}\n            # {'_t': '_t', 'emptyAuthcode': 'éªŒè¯ç ä¸æ­£ç¡®æˆ–éªŒè¯ç å·²è¿‡æœŸ'}\n            error_msg = resp_json['emptyAuthcode']\n        elif 'username' in resp_json:\n            # {'_t': '_t', 'username': 'è´¦æˆ·åä¸å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥'}\n            # {'username': 'æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åå†è¯•', 'venture': 'xxxx', 'p': 'xxxx', 'ventureRet': 'http://www.jd.com/', '_t': '_t'}\n            if resp_json['username'] == 'æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åå†è¯•':\n                error_msg = resp_json['username'] + '(é¢„è®¡è´¦æˆ·å­˜åœ¨é£é™©ï¼Œéœ€çŸ­ä¿¡æ¿€æ´»)'\n            else:\n                error_msg = resp_json['username']\n        elif 'pwd' in resp_json:\n            # {'pwd': 'è´¦æˆ·åä¸å¯†ç ä¸åŒ¹é…ï¼Œè¯·é‡æ–°è¾“å…¥', '_t': '_t'}\n            error_msg = resp_json['pwd']\n        else:\n            error_msg = resp_json\n        logger.error(error_msg)\n        return False\n\n    def _get_QRcode(self):\n        url = 'https://qr.m.jd.com/show'\n        payload = {\n            'appid': 133,\n            'size': 147,\n            't': str(int(time.time() * 1000)),\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://passport.jd.com/new/login.aspx',\n        }\n        resp = self.sess.get(url=url, headers=headers, params=payload)\n\n        if not response_status(resp):\n            logger.info('è·å–äºŒç»´ç å¤±è´¥')\n            return False\n\n        QRCode_file = 'QRcode.png'\n        save_image(resp, QRCode_file)\n        logger.info('äºŒç»´ç è·å–æˆåŠŸï¼Œè¯·æ‰“å¼€äº¬ä¸œAPPæ‰«æ')\n        open_image(QRCode_file)\n        return True\n\n    def _get_QRcode_ticket(self):\n        url = 'https://qr.m.jd.com/check'\n        payload = {\n            'appid': '133',\n            'callback': 'jQuery{}'.format(random.randint(1000000, 9999999)),\n            'token': self.sess.cookies.get('wlfstk_smdl'),\n            '_': str(int(time.time() * 1000)),\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://passport.jd.com/new/login.aspx',\n        }\n        resp = self.sess.get(url=url, headers=headers, params=payload)\n\n        if not response_status(resp):\n            logger.error('è·å–äºŒç»´ç æ‰«æç»“æœå¼‚å¸¸')\n            return False\n\n        resp_json = parse_json(resp.text)\n        if resp_json['code'] != 200:\n            logger.info('Code: %s, Message: %s', resp_json['code'], resp_json['msg'])\n            return None\n        else:\n            logger.info('å·²å®Œæˆæ‰‹æœºå®¢æˆ·ç«¯ç¡®è®¤')\n            return resp_json['ticket']\n\n    def _validate_QRcode_ticket(self, ticket):\n        url = 'https://passport.jd.com/uc/qrCodeTicketValidation'\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://passport.jd.com/uc/login?ltype=logout',\n        }\n        resp = self.sess.get(url=url, headers=headers, params={'t': ticket})\n\n        if not response_status(resp):\n            return False\n\n        resp_json = json.loads(resp.text)\n        if resp_json['returnCode'] == 0:\n            return True\n        else:\n            logger.info(resp_json)\n            return False\n\n    def login_by_QRcode(self):\n        \"\"\"äºŒç»´ç ç™»é™†\n        :return:\n        \"\"\"\n        if self.is_login:\n            logger.info('ç™»å½•æˆåŠŸ')\n            return\n\n        self._get_login_page()\n\n        # download QR code\n        if not self._get_QRcode():\n            raise AsstException('äºŒç»´ç ä¸‹è½½å¤±è´¥')\n\n        # get QR code ticket\n        ticket = None\n        retry_times = 85\n        for _ in range(retry_times):\n            ticket = self._get_QRcode_ticket()\n            if ticket:\n                break\n            time.sleep(2)\n        else:\n            raise AsstException('äºŒç»´ç è¿‡æœŸï¼Œè¯·é‡æ–°è·å–æ‰«æ')\n\n        # validate QR code ticket\n        if not self._validate_QRcode_ticket(ticket):\n            raise AsstException('äºŒç»´ç ä¿¡æ¯æ ¡éªŒå¤±è´¥')\n\n        logger.info('äºŒç»´ç ç™»å½•æˆåŠŸ')\n        self.is_login = True\n        self.nick_name = self.get_user_info()\n        self._save_cookies()\n\n    def _get_reserve_url(self, sku_id):\n        url = 'https://yushou.jd.com/youshouinfo.action'\n        payload = {\n            'callback': 'fetchJSON',\n            'sku': sku_id,\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://item.jd.com/{}.html'.format(sku_id),\n        }\n        resp = self.sess.get(url=url, params=payload, headers=headers)\n        resp_json = parse_json(resp.text)\n        # {\"type\":\"1\",\"hasAddress\":false,\"riskCheck\":\"0\",\"flag\":false,\"num\":941723,\"stime\":\"2018-10-12 12:40:00\",\"plusEtime\":\"\",\"qiangEtime\":\"\",\"showPromoPrice\":\"0\",\"qiangStime\":\"\",\"state\":2,\"sku\":100000287121,\"info\":\"\\u9884\\u7ea6\\u8fdb\\u884c\\u4e2d\",\"isJ\":0,\"address\":\"\",\"d\":48824,\"hidePrice\":\"0\",\"yueEtime\":\"2018-10-19 15:01:00\",\"plusStime\":\"\",\"isBefore\":0,\"url\":\"//yushou.jd.com/toYuyue.action?sku=100000287121&key=237af0174f1cffffd227a2f98481a338\",\"etime\":\"2018-10-19 15:01:00\",\"plusD\":48824,\"category\":\"4\",\"plusType\":0,\"yueStime\":\"2018-10-12 12:40:00\"};\n        reserve_url = resp_json.get('url')\n        return 'https:' + reserve_url if reserve_url else None\n\n    @check_login\n    def make_reserve(self, sku_id):\n        \"\"\"å•†å“é¢„çº¦\n        :param sku_id: å•†å“id\n        :return:\n        \"\"\"\n        reserve_url = self._get_reserve_url(sku_id)\n        if not reserve_url:\n            logger.error('%s éé¢„çº¦å•†å“', sku_id)\n            return\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://item.jd.com/{}.html'.format(sku_id),\n        }\n        resp = self.sess.get(url=reserve_url, headers=headers)\n        soup = BeautifulSoup(resp.text, \"html.parser\")\n        reserve_result = soup.find('p', {'class': 'bd-right-result'}).text.strip(' \\t\\r\\n')\n        # é¢„çº¦æˆåŠŸï¼Œå·²è·å¾—æŠ¢è´­èµ„æ ¼ / æ‚¨å·²æˆåŠŸé¢„çº¦è¿‡äº†ï¼Œæ— éœ€é‡å¤é¢„çº¦\n        logger.info(reserve_result)\n\n    @check_login\n    def get_user_info(self):\n        \"\"\"è·å–ç”¨æˆ·ä¿¡æ¯\n        :return: ç”¨æˆ·å\n        \"\"\"\n        url = 'https://passport.jd.com/user/petName/getUserInfoForMiniJd.action'\n        payload = {\n            'callback': 'jQuery{}'.format(random.randint(1000000, 9999999)),\n            '_': str(int(time.time() * 1000)),\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://order.jd.com/center/list.action',\n        }\n        try:\n            resp = self.sess.get(url=url, params=payload, headers=headers)\n            resp_json = parse_json(resp.text)\n            # many user info are included in response, now return nick name in it\n            # jQuery2381773({\"imgUrl\":\"//storage.360buyimg.com/i.imageUpload/xxx.jpg\",\"lastLoginTime\":\"\",\"nickName\":\"xxx\",\"plusStatus\":\"0\",\"realName\":\"xxx\",\"userLevel\":x,\"userScoreVO\":{\"accountScore\":xx,\"activityScore\":xx,\"consumptionScore\":xxxxx,\"default\":false,\"financeScore\":xxx,\"pin\":\"xxx\",\"riskScore\":x,\"totalScore\":xxxxx}})\n            return resp_json.get('nickName') or 'jd'\n        except Exception:\n            return 'jd'\n\n    def _get_item_detail_page(self, sku_id):\n        \"\"\"è®¿é—®å•†å“è¯¦æƒ…é¡µ\n        :param sku_id: å•†å“id\n        :return: å“åº”\n        \"\"\"\n        url = 'https://item.jd.com/{}.html'.format(sku_id)\n        page = requests.get(url=url, headers=self.headers)\n        return page\n\n    def get_single_item_stock(self, sku_id, num, area):\n        \"\"\"è·å–å•ä¸ªå•†å“åº“å­˜çŠ¶æ€\n        :param sku_id: å•†å“id\n        :param num: å•†å“æ•°é‡\n        :param area: åœ°åŒºid\n        :return: å•†å“æ˜¯å¦æœ‰è´§ True/False\n        \"\"\"\n        area_id = parse_area_id(area)\n\n        cat = self.item_cat.get(sku_id)\n        vender_id = self.item_vender_ids.get(sku_id)\n        if not cat:\n            page = self._get_item_detail_page(sku_id)\n            match = re.search(r'cat: \\[(.*?)\\]', page.text)\n            cat = match.group(1)\n            self.item_cat[sku_id] = cat\n\n            match = re.search(r'venderId:(\\d*?),', page.text)\n            vender_id = match.group(1)\n            self.item_vender_ids[sku_id] = vender_id\n\n        url = 'https://c0.3.cn/stock'\n        payload = {\n            'skuId': sku_id,\n            'buyNum': num,\n            'area': area_id,\n            'ch': 1,\n            '_': str(int(time.time() * 1000)),\n            'callback': 'jQuery{}'.format(random.randint(1000000, 9999999)),\n            'extraParam': '{\"originid\":\"1\"}',  # get error stock state without this param\n            'cat': cat,  # get 403 Forbidden without this param (obtained from the detail page)\n            'venderId': vender_id  # return seller information with this param (can't be ignored)\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://item.jd.com/{}.html'.format(sku_id),\n        }\n\n        resp_text = ''\n        try:\n            resp_text = requests.get(url=url, params=payload, headers=headers, timeout=self.timeout).text\n            resp_json = parse_json(resp_text)\n            stock_info = resp_json.get('stock')\n            sku_state = stock_info.get('skuState')  # å•†å“æ˜¯å¦ä¸Šæ¶\n            stock_state = stock_info.get('StockState')  # å•†å“åº“å­˜çŠ¶æ€ï¼š33 -- ç°è´§  0,34 -- æ— è´§  36 -- é‡‡è´­ä¸­  40 -- å¯é…è´§\n            return sku_state == 1 and stock_state in (33, 40)\n        except requests.exceptions.Timeout:\n            logger.error('æŸ¥è¯¢ %s åº“å­˜ä¿¡æ¯è¶…æ—¶(%ss)', sku_id, self.timeout)\n            return False\n        except requests.exceptions.RequestException as request_exception:\n            logger.error('æŸ¥è¯¢ %s åº“å­˜ä¿¡æ¯å‘ç”Ÿç½‘ç»œè¯·æ±‚å¼‚å¸¸ï¼š%s', sku_id, request_exception)\n            return False\n        except Exception as e:\n            logger.error('æŸ¥è¯¢ %s åº“å­˜ä¿¡æ¯å‘ç”Ÿå¼‚å¸¸, resp: %s, exception: %s', sku_id, resp_text, e)\n            return False\n\n    @check_login\n    def get_multi_item_stock(self, sku_ids, area):\n        \"\"\"è·å–å¤šä¸ªå•†å“åº“å­˜çŠ¶æ€ï¼ˆæ—§ï¼‰\n\n        è¯¥æ–¹æ³•éœ€è¦ç™»é™†æ‰èƒ½è°ƒç”¨ï¼Œç”¨äºåŒæ—¶æŸ¥è¯¢å¤šä¸ªå•†å“çš„åº“å­˜ã€‚\n        äº¬ä¸œæŸ¥è¯¢æ¥å£è¿”å›æ¯ç§å•†å“çš„çŠ¶æ€ï¼šæœ‰è´§/æ— è´§ã€‚å½“æ‰€æœ‰å•†å“éƒ½æœ‰è´§ï¼Œè¿”å›Trueï¼›å¦åˆ™ï¼Œè¿”å›Falseã€‚\n\n        :param sku_ids: å¤šä¸ªå•†å“çš„idã€‚å¯ä»¥ä¼ å…¥ä¸­é—´ç”¨è‹±æ–‡é€—å·çš„åˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¦‚\"123,456\"\n        :param area: åœ°åŒºid\n        :return: å¤šä¸ªå•†å“æ˜¯å¦åŒæ—¶æœ‰è´§ True/False\n        \"\"\"\n        items_dict = parse_sku_id(sku_ids=sku_ids)\n        area_id_list = split_area_id(area)\n\n        url = 'https://trade.jd.com/api/v1/batch/stock'\n        headers = {\n            'User-Agent': self.user_agent,\n            'Origin': 'https://trade.jd.com',\n            'Content-Type': 'application/json; charset=UTF-8',\n            'Referer': 'https://trade.jd.com/shopping/order/getOrderInfo.action?rid=' + str(int(time.time() * 1000)),\n        }\n        data = {\n            \"areaRequest\": {\n                \"provinceId\": area_id_list[0],\n                \"cityId\": area_id_list[1],\n                \"countyId\": area_id_list[2],\n                \"townId\": area_id_list[3]\n            },\n            \"skuNumList\": []\n        }\n        for sku_id, count in items_dict.items():\n            data['skuNumList'].append({\n                \"skuId\": sku_id,\n                \"num\": count\n            })\n        # convert to string\n        data = json.dumps(data)\n\n        try:\n            resp = self.sess.post(url=url, headers=headers, data=data, timeout=self.timeout)\n        except requests.exceptions.Timeout:\n            logger.error('æŸ¥è¯¢ %s åº“å­˜ä¿¡æ¯è¶…æ—¶(%ss)', list(items_dict.keys()), self.timeout)\n            return False\n        except requests.exceptions.RequestException as e:\n            raise AsstException('æŸ¥è¯¢ %s åº“å­˜ä¿¡æ¯å¼‚å¸¸ï¼š%s' % (list(items_dict.keys()), e))\n\n        resp_json = parse_json(resp.text)\n        result = resp_json.get('result')\n\n        stock = True\n        for sku_id in result:\n            status = result.get(sku_id).get('status')\n            if 'æ— è´§' in status:\n                stock = False\n                break\n\n        return stock\n\n    def get_multi_item_stock_new(self, sku_ids, area):\n        \"\"\"è·å–å¤šä¸ªå•†å“åº“å­˜çŠ¶æ€ï¼ˆæ–°ï¼‰\n\n        å½“æ‰€æœ‰å•†å“éƒ½æœ‰è´§ï¼Œè¿”å›Trueï¼›å¦åˆ™ï¼Œè¿”å›Falseã€‚\n\n        :param sku_ids: å¤šä¸ªå•†å“çš„idã€‚å¯ä»¥ä¼ å…¥ä¸­é—´ç”¨è‹±æ–‡é€—å·çš„åˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¦‚\"123,456\"\n        :param area: åœ°åŒºid\n        :return: å¤šä¸ªå•†å“æ˜¯å¦åŒæ—¶æœ‰è´§ True/False\n        \"\"\"\n        items_dict = parse_sku_id(sku_ids=sku_ids)\n        area_id = parse_area_id(area=area)\n\n        url = 'https://c0.3.cn/stocks'\n        payload = {\n            'callback': 'jQuery{}'.format(random.randint(1000000, 9999999)),\n            'type': 'getstocks',\n            'skuIds': ','.join(items_dict.keys()),\n            'area': area_id,\n            '_': str(int(time.time() * 1000))\n        }\n        headers = {\n            'User-Agent': self.user_agent\n        }\n\n        resp_text = ''\n        try:\n            resp_text = requests.get(url=url, params=payload, headers=headers, timeout=self.timeout).text\n            stock = True\n            for sku_id, info in parse_json(resp_text).items():\n                sku_state = info.get('skuState')  # å•†å“æ˜¯å¦ä¸Šæ¶\n                stock_state = info.get('StockState')  # å•†å“åº“å­˜çŠ¶æ€\n                if sku_state == 1 and stock_state in (33, 40):\n                    continue\n                else:\n                    stock = False\n                    break\n            return stock\n        except requests.exceptions.Timeout:\n            logger.error('æŸ¥è¯¢ %s åº“å­˜ä¿¡æ¯è¶…æ—¶(%ss)', list(items_dict.keys()), self.timeout)\n            return False\n        except requests.exceptions.RequestException as request_exception:\n            logger.error('æŸ¥è¯¢ %s åº“å­˜ä¿¡æ¯å‘ç”Ÿç½‘ç»œè¯·æ±‚å¼‚å¸¸ï¼š%s', list(items_dict.keys()), request_exception)\n            return False\n        except Exception as e:\n            logger.error('æŸ¥è¯¢ %s åº“å­˜ä¿¡æ¯å‘ç”Ÿå¼‚å¸¸, resp: %s, exception: %s', list(items_dict.keys()), resp_text, e)\n            return False\n\n    def _if_item_removed(self, sku_id):\n        \"\"\"åˆ¤æ–­å•†å“æ˜¯å¦ä¸‹æ¶\n        :param sku_id: å•†å“id\n        :return: å•†å“æ˜¯å¦ä¸‹æ¶ True/False\n        \"\"\"\n        detail_page = self._get_item_detail_page(sku_id=sku_id)\n        return 'è¯¥å•†å“å·²ä¸‹æŸœ' in detail_page.text\n\n    @check_login\n    def if_item_can_be_ordered(self, sku_ids, area):\n        \"\"\"åˆ¤æ–­å•†å“æ˜¯å¦èƒ½ä¸‹å•\n        :param sku_ids: å•†å“idï¼Œå¤šä¸ªå•†å“idä¸­é—´ä½¿ç”¨è‹±æ–‡é€—å·è¿›è¡Œåˆ†å‰²\n        :param area: åœ°å€id\n        :return: å•†å“æ˜¯å¦èƒ½ä¸‹å• True/False\n        \"\"\"\n        items_dict = parse_sku_id(sku_ids=sku_ids)\n        area_id = parse_area_id(area)\n\n        # åˆ¤æ–­å•†å“æ˜¯å¦èƒ½ä¸‹å•\n        if len(items_dict) > 1:\n            return self.get_multi_item_stock_new(sku_ids=items_dict, area=area_id)\n\n        sku_id, count = list(items_dict.items())[0]\n        return self.get_single_item_stock(sku_id=sku_id, num=count, area=area_id)\n\n    def get_item_price(self, sku_id):\n        \"\"\"è·å–å•†å“ä»·æ ¼\n        :param sku_id: å•†å“id\n        :return: ä»·æ ¼\n        \"\"\"\n        url = 'http://p.3.cn/prices/mgets'\n        payload = {\n            'type': 1,\n            'pduid': int(time.time() * 1000),\n            'skuIds': 'J_' + sku_id,\n        }\n        resp = self.sess.get(url=url, params=payload)\n        return parse_json(resp.text).get('p')\n\n    @check_login\n    def add_item_to_cart(self, sku_ids):\n        \"\"\"æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦\n\n        é‡è¦ï¼š\n        1.å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦åå°†ä¼šè‡ªåŠ¨è¢«å‹¾é€‰âœ“ä¸­ã€‚\n        2.åœ¨æäº¤è®¢å•æ—¶ä¼šå¯¹å‹¾é€‰çš„å•†å“è¿›è¡Œç»“ç®—ã€‚\n        3.éƒ¨åˆ†å•†å“ï¼ˆå¦‚é¢„å”®ã€ä¸‹æ¶ç­‰ï¼‰æ— æ³•æ·»åŠ åˆ°è´­ç‰©è½¦\n\n        äº¬ä¸œè´­ç‰©è½¦å¯å®¹çº³çš„æœ€å¤§å•†å“ç§æ•°çº¦ä¸º118-120ç§ï¼Œè¶…è¿‡æ•°é‡ä¼šåŠ å…¥è´­ç‰©è½¦å¤±è´¥ã€‚\n\n        :param sku_ids: å•†å“idï¼Œæ ¼å¼ï¼š\"123\" æˆ– \"123,456\" æˆ– \"123:1,456:2\"ã€‚è‹¥ä¸é…ç½®æ•°é‡ï¼Œé»˜è®¤ä¸º1ä¸ªã€‚\n        :return:\n        \"\"\"\n        url = 'https://cart.jd.com/gate.action'\n        headers = {\n            'User-Agent': self.user_agent,\n        }\n\n        for sku_id, count in parse_sku_id(sku_ids=sku_ids).items():\n            payload = {\n                'pid': sku_id,\n                'pcount': count,\n                'ptype': 1,\n            }\n            resp = self.sess.get(url=url, params=payload, headers=headers)\n            if 'https://cart.jd.com/cart.action' in resp.url:  # å¥—è£…å•†å“åŠ å…¥è´­ç‰©è½¦åç›´æ¥è·³è½¬åˆ°è´­ç‰©è½¦é¡µé¢\n                result = True\n            else:  # æ™®é€šå•†å“æˆåŠŸåŠ å…¥è´­ç‰©è½¦åä¼šè·³è½¬åˆ°æç¤º \"å•†å“å·²æˆåŠŸåŠ å…¥è´­ç‰©è½¦ï¼\" é¡µé¢\n                soup = BeautifulSoup(resp.text, \"html.parser\")\n                result = bool(soup.select('h3.ftx-02'))  # [<h3 class=\"ftx-02\">å•†å“å·²æˆåŠŸåŠ å…¥è´­ç‰©è½¦ï¼</h3>]\n\n            if result:\n                logger.info('%s x %s å·²æˆåŠŸåŠ å…¥è´­ç‰©è½¦', sku_id, count)\n            else:\n                logger.error('%s æ·»åŠ åˆ°è´­ç‰©è½¦å¤±è´¥', sku_id)\n\n    @check_login\n    def clear_cart(self):\n        \"\"\"æ¸…ç©ºè´­ç‰©è½¦\n\n        åŒ…æ‹¬ä¸¤ä¸ªè¯·æ±‚ï¼š\n        1.é€‰ä¸­è´­ç‰©è½¦ä¸­æ‰€æœ‰çš„å•†å“\n        2.æ‰¹é‡åˆ é™¤\n\n        :return: æ¸…ç©ºè´­ç‰©è½¦ç»“æœ True/False\n        \"\"\"\n        # 1.select all items  2.batch remove items\n        select_url = 'https://cart.jd.com/selectAllItem.action'\n        remove_url = 'https://cart.jd.com/batchRemoveSkusFromCart.action'\n        data = {\n            't': 0,\n            'outSkus': '',\n            'random': random.random(),\n        }\n        try:\n            select_resp = self.sess.post(url=select_url, data=data)\n            remove_resp = self.sess.post(url=remove_url, data=data)\n            if (not response_status(select_resp)) or (not response_status(remove_resp)):\n                logger.error('è´­ç‰©è½¦æ¸…ç©ºå¤±è´¥')\n                return False\n            logger.info('è´­ç‰©è½¦æ¸…ç©ºæˆåŠŸ')\n            return True\n        except Exception as e:\n            logger.error(e)\n            return False\n\n    @check_login\n    def get_cart_detail(self):\n        \"\"\"è·å–è´­ç‰©è½¦å•†å“è¯¦æƒ…\n        :return: è´­ç‰©è½¦å•†å“ä¿¡æ¯ dict\n        \"\"\"\n        url = 'https://cart.jd.com/cart.action'\n        resp = self.sess.get(url)\n        soup = BeautifulSoup(resp.text, \"html.parser\")\n\n        cart_detail = dict()\n        for item in soup.find_all(class_='item-item'):\n            try:\n                sku_id = item['skuid']  # å•†å“id\n                # ä¾‹å¦‚ï¼š['increment', '8888', '100001071956', '1', '13', '0', '50067652554']\n                # ['increment', '8888', '100002404322', '2', '1', '0']\n                item_attr_list = item.find(class_='increment')['id'].split('_')\n                p_type = item_attr_list[4]\n                promo_id = target_id = item_attr_list[-1] if len(item_attr_list) == 7 else 0\n\n                cart_detail[sku_id] = {\n                    'name': get_tag_value(item.select('div.p-name a')),  # å•†å“åç§°\n                    'verder_id': item['venderid'],  # å•†å®¶id\n                    'count': int(item['num']),  # æ•°é‡\n                    'unit_price': get_tag_value(item.select('div.p-price strong'))[1:],  # å•ä»·\n                    'total_price': get_tag_value(item.select('div.p-sum strong'))[1:],  # æ€»ä»·\n                    'is_selected': 'item-selected' in item['class'],  # å•†å“æ˜¯å¦è¢«å‹¾é€‰\n                    'p_type': p_type,\n                    'target_id': target_id,\n                    'promo_id': promo_id\n                }\n            except Exception as e:\n                logger.error(\"æŸå•†å“åœ¨è´­ç‰©è½¦ä¸­çš„ä¿¡æ¯æ— æ³•è§£æï¼ŒæŠ¥é”™ä¿¡æ¯: %sï¼Œè¯¥å•†å“è‡ªåŠ¨å¿½ç•¥ã€‚ %s\", e, item)\n\n        logger.info('è´­ç‰©è½¦ä¿¡æ¯ï¼š%s', cart_detail)\n        return cart_detail\n\n    def _cancel_select_all_cart_item(self):\n        \"\"\"å–æ¶ˆå‹¾é€‰è´­ç‰©è½¦ä¸­çš„æ‰€æœ‰å•†å“\n        :return: å–æ¶ˆå‹¾é€‰ç»“æœ True/False\n        \"\"\"\n        url = \"https://cart.jd.com/cancelAllItem.action\"\n        data = {\n            't': 0,\n            'outSkus': '',\n            'random': random.random()\n            # 'locationId' can be ignored\n        }\n        resp = self.sess.post(url, data=data)\n        return response_status(resp)\n\n    def _change_item_num_in_cart(self, sku_id, vender_id, num, p_type, target_id, promo_id):\n        \"\"\"ä¿®æ”¹è´­ç‰©è½¦å•†å“çš„æ•°é‡\n        ä¿®æ”¹è´­ç‰©è½¦ä¸­å•†å“æ•°é‡åï¼Œè¯¥å•†å“å°†ä¼šè¢«è‡ªåŠ¨å‹¾é€‰ä¸Šã€‚\n\n        :param sku_id: å•†å“id\n        :param vender_id: å•†å®¶id\n        :param num: ç›®æ ‡æ•°é‡\n        :param p_type: å•†å“ç±»å‹(å¯èƒ½)\n        :param target_id: å‚æ•°ç”¨é€”æœªçŸ¥ï¼Œå¯èƒ½æ˜¯ç”¨æˆ·åˆ¤æ–­ä¼˜æƒ \n        :param promo_id: å‚æ•°ç”¨é€”æœªçŸ¥ï¼Œå¯èƒ½æ˜¯ç”¨æˆ·åˆ¤æ–­ä¼˜æƒ \n        :return: å•†å“æ•°é‡ä¿®æ”¹ç»“æœ True/False\n        \"\"\"\n        url = \"https://cart.jd.com/changeNum.action\"\n        data = {\n            't': 0,\n            'venderId': vender_id,\n            'pid': sku_id,\n            'pcount': num,\n            'ptype': p_type,\n            'targetId': target_id,\n            'promoID': promo_id,\n            'outSkus': '',\n            'random': random.random(),\n            # 'locationId'\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://cart.jd.com/cart',\n        }\n        resp = self.sess.post(url, data=data, headers=headers)\n        return json.loads(resp.text)['sortedWebCartResult']['achieveSevenState'] == 2\n\n    def _add_or_change_cart_item(self, cart, sku_id, count):\n        \"\"\"æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ï¼Œæˆ–ä¿®æ”¹è´­ç‰©è½¦ä¸­å•†å“æ•°é‡\n\n        å¦‚æœè´­ç‰©è½¦ä¸­å­˜åœ¨è¯¥å•†å“ï¼Œä¼šä¿®æ”¹è¯¥å•†å“çš„æ•°é‡å¹¶å‹¾é€‰ï¼›å¦åˆ™ï¼Œä¼šæ·»åŠ è¯¥å•†å“åˆ°è´­ç‰©è½¦ä¸­å¹¶å‹¾é€‰ã€‚\n\n        :param cart: è´­ç‰©è½¦ä¿¡æ¯ dict\n        :param sku_id: å•†å“id\n        :param count: å•†å“æ•°é‡\n        :return: è¿è¡Œç»“æœ True/False\n        \"\"\"\n        if sku_id in cart:\n            logger.info('%s å·²åœ¨è´­ç‰©è½¦ä¸­ï¼Œè°ƒæ•´æ•°é‡ä¸º %s', sku_id, count)\n            cart_item = cart.get(sku_id)\n            return self._change_item_num_in_cart(\n                sku_id=sku_id,\n                vender_id=cart_item.get('vender_id'),\n                num=count,\n                p_type=cart_item.get('p_type'),\n                target_id=cart_item.get('target_id'),\n                promo_id=cart_item.get('promo_id')\n            )\n        else:\n            logger.info('%s ä¸åœ¨è´­ç‰©è½¦ä¸­ï¼Œå¼€å§‹åŠ å…¥è´­ç‰©è½¦ï¼Œæ•°é‡ %s', sku_id, count)\n            return self.add_item_to_cart(sku_ids={sku_id: count})\n\n    @check_login\n    def get_checkout_page_detail(self):\n        \"\"\"è·å–è®¢å•ç»“ç®—é¡µé¢ä¿¡æ¯\n\n        è¯¥æ–¹æ³•ä¼šè¿”å›è®¢å•ç»“ç®—é¡µé¢çš„è¯¦ç»†ä¿¡æ¯ï¼šå•†å“åç§°ã€ä»·æ ¼ã€æ•°é‡ã€åº“å­˜çŠ¶æ€ç­‰ã€‚\n\n        :return: ç»“ç®—ä¿¡æ¯ dict\n        \"\"\"\n        url = 'http://trade.jd.com/shopping/order/getOrderInfo.action'\n        # url = 'https://cart.jd.com/gotoOrder.action'\n        payload = {\n            'rid': str(int(time.time() * 1000)),\n        }\n        try:\n            resp = self.sess.get(url=url, params=payload)\n            if not response_status(resp):\n                logger.error('è·å–è®¢å•ç»“ç®—é¡µä¿¡æ¯å¤±è´¥')\n                return\n\n            soup = BeautifulSoup(resp.text, \"html.parser\")\n            self.risk_control = get_tag_value(soup.select('input#riskControl'), 'value')\n\n            order_detail = {\n                'address': soup.find('span', id='sendAddr').text[5:],  # remove 'å¯„é€è‡³ï¼š ' from the begin\n                'receiver': soup.find('span', id='sendMobile').text[4:],  # remove 'æ”¶ä»¶äºº:' from the begin\n                'total_price': soup.find('span', id='sumPayPriceId').text[1:],  # remove 'ï¿¥' from the begin\n                'items': []\n            }\n            # TODO: è¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿè§£æé—®é¢˜ï¼Œå¾…ä¿®å¤\n            # for item in soup.select('div.goods-list div.goods-items'):\n            #     div_tag = item.select('div.p-price')[0]\n            #     order_detail.get('items').append({\n            #         'name': get_tag_value(item.select('div.p-name a')),\n            #         'price': get_tag_value(div_tag.select('strong.jd-price'))[2:],  # remove 'ï¿¥ ' from the begin\n            #         'num': get_tag_value(div_tag.select('span.p-num'))[1:],  # remove 'x' from the begin\n            #         'state': get_tag_value(div_tag.select('span.p-state'))  # in stock or out of stock\n            #     })\n\n            logger.info(\"ä¸‹å•ä¿¡æ¯ï¼š%s\", order_detail)\n            return order_detail\n        except Exception as e:\n            logger.error('è®¢å•ç»“ç®—é¡µé¢æ•°æ®è§£æå¼‚å¸¸ï¼ˆå¯ä»¥å¿½ç•¥ï¼‰ï¼ŒæŠ¥é”™ä¿¡æ¯ï¼š%s', e)\n\n    def _save_invoice(self):\n        \"\"\"ä¸‹å•ç¬¬ä¸‰æ–¹å•†å“æ—¶å¦‚æœæœªè®¾ç½®å‘ç¥¨ï¼Œå°†ä»ç”µå­å‘ç¥¨åˆ‡æ¢ä¸ºæ™®é€šå‘ç¥¨\n\n        http://jos.jd.com/api/complexTemplate.htm?webPamer=invoice&groupName=%E5%BC%80%E6%99%AE%E5%8B%92%E5%85%A5%E9%A9%BB%E6%A8%A1%E5%BC%8FAPI&id=566&restName=jd.kepler.trade.submit&isMulti=true\n\n        :return:\n        \"\"\"\n        url = 'https://trade.jd.com/shopping/dynamic/invoice/saveInvoice.action'\n        data = {\n            \"invoiceParam.selectedInvoiceType\": 1,\n            \"invoiceParam.companyName\": \"ä¸ªäºº\",\n            \"invoiceParam.invoicePutType\": 0,\n            \"invoiceParam.selectInvoiceTitle\": 4,\n            \"invoiceParam.selectBookInvoiceContent\": \"\",\n            \"invoiceParam.selectNormalInvoiceContent\": 1,\n            \"invoiceParam.vatCompanyName\": \"\",\n            \"invoiceParam.code\": \"\",\n            \"invoiceParam.regAddr\": \"\",\n            \"invoiceParam.regPhone\": \"\",\n            \"invoiceParam.regBank\": \"\",\n            \"invoiceParam.regBankAccount\": \"\",\n            \"invoiceParam.hasCommon\": \"true\",\n            \"invoiceParam.hasBook\": \"false\",\n            \"invoiceParam.consigneeName\": \"\",\n            \"invoiceParam.consigneePhone\": \"\",\n            \"invoiceParam.consigneeAddress\": \"\",\n            \"invoiceParam.consigneeProvince\": \"è¯·é€‰æ‹©ï¼š\",\n            \"invoiceParam.consigneeProvinceId\": \"NaN\",\n            \"invoiceParam.consigneeCity\": \"è¯·é€‰æ‹©\",\n            \"invoiceParam.consigneeCityId\": \"NaN\",\n            \"invoiceParam.consigneeCounty\": \"è¯·é€‰æ‹©\",\n            \"invoiceParam.consigneeCountyId\": \"NaN\",\n            \"invoiceParam.consigneeTown\": \"è¯·é€‰æ‹©\",\n            \"invoiceParam.consigneeTownId\": 0,\n            \"invoiceParam.sendSeparate\": \"false\",\n            \"invoiceParam.usualInvoiceId\": \"\",\n            \"invoiceParam.selectElectroTitle\": 4,\n            \"invoiceParam.electroCompanyName\": \"undefined\",\n            \"invoiceParam.electroInvoiceEmail\": \"\",\n            \"invoiceParam.electroInvoicePhone\": \"\",\n            \"invokeInvoiceBasicService\": \"true\",\n            \"invoice_ceshi1\": \"\",\n            \"invoiceParam.showInvoiceSeparate\": \"false\",\n            \"invoiceParam.invoiceSeparateSwitch\": 1,\n            \"invoiceParam.invoiceCode\": \"\",\n            \"invoiceParam.saveInvoiceFlag\": 1\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://trade.jd.com/shopping/dynamic/invoice/saveInvoice.action',\n        }\n        self.sess.post(url=url, data=data, headers=headers)\n\n    @check_login\n    def submit_order(self):\n        \"\"\"æäº¤è®¢å•\n\n        é‡è¦ï¼š\n        1.è¯¥æ–¹æ³•åªé€‚ç”¨äºæ™®é€šå•†å“çš„æäº¤è®¢å•ï¼ˆå³å¯ä»¥åŠ å…¥è´­ç‰©è½¦ï¼Œç„¶åç»“ç®—æäº¤è®¢å•çš„å•†å“ï¼‰\n        2.æäº¤è®¢å•æ—¶ï¼Œä¼šå¯¹è´­ç‰©è½¦ä¸­å‹¾é€‰âœ“çš„å•†å“è¿›è¡Œç»“ç®—ï¼ˆå¦‚æœå‹¾é€‰äº†å¤šä¸ªå•†å“ï¼Œå°†ä¼šæäº¤æˆä¸€ä¸ªè®¢å•ï¼‰\n\n        :return: True/False è®¢å•æäº¤ç»“æœ\n        \"\"\"\n        url = 'https://trade.jd.com/shopping/order/submitOrder.action'\n        # js function of submit order is included in https://trade.jd.com/shopping/misc/js/order.js?r=2018070403091\n\n        data = {\n            'overseaPurchaseCookies': '',\n            'vendorRemarks': '[]',\n            'submitOrderParam.sopNotPutInvoice': 'false',\n            'submitOrderParam.trackID': 'TestTrackId',\n            'submitOrderParam.ignorePriceChange': '0',\n            'submitOrderParam.btSupport': '0',\n            'riskControl': self.risk_control,\n            'submitOrderParam.isBestCoupon': 1,\n            'submitOrderParam.jxj': 1,\n            'submitOrderParam.trackId': self.track_id,  # Todo: need to get trackId\n            'submitOrderParam.eid': self.eid,\n            'submitOrderParam.fp': self.fp,\n            'submitOrderParam.needCheck': 1,\n        }\n\n        # add payment password when necessary\n        payment_pwd = global_config.get('account', 'payment_pwd')\n        if payment_pwd:\n            data['submitOrderParam.payPassword'] = encrypt_payment_pwd(payment_pwd)\n\n        headers = {\n            'User-Agent': self.user_agent,\n            'Host': 'trade.jd.com',\n            'Referer': 'http://trade.jd.com/shopping/order/getOrderInfo.action',\n        }\n\n        try:\n            resp = self.sess.post(url=url, data=data, headers=headers)\n            resp_json = json.loads(resp.text)\n\n            # è¿”å›ä¿¡æ¯ç¤ºä¾‹ï¼š\n            # ä¸‹å•å¤±è´¥\n            # {'overSea': False, 'orderXml': None, 'cartXml': None, 'noStockSkuIds': '', 'reqInfo': None, 'hasJxj': False, 'addedServiceList': None, 'sign': None, 'pin': 'xxx', 'needCheckCode': False, 'success': False, 'resultCode': 60123, 'orderId': 0, 'submitSkuNum': 0, 'deductMoneyFlag': 0, 'goJumpOrderCenter': False, 'payInfo': None, 'scaleSkuInfoListVO': None, 'purchaseSkuInfoListVO': None, 'noSupportHomeServiceSkuList': None, 'msgMobile': None, 'addressVO': None, 'msgUuid': None, 'message': 'è¯·è¾“å…¥æ”¯ä»˜å¯†ç ï¼'}\n            # {'overSea': False, 'cartXml': None, 'noStockSkuIds': '', 'reqInfo': None, 'hasJxj': False, 'addedServiceList': None, 'orderXml': None, 'sign': None, 'pin': 'xxx', 'needCheckCode': False, 'success': False, 'resultCode': 60017, 'orderId': 0, 'submitSkuNum': 0, 'deductMoneyFlag': 0, 'goJumpOrderCenter': False, 'payInfo': None, 'scaleSkuInfoListVO': None, 'purchaseSkuInfoListVO': None, 'noSupportHomeServiceSkuList': None, 'msgMobile': None, 'addressVO': None, 'msgUuid': None, 'message': 'æ‚¨å¤šæ¬¡æäº¤è¿‡å¿«ï¼Œè¯·ç¨åå†è¯•'}\n            # {'overSea': False, 'orderXml': None, 'cartXml': None, 'noStockSkuIds': '', 'reqInfo': None, 'hasJxj': False, 'addedServiceList': None, 'sign': None, 'pin': 'xxx', 'needCheckCode': False, 'success': False, 'resultCode': 60077, 'orderId': 0, 'submitSkuNum': 0, 'deductMoneyFlag': 0, 'goJumpOrderCenter': False, 'payInfo': None, 'scaleSkuInfoListVO': None, 'purchaseSkuInfoListVO': None, 'noSupportHomeServiceSkuList': None, 'msgMobile': None, 'addressVO': None, 'msgUuid': None, 'message': 'è·å–ç”¨æˆ·è®¢å•ä¿¡æ¯å¤±è´¥'}\n            # {\"cartXml\":null,\"noStockSkuIds\":\"xxx\",\"reqInfo\":null,\"hasJxj\":false,\"addedServiceList\":null,\"overSea\":false,\"orderXml\":null,\"sign\":null,\"pin\":\"xxx\",\"needCheckCode\":false,\"success\":false,\"resultCode\":600157,\"orderId\":0,\"submitSkuNum\":0,\"deductMoneyFlag\":0,\"goJumpOrderCenter\":false,\"payInfo\":null,\"scaleSkuInfoListVO\":null,\"purchaseSkuInfoListVO\":null,\"noSupportHomeServiceSkuList\":null,\"msgMobile\":null,\"addressVO\":{\"pin\":\"xxx\",\"areaName\":\"\",\"provinceId\":xx,\"cityId\":xx,\"countyId\":xx,\"townId\":xx,\"paymentId\":0,\"selected\":false,\"addressDetail\":\"xx\",\"mobile\":\"xx\",\"idCard\":\"\",\"phone\":null,\"email\":null,\"selfPickMobile\":null,\"selfPickPhone\":null,\"provinceName\":null,\"cityName\":null,\"countyName\":null,\"townName\":null,\"giftSenderConsigneeName\":null,\"giftSenderConsigneeMobile\":null,\"gcLat\":0.0,\"gcLng\":0.0,\"coord_type\":0,\"longitude\":0.0,\"latitude\":0.0,\"selfPickOptimize\":0,\"consigneeId\":0,\"selectedAddressType\":0,\"siteType\":0,\"helpMessage\":null,\"tipInfo\":null,\"cabinetAvailable\":true,\"limitKeyword\":0,\"specialRemark\":null,\"siteProvinceId\":0,\"siteCityId\":0,\"siteCountyId\":0,\"siteTownId\":0,\"skuSupported\":false,\"addressSupported\":0,\"isCod\":0,\"consigneeName\":null,\"pickVOname\":null,\"shipmentType\":0,\"retTag\":0,\"tagSource\":0,\"userDefinedTag\":null,\"newProvinceId\":0,\"newCityId\":0,\"newCountyId\":0,\"newTownId\":0,\"newProvinceName\":null,\"newCityName\":null,\"newCountyName\":null,\"newTownName\":null,\"checkLevel\":0,\"optimizePickID\":0,\"pickType\":0,\"dataSign\":0,\"overseas\":0,\"areaCode\":null,\"nameCode\":null,\"appSelfPickAddress\":0,\"associatePickId\":0,\"associateAddressId\":0,\"appId\":null,\"encryptText\":null,\"certNum\":null,\"used\":false,\"oldAddress\":false,\"mapping\":false,\"addressType\":0,\"fullAddress\":\"xxxx\",\"postCode\":null,\"addressDefault\":false,\"addressName\":null,\"selfPickAddressShuntFlag\":0,\"pickId\":0,\"pickName\":null,\"pickVOselected\":false,\"mapUrl\":null,\"branchId\":0,\"canSelected\":false,\"address\":null,\"name\":\"xxx\",\"message\":null,\"id\":0},\"msgUuid\":null,\"message\":\"xxxxxxå•†å“æ— è´§\"}\n            # {'orderXml': None, 'overSea': False, 'noStockSkuIds': 'xxx', 'reqInfo': None, 'hasJxj': False, 'addedServiceList': None, 'cartXml': None, 'sign': None, 'pin': 'xxx', 'needCheckCode': False, 'success': False, 'resultCode': 600158, 'orderId': 0, 'submitSkuNum': 0, 'deductMoneyFlag': 0, 'goJumpOrderCenter': False, 'payInfo': None, 'scaleSkuInfoListVO': None, 'purchaseSkuInfoListVO': None, 'noSupportHomeServiceSkuList': None, 'msgMobile': None, 'addressVO': {'oldAddress': False, 'mapping': False, 'pin': 'xxx', 'areaName': '', 'provinceId': xx, 'cityId': xx, 'countyId': xx, 'townId': xx, 'paymentId': 0, 'selected': False, 'addressDetail': 'xxxx', 'mobile': 'xxxx', 'idCard': '', 'phone': None, 'email': None, 'selfPickMobile': None, 'selfPickPhone': None, 'provinceName': None, 'cityName': None, 'countyName': None, 'townName': None, 'giftSenderConsigneeName': None, 'giftSenderConsigneeMobile': None, 'gcLat': 0.0, 'gcLng': 0.0, 'coord_type': 0, 'longitude': 0.0, 'latitude': 0.0, 'selfPickOptimize': 0, 'consigneeId': 0, 'selectedAddressType': 0, 'newCityName': None, 'newCountyName': None, 'newTownName': None, 'checkLevel': 0, 'optimizePickID': 0, 'pickType': 0, 'dataSign': 0, 'overseas': 0, 'areaCode': None, 'nameCode': None, 'appSelfPickAddress': 0, 'associatePickId': 0, 'associateAddressId': 0, 'appId': None, 'encryptText': None, 'certNum': None, 'addressType': 0, 'fullAddress': 'xxxx', 'postCode': None, 'addressDefault': False, 'addressName': None, 'selfPickAddressShuntFlag': 0, 'pickId': 0, 'pickName': None, 'pickVOselected': False, 'mapUrl': None, 'branchId': 0, 'canSelected': False, 'siteType': 0, 'helpMessage': None, 'tipInfo': None, 'cabinetAvailable': True, 'limitKeyword': 0, 'specialRemark': None, 'siteProvinceId': 0, 'siteCityId': 0, 'siteCountyId': 0, 'siteTownId': 0, 'skuSupported': False, 'addressSupported': 0, 'isCod': 0, 'consigneeName': None, 'pickVOname': None, 'shipmentType': 0, 'retTag': 0, 'tagSource': 0, 'userDefinedTag': None, 'newProvinceId': 0, 'newCityId': 0, 'newCountyId': 0, 'newTownId': 0, 'newProvinceName': None, 'used': False, 'address': None, 'name': 'xx', 'message': None, 'id': 0}, 'msgUuid': None, 'message': 'xxxxxxå•†å“æ— è´§'}\n            # ä¸‹å•æˆåŠŸ\n            # {'overSea': False, 'orderXml': None, 'cartXml': None, 'noStockSkuIds': '', 'reqInfo': None, 'hasJxj': False, 'addedServiceList': None, 'sign': None, 'pin': 'xxx', 'needCheckCode': False, 'success': True, 'resultCode': 0, 'orderId': 8740xxxxx, 'submitSkuNum': 1, 'deductMoneyFlag': 0, 'goJumpOrderCenter': False, 'payInfo': None, 'scaleSkuInfoListVO': None, 'purchaseSkuInfoListVO': None, 'noSupportHomeServiceSkuList': None, 'msgMobile': None, 'addressVO': None, 'msgUuid': None, 'message': None}\n\n            if resp_json.get('success'):\n                order_id = resp_json.get('orderId')\n                logger.info('è®¢å•æäº¤æˆåŠŸ! è®¢å•å·ï¼š%s', order_id)\n                if self.send_message:\n                    self.messenger.send(text='jd-assistant è®¢å•æäº¤æˆåŠŸ', desp='è®¢å•å·ï¼š%s' % order_id)\n                return True\n            else:\n                message, result_code = resp_json.get('message'), resp_json.get('resultCode')\n                if result_code == 0:\n                    self._save_invoice()\n                    message = message + '(ä¸‹å•å•†å“å¯èƒ½ä¸ºç¬¬ä¸‰æ–¹å•†å“ï¼Œå°†åˆ‡æ¢ä¸ºæ™®é€šå‘ç¥¨è¿›è¡Œå°è¯•)'\n                elif result_code == 60077:\n                    message = message + '(å¯èƒ½æ˜¯è´­ç‰©è½¦ä¸ºç©º æˆ– æœªå‹¾é€‰è´­ç‰©è½¦ä¸­å•†å“)'\n                elif result_code == 60123:\n                    message = message + '(éœ€è¦åœ¨config.iniæ–‡ä»¶ä¸­é…ç½®æ”¯ä»˜å¯†ç )'\n                logger.info('è®¢å•æäº¤å¤±è´¥, é”™è¯¯ç ï¼š%s, è¿”å›ä¿¡æ¯ï¼š%s', result_code, message)\n                logger.info(resp_json)\n                return False\n        except Exception as e:\n            logger.error(e)\n            return False\n\n    @check_login\n    def submit_order_with_retry(self, retry=3, interval=4):\n        \"\"\"æäº¤è®¢å•ï¼Œå¹¶ä¸”å¸¦æœ‰é‡è¯•åŠŸèƒ½\n        :param retry: é‡è¯•æ¬¡æ•°\n        :param interval: é‡è¯•é—´éš”\n        :return: è®¢å•æäº¤ç»“æœ True/False\n        \"\"\"\n        for i in range(1, retry + 1):\n            logger.info('ç¬¬[%s/%s]æ¬¡å°è¯•æäº¤è®¢å•', i, retry)\n            self.get_checkout_page_detail()\n            if self.submit_order():\n                logger.info('ç¬¬%sæ¬¡æäº¤è®¢å•æˆåŠŸ', i)\n                return True\n            else:\n                if i < retry:\n                    logger.info('ç¬¬%sæ¬¡æäº¤å¤±è´¥ï¼Œ%ssåé‡è¯•', i, interval)\n                    time.sleep(interval)\n        else:\n            logger.info('é‡è¯•æäº¤%sæ¬¡ç»“æŸ', retry)\n            return False\n\n    @check_login\n    def submit_order_by_time(self, buy_time, retry=4, interval=5):\n        \"\"\"å®šæ—¶æäº¤å•†å“è®¢å•\n\n        é‡è¦ï¼šè¯¥æ–¹æ³•åªé€‚ç”¨äºæ™®é€šå•†å“çš„æäº¤è®¢å•ï¼Œäº‹å…ˆéœ€è¦å…ˆå°†å•†å“åŠ å…¥è´­ç‰©è½¦å¹¶å‹¾é€‰âœ“ã€‚\n\n        :param buy_time: ä¸‹å•æ—¶é—´ï¼Œä¾‹å¦‚ï¼š'2018-09-28 22:45:50.000'\n        :param retry: ä¸‹å•é‡å¤æ‰§è¡Œæ¬¡æ•°ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤4æ¬¡\n        :param interval: ä¸‹å•æ‰§è¡Œé—´éš”ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤5ç§’\n        :return:\n        \"\"\"\n        t = Timer(buy_time=buy_time)\n        t.start()\n\n        for count in range(1, retry + 1):\n            logger.info('ç¬¬[%s/%s]æ¬¡å°è¯•æäº¤è®¢å•', count, retry)\n            if self.submit_order():\n                break\n            logger.info('ä¼‘æ¯%ss', interval)\n            time.sleep(interval)\n        else:\n            logger.info('æ‰§è¡Œç»“æŸï¼Œæäº¤è®¢å•å¤±è´¥ï¼')\n\n    @check_login\n    def get_order_info(self, unpaid=True):\n        \"\"\"æŸ¥è¯¢è®¢å•ä¿¡æ¯\n        :param unpaid: åªæ˜¾ç¤ºæœªä»˜æ¬¾è®¢å•ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºTrue\n        :return:\n        \"\"\"\n        url = 'https://order.jd.com/center/list.action'\n        payload = {\n            'search': 0,\n            'd': 1,\n            's': 4096,\n        }  # Orders for nearly three months\n        headers = {\n            'User-Agent': self.user_agent,\n            'Referer': 'https://passport.jd.com/uc/login?ltype=logout',\n        }\n\n        try:\n            resp = self.sess.get(url=url, params=payload, headers=headers)\n            if not response_status(resp):\n                logger.error('è·å–è®¢å•é¡µä¿¡æ¯å¤±è´¥')\n                return\n            soup = BeautifulSoup(resp.text, \"html.parser\")\n\n            logger.info('************************è®¢å•åˆ—è¡¨é¡µæŸ¥è¯¢************************')\n            order_table = soup.find('table', {'class': 'order-tb'})\n            table_bodies = order_table.select('tbody')\n            exist_order = False\n            for table_body in table_bodies:\n                # get order status\n                order_status = get_tag_value(table_body.select('span.order-status')).replace(\"è®¢å•çŠ¶æ€ï¼š\", \"\")\n\n                # check if order is waiting for payment\n                # wait_payment = bool(table_body.select('a.btn-pay'))\n                wait_payment = \"ç­‰å¾…ä»˜æ¬¾\" in order_status\n\n                # only show unpaid orders if unpaid=True\n                if unpaid and (not wait_payment):\n                    continue\n\n                exist_order = True\n\n                # get order_time, order_id\n                tr_th = table_body.select('tr.tr-th')[0]\n                order_time = get_tag_value(tr_th.select('span.dealtime'))\n                order_id = get_tag_value(tr_th.select('span.number a'))\n\n                # get sum_price, pay_method\n                sum_price = ''\n                pay_method = ''\n                amount_div = table_body.find('div', {'class': 'amount'})\n                if amount_div:\n                    spans = amount_div.select('span')\n                    pay_method = get_tag_value(spans, index=1)\n                    # if the order is waiting for payment, the price after the discount is shown.\n                    sum_price = get_tag_value(amount_div.select('strong'), index=1)[1:] if wait_payment \\\n                        else get_tag_value(spans, index=0)[4:]\n\n                # get name and quantity of items in order\n                items_dict = dict()  # {'item_id_1': quantity_1, 'item_id_2': quantity_2, ...}\n                tr_bds = table_body.select('tr.tr-bd')\n                for tr_bd in tr_bds:\n                    item = tr_bd.find('div', {'class': 'goods-item'})\n                    if not item:\n                        break\n                    item_id = item.get('class')[1][2:]\n                    quantity = get_tag_value(tr_bd.select('div.goods-number'))[1:]\n                    items_dict[item_id] = quantity\n\n                order_info_format = 'ä¸‹å•æ—¶é—´:{0}----è®¢å•å·:{1}----å•†å“åˆ—è¡¨:{2}----è®¢å•çŠ¶æ€:{3}----æ€»é‡‘é¢:{4}å…ƒ----ä»˜æ¬¾æ–¹å¼:{5}'\n                logger.info(order_info_format.format(order_time, order_id, parse_items_dict(items_dict), order_status,\n                                                     sum_price, pay_method))\n\n            if not exist_order:\n                logger.info('è®¢å•æŸ¥è¯¢ä¸ºç©º')\n        except Exception as e:\n            logger.error(e)\n\n    @deprecated\n    def _get_seckill_url(self, sku_id):\n        \"\"\"è·å–å•†å“çš„æŠ¢è´­é“¾æ¥\n\n        ç‚¹å‡»\"æŠ¢è´­\"æŒ‰é’®åï¼Œä¼šæœ‰ä¸¤æ¬¡302è·³è½¬ï¼Œæœ€ååˆ°è¾¾è®¢å•ç»“ç®—é¡µé¢\n        è¿™é‡Œè¿”å›ç¬¬ä¸€æ¬¡è·³è½¬åçš„é¡µé¢urlï¼Œä½œä¸ºå•†å“çš„æŠ¢è´­é“¾æ¥\n\n        :param sku_id: å•†å“id\n        :return: å•†å“çš„æŠ¢è´­é“¾æ¥\n        \"\"\"\n        url = 'https://itemko.jd.com/itemShowBtn'\n        payload = {\n            'callback': 'jQuery{}'.format(random.randint(1000000, 9999999)),\n            'skuId': sku_id,\n            'from': 'pc',\n            '_': str(int(time.time() * 1000)),\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Host': 'itemko.jd.com',\n            'Referer': 'https://item.jd.com/{}.html'.format(sku_id),\n        }\n        retry_interval = 0.5\n\n        while True:\n            resp = self.sess.get(url=url, headers=headers, params=payload)\n            resp_json = parse_json(resp.text)\n            if resp_json.get('url'):\n                # https://divide.jd.com/user_routing?skuId=8654289&sn=c3f4ececd8461f0e4d7267e96a91e0e0&from=pc\n                router_url = 'https:' + resp_json.get('url')\n                # https://marathon.jd.com/captcha.html?skuId=8654289&sn=c3f4ececd8461f0e4d7267e96a91e0e0&from=pc\n                seckill_url = router_url.replace('divide', 'marathon').replace('user_routing', 'captcha.html')\n                logger.info(\"æŠ¢è´­é“¾æ¥è·å–æˆåŠŸ: %s\", seckill_url)\n                return seckill_url\n            else:\n                logger.info(\"æŠ¢è´­é“¾æ¥è·å–å¤±è´¥ï¼Œ%sä¸æ˜¯æŠ¢è´­å•†å“æˆ–æŠ¢è´­é¡µé¢æš‚æœªåˆ·æ–°ï¼Œ%sç§’åé‡è¯•\", sku_id, retry_interval)\n                time.sleep(retry_interval)\n\n    @deprecated\n    def request_seckill_url(self, sku_id):\n        \"\"\"è®¿é—®å•†å“çš„æŠ¢è´­é“¾æ¥ï¼ˆç”¨äºè®¾ç½®cookieç­‰ï¼‰\n        :param sku_id: å•†å“id\n        :return:\n        \"\"\"\n        if not self.seckill_url.get(sku_id):\n            self.seckill_url[sku_id] = self._get_seckill_url(sku_id)\n        headers = {\n            'User-Agent': self.user_agent,\n            'Host': 'marathon.jd.com',\n            'Referer': 'https://item.jd.com/{}.html'.format(sku_id),\n        }\n        self.sess.get(url=self.seckill_url.get(sku_id), headers=headers, allow_redirects=False)\n\n    @deprecated\n    def request_seckill_checkout_page(self, sku_id, num=1):\n        \"\"\"è®¿é—®æŠ¢è´­è®¢å•ç»“ç®—é¡µé¢\n        :param sku_id: å•†å“id\n        :param num: è´­ä¹°æ•°é‡ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤1ä¸ª\n        :return:\n        \"\"\"\n        url = 'https://marathon.jd.com/seckill/seckill.action'\n        payload = {\n            'skuId': sku_id,\n            'num': num,\n            'rid': int(time.time())\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Host': 'marathon.jd.com',\n            'Referer': 'https://item.jd.com/{}.html'.format(sku_id),\n        }\n        self.sess.get(url=url, params=payload, headers=headers)\n\n    @deprecated\n    def _get_seckill_init_info(self, sku_id, num=1):\n        \"\"\"è·å–ç§’æ€åˆå§‹åŒ–ä¿¡æ¯ï¼ˆåŒ…æ‹¬ï¼šåœ°å€ï¼Œå‘ç¥¨ï¼Œtokenï¼‰\n        :param sku_id:\n        :param num: è´­ä¹°æ•°é‡ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤1ä¸ª\n        :return: åˆå§‹åŒ–ä¿¡æ¯ç»„æˆçš„dict\n        \"\"\"\n        url = 'https://marathon.jd.com/seckillnew/orderService/pc/init.action'\n        data = {\n            'sku': sku_id,\n            'num': num,\n            'isModifyAddress': 'false',\n        }\n        headers = {\n            'User-Agent': self.user_agent,\n            'Host': 'marathon.jd.com',\n        }\n        resp = self.sess.post(url=url, data=data, headers=headers)\n        return parse_json(resp.text)\n\n    @deprecated\n    def _gen_seckill_order_data(self, sku_id, num=1):\n        \"\"\"ç”Ÿæˆæäº¤æŠ¢è´­è®¢å•æ‰€éœ€çš„è¯·æ±‚ä½“å‚æ•°\n        :param sku_id: å•†å“id\n        :param num: è´­ä¹°æ•°é‡ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤1ä¸ª\n        :return: è¯·æ±‚ä½“å‚æ•°ç»„æˆçš„dict\n        \"\"\"\n\n        # è·å–ç”¨æˆ·ç§’æ€åˆå§‹åŒ–ä¿¡æ¯\n        if not self.seckill_init_info.get(sku_id):\n            self.seckill_init_info[sku_id] = self._get_seckill_init_info(sku_id)\n\n        init_info = self.seckill_init_info.get(sku_id)\n        default_address = init_info['addressList'][0]  # é»˜è®¤åœ°å€dict\n        invoice_info = init_info.get('invoiceInfo', {})  # é»˜è®¤å‘ç¥¨ä¿¡æ¯dict, æœ‰å¯èƒ½ä¸è¿”å›\n        token = init_info['token']\n\n        data = {\n            'skuId': sku_id,\n            'num': num,\n            'addressId': default_address['id'],\n            'yuShou': str(bool(int(init_info['seckillSkuVO']['extMap'].get('YuShou', '0')))).lower(),\n            'isModifyAddress': 'false',\n            'name': default_address['name'],\n            'provinceId': default_address['provinceId'],\n            'cityId': default_address['cityId'],\n            'countyId': default_address['countyId'],\n            'townId': default_address['townId'],\n            'addressDetail': default_address['addressDetail'],\n            'mobile': default_address['mobile'],\n            'mobileKey': default_address['mobileKey'],\n            'email': default_address.get('email', ''),\n            'postCode': '',\n            'invoiceTitle': invoice_info.get('invoiceTitle', -1),\n            'invoiceCompanyName': '',\n            'invoiceContent': invoice_info.get('invoiceContentType', 1),\n            'invoiceTaxpayerNO': '',\n            'invoiceEmail': '',\n            'invoicePhone': invoice_info.get('invoicePhone', ''),\n            'invoicePhoneKey': invoice_info.get('invoicePhoneKey', ''),\n            'invoice': 'true' if invoice_info else 'false',\n            'password': global_config.get('account', 'payment_pwd'),\n            'codTimeType': 3,\n            'paymentType': 4,\n            'areaCode': '',\n            'overseas': 0,\n            'phone': '',\n            'eid': self.eid,\n            'fp': self.fp,\n            'token': token,\n            'pru': ''\n        }\n        return data\n\n    @deprecated\n    def submit_seckill_order(self, sku_id, num=1):\n        \"\"\"æäº¤æŠ¢è´­ï¼ˆç§’æ€ï¼‰è®¢å•\n        :param sku_id: å•†å“id\n        :param num: è´­ä¹°æ•°é‡ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤1ä¸ª\n        :return: æŠ¢è´­ç»“æœ True/False\n        \"\"\"\n        url = 'https://marathon.jd.com/seckillnew/orderService/pc/submitOrder.action'\n        payload = {\n            'skuId': sku_id,\n        }\n        if not self.seckill_order_data.get(sku_id):\n            self.seckill_order_data[sku_id] = self._gen_seckill_order_data(sku_id, num)\n\n        headers = {\n            'User-Agent': self.user_agent,\n            'Host': 'marathon.jd.com',\n            'Referer': 'https://marathon.jd.com/seckill/seckill.action?skuId={0}&num={1}&rid={2}'.format(\n                sku_id, num, int(time.time())),\n        }\n\n        resp_json = None\n        try:\n            resp = self.sess.post(url=url, headers=headers, params=payload,\n                                  data=self.seckill_order_data.get(sku_id), timeout=5)\n            logger.info(resp.text)\n            resp_json = parse_json(resp.text)\n        except Exception as e:\n            logger.error('ç§’æ€è¯·æ±‚å‡ºé”™ï¼š%s', str(e))\n            return False\n        # è¿”å›ä¿¡æ¯\n        # æŠ¢è´­å¤±è´¥ï¼š\n        # {'errorMessage': 'å¾ˆé—æ†¾æ²¡æœ‰æŠ¢åˆ°ï¼Œå†æ¥å†å‰å“¦ã€‚', 'orderId': 0, 'resultCode': 60074, 'skuId': 0, 'success': False}\n        # {'errorMessage': 'æŠ±æ­‰ï¼Œæ‚¨æäº¤è¿‡å¿«ï¼Œè¯·ç¨åå†æäº¤è®¢å•ï¼', 'orderId': 0, 'resultCode': 60017, 'skuId': 0, 'success': False}\n        # {'errorMessage': 'ç³»ç»Ÿæ­£åœ¨å¼€å°å·®ï¼Œè¯·é‡è¯•~~', 'orderId': 0, 'resultCode': 90013, 'skuId': 0, 'success': False}\n        # æŠ¢è´­æˆåŠŸï¼š\n        # {\"appUrl\":\"xxxxx\",\"orderId\":820227xxxxx,\"pcUrl\":\"xxxxx\",\"resultCode\":0,\"skuId\":0,\"success\":true,\"totalMoney\":\"xxxxx\"}\n\n        if resp_json.get('success'):\n            order_id = resp_json.get('orderId')\n            total_money = resp_json.get('totalMoney')\n            pay_url = 'https:' + resp_json.get('pcUrl')\n            logger.info('æŠ¢è´­æˆåŠŸï¼Œè®¢å•å·: %s, æ€»ä»·: %s, ç”µè„‘ç«¯ä»˜æ¬¾é“¾æ¥: %s', order_id, total_money, pay_url)\n            return True\n        else:\n            logger.info('æŠ¢è´­å¤±è´¥ï¼Œè¿”å›ä¿¡æ¯: %s', resp_json)\n            return False\n\n    @deprecated\n    def exec_seckill(self, sku_id, retry=4, interval=4, num=1, fast_mode=True):\n        \"\"\"ç«‹å³æŠ¢è´­\n\n        æŠ¢è´­å•†å“çš„ä¸‹å•æµç¨‹ä¸æ™®é€šå•†å“ä¸åŒï¼Œä¸æ”¯æŒåŠ å…¥è´­ç‰©è½¦ï¼Œå¯èƒ½éœ€è¦æå‰é¢„çº¦ï¼Œä¸»è¦æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š\n        1. è®¿é—®å•†å“çš„æŠ¢è´­é“¾æ¥\n        2. è®¿é—®æŠ¢è´­è®¢å•ç»“ç®—é¡µé¢ï¼ˆå¥½åƒå¯ä»¥çœç•¥è¿™æ­¥ï¼Œå¾…æµ‹è¯•ï¼‰\n        3. æäº¤æŠ¢è´­ï¼ˆç§’æ€ï¼‰è®¢å•\n\n        :param sku_id: å•†å“id\n        :param retry: æŠ¢è´­é‡å¤æ‰§è¡Œæ¬¡æ•°ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤4æ¬¡\n        :param interval: æŠ¢è´­æ‰§è¡Œé—´éš”ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤4ç§’\n        :param num: è´­ä¹°æ•°é‡ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤1ä¸ª\n        :param fast_mode: å¿«é€Ÿæ¨¡å¼ï¼šç•¥è¿‡è®¿é—®æŠ¢è´­è®¢å•ç»“ç®—é¡µé¢è¿™ä¸€æ­¥éª¤ï¼Œé»˜è®¤ä¸º True\n        :return: æŠ¢è´­ç»“æœ True/False\n        \"\"\"\n        for count in range(1, retry + 1):\n            logger.info('ç¬¬[%s/%s]æ¬¡å°è¯•æŠ¢è´­å•†å“:%s', count, retry, sku_id)\n\n            self.request_seckill_url(sku_id)\n            if not fast_mode:\n                self.request_seckill_checkout_page(sku_id, num)\n\n            if self.submit_seckill_order(sku_id, num):\n                return True\n            else:\n                logger.info('ä¼‘æ¯%ss', interval)\n                time.sleep(interval)\n        else:\n            logger.info('æ‰§è¡Œç»“æŸï¼ŒæŠ¢è´­%så¤±è´¥ï¼', sku_id)\n            return False\n\n    @deprecated\n    def exec_seckill_by_time(self, sku_ids, buy_time, retry=4, interval=4, num=1, fast_mode=True):\n        \"\"\"å®šæ—¶æŠ¢è´­\n        :param sku_ids: å•†å“idï¼Œå¤šä¸ªå•†å“idç”¨é€—å·è¿›è¡Œåˆ†å‰²ï¼Œå¦‚\"123,456,789\"\n        :param buy_time: ä¸‹å•æ—¶é—´ï¼Œä¾‹å¦‚ï¼š'2018-09-28 22:45:50.000'\n        :param retry: æŠ¢è´­é‡å¤æ‰§è¡Œæ¬¡æ•°ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤4æ¬¡\n        :param interval: æŠ¢è´­æ‰§è¡Œé—´éš”ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤4ç§’\n        :param num: è´­ä¹°æ•°é‡ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤1ä¸ª\n        :param fast_mode: å¿«é€Ÿæ¨¡å¼ï¼šç•¥è¿‡è®¿é—®æŠ¢è´­è®¢å•ç»“ç®—é¡µé¢è¿™ä¸€æ­¥éª¤ï¼Œé»˜è®¤ä¸º True\n        :return:\n        \"\"\"\n        items_dict = parse_sku_id(sku_ids=sku_ids)\n        logger.info('å‡†å¤‡æŠ¢è´­å•†å“:%s', list(items_dict.keys()))\n\n        t = Timer(buy_time=buy_time)\n        t.start()\n\n        for sku_id in items_dict:\n            logger.info('å¼€å§‹æŠ¢è´­å•†å“:%s', sku_id)\n            self.exec_seckill(sku_id, retry, interval, num, fast_mode)\n\n    @check_login\n    def exec_reserve_seckill_by_time(self, sku_id, buy_time, retry=4, interval=4, num=1):\n        \"\"\"å®šæ—¶æŠ¢è´­`é¢„çº¦æŠ¢è´­å•†å“`\n\n        é¢„çº¦æŠ¢è´­å•†å“ç‰¹ç‚¹ï¼š\n            1.éœ€è¦æå‰ç‚¹å‡»é¢„çº¦\n            2.å¤§éƒ¨åˆ†æ­¤ç±»å•†å“åœ¨é¢„çº¦åè‡ªåŠ¨åŠ å…¥è´­ç‰©è½¦ï¼Œåœ¨è´­ç‰©è½¦ä¸­å¯è§ä½†æ— æ³•å‹¾é€‰âœ“ï¼Œä¹Ÿæ— æ³•è¿›å…¥åˆ°ç»“ç®—é¡µé¢ï¼ˆé‡è¦ç‰¹å¾ï¼‰\n            3.åˆ°äº†æŠ¢è´­çš„æ—¶é—´ç‚¹åï¼Œæ‰èƒ½å‹¾é€‰å¹¶ç»“ç®—ä¸‹å•\n\n        æ³¨æ„ï¼š\n            1.è¯·åœ¨æŠ¢è´­å¼€å§‹å‰æ‰‹åŠ¨æ¸…ç©ºè´­ç‰©è½¦ä¸­æ­¤ç±»æ— æ³•å‹¾é€‰çš„å•†å“ï¼ï¼ˆå› ä¸ºè„šæœ¬åœ¨æ‰§è¡Œæ¸…ç©ºè´­ç‰©è½¦æ“ä½œæ—¶ï¼Œæ— æ³•æ¸…ç©ºä¸èƒ½å‹¾é€‰çš„å•†å“ï¼‰\n\n        :param sku_id: å•†å“id\n        :param buy_time: ä¸‹å•æ—¶é—´ï¼Œä¾‹å¦‚ï¼š'2018-09-28 22:45:50.000'\n        :param retry: æŠ¢è´­é‡å¤æ‰§è¡Œæ¬¡æ•°ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤4æ¬¡\n        :param interval: æŠ¢è´­æ‰§è¡Œé—´éš”ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤4ç§’\n        :param num: è´­ä¹°æ•°é‡ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤1ä¸ª\n        :return:\n        \"\"\"\n\n        t = Timer(buy_time=buy_time)\n        t.start()\n\n        self.add_item_to_cart(sku_ids={sku_id: num})\n\n        for count in range(1, retry + 1):\n            logger.info('ç¬¬[%s/%s]æ¬¡å°è¯•æäº¤è®¢å•', count, retry)\n            if self.submit_order():\n                break\n            logger.info('ä¼‘æ¯%ss', interval)\n            time.sleep(interval)\n        else:\n            logger.info('æ‰§è¡Œç»“æŸï¼Œæäº¤è®¢å•å¤±è´¥ï¼')\n\n    @check_login\n    def buy_item_in_stock(self, sku_ids, area, wait_all=False, stock_interval=3, submit_retry=3, submit_interval=5):\n        \"\"\"æ ¹æ®åº“å­˜è‡ªåŠ¨ä¸‹å•å•†å“\n        :param sku_ids: å•†å“idã€‚å¯ä»¥è®¾ç½®å¤šä¸ªå•†å“ï¼Œä¹Ÿå¯ä»¥å¸¦æ•°é‡ï¼Œå¦‚ï¼š'1234' æˆ– '1234,5678' æˆ– '1234:2' æˆ– '1234:2,5678:3'\n        :param area: åœ°åŒºid\n        :param wait_all: æ˜¯å¦ç­‰æ‰€æœ‰å•†å“éƒ½æœ‰è´§æ‰ä¸€èµ·ä¸‹å•ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤False\n        :param stock_interval: æŸ¥è¯¢åº“å­˜æ—¶é—´é—´éš”ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤3ç§’\n        :param submit_retry: æäº¤è®¢å•å¤±è´¥åé‡è¯•æ¬¡æ•°ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤3æ¬¡\n        :param submit_interval: æäº¤è®¢å•å¤±è´¥åé‡è¯•æ—¶é—´é—´éš”ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤5ç§’\n        :return:\n        \"\"\"\n        items_dict = parse_sku_id(sku_ids)\n        items_list = list(items_dict.keys())\n        area_id = parse_area_id(area=area)\n\n        if not wait_all:\n            logger.info('ä¸‹å•æ¨¡å¼ï¼š%s ä»»ä¸€å•†å“æœ‰è´§å¹¶ä¸”æœªä¸‹æ¶å‡ä¼šå°è¯•ä¸‹å•', items_list)\n            while True:\n                for (sku_id, count) in items_dict.items():\n                    if not self.if_item_can_be_ordered(sku_ids={sku_id: count}, area=area_id):\n                        logger.info('%s ä¸æ»¡è¶³ä¸‹å•æ¡ä»¶ï¼Œ%ssåè¿›è¡Œä¸‹ä¸€æ¬¡æŸ¥è¯¢', sku_id, stock_interval)\n                    else:\n                        logger.info('%s æ»¡è¶³ä¸‹å•æ¡ä»¶ï¼Œå¼€å§‹æ‰§è¡Œ', sku_id)\n                        self._cancel_select_all_cart_item()\n                        self._add_or_change_cart_item(self.get_cart_detail(), sku_id, count)\n                        if self.submit_order_with_retry(submit_retry, submit_interval):\n                            return\n\n                    time.sleep(stock_interval)\n        else:\n            logger.info('ä¸‹å•æ¨¡å¼ï¼š%s æ‰€æœ‰éƒ½å•†å“åŒæ—¶æœ‰è´§å¹¶ä¸”æœªä¸‹æ¶æ‰ä¼šå°è¯•ä¸‹å•', items_list)\n            while True:\n                if not self.if_item_can_be_ordered(sku_ids=sku_ids, area=area_id):\n                    logger.info('%s ä¸æ»¡è¶³ä¸‹å•æ¡ä»¶ï¼Œ%ssåè¿›è¡Œä¸‹ä¸€æ¬¡æŸ¥è¯¢', items_list, stock_interval)\n                else:\n                    logger.info('%s æ»¡è¶³ä¸‹å•æ¡ä»¶ï¼Œå¼€å§‹æ‰§è¡Œ', items_list)\n                    self._cancel_select_all_cart_item()\n                    shopping_cart = self.get_cart_detail()\n                    for (sku_id, count) in items_dict.items():\n                        self._add_or_change_cart_item(shopping_cart, sku_id, count)\n\n                    if self.submit_order_with_retry(submit_retry, submit_interval):\n                        return\n\n                time.sleep(stock_interval)\n"
        },
        {
          "name": "js",
          "type": "tree",
          "content": null
        },
        {
          "name": "log.py",
          "type": "blob",
          "size": 0.619140625,
          "content": "#!/usr/bin/env python\n# -*- encoding=utf8 -*-\nimport logging\nimport logging.handlers\n\nLOG_FILENAME = 'jd-assistant.log'\n\nlogger = logging.getLogger()\n\n\ndef set_logger():\n    logger.setLevel(logging.INFO)\n    formatter = logging.Formatter('%(asctime)s %(levelname)s: %(message)s')\n\n    console_handler = logging.StreamHandler()\n    console_handler.setFormatter(formatter)\n    logger.addHandler(console_handler)\n\n    file_handler = logging.handlers.RotatingFileHandler(\n        LOG_FILENAME, maxBytes=10485760, backupCount=5, encoding=\"utf-8\")\n    file_handler.setFormatter(formatter)\n    logger.addHandler(file_handler)\n\n\nset_logger()\n"
        },
        {
          "name": "main.py",
          "type": "blob",
          "size": 1.1181640625,
          "content": "#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nfrom jd_assistant import Assistant\n\nif __name__ == '__main__':\n    \"\"\"\n    é‡è¦æç¤ºï¼šæ­¤å¤„ä¸ºç¤ºä¾‹ä»£ç ä¹‹ä¸€ï¼Œè¯·ç§»æ­¥ä¸‹é¢çš„é“¾æ¥æŸ¥çœ‹ä½¿ç”¨æ•™ç¨‹ğŸ‘‡\n    https://github.com/tychxn/jd-assistant/wiki/1.-%E4%BA%AC%E4%B8%9C%E6%8A%A2%E8%B4%AD%E5%8A%A9%E6%89%8B%E7%94%A8%E6%B3%95\n    \"\"\"\n\n    sku_ids = '100001324422'  # å•†å“id\n    area = '1_72_4211'  # åŒºåŸŸid\n    asst = Assistant()  # åˆå§‹åŒ–\n    asst.login_by_QRcode()  # æ‰«ç ç™»é™†\n    asst.buy_item_in_stock(sku_ids=sku_ids, area=area, wait_all=False, stock_interval=5)  # æ ¹æ®å•†å“æ˜¯å¦æœ‰è´§è‡ªåŠ¨ä¸‹å•\n    # 6ä¸ªå‚æ•°ï¼š\n    # sku_ids: å•†å“idã€‚å¯ä»¥è®¾ç½®å¤šä¸ªå•†å“ï¼Œä¹Ÿå¯ä»¥å¸¦æ•°é‡ï¼Œå¦‚ï¼š'1234' æˆ– '1234,5678' æˆ– '1234:2' æˆ– '1234:2,5678:3'\n    # area: åœ°åŒºid\n    # wait_all: æ˜¯å¦ç­‰æ‰€æœ‰å•†å“éƒ½æœ‰è´§æ‰ä¸€èµ·ä¸‹å•ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤False\n    # stock_interval: æŸ¥è¯¢åº“å­˜æ—¶é—´é—´éš”ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤3ç§’\n    # submit_retry: æäº¤è®¢å•å¤±è´¥åé‡è¯•æ¬¡æ•°ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤3æ¬¡\n    # submit_interval: æäº¤è®¢å•å¤±è´¥åé‡è¯•æ—¶é—´é—´éš”ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤5ç§’\n"
        },
        {
          "name": "messenger.py",
          "type": "blob",
          "size": 1.26953125,
          "content": "#!/usr/bin/env python\n# -*- encoding=utf8 -*-\nimport datetime\nimport json\n\nimport requests\n\nfrom exception import AsstException\nfrom log import logger\n\n\nclass Messenger(object):\n    \"\"\"æ¶ˆæ¯æ¨é€ç±»\"\"\"\n\n    def __init__(self, sc_key):\n        if not sc_key:\n            raise AsstException('sc_key can not be empty')\n\n        self.sc_key = sc_key\n\n    def send(self, text, desp=''):\n        if not text.strip():\n            logger.error('Text of message is empty!')\n            return\n\n        now_time = str(datetime.datetime.now())\n        desp = '[{0}]'.format(now_time) if not desp else '{0} [{1}]'.format(desp, now_time)\n\n        try:\n            resp = requests.get(\n                'https://sc.ftqq.com/{}.send?text={}&desp={}'.format(self.sc_key, text, desp)\n            )\n            resp_json = json.loads(resp.text)\n            if resp_json.get('errno') == 0:\n                logger.info('Message sent successfully [text: %s, desp: %s]', text, desp)\n            else:\n                logger.error('Fail to send message, reason: %s', resp.text)\n        except requests.exceptions.RequestException as req_error:\n            logger.error('Request error: %s', req_error)\n        except Exception as e:\n            logger.error('Fail to send message [text: %s, desp: %s]: %s', text, desp, e)\n"
        },
        {
          "name": "requirements.txt",
          "type": "blob",
          "size": 0.046875,
          "content": "bs4==0.0.1\nrequests>=2.20.0\npycryptodome==3.6.6\n"
        },
        {
          "name": "timer.py",
          "type": "blob",
          "size": 0.6533203125,
          "content": "# -*- coding:utf-8 -*-\nimport time\nfrom datetime import datetime\n\nfrom log import logger\n\n\nclass Timer(object):\n\n    def __init__(self, buy_time, sleep_interval=0.5):\n\n        # '2018-09-28 22:45:50.000'\n        self.buy_time = datetime.strptime(buy_time, \"%Y-%m-%d %H:%M:%S.%f\")\n        self.sleep_interval = sleep_interval\n\n    def start(self):\n        logger.info('æ­£åœ¨ç­‰å¾…åˆ°è¾¾è®¾å®šæ—¶é—´:%s' % self.buy_time)\n        now_time = datetime.now\n        while True:\n            if now_time() >= self.buy_time:\n                logger.info('æ—¶é—´åˆ°è¾¾ï¼Œå¼€å§‹æ‰§è¡Œâ€¦â€¦')\n                break\n            else:\n                time.sleep(self.sleep_interval)\n"
        },
        {
          "name": "util.py",
          "type": "blob",
          "size": 10.9912109375,
          "content": "#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport functools\nimport json\nimport os\nimport random\nimport re\nimport warnings\nfrom base64 import b64encode\n\nimport requests\nfrom Crypto.PublicKey import RSA\nfrom Crypto.Cipher import PKCS1_v1_5 as Cipher_pkcs1_v1_5\n\nfrom log import logger\n\nRSA_PUBLIC_KEY = \"\"\"-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDC7kw8r6tq43pwApYvkJ5lalja\nN9BZb21TAIfT/vexbobzH7Q8SUdP5uDPXEBKzOjx2L28y7Xs1d9v3tdPfKI2LR7P\nAzWBmDMn8riHrDDNpUpJnlAGUqJG9ooPn8j7YNpcxCa1iybOlc2kEhmJn5uwoanQ\nq+CA6agNkqly2H4j6wIDAQAB\n-----END PUBLIC KEY-----\"\"\"\n\nDEFAULT_TIMEOUT = 10\n\nDEFAULT_USER_AGENT = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36'\n\nUSER_AGENTS = [\n    \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.1 Safari/537.36\",\n    \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2226.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.4; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2224.3 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.93 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.124 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2049.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 4.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2049.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36\",\n    \"Mozilla/5.0 (X11; OpenBSD i386) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1944.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.3319.102 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.2309.372 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.2117.157 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.47 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1866.237 Safari/537.36\",\n    \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.137 Safari/4E423F\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.116 Safari/537.36 Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B334b Safari/531.21.10\",\n    \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.517 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1664.3 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1664.3 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.16 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1623.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.17 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.62 Safari/537.36\",\n    \"Mozilla/5.0 (X11; CrOS i686 4319.74.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.57 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.2 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1468.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1467.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1464.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1500.55 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.90 Safari/537.36\",\n    \"Mozilla/5.0 (X11; NetBSD) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.116 Safari/537.36\",\n    \"Mozilla/5.0 (X11; CrOS i686 3912.101.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.116 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.60 Safari/537.17\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1309.0 Safari/537.17\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.15 (KHTML, like Gecko) Chrome/24.0.1295.0 Safari/537.15\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.14 (KHTML, like Gecko) Chrome/24.0.1292.0 Safari/537.14\"\n]\n\n\ndef encrypt_pwd(password, public_key=RSA_PUBLIC_KEY):\n    rsa_key = RSA.importKey(public_key)\n    encryptor = Cipher_pkcs1_v1_5.new(rsa_key)\n    cipher = b64encode(encryptor.encrypt(password.encode('utf-8')))\n    return cipher.decode('utf-8')\n\n\ndef encrypt_payment_pwd(payment_pwd):\n    return ''.join(['u3' + x for x in payment_pwd])\n\n\ndef response_status(resp):\n    if resp.status_code != requests.codes.OK:\n        print('Status: %u, Url: %s' % (resp.status_code, resp.url))\n        return False\n    return True\n\n\ndef open_image(image_file):\n    if os.name == \"nt\":\n        os.system('start ' + image_file)  # for Windows\n    else:\n        if os.uname()[0] == \"Linux\":\n            if \"deepin\" in os.uname()[2]:\n                os.system(\"deepin-image-viewer \" + image_file)  # for deepin\n            else:\n                os.system(\"eog \" + image_file)  # for Linux\n        else:\n            os.system(\"open \" + image_file)  # for Mac\n\n\ndef save_image(resp, image_file):\n    with open(image_file, 'wb') as f:\n        for chunk in resp.iter_content(chunk_size=1024):\n            f.write(chunk)\n\n\ndef parse_json(s):\n    begin = s.find('{')\n    end = s.rfind('}') + 1\n    return json.loads(s[begin:end])\n\n\ndef get_tag_value(tag, key='', index=0):\n    if key:\n        value = tag[index].get(key)\n    else:\n        value = tag[index].text\n    return value.strip(' \\t\\r\\n')\n\n\ndef parse_items_dict(d):\n    result = ''\n    for index, key in enumerate(d):\n        if index < len(d) - 1:\n            result = result + '{0} x {1}, '.format(key, d[key])\n        else:\n            result = result + '{0} x {1}'.format(key, d[key])\n    return result\n\n\ndef parse_sku_id(sku_ids):\n    \"\"\"å°†å•†å“idå­—ç¬¦ä¸²è§£æä¸ºå­—å…¸\n\n    å•†å“idå­—ç¬¦ä¸²é‡‡ç”¨è‹±æ–‡é€—å·è¿›è¡Œåˆ†å‰²ã€‚\n    å¯ä»¥åœ¨æ¯ä¸ªidåé¢ç”¨å†’å·åŠ ä¸Šæ•°å­—ï¼Œä»£è¡¨è¯¥å•†å“çš„æ•°é‡ï¼Œå¦‚æœä¸åŠ æ•°é‡åˆ™é»˜è®¤ä¸º1ã€‚\n\n    ä¾‹å¦‚ï¼š\n    è¾“å…¥  -->  è§£æç»“æœ\n    '123456' --> {'123456': '1'}\n    '123456,123789' --> {'123456': '1', '123789': '1'}\n    '123456:1,123789:3' --> {'123456': '1', '123789': '3'}\n    '123456:2,123789' --> {'123456': '2', '123789': '1'}\n\n    :param sku_ids: å•†å“idå­—ç¬¦ä¸²\n    :return: dict\n    \"\"\"\n    if isinstance(sku_ids, dict):  # é˜²æ­¢é‡å¤è§£æ\n        return sku_ids\n\n    sku_id_list = list(filter(bool, map(lambda x: x.strip(), sku_ids.split(','))))\n    result = dict()\n    for item in sku_id_list:\n        if ':' in item:\n            sku_id, count = map(lambda x: x.strip(), item.split(':'))\n            result[sku_id] = count\n        else:\n            result[item] = '1'\n    return result\n\n\ndef parse_area_id(area):\n    \"\"\"è§£æåœ°åŒºidå­—ç¬¦ä¸²ï¼šå°†åˆ†éš”ç¬¦æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ _\n    :param area: åœ°åŒºidå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨ _ æˆ– - è¿›è¡Œåˆ†å‰²ï¼‰ï¼Œå¦‚ 12_904_3375 æˆ– 12-904-3375\n    :return: è§£æåå­—ç¬¦ä¸²\n    \"\"\"\n    area_id_list = list(map(lambda x: x.strip(), re.split('_|-', area)))\n    area_id_list.extend((4 - len(area_id_list)) * ['0'])\n    return '_'.join(area_id_list)\n\n\ndef split_area_id(area):\n    \"\"\"å°†åœ°åŒºidå­—ç¬¦ä¸²æŒ‰ç…§ä¸‹åˆ’çº¿è¿›è¡Œåˆ‡å‰²ï¼Œæ„æˆæ•°ç»„ã€‚æ•°ç»„é•¿åº¦ä¸æ»¡4ä½åˆ™ç”¨'0'è¿›è¡Œå¡«å……ã€‚\n    :param area: åœ°åŒºidå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨ _ æˆ– - è¿›è¡Œåˆ†å‰²ï¼‰ï¼Œå¦‚ 12_904_3375 æˆ– 12-904-3375\n    :return: list\n    \"\"\"\n    area_id_list = list(map(lambda x: x.strip(), re.split('_|-', area)))\n    area_id_list.extend((4 - len(area_id_list)) * ['0'])\n    return area_id_list\n\n\ndef deprecated(func):\n    \"\"\"This decorator is used to mark functions as deprecated.\n    It will result in a warning being emitted when the function is used.\n    \"\"\"\n\n    @functools.wraps(func)\n    def new_func(*args, **kwargs):\n        warnings.simplefilter('always', DeprecationWarning)  # turn off filter\n        warnings.warn(\n            \"Call to deprecated function {}.\".format(func.__name__),\n            category=DeprecationWarning,\n            stacklevel=2\n        )\n        warnings.simplefilter('default', DeprecationWarning)  # reset filter\n        return func(*args, **kwargs)\n\n    return new_func\n\n\ndef check_login(func):\n    \"\"\"ç”¨æˆ·ç™»é™†æ€æ ¡éªŒè£…é¥°å™¨ã€‚è‹¥ç”¨æˆ·æœªç™»é™†ï¼Œåˆ™è°ƒç”¨æ‰«ç ç™»é™†\"\"\"\n\n    @functools.wraps(func)\n    def new_func(self, *args, **kwargs):\n        if not self.is_login:\n            logger.info(\"{0} éœ€ç™»é™†åè°ƒç”¨ï¼Œå¼€å§‹æ‰«ç ç™»é™†\".format(func.__name__))\n            self.login_by_QRcode()\n        return func(self, *args, **kwargs)\n\n    return new_func\n\n\ndef get_random_useragent():\n    \"\"\"ç”Ÿæˆéšæœºçš„UserAgent\n    :return: UserAgentå­—ç¬¦ä¸²\n    \"\"\"\n    return random.choice(USER_AGENTS)\n"
        }
      ]
    }
  ]
}