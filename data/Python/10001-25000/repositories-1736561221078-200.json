{
  "metadata": {
    "timestamp": 1736561221078,
    "page": 200,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjIwMA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "Zeyi-Lin/HivisionIDPhotos",
      "stars": 14171,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".devcontainer",
          "type": "tree",
          "content": null
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.384765625,
          "content": "*.pyc\n**/__pycache__/\n.idea\n.vscode/*\n.history\n.DS_Store\n.env\ndemo/kb_output/*.jpg\ndemo/kb_output/*.png\nscripts/sync_swanhub.py\nscripts/sync_huggingface.py\nscripts/sync_modelscope.py\nscripts/sync_all.py\n**/flagged/\n# build outputs\ndist\nbuild\n# checkpoint\n*.pth\n*.pt\n*.onnx\n*.mnn\ntest/temp/*\n!test/temp/.gitkeep\n\n.python-version\n\n# Ignore .png and .jpg files in the root directory\n/*.png\n/*.jpg\n"
        },
        {
          "name": ".vscode",
          "type": "tree",
          "content": null
        },
        {
          "name": "Dockerfile",
          "type": "blob",
          "size": 0.44140625,
          "content": "FROM python:3.10-slim\n\n# Install system dependencies\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    ffmpeg \\\n    libgl1-mesa-glx \\\n    libglib2.0-0 \\\n    && rm -rf /var/lib/apt/lists/*\n\nWORKDIR /app\n\nCOPY requirements.txt requirements-app.txt ./\n\nRUN pip install --no-cache-dir -r requirements.txt -r requirements-app.txt\n\nCOPY . .\n\nEXPOSE 7860\nEXPOSE 8080\n\nCMD [\"python3\", \"-u\", \"app.py\", \"--host\", \"0.0.0.0\", \"--port\", \"7860\"]"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 11.0576171875,
          "content": "Apache License\n                           Version 2.0, January 2004\n                        http://www.apache.org/licenses/\n\n   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION\n\n   1. Definitions.\n\n      \"License\" shall mean the terms and conditions for use, reproduction,\n      and distribution as defined by Sections 1 through 9 of this document.\n\n      \"Licensor\" shall mean the copyright owner or entity authorized by\n      the copyright owner that is granting the License.\n\n      \"Legal Entity\" shall mean the union of the acting entity and all\n      other entities that control, are controlled by, or are under common\n      control with that entity. For the purposes of this definition,\n      \"control\" means (i) the power, direct or indirect, to cause the\n      direction or management of such entity, whether by contract or\n      otherwise, or (ii) ownership of fifty percent (50%) or more of the\n      outstanding shares, or (iii) beneficial ownership of such entity.\n\n      \"You\" (or \"Your\") shall mean an individual or Legal Entity\n      exercising permissions granted by this License.\n\n      \"Source\" form shall mean the preferred form for making modifications,\n      including but not limited to software source code, documentation\n      source, and configuration files.\n\n      \"Object\" form shall mean any form resulting from mechanical\n      transformation or translation of a Source form, including but\n      not limited to compiled object code, generated documentation,\n      and conversions to other media types.\n\n      \"Work\" shall mean the work of authorship, whether in Source or\n      Object form, made available under the License, as indicated by a\n      copyright notice that is included in or attached to the work\n      (an example is provided in the Appendix below).\n\n      \"Derivative Works\" shall mean any work, whether in Source or Object\n      form, that is based on (or derived from) the Work and for which the\n      editorial revisions, annotations, elaborations, or other modifications\n      represent, as a whole, an original work of authorship. For the purposes\n      of this License, Derivative Works shall not include works that remain\n      separable from, or merely link (or bind by name) to the interfaces of,\n      the Work and Derivative Works thereof.\n\n      \"Contribution\" shall mean any work of authorship, including\n      the original version of the Work and any modifications or additions\n      to that Work or Derivative Works thereof, that is intentionally\n      submitted to Licensor for inclusion in the Work by the copyright owner\n      or by an individual or Legal Entity authorized to submit on behalf of\n      the copyright owner. For the purposes of this definition, \"submitted\"\n      means any form of electronic, verbal, or written communication sent\n      to the Licensor or its representatives, including but not limited to\n      communication on electronic mailing lists, source code control systems,\n      and issue tracking systems that are managed by, or on behalf of, the\n      Licensor for the purpose of discussing and improving the Work, but\n      excluding communication that is conspicuously marked or otherwise\n      designated in writing by the copyright owner as \"Not a Contribution.\"\n\n      \"Contributor\" shall mean Licensor and any individual or Legal Entity\n      on behalf of whom a Contribution has been received by Licensor and\n      subsequently incorporated within the Work.\n\n   2. Grant of Copyright License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      copyright license to reproduce, prepare Derivative Works of,\n      publicly display, publicly perform, sublicense, and distribute the\n      Work and such Derivative Works in Source or Object form.\n\n   3. Grant of Patent License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      (except as stated in this section) patent license to make, have made,\n      use, offer to sell, sell, import, and otherwise transfer the Work,\n      where such license applies only to those patent claims licensable\n      by such Contributor that are necessarily infringed by their\n      Contribution(s) alone or by combination of their Contribution(s)\n      with the Work to which such Contribution(s) was submitted. If You\n      institute patent litigation against any entity (including a\n      cross-claim or counterclaim in a lawsuit) alleging that the Work\n      or a Contribution incorporated within the Work constitutes direct\n      or contributory patent infringement, then any patent licenses\n      granted to You under this License for that Work shall terminate\n      as of the date such litigation is filed.\n\n   4. Redistribution. You may reproduce and distribute copies of the\n      Work or Derivative Works thereof in any medium, with or without\n      modifications, and in Source or Object form, provided that You\n      meet the following conditions:\n\n      (a) You must give any other recipients of the Work or\n          Derivative Works a copy of this License; and\n\n      (b) You must cause any modified files to carry prominent notices\n          stating that You changed the files; and\n\n      (c) You must retain, in the Source form of any Derivative Works\n          that You distribute, all copyright, patent, trademark, and\n          attribution notices from the Source form of the Work,\n          excluding those notices that do not pertain to any part of\n          the Derivative Works; and\n\n      (d) If the Work includes a \"NOTICE\" text file as part of its\n          distribution, then any Derivative Works that You distribute must\n          include a readable copy of the attribution notices contained\n          within such NOTICE file, excluding those notices that do not\n          pertain to any part of the Derivative Works, in at least one\n          of the following places: within a NOTICE text file distributed\n          as part of the Derivative Works; within the Source form or\n          documentation, if provided along with the Derivative Works; or,\n          within a display generated by the Derivative Works, if and\n          wherever such third-party notices normally appear. The contents\n          of the NOTICE file are for informational purposes only and\n          do not modify the License. You may add Your own attribution\n          notices within Derivative Works that You distribute, alongside\n          or as an addendum to the NOTICE text from the Work, provided\n          that such additional attribution notices cannot be construed\n          as modifying the License.\n\n      You may add Your own copyright statement to Your modifications and\n      may provide additional or different license terms and conditions\n      for use, reproduction, or distribution of Your modifications, or\n      for any such Derivative Works as a whole, provided Your use,\n      reproduction, and distribution of the Work otherwise complies with\n      the conditions stated in this License.\n\n   5. Submission of Contributions. Unless You explicitly state otherwise,\n      any Contribution intentionally submitted for inclusion in the Work\n      by You to the Licensor shall be under the terms and conditions of\n      this License, without any additional terms or conditions.\n      Notwithstanding the above, nothing herein shall supersede or modify\n      the terms of any separate license agreement you may have executed\n      with Licensor regarding such Contributions.\n\n   6. Trademarks. This License does not grant permission to use the trade\n      names, trademarks, service marks, or product names of the Licensor,\n      except as required for reasonable and customary use in describing the\n      origin of the Work and reproducing the content of the NOTICE file.\n\n   7. Disclaimer of Warranty. Unless required by applicable law or\n      agreed to in writing, Licensor provides the Work (and each\n      Contributor provides its Contributions) on an \"AS IS\" BASIS,\n      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n      implied, including, without limitation, any warranties or conditions\n      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A\n      PARTICULAR PURPOSE. You are solely responsible for determining the\n      appropriateness of using or redistributing the Work and assume any\n      risks associated with Your exercise of permissions under this License.\n\n   8. Limitation of Liability. In no event and under no legal theory,\n      whether in tort (including negligence), contract, or otherwise,\n      unless required by applicable law (such as deliberate and grossly\n      negligent acts) or agreed to in writing, shall any Contributor be\n      liable to You for damages, including any direct, indirect, special,\n      incidental, or consequential damages of any character arising as a\n      result of this License or out of the use or inability to use the\n      Work (including but not limited to damages for loss of goodwill,\n      work stoppage, computer failure or malfunction, or any and all\n      other commercial damages or losses), even if such Contributor\n      has been advised of the possibility of such damages.\n\n   9. Accepting Warranty or Additional Liability. While redistributing\n      the Work or Derivative Works thereof, You may choose to offer,\n      and charge a fee for, acceptance of support, warranty, indemnity,\n      or other liability obligations and/or rights consistent with this\n      License. However, in accepting such obligations, You may act only\n      on Your own behalf and on Your sole responsibility, not on behalf\n      of any other Contributor, and only if You agree to indemnify,\n      defend, and hold each Contributor harmless for any liability\n      incurred by, or claims asserted against, such Contributor by reason\n      of your accepting any such warranty or additional liability.\n\n   END OF TERMS AND CONDITIONS\n\n   APPENDIX: How to apply the Apache License to your work.\n\n      To apply the Apache License to your work, attach the following\n      boilerplate notice, with the fields enclosed by brackets \"[]\"\n      replaced with your own identifying information. (Don't include\n      the brackets!)  The text should be enclosed in the appropriate\n      comment syntax for the file format. We also recommend that a\n      file or class name and description of purpose be included on the\n      same \"printed page\" as the copyright notice for easier\n      identification within third-party archives.\n\n   Copyright [yyyy] [name of copyright owner]\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License."
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 23.083984375,
          "content": "<div align=\"center\">\n\n<img alt=\"hivision_logo\" src=\"assets/hivision_logo.png\" width=120 height=120>\n<h1>HivisionIDPhoto</h1>\n\n[English](README_EN.md) / 中文 / [日本語](README_JP.md) / [한국어](README_KO.md)\n\n[![][release-shield]][release-link]\n[![][dockerhub-shield]][dockerhub-link]\n[![][github-stars-shield]][github-stars-link]\n[![][github-issues-shield]][github-issues-link]\n[![][github-contributors-shield]][github-contributors-link]\n[![][github-forks-shield]][github-forks-link]\n[![][license-shield]][license-link]  \n[![][wechat-shield]][wechat-link]\n[![][spaces-shield]][spaces-link]\n[![][swanhub-demo-shield]][swanhub-demo-link]\n[![][modelscope-shield]][modelscope-link]\n[![][modelers-shield]][modelers-link]\n\n[![][trendshift-shield]][trendshift-link]\n[![][hellogithub-shield]][hellogithub-link]\n\n<img src=\"assets/demoImage.jpg\" width=900>\n\n</div>\n\n> **相关项目**：\n>\n> - [SwanLab](https://github.com/SwanHubX/SwanLab)：训练人像抠图模型全程用它来分析和监控，以及和实验室同学协作交流，大幅提升了训练效率。\n\n\n<br>\n\n# 目录\n\n- [最近更新](#-最近更新)\n- [项目简介](#-项目简介)\n- [社区](#-社区)\n- [准备工作](#-准备工作)\n- [Demo启动](#-运行-gradio-demo)\n- [Python推理](#-python-推理)\n- [API服务部署](#️-部署-api-服务)\n- [Docker部署](#-docker-部署)\n- [联系我们](#-联系我们)\n- [FAQ](#faq)\n- [感谢支持](#-感谢支持)\n- [License](#-lincese)\n- [引用](#-引用)\n\n<br>\n\n# 🤩 最近更新\n\n- 在线体验： [![SwanHub Demo](https://img.shields.io/static/v1?label=Demo&message=SwanHub%20Demo&color=blue)](https://swanhub.co/ZeYiLin/HivisionIDPhotos/demo)、[![Spaces](https://img.shields.io/badge/🤗-Open%20in%20Spaces-blue)](https://huggingface.co/spaces/TheEeeeLin/HivisionIDPhotos)、[![][modelscope-shield]][modelscope-link]\n\n- 2024.11.20: Gradio Demo增加**打印排版**选项卡，支持六寸、五寸、A4、3R、4R五种排版尺寸\n- 2024.11.16: API接口增加美颜参数\n- 2024.09.25: 增加**五寸相纸**和**JPEG下载**选项｜默认照片下载支持300DPI\n- 2024.09.24: API接口增加base64图像传入选项 | Gradio Demo增加**排版照裁剪线**功能\n- 2024.09.22: Gradio Demo增加**野兽模式**，可设置内存加载策略 | API接口增加**dpi、face_alignment**参数\n- 2024.09.18: Gradio Demo增加**分享模版照**功能、增加**美式证件照**背景选项\n- 2024.09.17: Gradio Demo增加**自定义底色-HEX输入**功能 | **（社区贡献）C++版本** - [HivisionIDPhotos-cpp](https://github.com/zjkhahah/HivisionIDPhotos-cpp) 贡献 by [zjkhahah](https://github.com/zjkhahah)\n- 2024.09.16: Gradio Demo增加**人脸旋转对齐**功能，自定义尺寸输入支持**毫米**单位\n\n<br>\n\n# 项目简介\n\n> 🚀 谢谢你对我们的工作感兴趣。您可能还想查看我们在图像领域的其他成果，欢迎来信:zeyi.lin@swanhub.co.\n\nHivisionIDPhoto 旨在开发一种实用、系统性的证件照智能制作算法。\n\n它利用一套完善的AI模型工作流程，实现对多种用户拍照场景的识别、抠图与证件照生成。\n\n**HivisionIDPhoto 可以做到：**\n\n1. 轻量级抠图（纯离线，仅需 **CPU** 即可快速推理）\n2. 根据不同尺寸规格生成不同的标准证件照、六寸排版照\n3. 支持 纯离线 或 端云 推理\n4. 美颜\n5. 智能换正装（waiting）\n\n<div align=\"center\">\n<img src=\"assets/demo.png\" width=900>\n</div>\n\n---\n\n如果 HivisionIDPhoto 对你有帮助，请 star 这个 repo 或推荐给你的朋友，解决证件照应急制作问题！\n\n<br>\n\n# 🏠 社区\n\n我们分享了一些由社区构建的HivisionIDPhotos的有趣应用和扩展：\n\n| [HivisionIDPhotos-ComfyUI][community-hivision-comfyui] | [HivisionIDPhotos-wechat-weapp][community-hivision-wechat] |\n| :----------------------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------: |\n| <a href=\"https://github.com/AIFSH/HivisionIDPhotos-ComfyUI\"> <img src=\"assets/comfyui.png\" width=\"900\" alt=\"ComfyUI workflow\"> </a>  | <a href=\"https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp\"> <img src=\"assets/community-wechat-miniprogram.png\" width=\"900\" alt=\"ComfyUI workflow\"> </a>  |\n|ComfyUI证件照处理工作流 | 证件照微信小程序（JAVA后端+原生前端） |\n\n| [HivisionIDPhotos-Uniapp][community-hivision-uniapp] | [HivisionIDPhotos-web](https://github.com/jkm199/HivisionIDPhotos-web)|\n| :------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------: |\n| <a href=\"https://github.com/soulerror/HivisionIDPhotos-Uniapp\"> <img src=\"assets/community-uniapp-wechat-miniprogram.png\" width=\"900\" alt=\"HivisionIDPhotos-uniapp\"> </a>  | <a href=\"https://github.com/jkm199/HivisionIDPhotos-web\"> <img src=\"assets/community-web.png\" width=\"900\" alt=\"HivisionIDPhotos-uniapp\"> </a>  |\n| 证件照微信小程序（uniapp）| 证件照应用网页版 |\n\n\n- [HivisionIDPhotos-cpp](https://github.com/zjkhahah/HivisionIDPhotos-cpp): HivisionIDphotos C++版本，由 [zjkhahah](https://github.com/zjkhahah) 构建\n- [ai-idphoto](https://github.com/wmlcjj/ai-idphoto): [HivisionIDPhotos-wechat-weapp](https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp) 的uniapp多端兼容版，由 [wmlcjj](https://github.com/wmlcjj) 贡献\n- [HivisionIDPhotos-uniapp-WeChat-gpto1](https://github.com/jkm199/HivisionIDPhotos-uniapp-WeChat-gpto1/): 由gpt-o1辅助完成开发的证件照微信小程序，由 [jkm199](https://github.com/jkm199) 贡献\n- [HivisionIDPhotos-windows-GUI](https://github.com/zhaoyun0071/HivisionIDPhotos-windows-GUI)：Windows客户端应用，由 [zhaoyun0071](https://github.com/zhaoyun0071) 构建\n- [HivisionIDPhotos-NAS](https://github.com/ONG-Leo/HivisionIDPhotos-NAS): 群晖NAS部署中文教程，由 [ONG-Leo](https://github.com/ONG-Leo) 贡献\n\n\n<br>\n\n# 🔧 准备工作\n\n环境安装与依赖：\n- Python >= 3.7（项目主要测试在 python 3.10）\n- OS: Linux, Windows, MacOS\n\n## 1. 克隆项目\n\n```bash\ngit clone https://github.com/Zeyi-Lin/HivisionIDPhotos.git\ncd  HivisionIDPhotos\n```\n\n## 2. 安装依赖环境\n\n> 建议 conda 创建一个 python3.10 虚拟环境后，执行以下命令\n\n```bash\npip install -r requirements.txt\npip install -r requirements-app.txt\n```\n\n## 3. 下载人像抠图模型权重文件\n\n**方式一：脚本下载**\n\n```bash\npython scripts/download_model.py --models all\n# 如需指定下载某个模型\n# python scripts/download_model.py --models modnet_photographic_portrait_matting\n```\n\n**方式二：直接下载**\n\n模型均存到项目的`hivision/creator/weights`目录下：\n\n| 人像抠图模型 | 介绍 | 下载 |\n| -- | -- | -- |\n| MODNet | [MODNet](https://github.com/ZHKKKe/MODNet)官方权重 | [下载](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/modnet_photographic_portrait_matting.onnx)(24.7MB)|\n| hivision_modnet | 对纯色换底适配性更好的抠图模型 | [下载](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/hivision_modnet.onnx)(24.7MB) |\n| rmbg-1.4 | [BRIA AI](https://huggingface.co/briaai/RMBG-1.4) 开源的抠图模型 | [下载](https://huggingface.co/briaai/RMBG-1.4/resolve/main/onnx/model.onnx?download=true)(176.2MB)后重命名为`rmbg-1.4.onnx` |\n| birefnet-v1-lite | [ZhengPeng7](https://github.com/ZhengPeng7/BiRefNet) 开源的抠图模型，拥有最好的分割精度 | [下载](https://github.com/ZhengPeng7/BiRefNet/releases/download/v1/BiRefNet-general-bb_swin_v1_tiny-epoch_232.onnx)(224MB)后重命名为`birefnet-v1-lite.onnx` |\n\n> 如果下载网速不顺利：前往[SwanHub](https://swanhub.co/ZeYiLin/HivisionIDPhotos_models/tree/main)下载。\n\n\n## 4. 人脸检测模型配置（可选）\n\n| 拓展人脸检测模型 | 介绍 | 使用文档 |\n| -- | -- | -- |\n| MTCNN | **离线**人脸检测模型，高性能CPU推理（毫秒级），为默认模型，检测精度较低 | Clone此项目后直接使用 |\n| RetinaFace | **离线**人脸检测模型，CPU推理速度中等（秒级），精度较高| [下载](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/retinaface-resnet50.onnx)后放到`hivision/creator/retinaface/weights`目录下 |\n| Face++ | 旷视推出的在线人脸检测API，检测精度较高，[官方文档](https://console.faceplusplus.com.cn/documents/4888373) | [使用文档](docs/face++_CN.md)|\n\n## 5. 性能参考\n\n> 测试环境为Mac M1 Max 64GB，非GPU加速，测试图片分辨率为 512x715(1) 与 764×1146(2)。\n\n| 模型组合 | 内存占用 | 推理时长(1) | 推理时长(2) |\n| -- | -- | -- | -- |\n| MODNet + mtcnn | 410MB | 0.207s | 0.246s |\n| MODNet + retinaface | 405MB | 0.571s | 0.971s |\n| birefnet-v1-lite + retinaface | 6.20GB | 7.063s | 7.128s |\n\n## 6. GPU推理加速（可选）\n\n在当前版本，可被英伟达GPU加速的模型为`birefnet-v1-lite`，并请确保你有16GB左右的显存。\n\n如需使用英伟达GPU加速推理，在确保你已经安装[CUDA](https://developer.nvidia.com/cuda-downloads)与[cuDNN](https://developer.nvidia.com/cudnn)后，根据[onnxruntime-gpu文档](https://onnxruntime.ai/docs/execution-providers/CUDA-ExecutionProvider.html#cuda-12x)找到对应的`onnxruntime-gpu`版本安装，以及根据[pytorch官网](https://pytorch.org/get-started/locally/)找到对应的`torch`版本安装。\n\n```bash\n# 假如你的电脑安装的是CUDA 12.x, cuDNN 8\n# 安装torch是可选的，如果你始终配置不好cuDNN，那么试试安装torch\npip install onnxruntime-gpu==1.18.0\npip install torch --index-url https://download.pytorch.org/whl/cu121\n```\n\n完成安装后，调用`birefnet-v1-lite`模型即可利用GPU加速推理。\n\n> TIPS: CUDA 支持向下兼容。比如你的 CUDA 版本为 12.6，`torch` 官方目前支持的最高版本为 12.4（<12.6），`torch`仍可以正常使用CUDA。\n\n<br>\n\n# ⚡️ 运行 Gradio Demo\n\n```bash\npython app.py\n```\n\n运行程序将生成一个本地 Web 页面，在页面中可完成证件照的操作与交互。\n\n<img src=\"assets/harry.png\" width=900>\n\n<br>\n\n# 🚀 Python 推理\n\n核心参数：\n\n- `-i`: 输入图像路径\n- `-o`: 保存图像路径\n- `-t`: 推理类型，有idphoto、human_matting、add_background、generate_layout_photos可选\n- `--matting_model`: 人像抠图模型权重选择\n- `--face_detect_model`: 人脸检测模型选择\n\n更多参数可通过`python inference.py --help`查看\n\n## 1. 证件照制作\n\n输入 1 张照片，获得 1 张标准证件照和 1 张高清证件照的 4 通道透明 png\n\n```python\npython inference.py -i demo/images/test0.jpg -o ./idphoto.png --height 413 --width 295\n```\n\n## 2. 人像抠图\n\n输入 1 张照片，获得 1张 4 通道透明 png\n\n```python\npython inference.py -t human_matting -i demo/images/test0.jpg -o ./idphoto_matting.png --matting_model hivision_modnet\n```\n\n## 3. 透明图增加底色\n\n输入 1 张 4 通道透明 png，获得 1 张增加了底色的 3通道图像\n\n```python\npython inference.py -t add_background -i ./idphoto.png -o ./idphoto_ab.jpg  -c 4f83ce -k 30 -r 1\n```\n\n## 4. 得到六寸排版照\n\n输入 1 张 3 通道照片，获得 1 张六寸排版照\n\n```python\npython inference.py -t generate_layout_photos -i ./idphoto_ab.jpg -o ./idphoto_layout.jpg  --height 413 --width 295 -k 200\n```\n\n## 5. 证件照裁剪\n\n输入 1 张 4 通道照片（抠图好的图像），获得 1 张标准证件照和 1 张高清证件照的 4 通道透明 png\n\n```python\npython inference.py -t idphoto_crop -i ./idphoto_matting.png -o ./idphoto_crop.png --height 413 --width 295\n```\n\n\n<br>\n\n# ⚡️ 部署 API 服务\n\n## 启动后端\n\n```\npython deploy_api.py\n```\n\n## 请求 API 服务\n\n详细请求方式请参考 [API 文档](docs/api_CN.md)，包含以下请求示例：\n- [cURL](docs/api_CN.md#curl-请求示例)\n- [Python](docs/api_CN.md#python-请求示例)\n\n<br>\n\n# 🐳 Docker 部署\n\n## 1. 拉取或构建镜像\n\n> 以下方式三选一\n\n**方式一：拉取最新镜像：**\n\n```bash\ndocker pull linzeyi/hivision_idphotos\n```\n\n**方式二：Dockrfile 直接构建镜像：**\n\n在确保将至少一个[抠图模型权重文件](#3-下载权重文件)放到`hivision/creator/weights`下后，在项目根目录执行：\n\n```bash\ndocker build -t linzeyi/hivision_idphotos .\n```\n\n**方式三：Docker compose 构建：**\n\n在确保将至少一个[抠图模型权重文件](#3-下载权重文件)放到`hivision/creator/weights`下后，在项目根目录下执行：\n\n```bash\ndocker compose build\n```\n\n## 2. 运行服务\n\n**启动 Gradio Demo 服务**\n\n运行下面的命令，在你的本地访问 [http://127.0.0.1:7860](http://127.0.0.1:7860/) 即可使用。\n\n```bash\ndocker run -d -p 7860:7860 linzeyi/hivision_idphotos\n```\n\n**启动 API 后端服务**\n\n```bash\ndocker run -d -p 8080:8080 linzeyi/hivision_idphotos python3 deploy_api.py\n```\n\n**两个服务同时启动**\n\n```bash\ndocker compose up -d\n```\n\n## 环境变量\n\n本项目提供了一些额外的配置项，使用环境变量进行设置：\n\n| 环境变量 | 类型\t| 描述 | 示例 |\n|--|--|--|--|\n| FACE_PLUS_API_KEY\t | 可选\t| 这是你在 Face++ 控制台申请的 API 密钥\t | `7-fZStDJ····` |\n| FACE_PLUS_API_SECRET\t | 可选\t| Face++ API密钥对应的Secret | `VTee824E····` |\n| RUN_MODE | 可选 | 运行模式，可选值为`beast`(野兽模式)。野兽模式下人脸检测和抠图模型将不释放内存，从而获得更快的二次推理速度。建议内存16GB以上尝试。 | `beast` |\n| DEFAULT_LANG | 可选 | Gradio Demo启动时的默认语言| `en` |\n\ndocker使用环境变量示例：\n```bash\ndocker run  -d -p 7860:7860 \\\n    -e FACE_PLUS_API_KEY=7-fZStDJ···· \\\n    -e FACE_PLUS_API_SECRET=VTee824E···· \\\n    -e RUN_MODE=beast \\\n    -e DEFAULT_LANG=en \\\n    linzeyi/hivision_idphotos  \n```\n\n<br>\n\n# FAQ\n\n## 1. 如何修改预设尺寸和颜色？\n\n- 尺寸：修改[size_list_CN.csv](demo/assets/size_list_CN.csv)后再次运行 `app.py` 即可，其中第一列为尺寸名，第二列为高度，第三列为宽度。\n- 颜色：修改[color_list_CN.csv](demo/assets/color_list_CN.csv)后再次运行 `app.py` 即可，其中第一列为颜色名，第二列为Hex值。\n\n## 2. 如何修改水印字体？\n\n1. 将字体文件放到`hivision/plugin/font`文件夹下\n2. 修改`hivision/plugin/watermark.py`的`font_file`参数值为字体文件名\n\n## 3. 如何添加社交媒体模板照？\n\n1. 将模板图片放到`hivision/plugin/template/assets`文件夹下。模板图片是一个4通道的透明png。\n2. 在`hivision/plugin/template/assets/template_config.json`文件中添加最新的模板信息，其中`width`为模板图宽度(px)，`height`为模板图高度(px)，`anchor_points`为模板中透明区域的四个角的坐标(px)；`rotation`为透明区域相对于垂直方向的旋转角度，>0为逆时针，<0为顺时针。\n3. 在`demo/processor.py`的`_generate_image_template`函数中的`TEMPLATE_NAME_LIST`变量添加最新的模板名\n\n<img src=\"assets/social_template.png\" width=\"500\">\n\n## 4. 如何修改Gradio Demo的顶部导航栏？\n\n- 修改`demo/assets/title.md`\n\n<br>\n\n# 📧 联系我们\n\n如果您有任何问题，请发邮件至 zeyi.lin@swanhub.co\n\n<br>\n\n# 🙏 感谢支持\n\n[![Stargazers repo roster for @Zeyi-Lin/HivisionIDPhotos](https://reporoster.com/stars/Zeyi-Lin/HivisionIDPhotos)](https://github.com/Zeyi-Lin/HivisionIDPhotos/stargazers)\n\n[![Forkers repo roster for @Zeyi-Lin/HivisionIDPhotos](https://reporoster.com/forks/Zeyi-Lin/HivisionIDPhotos)](https://github.com/Zeyi-Lin/HivisionIDPhotos/network/members)\n\n[![Star History Chart](https://api.star-history.com/svg?repos=Zeyi-Lin/HivisionIDPhotos&type=Date)](https://star-history.com/#Zeyi-Lin/HivisionIDPhotos&Date)\n\n贡献者们：\n\n<a href=\"https://github.com/Zeyi-Lin/HivisionIDPhotos/graphs/contributors\">\n  <img src=\"https://contrib.rocks/image?repo=Zeyi-Lin/HivisionIDPhotos\" />\n</a>\n\n[Zeyi-Lin](https://github.com/Zeyi-Lin)、[SAKURA-CAT](https://github.com/SAKURA-CAT)、[Feudalman](https://github.com/Feudalman)、[swpfY](https://github.com/swpfY)、[Kaikaikaifang](https://github.com/Kaikaikaifang)、[ShaohonChen](https://github.com/ShaohonChen)、[KashiwaByte](https://github.com/KashiwaByte)\n\n<br>\n\n# 📜 Lincese\n\nThis repository is licensed under the [Apache-2.0 License](LICENSE).\n\n<br>\n\n# 📚 引用\n\n如果您在研究或项目中使用了HivisionIDPhotos，请考虑引用我们的工作。您可以使用以下BibTeX条目：\n\n```bibtex\n@misc{hivisionidphotos,\n      title={{HivisionIDPhotos: A Lightweight and Efficient AI ID Photos Tool}},\n      author={Zeyi Lin and SwanLab Team},\n      year={2024},\n      publisher={GitHub},\n      url = {\\url{https://github.com/Zeyi-Lin/HivisionIDPhotos}},\n}\n```\n\n\n\n\n[github-stars-shield]: https://img.shields.io/github/stars/zeyi-lin/hivisionidphotos?color=ffcb47&labelColor=black&style=flat-square\n[github-stars-link]: https://github.com/zeyi-lin/hivisionidphotos/stargazers\n\n[swanhub-demo-shield]: https://swanhub.co/git/repo/SwanHub%2FAuto-README/file/preview?ref=main&path=swanhub.svg\n[swanhub-demo-link]: https://swanhub.co/ZeYiLin/HivisionIDPhotos/demo\n\n[spaces-shield]: https://img.shields.io/badge/🤗-Open%20in%20Spaces-blue\n[spaces-link]: https://huggingface.co/spaces/TheEeeeLin/HivisionIDPhotos\n\n<!-- 微信群链接 -->\n[wechat-shield]: https://img.shields.io/badge/WeChat-微信-4cb55e\n[wechat-link]: https://docs.qq.com/doc/DUkpBdk90eWZFS2JW\n\n<!-- Github Release -->\n[release-shield]: https://img.shields.io/github/v/release/zeyi-lin/hivisionidphotos?color=369eff&labelColor=black&logo=github&style=flat-square\n[release-link]: https://github.com/zeyi-lin/hivisionidphotos/releases\n\n[license-shield]: https://img.shields.io/badge/license-apache%202.0-white?labelColor=black&style=flat-square\n[license-link]: https://github.com/Zeyi-Lin/HivisionIDPhotos/blob/master/LICENSE\n\n[github-issues-shield]: https://img.shields.io/github/issues/zeyi-lin/hivisionidphotos?color=ff80eb&labelColor=black&style=flat-square\n[github-issues-link]: https://github.com/zeyi-lin/hivisionidphotos/issues\n\n[dockerhub-shield]: https://img.shields.io/docker/v/linzeyi/hivision_idphotos?color=369eff&label=docker&labelColor=black&logoColor=white&style=flat-square\n[dockerhub-link]: https://hub.docker.com/r/linzeyi/hivision_idphotos/tags\n\n[trendshift-shield]: https://trendshift.io/api/badge/repositories/11622\n[trendshift-link]: https://trendshift.io/repositories/11622\n\n[hellogithub-shield]: https://abroad.hellogithub.com/v1/widgets/recommend.svg?rid=8ea1457289fb4062ba661e5299e733d6&claim_uid=Oh5UaGjfrblg0yZ\n[hellogithub-link]: https://hellogithub.com/repository/8ea1457289fb4062ba661e5299e733d6\n\n[github-contributors-shield]: https://img.shields.io/github/contributors/zeyi-lin/hivisionidphotos?color=c4f042&labelColor=black&style=flat-square\n[github-contributors-link]: https://github.com/zeyi-lin/hivisionidphotos/graphs/contributors\n\n[github-forks-shield]: https://img.shields.io/github/forks/zeyi-lin/hivisionidphotos?color=8ae8ff&labelColor=black&style=flat-square\n[github-forks-link]: https://github.com/zeyi-lin/hivisionidphotos/network/members\n\n[modelscope-shield]: https://img.shields.io/badge/Demo_on_ModelScope-purple?logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIzIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCiA8Zz4KICA8dGl0bGU+TGF5ZXIgMTwvdGl0bGU+CiAgPHBhdGggaWQ9InN2Z18xNCIgZmlsbD0iIzYyNGFmZiIgZD0ibTAsODkuODRsMjUuNjUsMGwwLDI1LjY0OTk5bC0yNS42NSwwbDAsLTI1LjY0OTk5eiIvPgogIDxwYXRoIGlkPSJzdmdfMTUiIGZpbGw9IiM2MjRhZmYiIGQ9Im05OS4xNCwxMTUuNDlsMjUuNjUsMGwwLDI1LjY1bC0yNS42NSwwbDAsLTI1LjY1eiIvPgogIDxwYXRoIGlkPSJzdmdfMTYiIGZpbGw9IiM2MjRhZmYiIGQ9Im0xNzYuMDksMTQxLjE0bC0yNS42NDk5OSwwbDAsMjIuMTlsNDcuODQsMGwwLC00Ny44NGwtMjIuMTksMGwwLDI1LjY1eiIvPgogIDxwYXRoIGlkPSJzdmdfMTciIGZpbGw9IiMzNmNmZDEiIGQ9Im0xMjQuNzksODkuODRsMjUuNjUsMGwwLDI1LjY0OTk5bC0yNS42NSwwbDAsLTI1LjY0OTk5eiIvPgogIDxwYXRoIGlkPSJzdmdfMTgiIGZpbGw9IiMzNmNmZDEiIGQ9Im0wLDY0LjE5bDI1LjY1LDBsMCwyNS42NWwtMjUuNjUsMGwwLC0yNS42NXoiLz4KICA8cGF0aCBpZD0ic3ZnXzE5IiBmaWxsPSIjNjI0YWZmIiBkPSJtMTk4LjI4LDg5Ljg0bDI1LjY0OTk5LDBsMCwyNS42NDk5OWwtMjUuNjQ5OTksMGwwLC0yNS42NDk5OXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIwIiBmaWxsPSIjMzZjZmQxIiBkPSJtMTk4LjI4LDY0LjE5bDI1LjY0OTk5LDBsMCwyNS42NWwtMjUuNjQ5OTksMGwwLC0yNS42NXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIxIiBmaWxsPSIjNjI0YWZmIiBkPSJtMTUwLjQ0LDQybDAsMjIuMTlsMjUuNjQ5OTksMGwwLDI1LjY1bDIyLjE5LDBsMCwtNDcuODRsLTQ3Ljg0LDB6Ii8+CiAgPHBhdGggaWQ9InN2Z18yMiIgZmlsbD0iIzM2Y2ZkMSIgZD0ibTczLjQ5LDg5Ljg0bDI1LjY1LDBsMCwyNS42NDk5OWwtMjUuNjUsMGwwLC0yNS42NDk5OXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIzIiBmaWxsPSIjNjI0YWZmIiBkPSJtNDcuODQsNjQuMTlsMjUuNjUsMGwwLC0yMi4xOWwtNDcuODQsMGwwLDQ3Ljg0bDIyLjE5LDBsMCwtMjUuNjV6Ii8+CiAgPHBhdGggaWQ9InN2Z18yNCIgZmlsbD0iIzYyNGFmZiIgZD0ibTQ3Ljg0LDExNS40OWwtMjIuMTksMGwwLDQ3Ljg0bDQ3Ljg0LDBsMCwtMjIuMTlsLTI1LjY1LDBsMCwtMjUuNjV6Ii8+CiA8L2c+Cjwvc3ZnPg==&labelColor=white\n[modelscope-link]: https://modelscope.cn/studios/SwanLab/HivisionIDPhotos\n\n[modelers-shield]: https://img.shields.io/badge/Demo_on_Modelers-c42a2a?logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCAxMjQgNjQiIGZpbGw9Im5vbmUiPgo8cGF0aCBkPSJNNDIuNzc4MyAwSDI2LjU5NzdWMTUuNzc4N0g0Mi43NzgzVjBaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0xNi41MDg4IDQuMTc5MkgwLjMyODEyNVYxOS45NTc5SDE2LjUwODhWNC4xNzkyWiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTIzLjk1MiA0LjE3OTJIMTA3Ljc3MVYxOS45NTc5SDEyMy45NTJWNC4xNzkyWiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTYuNTA4OCA0NS40NjE5SDAuMzI4MTI1VjYxLjI0MDZIMTYuNTA4OFY0NS40NjE5WiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTIzLjk1MiA0NS40NjE5SDEwNy43NzFWNjEuMjQwNkgxMjMuOTUyVjQ1LjQ2MTlaIiBmaWxsPSIjMjQ0OTlDIi8+CjxwYXRoIGQ9Ik0zMi43MDggMTUuNzc4OEgxNi41MjczVjMxLjU1NzVIMzIuNzA4VjE1Ljc3ODhaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik01Mi44NDg2IDE1Ljc3ODhIMzYuNjY4VjMxLjU1NzVINTIuODQ4NlYxNS43Nzg4WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNOTcuNzIzNyAwSDgxLjU0M1YxNS43Nzg3SDk3LjcyMzdWMFoiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTg3LjY1MzQgMTUuNzc4OEg3MS40NzI3VjMxLjU1NzVIODcuNjUzNFYxNS43Nzg4WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNMTA3Ljc5NCAxNS43Nzg4SDkxLjYxMzNWMzEuNTU3NUgxMDcuNzk0VjE1Ljc3ODhaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0yNC42NzQ4IDMxLjU1NzZIOC40OTQxNFY0Ny4zMzYzSDI0LjY3NDhWMzEuNTU3NloiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTYwLjg3OTkgMzEuNTU3Nkg0NC42OTkyVjQ3LjMzNjNINjAuODc5OVYzMS41NTc2WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNNzkuNjIwMSAzMS41NTc2SDYzLjQzOTVWNDcuMzM2M0g3OS42MjAxVjMxLjU1NzZaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0xMTUuODI1IDMxLjU1NzZIOTkuNjQ0NVY0Ny4zMzYzSDExNS44MjVWMzEuNTU3NloiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTcwLjI1NDkgNDcuMzM1OUg1NC4wNzQyVjYzLjExNDdINzAuMjU0OVY0Ny4zMzU5WiIgZmlsbD0iI0RFMDQyOSIvPgo8L3N2Zz4=&labelColor=white\n[modelers-link]: https://modelers.cn/spaces/SwanLab/HivisionIDPhotos\n\n\n\n<!-- 社区项目链接 -->\n[community-hivision-comfyui]: https://github.com/AIFSH/HivisionIDPhotos-ComfyUI\n[community-hivision-wechat]: https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp\n[community-hivision-uniapp]: https://github.com/soulerror/HivisionIDPhotos-Uniapp\n[community-hivision-cpp]: https://github.com/zjkhahah/HivisionIDPhotos-cpp\n[community-hivision-windows-gui]: https://github.com/zhaoyun0071/HivisionIDPhotos-windows-GUI\n[community-hivision-nas]: https://github.com/ONG-Leo/HivisionIDPhotos-NAS"
        },
        {
          "name": "README_EN.md",
          "type": "blob",
          "size": 22.7275390625,
          "content": "<div align=\"center\">\n\n<img alt=\"hivision_logo\" src=\"assets/hivision_logo.png\" width=120 height=120>\n<h1>HivisionIDPhoto</h1>\n\nEnglish / [中文](README.md) / [日本語](README_JP.md) / [한국어](README_KO.md)\n\n[![][release-shield]][release-link]\n[![][dockerhub-shield]][dockerhub-link]\n[![][github-stars-shield]][github-stars-link]\n[![][github-issues-shield]][github-issues-link]\n[![][github-contributors-shield]][github-contributors-link]\n[![][github-forks-shield]][github-forks-link]\n[![][license-shield]][license-link]  \n[![][wechat-shield]][wechat-link]\n[![][spaces-shield]][spaces-link]\n[![][swanhub-demo-shield]][swanhub-demo-link]\n[![][modelscope-shield]][modelscope-link]\n[![][modelers-shield]][modelers-link]\n\n[![][trendshift-shield]][trendshift-link]\n[![][hellogithub-shield]][hellogithub-link]\n\n<img src=\"assets/demoImage.jpg\" width=900>\n\n</div>\n\n<br>\n\n> **Related Projects**：\n>\n> - [SwanLab](https://github.com/SwanHubX/SwanLab): Used throughout the training of the portrait matting model for analysis and monitoring, as well as collaboration with lab colleagues, significantly improving training efficiency.\n\n<br>\n\n# Table of Contents\n\n- [Recent Updates](#-recent-updates)\n- [Project Overview](#-project-overview)\n- [Community](#-community)\n- [Preparation](#-preparation)\n- [Demo Startup](#-run-gradio-demo)\n- [Python Inference](#-python-inference)\n- [API Service Deployment](#️-deploy-api-service)\n- [Docker Deployment](#-docker-deployment)\n- [Contact Us](#-contact-us)\n- [Q&A](#qa)\n- [Contributors](#contributors)\n- [Thanks for support](#thanks-for-support)\n- [License](#lincese)\n\n<br>\n\n# 🤩 Recent Updates\n\n- Online Experience: [![SwanHub Demo](https://img.shields.io/static/v1?label=Demo&message=SwanHub%20Demo&color=blue)](https://swanhub.co/ZeYiLin/HivisionIDPhotos/demo)、[![Spaces](https://img.shields.io/badge/🤗-Open%20in%20Spaces-blue)](https://huggingface.co/spaces/TheEeeeLin/HivisionIDPhotos)、[![][modelscope-shield]][modelscope-link]\n\n- 2024.11.20: Gradio Demo adds **Print Layout** option, supports six-inch, five-inch, A4, 3R, and 4R layout sizes\n- 2024.11.16: API interface adds beauty effect parameter\n- 2024.09.24: API interface adds base64 image input option | Gradio Demo adds **Layout Photo Cropping Lines** feature\n- 2024.09.22: Gradio Demo adds **Beast Mode** and **DPI** parameter\n- 2024.09.18: Gradio Demo adds **Share Template Photos** feature and **American Style** background option\n- 2024.09.17: Gradio Demo adds **Custom Background Color-HEX Input** feature | **(Community Contribution) C++ Version** - [HivisionIDPhotos-cpp](https://github.com/zjkhahah/HivisionIDPhotos-cpp) contributed by [zjkhahah](https://github.com/zjkhahah)\n- 2024.09.16: Gradio Demo adds **Face Rotation Alignment** feature, custom size input supports **millimeters**\n- 2024.09.14: Gradio Demo adds **Custom DPI** feature, adds Japanese and Korean support, adds **Adjust Brightness, Contrast, Sharpness** feature\n\n<br>\n\n# Project Overview\n\n> 🚀 Thank you for your interest in our work. You may also want to check out our other achievements in the field of image processing, feel free to reach out: zeyi.lin@swanhub.co.\n\nHivisionIDPhoto aims to develop a practical and systematic intelligent algorithm for producing ID photos.\n\nIt utilizes a comprehensive AI model workflow to recognize various user photo-taking scenarios, perform matting, and generate ID photos.\n\n**HivisionIDPhoto can achieve:**\n\n1. Lightweight matting (purely offline, fast inference with **CPU** only)\n2. Generate standard ID photos and six-inch layout photos based on different size specifications\n3. Support pure offline or edge-cloud inference\n4. Beauty effects (waiting)\n5. Intelligent formal wear change (waiting)\n\n<div align=\"center\">\n<img src=\"assets/demo.png\" width=900>\n</div>\n\n---\n\nIf HivisionIDPhoto helps you, please star this repo or recommend it to your friends to solve the urgent ID photo production problem!\n\n<br>\n\n# 🏠 Community\n\nWe have shared some interesting applications and extensions of HivisionIDPhotos built by the community:\n\n- [HivisionIDPhotos-ComfyUI](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI): ComfyUI ID photo processing workflow built by [AIFSH](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI) \n\n[<img src=\"assets/comfyui.png\" width=\"900\" alt=\"ComfyUI workflow\">](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI)\n\n- [HivisionIDPhotos-wechat-weapp](https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp): WeChat ID photo mini program, powered by the HivisionIDphotos algorithm, contributed by [no1xuan](https://github.com/no1xuan)\n\n[<img src=\"assets/community-wechat-miniprogram.png\" width=\"900\" alt=\"HivisionIDPhotos-wechat-weapp\">](https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp)\n\n- [HivisionIDPhotos-Uniapp](https://github.com/soulerror/HivisionIDPhotos-Uniapp): Front-end of WeChat ID photo mini program based on uniapp, powered by the HivisionIDphotos algorithm, contributed by [soulerror](https://github.com/soulerror)\n\n[<img src=\"assets/community-uniapp-wechat-miniprogram.png\" width=\"900\" alt=\"HivisionIDPhotos-uniapp\">](https://github.com/soulerror/HivisionIDPhotos-Uniapp)\n\n- [HivisionIDPhotos-cpp](https://github.com/zjkhahah/HivisionIDPhotos-cpp): C++ version of HivisionIDphotos, built by [zjkhahah](https://github.com/zjkhahah)\n- [HivisionIDPhotos-windows-GUI](https://github.com/zhaoyun0071/HivisionIDPhotos-windows-GUI): Windows client application built by [zhaoyun0071](https://github.com/zhaoyun0071)\n- [HivisionIDPhotos-NAS](https://github.com/ONG-Leo/HivisionIDPhotos-NAS): Chinese tutorial for Synology NAS deployment, contributed by [ONG-Leo](https://github.com/ONG-Leo)\n\n<br>\n\n# 🔧 Preparation\n\nEnvironment installation and dependencies:\n- Python >= 3.7 (project primarily tested on Python 3.10)\n- OS: Linux, Windows, MacOS\n\n## 1. Clone the Project\n\n```bash\ngit clone https://github.com/Zeyi-Lin/HivisionIDPhotos.git\ncd  HivisionIDPhotos\n```\n\n## 2. Install Dependency Environment\n\n> It is recommended to create a python3.10 virtual environment using conda, then execute the following commands\n\n```bash\npip install -r requirements.txt\npip install -r requirements-app.txt\n```\n\n## 3. Download Weight Files\n\n**Method 1: Script Download**\n\n```bash\npython scripts/download_model.py --models all\n```\n\n**Method 2: Direct Download**\n\nStore in the project's `hivision/creator/weights` directory:\n- `modnet_photographic_portrait_matting.onnx` (24.7MB): Official weights of [MODNet](https://github.com/ZHKKKe/MODNet), [download](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/modnet_photographic_portrait_matting.onnx)\n- `hivision_modnet.onnx` (24.7MB): Matting model with better adaptability for pure color background replacement, [download](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/hivision_modnet.onnx)\n- `rmbg-1.4.onnx` (176.2MB): Open-source matting model from [BRIA AI](https://huggingface.co/briaai/RMBG-1.4), [download](https://huggingface.co/briaai/RMBG-1.4/resolve/main/onnx/model.onnx?download=true) and rename to `rmbg-1.4.onnx`\n- `birefnet-v1-lite.onnx`(224MB): Open-source matting model from [ZhengPeng7](https://github.com/ZhengPeng7/BiRefNet), [download](https://github.com/ZhengPeng7/BiRefNet/releases/download/v1/BiRefNet-general-bb_swin_v1_tiny-epoch_232.onnx) and rename to `birefnet-v1-lite.onnx`\n\n## 4. Face Detection Model Configuration (Optional)\n\n| Extended Face Detection Model | Description | Documentation |\n| -- | -- | -- |\n| MTCNN | **Offline** face detection model, high-performance CPU inference, default model, lower detection accuracy | Use it directly after cloning this project |\n| RetinaFace | **Offline** face detection model, moderate CPU inference speed (in seconds), and high accuracy | [Download](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/retinaface-resnet50.onnx) and place it in the `hivision/creator/retinaface/weights` directory |\n| Face++ | Online face detection API launched by Megvii, higher detection accuracy, [official documentation](https://console.faceplusplus.com.cn/documents/4888373) | [Usage Documentation](docs/face++_EN.md)|\n\n## 5. Performance Reference\n\n> Test environment: Mac M1 Max 64GB, non-GPU acceleration, test image resolution: 512x715(1) and 764×1146(2).\n\n| Model Combination | Memory Occupation | Inference Time (1) | Inference Time (2) |\n| -- | -- | -- | -- |\n| MODNet + mtcnn | 410MB | 0.207s | 0.246s |\n| MODNet + retinaface | 405MB | 0.571s | 0.971s |\n| birefnet-v1-lite + retinaface | 6.20GB | 7.063s | 7.128s |\n\n## 6. GPU Inference Acceleration (Optional)\n\nIn the current version, the model that can be accelerated by NVIDIA GPUs is `birefnet-v1-lite`, and please ensure you have around 16GB of VRAM.\n\nIf you want to use NVIDIA GPU acceleration for inference, after ensuring you have installed CUDA and cuDNN, find the corresponding `onnxruntime-gpu` version to install according to the [onnxruntime-gpu documentation](https://onnxruntime.ai/docs/execution-providers/CUDA-ExecutionProvider.html#cuda-12x), and find the corresponding `pytorch` version to install according to the [pytorch official website](https://pytorch.org/get-started/locally/).\n\n```bash\n# If your computer is installed with CUDA 12.x and cuDNN 8\n# Installing torch is optional. If you can't configure cuDNN, try installing torch\npip install onnxruntime-gpu==1.18.0\npip install torch --index-url https://download.pytorch.org/whl/cu121\n```\n\nAfter completing the installation, call the `birefnet-v1-lite` model to utilize GPU acceleration for inference.\n\n> TIP: CUDA installations are backward compatible. For example, if your CUDA version is 12.6 but the highest version currently matched by torch is 12.4, it's still possible to install version 12.4 on your computer.\n<br>\n\n# 🚀 Run Gradio Demo\n\n```bash\npython app.py\n```\n\nRunning the program will generate a local web page where you can perform operations and interact with ID photos.\n\n<img src=\"assets/harry.png\" width=900>\n\n<br>\n\n# 🚀 Python Inference\n\nCore parameters:\n\n- `-i`: Input image path\n- `-o`: Output image path\n- `-t`: Inference type, options are idphoto, human_matting, add_background, generate_layout_photos\n- `--matting_model`: Portrait matting model weight selection\n- `--face_detect_model`: Face detection model selection\n\nMore parameters can be viewed by running `python inference.py --help`\n\n## 1. ID Photo Creation\n\nInput 1 photo to obtain 1 standard ID photo and 1 high-definition ID photo in 4-channel transparent PNG.\n\n```python\npython inference.py -i demo/images/test0.jpg -o ./idphoto.png --height 413 --width 295\n```\n\n## 2. Portrait Matting\n\nInput 1 photo to obtain 1 4-channel transparent PNG.\n\n```python\npython inference.py -t human_matting -i demo/images/test0.jpg -o ./idphoto_matting.png --matting_model hivision_modnet\n```\n\n## 3. Add Background Color to Transparent Image\n\nInput 1 4-channel transparent PNG to obtain 1 3-channel image with added background color.\n\n```python\npython inference.py -t add_background -i ./idphoto.png -o ./idphoto_ab.jpg -c 4f83ce -k 30 -r 1\n```\n\n## 4. Generate Six-Inch Layout Photo\n\nInput 1 3-channel photo to obtain 1 six-inch layout photo.\n\n```python\npython inference.py -t generate_layout_photos -i ./idphoto_ab.jpg -o ./idphoto_layout.jpg --height 413 --width 295 -k 200\n```\n\n## 5. ID Photo Cropping\n\nInput 1 4-channel photo (the image after matting) to obtain 1 standard ID photo and 1 high-definition ID photo in 4-channel transparent PNG.\n\n```python\npython inference.py -t idphoto_crop -i ./idphoto_matting.png -o ./idphoto_crop.png --height 413 --width 295\n```\n\n<br>\n\n# ⚡️ Deploy API Service\n\n## Start Backend\n\n```\npython deploy_api.py\n```\n\n## Request API Service\n\nFor detailed request methods, please refer to the [API Documentation](docs/api_EN.md), which includes the following request examples:\n- [cURL](docs/api_EN.md#curl-request-examples)\n- [Python](docs/api_EN.md#python-request-example)\n\n<br>\n\n# 🐳 Docker Deployment\n\n## 1. Pull or Build Image\n\n> Choose one of the following methods\n\n**Method 1: Pull the latest image:**\n\n```bash\ndocker pull linzeyi/hivision_idphotos\n```\n\n**Method 2: Directly build the image from Dockerfile:**\n\nAfter ensuring that at least one [matting model weight file](#3-download-weight-files) is placed in the `hivision/creator/weights` directory, execute the following in the project root directory:\n\n```bash\ndocker build -t linzeyi/hivision_idphotos .\n```\n\n**Method 3: Build using Docker Compose:**\n\nAfter ensuring that at least one [matting model weight file](#3-download-weight-files) is placed in the `hivision/creator/weights` directory, execute the following in the project root directory:\n\n```bash\ndocker compose build\n```\n\n## 2. Run Services\n\n**Start Gradio Demo Service**\n\nRun the following command, and you can access it locally at [http://127.0.0.1:7860](http://127.0.0.1:7860/).\n\n```bash\ndocker run -d -p 7860:7860 linzeyi/hivision_idphotos\n```\n\n**Start API Backend Service**\n\n```bash\ndocker run -d -p 8080:8080 linzeyi/hivision_idphotos python3 deploy_api.py\n```\n\n**Start Both Services Simultaneously**\n\n```bash\ndocker compose up -d\n```\n\n## Environment Variables\n\nThis project provides some additional configuration options, which can be set using environment variables:\n\n| Environment Variable | Type | Description | Example |\n|--|--|--|--|\n| FACE_PLUS_API_KEY | Optional | This is your API key obtained from the Face++ console | `7-fZStDJ····` |\n| FACE_PLUS_API_SECRET | Optional | Secret corresponding to the Face++ API key | `VTee824E····` |\n| RUN_MODE | Optional | Running mode, with the option of `beast` (beast mode). In beast mode, the face detection and matting models will not release memory, achieving faster secondary inference speeds. It is recommended to try to have at least 16GB of memory. | `beast` |\n\nExample of using environment variables in Docker:\n```bash\ndocker run  -d -p 7860:7860 \\\n    -e FACE_PLUS_API_KEY=7-fZStDJ···· \\\n    -e FACE_PLUS_API_SECRET=VTee824E···· \\\n    -e RUN_MODE=beast \\\n    linzeyi/hivision_idphotos \n```\n\n<br>\n\n# 📖 Cite Projects\n\n1. MTCNN:\n\n```bibtex\n@software{ipazc_mtcnn_2021,\n    author = {ipazc},\n    title = {{MTCNN}},\n    url = {https://github.com/ipazc/mtcnn},\n    year = {2021},\n    publisher = {GitHub}\n}\n```\n\n2. ModNet:\n\n```bibtex\n@software{zhkkke_modnet_2021,\n    author = {ZHKKKe},\n    title = {{ModNet}},\n    url = {https://github.com/ZHKKKe/MODNet},\n    year = {2021},\n    publisher = {GitHub}\n}\n```\n\n<br>\n\n# Q&A\n\n## 1. How to modify preset sizes and colors?\n\n- Size: After modifying [size_list_EN.csv](demo/assets/size_list_EN.csv), run `app.py` again. The first column is the size name, the second column is the height, and the third column is the width.\n- Color: After modifying [color_list_EN.csv](demo/assets/color_list_EN.csv), run `app.py` again. The first column is the color name, and the second column is the Hex value.\n\n## 2. How to Change the Watermark Font?\n\n1. Place the font file in the `hivision/plugin/font` folder.\n2. Change the `font_file` parameter value in `hivision/plugin/watermark.py` to the name of the font file.\n\n## 3. How to Add Social Media Template Photos?\n\n1. Place the template image in the `hivision/plugin/template/assets` folder. The template image should be a 4-channel transparent PNG.\n2. Add the latest template information to the `hivision/plugin/template/assets/template_config.json` file. Here, `width` is the template image width (px), `height` is the template image height (px), `anchor_points` are the coordinates (px) of the four corners of the transparent area in the template; `rotation` is the rotation angle of the transparent area relative to the vertical direction, where >0 is counterclockwise and <0 is clockwise.\n3. Add the name of the latest template to the `TEMPLATE_NAME_LIST` variable in the `_generate_image_template` function of `demo/processor.py`.\n\n<img src=\"assets/social_template.png\" width=\"500\">\n\n## 4. How to Modify the Top Navigation Bar of the Gradio Demo?\n\n- Modify the `demo/assets/title.md` file.\n\n<br>\n\n# 📧 Contact Us\n\nIf you have any questions, please email zeyi.lin@swanhub.co\n\n<br>\n\n# Contributors\n\n<a href=\"https://github.com/Zeyi-Lin/HivisionIDPhotos/graphs/contributors\">\n  <img src=\"https://contrib.rocks/image?repo=Zeyi-Lin/HivisionIDPhotos\" />\n</a>\n\n[Zeyi-Lin](https://github.com/Zeyi-Lin)、[SAKURA-CAT](https://github.com/SAKURA-CAT)、[Feudalman](https://github.com/Feudalman)、[swpfY](https://github.com/swpfY)、[Kaikaikaifang](https://github.com/Kaikaikaifang)、[ShaohonChen](https://github.com/ShaohonChen)、[KashiwaByte](https://github.com/KashiwaByte)\n\n<br>\n\n# Thanks for support\n\n[![Stargazers repo roster for @Zeyi-Lin/HivisionIDPhotos](https://reporoster.com/stars/Zeyi-Lin/HivisionIDPhotos)](https://github.com/Zeyi-Lin/HivisionIDPhotos/stargazers)\n\n[![Forkers repo roster for @Zeyi-Lin/HivisionIDPhotos](https://reporoster.com/forks/Zeyi-Lin/HivisionIDPhotos)](https://github.com/Zeyi-Lin/HivisionIDPhotos/network/members)\n\n[![Star History Chart](https://api.star-history.com/svg?repos=Zeyi-Lin/HivisionIDPhotos&type=Date)](https://star-history.com/#Zeyi-Lin/HivisionIDPhotos&Date)\n\n# Lincese\n\nThis repository is licensed under the [Apache-2.0 License](LICENSE).\n\n[github-stars-shield]: https://img.shields.io/github/stars/zeyi-lin/hivisionidphotos?color=ffcb47&labelColor=black&style=flat-square\n[github-stars-link]: https://github.com/zeyi-lin/hivisionidphotos/stargazers\n\n[swanhub-demo-shield]: https://swanhub.co/git/repo/SwanHub%2FAuto-README/file/preview?ref=main&path=swanhub.svg\n[swanhub-demo-link]: https://swanhub.co/ZeYiLin/HivisionIDPhotos/demo\n\n[spaces-shield]: https://img.shields.io/badge/🤗-Open%20in%20Spaces-blue\n[spaces-link]: https://huggingface.co/spaces/TheEeeeLin/HivisionIDPhotos\n\n<!-- WeChat group link -->\n[wechat-shield]: https://img.shields.io/badge/WeChat-微信-4cb55e\n[wechat-link]: https://docs.qq.com/doc/DUkpBdk90eWZFS2JW\n\n<!-- Github Release -->\n[release-shield]: https://img.shields.io/github/v/release/zeyi-lin/hivisionidphotos?color=369eff&labelColor=black&logo=github&style=flat-square\n[release-link]: https://github.com/zeyi-lin/hivisionidphotos/releases\n\n[license-shield]: https://img.shields.io/badge/license-apache%202.0-white?labelColor=black&style=flat-square\n[license-link]: https://github.com/Zeyi-Lin/HivisionIDPhotos/blob/master/LICENSE\n\n[github-issues-shield]: https://img.shields.io/github/issues/zeyi-lin/hivisionidphotos?color=ff80eb&labelColor=black&style=flat-square\n[github-issues-link]: https://github.com/zeyi-lin/hivisionidphotos/issues\n\n[dockerhub-shield]: https://img.shields.io/docker/v/linzeyi/hivision_idphotos?color=369eff&label=docker&labelColor=black&logoColor=white&style=flat-square\n[dockerhub-link]: https://hub.docker.com/r/linzeyi/hivision_idphotos/tags\n\n[trendshift-shield]: https://trendshift.io/api/badge/repositories/11622\n[trendshift-link]: https://trendshift.io/repositories/11622\n\n[hellogithub-shield]: https://abroad.hellogithub.com/v1/widgets/recommend.svg?rid=8ea1457289fb4062ba661e5299e733d6&claim_uid=Oh5UaGjfrblg0yZ\n[hellogithub-link]: https://hellogithub.com/repository/8ea1457289fb4062ba661e5299e733d6\n\n[github-contributors-shield]: https://img.shields.io/github/contributors/zeyi-lin/hivisionidphotos?color=c4f042&labelColor=black&style=flat-square\n[github-contributors-link]: https://github.com/zeyi-lin/hivisionidphotos/graphs/contributors\n\n[github-forks-shield]: https://img.shields.io/github/forks/zeyi-lin/hivisionidphotos?color=8ae8ff&labelColor=black&style=flat-square\n[github-forks-link]: https://github.com/zeyi-lin/hivisionidphotos/network/members\n\n[modelscope-shield]: https://img.shields.io/badge/Demo_on_ModelScope-purple?logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIzIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCiA8Zz4KICA8dGl0bGU+TGF5ZXIgMTwvdGl0bGU+CiAgPHBhdGggaWQ9InN2Z18xNCIgZmlsbD0iIzYyNGFmZiIgZD0ibTAsODkuODRsMjUuNjUsMGwwLDI1LjY0OTk5bC0yNS42NSwwbDAsLTI1LjY0OTk5eiIvPgogIDxwYXRoIGlkPSJzdmdfMTUiIGZpbGw9IiM2MjRhZmYiIGQ9Im05OS4xNCwxMTUuNDlsMjUuNjUsMGwwLDI1LjY1bC0yNS42NSwwbDAsLTI1LjY1eiIvPgogIDxwYXRoIGlkPSJzdmdfMTYiIGZpbGw9IiM2MjRhZmYiIGQ9Im0xNzYuMDksMTQxLjE0bC0yNS42NDk5OSwwbDAsMjIuMTlsNDcuODQsMGwwLC00Ny44NGwtMjIuMTksMGwwLDI1LjY1eiIvPgogIDxwYXRoIGlkPSJzdmdfMTciIGZpbGw9IiMzNmNmZDEiIGQ9Im0xMjQuNzksODkuODRsMjUuNjUsMGwwLDI1LjY0OTk5bC0yNS42NSwwbDAsLTI1LjY0OTk5eiIvPgogIDxwYXRoIGlkPSJzdmdfMTgiIGZpbGw9IiMzNmNmZDEiIGQ9Im0wLDY0LjE5bDI1LjY1LDBsMCwyNS42NWwtMjUuNjUsMGwwLC0yNS42NXoiLz4KICA8cGF0aCBpZD0ic3ZnXzE5IiBmaWxsPSIjNjI0YWZmIiBkPSJtMTk4LjI4LDg5Ljg0bDI1LjY0OTk5LDBsMCwyNS42NDk5OWwtMjUuNjQ5OTksMGwwLC0yNS42NDk5OXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIwIiBmaWxsPSIjMzZjZmQxIiBkPSJtMTk4LjI4LDY0LjE5bDI1LjY0OTk5LDBsMCwyNS42NWwtMjUuNjQ5OTksMGwwLC0yNS42NXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIxIiBmaWxsPSIjNjI0YWZmIiBkPSJtMTUwLjQ0LDQybDAsMjIuMTlsMjUuNjQ5OTksMGwwLDI1LjY1bDIyLjE5LDBsMCwtNDcuODRsLTQ3Ljg0LDB6Ii8+CiAgPHBhdGggaWQ9InN2Z18yMiIgZmlsbD0iIzM2Y2ZkMSIgZD0ibTczLjQ5LDg5Ljg0bDI1LjY1LDBsMCwyNS42NDk5OWwtMjUuNjUsMGwwLC0yNS42NDk5OXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIzIiBmaWxsPSIjNjI0YWZmIiBkPSJtNDcuODQsNjQuMTlsMjUuNjUsMGwwLC0yMi4xOWwtNDcuODQsMGwwLDQ3Ljg0bDIyLjE5LDBsMCwtMjUuNjV6Ii8+CiAgPHBhdGggaWQ9InN2Z18yNCIgZmlsbD0iIzYyNGFmZiIgZD0ibTQ3Ljg0LDExNS40OWwtMjIuMTksMGwwLDQ3Ljg0bDQ3Ljg0LDBsMCwtMjIuMTlsLTI1LjY1LDBsMCwtMjUuNjV6Ii8+CiA8L2c+Cjwvc3ZnPg==&labelColor=white\n[modelscope-link]: https://modelscope.cn/studios/SwanLab/HivisionIDPhotos\n\n\n[modelers-shield]: https://img.shields.io/badge/Demo_on_Modelers-c42a2a?logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCAxMjQgNjQiIGZpbGw9Im5vbmUiPgo8cGF0aCBkPSJNNDIuNzc4MyAwSDI2LjU5NzdWMTUuNzc4N0g0Mi43NzgzVjBaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0xNi41MDg4IDQuMTc5MkgwLjMyODEyNVYxOS45NTc5SDE2LjUwODhWNC4xNzkyWiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTIzLjk1MiA0LjE3OTJIMTA3Ljc3MVYxOS45NTc5SDEyMy45NTJWNC4xNzkyWiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTYuNTA4OCA0NS40NjE5SDAuMzI4MTI1VjYxLjI0MDZIMTYuNTA4OFY0NS40NjE5WiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTIzLjk1MiA0NS40NjE5SDEwNy43NzFWNjEuMjQwNkgxMjMuOTUyVjQ1LjQ2MTlaIiBmaWxsPSIjMjQ0OTlDIi8+CjxwYXRoIGQ9Ik0zMi43MDggMTUuNzc4OEgxNi41MjczVjMxLjU1NzVIMzIuNzA4VjE1Ljc3ODhaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik01Mi44NDg2IDE1Ljc3ODhIMzYuNjY4VjMxLjU1NzVINTIuODQ4NlYxNS43Nzg4WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNOTcuNzIzNyAwSDgxLjU0M1YxNS43Nzg3SDk3LjcyMzdWMFoiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTg3LjY1MzQgMTUuNzc4OEg3MS40NzI3VjMxLjU1NzVIODcuNjUzNFYxNS43Nzg4WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNMTA3Ljc5NCAxNS43Nzg4SDkxLjYxMzNWMzEuNTU3NUgxMDcuNzk0VjE1Ljc3ODhaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0yNC42NzQ4IDMxLjU1NzZIOC40OTQxNFY0Ny4zMzYzSDI0LjY3NDhWMzEuNTU3NloiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTYwLjg3OTkgMzEuNTU3Nkg0NC42OTkyVjQ3LjMzNjNINjAuODc5OVYzMS41NTc2WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNNzkuNjIwMSAzMS41NTc2SDYzLjQzOTVWNDcuMzM2M0g3OS42MjAxVjMxLjU1NzZaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0xMTUuODI1IDMxLjU1NzZIOTkuNjQ0NVY0Ny4zMzYzSDExNS44MjVWMzEuNTU3NloiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTcwLjI1NDkgNDcuMzM1OUg1NC4wNzQyVjYzLjExNDdINzAuMjU0OVY0Ny4zMzU5WiIgZmlsbD0iI0RFMDQyOSIvPgo8L3N2Zz4=&labelColor=white\n[modelers-link]: https://modelers.cn/spaces/SwanLab/HivisionIDPhotos"
        },
        {
          "name": "README_JP.md",
          "type": "blob",
          "size": 24.1416015625,
          "content": "<div align=\"center\">\n\n<img alt=\"hivision_logo\" src=\"assets/hivision_logo.png\" width=120 height=120>\n<h1>HivisionIDPhoto</h1>\n\n[English](README_EN.md) / [中文](README.md) / 日本語 / [한국어](README_KO.md)\n\n[![][release-shield]][release-link]\n[![][dockerhub-shield]][dockerhub-link]\n[![][github-stars-shield]][github-stars-link]\n[![][github-issues-shield]][github-issues-link]\n[![][github-contributors-shield]][github-contributors-link]\n[![][github-forks-shield]][github-forks-link]\n[![][license-shield]][license-link]  \n[![][wechat-shield]][wechat-link]\n[![][spaces-shield]][spaces-link]\n[![][swanhub-demo-shield]][swanhub-demo-link]\n[![][modelscope-shield]][modelscope-link]\n[![][modelers-shield]][modelers-link]\n\n[![][trendshift-shield]][trendshift-link]\n[![][hellogithub-shield]][hellogithub-link]\n\n<img src=\"assets/demoImage.jpg\" width=900>\n\n</div>\n\n<br>\n\n> **関連プロジェクト**：\n>\n> - [SwanLab](https://github.com/SwanHubX/SwanLab)：人物切り抜きモデルの訓練を通じて、分析と監視、ラボの仲間との協力と交流を行い、訓練効率を大幅に向上させました。\n\n<br>\n\n# 目次\n\n- [最近の更新](#-最近の更新)\n- [プロジェクト概要](#-プロジェクト概要)\n- [コミュニティ](#-コミュニティ)\n- [準備作業](#-準備作業)\n- [デモの起動](#-デモの起動)\n- [Python推論](#-python推論)\n- [APIサービスのデプロイ](#️-APIサービスのデプロイ)\n- [Dockerデプロイ](#-dockerデプロイ)\n- [お問い合わせ](#-お問い合わせ)\n- [貢献者](#貢献者)\n\n<br>\n\n# 🤩 最近の更新\n\n- オンライン体験： [![SwanHub Demo](https://img.shields.io/static/v1?label=Demo&message=SwanHub%20Demo&color=blue)](https://swanhub.co/ZeYiLin/HivisionIDPhotos/demo)、[![Spaces](https://img.shields.io/badge/🤗-Open%20in%20Spaces-blue)](https://huggingface.co/spaces/TheEeeeLin/HivisionIDPhotos)、[![][modelscope-shield]][modelscope-link]\n\n- 2024.11.20: Gradioデモに**印刷レイアウト**オプションを追加、六つ切り、五つ切り、A4、3R、4Rレイアウトサイズをサポート\n- 2024.11.16: APIインターフェースに美顔効果パラメータを追加\n- 2024.09.24: APIインターフェースにbase64画像入力オプションを追加 | Gradioデモに**レイアウト写真トリミングライン**機能を追加\n- 2024.09.22: Gradioデモに**ビーストモード**と**DPI**パラメータを追加\n- 2024.09.18: Gradioデモに**テンプレート写真の共有**機能を追加、**米国式**背景オプションを追加\n- 2024.09.17: Gradioデモに**カスタム底色-HEX入力**機能を追加 | **（コミュニティ貢献）C++バージョン** - [HivisionIDPhotos-cpp](https://github.com/zjkhahah/HivisionIDPhotos-cpp) 貢献 by [zjkhahah](https://github.com/zjkhahah)\n- 2024.09.16: Gradioデモに**顔回転対応**機能を追加、カスタムサイズ入力に**ミリメートル**をサポート\n\n<br>\n\n# プロジェクト概要\n\n> 🚀 私たちの仕事に興味を持っていただきありがとうございます。画像分野における他の成果もぜひご覧ください。お問い合わせは、zeyi.lin@swanhub.co まで。\n\nHivisionIDPhotoは、実用的で体系的な証明写真のスマート制作アルゴリズムを開発することを目的としています。\n\nさまざまなユーザー撮影シーンの認識、切り抜きおよび証明写真の生成を実現するために、一連の洗練されたAIモデル作業フローを利用しています。\n\n**HivisionIDPhotoは以下のことができます：**\n\n1. 軽量切り抜き（完全オフラインで、**CPU**のみで迅速に推論可能）\n2. 異なるサイズ仕様に基づいて異なる標準証明写真、六寸レイアウト写真を生成\n3. 完全オフラインまたはエッジクラウド推論をサポート\n4. 美顔（待機中）\n5. スマートな正装変更（待機中）\n\n<div align=\"center\">\n<img src=\"assets/demo.png\" width=900>\n</div>\n\n---\n\nHivisionIDPhotoがあなたに役立つ場合は、このリポジトリをスターしたり、友人に推薦したりして、証明写真の緊急制作の問題を解決してください！\n\n<br>\n\n# 🏠 コミュニティ\n\n私たちは、コミュニティによって構築されたHivisionIDPhotosの興味深いアプリケーションや拡張機能をいくつか共有しています：\n\n- [HivisionIDPhotos-ComfyUI](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI)：ComfyUI証明写真処理ワークフロー、[AIFSH](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI)によって構築 \n\n[<img src=\"assets/comfyui.png\" width=\"900\" alt=\"ComfyUI workflow\">](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI)\n\n- [HivisionIDPhotos-wechat-weapp](https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp)：WeChat証明写真ミニプログラム、HivisionIDphotosアルゴリズムに基づく、[no1xuan](https://github.com/no1xuan)による貢献\n\n[<img src=\"assets/community-wechat-miniprogram.png\" width=\"900\" alt=\"HivisionIDPhotos-wechat-weapp\">](https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp)\n\n- [HivisionIDPhotos-Uniapp](https://github.com/soulerror/HivisionIDPhotos-Uniapp)：基本のuniapp証明写真ミニプログラムの前部、HivisionIDphotosアルゴリズムに基づく、[soulerror](https://github.com/soulerror)による貢献\n\n[<img src=\"assets/community-uniapp-wechat-miniprogram.png\" width=\"900\" alt=\"HivisionIDPhotos-uniapp\">](https://github.com/soulerror/HivisionIDPhotos-Uniapp)\n\n- [HivisionIDPhotos-cpp](https://github.com/zjkhahah/HivisionIDPhotos-cpp)：HivisionIDphotos C++バージョン、[zjkhahah](https://github.com/zjkhahah)によって構築\n- [HivisionIDPhotos-windows-GUI](https://github.com/zhaoyun0071/HivisionIDPhotos-windows-GUI)：Windowsクライアントアプリケーション、[zhaoyun0071](https://github.com/zhaoyun0071)によって構築\n- [HivisionIDPhotos-NAS](https://github.com/ONG-Leo/HivisionIDPhotos-NAS)：Synology NAS導入の中国語チュートリアル、[ONG-Leo](https://github.com/ONG-Leo)による貢献\n\n<br>\n\n# 🔧 準備作業\n\n環境のインストールと依存関係：\n- Python >= 3.7（プロジェクトは主にpython 3.10でテストされています）\n- OS: Linux, Windows, MacOS\n\n## 1. プロジェクトをクローンする\n\n```bash\ngit clone https://github.com/Zeyi-Lin/HivisionIDPhotos.git\ncd  HivisionIDPhotos\n```\n\n## 2. 依存環境をインストールする\n\n> condaでpython3.10の仮想環境を作成することをお勧めします。その後、以下のコマンドを実行してください。\n\n```bash\npip install -r requirements.txt\npip install -r requirements-app.txt\n```\n\n## 3. 重みファイルをダウンロードする\n\n**方法一：スクリプトでダウンロード**\n\n```bash\npython scripts/download_model.py --models all\n```\n\n**方法二：直接ダウンロード**\n\nプロジェクトの`hivision/creator/weights`ディレクトリに保存します：\n- `modnet_photographic_portrait_matting.onnx` (24.7MB): [MODNet](https://github.com/ZHKKKe/MODNet)公式の重み、[ダウンロード](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/modnet_photographic_portrait_matting.onnx)\n- `hivision_modnet.onnx` (24.7MB): 単色背景に対して適応性の高い切り抜きモデル、[ダウンロード](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/hivision_modnet.onnx)\n- `rmbg-1.4.onnx` (176.2MB): [BRIA AI](https://huggingface.co/briaai/RMBG-1.4)のオープンソース切り抜きモデル、[ダウンロード](https://huggingface.co/briaai/RMBG-1.4/resolve/main/onnx/model.onnx?download=true)後に`rmbg-1.4.onnx`にリネーム\n- `birefnet-v1-lite.onnx`(224MB): [ZhengPeng7](https://github.com/ZhengPeng7/BiRefNet)のオープンソース切り抜きモデル、[ダウンロード](https://github.com/ZhengPeng7/BiRefNet/releases/download/v1/BiRefNet-general-bb_swin_v1_tiny-epoch_232.onnx)後に`birefnet-v1-lite.onnx`にリネーム\n\n## 4. 顔検出モデルの設定（オプション）\n\n| 拡張顔検出モデル | 説明 | 使用文書 |\n| -- | -- | -- |\n| MTCNN | **オフライン**顔検出モデル、高性能CPU推論、デフォルトモデル、検出精度は低い | このプロジェクトをクローン後、直接使用 |\n| Face++ | Megviiが提供するオンライン顔検出API、高精度の検出、[公式文書](https://console.faceplusplus.com.cn/documents/4888373) | [使用文書](docs/face++_EN.md)|\n\n## 5. パフォーマンスリファレンス\n\n> テスト環境はMac M1 Max 64GB、非GPU加速、テスト画像の解像度は512x715(1)と764×1146(2)。\n\n| モデルの組み合わせ | メモリ使用量 | 推論時間(1) | 推論時間(2) |\n| -- | -- | -- | -- |\n| MODNet + mtcnn | 410MB | 0.207秒 | 0.246秒 |\n| MODNet + retinaface | 405MB | 0.571秒 | 0.971秒 |\n| birefnet-v1-lite + retinaface | 6.20GB | 7.063秒 | 7.128秒 |\n\n## 6. GPU推論の加速（オプション）\n\n現在のバージョンでは、NVIDIA GPUで加速可能なモデルは`birefnet-v1-lite`です。約16GBのVRAMが必要であることにご注意ください。\n\nNVIDIA GPUを使用して推論を加速したい場合は、CUDAとcuDNNがインストールされていることを確認した上で、[onnxruntime-gpuのドキュメント](https://onnxruntime.ai/docs/execution-providers/CUDA-ExecutionProvider.html#cuda-12x)に従って適切な`onnxruntime-gpu`バージョンをインストールし、[PyTorchの公式サイト](https://pytorch.org/get-started/locally/)から適切な`pytorch`バージョンをインストールしてください。\n\n```bash\n# もしコンピュータにCUDA 12.xとcuDNN 8がインストールされている場合\n# torchのインストールは任意です。cuDNNが設定できない場合は、torchを試してみてください\npip install onnxruntime-gpu==1.18.0\npip install torch --index-url https://download.pytorch.org/whl/cu121\n```\n\nインストールが完了したら、`birefnet-v1-lite`モデルを呼び出してGPU加速推論を利用します。\n\n> TIPS: CUDAのインストールは下位互換性があります。たとえば、CUDAのバージョンが12.6で、torchが現在対応している最高バージョンが12.4である場合、コンピュータに12.4のバージョンをインストールすることも可能です。\n\n<br>\n\n# 🚀 デモの起動\n\n```bash\npython app.py\n```\n\nプログラムを実行すると、ローカルWebページが生成され、ページ内で証明写真の操作と対話が可能になります。\n\n<img src=\"assets/harry.png\" width=900>\n\n<br>\n\n# 🚀 Python推論\n\n核心パラメータ：\n\n- `-i`: 入力画像のパス\n- `-o`: 保存画像のパス\n- `-t`: 推論タイプ、idphoto、human_matting、add_background、generate_layout_photosから選択可能\n- `--matting_model`: 人物切り抜きモデルの重み選択\n- `--face_detect_model`: 顔検出モデルの選択\n\n詳細なパラメータは`python inference.py --help`で確認できます。\n\n## 1. 証明写真の作成\n\n1枚の写真を入力し、1枚の標準証明写真と1枚の高解像度証明写真の4チャンネル透明PNGを取得します。\n\n```python\npython inference.py -i demo/images/test0.jpg -o ./idphoto.png --height 413 --width 295\n```\n\n## 2. 人物切り抜き\n\n1枚の写真を入力し、1枚の4チャンネル透明PNGを取得します。\n\n```python\npython inference.py -t human_matting -i demo/images/test0.jpg -o ./idphoto_matting.png --matting_model hivision_modnet\n```\n\n## 3. 透明画像に背景色を追加\n\n1枚の4チャンネル透明PNGを入力し、背景色を追加した3チャンネル画像を取得します。\n\n```python\npython inference.py -t add_background -i ./idphoto.png -o ./idphoto_ab.jpg -c 4f83ce -k 30 -r 1\n```\n\n## 4. 六寸レイアウト写真の取得\n\n1枚の3チャンネル写真を入力し、1枚の六寸レイアウト写真を取得します。\n\n```python\npython inference.py -t generate_layout_photos -i ./idphoto_ab.jpg -o ./idphoto_layout.jpg --height 413 --width 295 -k 200\n```\n\n## 5. 証明写真のトリミング\n\n1枚の4チャンネル写真（切り抜き済みの画像）を入力し、1枚の標準証明写真と1枚の高解像度証明写真の4チャンネル透明PNGを取得します。\n\n```python\npython inference.py -t idphoto_crop -i ./idphoto_matting.png -o ./idphoto_crop.png --height 413 --width 295\n```\n\n<br>\n\n# ⚡️ APIサービスのデプロイ\n\n## バックエンドを起動\n\n```\npython deploy_api.py\n```\n\n## APIサービスにリクエスト\n\n詳細なリクエスト方法は[APIドキュメント](docs/api_EN.md)を参照してください。以下のリクエスト例が含まれます：\n- [cURL](docs/api_EN.md#curl-request-examples)\n- [Python](docs/api_EN.md#python-request-example)\n\n<br>\n\n# 🐳 Dockerデプロイ\n\n## 1. イメージをプルまたはビルドする\n\n> 以下の方法から3つを選択してください。\n\n**方法一：最新のイメージをプル：**\n\n```bash\ndocker pull linzeyi/hivision_idphotos\n```\n\n**方法二：Dockerfileから直接イメージをビルド：**\n\n`hivision/creator/weights` ディレクトリに少なくとも1つの[マスキングモデルの重みファイル](#3-重みファイルのダウンロード)があることを確認してから、プロジェクトのルートディレクトリで以下を実行してください：\n\n```bash\ndocker build -t linzeyi/hivision_idphotos .\n```\n\n**方法三：Docker composeでビルド：**\n\n`hivision/creator/weights` ディレクトリに少なくとも1つの[マスキングモデルの重みファイル](#3-重みファイルのダウンロード)があることを確認してから、プロジェクトのルートディレクトリで以下を実行してください：\n\n```bash\ndocker compose build\n```\n\n## 2. サービスを実行\n\n**Gradioデモサービスを起動**\n\n次のコマンドを実行し、ローカルで [http://127.0.0.1:7860](http://127.0.0.1:7860/) にアクセスすると使用可能です。\n\n```bash\ndocker run -d -p 7860:7860 linzeyi/hivision_idphotos\n```\n\n**APIバックエンドサービスを起動**\n\n```bash\ndocker run -d -p 8080:8080 linzeyi/hivision_idphotos python3 deploy_api.py\n```\n\n**2つのサービスを同時に起動**\n\n```bash\ndocker compose up -d\n```\n\n## 環境変数\n\n本プロジェクトは、いくつかの追加設定項目を提供し、環境変数を使用して設定します：\n\n| 環境変数 | タイプ\t| 説明 | 例 |\n|--|--|--|--|\n| FACE_PLUS_API_KEY\t | オプション\t| これはFace++コンソールで申請したAPIキーです。\t | `7-fZStDJ····` |\n| FACE_PLUS_API_SECRET\t | オプション\t| Face++ APIキーに対応するSecret | `VTee824E····` |\n\ndockerでの環境変数使用例：\n```bash\ndocker run  -d -p 7860:7860 \\\n    -e FACE_PLUS_API_KEY=7-fZStDJ···· \\\n    -e FACE_PLUS_API_SECRET=VTee824E···· \\\n    linzeyi/hivision_idphotos \n```\n\n<br>\n\n# 📖 プロジェクトの引用\n\n1. MTCNN:\n\n```bibtex\n@software{ipazc_mtcnn_2021,\n    author = {ipazc},\n    title = {{MTCNN}},\n    url = {https://github.com/ipazc/mtcnn},\n    year = {2021},\n    publisher = {GitHub}\n}\n```\n\n2. ModNet:\n\n```bibtex\n@software{zhkkke_modnet_2021,\n    author = {ZHKKKe},\n    title = {{ModNet}},\n    url = {https://github.com/ZHKKKe/MODNet},\n    year = {2021},\n    publisher = {GitHub}\n}\n```\n\n<br>\n\n# よくある質問 (FAQ)\n\n## 1. 基本的なサイズと色をどのように変更しますか？\n\n- サイズ: [size_list_EN.csv](demo/assets/size_list_EN.csv) ファイルを修正した後、`app.py`を再実行すれば大丈夫です。最初の列はサイズ名、二番目の列は高さ、三番目の列は幅です。\n- 色: [color_list_EN.csv](demo/assets/color_list_EN.csv) ファイルを修正した後、`app.py`を再実行すれば大丈夫です。最初の列は色名、二番目の列はHex値です。\n\n## 2. ウォーターマークのフォントをどのように変更しますか？\n\n1. フォントファイルを`hivision/plugin/font`フォルダーに置きます。\n2. `hivision/plugin/watermark.py`ファイル内の`font_file`パラメータの値をフォントファイル名に変更します。\n\n## 3. ソーシャルメディアのテンプレート画像をどのように追加しますか？\n\n1. テンプレート画像を`hivision/plugin/template/assets`フォルダーに置きます。テンプレート画像は4チャンネルの透明PNGです。\n2. `hivision/plugin/template/assets/template_config.json`ファイルに最新のテンプレート情報を追加します。ここで`width`はテンプレート画像の幅(px)、`height`はテンプレート画像の高さ(px)、`anchor_points`はテンプレートの透明領域の4つの隅の座標(px)です。`rotation`は透明領域の垂直方向に対する回転角度で、>0は反時計回り、<0は時計回りです。\n3. `demo/processor.py`の`_generate_image_template`関数内の`TEMPLATE_NAME_LIST`変数に最新のテンプレート名を追加します。\n\n<img src=\"assets/social_template.png\" width=\"500\">\n\n## 4. Gradio Demoの上部ナビゲーションバーをどのように変更しますか？\n\n- `demo/assets/title.md`ファイルを修正します。\n\n<br>\n\n# 📧 お問い合わせ\n\nご不明な点がございましたら、zeyi.lin@swanhub.coまでメールをお送りください。\n\n<br>\n\n# 貢献者\n\n<a href=\"https://github.com/Zeyi-Lin/HivisionIDPhotos/graphs/contributors\">\n  <img src=\"https://contrib.rocks/image?repo=Zeyi-Lin/HivisionIDPhotos\" />\n</a>\n\n[Zeyi-Lin](https://github.com/Zeyi-Lin)、[SAKURA-CAT](https://github.com/SAKURA-CAT)、[Feudalman](https://github.com/Feudalman)、[swpfY](https://github.com/swpfY)、[Kaikaikaifang](https://github.com/Kaikaikaifang)、[ShaohonChen](https://github.com/ShaohonChen)、[KashiwaByte](https://github.com/KashiwaByte)\n\n<br>\n\n# Thanks for support\n\n[![Stargazers repo roster for @Zeyi-Lin/HivisionIDPhotos](https://reporoster.com/stars/Zeyi-Lin/HivisionIDPhotos)](https://github.com/Zeyi-Lin/HivisionIDPhotos/stargazers)\n\n[![Forkers repo roster for @Zeyi-Lin/HivisionIDPhotos](https://reporoster.com/forks/Zeyi-Lin/HivisionIDPhotos)](https://github.com/Zeyi-Lin/HivisionIDPhotos/network/members)\n\n[![Star History Chart](https://api.star-history.com/svg?repos=Zeyi-Lin/HivisionIDPhotos&type=Date)](https://star-history.com/#Zeyi-Lin/HivisionIDPhotos&Date)\n\n<br>\n\n# Lincese\n\nThis repository is licensed under the [Apache-2.0 License](LICENSE).\n\n[github-stars-shield]: https://img.shields.io/github/stars/zeyi-lin/hivisionidphotos?color=ffcb47&labelColor=black&style=flat-square\n[github-stars-link]: https://github.com/zeyi-lin/hivisionidphotos/stargazers\n\n[swanhub-demo-shield]: https://swanhub.co/git/repo/SwanHub%2FAuto-README/file/preview?ref=main&path=swanhub.svg\n[swanhub-demo-link]: https://swanhub.co/ZeYiLin/HivisionIDPhotos/demo\n\n[spaces-shield]: https://img.shields.io/badge/🤗-Open%20in%20Spaces-blue\n[spaces-link]: https://huggingface.co/spaces/TheEeeeLin/HivisionIDPhotos\n\n<!-- 微信群链接 -->\n[wechat-shield]: https://img.shields.io/badge/WeChat-微信-4cb55e\n[wechat-link]: https://docs.qq.com/doc/DUkpBdk90eWZFS2JW\n\n<!-- Github Release -->\n[release-shield]: https://img.shields.io/github/v/release/zeyi-lin/hivisionidphotos?color=369eff&labelColor=black&logo=github&style=flat-square\n[release-link]: https://github.com/zeyi-lin/hivisionidphotos/releases\n\n[license-shield]: https://img.shields.io/badge/license-apache%202.0-white?labelColor=black&style=flat-square\n[license-link]: https://github.com/Zeyi-Lin/HivisionIDPhotos/blob/master/LICENSE\n\n[github-issues-shield]: https://img.shields.io/github/issues/zeyi-lin/hivisionidphotos?color=ff80eb&labelColor=black&style=flat-square\n[github-issues-link]: https://github.com/zeyi-lin/hivisionidphotos/issues\n\n[dockerhub-shield]: https://img.shields.io/docker/v/linzeyi/hivision_idphotos?color=369eff&label=docker&labelColor=black&logoColor=white&style=flat-square\n[dockerhub-link]: https://hub.docker.com/r/linzeyi/hivision_idphotos/tags\n\n[trendshift-shield]: https://trendshift.io/api/badge/repositories/11622\n[trendshift-link]: https://trendshift.io/repositories/11622\n\n[hellogithub-shield]: https://abroad.hellogithub.com/v1/widgets/recommend.svg?rid=8ea1457289fb4062ba661e5299e733d6&claim_uid=Oh5UaGjfrblg0yZ\n[hellogithub-link]: https://hellogithub.com/repository/8ea1457289fb4062ba661e5299e733d6\n\n[github-contributors-shield]: https://img.shields.io/github/contributors/zeyi-lin/hivisionidphotos?color=c4f042&labelColor=black&style=flat-square\n[github-contributors-link]: https://github.com/zeyi-lin/hivisionidphotos/graphs/contributors\n\n[github-forks-shield]: https://img.shields.io/github/forks/zeyi-lin/hivisionidphotos?color=8ae8ff&labelColor=black&style=flat-square\n[github-forks-link]: https://github.com/zeyi-lin/hivisionidphotos/network/members\n\n[modelscope-shield]: https://img.shields.io/badge/Demo_on_ModelScope-purple?logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIzIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCiA8Zz4KICA8dGl0bGU+TGF5ZXIgMTwvdGl0bGU+CiAgPHBhdGggaWQ9InN2Z18xNCIgZmlsbD0iIzYyNGFmZiIgZD0ibTAsODkuODRsMjUuNjUsMGwwLDI1LjY0OTk5bC0yNS42NSwwbDAsLTI1LjY0OTk5eiIvPgogIDxwYXRoIGlkPSJzdmdfMTUiIGZpbGw9IiM2MjRhZmYiIGQ9Im05OS4xNCwxMTUuNDlsMjUuNjUsMGwwLDI1LjY1bC0yNS42NSwwbDAsLTI1LjY1eiIvPgogIDxwYXRoIGlkPSJzdmdfMTYiIGZpbGw9IiM2MjRhZmYiIGQ9Im0xNzYuMDksMTQxLjE0bC0yNS42NDk5OSwwbDAsMjIuMTlsNDcuODQsMGwwLC00Ny44NGwtMjIuMTksMGwwLDI1LjY1eiIvPgogIDxwYXRoIGlkPSJzdmdfMTciIGZpbGw9IiMzNmNmZDEiIGQ9Im0xMjQuNzksODkuODRsMjUuNjUsMGwwLDI1LjY0OTk5bC0yNS42NSwwbDAsLTI1LjY0OTk5eiIvPgogIDxwYXRoIGlkPSJzdmdfMTgiIGZpbGw9IiMzNmNmZDEiIGQ9Im0wLDY0LjE5bDI1LjY1LDBsMCwyNS42NWwtMjUuNjUsMGwwLC0yNS42NXoiLz4KICA8cGF0aCBpZD0ic3ZnXzE5IiBmaWxsPSIjNjI0YWZmIiBkPSJtMTk4LjI4LDg5Ljg0bDI1LjY0OTk5LDBsMCwyNS42NDk5OWwtMjUuNjQ5OTksMGwwLC0yNS42NDk5OXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIwIiBmaWxsPSIjMzZjZmQxIiBkPSJtMTk4LjI4LDY0LjE5bDI1LjY0OTk5LDBsMCwyNS42NWwtMjUuNjQ5OTksMGwwLC0yNS42NXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIxIiBmaWxsPSIjNjI0YWZmIiBkPSJtMTUwLjQ0LDQybDAsMjIuMTlsMjUuNjQ5OTksMGwwLDI1LjY1bDIyLjE5LDBsMCwtNDcuODRsLTQ3Ljg0LDB6Ii8+CiAgPHBhdGggaWQ9InN2Z18yMiIgZmlsbD0iIzM2Y2ZkMSIgZD0ibTczLjQ5LDg5Ljg0bDI1LjY1LDBsMCwyNS42NDk5OWwtMjUuNjUsMGwwLC0yNS42NDk5OXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIzIiBmaWxsPSIjNjI0YWZmIiBkPSJtNDcuODQsNjQuMTlsMjUuNjUsMGwwLC0yMi4xOWwtNDcuODQsMGwwLDQ3Ljg0bDIyLjE5LDBsMCwtMjUuNjV6Ii8+CiAgPHBhdGggaWQ9InN2Z18yNCIgZmlsbD0iIzYyNGFmZiIgZD0ibTQ3Ljg0LDExNS40OWwtMjIuMTksMGwwLDQ3Ljg0bDQ3Ljg0LDBsMCwtMjIuMTlsLTI1LjY1LDBsMCwtMjUuNjV6Ii8+CiA8L2c+Cjwvc3ZnPg==&labelColor=white\n[modelscope-link]: https://modelscope.cn/studios/SwanLab/HivisionIDPhotos\n\n[modelers-shield]: https://img.shields.io/badge/Demo_on_Modelers-c42a2a?logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCAxMjQgNjQiIGZpbGw9Im5vbmUiPgo8cGF0aCBkPSJNNDIuNzc4MyAwSDI2LjU5NzdWMTUuNzc4N0g0Mi43NzgzVjBaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0xNi41MDg4IDQuMTc5MkgwLjMyODEyNVYxOS45NTc5SDE2LjUwODhWNC4xNzkyWiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTIzLjk1MiA0LjE3OTJIMTA3Ljc3MVYxOS45NTc5SDEyMy45NTJWNC4xNzkyWiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTYuNTA4OCA0NS40NjE5SDAuMzI4MTI1VjYxLjI0MDZIMTYuNTA4OFY0NS40NjE5WiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTIzLjk1MiA0NS40NjE5SDEwNy43NzFWNjEuMjQwNkgxMjMuOTUyVjQ1LjQ2MTlaIiBmaWxsPSIjMjQ0OTlDIi8+CjxwYXRoIGQ9Ik0zMi43MDggMTUuNzc4OEgxNi41MjczVjMxLjU1NzVIMzIuNzA4VjE1Ljc3ODhaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik01Mi44NDg2IDE1Ljc3ODhIMzYuNjY4VjMxLjU1NzVINTIuODQ4NlYxNS43Nzg4WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNOTcuNzIzNyAwSDgxLjU0M1YxNS43Nzg3SDk3LjcyMzdWMFoiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTg3LjY1MzQgMTUuNzc4OEg3MS40NzI3VjMxLjU1NzVIODcuNjUzNFYxNS43Nzg4WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNMTA3Ljc5NCAxNS43Nzg4SDkxLjYxMzNWMzEuNTU3NUgxMDcuNzk0VjE1Ljc3ODhaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0yNC42NzQ4IDMxLjU1NzZIOC40OTQxNFY0Ny4zMzYzSDI0LjY3NDhWMzEuNTU3NloiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTYwLjg3OTkgMzEuNTU3Nkg0NC42OTkyVjQ3LjMzNjNINjAuODc5OVYzMS41NTc2WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNNzkuNjIwMSAzMS41NTc2SDYzLjQzOTVWNDcuMzM2M0g3OS42MjAxVjMxLjU1NzZaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0xMTUuODI1IDMxLjU1NzZIOTkuNjQ0NVY0Ny4zMzYzSDExNS44MjVWMzEuNTU3NloiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTcwLjI1NDkgNDcuMzM1OUg1NC4wNzQyVjYzLjExNDdINzAuMjU0OVY0Ny4zMzU5WiIgZmlsbD0iI0RFMDQyOSIvPgo8L3N2Zz4=&labelColor=white\n[modelers-link]: https://modelers.cn/spaces/SwanLab/HivisionIDPhotos"
        },
        {
          "name": "README_KO.md",
          "type": "blob",
          "size": 23.0009765625,
          "content": "<div align=\"center\">\n\n<img alt=\"hivision_logo\" src=\"assets/hivision_logo.png\" width=120 height=120>\n<h1>HivisionIDPhoto</h1>\n\n[English](README_EN.md) / [中文](README.md) / [日本語](README_JP.md) / 한국어\n\n[![][release-shield]][release-link]\n[![][dockerhub-shield]][dockerhub-link]\n[![][github-stars-shield]][github-stars-link]\n[![][github-issues-shield]][github-issues-link]\n[![][github-contributors-shield]][github-contributors-link]\n[![][github-forks-shield]][github-forks-link]\n[![][license-shield]][license-link]  \n[![][wechat-shield]][wechat-link]\n[![][spaces-shield]][spaces-link]\n[![][swanhub-demo-shield]][swanhub-demo-link]\n[![][modelscope-shield]][modelscope-link]\n[![][modelers-shield]][modelers-link]\n\n[![][trendshift-shield]][trendshift-link]\n[![][hellogithub-shield]][hellogithub-link]\n\n<img src=\"assets/demoImage.jpg\" width=900>\n\n</div>\n\n<br>\n\n> **관련 프로젝트**：\n>\n> - [SwanLab](https://github.com/SwanHubX/SwanLab)：인물 컷아웃 모델의 훈련을 통해, 분석과 감시, 연구실 동료들과의 협력 및 교류를 진행하여 훈련 효율성을 크게 향상시켰습니다.\n\n<br>\n\n# 목차\n\n- [최근 업데이트](#-최근-업데이트)\n- [프로젝트 개요](#-프로젝트-개요)\n- [커뮤니티](#-커뮤니티)\n- [준비 작업](#-준비-작업)\n- [데모 실행](#-데모-실행)\n- [Python 추론](#-python-추론)\n- [API 서비스 배포](#️-API-서비스-배포)\n- [Docker 배포](#-docker-배포)\n- [문의하기](#-문의하기)\n- [기여자](#기여자)\n\n<br>\n\n# 🤩 최근 업데이트\n\n- 온라인 체험: [![SwanHub Demo](https://img.shields.io/static/v1?label=Demo&message=SwanHub%20Demo&color=blue)](https://swanhub.co/ZeYiLin/HivisionIDPhotos/demo)、[![Spaces](https://img.shields.io/badge/🤗-Open%20in%20Spaces-blue)](https://huggingface.co/spaces/TheEeeeLin/HivisionIDPhotos)、[![][modelscope-shield]][modelscope-link]\n\n- 2024.11.20: Gradio 데모에 **인쇄 레이아웃** 옵션 추가, 6인치, 5인치, A4, 3R, 4R 레이아웃 크기 지원\n- 2024.11.16: API 인터페이스에 뷰티 효과 매개변수 추가\n- 2024.09.24: API 인터페이스에 base64 이미지 입력 옵션 추가 | Gradio 데모에 **레이아웃 사진 자르기 선** 기능 추가\n- 2024.09.22: Gradio Demo에 **버스트 모드** 및 **DPI** 매개변수 추가\n- 2024.09.18: Gradio Demo에 **템플릿 사진 공유** 기능 추가, **미국식** 배경 옵션 추가\n- 2024.09.17: Gradio Demo에 **커스텀 배경색-HEX 입력** 기능 추가 | **(커뮤니티 기여) C++ 버전** - [HivisionIDPhotos-cpp](https://github.com/zjkhahah/HivisionIDPhotos-cpp) 기여 by [zjkhahah](https://github.com/zjkhahah)\n- 2024.09.16: Gradio Demo에 **얼굴 회전 정렬** 기능 추가, 커스텀 사이즈 입력에 **밀리미터** 단위 추가\n\n<br>\n\n# 프로젝트 개요\n\n> 🚀 우리의 작업에 관심을 가져 주셔서 감사합니다. 이미지 분야의 다른 성과도 꼭 확인해 주시기 바랍니다. 문의는 zeyi.lin@swanhub.co로 해주세요.\n\nHivisionIDPhoto는 실용적이고 체계적인 증명사진의 스마트 제작 알고리즘을 개발하는 것을 목표로 합니다.\n\n다양한 사용자 촬영 장면의 인식, 컷아웃 및 증명사진 생성을 실현하기 위해 일련의 세련된 AI 모델 작업 흐름을 활용하고 있습니다.\n\n**HivisionIDPhoto는 다음과 같은 기능을 제공합니다:**\n\n1. 경량 컷아웃 (완전 오프라인에서, **CPU**만으로 신속한 추론 가능)\n2. 다양한 사이즈 사양에 따라 다양한 표준 증명사진, 육寸 레이아웃 사진 생성\n3. 완전 오프라인 또는 엣지 클라우드 추론 지원\n4. 미용 (대기 중)\n5. 스마트한 정장 변경 (대기 중)\n\n<div align=\"center\">\n<img src=\"assets/demo.png\" width=900>\n</div>\n\n---\n\nHivisionIDPhoto가 여러분에게 도움이 된다면, 이 리포지토리를 스타하거나 친구에게 추천하여 증명사진의 긴급 제작 문제를 해결해 주세요!\n\n<br>\n\n# 🏠 커뮤니티\n\n우리는 커뮤니티에 의해 구축된 HivisionIDPhotos의 흥미로운 애플리케이션 및 확장 기능을 몇 가지 공유합니다:\n\n- [HivisionIDPhotos-ComfyUI](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI): ComfyUI 증명사진 처리 워크플로우, [AIFSH](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI)가 구축\n\n[<img src=\"assets/comfyui.png\" width=\"900\" alt=\"ComfyUI workflow\">](https://github.com/AIFSH/HivisionIDPhotos-ComfyUI)\n\n- [HivisionIDPhotos-wechat-weapp](https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp): WeChat 증명사진 미니 프로그램, HivisionIDphotos 알고리즘 기반, [no1xuan](https://github.com/no1xuan)이 기여\n\n[<img src=\"assets/community-wechat-miniprogram.png\" width=\"900\" alt=\"HivisionIDPhotos-wechat-weapp\">](https://github.com/no1xuan/HivisionIDPhotos-wechat-weapp)\n\n- [HivisionIDPhotos-Uniapp](https://github.com/soulerror/HivisionIDPhotos-Uniapp): 기본 uniapp 증명사진 미니 프로그램 전면, HivisionIDphotos 알고리즘 기반, [soulerror](https://github.com/soulerror)이 기여\n\n[<img src=\"assets/community-uniapp-wechat-miniprogram.png\" width=\"900\" alt=\"HivisionIDPhotos-uniapp\">](https://github.com/soulerror/HivisionIDPhotos-Uniapp)\n\n- [HivisionIDPhotos-cpp](https://github.com/zjkhahah/HivisionIDPhotos-cpp): HivisionIDphotos C++ 버전, [zjkhahah](https://github.com/zjkhahah)이 구축\n- [HivisionIDPhotos-windows-GUI](https://github.com/zhaoyun0071/HivisionIDPhotos-windows-GUI): Windows 클라이언트 애플리케이션, [zhaoyun0071](https://github.com/zhaoyun0071)이 구축\n- [HivisionIDPhotos-NAS](https://github.com/ONG-Leo/HivisionIDPhotos-NAS): Synology NAS 배포 중국어 튜토리얼, [ONG-Leo](https://github.com/ONG-Leo)가 기여\n\n\n<br>\n\n# 🔧 준비 작업\n\n환경 설치 및 의존성:\n- Python >= 3.7 (프로젝트는 주로 python 3.10으로 테스트되었습니다)\n- OS: Linux, Windows, MacOS\n\n## 1. 프로젝트 클론하기\n\n```bash\ngit clone https://github.com/Zeyi-Lin/HivisionIDPhotos.git\ncd  HivisionIDPhotos\n```\n\n## 2. 의존 환경 설치하기\n\n> conda로 python3.10 가상 환경을 만드는 것을 권장합니다. 그 후, 아래의 명령어를 실행해 주세요.\n\n```bash\npip install -r requirements.txt\npip install -r requirements-app.txt\n```\n\n## 3. 가중치 파일 다운로드하기\n\n**방법 1: 스크립트를 통해 다운로드**\n\n```bash\npython scripts/download_model.py --models all\n```\n\n**방법 2: 직접 다운로드**\n\n프로젝트의 `hivision/creator/weights` 디렉토리에 저장합니다:\n- `modnet_photographic_portrait_matting.onnx` (24.7MB): [MODNet](https://github.com/ZHKKKe/MODNet) 공식 가중치, [다운로드](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/modnet_photographic_portrait_matting.onnx)\n- `hivision_modnet.onnx` (24.7MB): 단색 배경에 적응성이 높은 컷아웃 모델, [다운로드](https://github.com/Zeyi-Lin/HivisionIDPhotos/releases/download/pretrained-model/hivision_modnet.onnx)\n- `rmbg-1.4.onnx` (176.2MB): [BRIA AI](https://huggingface.co/briaai/RMBG-1.4)의 오픈 소스 컷아웃 모델, [다운로드](https://huggingface.co/briaai/RMBG-1.4/resolve/main/onnx/model.onnx?download=true) 후에 `rmbg-1.4.onnx`로 이름 변경\n- `birefnet-v1-lite.onnx`(224MB): [ZhengPeng7](https://github.com/ZhengPeng7/BiRefNet)의 오픈 소스 컷아웃 모델, [다운로드](https://github.com/ZhengPeng7/BiRefNet/releases/download/v1/BiRefNet-general-bb_swin_v1_tiny-epoch_232.onnx) 후에 `birefnet-v1-lite.onnx`로 이름 변경\n\n## 4. 얼굴 검출 모델 설정하기 (선택 사항)\n\n| 확장 얼굴 검출 모델 | 설명 | 사용 문서 |\n| -- | -- | -- |\n| MTCNN | **오프라인** 얼굴 검출 모델, 고성능 CPU 추론, 기본 모델, 검출 정확도가 낮음 | 이 프로젝트를 클론한 후 직접 사용 |\n| Face++ | Megvii에서 제공하는 온라인 얼굴 검출 API, 고정밀 검출, [공식 문서](https://console.faceplusplus.com.cn/documents/4888373) | [사용 문서](docs/face++_EN.md)|\n\n## 5. 성능 참조\n\n> 테스트 환경은 Mac M1 Max 64GB, 비GPU 가속, 테스트 이미지 해상도는 512x715(1) 및 764×1146(2)입니다.\n\n| 모델 조합 | 메모리 사용량 | 추론 시간(1) | 추론 시간(2) |\n| -- | -- | -- | -- |\n| MODNet + mtcnn | 410MB | 0.207초 | 0.246초 |\n| MODNet + retinaface | 405MB | 0.571초 | 0.971초 |\n| birefnet-v1-lite + retinaface | 6.20GB | 7.063초 | 7.128초 |\n\n## 6. GPU 추론 가속 (선택 사항)\n\n현재 버전에서 NVIDIA GPU로 가속화할 수 있는 모델은 `birefnet-v1-lite`입니다. 약 16GB의 VRAM이 필요합니다.\n\nNVIDIA GPU를 사용하여 추론을 가속화하려면, CUDA와 cuDNN이 설치되어 있는지 확인한 후, [onnxruntime-gpu 문서](https://onnxruntime.ai/docs/execution-providers/CUDA-ExecutionProvider.html#cuda-12x)에서 해당하는 `onnxruntime-gpu` 버전을 찾아 설치하고, [PyTorch 공식 웹사이트](https://pytorch.org/get-started/locally/)에서 해당하는 `pytorch` 버전을 찾아 설치하세요.\n\n```bash\n# 컴퓨터에 CUDA 12.x와 cuDNN 8이 설치되어 있는 경우\n# 설치 중 torch를 설치하는 것은 선택 사항입니다. cuDNN을 설정할 수 없는 경우 torch를 설치해 보세요.\npip install onnxruntime-gpu==1.18.0\npip install torch --index-url https://download.pytorch.org/whl/cu121\n```\n\n설치 완료 후, `birefnet-v1-lite` 모델을 호출하면 GPU에 의한 추론 가속이 이용됩니다.\n\n> TIPS: CUDA 설치는 하위 호환성이 있습니다. 예를 들어, CUDA 버전이 12.6이고, torch가 현재 지원하는 최대 버전이 12.4인 경우, 컴퓨터에 12.4 버전을 설치할 수 있습니다.\n\n<br>\n\n# 🚀 데모 실행\n\n```bash\npython app.py\n```\n\n프로그램을 실행하면 로컬 웹 페이지가 생성되어 페이지 내에서 증명사진의 조작 및 상호작용이 가능합니다.\n\n<img src=\"assets/harry.png\" width=900>\n\n<br>\n\n# 🚀 Python 추론\n\n핵심 매개변수:\n\n- `-i`: 입력 이미지 경로\n- `-o`: 저장 이미지 경로\n- `-t`: 추론 유형, idphoto, human_matting, add_background, generate_layout_photos 중 선택\n- `--matting_model`: 인물 마스크 모델 가중치 선택\n- `--face_detect_model`: 얼굴 감지 모델 선택\n\n더 많은 매개변수는 `python inference.py --help`를 통해 확인할 수 있습니다.\n\n## 1. 증명사진 제작\n\n1장의 사진을 입력하여 1장의 표준 증명사진과 1장의 고화질 증명사진의 4채널 투명 PNG를 얻습니다.\n\n```python\npython inference.py -i demo/images/test0.jpg -o ./idphoto.png --height 413 --width 295\n```\n\n## 2. 인물 마스크\n\n1장의 사진을 입력하여 1장의 4채널 투명 PNG를 얻습니다.\n\n```python\npython inference.py -t human_matting -i demo/images/test0.jpg -o ./idphoto_matting.png --matting_model hivision_modnet\n```\n\n## 3. 투명 이미지에 배경색 추가\n\n1장의 4채널 투명 PNG를 입력하여 1장의 배경색이 추가된 3채널 이미지를 얻습니다.\n\n```python\npython inference.py -t add_background -i ./idphoto.png -o ./idphoto_ab.jpg  -c 4f83ce -k 30 -r 1\n```\n\n## 4. 6인치 배치 사진 생성\n\n1장의 3채널 사진을 입력하여 1장의 6인치 배치 사진을 얻습니다.\n\n```python\npython inference.py -t generate_layout_photos -i ./idphoto_ab.jpg -o ./idphoto_layout.jpg  --height 413 --width 295 -k 200\n```\n\n## 5. 증명사진 자르기\n\n1장의 4채널 사진(마스크 처리된 이미지)을 입력하여 1장의 표준 증명사진과 1장의 고화질 증명사진의 4채널 투명 PNG를 얻습니다.\n\n```python\npython inference.py -t idphoto_crop -i ./idphoto_matting.png -o ./idphoto_crop.png --height 413 --width 295\n```\n\n<br>\n\n# ⚡️ API 서비스 배포\n\n## 백엔드 시작\n\n```\npython deploy_api.py\n```\n\n## API 서비스에 요청\n\n자세한 요청 방법은 [API 문서](docs/api_EN.md)를 참조해 주세요. 아래의 요청 예시가 포함됩니다:\n- [cURL](docs/api_EN.md#curl-request-examples)\n- [Python](docs/api_EN.md#python-request-example)\n- [Java](docs/api_EN.md#java-request-example)\n- [Javascript](docs/api_EN.md#javascript-request-examples)\n\n<br>\n\n# 🐳 Docker 배포\n\n## 1. 이미지 풀 또는 빌드하기\n\n> 아래의 방법 중 3가지를 선택해 주세요.\n\n**방법 1: 최신 이미지 풀하기:**\n\n```bash\ndocker pull linzeyi/hivision_idphotos\n```\n\n**방법 2: Dockerfile에서 직접 이미지 빌드하기:**\n\n`hivision/creator/weights` 디렉토리에 최소한 하나의 [마스킹 모델 가중치 파일](#3-가중치-파일-다운로드)이 있는지 확인한 후, 프로젝트 루트 디렉토리에서 다음을 실행하세요:\n\n```bash\ndocker build -t linzeyi/hivision_idphotos .\n```\n\n**방법 3: Docker compose로 빌드하기:**\n\n`hivision/creator/weights` 디렉토리에 최소한 하나의 [마스킹 모델 가중치 파일](#3-가중치-파일-다운로드)이 있는지 확인한 후, 프로젝트 루트 디렉토리에서 다음을 실행하세요:\n\n```bash\ndocker compose build\n```\n\n## 2. 서비스 실행\n\n**Gradio 데모 서비스를 시작합니다**\n\n다음 명령어를 실행하여 로컬에서 [http://127.0.0.1:7860](http://127.0.0.1:7860/)에 접근하면 사용 가능합니다.\n\n```bash\ndocker run -d -p 7860:7860 linzeyi/hivision_idphotos\n```\n\n**API 백엔드 서비스를 시작합니다**\n\n```bash\ndocker run -d -p 8080:8080 linzeyi/hivision_idphotos python3 deploy_api.py\n```\n\n**두 개의 서비스를 동시에 시작합니다**\n\n```bash\ndocker compose up -d\n```\n\n## 환경 변수\n\n본 프로젝트는 몇 가지 추가 설정 항목을 제공하며, 환경 변수를 사용하여 설정합니다:\n\n| 환경 변수 | 유형\t| 설명 | 예 |\n|--|--|--|--|\n| FACE_PLUS_API_KEY\t | 선택 사항\t| 이는 Face++ 콘솔에서 신청한 API 키입니다.\t | `7-fZStDJ····` |\n| FACE_PLUS_API_SECRET\t | 선택 사항\t| Face++ API 키에 대응하는 Secret | `VTee824E····` |\n\ndocker에서 환경 변수 사용 예:\n```bash\ndocker run  -d -p 7860:7860 \\\n    -e FACE_PLUS_API_KEY=7-fZStDJ···· \\\n    -e FACE_PLUS_API_SECRET=VTee824E···· \\\n    linzeyi/hivision_idphotos \n```\n\n<br>\n\n# 📖 프로젝트 인용\n\n1. MTCNN:\n\n```bibtex\n@software{ipazc_mtcnn_2021,\n    author = {ipazc},\n    title = {{MTCNN}},\n    url = {https://github.com/ipazc/mtcnn},\n    year = {2021},\n    publisher = {GitHub}\n}\n```\n\n2. ModNet:\n\n```bibtex\n@software{zhkkke_modnet_2021,\n    author = {ZHKKKe},\n    title = {{ModNet}},\n    url = {https://github.com/ZHKKKe/MODNet},\n    year = {2021},\n    publisher = {GitHub}\n}\n```\n\n<br>\n\n# 자주 묻는 질문 (FAQ)\n\n## 1. 기본 크기와 색상을 어떻게 수정하나요?\n\n- 크기: [size_list_EN.csv](demo/assets/size_list_EN.csv) 파일을 수정한 후 `app.py`를 다시 실행하면 됩니다. 첫 번째 열은 크기 이름, 두 번째 열은 높이, 세 번째 열은 너비입니다.\n- 색상: [color_list_EN.csv](demo/assets/color_list_EN.csv) 파일을 수정한 후 `app.py`를 다시 실행하면 됩니다. 첫 번째 열은 색상 이름, 두 번째 열은 Hex 값입니다.\n\n## 2. 워터마크 글꼴을 어떻게 수정하나요?\n\n1. 글꼴 파일을 `hivision/plugin/font` 폴더에 넣습니다.\n2. `hivision/plugin/watermark.py` 파일에서 `font_file` 매개변수 값을 글꼴 파일 이름으로 수정합니다.\n\n## 3. 소셜 미디어 템플릿 사진을 어떻게 추가하나요?\n\n1. 템플릿 이미지를 `hivision/plugin/template/assets` 폴더에 넣습니다. 템플릿 이미지는 4채널 투명 PNG입니다.\n2. `hivision/plugin/template/assets/template_config.json` 파일에 최신 템플릿 정보를 추가합니다. 여기서 `width`는 템플릿 이미지의 너비(px), `height`는 템플릿 이미지의 높이(px), `anchor_points`는 템플릿의 투명 영역 네 모서리의 좌표(px)입니다. `rotation`은 투명 영역의 수직 방향에 대한 회전 각도로, >0은 반시계 방향, <0은 시계 방향입니다.\n3. `demo/processor.py`의 `_generate_image_template` 함수 내의 `TEMPLATE_NAME_LIST` 변수에 최신 템플릿 이름을 추가합니다.\n\n<img src=\"assets/social_template.png\" width=\"500\">\n\n## 4. Gradio Demo의 상단 내비게이션 바를 어떻게 수정하나요?\n\n- `demo/assets/title.md` 파일을 수정합니다.\n\n<br>\n\n# 📧 문의하기\n\n궁금한 점이 있으시면 zeyi.lin@swanhub.co로 이메일을 보내 주세요.\n\n<br>\n\n# 기여자\n\n<a href=\"https://github.com/Zeyi-Lin/HivisionIDPhotos/graphs/contributors\">\n  <img src=\"https://contrib.rocks/image?repo=Zeyi-Lin/HivisionIDPhotos\" />\n</a>\n\n[Zeyi-Lin](https://github.com/Zeyi-Lin)、[SAKURA-CAT](https://github.com/SAKURA-CAT)、[Feudalman](https://github.com/Feudalman)、[swpfY](https://github.com/swpfY)、[Kaikaikaifang](https://github.com/Kaikaikaifang)、[ShaohonChen](https://github.com/ShaohonChen)、[KashiwaByte](https://github.com/KashiwaByte)\n\n<br>\n\n# Thanks for support\n\n[![Stargazers repo roster for @Zeyi-Lin/HivisionIDPhotos](https://reporoster.com/stars/Zeyi-Lin/HivisionIDPhotos)](https://github.com/Zeyi-Lin/HivisionIDPhotos/stargazers)\n\n[![Forkers repo roster for @Zeyi-Lin/HivisionIDPhotos](https://reporoster.com/forks/Zeyi-Lin/HivisionIDPhotos)](https://github.com/Zeyi-Lin/HivisionIDPhotos/network/members)\n\n[![Star History Chart](https://api.star-history.com/svg?repos=Zeyi-Lin/HivisionIDPhotos&type=Date)](https://star-history.com/#Zeyi-Lin/HivisionIDPhotos&Date)\n\n<br>\n\n# Lincese\n\nThis repository is licensed under the [Apache-2.0 License](LICENSE).\n\n[github-stars-shield]: https://img.shields.io/github/stars/zeyi-lin/hivisionidphotos?color=ffcb47&labelColor=black&style=flat-square\n[github-stars-link]: https://github.com/zeyi-lin/hivisionidphotos/stargazers\n\n[swanhub-demo-shield]: https://swanhub.co/git/repo/SwanHub%2FAuto-README/file/preview?ref=main&path=swanhub.svg\n[swanhub-demo-link]: https://swanhub.co/ZeYiLin/HivisionIDPhotos/demo\n\n[spaces-shield]: https://img.shields.io/badge/🤗-Open%20in%20Spaces-blue\n[spaces-link]: https://huggingface.co/spaces/TheEeeeLin/HivisionIDPhotos\n\n<!-- 微信群链接 -->\n[wechat-shield]: https://img.shields.io/badge/WeChat-微信-4cb55e\n[wechat-link]: https://docs.qq.com/doc/DUkpBdk90eWZFS2JW\n\n<!-- Github Release -->\n[release-shield]: https://img.shields.io/github/v/release/zeyi-lin/hivisionidphotos?color=369eff&labelColor=black&logo=github&style=flat-square\n[release-link]: https://github.com/zeyi-lin/hivisionidphotos/releases\n\n[license-shield]: https://img.shields.io/badge/license-apache%202.0-white?labelColor=black&style=flat-square\n[license-link]: https://github.com/Zeyi-Lin/HivisionIDPhotos/blob/master/LICENSE\n\n[github-issues-shield]: https://img.shields.io/github/issues/zeyi-lin/hivisionidphotos?color=ff80eb&labelColor=black&style=flat-square\n[github-issues-link]: https://github.com/zeyi-lin/hivisionidphotos/issues\n\n[dockerhub-shield]: https://img.shields.io/docker/v/linzeyi/hivision_idphotos?color=369eff&label=docker&labelColor=black&logoColor=white&style=flat-square\n[dockerhub-link]: https://hub.docker.com/r/linzeyi/hivision_idphotos/tags\n\n[trendshift-shield]: https://trendshift.io/api/badge/repositories/11622\n[trendshift-link]: https://trendshift.io/repositories/11622\n\n[hellogithub-shield]: https://abroad.hellogithub.com/v1/widgets/recommend.svg?rid=8ea1457289fb4062ba661e5299e733d6&claim_uid=Oh5UaGjfrblg0yZ\n[hellogithub-link]: https://hellogithub.com/repository/8ea1457289fb4062ba661e5299e733d6\n\n[github-contributors-shield]: https://img.shields.io/github/contributors/zeyi-lin/hivisionidphotos?color=c4f042&labelColor=black&style=flat-square\n[github-contributors-link]: https://github.com/zeyi-lin/hivisionidphotos/graphs/contributors\n\n[github-forks-shield]: https://img.shields.io/github/forks/zeyi-lin/hivisionidphotos?color=8ae8ff&labelColor=black&style=flat-square\n[github-forks-link]: https://github.com/zeyi-lin/hivisionidphotos/network/members\n\n[modelscope-shield]: https://img.shields.io/badge/Demo_on_ModelScope-purple?logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIzIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCiA8Zz4KICA8dGl0bGU+TGF5ZXIgMTwvdGl0bGU+CiAgPHBhdGggaWQ9InN2Z18xNCIgZmlsbD0iIzYyNGFmZiIgZD0ibTAsODkuODRsMjUuNjUsMGwwLDI1LjY0OTk5bC0yNS42NSwwbDAsLTI1LjY0OTk5eiIvPgogIDxwYXRoIGlkPSJzdmdfMTUiIGZpbGw9IiM2MjRhZmYiIGQ9Im05OS4xNCwxMTUuNDlsMjUuNjUsMGwwLDI1LjY1bC0yNS42NSwwbDAsLTI1LjY1eiIvPgogIDxwYXRoIGlkPSJzdmdfMTYiIGZpbGw9IiM2MjRhZmYiIGQ9Im0xNzYuMDksMTQxLjE0bC0yNS42NDk5OSwwbDAsMjIuMTlsNDcuODQsMGwwLC00Ny44NGwtMjIuMTksMGwwLDI1LjY1eiIvPgogIDxwYXRoIGlkPSJzdmdfMTciIGZpbGw9IiMzNmNmZDEiIGQ9Im0xMjQuNzksODkuODRsMjUuNjUsMGwwLDI1LjY0OTk5bC0yNS42NSwwbDAsLTI1LjY0OTk5eiIvPgogIDxwYXRoIGlkPSJzdmdfMTgiIGZpbGw9IiMzNmNmZDEiIGQ9Im0wLDY0LjE5bDI1LjY1LDBsMCwyNS42NWwtMjUuNjUsMGwwLC0yNS42NXoiLz4KICA8cGF0aCBpZD0ic3ZnXzE5IiBmaWxsPSIjNjI0YWZmIiBkPSJtMTk4LjI4LDg5Ljg0bDI1LjY0OTk5LDBsMCwyNS42NDk5OWwtMjUuNjQ5OTksMGwwLC0yNS42NDk5OXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIwIiBmaWxsPSIjMzZjZmQxIiBkPSJtMTk4LjI4LDY0LjE5bDI1LjY0OTk5LDBsMCwyNS42NWwtMjUuNjQ5OTksMGwwLC0yNS42NXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIxIiBmaWxsPSIjNjI0YWZmIiBkPSJtMTUwLjQ0LDQybDAsMjIuMTlsMjUuNjQ5OTksMGwwLDI1LjY1bDIyLjE5LDBsMCwtNDcuODRsLTQ3Ljg0LDB6Ii8+CiAgPHBhdGggaWQ9InN2Z18yMiIgZmlsbD0iIzM2Y2ZkMSIgZD0ibTczLjQ5LDg5Ljg0bDI1LjY1LDBsMCwyNS42NDk5OWwtMjUuNjUsMGwwLC0yNS42NDk5OXoiLz4KICA8cGF0aCBpZD0ic3ZnXzIzIiBmaWxsPSIjNjI0YWZmIiBkPSJtNDcuODQsNjQuMTlsMjUuNjUsMGwwLC0yMi4xOWwtNDcuODQsMGwwLDQ3Ljg0bDIyLjE5LDBsMCwtMjUuNjV6Ii8+CiAgPHBhdGggaWQ9InN2Z18yNCIgZmlsbD0iIzYyNGFmZiIgZD0ibTQ3Ljg0LDExNS40OWwtMjIuMTksMGwwLDQ3Ljg0bDQ3Ljg0LDBsMCwtMjIuMTlsLTI1LjY1LDBsMCwtMjUuNjV6Ii8+CiA8L2c+Cjwvc3ZnPg==&labelColor=white\n[modelscope-link]: https://modelscope.cn/studios/SwanLab/HivisionIDPhotos\n\n[modelers-shield]: https://img.shields.io/badge/Demo_on_Modelers-c42a2a?logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCAxMjQgNjQiIGZpbGw9Im5vbmUiPgo8cGF0aCBkPSJNNDIuNzc4MyAwSDI2LjU5NzdWMTUuNzc4N0g0Mi43NzgzVjBaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0xNi41MDg4IDQuMTc5MkgwLjMyODEyNVYxOS45NTc5SDE2LjUwODhWNC4xNzkyWiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTIzLjk1MiA0LjE3OTJIMTA3Ljc3MVYxOS45NTc5SDEyMy45NTJWNC4xNzkyWiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTYuNTA4OCA0NS40NjE5SDAuMzI4MTI1VjYxLjI0MDZIMTYuNTA4OFY0NS40NjE5WiIgZmlsbD0iIzI0NDk5QyIvPgo8cGF0aCBkPSJNMTIzLjk1MiA0NS40NjE5SDEwNy43NzFWNjEuMjQwNkgxMjMuOTUyVjQ1LjQ2MTlaIiBmaWxsPSIjMjQ0OTlDIi8+CjxwYXRoIGQ9Ik0zMi43MDggMTUuNzc4OEgxNi41MjczVjMxLjU1NzVIMzIuNzA4VjE1Ljc3ODhaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik01Mi44NDg2IDE1Ljc3ODhIMzYuNjY4VjMxLjU1NzVINTIuODQ4NlYxNS43Nzg4WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNOTcuNzIzNyAwSDgxLjU0M1YxNS43Nzg3SDk3LjcyMzdWMFoiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTg3LjY1MzQgMTUuNzc4OEg3MS40NzI3VjMxLjU1NzVIODcuNjUzNFYxNS43Nzg4WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNMTA3Ljc5NCAxNS43Nzg4SDkxLjYxMzNWMzEuNTU3NUgxMDcuNzk0VjE1Ljc3ODhaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0yNC42NzQ4IDMxLjU1NzZIOC40OTQxNFY0Ny4zMzYzSDI0LjY3NDhWMzEuNTU3NloiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTYwLjg3OTkgMzEuNTU3Nkg0NC42OTkyVjQ3LjMzNjNINjAuODc5OVYzMS41NTc2WiIgZmlsbD0iI0RFMDQyOSIvPgo8cGF0aCBkPSJNNzkuNjIwMSAzMS41NTc2SDYzLjQzOTVWNDcuMzM2M0g3OS42MjAxVjMxLjU1NzZaIiBmaWxsPSIjREUwNDI5Ii8+CjxwYXRoIGQ9Ik0xMTUuODI1IDMxLjU1NzZIOTkuNjQ0NVY0Ny4zMzYzSDExNS44MjVWMzEuNTU3NloiIGZpbGw9IiNERTA0MjkiLz4KPHBhdGggZD0iTTcwLjI1NDkgNDcuMzM1OUg1NC4wNzQyVjYzLjExNDdINzAuMjU0OVY0Ny4zMzU5WiIgZmlsbD0iI0RFMDQyOSIvPgo8L3N2Zz4=&labelColor=white\n[modelers-link]: https://modelers.cn/spaces/SwanLab/HivisionIDPhotos"
        },
        {
          "name": "app.py",
          "type": "blob",
          "size": 2.5126953125,
          "content": "import argparse\nimport os\nfrom demo.processor import IDPhotoProcessor\nfrom demo.ui import create_ui\nfrom hivision.creator.choose_handler import HUMAN_MATTING_MODELS\n\nroot_dir = os.path.dirname(os.path.abspath(__file__))\n\n# 获取存在的人像分割模型列表\n# 通过检查 hivision/creator/weights 目录下的 .onnx 和 .mnn 文件\n# 只保留文件名（不包括扩展名）\nHUMAN_MATTING_MODELS_EXIST = [\n    os.path.splitext(file)[0]\n    for file in os.listdir(os.path.join(root_dir, \"hivision/creator/weights\"))\n    if file.endswith(\".onnx\") or file.endswith(\".mnn\")\n]\n# 在HUMAN_MATTING_MODELS中的模型才会被加载到Gradio中显示\nHUMAN_MATTING_MODELS_CHOICE = [\n    model for model in HUMAN_MATTING_MODELS if model in HUMAN_MATTING_MODELS_EXIST\n]\n\nif len(HUMAN_MATTING_MODELS_CHOICE) == 0:\n    raise ValueError(\n        \"未找到任何存在的人像分割模型，请检查 hivision/creator/weights 目录下的文件\"\n        + \"\\n\"\n        + \"No existing portrait segmentation model was found, please check the files in the hivision/creator/weights directory.\"\n    )\n\nFACE_DETECT_MODELS = [\"face++ (联网Online API)\", \"mtcnn\"]\nFACE_DETECT_MODELS_EXPAND = (\n    [\"retinaface-resnet50\"]\n    if os.path.exists(\n        os.path.join(\n            root_dir, \"hivision/creator/retinaface/weights/retinaface-resnet50.onnx\"\n        )\n    )\n    else []\n)\nFACE_DETECT_MODELS_CHOICE = FACE_DETECT_MODELS + FACE_DETECT_MODELS_EXPAND\n\nLANGUAGE = [\"zh\", \"en\", \"ko\", \"ja\"]\n\nif __name__ == \"__main__\":\n    argparser = argparse.ArgumentParser()\n    argparser.add_argument(\n        \"--port\", type=int, default=7860, help=\"The port number of the server\"\n    )\n    argparser.add_argument(\n        \"--host\", type=str, default=\"127.0.0.1\", help=\"The host of the server\"\n    )\n    argparser.add_argument(\n        \"--root_path\",\n        type=str,\n        default=None,\n        help=\"The root path of the server, default is None (='/'), e.g. '/myapp'\",\n    )\n    args = argparser.parse_args()\n\n    processor = IDPhotoProcessor()\n\n    demo = create_ui(\n        processor,\n        root_dir,\n        HUMAN_MATTING_MODELS_CHOICE,\n        FACE_DETECT_MODELS_CHOICE,\n        LANGUAGE,\n    )\n    \n    # 如果RUN_MODE是Beast，打印已开启野兽模式\n    if os.getenv(\"RUN_MODE\") == \"beast\":\n        print(\"[Beast mode activated.] 已开启野兽模式。\")\n\n    demo.launch(\n        server_name=args.host,\n        server_port=args.port,\n        favicon_path=os.path.join(root_dir, \"assets/hivision_logo.png\"),\n        root_path=args.root_path,\n        show_api=False,\n    )\n"
        },
        {
          "name": "app.spec",
          "type": "blob",
          "size": 0.923828125,
          "content": "# -*- mode: python ; coding: utf-8 -*-\nfrom PyInstaller.utils.hooks import collect_data_files\n\ndatas = [('hivisionai', 'hivisionai'), ('hivision_modnet.onnx', '.'), ('size_list_CN.csv', '.')]\ndatas += collect_data_files('gradio_client')\ndatas += collect_data_files('gradio')\n\n\na = Analysis(\n    ['app/web.py'],\n    pathex=[],\n    binaries=[],\n    datas=datas,\n    hiddenimports=[],\n    hookspath=[],\n    hooksconfig={},\n    runtime_hooks=[],\n    excludes=[],\n    noarchive=False,\n    optimize=0,\n)\npyz = PYZ(a.pure)\n\nexe = EXE(\n    pyz,\n    a.scripts,\n    a.binaries,\n    a.datas,\n    [],\n    name='HivisionIDPhotos',\n    debug=False,\n    bootloader_ignore_signals=False,\n    strip=False,\n    upx=True,\n    upx_exclude=[],\n    runtime_tmpdir=None,\n    console=True,\n    disable_windowed_traceback=False,\n    argv_emulation=False,\n    target_arch=None,\n    codesign_identity=None,\n    entitlements_file=None,\n    icon=['assets\\hivisionai.ico'],\n)\n"
        },
        {
          "name": "assets",
          "type": "tree",
          "content": null
        },
        {
          "name": "demo",
          "type": "tree",
          "content": null
        },
        {
          "name": "deploy_api.py",
          "type": "blob",
          "size": 11.3994140625,
          "content": "from fastapi import FastAPI, UploadFile, Form, File\nfrom hivision import IDCreator\nfrom hivision.error import FaceError\nfrom hivision.creator.layout_calculator import (\n    generate_layout_array,\n    generate_layout_image,\n)\nfrom hivision.creator.choose_handler import choose_handler\nfrom hivision.utils import (\n    add_background,\n    resize_image_to_kb,\n    bytes_2_base64,\n    base64_2_numpy,\n    hex_to_rgb,\n    add_watermark,\n    save_image_dpi_to_bytes,\n)\nimport numpy as np\nimport cv2\nfrom starlette.middleware.cors import CORSMiddleware\n\napp = FastAPI()\ncreator = IDCreator()\n\n# 添加 CORS 中间件 解决跨域问题\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],  # 允许的请求来源\n    allow_credentials=True,  # 允许携带 Cookie\n    allow_methods=[\n        \"*\"\n    ],  # 允许的请求方法，例如：GET, POST 等，也可以指定 [\"GET\", \"POST\"]\n    allow_headers=[\"*\"],  # 允许的请求头，也可以指定具体的头部\n)\n\n\n# 证件照智能制作接口\n@app.post(\"/idphoto\")\nasync def idphoto_inference(\n    input_image: UploadFile = File(None),\n    input_image_base64: str = Form(None),\n    height: int = Form(413),\n    width: int = Form(295),\n    human_matting_model: str = Form(\"modnet_photographic_portrait_matting\"),\n    face_detect_model: str = Form(\"mtcnn\"),\n    hd: bool = Form(True),\n    dpi: int = Form(300),\n    face_align: bool = Form(False),\n    head_measure_ratio: float = Form(0.2),\n    head_height_ratio: float = Form(0.45),\n    top_distance_max: float = Form(0.12),\n    top_distance_min: float = Form(0.10),\n    brightness_strength: float = Form(0),\n    contrast_strength: float = Form(0),\n    sharpen_strength: float = Form(0),\n    saturation_strength: float = Form(0),\n):  \n    # 如果传入了base64，则直接使用base64解码\n    if input_image_base64:\n        img = base64_2_numpy(input_image_base64)\n    # 否则使用上传的图片\n    else:\n        image_bytes = await input_image.read()\n        nparr = np.frombuffer(image_bytes, np.uint8)\n        img = cv2.imdecode(nparr, cv2.IMREAD_COLOR)\n\n    # ------------------- 选择抠图与人脸检测模型 -------------------\n    choose_handler(creator, human_matting_model, face_detect_model)\n\n    # 将字符串转为元组\n    size = (int(height), int(width))\n    try:\n        result = creator(\n            img,\n            size=size,\n            head_measure_ratio=head_measure_ratio,\n            head_height_ratio=head_height_ratio,\n            head_top_range=(top_distance_max, top_distance_min),\n            face_alignment=face_align,\n            brightness_strength=brightness_strength,\n            contrast_strength=contrast_strength,\n            sharpen_strength=sharpen_strength,\n            saturation_strength=saturation_strength,\n        )\n    except FaceError:\n        result_message = {\"status\": False}\n    # 如果检测到人脸数量等于1, 则返回标准证和高清照结果（png 4通道图像）\n    else:\n        result_image_standard_bytes = save_image_dpi_to_bytes(cv2.cvtColor(result.standard, cv2.COLOR_RGBA2BGRA), None, dpi)\n        \n        result_message = {\n            \"status\": True,\n            \"image_base64_standard\": bytes_2_base64(result_image_standard_bytes),\n        }\n\n        # 如果hd为True, 则增加高清照结果（png 4通道图像）\n        if hd:\n            result_image_hd_bytes = save_image_dpi_to_bytes(cv2.cvtColor(result.hd, cv2.COLOR_RGBA2BGRA), None, dpi)\n            result_message[\"image_base64_hd\"] = bytes_2_base64(result_image_hd_bytes)\n\n    return result_message\n\n\n# 人像抠图接口\n@app.post(\"/human_matting\")\nasync def human_matting_inference(\n    input_image: UploadFile = File(None),\n    input_image_base64: str = Form(None),\n    human_matting_model: str = Form(\"hivision_modnet\"),\n    dpi: int = Form(300),\n):\n    if input_image_base64:\n        img = base64_2_numpy(input_image_base64)\n    else:\n        image_bytes = await input_image.read()\n        nparr = np.frombuffer(image_bytes, np.uint8)\n        img = cv2.imdecode(nparr, cv2.IMREAD_COLOR)\n\n    # ------------------- 选择抠图与人脸检测模型 -------------------\n    choose_handler(creator, human_matting_model, None)\n\n    try:\n        result = creator(\n            img,\n            change_bg_only=True,\n        )\n    except FaceError:\n        result_message = {\"status\": False}\n\n    else:\n        result_image_standard_bytes = save_image_dpi_to_bytes(cv2.cvtColor(result.standard, cv2.COLOR_RGBA2BGRA), None, dpi)\n        result_message = {\n            \"status\": True,\n            \"image_base64\": bytes_2_base64(result_image_standard_bytes),\n        }\n    return result_message\n\n\n# 透明图像添加纯色背景接口\n@app.post(\"/add_background\")\nasync def photo_add_background(\n    input_image: UploadFile = File(None),\n    input_image_base64: str = Form(None),\n    color: str = Form(\"000000\"),\n    kb: int = Form(None),\n    dpi: int = Form(300),\n    render: int = Form(0),\n):\n    render_choice = [\"pure_color\", \"updown_gradient\", \"center_gradient\"]\n\n    if input_image_base64:\n        img = base64_2_numpy(input_image_base64)\n    else:\n        image_bytes = await input_image.read()\n        nparr = np.frombuffer(image_bytes, np.uint8)\n        img = cv2.imdecode(nparr, cv2.IMREAD_UNCHANGED)\n\n    color = hex_to_rgb(color)\n    color = (color[2], color[1], color[0])\n\n    result_image = add_background(\n        img,\n        bgr=color,\n        mode=render_choice[render],\n    ).astype(np.uint8)\n\n    result_image = cv2.cvtColor(result_image, cv2.COLOR_RGB2BGR)\n    if kb:\n        result_image_bytes = resize_image_to_kb(result_image, None, int(kb), dpi=dpi)\n    else:\n        result_image_bytes = save_image_dpi_to_bytes(result_image, None, dpi=dpi)\n\n    result_messgae = {\n        \"status\": True,\n        \"image_base64\": bytes_2_base64(result_image_bytes),\n    }\n\n    return result_messgae\n\n\n# 六寸排版照生成接口\n@app.post(\"/generate_layout_photos\")\nasync def generate_layout_photos(\n    input_image: UploadFile = File(None),\n    input_image_base64: str = Form(None),\n    height: int = Form(413),\n    width: int = Form(295),\n    kb: int = Form(None),\n    dpi: int = Form(300),\n):\n    # try:\n    if input_image_base64:\n        img = base64_2_numpy(input_image_base64)\n    else:\n        image_bytes = await input_image.read()\n        nparr = np.frombuffer(image_bytes, np.uint8)\n        img = cv2.imdecode(nparr, cv2.IMREAD_COLOR)\n\n    size = (int(height), int(width))\n\n    typography_arr, typography_rotate = generate_layout_array(\n        input_height=size[0], input_width=size[1]\n    )\n\n    result_layout_image = generate_layout_image(\n        img, typography_arr, typography_rotate, height=size[0], width=size[1]\n    ).astype(np.uint8)\n\n    result_layout_image = cv2.cvtColor(result_layout_image, cv2.COLOR_RGB2BGR)\n    if kb:\n        result_layout_image_bytes = resize_image_to_kb(\n            result_layout_image, None, int(kb), dpi=dpi\n        )\n    else:\n        result_layout_image_bytes = save_image_dpi_to_bytes(result_layout_image, None, dpi=dpi)\n        \n    result_layout_image_base64 = bytes_2_base64(result_layout_image_bytes)\n\n    result_messgae = {\n        \"status\": True,\n        \"image_base64\": result_layout_image_base64,\n    }\n\n    return result_messgae\n\n\n# 透明图像添加水印接口\n@app.post(\"/watermark\")\nasync def watermark(\n    input_image: UploadFile = File(None),\n    input_image_base64: str = Form(None),\n    text: str = Form(\"Hello\"),\n    size: int = 20,\n    opacity: float = 0.5,\n    angle: int = 30,\n    color: str = \"#000000\",\n    space: int = 25,\n    kb: int = Form(None),\n    dpi: int = Form(300),\n):\n    if input_image_base64:\n        img = base64_2_numpy(input_image_base64)\n    else:\n        image_bytes = await input_image.read()\n        nparr = np.frombuffer(image_bytes, np.uint8)\n        img = cv2.imdecode(nparr, cv2.IMREAD_COLOR)\n\n    try:\n        result_image = add_watermark(img, text, size, opacity, angle, color, space)\n\n        result_image = cv2.cvtColor(result_image, cv2.COLOR_RGB2BGR)\n        if kb:\n            result_image_bytes = resize_image_to_kb(result_image, None, int(kb), dpi=dpi)\n        else:\n            result_image_bytes = save_image_dpi_to_bytes(result_image, None, dpi=dpi)\n        result_image_base64 = bytes_2_base64(result_image_bytes)\n\n        result_messgae = {\n            \"status\": True,\n            \"image_base64\": result_image_base64,\n        }\n    except Exception as e:\n        result_messgae = {\n            \"status\": False,\n            \"error\": str(e),\n        }\n\n    return result_messgae\n\n\n# 设置照片KB值接口(RGB图)\n@app.post(\"/set_kb\")\nasync def set_kb(\n    input_image: UploadFile = File(None),\n    input_image_base64: str = Form(None),\n    dpi: int = Form(300),\n    kb: int = Form(50),\n):\n    if input_image_base64:\n        img = base64_2_numpy(input_image_base64)\n    else:\n        image_bytes = await input_image.read()\n        nparr = np.frombuffer(image_bytes, np.uint8)\n        img = cv2.imdecode(nparr, cv2.IMREAD_COLOR)\n\n    try:\n        result_image = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)\n        result_image_bytes = resize_image_to_kb(result_image, None, int(kb), dpi=dpi)\n        result_image_base64 = bytes_2_base64(result_image_bytes)\n\n        result_messgae = {\n            \"status\": True,\n            \"image_base64\": result_image_base64,\n        }\n    except Exception as e:\n        result_messgae = {\n            \"status\": False,\n            \"error\": e,\n        }\n\n    return result_messgae\n\n\n# 证件照智能裁剪接口\n@app.post(\"/idphoto_crop\")\nasync def idphoto_crop_inference(\n    input_image: UploadFile = File(None),\n    input_image_base64: str = Form(None),\n    height: int = Form(413),\n    width: int = Form(295),\n    face_detect_model: str = Form(\"mtcnn\"),\n    hd: bool = Form(True),\n    dpi: int = Form(300),\n    head_measure_ratio: float = Form(0.2),\n    head_height_ratio: float = Form(0.45),\n    top_distance_max: float = Form(0.12),\n    top_distance_min: float = Form(0.10),\n):\n    if input_image_base64:\n        img = base64_2_numpy(input_image_base64)\n    else:\n        image_bytes = await input_image.read()\n        nparr = np.frombuffer(image_bytes, np.uint8)\n        img = cv2.imdecode(nparr, cv2.IMREAD_UNCHANGED)  # 读取图像(4通道)\n\n    # ------------------- 选择抠图与人脸检测模型 -------------------\n    choose_handler(creator, face_detect_option=face_detect_model)\n\n    # 将字符串转为元组\n    size = (int(height), int(width))\n    try:\n        result = creator(\n            img,\n            size=size,\n            head_measure_ratio=head_measure_ratio,\n            head_height_ratio=head_height_ratio,\n            head_top_range=(top_distance_max, top_distance_min),\n            crop_only=True,\n        )\n    except FaceError:\n        result_message = {\"status\": False}\n    # 如果检测到人脸数量等于1, 则返回标准证和高清照结果（png 4通道图像）\n    else:\n        result_image_standard_bytes = save_image_dpi_to_bytes(cv2.cvtColor(result.standard, cv2.COLOR_RGBA2BGRA), None, dpi)\n        \n        result_message = {\n            \"status\": True,\n            \"image_base64_standard\": bytes_2_base64(result_image_standard_bytes),\n        }\n\n        # 如果hd为True, 则增加高清照结果（png 4通道图像）\n        if hd:\n            result_image_hd_bytes = save_image_dpi_to_bytes(cv2.cvtColor(result.hd, cv2.COLOR_RGBA2BGRA), None, dpi)\n            result_message[\"image_base64_hd\"] = bytes_2_base64(result_image_hd_bytes)\n\n    return result_message\n\n\nif __name__ == \"__main__\":\n    import uvicorn\n\n    # 在8080端口运行推理服务\n    uvicorn.run(app, host=\"0.0.0.0\", port=8080)\n"
        },
        {
          "name": "docker-compose.yml",
          "type": "blob",
          "size": 0.40625,
          "content": "version: '3.8'\n\nservices:\n  hivision_idphotos:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    image: linzeyi/hivision_idphotos\n    command: python3 -u app.py --host 0.0.0.0 --port 7860\n    ports:\n      - '7860:7860'\n\n  hivision_idphotos_api:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    image: linzeyi/hivision_idphotos\n    command: python3 deploy_api.py\n    ports:\n      - '8080:8080'\n"
        },
        {
          "name": "docs",
          "type": "tree",
          "content": null
        },
        {
          "name": "hivision",
          "type": "tree",
          "content": null
        },
        {
          "name": "inference.py",
          "type": "blob",
          "size": 5.7802734375,
          "content": "import os\nimport cv2\nimport argparse\nimport numpy as np\nfrom hivision.error import FaceError\nfrom hivision.utils import hex_to_rgb, resize_image_to_kb, add_background, save_image_dpi_to_bytes\nfrom hivision import IDCreator\nfrom hivision.creator.layout_calculator import (\n    generate_layout_array,\n    generate_layout_image,\n)\nfrom hivision.creator.choose_handler import choose_handler\nfrom hivision.utils import hex_to_rgb, resize_image_to_kb\n\n\nINFERENCE_TYPE = [\n    \"idphoto\",\n    \"human_matting\",\n    \"add_background\",\n    \"generate_layout_photos\",\n    \"idphoto_crop\",\n]\nMATTING_MODEL = [\n    \"hivision_modnet\",\n    \"modnet_photographic_portrait_matting\",\n    \"mnn_hivision_modnet\",\n    \"rmbg-1.4\",\n    \"birefnet-v1-lite\",\n]\nFACE_DETECT_MODEL = [\n    \"mtcnn\",\n    \"face_plusplus\",\n    \"retinaface-resnet50\",\n]\nRENDER = [0, 1, 2]\n\nparser = argparse.ArgumentParser(description=\"HivisionIDPhotos 证件照制作推理程序。\")\nparser.add_argument(\n    \"-t\",\n    \"--type\",\n    help=\"请求 API 的种类\",\n    choices=INFERENCE_TYPE,\n    default=\"idphoto\",\n)\nparser.add_argument(\"-i\", \"--input_image_dir\", help=\"输入图像路径\", required=True)\nparser.add_argument(\"-o\", \"--output_image_dir\", help=\"保存图像路径\", required=True)\nparser.add_argument(\"--height\", help=\"证件照尺寸-高\", default=413)\nparser.add_argument(\"--width\", help=\"证件照尺寸-宽\", default=295)\nparser.add_argument(\"-c\", \"--color\", help=\"证件照背景色\", default=\"638cce\")\nparser.add_argument(\"--hd\", type=bool, help=\"是否输出高清照\", default=True)\nparser.add_argument(\n    \"-k\", \"--kb\", help=\"输出照片的 KB 值，仅对换底和制作排版照生效\", default=None\n)\nparser.add_argument(\n    \"-r\",\n    \"--render\",\n    type=int,\n    help=\"底色合成的模式，有 0:纯色、1:上下渐变、2:中心渐变 可选\",\n    choices=RENDER,\n    default=0,\n)\nparser.add_argument(\n    \"--dpi\",\n    type=int,\n    help=\"输出照片的 DPI 值\",\n    default=300,\n)\nparser.add_argument(\n    \"--face_align\",\n    type=bool,\n    help=\"是否进行人脸旋转矫正\",\n    default=False,\n)\nparser.add_argument(\n    \"--matting_model\",\n    help=\"抠图模型权重\",\n    default=\"modnet_photographic_portrait_matting\",\n    choices=MATTING_MODEL,\n)\nparser.add_argument(\n    \"--face_detect_model\",\n    help=\"人脸检测模型\",\n    default=\"mtcnn\",\n    choices=FACE_DETECT_MODEL,\n)\n\nargs = parser.parse_args()\n\n# ------------------- 选择抠图与人脸检测模型 -------------------\ncreator = IDCreator()\nchoose_handler(creator, args.matting_model, args.face_detect_model)\n\nroot_dir = os.path.dirname(os.path.abspath(__file__))\ninput_image = cv2.imread(args.input_image_dir, cv2.IMREAD_UNCHANGED)\n\n# 如果模式是生成证件照\nif args.type == \"idphoto\":\n    # 将字符串转为元组\n    size = (int(args.height), int(args.width))\n    try:\n        result = creator(input_image, size=size, face_alignment=args.face_align)\n    except FaceError:\n        print(\"人脸数量不等于 1，请上传单张人脸的图像。\")\n    else:\n        # 保存标准照\n        save_image_dpi_to_bytes(cv2.cvtColor(result.standard, cv2.COLOR_RGBA2BGRA), args.output_image_dir, dpi=args.dpi)\n\n        # 保存高清照\n        file_name, file_extension = os.path.splitext(args.output_image_dir)\n        new_file_name = file_name + \"_hd\" + file_extension\n        save_image_dpi_to_bytes(cv2.cvtColor(result.hd, cv2.COLOR_RGBA2BGRA), new_file_name, dpi=args.dpi)\n\n# 如果模式是人像抠图\nelif args.type == \"human_matting\":\n    result = creator(input_image, change_bg_only=True)\n    cv2.imwrite(args.output_image_dir, result.hd)\n\n# 如果模式是添加背景\nelif args.type == \"add_background\":\n\n    render_choice = [\"pure_color\", \"updown_gradient\", \"center_gradient\"]\n\n    # 将字符串转为元组\n    color = hex_to_rgb(args.color)\n    # 将元祖的 0 和 2 号数字交换\n    color = (color[2], color[1], color[0])\n\n    result_image = add_background(\n        input_image, bgr=color, mode=render_choice[args.render]\n    )\n    result_image = result_image.astype(np.uint8)\n    result_image = cv2.cvtColor(result_image, cv2.COLOR_RGBA2BGRA)\n    \n    if args.kb:\n        resize_image_to_kb(result_image, args.output_image_dir, int(args.kb), dpi=args.dpi)\n    else:\n        save_image_dpi_to_bytes(cv2.cvtColor(result_image, cv2.COLOR_RGBA2BGRA), args.output_image_dir, dpi=args.dpi)\n\n# 如果模式是生成排版照\nelif args.type == \"generate_layout_photos\":\n\n    size = (int(args.height), int(args.width))\n\n    typography_arr, typography_rotate = generate_layout_array(\n        input_height=size[0], input_width=size[1]\n    )\n\n    result_layout_image = generate_layout_image(\n        input_image,\n        typography_arr,\n        typography_rotate,\n        height=size[0],\n        width=size[1],\n    )\n\n    if args.kb:\n        result_layout_image = cv2.cvtColor(result_layout_image, cv2.COLOR_RGB2BGR)\n        result_layout_image = resize_image_to_kb(\n            result_layout_image, args.output_image_dir, int(args.kb), dpi=args.dpi\n        )\n    else:\n        save_image_dpi_to_bytes(cv2.cvtColor(result_layout_image, cv2.COLOR_RGBA2BGRA), args.output_image_dir, dpi=args.dpi)\n\n# 如果模式是证件照裁切\nelif args.type == \"idphoto_crop\":\n    # 将字符串转为元组\n    size = (int(args.height), int(args.width))\n    try:\n        result = creator(input_image, size=size, crop_only=True)\n    except FaceError:\n        print(\"人脸数量不等于 1，请上传单张人脸的图像。\")\n    else:\n        # 保存标准照\n        save_image_dpi_to_bytes(cv2.cvtColor(result.standard, cv2.COLOR_RGBA2BGRA), args.output_image_dir, dpi=args.dpi)\n\n        # 保存高清照\n        file_name, file_extension = os.path.splitext(args.output_image_dir)\n        new_file_name = file_name + \"_hd\" + file_extension\n        save_image_dpi_to_bytes(cv2.cvtColor(result.hd, cv2.COLOR_RGBA2BGRA), new_file_name, dpi=args.dpi)"
        },
        {
          "name": "requirements-app.txt",
          "type": "blob",
          "size": 0.021484375,
          "content": "gradio>=4.43.0\nfastapi"
        },
        {
          "name": "requirements-dev.txt",
          "type": "blob",
          "size": 0.0048828125,
          "content": "black"
        },
        {
          "name": "requirements.txt",
          "type": "blob",
          "size": 0.09375,
          "content": "opencv-python>=4.8.1.78\nonnxruntime>=1.15.0\nnumpy<=1.26.4\nrequests\nmtcnn-runtime\ntqdm\nstarlette\n"
        },
        {
          "name": "scripts",
          "type": "tree",
          "content": null
        },
        {
          "name": "test",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}