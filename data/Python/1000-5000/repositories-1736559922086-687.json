{
  "metadata": {
    "timestamp": 1736559922086,
    "page": 687,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjY5MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "dataabc/weibo-crawler",
      "stars": 3569,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".dockerignore",
          "type": "blob",
          "size": 7.1328125,
          "content": "### Project ###\n.dockerignore\n.git*\njs.json\nlog/\nweibo/\n\n# Created by https://www.toptal.com/developers/gitignore/api/python,jetbrains,visualstudiocode,windows,macos,linux\n# Edit at https://www.toptal.com/developers/gitignore?templates=python,jetbrains,visualstudiocode,windows,macos,linux\n\n### JetBrains ###\n# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio, WebStorm and Rider\n# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839\n\n# User-specific stuff\n.idea/**/workspace.xml\n.idea/**/tasks.xml\n.idea/**/usage.statistics.xml\n.idea/**/dictionaries\n.idea/**/shelf\n\n# AWS User-specific\n.idea/**/aws.xml\n\n# Generated files\n.idea/**/contentModel.xml\n\n# Sensitive or high-churn files\n.idea/**/dataSources/\n.idea/**/dataSources.ids\n.idea/**/dataSources.local.xml\n.idea/**/sqlDataSources.xml\n.idea/**/dynamic.xml\n.idea/**/uiDesigner.xml\n.idea/**/dbnavigator.xml\n\n# Gradle\n.idea/**/gradle.xml\n.idea/**/libraries\n\n# Gradle and Maven with auto-import\n# When using Gradle or Maven with auto-import, you should exclude module files,\n# since they will be recreated, and may cause churn.  Uncomment if using\n# auto-import.\n# .idea/artifacts\n# .idea/compiler.xml\n# .idea/jarRepositories.xml\n# .idea/modules.xml\n# .idea/*.iml\n# .idea/modules\n# *.iml\n# *.ipr\n\n# CMake\ncmake-build-*/\n\n# Mongo Explorer plugin\n.idea/**/mongoSettings.xml\n\n# File-based project format\n*.iws\n\n# IntelliJ\nout/\n\n# mpeltonen/sbt-idea plugin\n.idea_modules/\n\n# JIRA plugin\natlassian-ide-plugin.xml\n\n# Cursive Clojure plugin\n.idea/replstate.xml\n\n# SonarLint plugin\n.idea/sonarlint/\n\n# Crashlytics plugin (for Android Studio and IntelliJ)\ncom_crashlytics_export_strings.xml\ncrashlytics.properties\ncrashlytics-build.properties\nfabric.properties\n\n# Editor-based Rest Client\n.idea/httpRequests\n\n# Android studio 3.1+ serialized cache file\n.idea/caches/build_file_checksums.ser\n\n### JetBrains Patch ###\n# Comment Reason: https://github.com/joeblau/gitignore.io/issues/186#issuecomment-215987721\n\n# *.iml\n# modules.xml\n# .idea/misc.xml\n# *.ipr\n\n# Sonarlint plugin\n# https://plugins.jetbrains.com/plugin/7973-sonarlint\n.idea/**/sonarlint/\n\n# SonarQube Plugin\n# https://plugins.jetbrains.com/plugin/7238-sonarqube-community-plugin\n.idea/**/sonarIssues.xml\n\n# Markdown Navigator plugin\n# https://plugins.jetbrains.com/plugin/7896-markdown-navigator-enhanced\n.idea/**/markdown-navigator.xml\n.idea/**/markdown-navigator-enh.xml\n.idea/**/markdown-navigator/\n\n# Cache file creation bug\n# See https://youtrack.jetbrains.com/issue/JBR-2257\n.idea/$CACHE_FILE$\n\n# CodeStream plugin\n# https://plugins.jetbrains.com/plugin/12206-codestream\n.idea/codestream.xml\n\n### Linux ###\n*~\n\n# temporary files which can be created if a process still has a handle open of a deleted file\n.fuse_hidden*\n\n# KDE directory preferences\n.directory\n\n# Linux trash folder which might appear on any partition or disk\n.Trash-*\n\n# .nfs files are created when an open file is removed but is still being accessed\n.nfs*\n\n### macOS ###\n# General\n.DS_Store\n.AppleDouble\n.LSOverride\n\n# Icon must end with two \\r\nIcon\n\n\n# Thumbnails\n._*\n\n# Files that might appear in the root of a volume\n.DocumentRevisions-V100\n.fseventsd\n.Spotlight-V100\n.TemporaryItems\n.Trashes\n.VolumeIcon.icns\n.com.apple.timemachine.donotpresent\n\n# Directories potentially created on remote AFP share\n.AppleDB\n.AppleDesktop\nNetwork Trash Folder\nTemporary Items\n.apdisk\n\n### macOS Patch ###\n# iCloud generated files\n*.icloud\n\n### Python ###\n# Byte-compiled / optimized / DLL files\n__pycache__/\n*.py[cod]\n*$py.class\n\n# C extensions\n*.so\n\n# Distribution / packaging\n.Python\nbuild/\ndevelop-eggs/\ndist/\ndownloads/\neggs/\n.eggs/\nlib/\nlib64/\nparts/\nsdist/\nvar/\nwheels/\nshare/python-wheels/\n*.egg-info/\n.installed.cfg\n*.egg\nMANIFEST\n\n# PyInstaller\n#  Usually these files are written by a python script from a template\n#  before PyInstaller builds the exe, so as to inject date/other infos into it.\n*.manifest\n*.spec\n\n# Installer logs\npip-log.txt\npip-delete-this-directory.txt\n\n# Unit test / coverage reports\nhtmlcov/\n.tox/\n.nox/\n.coverage\n.coverage.*\n.cache\nnosetests.xml\ncoverage.xml\n*.cover\n*.py,cover\n.hypothesis/\n.pytest_cache/\ncover/\n\n# Translations\n*.mo\n*.pot\n\n# Django stuff:\n*.log\nlocal_settings.py\ndb.sqlite3\ndb.sqlite3-journal\n\n# Flask stuff:\ninstance/\n.webassets-cache\n\n# Scrapy stuff:\n.scrapy\n\n# Sphinx documentation\ndocs/_build/\n\n# PyBuilder\n.pybuilder/\ntarget/\n\n# Jupyter Notebook\n.ipynb_checkpoints\n\n# IPython\nprofile_default/\nipython_config.py\n\n# pyenv\n#   For a library or package, you might want to ignore these files since the code is\n#   intended to run in multiple environments; otherwise, check them in:\n# .python-version\n\n# pipenv\n#   According to pypa/pipenv#598, it is recommended to include Pipfile.lock in version control.\n#   However, in case of collaboration, if having platform-specific dependencies or dependencies\n#   having no cross-platform support, pipenv may install dependencies that don't work, or not\n#   install all needed dependencies.\n#Pipfile.lock\n\n# poetry\n#   Similar to Pipfile.lock, it is generally recommended to include poetry.lock in version control.\n#   This is especially recommended for binary packages to ensure reproducibility, and is more\n#   commonly ignored for libraries.\n#   https://python-poetry.org/docs/basic-usage/#commit-your-poetrylock-file-to-version-control\n#poetry.lock\n\n# pdm\n#   Similar to Pipfile.lock, it is generally recommended to include pdm.lock in version control.\n#pdm.lock\n#   pdm stores project-wide configurations in .pdm.toml, but it is recommended to not include it\n#   in version control.\n#   https://pdm.fming.dev/#use-with-ide\n.pdm.toml\n\n# PEP 582; used by e.g. github.com/David-OConnor/pyflow and github.com/pdm-project/pdm\n__pypackages__/\n\n# Celery stuff\ncelerybeat-schedule\ncelerybeat.pid\n\n# SageMath parsed files\n*.sage.py\n\n# Environments\n.env\n.venv\nenv/\nvenv/\nENV/\nenv.bak/\nvenv.bak/\n\n# Spyder project settings\n.spyderproject\n.spyproject\n\n# Rope project settings\n.ropeproject\n\n# mkdocs documentation\n/site\n\n# mypy\n.mypy_cache/\n.dmypy.json\ndmypy.json\n\n# Pyre type checker\n.pyre/\n\n# pytype static type analyzer\n.pytype/\n\n# Cython debug symbols\ncython_debug/\n\n# PyCharm\n#  JetBrains specific template is maintained in a separate JetBrains.gitignore that can\n#  be found at https://github.com/github/gitignore/blob/main/Global/JetBrains.gitignore\n#  and can be added to the global gitignore or merged into this file.  For a more nuclear\n#  option (not recommended) you can uncomment the following to ignore the entire idea folder.\n#.idea/\n\n### VisualStudioCode ###\n.vscode/\n\n# Local History for Visual Studio Code\n.history/\n\n# Built Visual Studio Code Extensions\n*.vsix\n\n### VisualStudioCode Patch ###\n# Ignore all local history of files\n.history\n.ionide\n\n# Support for Project snippet scope\n.vscode/*.code-snippets\n\n# Ignore code-workspaces\n*.code-workspace\n\n### Windows ###\n# Windows thumbnail cache files\nThumbs.db\nThumbs.db:encryptable\nehthumbs.db\nehthumbs_vista.db\n\n# Dump file\n*.stackdump\n\n# Folder config file\n[Dd]esktop.ini\n\n# Recycle Bin used on file shares\n$RECYCLE.BIN/\n\n# Windows Installer files\n*.cab\n*.msi\n*.msix\n*.msm\n*.msp\n\n# Windows shortcuts\n*.lnk\n\n# End of https://www.toptal.com/developers/gitignore/api/python,jetbrains,visualstudiocode,windows,macos,linux"
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 7.2451171875,
          "content": "### Project ###\nlog/\nweibo/\n\n# Created by https://www.toptal.com/developers/gitignore/api/python,jetbrains,visualstudiocode,windows,macos,linux\n# Edit at https://www.toptal.com/developers/gitignore?templates=python,jetbrains,visualstudiocode,windows,macos,linux\n\n### JetBrains ###\n# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio, WebStorm and Rider\n# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839\n\n# User-specific stuff\n.idea/**/workspace.xml\n.idea/**/tasks.xml\n.idea/**/usage.statistics.xml\n.idea/**/dictionaries\n.idea/**/shelf\n\n# AWS User-specific\n.idea/**/aws.xml\n\n# Generated files\n.idea/**/contentModel.xml\n\n# Sensitive or high-churn files\n.idea/**/dataSources/\n.idea/**/dataSources.ids\n.idea/**/dataSources.local.xml\n.idea/**/sqlDataSources.xml\n.idea/**/dynamic.xml\n.idea/**/uiDesigner.xml\n.idea/**/dbnavigator.xml\n\n# Gradle\n.idea/**/gradle.xml\n.idea/**/libraries\n\n# Gradle and Maven with auto-import\n# When using Gradle or Maven with auto-import, you should exclude module files,\n# since they will be recreated, and may cause churn.  Uncomment if using\n# auto-import.\n# .idea/artifacts\n# .idea/compiler.xml\n# .idea/jarRepositories.xml\n# .idea/modules.xml\n# .idea/*.iml\n# .idea/modules\n# *.iml\n# *.ipr\n\n# CMake\ncmake-build-*/\n\n# Mongo Explorer plugin\n.idea/**/mongoSettings.xml\n\n# File-based project format\n*.iws\n\n# IntelliJ\nout/\n\n# mpeltonen/sbt-idea plugin\n.idea_modules/\n\n# JIRA plugin\natlassian-ide-plugin.xml\n\n# Cursive Clojure plugin\n.idea/replstate.xml\n\n# SonarLint plugin\n.idea/sonarlint/\n\n# Crashlytics plugin (for Android Studio and IntelliJ)\ncom_crashlytics_export_strings.xml\ncrashlytics.properties\ncrashlytics-build.properties\nfabric.properties\n\n# Editor-based Rest Client\n.idea/httpRequests\n\n# Android studio 3.1+ serialized cache file\n.idea/caches/build_file_checksums.ser\n\n### JetBrains Patch ###\n# Comment Reason: https://github.com/joeblau/gitignore.io/issues/186#issuecomment-215987721\n\n# *.iml\n# modules.xml\n# .idea/misc.xml\n# *.ipr\n\n# Sonarlint plugin\n# https://plugins.jetbrains.com/plugin/7973-sonarlint\n.idea/**/sonarlint/\n\n# SonarQube Plugin\n# https://plugins.jetbrains.com/plugin/7238-sonarqube-community-plugin\n.idea/**/sonarIssues.xml\n\n# Markdown Navigator plugin\n# https://plugins.jetbrains.com/plugin/7896-markdown-navigator-enhanced\n.idea/**/markdown-navigator.xml\n.idea/**/markdown-navigator-enh.xml\n.idea/**/markdown-navigator/\n\n# Cache file creation bug\n# See https://youtrack.jetbrains.com/issue/JBR-2257\n.idea/$CACHE_FILE$\n\n# CodeStream plugin\n# https://plugins.jetbrains.com/plugin/12206-codestream\n.idea/codestream.xml\n\n### Linux ###\n*~\n\n# temporary files which can be created if a process still has a handle open of a deleted file\n.fuse_hidden*\n\n# KDE directory preferences\n.directory\n\n# Linux trash folder which might appear on any partition or disk\n.Trash-*\n\n# .nfs files are created when an open file is removed but is still being accessed\n.nfs*\n\n### macOS ###\n# General\n.DS_Store\n.AppleDouble\n.LSOverride\n\n# Icon must end with two \\r\nIcon\n\n\n# Thumbnails\n._*\n\n# Files that might appear in the root of a volume\n.DocumentRevisions-V100\n.fseventsd\n.Spotlight-V100\n.TemporaryItems\n.Trashes\n.VolumeIcon.icns\n.com.apple.timemachine.donotpresent\n\n# Directories potentially created on remote AFP share\n.AppleDB\n.AppleDesktop\nNetwork Trash Folder\nTemporary Items\n.apdisk\n\n### macOS Patch ###\n# iCloud generated files\n*.icloud\n\n### Python ###\n# Byte-compiled / optimized / DLL files\n__pycache__/\n*.py[cod]\n*$py.class\n\n# C extensions\n*.so\n\n# Distribution / packaging\n.Python\nbuild/\ndevelop-eggs/\ndist/\ndownloads/\neggs/\n.eggs/\nlib/\nlib64/\nparts/\nsdist/\nvar/\nwheels/\nshare/python-wheels/\n*.egg-info/\n.installed.cfg\n*.egg\nMANIFEST\n\n# PyInstaller\n#  Usually these files are written by a python script from a template\n#  before PyInstaller builds the exe, so as to inject date/other infos into it.\n*.manifest\n*.spec\n\n# Installer logs\npip-log.txt\npip-delete-this-directory.txt\n\n# Unit test / coverage reports\nhtmlcov/\n.tox/\n.nox/\n.coverage\n.coverage.*\n.cache\nnosetests.xml\ncoverage.xml\n*.cover\n*.py,cover\n.hypothesis/\n.pytest_cache/\ncover/\n\n# Translations\n*.mo\n*.pot\n\n# Django stuff:\n*.log\nlocal_settings.py\ndb.sqlite3\ndb.sqlite3-journal\n\n# Flask stuff:\ninstance/\n.webassets-cache\n\n# Scrapy stuff:\n.scrapy\n\n# Sphinx documentation\ndocs/_build/\n\n# PyBuilder\n.pybuilder/\ntarget/\n\n# Jupyter Notebook\n.ipynb_checkpoints\n\n# IPython\nprofile_default/\nipython_config.py\n\n# pyenv\n#   For a library or package, you might want to ignore these files since the code is\n#   intended to run in multiple environments; otherwise, check them in:\n# .python-version\n\n# pipenv\n#   According to pypa/pipenv#598, it is recommended to include Pipfile.lock in version control.\n#   However, in case of collaboration, if having platform-specific dependencies or dependencies\n#   having no cross-platform support, pipenv may install dependencies that don't work, or not\n#   install all needed dependencies.\n#Pipfile.lock\n\n# poetry\n#   Similar to Pipfile.lock, it is generally recommended to include poetry.lock in version control.\n#   This is especially recommended for binary packages to ensure reproducibility, and is more\n#   commonly ignored for libraries.\n#   https://python-poetry.org/docs/basic-usage/#commit-your-poetrylock-file-to-version-control\n#poetry.lock\n\n# pdm\n#   Similar to Pipfile.lock, it is generally recommended to include pdm.lock in version control.\n#pdm.lock\n#   pdm stores project-wide configurations in .pdm.toml, but it is recommended to not include it\n#   in version control.\n#   https://pdm.fming.dev/#use-with-ide\n.pdm.toml\n\n# PEP 582; used by e.g. github.com/David-OConnor/pyflow and github.com/pdm-project/pdm\n__pypackages__/\n\n# Celery stuff\ncelerybeat-schedule\ncelerybeat.pid\n\n# SageMath parsed files\n*.sage.py\n\n# Environments\n.env\n.venv\nenv/\nvenv/\nENV/\nenv.bak/\nvenv.bak/\n\n# Spyder project settings\n.spyderproject\n.spyproject\n\n# Rope project settings\n.ropeproject\n\n# mkdocs documentation\n/site\n\n# mypy\n.mypy_cache/\n.dmypy.json\ndmypy.json\n\n# Pyre type checker\n.pyre/\n\n# pytype static type analyzer\n.pytype/\n\n# Cython debug symbols\ncython_debug/\n\n# PyCharm\n#  JetBrains specific template is maintained in a separate JetBrains.gitignore that can\n#  be found at https://github.com/github/gitignore/blob/main/Global/JetBrains.gitignore\n#  and can be added to the global gitignore or merged into this file.  For a more nuclear\n#  option (not recommended) you can uncomment the following to ignore the entire idea folder.\n#.idea/\n\n### VisualStudioCode ###\n.vscode/*\n!.vscode/settings.json\n!.vscode/tasks.json\n!.vscode/launch.json\n!.vscode/extensions.json\n!.vscode/*.code-snippets\n\n# Local History for Visual Studio Code\n.history/\n\n# Built Visual Studio Code Extensions\n*.vsix\n\n### VisualStudioCode Patch ###\n# Ignore all local history of files\n.history\n.ionide\n\n# Support for Project snippet scope\n.vscode/*.code-snippets\n\n# Ignore code-workspaces\n*.code-workspace\n\n### Windows ###\n# Windows thumbnail cache files\nThumbs.db\nThumbs.db:encryptable\nehthumbs.db\nehthumbs_vista.db\n\n# Dump file\n*.stackdump\n\n# Folder config file\n[Dd]esktop.ini\n\n# Recycle Bin used on file shares\n$RECYCLE.BIN/\n\n# Windows Installer files\n*.cab\n*.msi\n*.msix\n*.msm\n*.msp\n\n# Windows shortcuts\n*.lnk\n\n# End of https://www.toptal.com/developers/gitignore/api/python,jetbrains,visualstudiocode,windows,macos,linux\n\n\njs.json\nuser_id_list.txt\n"
        },
        {
          "name": ".vscode",
          "type": "tree",
          "content": null
        },
        {
          "name": "API.md",
          "type": "blob",
          "size": 7.771484375,
          "content": "# Weibo API è¯´æ˜æ–‡æ¡£\n\næœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†åŸºäº Flask æ¡†æ¶æ„å»ºçš„ Weibo API çš„å„ä¸ªç«¯ç‚¹åŠå…¶ä½¿ç”¨æ–¹æ³•ã€‚API ä¸»è¦ç”¨äºåˆ·æ–°å¾®åšæ•°æ®ã€æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ä»¥åŠè·å–å¾®åšä¿¡æ¯ã€‚\n\n## ç›®å½•\n1. [æ¦‚è¿°](#æ¦‚è¿°)\n2. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)\n3. [API ç«¯ç‚¹](#api-ç«¯ç‚¹)\n    - [åˆ·æ–°å¾®åšæ•°æ®](#åˆ·æ–°å¾®åšæ•°æ®)\n    - [æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€](#æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€)\n    - [è·å–æ‰€æœ‰å¾®åš](#è·å–æ‰€æœ‰å¾®åš)\n    - [è·å–å•æ¡å¾®åšè¯¦æƒ…](#è·å–å•æ¡å¾®åšè¯¦æƒ…)\n4. [å®šæ—¶ä»»åŠ¡](#å®šæ—¶ä»»åŠ¡)\n5. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)\n6. [æ—¥å¿—è®°å½•](#æ—¥å¿—è®°å½•)\n\n---\n\n## æ¦‚è¿°\n\nè¯¥ API æ—¨åœ¨é€šè¿‡å®šæ—¶ä»»åŠ¡å’Œæ‰‹åŠ¨è§¦å‘çš„ä»»åŠ¡æ¥æŠ“å–å’Œç®¡ç†å¾®åšæ•°æ®ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š\n- åˆ·æ–°æŒ‡å®šç”¨æˆ·çš„å¾®åšæ•°æ®\n- æŸ¥è¯¢ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€\n- è·å–æ‰€æœ‰æŠ“å–åˆ°çš„å¾®åš\n- è·å–å•æ¡å¾®åšçš„è¯¦ç»†ä¿¡æ¯\n\n## é…ç½®è¯´æ˜\n\nåœ¨è¿è¡Œ API ä¹‹å‰ï¼Œéœ€è¦é…ç½®service.pyç›¸å…³å‚æ•°ã€‚é…ç½®é¡¹åŒ…æ‹¬ç”¨æˆ·IDåˆ—è¡¨ã€æ•°æ®åº“è·¯å¾„ã€æ—¥å¿—é…ç½®ã€ä¸‹è½½é€‰é¡¹ç­‰ã€‚\n\nä»¥ä¸‹æ˜¯ä¸»è¦é…ç½®é¡¹çš„è¯´æ˜ï¼š\n\n```python\nconfig = {\n    \"user_id_list\": [\n        \"6067225218\", \n        \"1445403190\"\n    ],\n    \"only_crawl_original\": 1,\n    \"since_date\": 1,\n    \"start_page\": 1,\n    \"write_mode\": [\n        \"csv\",\n        \"json\",\n        \"sqlite\"\n    ],\n    \"original_pic_download\": 0,\n    \"retweet_pic_download\": 0,\n    \"original_video_download\": 0,\n    \"retweet_video_download\": 0,\n    \"download_comment\": 0,\n    \"comment_max_download_count\": 100,\n    \"download_repost\": 0,\n    \"repost_max_download_count\": 100,\n    \"user_id_as_folder_name\": 0,\n    \"remove_html_tag\": 1,\n    \"cookie\": \"your weibo cookie\",\n    \"mysql_config\": {\n        \"host\": \"localhost\",\n        \"port\": 3306,\n        \"user\": \"root\",\n        \"password\": \"123456\",\n        \"charset\": \"utf8mb4\"\n    },\n    \"mongodb_URI\": \"mongodb://[username:password@]host[:port][/[defaultauthdb][?options]]\",\n    \"post_config\": {\n        \"api_url\": \"https://api.example.com\",\n        \"api_token\": \"\"\n    }\n}\n```\n\n- **user_id_list**: éœ€è¦æŠ“å–å¾®åšçš„ç”¨æˆ·IDåˆ—è¡¨ã€‚\n- **only_crawl_original**: æ˜¯å¦ä»…æŠ“å–åŸåˆ›å¾®åšï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **since_date**: èµ·å§‹æ—¥æœŸã€‚\n- **start_page**: èµ·å§‹é¡µç ã€‚\n- **write_mode**: æ•°æ®å­˜å‚¨æ¨¡å¼ï¼Œå¯é€‰æ‹© CSVã€JSONã€SQLite ç­‰ã€‚\n- **original_pic_download**: æ˜¯å¦ä¸‹è½½åŸåˆ›å¾®åšçš„å›¾ç‰‡ï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **retweet_pic_download**: æ˜¯å¦ä¸‹è½½è½¬å‘å¾®åšçš„å›¾ç‰‡ï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **original_video_download**: æ˜¯å¦ä¸‹è½½åŸåˆ›å¾®åšçš„è§†é¢‘ï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **retweet_video_download**: æ˜¯å¦ä¸‹è½½è½¬å‘å¾®åšçš„è§†é¢‘ï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **download_comment**: æ˜¯å¦ä¸‹è½½è¯„è®ºï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **comment_max_download_count**: è¯„è®ºçš„æœ€å¤§ä¸‹è½½æ•°é‡ã€‚\n- **download_repost**: æ˜¯å¦ä¸‹è½½è½¬å‘ä¿¡æ¯ï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **repost_max_download_count**: è½¬å‘çš„æœ€å¤§ä¸‹è½½æ•°é‡ã€‚\n- **user_id_as_folder_name**: æ˜¯å¦ä½¿ç”¨ç”¨æˆ·IDä½œä¸ºæ–‡ä»¶å¤¹åç§°ï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **remove_html_tag**: æ˜¯å¦ç§»é™¤HTMLæ ‡ç­¾ï¼ˆ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ï¼‰ã€‚\n- **cookie**: ç”¨äºè®¤è¯çš„å¾®åšCookieã€‚\n- **mysql_config**: MySQLæ•°æ®åº“çš„é…ç½®ä¿¡æ¯ã€‚\n- **mongodb_URI**: MongoDBçš„è¿æ¥URIã€‚\n- **post_config**: POSTè¯·æ±‚çš„é…ç½®ï¼ŒåŒ…æ‹¬API URLå’ŒTokenã€‚\n\n## API ç«¯ç‚¹\n\n### åˆ·æ–°å¾®åšæ•°æ®\n\n**URL:** `/refresh`\n\n**æ–¹æ³•:** `POST`\n\n**æè¿°:** æ‰‹åŠ¨è§¦å‘åˆ·æ–°æŒ‡å®šç”¨æˆ·çš„å¾®åšæ•°æ®ã€‚\n\n**è¯·æ±‚å‚æ•°:**\n\n- `user_id_list` (å¯é€‰): éœ€è¦åˆ·æ–°å¾®åšæ•°æ®çš„ç”¨æˆ·IDåˆ—è¡¨ã€‚æ ¼å¼ä¸ºJSONæ•°ç»„ã€‚ä¾‹å¦‚ï¼š\n  ```json\n  {\n      \"user_id_list\": [\"6067225218\", \"1445403190\"]\n  }\n  ```\n\n**å“åº”:**\n\n- **202 Accepted**\n  ```json\n  {\n      \"task_id\": \"ä»»åŠ¡ID\",\n      \"status\": \"Task started\",\n      \"state\": \"PENDING\",\n      \"progress\": 0,\n      \"user_id_list\": [\"6067225218\", \"1445403190\"]\n  }\n  ```\n- **400 Bad Request** (å‚æ•°æ— æ•ˆ)\n  ```json\n  {\n      \"error\": \"Invalid user_id_list parameter\"\n  }\n  ```\n- **409 Conflict** (å·²æœ‰ä»»åŠ¡åœ¨è¿è¡Œ)\n  ```json\n  {\n      \"task_id\": \"å½“å‰è¿è¡Œçš„ä»»åŠ¡ID\",\n      \"status\": \"Task already running\",\n      \"state\": \"PROGRESS\",\n      \"progress\": 50\n  }\n  ```\n\n### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€\n\n**URL:** `/task/<task_id>`\n\n**æ–¹æ³•:** `GET`\n\n**æè¿°:** æŸ¥è¯¢æŒ‡å®šä»»åŠ¡çš„çŠ¶æ€å’Œè¿›åº¦ã€‚\n\n**URL å‚æ•°:**\n\n- `task_id` (å¿…éœ€): éœ€è¦æŸ¥è¯¢çš„ä»»åŠ¡IDã€‚\n\n**å“åº”:**\n\n- **200 OK**\n  ```json\n  {\n      \"state\": \"ä»»åŠ¡çŠ¶æ€\",\n      \"progress\": è¿›åº¦ç™¾åˆ†æ¯”,\n      \"result\": {\n          \"message\": \"å¾®åšåˆ—è¡¨å·²åˆ·æ–°\"\n      }\n  }\n  ```\n  æˆ–è€…åœ¨ä»»åŠ¡å¤±è´¥æ—¶ï¼š\n  ```json\n  {\n      \"state\": \"FAILED\",\n      \"progress\": 50,\n      \"error\": \"é”™è¯¯ä¿¡æ¯\"\n  }\n  ```\n- **404 Not Found** (ä»»åŠ¡ä¸å­˜åœ¨)\n  ```json\n  {\n      \"error\": \"Task not found\"\n  }\n  ```\n\n### è·å–æ‰€æœ‰å¾®åš\n\n**URL:** `/weibos`\n\n**æ–¹æ³•:** `GET`\n\n**æè¿°:** è·å–æ•°æ®åº“ä¸­æ‰€æœ‰æŠ“å–åˆ°çš„å¾®åšï¼ŒæŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—ã€‚\n\n**å“åº”:**\n\n- **200 OK**\n  ```json\n  [\n      {\n          \"id\": \"å¾®åšID\",\n          \"content\": \"å¾®åšå†…å®¹\",\n          \"created_at\": \"åˆ›å»ºæ—¶é—´\",\n          ...\n      },\n      ...\n  ]\n  ```\n- **500 Internal Server Error** (æœåŠ¡å™¨é”™è¯¯)\n  ```json\n  {\n      \"error\": \"é”™è¯¯ä¿¡æ¯\"\n  }\n  ```\n\n### è·å–å•æ¡å¾®åšè¯¦æƒ…\n\n**URL:** `/weibos/<weibo_id>`\n\n**æ–¹æ³•:** `GET`\n\n**æè¿°:** è·å–æŒ‡å®šIDçš„å¾®åšè¯¦ç»†ä¿¡æ¯ã€‚\n\n**URL å‚æ•°:**\n\n- `weibo_id` (å¿…éœ€): éœ€è¦è·å–çš„å¾®åšIDã€‚\n\n**å“åº”:**\n\n- **200 OK**\n  ```json\n  {\n      \"id\": \"å¾®åšID\",\n      \"content\": \"å¾®åšå†…å®¹\",\n      \"created_at\": \"åˆ›å»ºæ—¶é—´\",\n      ...\n  }\n  ```\n- **404 Not Found** (å¾®åšä¸å­˜åœ¨)\n  ```json\n  {\n      \"error\": \"Weibo not found\"\n  }\n  ```\n- **500 Internal Server Error** (æœåŠ¡å™¨é”™è¯¯)\n  ```json\n  {\n      \"error\": \"é”™è¯¯ä¿¡æ¯\"\n  }\n  ```\n\n## å®šæ—¶ä»»åŠ¡\n\nAPI å¯åŠ¨åï¼Œä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹ï¼Œæ¯éš”10åˆ†é’Ÿè‡ªåŠ¨è§¦å‘ä¸€æ¬¡åˆ·æ–°ä»»åŠ¡ï¼Œä»¥ç¡®ä¿å¾®åšæ•°æ®çš„åŠæ—¶æ›´æ–°ã€‚å¦‚æœå½“å‰æœ‰ä»»åŠ¡æ­£åœ¨è¿è¡Œï¼Œå®šæ—¶ä»»åŠ¡ä¼šè·³è¿‡æœ¬æ¬¡æ‰§è¡Œã€‚\n\n**å®šæ—¶ä»»åŠ¡è¡Œä¸º:**\n- æ£€æŸ¥æ˜¯å¦æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ã€‚\n- å¦‚æœæ²¡æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„åˆ·æ–°ä»»åŠ¡ã€‚\n- å¦‚æœæœ‰ä»»åŠ¡åœ¨è¿è¡Œï¼Œåˆ™ç­‰å¾…ä¸‹ä¸€ä¸ªå‘¨æœŸã€‚\n\n**é”™è¯¯å¤„ç†:**\n- å¦‚æœå®šæ—¶ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè®°å½•æ—¥å¿—å¹¶åœ¨1åˆ†é’Ÿåé‡è¯•ã€‚\n\n## é”™è¯¯å¤„ç†\n\nAPI åœ¨å¤„ç†è¯·æ±‚æ—¶å¯èƒ½ä¼šé‡åˆ°å„ç§é”™è¯¯ï¼Œä¸»è¦åŒ…æ‹¬ï¼š\n\n- **400 Bad Request:** è¯·æ±‚å‚æ•°æ— æ•ˆã€‚\n- **404 Not Found:** è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ï¼ˆå¦‚ä»»åŠ¡IDæˆ–å¾®åšIDï¼‰ã€‚\n- **409 Conflict:** èµ„æºå†²çªï¼Œå¦‚å·²æœ‰ä»»åŠ¡åœ¨è¿è¡Œã€‚\n- **500 Internal Server Error:** æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚\n\né”™è¯¯å“åº”çš„æ ¼å¼ç»Ÿä¸€ä¸ºåŒ…å« `error` å­—æ®µçš„ JSON å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š\n\n```json\n{\n    \"error\": \"é”™è¯¯ä¿¡æ¯\"\n}\n```\n\n## æ—¥å¿—è®°å½•\n\nAPI ä½¿ç”¨ Python çš„ `logging` æ¨¡å—è¿›è¡Œæ—¥å¿—è®°å½•ã€‚æ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨ `log/` ç›®å½•ä¸‹ï¼Œé»˜è®¤æ—¥å¿—é…ç½®æ–‡ä»¶ä¸º `logging.conf`ã€‚ä¸»è¦è®°å½•ä»¥ä¸‹å†…å®¹ï¼š\n\n- æœåŠ¡å¯åŠ¨å’Œå…³é—­æ—¥å¿—\n- ä»»åŠ¡çš„å¯åŠ¨ã€å®Œæˆå’Œå¤±è´¥æ—¥å¿—\n- å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µ\n- å¼‚å¸¸å’Œé”™è¯¯ä¿¡æ¯\n\nç¡®ä¿ `log/` ç›®å½•å­˜åœ¨ï¼ŒAPI ä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºè¯¥ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ã€‚\n\n---\n\n## å¯åŠ¨å’Œè¿è¡Œ\n\nç¡®ä¿æ‰€æœ‰ä¾èµ–åº“å·²å®‰è£…ï¼Œå¹¶æ­£ç¡®é…ç½®äº† `logging.conf` æ–‡ä»¶å’Œæ•°æ®åº“è·¯å¾„ã€‚å¯åŠ¨ API çš„å‘½ä»¤å¦‚ä¸‹ï¼š\n\n```bash\npython service.py\n```\n\nAPI å°†åœ¨é»˜è®¤çš„ `5000` ç«¯å£å¯åŠ¨ï¼Œå¹¶è‡ªåŠ¨å¼€å§‹ç›‘å¬è¯·æ±‚å’Œæ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚\n\n---\n\n## æ³¨æ„äº‹é¡¹\n\n- **å¹¶å‘ä»»åŠ¡æ§åˆ¶:** API é™åˆ¶åŒä¸€æ—¶é—´åªèƒ½è¿è¡Œä¸€ä¸ªåˆ·æ–°ä»»åŠ¡ï¼Œä»¥é¿å…æ•°æ®å†²çªå’Œèµ„æºç«äº‰ã€‚\n- **æ•°æ®å­˜å‚¨:** é»˜è®¤ä½¿ç”¨ SQLite æ•°æ®åº“å­˜å‚¨å¾®åšæ•°æ®ï¼Œé…ç½®ä¸­å¯æ ¹æ®éœ€è¦è°ƒæ•´ä¸ºå…¶ä»–å­˜å‚¨æ–¹å¼ï¼ˆå¦‚ MySQLã€MongoDBï¼‰ã€‚\n- **å®‰å…¨æ€§:** ç¡®ä¿ `cookie` å’Œæ•°æ®åº“çš„æ•æ„Ÿä¿¡æ¯å®‰å…¨å­˜å‚¨ï¼Œé¿å…æ³„éœ²ã€‚\n\nå¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜ï¼Œè¯·å‚è€ƒæºä»£ç ä¸­çš„æ³¨é‡Šæˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚\n"
        },
        {
          "name": "Dockerfile",
          "type": "blob",
          "size": 0.3544921875,
          "content": "# è®¾ç½®åŸºç¡€é•œåƒ\nFROM python:3.12.0-alpine\n\n# è®¾ç½®å·¥ä½œç›®å½•\nWORKDIR /app\n\n# å¤åˆ¶é¡¹ç›®æ–‡ä»¶åˆ°å·¥ä½œç›®å½•\nCOPY requirements.txt .\n\n# å®‰è£…ä¾èµ–åŒ…\nRUN pip install --no-cache-dir -r requirements.txt\n\n# å¤åˆ¶é¡¹ç›®æ–‡ä»¶åˆ°å·¥ä½œç›®å½•\nCOPY . .\n\n# è®¾ç½®å¾ªç¯é—´éš”\nENV schedule_interval=1\n\n# è¿è¡Œåº”ç”¨\nCMD python __main__.py $schedule_interval\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 48.16015625,
          "content": "# Weibo Crawler\n\n- [Weibo Crawler](#weibo-crawler)\n  - [åŠŸèƒ½](#åŠŸèƒ½)\n  - [è¾“å‡º](#è¾“å‡º)\n  - [å®ä¾‹](#å®ä¾‹)\n  - [è¿è¡Œç¯å¢ƒ](#è¿è¡Œç¯å¢ƒ)\n  - [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)\n    - [1.ä¸‹è½½è„šæœ¬](#1ä¸‹è½½è„šæœ¬)\n    - [2.å®‰è£…ä¾èµ–](#2å®‰è£…ä¾èµ–)\n    - [3.ç¨‹åºè®¾ç½®](#3ç¨‹åºè®¾ç½®)\n    - [4.è®¾ç½®æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰](#4è®¾ç½®æ•°æ®åº“å¯é€‰)\n    - [5.è¿è¡Œè„šæœ¬](#5è¿è¡Œè„šæœ¬)\n    - [6.æŒ‰éœ€æ±‚ä¿®æ”¹è„šæœ¬ï¼ˆå¯é€‰ï¼‰](#6æŒ‰éœ€æ±‚ä¿®æ”¹è„šæœ¬å¯é€‰)\n    - [7.å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšï¼ˆå¯é€‰ï¼‰](#7å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšå¯é€‰)\n    - [8.ä½¿ç”¨docker](#8ä½¿ç”¨docker)\n  - [å¦‚ä½•è·å–user_id](#å¦‚ä½•è·å–user_id)\n  - [æ·»åŠ cookieä¸ä¸æ·»åŠ cookieçš„åŒºåˆ«ï¼ˆå¯é€‰ï¼‰](#æ·»åŠ cookieä¸ä¸æ·»åŠ cookieçš„åŒºåˆ«å¯é€‰)\n  - [å¦‚ä½•è·å–cookieï¼ˆå¯é€‰ï¼‰](#å¦‚ä½•è·å–cookieå¯é€‰)\n  - [å¦‚ä½•æ£€æµ‹cookieæ˜¯å¦æœ‰æ•ˆï¼ˆå¯é€‰ï¼‰](#å¦‚ä½•æ£€æµ‹cookieæ˜¯å¦æœ‰æ•ˆå¯é€‰)\n  - [APIæœåŠ¡](#apiæœåŠ¡)\n\n## åŠŸèƒ½\n\nè¿ç»­çˆ¬å–**ä¸€ä¸ª**æˆ–**å¤šä¸ª**æ–°æµªå¾®åšç”¨æˆ·ï¼ˆå¦‚[Dear-è¿ªä¸½çƒ­å·´](https://weibo.cn/u/1669879400)ã€[éƒ­ç¢§å©·](https://weibo.cn/u/1729370543)ï¼‰çš„æ•°æ®ï¼Œå¹¶å°†ç»“æœä¿¡æ¯å†™å…¥æ–‡ä»¶ã€‚å†™å…¥ä¿¡æ¯å‡ ä¹åŒ…æ‹¬äº†ç”¨æˆ·å¾®åšçš„æ‰€æœ‰æ•°æ®ï¼Œä¸»è¦æœ‰**ç”¨æˆ·ä¿¡æ¯**å’Œ**å¾®åšä¿¡æ¯**ä¸¤å¤§ç±»ï¼Œå‰è€…åŒ…å«ç”¨æˆ·æ˜µç§°ã€å…³æ³¨æ•°ã€ç²‰ä¸æ•°ã€å¾®åšæ•°ç­‰ç­‰ï¼›åè€…åŒ…å«å¾®åšæ­£æ–‡ã€å‘å¸ƒæ—¶é—´ã€å‘å¸ƒå·¥å…·ã€è¯„è®ºæ•°ç­‰ç­‰ï¼Œå› ä¸ºå†…å®¹å¤ªå¤šï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œè¯¦ç»†å†…å®¹è§[è¾“å‡º](#è¾“å‡º)éƒ¨åˆ†ã€‚å…·ä½“çš„å†™å…¥æ–‡ä»¶ç±»å‹å¦‚ä¸‹ï¼š\n\n* å†™å…¥**csvæ–‡ä»¶**ï¼ˆé»˜è®¤ï¼‰\n* å†™å…¥**jsonæ–‡ä»¶**ï¼ˆå¯é€‰ï¼‰\n* å†™å…¥**MySQLæ•°æ®åº“**ï¼ˆå¯é€‰ï¼‰\n* å†™å…¥**MongoDBæ•°æ®åº“**ï¼ˆå¯é€‰ï¼‰\n* å†™å…¥**SQLiteæ•°æ®åº“**ï¼ˆå¯é€‰ï¼‰\n* ä¸‹è½½ç”¨æˆ·**åŸåˆ›**å¾®åšä¸­çš„åŸå§‹**å›¾ç‰‡**ï¼ˆå¯é€‰ï¼‰\n* ä¸‹è½½ç”¨æˆ·**è½¬å‘**å¾®åšä¸­çš„åŸå§‹**å›¾ç‰‡**ï¼ˆå¯é€‰ï¼‰\n* ä¸‹è½½ç”¨æˆ·**åŸåˆ›**å¾®åšä¸­çš„**è§†é¢‘**ï¼ˆå¯é€‰ï¼‰\n* ä¸‹è½½ç”¨æˆ·**è½¬å‘**å¾®åšä¸­çš„**è§†é¢‘**ï¼ˆå¯é€‰ï¼‰\n* ä¸‹è½½ç”¨æˆ·**åŸåˆ›**å¾®åš**Live Photo**ä¸­çš„**è§†é¢‘**ï¼ˆå¯é€‰ï¼‰\n* ä¸‹è½½ç”¨æˆ·**è½¬å‘**å¾®åš**Live Photo**ä¸­çš„**è§†é¢‘**ï¼ˆå¯é€‰ï¼‰\n* ä¸‹è½½ç”¨æˆ·**åŸåˆ›å’Œè½¬å‘**å¾®åšä¸‹çš„ä¸€çº§è¯„è®ºï¼ˆå¯é€‰ï¼‰\n* ä¸‹è½½ç”¨æˆ·**åŸåˆ›å’Œè½¬å‘**å¾®åšä¸‹çš„è½¬å‘ï¼ˆå¯é€‰ï¼‰\n\nå¦‚æœä½ åªå¯¹ç”¨æˆ·ä¿¡æ¯æ„Ÿå…´è¶£ï¼Œè€Œä¸éœ€è¦çˆ¬ç”¨æˆ·çš„å¾®åšï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®å®ç°åªçˆ¬å–å¾®åšç”¨æˆ·ä¿¡æ¯çš„åŠŸèƒ½ã€‚ç¨‹åºä¹Ÿå¯ä»¥å®ç°**çˆ¬å–ç»“æœè‡ªåŠ¨æ›´æ–°**ï¼Œå³ï¼šç°åœ¨çˆ¬å–äº†ç›®æ ‡ç”¨æˆ·çš„å¾®åšï¼Œå‡ å¤©ä¹‹åï¼Œç›®æ ‡ç”¨æˆ·å¯èƒ½åˆå‘æ–°å¾®åšäº†ã€‚é€šè¿‡è®¾ç½®ï¼Œå¯ä»¥å®ç°æ¯éš”å‡ å¤©**å¢é‡çˆ¬å–**ç”¨æˆ·è¿™å‡ å¤©å‘çš„æ–°å¾®åšã€‚å…·ä½“æ–¹æ³•è§[å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åš](#7å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšå¯é€‰)ã€‚\n\n## è¾“å‡º\n\n**ç”¨æˆ·ä¿¡æ¯**\n\n* ç”¨æˆ·idï¼šå¾®åšç”¨æˆ·idï¼Œå¦‚\"1669879400\"\n* ç”¨æˆ·æ˜µç§°ï¼šå¾®åšç”¨æˆ·æ˜µç§°ï¼Œå¦‚\"Dear-è¿ªä¸½çƒ­å·´\"\n* æ€§åˆ«ï¼šå¾®åšç”¨æˆ·æ€§åˆ«\n* ç”Ÿæ—¥ï¼šç”¨æˆ·å‡ºç”Ÿæ—¥æœŸ\n* æ‰€åœ¨åœ°ï¼šç”¨æˆ·æ‰€åœ¨åœ°\n* æ•™è‚²ç»å†ï¼šç”¨æˆ·ä¸Šå­¦æ—¶å­¦æ ¡çš„åå­—\n* å…¬å¸ï¼šç”¨æˆ·æ‰€å±å…¬å¸åå­—\n* é˜³å…‰ä¿¡ç”¨ï¼šç”¨æˆ·çš„é˜³å…‰ä¿¡ç”¨\n* å¾®åšæ³¨å†Œæ—¶é—´ï¼šç”¨æˆ·å¾®åšæ³¨å†Œæ—¥æœŸ\n* å¾®åšæ•°ï¼šç”¨æˆ·çš„å…¨éƒ¨å¾®åšæ•°ï¼ˆè½¬å‘å¾®åš+åŸåˆ›å¾®åšï¼‰\n* ç²‰ä¸æ•°ï¼šç”¨æˆ·çš„ç²‰ä¸æ•°\n* å…³æ³¨æ•°ï¼šç”¨æˆ·å…³æ³¨çš„å¾®åšæ•°é‡\n* ç®€ä»‹ï¼šç”¨æˆ·ç®€ä»‹\n* ä¸»é¡µåœ°å€ï¼šå¾®åšç§»åŠ¨ç‰ˆä¸»é¡µurlï¼Œå¦‚<https://m.weibo.cn/u/1669879400?uid=1669879400&luicode=10000011&lfid=1005051669879400>\n* å¤´åƒurlï¼šç”¨æˆ·å¤´åƒurl\n* é«˜æ¸…å¤´åƒurlï¼šç”¨æˆ·é«˜æ¸…å¤´åƒurl\n* å¾®åšç­‰çº§ï¼šç”¨æˆ·å¾®åšç­‰çº§\n* ä¼šå‘˜ç­‰çº§ï¼šå¾®åšä¼šå‘˜ç”¨æˆ·ç­‰çº§ï¼Œæ™®é€šç”¨æˆ·è¯¥ç­‰çº§ä¸º0\n* æ˜¯å¦è®¤è¯ï¼šç”¨æˆ·æ˜¯å¦è®¤è¯ï¼Œä¸ºå¸ƒå°”ç±»å‹\n* è®¤è¯ç±»å‹ï¼šç”¨æˆ·è®¤è¯ç±»å‹ï¼Œå¦‚ä¸ªäººè®¤è¯ã€ä¼ä¸šè®¤è¯ã€æ”¿åºœè®¤è¯ç­‰\n* è®¤è¯ä¿¡æ¯ï¼šä¸ºè®¤è¯ç”¨æˆ·ç‰¹æœ‰ï¼Œç”¨æˆ·ä¿¡æ¯æ æ˜¾ç¤ºçš„è®¤è¯ä¿¡æ¯\n\n***\n**å¾®åšä¿¡æ¯**\n\n* å¾®åšidï¼šå¾®åšçš„idï¼Œä¸ºä¸€ä¸²æ•°å­—å½¢å¼\n* å¾®åšbidï¼šå¾®åšçš„bidï¼Œä¸[cookieç‰ˆ](https://github.com/dataabc/weiboSpider)ä¸­çš„å¾®åšidæ˜¯åŒä¸€ä¸ªå€¼\n* å¾®åšå†…å®¹ï¼šå¾®åšæ­£æ–‡\n* å¤´æ¡æ–‡ç« urlï¼šå¾®åšä¸­å¤´æ¡æ–‡ç« çš„urlï¼Œå¦‚æœå¾®åšä¸­å­˜åœ¨å¤´æ¡æ–‡ç« ï¼Œå°±è·å–è¯¥å¤´æ¡æ–‡ç« çš„urlï¼Œå¦åˆ™è¯¥å€¼ä¸º''\n* åŸå§‹å›¾ç‰‡urlï¼šåŸåˆ›å¾®åšå›¾ç‰‡å’Œè½¬å‘å¾®åšè½¬å‘ç†ç”±ä¸­å›¾ç‰‡çš„urlï¼Œè‹¥æŸæ¡å¾®åšå­˜åœ¨å¤šå¼ å›¾ç‰‡ï¼Œåˆ™æ¯ä¸ªurlä»¥è‹±æ–‡é€—å·åˆ†éš”ï¼Œè‹¥æ²¡æœ‰å›¾ç‰‡åˆ™å€¼ä¸º''\n* è§†é¢‘url: å¾®åšä¸­çš„è§†é¢‘urlå’ŒLive Photoä¸­çš„è§†é¢‘urlï¼Œè‹¥æŸæ¡å¾®åšå­˜åœ¨å¤šä¸ªè§†é¢‘ï¼Œåˆ™æ¯ä¸ªurlä»¥è‹±æ–‡åˆ†å·åˆ†éš”ï¼Œè‹¥æ²¡æœ‰è§†é¢‘åˆ™å€¼ä¸º''\n* å¾®åšå‘å¸ƒä½ç½®ï¼šä½ç½®å¾®åšä¸­çš„å‘å¸ƒä½ç½®\n* å¾®åšå‘å¸ƒæ—¶é—´ï¼šå¾®åšå‘å¸ƒæ—¶çš„æ—¶é—´ï¼Œç²¾ç¡®åˆ°å¤©\n* ç‚¹èµæ•°ï¼šå¾®åšè¢«èµçš„æ•°é‡\n* è½¬å‘æ•°ï¼šå¾®åšè¢«è½¬å‘çš„æ•°é‡\n* è¯„è®ºæ•°ï¼šå¾®åšè¢«è¯„è®ºçš„æ•°é‡\n* å¾®åšå‘å¸ƒå·¥å…·ï¼šå¾®åšçš„å‘å¸ƒå·¥å…·ï¼Œå¦‚iPhoneå®¢æˆ·ç«¯ã€HUAWEI Mate 20 Proç­‰ï¼Œè‹¥æ²¡æœ‰åˆ™å€¼ä¸º''\n* è¯é¢˜ï¼šå¾®åšè¯é¢˜ï¼Œå³ä¸¤ä¸ª#ä¸­çš„å†…å®¹ï¼Œè‹¥å­˜åœ¨å¤šä¸ªè¯é¢˜ï¼Œæ¯ä¸ªurlä»¥è‹±æ–‡é€—å·åˆ†éš”ï¼Œè‹¥æ²¡æœ‰åˆ™å€¼ä¸º''\n* @ç”¨æˆ·ï¼šå¾®åš@çš„ç”¨æˆ·ï¼Œè‹¥å­˜åœ¨å¤šä¸ª@ç”¨æˆ·ï¼Œæ¯ä¸ªurlä»¥è‹±æ–‡é€—å·åˆ†éš”ï¼Œè‹¥æ²¡æœ‰åˆ™å€¼ä¸º''\n* åŸå§‹å¾®åšï¼šä¸ºè½¬å‘å¾®åšæ‰€ç‰¹æœ‰ï¼Œæ˜¯è½¬å‘å¾®åšä¸­é‚£æ¡è¢«è½¬å‘çš„å¾®åšï¼Œå­˜å‚¨ä¸ºå­—å…¸å½¢å¼ï¼ŒåŒ…å«äº†ä¸Šè¿°å¾®åšä¿¡æ¯ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå¦‚å¾®åšidã€å¾®åšå†…å®¹ç­‰ç­‰\n* ç»“æœæ–‡ä»¶ï¼šä¿å­˜åœ¨å½“å‰ç›®å½•weiboæ–‡ä»¶å¤¹ä¸‹ä»¥ç”¨æˆ·æ˜µç§°ä¸ºåçš„æ–‡ä»¶å¤¹é‡Œï¼Œåå­—ä¸º\"user_id.csv\"å½¢å¼\n* å¾®åšå›¾ç‰‡ï¼šå¾®åšä¸­çš„å›¾ç‰‡ï¼Œä¿å­˜åœ¨ä»¥ç”¨æˆ·æ˜µç§°ä¸ºåçš„æ–‡ä»¶å¤¹ä¸‹çš„imgæ–‡ä»¶å¤¹é‡Œ\n* å¾®åšè§†é¢‘ï¼šå¾®åšä¸­çš„è§†é¢‘ï¼Œä¿å­˜åœ¨ä»¥ç”¨æˆ·æ˜µç§°ä¸ºåçš„æ–‡ä»¶å¤¹ä¸‹çš„videoæ–‡ä»¶å¤¹é‡Œ\n\n## å®ä¾‹\n\nä»¥çˆ¬å–è¿ªä¸½çƒ­å·´çš„å¾®åšä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹**config.json**æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n\n```\n{\n    \"user_id_list\": [\"1669879400\"],\n    \"only_crawl_original\": 1,\n    \"since_date\": \"1900-01-01\",\n    \"query_list\": [],\n    \"write_mode\": [\"csv\"],\n    \"original_pic_download\": 1,\n    \"retweet_pic_download\": 0,\n    \"original_video_download\": 1,\n    \"retweet_video_download\": 0,\n    \"cookie\": \"your cookie\"\n}\n```\n\nå¯¹äºä¸Šè¿°å‚æ•°çš„å«ä¹‰ä»¥åŠå–å€¼èŒƒå›´ï¼Œè¿™é‡Œä»…ä½œç®€å•ä»‹ç»ï¼Œè¯¦ç»†ä¿¡æ¯è§[ç¨‹åºè®¾ç½®](#3ç¨‹åºè®¾ç½®)ã€‚\n>**user_id_list**ä»£è¡¨æˆ‘ä»¬è¦çˆ¬å–çš„å¾®åšç”¨æˆ·çš„user_idï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œå¾®åšç”¨æˆ·Dear-è¿ªä¸½çƒ­å·´çš„user_idä¸º1669879400ï¼Œå…·ä½“å¦‚ä½•è·å–user_idè§[å¦‚ä½•è·å–user_id](#å¦‚ä½•è·å–user_id)ï¼›\n**only_crawl_original**çš„å€¼ä¸º1ä»£è¡¨çˆ¬å–å…¨éƒ¨åŸåˆ›å¾®åšï¼Œå€¼ä¸º0ä»£è¡¨çˆ¬å–å…¨éƒ¨å¾®åšï¼ˆåŸåˆ›+è½¬å‘ï¼‰ï¼›\n**since_date**ä»£è¡¨æˆ‘ä»¬è¦çˆ¬å–since_dateæ—¥æœŸä¹‹åå‘å¸ƒçš„å¾®åšï¼Œå› ä¸ºæˆ‘è¦çˆ¬è¿ªä¸½çƒ­å·´çš„å…¨éƒ¨åŸåˆ›å¾®åšï¼Œæ‰€ä»¥since_dateè®¾ç½®äº†ä¸€ä¸ªéå¸¸æ—©çš„å€¼ï¼›\nquery_listä»£è¡¨è¦çˆ¬å–çš„å¾®åšå…³é”®è¯ï¼Œä¸ºç©ºï¼ˆ[]ï¼‰åˆ™çˆ¬å–å…¨éƒ¨ï¼›\n**write_mode**ä»£è¡¨ç»“æœæ–‡ä»¶çš„ä¿å­˜ç±»å‹ï¼Œæˆ‘æƒ³è¦æŠŠç»“æœå†™å…¥csvæ–‡ä»¶å’Œjsonæ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¸º[\"csv\", \"json\"]ï¼Œå¦‚æœä½ æƒ³å†™å…¥æ•°æ®åº“ï¼Œå…·ä½“è®¾ç½®è§[è®¾ç½®æ•°æ®åº“](#4è®¾ç½®æ•°æ®åº“å¯é€‰)ï¼›\n**original_pic_download**å€¼ä¸º1ä»£è¡¨ä¸‹è½½åŸåˆ›å¾®åšä¸­çš„å›¾ç‰‡ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ä¸‹è½½ï¼›\n**retweet_pic_download**å€¼ä¸º1ä»£è¡¨ä¸‹è½½è½¬å‘å¾®åšä¸­çš„å›¾ç‰‡ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ä¸‹è½½ï¼›\n**original_video_download**å€¼ä¸º1ä»£è¡¨ä¸‹è½½åŸåˆ›å¾®åšä¸­çš„è§†é¢‘ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ä¸‹è½½ï¼›\n**retweet_video_download**å€¼ä¸º1ä»£è¡¨ä¸‹è½½è½¬å‘å¾®åšä¸­çš„è§†é¢‘ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ä¸‹è½½ï¼›\n**cookie**æ˜¯å¯é€‰å‚æ•°ï¼Œå¯å¡«å¯ä¸å¡«ï¼Œå…·ä½“åŒºåˆ«è§[æ·»åŠ cookieä¸ä¸æ·»åŠ cookieçš„åŒºåˆ«](#æ·»åŠ cookieä¸ä¸æ·»åŠ cookieçš„åŒºåˆ«å¯é€‰)ã€‚\n\né…ç½®å®Œæˆåè¿è¡Œç¨‹åºï¼š\n\n```bash\npython weibo.py\n```\n\nç¨‹åºä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªweiboæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä»¥åçˆ¬å–çš„æ‰€æœ‰å¾®åšéƒ½è¢«å­˜å‚¨åœ¨weiboæ–‡ä»¶å¤¹é‡Œã€‚ç„¶åç¨‹åºåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸º\"Dear-è¿ªä¸½çƒ­å·´\"çš„æ–‡ä»¶å¤¹ï¼Œè¿ªä¸½çƒ­å·´çš„æ‰€æœ‰å¾®åšçˆ¬å–ç»“æœéƒ½åœ¨è¿™é‡Œã€‚\"Dear-è¿ªä¸½çƒ­å·´\"æ–‡ä»¶å¤¹é‡ŒåŒ…å«ä¸€ä¸ªcsvæ–‡ä»¶ã€ä¸€ä¸ªimgæ–‡ä»¶å¤¹å’Œä¸€ä¸ªvideoæ–‡ä»¶å¤¹ï¼Œimgæ–‡ä»¶å¤¹ç”¨æ¥å­˜å‚¨ä¸‹è½½åˆ°çš„å›¾ç‰‡ï¼Œvideoæ–‡ä»¶å¤¹ç”¨æ¥å­˜å‚¨ä¸‹è½½åˆ°çš„è§†é¢‘ã€‚å¦‚æœä½ è®¾ç½®äº†ä¿å­˜æ•°æ®åº“åŠŸèƒ½ï¼Œè¿™äº›ä¿¡æ¯ä¹Ÿä¼šä¿å­˜åœ¨æ•°æ®åº“é‡Œï¼Œæ•°æ®åº“è®¾ç½®è§[è®¾ç½®æ•°æ®åº“](#4è®¾ç½®æ•°æ®åº“å¯é€‰)éƒ¨åˆ†ã€‚\n\n**csvæ–‡ä»¶ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š**\n![](https://github.com/dataabc/media/blob/master/weibo-crawler/images/weibo_csv.png)*1669879400.csv*\n\næœ¬csvæ–‡ä»¶æ˜¯çˆ¬å–â€œå…¨éƒ¨å¾®åšâ€(åŸåˆ›å¾®åš+è½¬å‘å¾®åš)çš„ç»“æœæ–‡ä»¶ã€‚å› ä¸ºè¿ªä¸½çƒ­å·´å¾ˆå¤šå¾®åšæœ¬èº«éƒ½æ²¡æœ‰å›¾ç‰‡ã€å‘å¸ƒå·¥å…·ã€ä½ç½®ã€è¯é¢˜å’Œ@ç”¨æˆ·ç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥å½“è¿™äº›å†…å®¹æ²¡æœ‰æ—¶å¯¹åº”ä½ç½®ä¸ºç©ºã€‚\"æ˜¯å¦åŸåˆ›\"åˆ—ç”¨æ¥æ ‡è®°æ˜¯å¦ä¸ºåŸåˆ›å¾®åšï¼Œ\nå½“ä¸ºè½¬å‘å¾®åšæ—¶ï¼Œæ–‡ä»¶ä¸­è¿˜åŒ…å«è½¬å‘å¾®åšçš„ä¿¡æ¯ã€‚ä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œå§‘ä¸”å°†è½¬å‘å¾®åšä¸­è¢«è½¬å‘çš„åŸå§‹å¾®åšç§°ä¸º**æºå¾®åš**ï¼Œå®ƒçš„ç”¨æˆ·idã€æ˜µç§°ã€å¾®åšidç­‰éƒ½åœ¨åç§°å‰åŠ ä¸Šæºå­—ï¼Œä»¥ä¾¿ä¸ç›®æ ‡ç”¨æˆ·è‡ªå·±å‘çš„å¾®åšåŒºåˆ†ã€‚å¯¹äºè½¬å‘å¾®åšï¼Œç¨‹åºé™¤äº†è·å–ç”¨æˆ·åŸåˆ›éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œè¿˜ä¼šè·å–**æºç”¨æˆ·id**ã€**æºç”¨æˆ·æ˜µç§°**ã€**æºå¾®åšid**ã€**æºå¾®åšæ­£æ–‡**ã€**æºå¾®åšåŸå§‹å›¾ç‰‡url**ã€**æºå¾®åšä½ç½®**ã€**æºå¾®åšæ—¥æœŸ**ã€**æºå¾®åšå·¥å…·**ã€**æºå¾®åšç‚¹èµæ•°**ã€**æºå¾®åšè¯„è®ºæ•°**ã€**æºå¾®åšè½¬å‘æ•°**ã€**æºå¾®åšè¯é¢˜**ã€**æºå¾®åš@ç”¨æˆ·**ç­‰ä¿¡æ¯ã€‚åŸåˆ›å¾®åšå› ä¸ºæ²¡æœ‰è¿™äº›è½¬å‘ä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹åº”ä½ç½®ä¸ºç©ºã€‚è‹¥çˆ¬å–çš„æ˜¯\"å…¨éƒ¨**åŸåˆ›**å¾®åš\"ï¼Œåˆ™csvæ–‡ä»¶ä¸­ä¸ä¼šåŒ…å«\"æ˜¯å¦åŸåˆ›\"åŠå…¶ä¹‹åçš„è½¬å‘å±æ€§åˆ—ï¼›\n\nä¸ºäº†è¯´æ˜jsonç»“æœæ–‡ä»¶æ ¼å¼ï¼Œè¿™é‡Œä»¥è¿ªä¸½çƒ­å·´2019å¹´12æœˆ27æ—¥åˆ°2019å¹´12æœˆ28æ—¥å‘çš„2æ¡å¾®åšä¸ºä¾‹ã€‚\n\n**jsonç»“æœæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š**\n\n```\n{\n    \"user\": {\n        \"id\": \"1669879400\",\n        \"screen_name\": \"Dear-è¿ªä¸½çƒ­å·´\",\n        \"gender\": \"f\",\n        \"birthday\": \"åŒå­åº§\",\n        \"location\": \"ä¸Šæµ·\",\n        \"education\": \"ä¸Šæµ·æˆå‰§å­¦é™¢\",\n        \"company\": \"å˜‰è¡Œä¼ åª’\",\n        \"registration_time\": \"2010-07-02\",\n        \"sunshine\": \"ä¿¡ç”¨æå¥½\",\n        \"statuses_count\": 1121,\n        \"followers_count\": 66395881,\n        \"follow_count\": 250,\n        \"description\": \"ä¸€åªå–œæ¬¢é»˜é»˜è¡¨æ¼”çš„å°é€æ˜ã€‚å·¥ä½œè”ç³»jaywalk@jaywalk.com.cn ğŸ’\",\n        \"profile_url\": \"https://m.weibo.cn/u/1669879400?uid=1669879400&luicode=10000011&lfid=1005051669879400\",\n        \"profile_image_url\": \"https://tvax2.sinaimg.cn/crop.0.0.1080.1080.180/63885668ly8gb5sqc19mqj20u00u0mz5.jpg?KID=imgbed,tva&Expires=1584108150&ssig=Zay1N7KhK1\",\n        \"avatar_hd\": \"https://wx2.sinaimg.cn/orj480/63885668ly8gb5sqc19mqj20u00u0mz5.jpg\",\n        \"urank\": 44,\n        \"mbrank\": 7,\n        \"verified\": true,\n        \"verified_type\": 0,\n        \"verified_reason\": \"å˜‰è¡Œä¼ åª’ç­¾çº¦æ¼”å‘˜ã€€\"\n    },\n    \"weibo\": [\n        {\n            \"user_id\": 1669879400,\n            \"screen_name\": \"Dear-è¿ªä¸½çƒ­å·´\",\n            \"id\": 4454572602912349,\n            \"bid\": \"ImTGkcdDn\",\n            \"text\": \"ä»Šå¤©çš„#æ˜Ÿå…‰å¤§èµ#  \",\n            \"pics\": \"https://wx3.sinaimg.cn/large/63885668ly1gacppdn1nmj21yi2qp7wk.jpg,https://wx4.sinaimg.cn/large/63885668ly1gacpphkj5gj22ik3t0b2d.jpg,https://wx4.sinaimg.cn/large/63885668ly1gacppb4atej22yo4g04qr.jpg,https://wx2.sinaimg.cn/large/63885668ly1gacpn0eeyij22yo4g04qr.jpg\",\n            \"video_url\": \"\",\n            \"location\": \"\",\n            \"created_at\": \"2019-12-28\",\n            \"source\": \"\",\n            \"attitudes_count\": 551894,\n            \"comments_count\": 182010,\n            \"reposts_count\": 1000000,\n            \"topics\": \"æ˜Ÿå…‰å¤§èµ\",\n            \"at_users\": \"\"\n        },\n        {\n            \"user_id\": 1669879400,\n            \"screen_name\": \"Dear-è¿ªä¸½çƒ­å·´\",\n            \"id\": 4454081098040623,\n            \"bid\": \"ImGTzxJJt\",\n            \"text\": \"æˆ‘æœ€çˆ±ç”¨çš„å¨‡éŸµè¯—åŒèƒç²¾åç©¿ä¸Šé™é‡â€œé‡‘â€è£…å•¦ï¼Œå¸Œæœ›é˜¿ä¸å„¿ä»¬è·Ÿæˆ‘ä¸€èµ·åœ¨æ–°çš„ä¸€å¹´æ›´ç¾æ›´å¹´è½»ï¼Œå–œç¬‘é¢œå¼€æ²¡æœ‰ç»†çº¹å›°æ‰°ï¼é™å®šæ–°æ˜¥ç¤¼ç›’è¿˜æœ‰ç¥ç¦æ‚„æ‚„è¯ï¼Œå¤§å®¶äº†è§£ä¸€ä¸‹ï½\",\n            \"pics\": \"\",\n            \"video_url\": \"\",\n            \"location\": \"\",\n            \"created_at\": \"2019-12-27\",\n            \"source\": \"\",\n            \"attitudes_count\": 190840,\n            \"comments_count\": 43523,\n            \"reposts_count\": 1000000,\n            \"topics\": \"\",\n            \"at_users\": \"\",\n            \"retweet\": {\n                \"user_id\": 1684832145,\n                \"screen_name\": \"æ³•å›½å¨‡éŸµè¯—\",\n                \"id\": 4454028484570123,\n                \"bid\": \"ImFwIjaTF\",\n                \"text\": \"#ç‚¹èƒæˆé‡‘ å¹´è½»ç„•æ–°# å°†æºè‡ªå¤©ç„¶çš„æ¤ç‰©åŠ›é‡ï¼Œè½¬åŒ–ä¸ºæ»´æ»´çè´µå¦‚é‡‘çš„åŒèƒç²¾åã€‚è¿™ä»½ç‚¹èƒæˆé‡‘çš„ç‹¬åˆ°åŒ å¿ƒï¼Œåªä¸ºå®ˆæŠ¤å¨‡ç²‰ä»¬çš„ç¾ä¸½è€Œæ¥ã€‚ç‚¹å‡»è§†é¢‘ï¼Œä¸@Dear-è¿ªä¸½çƒ­å·´ ä¸€åŒé‚‚é€…æ–°å¹´é™é‡ç‰ˆé»„é‡‘åŒèƒï¼Œä»¥é—ªè€€å¼€è¿é‡‘ï¼Œé€ä¸Šæ–°æ˜¥å® è‚Œè‡»ç¤¼ã€‚ è·Ÿç€è¿ªè¿ªé€‰å¹´è´§ï¼Œè¿˜æœ‰åŒé‡æ–°æ˜¥æƒŠå–œï¼Œçˆ±ä¸½ä¸ä»¬çœ‹è¿™é‡Œï¼ ç¬¬ä¸€é‡å‚ä¸å¾®æ·˜æ´»åŠ¨é‚€è¯·å¥½å‹å…³æ³¨å¨‡éŸµè¯—å¤©çŒ«æ——èˆ°åº—ï¼Œå°±æœ‰æœºä¼šèµ¢å–é™é‡æ¬¾çƒ­å·´æ–°å¹´ç¤¼ç›’ï¼Œæ‰“å¼€å°±èƒ½è†å¬ä»™å¥³è¿ªäº²å£é€å‡ºçš„æ–°æ˜¥ç¥ç¦å“¦ï¼ç‚¹å‡»ç½‘é¡µé“¾æ¥ä¸‹å•æ™’çƒ­å·´åŒæ¬¾é»„é‡‘åŒèƒï¼Œå¹¶ä¸”@æ³•å›½å¨‡éŸµè¯—ï¼Œæ›´æœ‰æœºä¼šè·å¾—çƒ­å·´äº²ç¬”ç­¾åçš„ç¤¼ç›’å“¦ï¼ ç¬¬äºŒé‡è½¬è¯„è¯´å‡ºæ–°å¹´å¸Œæœ›å¨‡éŸµè¯—ä¸ºä½ è§£å†³çš„è‚Œè‚¤æ„¿æœ›ï¼Œæˆªæ­¢è‡³1/10ï¼Œå°å¨‡å°†ä»é“ç²‰ä¸­æŠ½å–1ä½å¨‡ç²‰é€å‡ºé™é‡ç‰ˆçƒ­å·´å®šåˆ¶ç¤¼ç›’ï¼ŒæŠ½å–3ä½å¨‡ç²‰é€å‡ºçƒ­å·´æ˜ä¿¡ç‰‡1å¼ ï½ #è¿ªä¸½çƒ­å·´ä»£è¨€å¨‡éŸµè¯—#å…»æˆåŒæ¬¾å¾¡é¾„ç¾è‚Œï¼Œå°±ä»ç°åœ¨å¼€å§‹ã€‚æ³•å›½å¨‡éŸµè¯—çš„å¾®åšè§†é¢‘\",\n                \"pics\": \"\",\n                \"video_url\": \"http://f.video.weibocdn.com/003vQjnRlx07zFkxIMjS010412003bNx0E010.mp4?label=mp4_hd&template=852x480.25.0&trans_finger=62b30a3f061b162e421008955c73f536&Expires=1578322522&ssig=P3ozrNA3mv&KID=unistore,video\",\n                \"location\": \"\",\n                \"created_at\": \"2019-12-27\",\n                \"source\": \"å¾®åš weibo.com\",\n                \"attitudes_count\": 18389,\n                \"comments_count\": 3201,\n                \"reposts_count\": 1000000,\n                \"topics\": \"ç‚¹èƒæˆé‡‘ å¹´è½»ç„•æ–°,è¿ªä¸½çƒ­å·´ä»£è¨€å¨‡éŸµè¯—\",\n                \"at_users\": \"Dear-è¿ªä¸½çƒ­å·´,æ³•å›½å¨‡éŸµè¯—\"\n            }\n        }\n    ]\n}\n```\n\n*1669879400.json*\n\n**ä¸‹è½½çš„å›¾ç‰‡å¦‚ä¸‹æ‰€ç¤ºï¼š**\n\n![](https://github.com/dataabc/media/blob/master/weibo-crawler/images/img.png)*imgæ–‡ä»¶å¤¹*\n\næœ¬æ¬¡ä¸‹è½½äº†788å¼ å›¾ç‰‡ï¼Œå¤§å°ä¸€å…±1.21GBï¼ŒåŒ…æ‹¬å¥¹åŸåˆ›å¾®åšä¸­çš„æ‰€æœ‰å›¾ç‰‡ã€‚å›¾ç‰‡åä¸ºyyyymmdd+å¾®åšidçš„å½¢å¼ï¼Œè‹¥æŸæ¡å¾®åšå­˜åœ¨å¤šå¼ å›¾ç‰‡ï¼Œåˆ™å›¾ç‰‡åä¸­è¿˜ä¼šåŒ…æ‹¬å®ƒåœ¨å¾®åšå›¾ç‰‡ä¸­çš„åºå·ã€‚è‹¥æŸå›¾ç‰‡ä¸‹è½½å¤±è´¥ï¼Œç¨‹åºåˆ™ä¼šä»¥â€œweibo_id:pic_urlâ€çš„å½¢å¼å°†å‡ºé”™å¾®åšidå’Œå›¾ç‰‡urlå†™å…¥åŒæ–‡ä»¶å¤¹ä¸‹çš„not_downloaded.txté‡Œï¼›è‹¥å›¾ç‰‡å…¨éƒ¨ä¸‹è½½æˆåŠŸåˆ™ä¸ä¼šç”Ÿæˆnot_downloaded.txtï¼›\n\n**ä¸‹è½½çš„è§†é¢‘å¦‚ä¸‹æ‰€ç¤ºï¼š**\n![](https://github.com/dataabc/media/blob/master/weibo-crawler/images/video.png)*videoæ–‡ä»¶å¤¹*\n\næœ¬æ¬¡ä¸‹è½½äº†66ä¸ªè§†é¢‘ï¼Œæ˜¯å¥¹åŸåˆ›å¾®åšä¸­çš„è§†é¢‘å’ŒåŸåˆ›å¾®åšLive Photoä¸­çš„è§†é¢‘ï¼Œè§†é¢‘åä¸ºyyyymmdd+å¾®åšidçš„å½¢å¼ã€‚æœ‰ä¸‰ä¸ªè§†é¢‘å› ä¸ºç½‘ç»œåŸå› ä¸‹è½½å¤±è´¥ï¼Œç¨‹åºå°†å®ƒä»¬çš„å¾®åšidå’Œè§†é¢‘urlåˆ†åˆ«ä»¥â€œweibo_id:video_urlâ€çš„å½¢å¼å†™åˆ°äº†åŒæ–‡ä»¶å¤¹ä¸‹çš„not_downloaded.txté‡Œã€‚\n\nå› ä¸ºæˆ‘æœ¬åœ°æ²¡æœ‰å®‰è£…MySQLæ•°æ®åº“å’ŒMongoDBæ•°æ®åº“ï¼Œæ‰€ä»¥æš‚æ—¶è®¾ç½®æˆä¸å†™å…¥æ•°æ®åº“ã€‚å¦‚æœä½ æƒ³è¦å°†çˆ¬å–ç»“æœå†™å…¥æ•°æ®åº“ï¼Œåªéœ€è¦å…ˆå®‰è£…æ•°æ®åº“ï¼ˆMySQLæˆ–MongoDBï¼‰ï¼Œå†å®‰è£…å¯¹åº”åŒ…ï¼ˆpymysqlæˆ–pymongoï¼‰ï¼Œç„¶åå°†mysql_writeæˆ–mongodb_writeå€¼è®¾ç½®ä¸º1å³å¯ã€‚å†™å…¥MySQLéœ€è¦ç”¨æˆ·åã€å¯†ç ç­‰é…ç½®ä¿¡æ¯ï¼Œè¿™äº›é…ç½®å¦‚ä½•è®¾ç½®è§[è®¾ç½®æ•°æ®åº“](#4è®¾ç½®æ•°æ®åº“å¯é€‰)éƒ¨åˆ†ã€‚\n\n## è¿è¡Œç¯å¢ƒ\n\n* å¼€å‘è¯­è¨€ï¼špython2/python3\n\n* ç³»ç»Ÿï¼š Windows/Linux/macOS\n\n## ä½¿ç”¨è¯´æ˜\n\n### 1.ä¸‹è½½è„šæœ¬\n\n```bash\ngit clone https://github.com/dataabc/weibo-crawler.git\n```\n\nè¿è¡Œä¸Šè¿°å‘½ä»¤ï¼Œå°†æœ¬é¡¹ç›®ä¸‹è½½åˆ°å½“å‰ç›®å½•ï¼Œå¦‚æœä¸‹è½½æˆåŠŸå½“å‰ç›®å½•ä¼šå‡ºç°ä¸€ä¸ªåä¸º\"weibo-crawler\"çš„æ–‡ä»¶å¤¹ï¼›\n\n### 2.å®‰è£…ä¾èµ–\n\n```bash\npip install -r requirements.txt\n```\n\n### 3.ç¨‹åºè®¾ç½®\n\næ‰“å¼€**config.json**æ–‡ä»¶ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š\n\n```\n{\n    \"user_id_list\": [\"1669879400\"],\n    \"only_crawl_original\": 1,\n    \"remove_html_tag\": 1,\n    \"since_date\": \"2018-01-01\",\n    \"write_mode\": [\"csv\"],\n    \"original_pic_download\": 1,\n    \"retweet_pic_download\": 0,\n    \"original_video_download\": 1,\n    \"retweet_video_download\": 0,\n    \"download_comment\":1,\n    \"comment_max_download_count\":1000,\n    \"download_repost\": 1,\n    \"repost_max_download_count\": 1000,\n    \"user_id_as_folder_name\": 0,\n    \"cookie\": \"your cookie\",\n    \"mysql_config\": {\n        \"host\": \"localhost\",\n        \"port\": 3306,\n        \"user\": \"root\",\n        \"password\": \"123456\",\n        \"charset\": \"utf8mb4\"\n    },\n    \"mongodb_URI\": \"mongodb://[username:password@]host[:port][/[defaultauthdb][?options]]\",\n    \"post_config\": {\n        \"api_url\": \"https://api.example.com\",\n        \"api_token\": \"\"\n    }\n}\n```\n\nä¸‹é¢è®²è§£æ¯ä¸ªå‚æ•°çš„å«ä¹‰ä¸è®¾ç½®æ–¹æ³•ã€‚\n\n**è®¾ç½®user_id_list**\n\nuser_id_listæ˜¯æˆ‘ä»¬è¦çˆ¬å–çš„å¾®åšçš„idï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªï¼Œä¾‹å¦‚ï¼š\n\n```\n\"user_id_list\": [\"1223178222\", \"1669879400\", \"1729370543\"],\n```\n\nä¸Šè¿°ä»£ç ä»£è¡¨æˆ‘ä»¬è¦è¿ç»­çˆ¬å–user_idåˆ†åˆ«ä¸ºâ€œ1223178222â€ã€ â€œ1669879400â€ã€ â€œ1729370543â€çš„ä¸‰ä¸ªç”¨æˆ·çš„å¾®åšï¼Œå…·ä½“å¦‚ä½•è·å–user_idè§[å¦‚ä½•è·å–user_id](#å¦‚ä½•è·å–user_id)ã€‚\n\nuser_id_listçš„å€¼ä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¦çˆ¬çš„æ‰€æœ‰å¾®åšç”¨æˆ·çš„user_idéƒ½å†™åˆ°txtæ–‡ä»¶é‡Œï¼Œç„¶åæŠŠæ–‡ä»¶çš„ä½ç½®è·¯å¾„èµ‹å€¼ç»™user_id_listã€‚\n\nåœ¨txtæ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªuser_idå ä¸€è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨user_idåé¢åŠ æ³¨é‡Šï¼ˆå¯é€‰ï¼‰ï¼Œå¦‚ç”¨æˆ·æ˜µç§°ç­‰ä¿¡æ¯ï¼Œuser_idå’Œæ³¨é‡Šä¹‹é—´å¿…éœ€è¦æœ‰ç©ºæ ¼ï¼Œæ–‡ä»¶åä»»æ„ï¼Œç±»å‹ä¸ºtxtï¼Œä½ç½®ä½äºæœ¬ç¨‹åºçš„åŒç›®å½•ä¸‹ï¼Œæ–‡ä»¶å†…å®¹ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```\n1223178222 èƒ¡æ­Œ\n1669879400 è¿ªä¸½çƒ­å·´\n1729370543 éƒ­ç¢§å©·\n```\n\nå‡å¦‚æ–‡ä»¶å«user_id_list.txtï¼Œåˆ™user_id_listè®¾ç½®ä»£ç ä¸ºï¼š\n\n```\n\"user_id_list\": \"user_id_list.txt\",\n```\n\n**è®¾ç½®only_crawl_original**\n\nonly_crawl_originalæ§åˆ¶çˆ¬å–èŒƒå›´ï¼Œå€¼ä¸º1ä»£è¡¨çˆ¬å–å…¨éƒ¨åŸåˆ›å¾®åšï¼Œå€¼ä¸º0ä»£è¡¨çˆ¬å–å…¨éƒ¨å¾®åšï¼ˆåŸåˆ›+è½¬å‘ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦çˆ¬å…¨éƒ¨åŸåˆ›å¾®åšï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š\n\n```\n\"only_crawl_original\": 1,\n```\n\n**è®¾ç½®since_date**\n\nsince_dateå€¼å¯ä»¥æ˜¯æ—¥æœŸï¼Œä¹Ÿå¯ä»¥æ˜¯æ•´æ•°ã€‚å¦‚æœæ˜¯æ—¥æœŸï¼Œä»£è¡¨çˆ¬å–è¯¥æ—¥æœŸä¹‹åçš„å¾®åšï¼Œæ ¼å¼åº”ä¸ºâ€œyyyy-mm-ddâ€ï¼Œå¦‚ï¼š\n\n```\n\"since_date\": \"2018-01-01\",\n```\n\nä»£è¡¨çˆ¬å–ä»2018å¹´1æœˆ1æ—¥åˆ°ç°åœ¨çš„å¾®åšã€‚\n\nå¦‚æœæ˜¯æ•´æ•°ï¼Œä»£è¡¨çˆ¬å–æœ€è¿‘nå¤©çš„å¾®åšï¼Œå¦‚:\n\n```\n\"since_date\": 10,\n```\n\nä»£è¡¨çˆ¬å–æœ€è¿‘10å¤©çš„å¾®åšï¼Œè¿™ä¸ªè¯´æ³•ä¸æ˜¯ç‰¹åˆ«å‡†ç¡®ï¼Œå‡†ç¡®è¯´æ˜¯çˆ¬å–å‘å¸ƒæ—¶é—´ä»**10å¤©å‰åˆ°æœ¬ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶**ä¹‹é—´çš„å¾®åšã€‚\n\n**since_dateæ˜¯æ‰€æœ‰userçš„çˆ¬å–èµ·å§‹æ—¶é—´ï¼Œéå¸¸ä¸çµæ´»ã€‚å¦‚æœä½ è¦çˆ¬å¤šä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”æƒ³å•ç‹¬ä¸ºæ¯ä¸ªç”¨æˆ·è®¾ç½®ä¸€ä¸ªsince_dateï¼Œå¯ä»¥ä½¿ç”¨[å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åš](#7å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšå¯é€‰)æ–¹æ³•äºŒä¸­çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä¸ºå¤šä¸ªç”¨æˆ·è®¾ç½®ä¸åŒçš„since_dateï¼Œéå¸¸çµæ´»**ã€‚\n\n**è®¾ç½®query_list(å¯é€‰)**\n\nquery_listæ˜¯ä¸€ä¸ªå…³é”®è¯å­—ç¬¦ä¸²åˆ—è¡¨æˆ–ä»¥`,`åˆ†éš”å…³é”®è¯çš„å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šå…³é”®è¯æœç´¢çˆ¬å–ï¼Œè‹¥ä¸ºç©º`[]`æˆ–`\"\"`åˆ™çˆ¬å–å…¨éƒ¨å¾®åšã€‚ä¾‹å¦‚è¦çˆ¬å–ç”¨æˆ·åŒ…å«â€œæ¢¦æƒ³â€å’Œâ€œå¸Œæœ›â€çš„å¾®åšï¼Œåˆ™è®¾å®šå¦‚ä¸‹ï¼š\n\n```\n\"query_list\": [\"æ¢¦æƒ³\",\"å¸Œæœ›\"],\n\"query_list\": \"æ¢¦æƒ³,å¸Œæœ›\",\n```\n\nè¯·æ³¨æ„ï¼Œå…³é”®è¯æœç´¢å¿…é¡»è®¾å®š`cookie`ä¿¡æ¯ã€‚\n**query_listæ˜¯æ‰€æœ‰userçš„çˆ¬å–å…³é”®è¯ï¼Œéå¸¸ä¸çµæ´»ã€‚å¦‚æœä½ è¦çˆ¬å¤šä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”æƒ³å•ç‹¬ä¸ºæ¯ä¸ªç”¨æˆ·è®¾ç½®ä¸€ä¸ªquery_listï¼Œå¯ä»¥ä½¿ç”¨[å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åš](#7å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšå¯é€‰)æ–¹æ³•äºŒä¸­çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä¸ºå¤šä¸ªç”¨æˆ·è®¾ç½®ä¸åŒçš„query_listï¼Œéå¸¸çµæ´»**ã€‚\n\n**è®¾ç½®remove_html_tag**\n\nremove_html_tagæ§åˆ¶æ˜¯å¦ç§»é™¤æŠ“å–åˆ°çš„weiboæ­£æ–‡å’Œè¯„è®ºä¸­çš„html tagï¼Œå€¼ä¸º1ä»£è¡¨ç§»é™¤ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ç§»é™¤ï¼Œå¦‚\n\n```\n\"remove_html_tag\": 1,\n```\n\nä»£è¡¨ç§»é™¤html tagã€‚ä¾‹å¦‚`ä¸“å±æ–°æ„ï¼Œè‰²å½©å¯ç¨‹~<a href='/n/è·¯æ˜“å¨ç™»'>@è·¯æ˜“å¨ç™»</a> CAPUCINES æ‰‹è¢‹æ­£åˆæˆ‘æ„ï¼Œæ‰“å¼€çµæ„ŸåŒ…è¢‹çš„æ­é…æ–°æ–¹å¼ï¼`ä¼šè¢«å¤„ç†æˆ`ä¸“å±æ–°æ„ï¼Œè‰²å½©å¯ç¨‹~@è·¯æ˜“å¨ç™» CAPUCINES æ‰‹è¢‹æ­£åˆæˆ‘æ„ï¼Œæ‰“å¼€çµæ„ŸåŒ…è¢‹çš„æ­é…æ–°æ–¹å¼ï¼`ã€‚\n\n**è®¾ç½®write_mode**\n\nwrite_modeæ§åˆ¶ç»“æœæ–‡ä»¶æ ¼å¼ï¼Œå–å€¼èŒƒå›´æ˜¯csvã€jsonã€postã€mongoã€mysqlå’Œsqliteï¼Œåˆ†åˆ«ä»£è¡¨å°†ç»“æœå†™å…¥csvã€jsonæ–‡ä»¶ï¼Œé€šè¿‡POSTå‘å‡ºï¼ŒMongoDBã€MySQLå’ŒSQLiteæ•°æ®åº“ã€‚write_modeå¯ä»¥åŒæ—¶åŒ…å«è¿™äº›å–å€¼ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªï¼Œå¦‚ï¼š\n\n```\n\"write_mode\": [\"csv\", \"json\"],\n```\n\nä»£è¡¨å°†ç»“æœä¿¡æ¯å†™å…¥csvæ–‡ä»¶å’Œjsonæ–‡ä»¶ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœä½ æƒ³å†™å…¥æ•°æ®åº“ï¼Œé™¤äº†åœ¨write_modeæ·»åŠ å¯¹åº”æ•°æ®åº“çš„åå­—å¤–ï¼Œè¿˜åº”è¯¥å®‰è£…ç›¸å…³æ•°æ®åº“å’Œå¯¹åº”pythonæ¨¡å—ï¼Œå…·ä½“æ“ä½œè§[è®¾ç½®æ•°æ®åº“](#4è®¾ç½®æ•°æ®åº“å¯é€‰)éƒ¨åˆ†ã€‚\n\n**è®¾ç½®original_pic_download**\n\noriginal_pic_downloadæ§åˆ¶æ˜¯å¦ä¸‹è½½**åŸåˆ›**å¾®åšä¸­çš„å›¾ç‰‡ï¼Œå€¼ä¸º1ä»£è¡¨ä¸‹è½½ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ä¸‹è½½ï¼Œå¦‚\n\n```\n\"original_pic_download\": 1,\n```\n\nä»£è¡¨ä¸‹è½½åŸåˆ›å¾®åšä¸­çš„å›¾ç‰‡ã€‚\n\n**è®¾ç½®retweet_pic_download**\n\nretweet_pic_downloadæ§åˆ¶æ˜¯å¦ä¸‹è½½**è½¬å‘**å¾®åšä¸­çš„å›¾ç‰‡ï¼Œå€¼ä¸º1ä»£è¡¨ä¸‹è½½ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ä¸‹è½½ï¼Œå¦‚\n\n```\n\"retweet_pic_download\": 0,\n```\n\nä»£è¡¨ä¸ä¸‹è½½è½¬å‘å¾®åšä¸­çš„å›¾ç‰‡ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œæœ¬è®¾ç½®åªæœ‰åœ¨çˆ¬å…¨éƒ¨å¾®åšï¼ˆåŸåˆ›+è½¬å‘ï¼‰ï¼Œå³only_crawl_originalå€¼ä¸º0æ—¶ç”Ÿæ•ˆï¼Œå¦åˆ™ç¨‹åºä¼šè·³è¿‡è½¬å‘å¾®åšçš„å›¾ç‰‡ä¸‹è½½ã€‚\n\n**è®¾ç½®original_video_download**\n\noriginal_video_downloadæ§åˆ¶æ˜¯å¦ä¸‹è½½**åŸåˆ›**å¾®åšä¸­çš„è§†é¢‘å’Œ**åŸåˆ›**å¾®åš**Live Photo**ä¸­çš„è§†é¢‘ï¼Œå€¼ä¸º1ä»£è¡¨ä¸‹è½½ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ä¸‹è½½ï¼Œå¦‚\n\n```\n\"original_video_download\": 1,\n```\n\nä»£è¡¨ä¸‹è½½åŸåˆ›å¾®åšä¸­çš„è§†é¢‘å’ŒåŸåˆ›å¾®åšLive Photoä¸­çš„è§†é¢‘ã€‚\n\n**è®¾ç½®retweet_video_download**\n\nretweet_video_downloadæ§åˆ¶æ˜¯å¦ä¸‹è½½**è½¬å‘**å¾®åšä¸­çš„è§†é¢‘å’Œ**è½¬å‘**å¾®åš**Live Photo**ä¸­çš„è§†é¢‘ï¼Œå€¼ä¸º1ä»£è¡¨ä¸‹è½½ï¼Œå€¼ä¸º0ä»£è¡¨ä¸ä¸‹è½½ï¼Œå¦‚\n\n```\n\"retweet_video_download\": 0,\n```\n\nä»£è¡¨ä¸ä¸‹è½½è½¬å‘å¾®åšä¸­çš„è§†é¢‘å’Œè½¬å‘å¾®åšLive Photoä¸­çš„è§†é¢‘ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œæœ¬è®¾ç½®åªæœ‰åœ¨çˆ¬å…¨éƒ¨å¾®åšï¼ˆåŸåˆ›+è½¬å‘ï¼‰ï¼Œå³only_crawl_originalå€¼ä¸º0æ—¶ç”Ÿæ•ˆï¼Œå¦åˆ™ç¨‹åºä¼šè·³è¿‡è½¬å‘å¾®åšçš„è§†é¢‘ä¸‹è½½ã€‚\n\n**è®¾ç½®user_id_as_folder_name**\n\nuser_id_as_folder_nameæ§åˆ¶ç»“æœæ–‡ä»¶çš„ç›®å½•åï¼Œå¯å–å€¼ä¸º0å’Œ1ï¼Œé»˜è®¤ä¸º0ï¼š\n\n```\n\"user_id_as_folder_name\": 0,\n```\n\nå€¼ä¸º0ï¼Œè¡¨ç¤ºå°†ç»“æœæ–‡ä»¶ä¿å­˜åœ¨ä»¥ç”¨æˆ·æ˜µç§°ä¸ºåçš„æ–‡ä»¶å¤¹é‡Œï¼Œè¿™æ ·ç»“æœæ›´æ¸…æ™°ï¼›å€¼ä¸º1è¡¨ç¤ºå°†ç»“æœæ–‡ä»¶ä¿å­˜åœ¨ä»¥ç”¨æˆ·idä¸ºåçš„æ–‡ä»¶å¤¹é‡Œï¼Œè¿™æ ·èƒ½ä¿è¯å¤šæ¬¡çˆ¬å–çš„ä¸€è‡´æ€§ï¼Œå› ä¸ºç”¨æˆ·æ˜µç§°å¯å˜ï¼Œç”¨æˆ·idä¸å¯å˜ã€‚\n\n**è®¾ç½®download_comment**\n\ndownload_commentæ§åˆ¶æ˜¯å¦ä¸‹è½½æ¯æ¡å¾®åšä¸‹çš„ä¸€çº§è¯„è®ºï¼ˆä¸åŒ…æ‹¬å¯¹è¯„è®ºçš„è¯„è®ºï¼‰ï¼Œä»…å½“write_modeä¸­æœ‰sqliteæ—¶æœ‰æ•ˆï¼Œå¯å–å€¼ä¸º0å’Œ1ï¼Œé»˜è®¤ä¸º1ï¼š\n\n```\n\"download_comment\": 1,\n```\n\nå€¼ä¸º1ï¼Œè¡¨ç¤ºä¸‹è½½å¾®åšè¯„è®ºï¼›å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸ä¸‹è½½å¾®åšè¯„è®ºã€‚\n\n**è®¾ç½®comment_max_download_count**\n\ncomment_max_download_countæ§åˆ¶ä¸‹è½½è¯„è®ºçš„æœ€å¤§æ•°é‡ï¼Œä»…å½“write_modeä¸­æœ‰sqliteæ—¶æœ‰æ•ˆï¼Œé»˜è®¤ä¸º1000ï¼š\n\n```\n\"comment_max_download_count\": 1000,\n```\n\n**è®¾ç½®download_repost**\n\ndownload_repostæ§åˆ¶æ˜¯å¦ä¸‹è½½æ¯æ¡å¾®åšä¸‹çš„è½¬å‘ï¼Œä»…å½“write_modeä¸­æœ‰sqliteæ—¶æœ‰æ•ˆï¼Œå¯å–å€¼ä¸º0å’Œ1ï¼Œé»˜è®¤ä¸º1ï¼š\n\n```\n\"download_repost\": 1,\n```\n\nå€¼ä¸º1ï¼Œè¡¨ç¤ºä¸‹è½½å¾®åšè½¬å‘ï¼›å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸ä¸‹è½½å¾®åšè½¬å‘ã€‚\n\n**è®¾ç½®repost_max_download_count**\n\nrepost_max_download_countæ§åˆ¶ä¸‹è½½è½¬å‘çš„æœ€å¤§æ•°é‡ï¼Œä»…å½“write_modeä¸­æœ‰sqliteæ—¶æœ‰æ•ˆï¼Œé»˜è®¤ä¸º1000ï¼š\n\n```\n\"repost_max_download_count\": 1000,\n```\n\nå€¼ä¸º1000ï¼Œè¡¨ç¤ºæœ€å¤šä¸‹è½½æ¯æ¡å¾®åšä¸‹çš„1000æ¡è½¬å‘ã€‚\n\n**è®¾ç½®cookieï¼ˆå¯é€‰ï¼‰**\n\ncookieä¸ºå¯é€‰å‚æ•°ï¼Œå³å¯å¡«å¯ä¸å¡«ï¼Œå…·ä½“åŒºåˆ«è§[æ·»åŠ cookieä¸ä¸æ·»åŠ cookieçš„åŒºåˆ«](#æ·»åŠ cookieä¸ä¸æ·»åŠ cookieçš„åŒºåˆ«å¯é€‰)ã€‚cookieé»˜è®¤é…ç½®å¦‚ä¸‹ï¼š\n\n```\n\"cookie\": \"your cookie\",\n```\n\nå¦‚æœæƒ³è¦è®¾ç½®cookieï¼Œå¯ä»¥æŒ‰ç…§[å¦‚ä½•è·å–cookie](#å¦‚ä½•è·å–cookieå¯é€‰)ä¸­çš„æ–¹æ³•ï¼Œè·å–cookieï¼Œå¹¶å°†ä¸Šé¢çš„\"your cookie\"æ›¿æ¢æˆçœŸå®çš„cookieå³å¯ã€‚\n\n**è®¾ç½®mysql_configï¼ˆå¯é€‰ï¼‰**\n\nmysql_configæ§åˆ¶mysqlå‚æ•°é…ç½®ã€‚å¦‚æœä½ ä¸éœ€è¦å°†ç»“æœä¿¡æ¯å†™å…¥mysqlï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥å¿½ç•¥ï¼Œå³åˆ é™¤æˆ–ä¿ç•™éƒ½æ— æ‰€è°“ï¼›å¦‚æœä½ éœ€è¦å†™å…¥mysqlä¸”config.jsonæ–‡ä»¶ä¸­mysql_configçš„é…ç½®ä¸ä½ çš„mysqlé…ç½®ä¸ä¸€æ ·ï¼Œè¯·å°†è¯¥å€¼æ”¹æˆä½ è‡ªå·±mysqlä¸­çš„å‚æ•°é…ç½®ã€‚\n\n**è®¾ç½®mongodb_URIï¼ˆå¯é€‰ï¼‰**\n\nmongodb_URIæ˜¯mongodbçš„è¿æ¥å­—ç¬¦ä¸²ã€‚å¦‚æœä½ ä¸éœ€è¦å°†ç»“æœä¿¡æ¯å†™å…¥mongodbï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥å¿½ç•¥ï¼Œå³åˆ é™¤æˆ–ä¿ç•™éƒ½æ— æ‰€è°“ï¼›å¦‚æœä½ éœ€è¦å†™å…¥mongodbï¼Œåˆ™éœ€è¦é…ç½®ä¸º[å®Œæ•´çš„mongodb URI](https://www.mongodb.com/docs/manual/reference/connection-string/)ã€‚\n\n**è®¾ç½®start_pageï¼ˆå¯é€‰ï¼‰**\n\nstart_pageä¸ºçˆ¬å–å¾®åšçš„åˆå§‹é¡µæ•°ï¼Œé»˜è®¤å‚æ•°ä¸º1ï¼Œå³ä»æ‰€çˆ¬å–ç”¨æˆ·çš„å½“å‰ç¬¬ä¸€é¡µå¾®åšå†…å®¹å¼€å§‹çˆ¬å–ã€‚\nè‹¥åœ¨å¤§æ‰¹é‡çˆ¬å–å¾®åšæ—¶å‡ºç°ä¸­é€”è¢«é™åˆ¶ä¸­æ–­çš„æƒ…å†µï¼Œå¯é€šè¿‡æŸ¥çœ‹csvæ–‡ä»¶å†…ç›®å‰å·²çˆ¬å–åˆ°çš„å¾®åšæ•°é™¤ä»¥10ï¼Œå‘ä¸‹å–æ•´åçš„å€¼å³ä¸ºä¸­æ–­é¡µæ•°ï¼Œæ‰‹åŠ¨è®¾ç½®start_pageå‚æ•°ä¸ºä¸­æ–­é¡µæ•°ï¼Œé‡æ–°è¿è¡Œå³å¯ä»è¢«ä¸­æ–­çš„èŠ‚ç‚¹ç»§ç»­çˆ¬å–å‰©ä½™å¾®åšå†…å®¹ã€‚\n\n### 4.è®¾ç½®æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰\n\næœ¬éƒ¨åˆ†æ˜¯å¯é€‰éƒ¨åˆ†ï¼Œå¦‚æœä¸éœ€è¦å°†çˆ¬å–ä¿¡æ¯å†™å…¥æ•°æ®åº“ï¼Œå¯è·³è¿‡è¿™ä¸€æ­¥ã€‚æœ¬ç¨‹åºç›®å‰æ”¯æŒMySQLæ•°æ®åº“å’ŒMongoDBæ•°æ®åº“ï¼Œå¦‚æœä½ éœ€è¦å†™å…¥å…¶å®ƒæ•°æ®åº“ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸¤ä¸ªæ•°æ®åº“çš„å†™æ³•è‡ªå·±ç¼–å†™ã€‚\n\n**MySQLæ•°æ®åº“å†™å…¥**\n\nè¦æƒ³å°†çˆ¬å–ä¿¡æ¯å†™å…¥MySQLï¼Œè¯·æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿç¯å¢ƒå®‰è£…MySQLï¼Œç„¶åå‘½ä»¤è¡Œæ‰§è¡Œï¼š\n\n```bash\npip install pymysql\n```\n\n**MongoDBæ•°æ®åº“å†™å…¥**\n\nè¦æƒ³å°†çˆ¬å–ä¿¡æ¯å†™å…¥MongoDBï¼Œè¯·æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿç¯å¢ƒå®‰è£…MongoDBï¼Œç„¶åå‘½ä»¤è¡Œæ‰§è¡Œï¼š\n\n```\npip install pymongo\n```\n\nMySQLå’ŒMongDBæ•°æ®åº“çš„å†™å…¥å†…å®¹ä¸€æ ·ã€‚ç¨‹åºé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªåä¸º\"weibo\"çš„æ•°æ®åº“ï¼Œç„¶åå†åˆ›å»º\"user\"è¡¨å’Œ\"weibo\"è¡¨ï¼ŒåŒ…å«çˆ¬å–çš„æ‰€æœ‰å†…å®¹ã€‚çˆ¬å–åˆ°çš„å¾®åš**ç”¨æˆ·ä¿¡æ¯**æˆ–æ’å…¥æˆ–æ›´æ–°ï¼Œéƒ½ä¼šå­˜å‚¨åˆ°userè¡¨é‡Œï¼›çˆ¬å–åˆ°çš„**å¾®åšä¿¡æ¯**æˆ–æ’å…¥æˆ–æ›´æ–°ï¼Œéƒ½ä¼šå­˜å‚¨åˆ°weiboè¡¨é‡Œï¼Œä¸¤ä¸ªè¡¨é€šè¿‡user_idå…³è”ã€‚å¦‚æœæƒ³äº†è§£ä¸¤ä¸ªè¡¨çš„å…·ä½“å­—æ®µï¼Œè¯·ç‚¹å‡»\"è¯¦æƒ…\"ã€‚\n<details>\n\n<summary>è¯¦æƒ…</summary>\n\n**user**è¡¨\n\n**id**ï¼šå¾®åšç”¨æˆ·idï¼Œå¦‚\"1669879400\"ï¼›\n\n**screen_name**ï¼šå¾®åšç”¨æˆ·æ˜µç§°ï¼Œå¦‚\"Dear-è¿ªä¸½çƒ­å·´\"ï¼›\n\n**gender**ï¼šå¾®åšç”¨æˆ·æ€§åˆ«ï¼Œå–å€¼ä¸ºfæˆ–mï¼Œåˆ†åˆ«ä»£è¡¨å¥³å’Œç”·ï¼›\n\n**birthday**ï¼šç”Ÿæ—¥ï¼›\n\n**location**ï¼šæ‰€åœ¨åœ°ï¼›\n\n**education**ï¼šæ•™è‚²ç»å†ï¼›\n\n**company**ï¼šå…¬å¸ï¼›\n\n**sunshine**ï¼šé˜³å…‰ä¿¡ç”¨ï¼›\n\n**registration_time**ï¼šæ³¨å†Œæ—¶é—´ï¼›\n\n**statuses_count**ï¼šå¾®åšæ•°ï¼›\n\n**followers_count**ï¼šç²‰ä¸æ•°ï¼›\n\n**follow_count**ï¼šå…³æ³¨æ•°ï¼›\n\n**description**ï¼šå¾®åšç®€ä»‹ï¼›\n\n**profile_url**ï¼šå¾®åšä¸»é¡µï¼Œå¦‚<https://m.weibo.cn/u/1669879400?uid=1669879400&luicode=10000011&lfid=1005051669879400>;\n\n**profile_image_url**ï¼šå¾®åšå¤´åƒurlï¼›\n\n**avatar_hd**ï¼šå¾®åšé«˜æ¸…å¤´åƒurlï¼›\n\n**urank**ï¼šå¾®åšç­‰çº§ï¼›\n\n**mbrank**ï¼šå¾®åšä¼šå‘˜ç­‰çº§ï¼Œæ™®é€šç”¨æˆ·ä¼šå‘˜ç­‰çº§ä¸º0ï¼›\n\n**verified**ï¼šå¾®åšæ˜¯å¦è®¤è¯ï¼Œå–å€¼ä¸ºtrueå’Œfalseï¼›\n\n**verified_type**ï¼šå¾®åšè®¤è¯ç±»å‹ï¼Œæ²¡æœ‰è®¤è¯å€¼ä¸º-1ï¼Œä¸ªäººè®¤è¯å€¼ä¸º0ï¼Œä¼ä¸šè®¤è¯å€¼ä¸º2ï¼Œæ”¿åºœè®¤è¯å€¼ä¸º3ï¼Œè¿™äº›ç±»å‹ä»…æ˜¯ä¸ªäººçŒœæµ‹ï¼Œåº”è¯¥ä¸å…¨ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåˆ¤æ–­ï¼›\n\n**verified_reason**ï¼šå¾®åšè®¤è¯ä¿¡æ¯ï¼Œåªæœ‰è®¤è¯ç”¨æˆ·æ‹¥æœ‰æ­¤å±æ€§ã€‚\n\n***\n**weibo**è¡¨\n\n**user_id**ï¼šå­˜å‚¨å¾®åšç”¨æˆ·idï¼Œå¦‚\"1669879400\"ï¼›\n\n**screen_name**ï¼šå­˜å‚¨å¾®åšæ˜µç§°ï¼Œå¦‚\"Dear-è¿ªä¸½çƒ­å·´\"ï¼›\n\n**id**ï¼šå­˜å‚¨å¾®åšidï¼›\n\n**text**ï¼šå­˜å‚¨å¾®åšæ­£æ–‡ï¼›\n\n**article_url**ï¼šå­˜å‚¨å¾®åšä¸­å¤´æ¡æ–‡ç« çš„urlï¼Œå¦‚æœå¾®åšä¸­å­˜åœ¨å¤´æ¡æ–‡ç« ï¼Œå°±è·å–è¯¥å¤´æ¡æ–‡ç« çš„urlï¼Œå¦åˆ™è¯¥å€¼ä¸º''ï¼›\n\n**pics**ï¼šå­˜å‚¨åŸåˆ›å¾®åšçš„åŸå§‹å›¾ç‰‡urlã€‚è‹¥æŸæ¡å¾®åšæœ‰å¤šå¼ å›¾ç‰‡ï¼Œåˆ™å­˜å‚¨å¤šä¸ªurlï¼Œä»¥è‹±æ–‡é€—å·åˆ†å‰²ï¼›è‹¥è¯¥å¾®åšæ²¡æœ‰å›¾ç‰‡ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**video_url**ï¼šå­˜å‚¨åŸåˆ›å¾®åšçš„è§†é¢‘urlå’ŒLive Photoä¸­çš„è§†é¢‘urlã€‚è‹¥æŸæ¡å¾®åšæœ‰å¤šä¸ªè§†é¢‘ï¼Œåˆ™å­˜å‚¨å¤šä¸ªurlï¼Œä»¥è‹±æ–‡åˆ†å·åˆ†å‰²ï¼›è‹¥è¯¥å¾®åšæ²¡æœ‰è§†é¢‘ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**location**ï¼šå­˜å‚¨å¾®åšçš„å‘å¸ƒä½ç½®ã€‚è‹¥æŸæ¡å¾®åšæ²¡æœ‰ä½ç½®ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**created_at**ï¼šå­˜å‚¨å¾®åšçš„å‘å¸ƒæ—¶é—´ï¼›\n\n**source**ï¼šå­˜å‚¨å¾®åšçš„å‘å¸ƒå·¥å…·ï¼›\n\n**attitudes_count**ï¼šå­˜å‚¨å¾®åšè·å¾—çš„ç‚¹èµæ•°ï¼›\n\n**comments_count**ï¼šå­˜å‚¨å¾®åšè·å¾—çš„è¯„è®ºæ•°ï¼›\n\n**reposts_count**ï¼šå­˜å‚¨å¾®åšè·å¾—çš„è½¬å‘æ•°ï¼›\n\n**topics**ï¼šå­˜å‚¨å¾®åšè¯é¢˜ï¼Œå³ä¸¤ä¸ª#ä¸­çš„å†…å®¹ã€‚è‹¥æŸæ¡å¾®åšæ²¡æœ‰è¯é¢˜ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**at_users**ï¼šå­˜å‚¨å¾®åš@çš„ç”¨æˆ·ã€‚è‹¥æŸæ¡å¾®åšæ²¡æœ‰@çš„ç”¨æˆ·ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**retweet_id**ï¼šå­˜å‚¨è½¬å‘å¾®åšä¸­åŸå§‹å¾®åšçš„å¾®åšidã€‚è‹¥æŸæ¡å¾®åšä¸ºåŸåˆ›å¾®åšï¼Œåˆ™å€¼ä¸º''ã€‚\n\n</details>\n**SQLiteæ•°æ®åº“å†™å…¥**\n\nè„šæœ¬ä¼šè‡ªåŠ¨å»ºç«‹å¹¶é…ç½®æ•°æ®åº“æ–‡ä»¶`weibodata.db`ã€‚\n\n### 5.è¿è¡Œè„šæœ¬\n\nå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„è¿è¡Œç¯å¢ƒé€‰æ‹©è¿è¡Œæ–¹å¼ï¼ŒLinuxå¯ä»¥é€šè¿‡\n\n```bash\npython weibo.py\n```\n\nè¿è¡Œ;\n\n### 6.æŒ‰éœ€æ±‚ä¿®æ”¹è„šæœ¬ï¼ˆå¯é€‰ï¼‰\n\næœ¬éƒ¨åˆ†ä¸ºå¯é€‰éƒ¨åˆ†ï¼Œå¦‚æœä½ ä¸éœ€è¦è‡ªå·±ä¿®æ”¹ä»£ç æˆ–æ·»åŠ æ–°åŠŸèƒ½ï¼Œå¯ä»¥å¿½ç•¥æ­¤éƒ¨åˆ†ã€‚\n\næœ¬ç¨‹åºæ‰€æœ‰ä»£ç éƒ½ä½äºweibo.pyæ–‡ä»¶ï¼Œç¨‹åºä¸»ä½“æ˜¯ä¸€ä¸ªWeiboç±»ï¼Œä¸Šè¿°æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯é€šè¿‡åœ¨mainå‡½æ•°è°ƒç”¨Weiboç±»å®ç°çš„ï¼Œé»˜è®¤çš„è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š\n\n```python\n        if not os.path.isfile('./config.json'):\n            sys.exit(u'å½“å‰è·¯å¾„ï¼š%s ä¸å­˜åœ¨é…ç½®æ–‡ä»¶config.json' %\n                     (os.path.split(os.path.realpath(__file__))[0] + os.sep))\n        with open('./config.json') as f:\n            config = json.loads(f.read())\n        wb = Weibo(config)\n        wb.start()  # çˆ¬å–å¾®åšä¿¡æ¯\n```\n\nç”¨æˆ·å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚è°ƒç”¨æˆ–ä¿®æ”¹Weiboç±»ã€‚\n\né€šè¿‡æ‰§è¡Œæœ¬ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¾ˆå¤šä¿¡æ¯ï¼š\n\n**wb.user**ï¼šå­˜å‚¨ç›®æ ‡å¾®åšç”¨æˆ·ä¿¡æ¯ï¼›\n\nwb.useråŒ…å«çˆ¬å–åˆ°çš„å¾®åšç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚**ç”¨æˆ·id**ã€**ç”¨æˆ·æ˜µç§°**ã€**æ€§åˆ«**ã€**ç”Ÿæ—¥**ã€**æ‰€åœ¨åœ°**ã€**æ•™è‚²ç»å†**ã€**å…¬å¸**ã€**é˜³å…‰ä¿¡ç”¨**ã€**å¾®åšæ³¨å†Œæ—¶é—´**ã€**å¾®åšæ•°**ã€**ç²‰ä¸æ•°**ã€**å…³æ³¨æ•°**ã€**ç®€ä»‹**ã€**ä¸»é¡µåœ°å€**ã€**å¤´åƒurl**ã€**é«˜æ¸…å¤´åƒurl**ã€**å¾®åšç­‰çº§**ã€**ä¼šå‘˜ç­‰çº§**ã€**æ˜¯å¦è®¤è¯**ã€**è®¤è¯ç±»å‹**ã€**è®¤è¯ä¿¡æ¯**ç­‰ï¼Œå¤§å®¶å¯ä»¥ç‚¹å‡»\"è¯¦æƒ…\"æŸ¥çœ‹å…·ä½“ç”¨æ³•ã€‚\n\n<details>\n\n<summary>è¯¦æƒ…</summary>\n\n**id**ï¼šå¾®åšç”¨æˆ·idï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['id'],ç”±ä¸€ä¸²æ•°å­—ç»„æˆï¼›\n\n**screen_name**ï¼šå¾®åšç”¨æˆ·æ˜µç§°ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['screen_name']ï¼›\n\n**gender**ï¼šå¾®åšç”¨æˆ·æ€§åˆ«ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['gender']ï¼Œå–å€¼ä¸ºfæˆ–mï¼Œåˆ†åˆ«ä»£è¡¨å¥³å’Œç”·ï¼›\n\n**birthday**ï¼šå¾®åšç”¨æˆ·ç”Ÿæ—¥ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['birthday']ï¼Œè‹¥ç”¨æˆ·æ²¡æœ‰å¡«å†™è¯¥ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**location**ï¼šå¾®åšç”¨æˆ·æ‰€åœ¨åœ°ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['location']ï¼Œè‹¥ç”¨æˆ·æ²¡æœ‰å¡«å†™è¯¥ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**education**ï¼šå¾®åšç”¨æˆ·ä¸Šå­¦æ—¶çš„å­¦æ ¡ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['education']ï¼Œè‹¥ç”¨æˆ·æ²¡æœ‰å¡«å†™è¯¥ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**company**ï¼šå¾®åšç”¨æˆ·æ‰€å±çš„å…¬å¸ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['company']ï¼Œè‹¥ç”¨æˆ·æ²¡æœ‰å¡«å†™è¯¥ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**sunshine**ï¼šå¾®åšç”¨æˆ·çš„é˜³å…‰ä¿¡ç”¨ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['sunshine']ï¼›\n\n**registration_time**ï¼šå¾®åšç”¨æˆ·çš„æ³¨å†Œæ—¶é—´ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['registration_time']ï¼›\n\n**statuses_count**ï¼šå¾®åšæ•°ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['statuses_count']ï¼›\n\n**followers_count**ï¼šå¾®åšç²‰ä¸æ•°ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['followers_count']ï¼›\n\n**follow_count**ï¼šå¾®åšå…³æ³¨æ•°ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['follow_count']ï¼›\n\n**description**ï¼šå¾®åšç®€ä»‹ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['description']ï¼›\n\n**profile_url**ï¼šå¾®åšä¸»é¡µï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['profile_url'];\n\n**profile_image_url**ï¼šå¾®åšå¤´åƒurlï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['profile_image_url']ï¼›\n\n**avatar_hd**ï¼šå¾®åšé«˜æ¸…å¤´åƒurlï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['avatar_hd']ï¼›\n\n**urank**ï¼šå¾®åšç­‰çº§ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['urank']ï¼›\n\n**mbrank**ï¼šå¾®åšä¼šå‘˜ç­‰çº§ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['mbrank']ï¼Œæ™®é€šç”¨æˆ·ä¼šå‘˜ç­‰çº§ä¸º0ï¼›\n\n**verified**ï¼šå¾®åšæ˜¯å¦è®¤è¯ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['verified']ï¼Œå–å€¼ä¸ºtrueå’Œfalseï¼›\n\n**verified_type**ï¼šå¾®åšè®¤è¯ç±»å‹ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['verified_type']ï¼Œæ²¡æœ‰è®¤è¯å€¼ä¸º-1ï¼Œä¸ªäººè®¤è¯å€¼ä¸º0ï¼Œä¼ä¸šè®¤è¯å€¼ä¸º2ï¼Œæ”¿åºœè®¤è¯å€¼ä¸º3ï¼Œè¿™äº›ç±»å‹ä»…æ˜¯ä¸ªäººçŒœæµ‹ï¼Œåº”è¯¥ä¸å…¨ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåˆ¤æ–­ï¼›\n\n**verified_reason**ï¼šå¾®åšè®¤è¯ä¿¡æ¯ï¼Œå–å€¼æ–¹å¼ä¸ºwb.user['verified_reason']ï¼Œåªæœ‰è®¤è¯ç”¨æˆ·æ‹¥æœ‰æ­¤å±æ€§ã€‚\n\n</details>\n\n**wb.weibo**ï¼šå­˜å‚¨çˆ¬å–åˆ°çš„æ‰€æœ‰å¾®åšä¿¡æ¯ï¼›\n\nwb.weiboåŒ…å«çˆ¬å–åˆ°çš„æ‰€æœ‰å¾®åšä¿¡æ¯ï¼Œå¦‚**å¾®åšid**ã€**æ­£æ–‡**ã€**åŸå§‹å›¾ç‰‡url**ã€**è§†é¢‘url**ã€**ä½ç½®**ã€**æ—¥æœŸ**ã€**å‘å¸ƒå·¥å…·**ã€**ç‚¹èµæ•°**ã€**è½¬å‘æ•°**ã€**è¯„è®ºæ•°**ã€**è¯é¢˜**ã€**@ç”¨æˆ·**ç­‰ã€‚å¦‚æœçˆ¬çš„æ˜¯å…¨éƒ¨å¾®åš(åŸåˆ›+è½¬å‘)ï¼Œé™¤ä¸Šè¿°ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜åŒ…å«**åŸå§‹ç”¨æˆ·id**ã€**åŸå§‹ç”¨æˆ·æ˜µç§°**ã€**åŸå§‹å¾®åšid**ã€**åŸå§‹å¾®åšæ­£æ–‡**ã€**åŸå§‹å¾®åšåŸå§‹å›¾ç‰‡url**ã€**åŸå§‹å¾®åšä½ç½®**ã€**åŸå§‹å¾®åšæ—¥æœŸ**ã€**åŸå§‹å¾®åšå·¥å…·**ã€**åŸå§‹å¾®åšç‚¹èµæ•°**ã€**åŸå§‹å¾®åšè¯„è®ºæ•°**ã€**åŸå§‹å¾®åšè½¬å‘æ•°**ã€**åŸå§‹å¾®åšè¯é¢˜**ã€**åŸå§‹å¾®åš@ç”¨æˆ·**ç­‰ä¿¡æ¯ã€‚wb.weiboæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«äº†çˆ¬å–çš„æ‰€æœ‰å¾®åšä¿¡æ¯ã€‚wb.weibo[0]ä¸ºçˆ¬å–çš„ç¬¬ä¸€æ¡å¾®åšï¼Œwb.weibo[1]ä¸ºçˆ¬å–çš„ç¬¬äºŒæ¡å¾®åšï¼Œä»¥æ­¤ç±»æ¨ã€‚å½“only_crawl_original=1æ—¶ï¼Œwb.weibo[0]ä¸ºçˆ¬å–çš„ç¬¬ä¸€æ¡**åŸåˆ›**å¾®åšï¼Œä»¥æ­¤ç±»æ¨ã€‚wb.weibo[0]['id']ä¸ºç¬¬ä¸€æ¡å¾®åšçš„idï¼Œwb.weibo[0]['text']ä¸ºç¬¬ä¸€æ¡å¾®åšçš„æ­£æ–‡ï¼Œwb.weibo[0]['created_at']ä¸ºç¬¬ä¸€æ¡å¾®åšçš„å‘å¸ƒæ—¶é—´ï¼Œè¿˜æœ‰å…¶å®ƒå¾ˆå¤šä¿¡æ¯ä¸åœ¨èµ˜è¿°ï¼Œå¤§å®¶å¯ä»¥ç‚¹å‡»ä¸‹é¢çš„\"è¯¦æƒ…\"æŸ¥çœ‹å…·ä½“ç”¨æ³•ã€‚\n<details>\n\n<summary>è¯¦æƒ…</summary>\n\n**user_id**ï¼šå­˜å‚¨å¾®åšç”¨æˆ·idã€‚å¦‚wb.weibo[0]['user_id']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„ç”¨æˆ·idï¼›\n\n**screen_name**ï¼šå­˜å‚¨å¾®åšæ˜µç§°ã€‚å¦‚wb.weibo[0]['screen_name']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„æ˜µç§°ï¼›\n\n**id**ï¼šå­˜å‚¨å¾®åšidã€‚å¦‚wb.weibo[0]['id']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„idï¼›\n\n**text**ï¼šå­˜å‚¨å¾®åšæ­£æ–‡ã€‚å¦‚wb.weibo[0]['text']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„æ­£æ–‡ï¼›\n\n**article_url**ï¼šå­˜å‚¨å¾®åšä¸­å¤´æ¡æ–‡ç« çš„urlã€‚å¦‚wb.weibo[0]['article_url']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„å¤´æ¡æ–‡ç« urlï¼Œè‹¥å¾®åšä¸­ä¸å­˜åœ¨å¤´æ¡æ–‡ç« ï¼Œåˆ™è¯¥å€¼ä¸º''ï¼›\n\n**pics**ï¼šå­˜å‚¨åŸåˆ›å¾®åšçš„åŸå§‹å›¾ç‰‡urlã€‚å¦‚wb.weibo[0]['pics']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„åŸå§‹å›¾ç‰‡urlï¼Œè‹¥è¯¥æ¡å¾®åšæœ‰å¤šå¼ å›¾ç‰‡ï¼Œåˆ™å­˜å‚¨å¤šä¸ªurlï¼Œä»¥è‹±æ–‡é€—å·åˆ†å‰²ï¼›è‹¥è¯¥å¾®åšæ²¡æœ‰å›¾ç‰‡ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**video_url**ï¼šå­˜å‚¨åŸåˆ›å¾®åšçš„è§†é¢‘urlå’ŒåŸåˆ›å¾®åšLive Photoä¸­çš„è§†é¢‘urlã€‚å¦‚wb.weibo[0]['video_url']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„è§†é¢‘urlï¼Œè‹¥è¯¥æ¡å¾®åšæœ‰å¤šä¸ªè§†é¢‘ï¼Œåˆ™å­˜å‚¨å¤šä¸ªurlï¼Œä»¥è‹±æ–‡åˆ†å·åˆ†å‰²ï¼›è‹¥è¯¥å¾®åšæ²¡æœ‰è§†é¢‘ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**location**ï¼šå­˜å‚¨å¾®åšçš„å‘å¸ƒä½ç½®ã€‚å¦‚wb.weibo[0]['location']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„å‘å¸ƒä½ç½®ï¼Œè‹¥è¯¥æ¡å¾®åšæ²¡æœ‰ä½ç½®ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**created_at**ï¼šå­˜å‚¨å¾®åšçš„å‘å¸ƒæ—¶é—´ã€‚å¦‚wb.weibo[0]['created_at']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„å‘å¸ƒæ—¶é—´ï¼›\n\n**source**ï¼šå­˜å‚¨å¾®åšçš„å‘å¸ƒå·¥å…·ã€‚å¦‚wb.weibo[0]['source']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„å‘å¸ƒå·¥å…·ï¼›\n\n**attitudes_count**ï¼šå­˜å‚¨å¾®åšè·å¾—çš„ç‚¹èµæ•°ã€‚å¦‚wb.weibo[0]['attitudes_count']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšè·å¾—çš„ç‚¹èµæ•°ï¼›\n\n**comments_count**ï¼šå­˜å‚¨å¾®åšè·å¾—çš„è¯„è®ºæ•°ã€‚å¦‚wb.weibo[0]['comments_count']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšè·å¾—çš„è¯„è®ºæ•°ï¼›\n\n**reposts_count**ï¼šå­˜å‚¨å¾®åšè·å¾—çš„è½¬å‘æ•°ã€‚å¦‚wb.weibo[0]['reposts_count']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšè·å¾—çš„è½¬å‘æ•°ï¼›\n\n**topics**ï¼šå­˜å‚¨å¾®åšè¯é¢˜ï¼Œå³ä¸¤ä¸ª#ä¸­çš„å†…å®¹ã€‚å¦‚wb.weibo[0]['topics']ä¸ºæœ€æ–°ä¸€æ¡å¾®åšçš„è¯é¢˜ï¼Œè‹¥è¯¥æ¡å¾®åšæ²¡æœ‰è¯é¢˜ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**at_users**ï¼šå­˜å‚¨å¾®åš@çš„ç”¨æˆ·ã€‚å¦‚wb.weibo[0]['at_users']ä¸ºæœ€æ–°ä¸€æ¡å¾®åš@çš„ç”¨æˆ·ï¼Œè‹¥è¯¥æ¡å¾®åšæ²¡æœ‰@çš„ç”¨æˆ·ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**retweet**ï¼šå­˜å‚¨è½¬å‘å¾®åšä¸­åŸå§‹å¾®åšçš„å…¨éƒ¨ä¿¡æ¯ã€‚å‡å¦‚wb.weibo[0]ä¸ºè½¬å‘å¾®åšï¼Œåˆ™wb.weibo[0]['retweet']ä¸ºè¯¥è½¬å‘å¾®åšçš„åŸå§‹å¾®åšï¼Œå®ƒå­˜å‚¨çš„å±æ€§ä¸wb.weibo[0]ä¸€æ ·ï¼Œåªæ˜¯æ²¡æœ‰retweetå±æ€§;è‹¥è¯¥æ¡å¾®åšä¸ºåŸåˆ›å¾®åšï¼Œåˆ™wb[0]æ²¡æœ‰\"retweet\"å±æ€§ï¼Œå¤§å®¶å¯ä»¥ç‚¹å‡»\"è¯¦æƒ…\"æŸ¥çœ‹å…·ä½“ç”¨æ³•ã€‚\n\n<details>\n\n<summary>è¯¦æƒ…</summary>\n\nå‡è®¾çˆ¬å–åˆ°çš„ç¬¬iæ¡å¾®åšä¸ºè½¬å‘å¾®åšï¼Œåˆ™å®ƒå­˜åœ¨ä»¥ä¸‹ä¿¡æ¯ï¼š\n\n**user_id**ï¼šå­˜å‚¨åŸå§‹å¾®åšç”¨æˆ·idã€‚wb.weibo[i-1]['retweet']['user_id']ä¸ºè¯¥åŸå§‹å¾®åšçš„ç”¨æˆ·idï¼›\n\n**screen_name**ï¼šå­˜å‚¨åŸå§‹å¾®åšæ˜µç§°ã€‚wb.weibo[i-1]['retweet']['screen_name']ä¸ºè¯¥åŸå§‹å¾®åšçš„æ˜µç§°ï¼›\n\n**id**ï¼šå­˜å‚¨åŸå§‹å¾®åšidã€‚wb.weibo[i-1]['retweet']['id']ä¸ºè¯¥åŸå§‹å¾®åšçš„idï¼›\n\n**text**ï¼šå­˜å‚¨åŸå§‹å¾®åšæ­£æ–‡ã€‚wb.weibo[i-1]['retweet']['text']ä¸ºè¯¥åŸå§‹å¾®åšçš„æ­£æ–‡ï¼›\n\n**article_url**ï¼šå­˜å‚¨åŸå§‹å¾®åšä¸­å¤´æ¡æ–‡ç« çš„urlã€‚å¦‚wb.weibo[i-1]['retweet']['article_url']ä¸ºè¯¥åŸå§‹å¾®åšçš„å¤´æ¡æ–‡ç« urlï¼Œè‹¥åŸå§‹å¾®åšä¸­ä¸å­˜åœ¨å¤´æ¡æ–‡ç« ï¼Œåˆ™è¯¥å€¼ä¸º''ï¼›\n\n**pics**ï¼šå­˜å‚¨åŸå§‹å¾®åšçš„åŸå§‹å›¾ç‰‡urlã€‚wb.weibo[i-1]['retweet']['pics']ä¸ºè¯¥åŸå§‹å¾®åšçš„åŸå§‹å›¾ç‰‡urlï¼Œè‹¥è¯¥åŸå§‹å¾®åšæœ‰å¤šå¼ å›¾ç‰‡ï¼Œåˆ™å­˜å‚¨å¤šä¸ªurlï¼Œä»¥è‹±æ–‡é€—å·åˆ†å‰²ï¼›è‹¥è¯¥åŸå§‹å¾®åšæ²¡æœ‰å›¾ç‰‡ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**video_url**ï¼šå­˜å‚¨åŸå§‹å¾®åšçš„è§†é¢‘urlå’ŒåŸå§‹å¾®åšLive Photoä¸­çš„è§†é¢‘urlã€‚å¦‚wb.weibo[i-1]['retweet']['video_url']ä¸ºè¯¥åŸå§‹å¾®åšçš„è§†é¢‘urlï¼Œè‹¥è¯¥åŸå§‹å¾®åšæœ‰å¤šä¸ªè§†é¢‘ï¼Œåˆ™å­˜å‚¨å¤šä¸ªurlï¼Œä»¥è‹±æ–‡åˆ†å·åˆ†å‰²ï¼›è‹¥è¯¥å¾®åšæ²¡æœ‰è§†é¢‘ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**location**ï¼šå­˜å‚¨åŸå§‹å¾®åšçš„å‘å¸ƒä½ç½®ã€‚wb.weibo[i-1]['retweet']['location']ä¸ºè¯¥åŸå§‹å¾®åšçš„å‘å¸ƒä½ç½®ï¼Œè‹¥è¯¥åŸå§‹å¾®åšæ²¡æœ‰ä½ç½®ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**created_at**ï¼šå­˜å‚¨åŸå§‹å¾®åšçš„å‘å¸ƒæ—¶é—´ã€‚wb.weibo[i-1]['retweet']['created_at']ä¸ºè¯¥åŸå§‹å¾®åšçš„å‘å¸ƒæ—¶é—´ï¼›\n\n**source**ï¼šå­˜å‚¨åŸå§‹å¾®åšçš„å‘å¸ƒå·¥å…·ã€‚wb.weibo[i-1]['retweet']['source']ä¸ºè¯¥åŸå§‹å¾®åšçš„å‘å¸ƒå·¥å…·ï¼›\n\n**attitudes_count**ï¼šå­˜å‚¨åŸå§‹å¾®åšè·å¾—çš„ç‚¹èµæ•°ã€‚wb.weibo[i-1]['retweet']['attitudes_count']ä¸ºè¯¥åŸå§‹å¾®åšè·å¾—çš„ç‚¹èµæ•°ï¼›\n\n**comments_count**ï¼šå­˜å‚¨åŸå§‹å¾®åšè·å¾—çš„è¯„è®ºæ•°ã€‚wb.weibo[i-1]['retweet']['comments_count']ä¸ºè¯¥åŸå§‹å¾®åšè·å¾—çš„è¯„è®ºæ•°ï¼›\n\n**reposts_count**ï¼šå­˜å‚¨åŸå§‹å¾®åšè·å¾—çš„è½¬å‘æ•°ã€‚wb.weibo[i-1]['retweet']['reposts_count']ä¸ºè¯¥åŸå§‹å¾®åšè·å¾—çš„è½¬å‘æ•°ï¼›\n\n**topics**ï¼šå­˜å‚¨åŸå§‹å¾®åšè¯é¢˜ï¼Œå³ä¸¤ä¸ª#ä¸­çš„å†…å®¹ã€‚wb.weibo[i-1]['retweet']['topics']ä¸ºè¯¥åŸå§‹å¾®åšçš„è¯é¢˜ï¼Œè‹¥è¯¥åŸå§‹å¾®åšæ²¡æœ‰è¯é¢˜ä¿¡æ¯ï¼Œåˆ™å€¼ä¸º''ï¼›\n\n**at_users**ï¼šå­˜å‚¨åŸå§‹å¾®åš@çš„ç”¨æˆ·ã€‚wb.weibo[i-1]['retweet']['at_users']ä¸ºè¯¥åŸå§‹å¾®åš@çš„ç”¨æˆ·ï¼Œè‹¥è¯¥åŸå§‹å¾®åšæ²¡æœ‰@çš„ç”¨æˆ·ï¼Œåˆ™å€¼ä¸º''ã€‚\n\n</details>\n\n</details>\n\n### 7.å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšï¼ˆå¯é€‰ï¼‰\n\næˆ‘ä»¬çˆ¬å–äº†å¾®åšä»¥åï¼Œå¾ˆå¤šå¾®åšè´¦å·åˆå¯èƒ½å‘äº†ä¸€äº›æ–°å¾®åšï¼Œå®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšå°±æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨è¿è¡Œç¨‹åºï¼Œè‡ªåŠ¨çˆ¬å–è¿™æ®µæ—¶é—´äº§ç”Ÿçš„æ–°å¾®åšï¼ˆå¿½ç•¥ä»¥å‰çˆ¬è¿‡çš„æ—§å¾®åšï¼‰ã€‚æœ¬éƒ¨åˆ†ä¸ºå¯é€‰éƒ¨åˆ†ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥å¿½ç•¥ã€‚\n\næ€è·¯æ˜¯**åˆ©ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œå¦‚crontabï¼Œè®©ç¨‹åºæ¯éš”ä¸€æ®µæ—¶é—´è¿è¡Œä¸€æ¬¡**ã€‚å› ä¸ºæ˜¯è¦è·³è¿‡ä»¥å‰çˆ¬è¿‡çš„æ—§å¾®åšï¼Œåªçˆ¬æ–°å¾®åšã€‚æ‰€ä»¥éœ€è¦**è®¾ç½®ä¸€ä¸ªåŠ¨æ€çš„since_date**ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä½¿ç”¨çš„since_dateæ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚since_date=\"2018-01-01\"ï¼Œç¨‹åºå°±ä¼šæŒ‰ç…§è¿™ä¸ªè®¾ç½®ä»æœ€æ–°çš„å¾®åšä¸€ç›´çˆ¬åˆ°å‘å¸ƒæ—¶é—´ä¸º2018-01-01çš„å¾®åšï¼ˆåŒ…æ‹¬è¿™ä¸ªæ—¶é—´ï¼‰ã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¿½åŠ æ–°å¾®åšï¼Œè·³è¿‡æ—§å¾®åšã€‚ç¬¬äºŒæ¬¡çˆ¬å–æ—¶since_dateå€¼å°±åº”è¯¥æ˜¯å½“å‰æ—¶é—´åˆ°ä¸Šæ¬¡çˆ¬å–çš„æ—¶é—´ã€‚ å¦‚æœæˆ‘ä»¬ä½¿ç”¨æœ€åŸå§‹çš„æ–¹å¼å®ç°è¿½åŠ çˆ¬å–ï¼Œåº”è¯¥æ˜¯è¿™æ ·ï¼š\n\n```\nå‡å¦‚ç¨‹åºç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯2019-06-06ï¼Œsince_dateå‡å¦‚ä¸º2018-01-01ï¼Œé‚£è¿™ä¸€æ¬¡å°±æ˜¯çˆ¬å–ä»2018-01-01åˆ°2019-06-06è¿™æ®µæ—¶é—´ç”¨æˆ·æ‰€å‘çš„å¾®åšï¼›\nç¬¬äºŒæ¬¡çˆ¬å–ï¼Œæˆ‘ä»¬æƒ³è¦æ¥ç€ä¸Šæ¬¡çš„çˆ¬ï¼Œéœ€è¦æ‰‹åŠ¨å°†since_dateå€¼è®¾ç½®ä¸ºä¸Šæ¬¡ç¨‹åºæ‰§è¡Œçš„æ—¥æœŸï¼Œå³2019-06-06\n```\n\nä¸Šé¢çš„æ–¹æ³•å¤ªéº»çƒ¦ï¼Œå› ä¸ºæ¯æ¬¡éƒ½è¦æ‰‹åŠ¨è®¾ç½®since_dateã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åŠ¨æ€è®¾ç½®since_dateï¼Œå³ç¨‹åºæ ¹æ®å®é™…æƒ…å†µï¼Œè‡ªåŠ¨ç”Ÿæˆsince_dateã€‚\næœ‰ä¸¤ç§æ–¹æ³•å®ç°åŠ¨æ€æ›´æ–°since_dateï¼š\n\n**æ–¹æ³•ä¸€ï¼šå°†since_dateè®¾ç½®æˆæ•´æ•°**\n\nå°†config.jsonæ–‡ä»¶ä¸­çš„since_dateè®¾ç½®æˆæ•´æ•°ï¼Œå¦‚ï¼š\n\n```\n\"since_date\": 10,\n```\n\nè¿™ä¸ªé…ç½®å‘Šè¯‰ç¨‹åºçˆ¬å–æœ€è¿‘10å¤©çš„å¾®åšï¼Œæ›´å‡†ç¡®è¯´æ˜¯çˆ¬å–å‘å¸ƒæ—¶é—´ä»10å¤©å‰åˆ°æœ¬ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ä¹‹é—´çš„å¾®åšã€‚è¿™æ ·since_dateå°±æ˜¯ä¸€ä¸ªåŠ¨æ€çš„å˜é‡ï¼Œæ¯æ¬¡ç¨‹åºæ‰§è¡Œæ—¶ï¼Œå®ƒçš„å€¼å°±æ˜¯å½“å‰æ—¥æœŸå‡10ã€‚é…åˆcrontabæ¯9å¤©æˆ–10å¤©æ‰§è¡Œä¸€æ¬¡ï¼Œå°±å®ç°äº†å®šæœŸè¿½åŠ çˆ¬å–ã€‚\n\n**æ–¹æ³•äºŒï¼šå°†ä¸Šæ¬¡æ‰§è¡Œç¨‹åºçš„æ—¶é—´å†™å…¥æ–‡ä»¶ï¼ˆæ¨èï¼‰**\n\nè¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·æŠŠè¦çˆ¬çš„ç”¨æˆ·idå†™å…¥txtæ–‡ä»¶ï¼Œç„¶åå†æŠŠæ–‡ä»¶è·¯å¾„èµ‹å€¼ç»™config.jsonä¸­çš„user_id_listå‚æ•°ã€‚\n\ntxtæ–‡ä»¶åæ ¼å¼å¯ä»¥å‚è€ƒ[ç¨‹åºè®¾ç½®](#3ç¨‹åºè®¾ç½®)ä¸­çš„è®¾ç½®user_id_listéƒ¨åˆ†ï¼Œè¿™æ ·è®¾ç½®å°±å…¨éƒ¨ç»“æŸäº†ã€‚\n\nè¯´ä¸‹è¿™ä¸ªæ–¹æ³•çš„åŸç†å’Œå¥½å¤„ï¼Œå‡å¦‚ä½ çš„txtæ–‡ä»¶å†…å®¹ä¸ºï¼š\n\n```\n1669879400\n1223178222 èƒ¡æ­Œ\n1729370543 éƒ­ç¢§å©· 2019-01-01\n```\n\nç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œå› ä¸ºç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œéƒ½æ²¡æœ‰å†™æ—¶é—´ï¼Œç¨‹åºä¼šæŒ‰ç…§config.jsonæ–‡ä»¶ä¸­since_dateçš„å€¼çˆ¬å–ï¼Œç¬¬ä¸‰è¡Œæœ‰æ—¶é—´â€œ2019-01-01â€ï¼Œç¨‹åºå°±ä¼šæŠŠè¿™ä¸ªæ—¶é—´å½“ä½œsince_dateã€‚æ¯ä¸ªç”¨æˆ·çˆ¬å–ç»“æŸç¨‹åºéƒ½ä¼šè‡ªåŠ¨æ›´æ–°txtæ–‡ä»¶ï¼Œæ¯ä¸€è¡Œç¬¬ä¸€éƒ¨åˆ†æ˜¯user_idï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ç”¨æˆ·æ˜µç§°ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯ç¨‹åºå‡†å¤‡çˆ¬å–è¯¥ç”¨æˆ·ç¬¬ä¸€æ¡å¾®åšï¼ˆæœ€æ–°å¾®åšï¼‰æ—¶çš„æ—¥æœŸã€‚çˆ¬å®Œä¸‰ä¸ªç”¨æˆ·åï¼Œtxtæ–‡ä»¶çš„å†…å®¹è‡ªåŠ¨æ›´æ–°ä¸ºï¼š\n\n```\n1669879400 Dear-è¿ªä¸½çƒ­å·´ 2020-01-18\n1223178222 èƒ¡æ­Œ 2020-01-18\n1729370543 éƒ­ç¢§å©· 2020-01-18\n```\n\nä¸‹æ¬¡å†çˆ¬å–å¾®åšçš„æ—¶å€™ï¼Œç¨‹åºä¼šæŠŠæ¯è¡Œçš„æ—¶é—´æ•°æ®ä½œä¸ºsince_dateã€‚è¿™æ ·çš„å¥½å¤„ä¸€æ˜¯ä¸ç”¨ä¿®æ”¹since_dateï¼Œç¨‹åºè‡ªåŠ¨æ›´æ–°ï¼›äºŒæ˜¯æ¯ä¸€ä¸ªç”¨æˆ·éƒ½å¯ä»¥å•ç‹¬æ‹¥æœ‰åªå±äºè‡ªå·±çš„since_dateï¼Œæ¯ä¸ªç”¨æˆ·çš„since_dateç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ï¼Œæ ¼å¼ä¸º`yyyy-mm-dd`æˆ–æ•´æ•°ã€‚æ¯”å¦‚ï¼Œç°åœ¨åˆæ·»åŠ äº†ä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œä»¥æ¨ç´«çš„å¾®åšä¸ºä¾‹ï¼Œä½ æƒ³è·å–å¥¹2018-01-23åˆ°ç°åœ¨çš„å…¨éƒ¨å¾®åšï¼Œå¯ä»¥è¿™æ ·ä¿®æ”¹txtæ–‡ä»¶ï¼š\n\n```\n1669879400 è¿ªä¸½çƒ­å·´ 2020-01-18\n1223178222 èƒ¡æ­Œ 2020-01-18\n1729370543 éƒ­ç¢§å©· 2020-01-18\n1227368500 æ¨ç´« 3 æ¢¦æƒ³,å¸Œæœ›\n```\n\næ³¨æ„æ¯ä¸€è¡Œçš„ç”¨æˆ·é…ç½®å‚æ•°ä»¥ç©ºæ ¼åˆ†éš”ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å…¨éƒ¨ç”±æ•°å­—ç»„æˆï¼Œç¨‹åºå°±è®¤ä¸ºæ­¤è¡Œä¸ºä¸€ä¸ªç”¨æˆ·çš„é…ç½®ï¼Œå¦åˆ™ç¨‹åºä¼šè®¤ä¸ºè¯¥è¡Œåªæ˜¯æ³¨é‡Šï¼Œè·³è¿‡è¯¥è¡Œï¼›ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¸ºä»»æ„æ ¼å¼ï¼Œå»ºè®®å†™ç”¨æˆ·æ˜µç§°ï¼›ç¬¬ä¸‰ä¸ªå¦‚æœæ˜¯æ—¥æœŸæ ¼å¼ï¼ˆyyyy-mm-ddï¼‰ï¼Œç¨‹åºå°±å°†è¯¥æ—¥æœŸè®¾ç½®ä¸ºç”¨æˆ·è‡ªå·±çš„since_dateï¼Œå¦åˆ™ä½¿ç”¨config.jsonä¸­çš„since_dateçˆ¬å–è¯¥ç”¨æˆ·çš„å¾®åšï¼Œç¬¬äºŒä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°ä¹Ÿå¯ä»¥ä¸å¡«ã€‚\nä¹Ÿå¯ä»¥è®¾ç½®ç¬¬å››ä¸ªå‚æ•°ï¼Œå°†è¢«è¯»å–ä¸ºquery_listã€‚\n\n**æ–¹æ³•ä¸‰ï¼šå°†`const.py`æ–‡ä»¶ä¸­çš„è¿è¡Œæ¨¡å¼æ”¹ä¸º`append`**\n\nä»¥è¿½åŠ æ¨¡å¼è¿è¡Œç¨‹åºï¼Œæ¯æ¬¡è¿è¡Œï¼Œæ¯ä¸ªidåªè·å–æœ€æ–°çš„å¾®åšï¼Œè€Œä¸æ˜¯å…¨éƒ¨ï¼Œé¿å…é¢‘ç¹å¤‡ä»½å¾®åšå¯¼è‡´è¿‡å¤šçš„è¯·æ±‚æ¬¡æ•°ã€‚\n\næ³¨æ„ï¼š\n\n* è¯¥æ¨¡å¼ä¼šè·³è¿‡ç½®é¡¶å¾®åšã€‚\n* è‹¥é‡‡é›†ä¿¡æ¯åç”¨æˆ·åˆç¼–è¾‘å¾®åšï¼Œåˆ™ä¸ä¼šè®°å½•ç¼–è¾‘å†…å®¹ã€‚\n\n### 8.ä½¿ç”¨docker\n\n**docker run**\n\n```shell\ndocker build -t weibo-crawler .\ndocker run -it -d \\\n  -v path/to/config.json:/app/config.json \\\n  -v path/to/user_id_list.txt:/app/user_id_list.txt \\ # å¯é€‰: ä½¿ç”¨æ–¹æ³•äºŒï¼ˆå°†ä¸Šæ¬¡æ‰§è¡Œç¨‹åºæ—¶é—´å†™å…¥æ–‡ä»¶ï¼‰å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšæ—¶ï¼Œä¿å­˜ä¿®æ”¹åˆ°host\n  -v path/to/weibo:/app/weibo \\\n  -e schedule_interval=1 \\ # å¯é€‰ï¼šå¾ªç¯é—´éš”ï¼ˆåˆ†é’Ÿï¼‰\n  weibo-crawler\n```\n\n**docker compose**\n\n```yaml\nversion: '3'\nservices:\n  weibo-crawler:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    volumes:\n      - path/to/config.json:/app/config.json\n      - path/to/user_id_list.txt:/app/user_id_list.txt # å¯é€‰: ä½¿ç”¨æ–¹æ³•äºŒï¼ˆå°†ä¸Šæ¬¡æ‰§è¡Œç¨‹åºæ—¶é—´å†™å…¥æ–‡ä»¶ï¼‰å®šæœŸè‡ªåŠ¨çˆ¬å–å¾®åšæ—¶ï¼Œä¿å­˜ä¿®æ”¹åˆ°host\n      - path/to/weibo:/app/weibo\n    environment:\n      - schedule_interval=1 # å¯é€‰ï¼šå¾ªç¯é—´éš”ï¼ˆåˆ†é’Ÿï¼‰\n```\n\n## å¦‚ä½•è·å–user_id\n\n1.æ‰“å¼€ç½‘å€<https://weibo.cn>ï¼Œæœç´¢æˆ‘ä»¬è¦æ‰¾çš„äººï¼Œå¦‚\"è¿ªä¸½çƒ­å·´\"ï¼Œè¿›å…¥å¥¹çš„ä¸»é¡µï¼›\n\n![](https://github.com/dataabc/media/blob/master/weiboSpider/images/user_home.png)\n2.æŒ‰ç…§ä¸Šå›¾ç®­å¤´æ‰€æŒ‡ï¼Œç‚¹å‡»\"èµ„æ–™\"é“¾æ¥ï¼Œè·³è½¬åˆ°ç”¨æˆ·èµ„æ–™é¡µé¢ï¼›\n\n![](https://github.com/dataabc/media/blob/master/weiboSpider/images/user_info.png)\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿ªä¸½çƒ­å·´å¾®åšèµ„æ–™é¡µçš„åœ°å€ä¸º\"<https://weibo.cn/1669879400/info>\"ï¼Œå…¶ä¸­çš„\"1669879400\"å³ä¸ºæ­¤å¾®åšçš„user_idã€‚\n\näº‹å®ä¸Šï¼Œæ­¤å¾®åšçš„user_idä¹ŸåŒ…å«åœ¨ç”¨æˆ·ä¸»é¡µ(<https://weibo.cn/u/1669879400?f=search_0>)ä¸­ï¼Œä¹‹æ‰€ä»¥æˆ‘ä»¬è¿˜è¦ç‚¹å‡»ä¸»é¡µä¸­çš„\"èµ„æ–™\"æ¥è·å–user_idï¼Œæ˜¯å› ä¸ºå¾ˆå¤šç”¨æˆ·çš„ä¸»é¡µä¸æ˜¯\"<https://weibo.cn/user_id?f=search_0>\"çš„å½¢å¼ï¼Œè€Œæ˜¯\"<https://weibo.cn/ä¸ªæ€§åŸŸå?f=search_0>\"æˆ–\"<https://weibo.cn/å¾®å·?f=search_0>\"çš„å½¢å¼ã€‚å…¶ä¸­\"å¾®å·\"å’Œuser_idéƒ½æ˜¯ä¸€ä¸²æ•°å­—ï¼Œå¦‚æœä»…ä»…é€šè¿‡ä¸»é¡µåœ°å€æå–user_idï¼Œå¾ˆå®¹æ˜“å°†\"å¾®å·\"è¯¯è®¤ä¸ºuser_idã€‚\n\n## æ·»åŠ cookieä¸ä¸æ·»åŠ cookieçš„åŒºåˆ«ï¼ˆå¯é€‰ï¼‰\n\nå¯¹äºå¾®åšæ•°2000æ¡åŠä»¥ä¸‹çš„å¾®åšç”¨æˆ·ï¼Œä¸æ·»åŠ cookieå¯ä»¥è·å–å…¶ç”¨æˆ·ä¿¡æ¯å’Œå¤§éƒ¨åˆ†å¾®åšï¼›å¯¹äºå¾®åšæ•°2000æ¡ä»¥ä¸Šçš„å¾®åšç”¨æˆ·ï¼Œä¸æ·»åŠ cookieå¯ä»¥è·å–å…¶ç”¨æˆ·ä¿¡æ¯å’Œæœ€è¿‘2000æ¡å¾®åšä¸­çš„å¤§éƒ¨åˆ†ï¼Œæ·»åŠ cookieå¯ä»¥è·å–å…¶å…¨éƒ¨å¾®åšã€‚ä»¥2020å¹´1æœˆ2æ—¥è¿ªä¸½çƒ­å·´çš„å¾®åšä¸ºä¾‹ï¼Œæ­¤æ—¶å¥¹å…±æœ‰1085æ¡å¾®åšï¼Œåœ¨ä¸æ·»åŠ cookieçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å–åˆ°1026æ¡å¾®åšï¼Œå¤§çº¦å å…¨éƒ¨å¾®åšçš„94.56%ï¼Œè€Œåœ¨æ·»åŠ cookieåï¼Œå¯ä»¥è·å–å…¨éƒ¨å¾®åšã€‚å…¶ä»–ç”¨æˆ·ç±»ä¼¼ï¼Œå¤§éƒ¨åˆ†éƒ½å¯ä»¥åœ¨ä¸æ·»åŠ cookieçš„æƒ…å†µä¸‹è·å–åˆ°90%ä»¥ä¸Šçš„å¾®åšï¼Œåœ¨æ·»åŠ cookieåå¯ä»¥è·å–å…¨éƒ¨å¾®åšã€‚å…·ä½“åŸå› æ˜¯ï¼Œå¤§éƒ¨åˆ†å¾®åšå†…å®¹éƒ½å¯ä»¥åœ¨[ç§»åŠ¨ç‰ˆ](https://m.weibo.cn/)åŒ¿åè·å–ï¼Œå°‘é‡å¾®åšéœ€è¦ç”¨æˆ·ç™»å½•æ‰å¯ä»¥è·å–ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å¾®åšåœ¨ä¸æ·»åŠ cookieæ—¶æ˜¯æ— æ³•è·å–çš„ã€‚\n\næœ‰å°‘éƒ¨åˆ†å¾®åšç”¨æˆ·ï¼Œä¸æ·»åŠ cookieå¯ä»¥è·å–å…¶å¾®åšï¼Œæ— æ³•è·å–å…¶ç”¨æˆ·ä¿¡æ¯ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œè¦æƒ³è·å–å…¶ç”¨æˆ·ä¿¡æ¯ï¼Œæ˜¯éœ€è¦cookieçš„ã€‚\n\nå¦‚éœ€æŠ“å–å¾®åšè½¬å‘ï¼Œè¯·æ·»åŠ cookieã€‚\n\n## å¦‚ä½•è·å–cookieï¼ˆå¯é€‰ï¼‰\n\n1.ç”¨Chromeæ‰“å¼€<https://passport.weibo.cn/signin/login>ï¼›\n\n2.è¾“å…¥å¾®åšçš„ç”¨æˆ·åã€å¯†ç ï¼Œç™»å½•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n![](https://github.com/dataabc/media/blob/master/weiboSpider/images/cookie1.png)\nç™»å½•æˆåŠŸåä¼šè·³è½¬åˆ°<https://m.weibo.cn>;\n\n3.æŒ‰F12é”®æ‰“å¼€Chromeå¼€å‘è€…å·¥å…·ï¼Œåœ¨åœ°å€æ è¾“å…¥å¹¶è·³è½¬åˆ°<https://weibo.cn>ï¼Œè·³è½¬åä¼šæ˜¾ç¤ºå¦‚ä¸‹ç±»ä¼¼ç•Œé¢:\n![](https://github.com/dataabc/media/blob/master/weiboSpider/images/cookie2.png)\n4.ä¾æ­¤ç‚¹å‡»Chromeå¼€å‘è€…å·¥å…·ä¸­çš„Network->Nameä¸­çš„weibo.cn->Headers->Request Headersï¼Œ\"Cookie:\"åçš„å€¼å³ä¸ºæˆ‘ä»¬è¦æ‰¾çš„cookieå€¼ï¼Œå¤åˆ¶å³å¯ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n![](https://github.com/dataabc/media/blob/master/weiboSpider/images/cookie3.png)\n\n## å¦‚ä½•æ£€æµ‹cookieæ˜¯å¦æœ‰æ•ˆï¼ˆå¯é€‰ï¼‰\n\næœ¬ç¨‹åºcookieæ£€æŸ¥çš„é€»è¾‘æ˜¯ï¼šä½¿ç”¨cookieæ¥æºè´¦å·å‘å¸ƒ**é™å®šèŒƒå›´çš„**å¾®åšï¼Œè‹¥cookieå¯ç”¨ï¼Œåˆ™å¯ä»¥è¯»å–åˆ°è¯¥å¾®åšï¼Œå¦åˆ™è¯»å–ä¸åˆ°ã€‚\n\n**æ“ä½œæ–¹æ³•**\n\n1. ä½¿ç”¨cookieçš„æ¥æºè´¦å·å‘å¸ƒä¸€æ¡å¾®åšï¼Œè¯¥è´¦å·å’Œå¾®åšéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\n\n   * è¯¥å¾®åšå¿…é¡»æ˜¯**éå…¬å¼€å¯è§**çš„ï¼Œåç»­éœ€è¦æ ¹æ®å¯è§æ€§åˆ¤æ–­cookieæ˜¯å¦æœ‰æ•ˆï¼›\n\n   * è¯¥å¾®åšéœ€è¦æ˜¯æœ€è¿‘5æ¡å¾®åšï¼Œä¸èƒ½åœ¨å‘å¸ƒæµ‹è¯•ç”¨å¾®åšå†…å®¹ååˆå‘å¾ˆå¤šæ–°å¾®åšï¼›\n\n   * åœ¨`config.json`é…ç½®ä¸­çš„since_dateä¹‹åï¼Œè¯¥è´¦å·å¿…é¡»æœ‰å¤§äº9æ¡å¾®åšã€‚\n\n2. å°†`const.py`æ–‡ä»¶ä¸­`'CHECK': False`ä¸­çš„`False`æ”¹ä¸º`True`ï¼Œ`'HIDDEN_WEIBO': 'å¾®åšå†…å®¹'`ä¸­çš„`å¾®åšå†…å®¹`æ”¹ä¸ºä½ å‘çš„é™å®šèŒƒå›´çš„å¾®åšã€‚\n\n3. å°†æä¾›cookieçš„å¾®åšidæ”¾ç½®åœ¨`config.json`æ–‡ä»¶ä¸­`\"user_id_list\"`è®¾ç½®é¡¹æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªã€‚ä¾‹å¦‚æä¾›cookieçš„å¾®åšidä¸º`123456`ï¼Œåˆ™`\"user_id_list\"`è®¾ç½®ä¸º`\"user_id_list\":[\"123456\", \"<å…¶ä½™id...>\"]`ã€‚\n\næ³¨ï¼šæœ¬æ–¹æ³•ä¹Ÿå°†ä¼šæŠ“å–æä¾›cookieè´¦å·çš„å¾®åšå†…å®¹ã€‚\n\nåœ¨é—´æ­‡è¿è¡Œç¨‹åºæ—¶ï¼Œcookieæ— æ•ˆä¼šå¯¼è‡´ç¨‹åºä¸èƒ½æŒ‰ç…§é¢„è®¾ç›®æ ‡æ‰§è¡Œï¼Œå› æ­¤å¯ä»¥æ‰“å¼€cookieé€šçŸ¥åŠŸèƒ½ã€‚æœ¬é¡¹ç›®ä½¿ç”¨å¼€æºé¡¹ç›®[pushdeer](https://github.com/easychen/pushdeer)è¿›è¡Œé€šçŸ¥ï¼Œåœ¨ä½¿ç”¨å‰ç”¨æˆ·éœ€è¦ç”³è¯·push_keyï¼Œå…·ä½“å¯æŸ¥çœ‹å®˜ç½‘äº†è§£ã€‚æ‰“å¼€æ–¹æ³•ä¸ºï¼š\n\n1. åœ¨`const.py`æ–‡ä»¶ä¸­ï¼Œå°†`'NOTIFY': False`ä¸­çš„`False`è®¾ä¸º`True`ï¼›\n2. å°†`'PUSH_KEY': ''`çš„`''`æ›¿æ¢ä¸º`'<ä½ çš„push_key>'`\n\n## APIæœåŠ¡\n\næ ¹ç›®å½•ä¸‹service.pyæä¾›äº†ä¸€ä¸ªç®€å•çš„restful apiç¤ºä¾‹ï¼Œè¿è¡Œ`python service.py`å¯åŠ¨æœåŠ¡åå¯ä»¥é€šè¿‡httpè¯·æ±‚å®šæ—¶æ›´æ–°ä»¥åŠæŸ¥è¯¢å¾®åš\n\næ–‡æ¡£å‚è€ƒ[APIè¯´æ˜](./API.md)\n"
        },
        {
          "name": "__main__.py",
          "type": "blob",
          "size": 1.14453125,
          "content": "import argparse\nfrom time import sleep\n\nimport schedule\n\nimport const\nimport weibo\nfrom util.notify import push_deer\n\n\ndef main(schedule_interval):\n    \"\"\"\n    ä¸»å‡½æ•°ï¼Œç”¨äºè®¾ç½®å®šæ—¶ä»»åŠ¡å’Œæ‰§è¡Œå¾®åšçˆ¬è™«è„šæœ¬ã€‚\n\n    Parameters:\n        schedule_interval (int): å¾ªç¯é—´éš”ï¼Œä»¥åˆ†é’Ÿä¸ºå•ä½ã€‚\n\n    Returns:\n        None\n    \"\"\"\n    schedule.every(schedule_interval).minutes.do(weibo.main)  # æ¯éš”æŒ‡å®šçš„æ—¶é—´é—´éš”æ‰§è¡Œä¸€æ¬¡mainå‡½æ•°\n    weibo.logger.info('å¾ªç¯é—´éš”è®¾ç½®ä¸º%dåˆ†é’Ÿ', schedule_interval)\n\n    weibo.main()  # ç«‹å³æ‰§è¡Œä¸€æ¬¡\n    while True:\n        try:\n            schedule.run_pending()\n            sleep(1)\n        except KeyboardInterrupt:\n            schedule.cancel_job(weibo.main)\n            break\n        except Exception as error:\n            if const.NOTIFY[\"NOTIFY\"]:\n                push_deer(f\"weibo-crawlerè¿è¡Œå‡ºé”™, é”™è¯¯ä¸º{error}\")\n                weibo.logger.exception(error)\n\nif __name__ == \"__main__\":\n    parser = argparse.ArgumentParser()\n    parser.add_argument('schedule_interval', type=int, help='å¾ªç¯é—´éš”ï¼ˆåˆ†é’Ÿï¼‰')\n    args = parser.parse_args()\n\n    main(args.schedule_interval)\n"
        },
        {
          "name": "config.json",
          "type": "blob",
          "size": 0.8369140625,
          "content": "{\n    \"user_id_list\": \"user_id_list.txt\",\n    \"only_crawl_original\": 0,\n    \"since_date\": 1,\n    \"start_page\": 1,\n    \"write_mode\": [\n        \"csv\"\n    ],\n    \"original_pic_download\": 1,\n    \"retweet_pic_download\": 0,\n    \"original_video_download\": 1,\n    \"retweet_video_download\": 0,\n    \"download_comment\": 1,\n    \"comment_max_download_count\": 100,\n    \"download_repost\": 1,\n    \"repost_max_download_count\": 100,\n    \"user_id_as_folder_name\": 0,\n    \"remove_html_tag\": 1,\n    \"cookie\": \"your cookie\",\n    \"mysql_config\": {\n        \"host\": \"localhost\",\n        \"port\": 3306,\n        \"user\": \"root\",\n        \"password\": \"123456\",\n        \"charset\": \"utf8mb4\"\n    },\n    \"mongodb_URI\": \"mongodb://[username:password@]host[:port][/[defaultauthdb][?options]]\",\n    \"post_config\": {\n        \"api_url\": \"https://api.example.com\",\n        \"api_token\": \"\"\n    }\n}\n"
        },
        {
          "name": "const.py",
          "type": "blob",
          "size": 1.4833984375,
          "content": "import const\n\n\"\"\"\nè¿è¡Œæ¨¡å¼\nå¯ä»¥æ˜¯è¿½åŠ æ¨¡å¼appendæˆ–è¦†ç›–æ¨¡å¼overwrite\nappendæ¨¡å¼ï¼šä»…å¯åœ¨sqliteå¯ç”¨æ—¶ä½¿ç”¨ã€‚æ¯æ¬¡è¿è¡Œæ¯ä¸ªidåªè·å–æœ€æ–°çš„å¾®åšï¼Œå¯¹äºä»¥å¾€çš„å³ä½¿æ˜¯ç¼–è¾‘è¿‡çš„å¾®åšï¼Œä¹Ÿä¸å†è·å–ã€‚\noverwriteæ¨¡å¼ï¼šæ¯æ¬¡è¿è¡Œéƒ½ä¼šè·å–å…¨é‡å¾®åšã€‚\næ³¨æ„ï¼šoverwriteæ¨¡å¼ä¸‹æš‚ä¸èƒ½è®°å½•ä¸Šæ¬¡è·å–å¾®åšçš„idï¼Œå› æ­¤ä»overwriteæ¨¡å¼è½¬ä¸ºappendæ¨¡å¼æ—¶ï¼Œä»éœ€è·å–æ‰€æœ‰æ•°æ®\n\"\"\"\nconst.MODE = \"overwrite\"\n\n\"\"\"\næ£€æŸ¥cookieæ˜¯å¦æœ‰æ•ˆ\né»˜è®¤ä¸éœ€è¦æ£€æŸ¥cookie\nå¦‚æœæ£€æŸ¥cookieï¼Œéœ€è¦å‚è€ƒä»¥ä¸‹é“¾æ¥è®¾ç½®\nconfigä¸­science_dateä¸€å®šè¦ç¡®ä¿æµ‹è¯•å·è·å¾—çš„å¾®åšæ•°åœ¨ä¸å«æµ‹è¯•å¾®åšçš„æƒ…å†µä¸‹å¤§äº9\nhttps://github.com/dataabc/weibo-crawler#%E5%A6%82%E4%BD%95%E6%A3%80%E6%B5%8Bcookie%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88%E5%8F%AF%E9%80%89\n\"\"\"\nconst.CHECK_COOKIE = {\n    \"CHECK\": False,  # æ˜¯å¦æ£€æŸ¥cookie\n    \"CHECKED\": False,  # è¿™é‡Œä¸è¦åŠ¨ï¼Œåˆ¤æ–­å·²æ£€æŸ¥äº†cookieçš„æ ‡å¿—ä½\n    \"EXIT_AFTER_CHECK\": False,  # è¿™é‡Œä¸è¦åŠ¨ï¼Œappendæ¨¡å¼ä¸­å·²å®Œæˆå¢é‡å¾®åšæŠ“å–ï¼Œä»…ç­‰å¾…cookieæ£€æŸ¥çš„æ ‡å¿—ä½\n    \"HIDDEN_WEIBO\": \"å¾®åšå†…å®¹\",  # ä½ å¯èƒ½å‘ç°å¹³å°ä¼šè‡ªåŠ¨ç»™ä½ çš„å¾®åšè‡ªåŠ¨åŠ ä¸ªç©ºæ ¼ï¼Œä½†è¿™é‡Œä½ ä¸ç”¨åŠ ç©ºæ ¼\n    \"GUESS_PIN\": False,  # è¿™é‡Œä¸è¦åŠ¨ï¼Œå› ä¸ºå¾®åšå–æ¶ˆäº†â€œç½®é¡¶â€å­—æ ·çš„æ˜¾ç¤ºï¼Œå› æ­¤é»˜è®¤çŒœæµ‹æ‰€æœ‰äººç¬¬ä¸€æ¡éƒ½æ˜¯ç½®é¡¶\n}\nconst.NOTIFY = {\n    \"NOTIFY\": False,  # æ˜¯å¦é€šçŸ¥\n    \"PUSH_KEY\": \"\",  # è¿™é‡Œä½¿ç”¨push_deeråšé€šçŸ¥ï¼Œå¡«å…¥pushdeerçš„pushkey\n}\n"
        },
        {
          "name": "logging.conf",
          "type": "blob",
          "size": 0.9091796875,
          "content": "[loggers]\nkeys=root,weibo\n\n[handlers]\nkeys=consoleHandler,fileHandler,errorHandler\n\n[formatters]\nkeys=consoleFormatter,fileFormatter,errorFormatter\n\n[logger_root]\nlevel=DEBUG\nhandlers=consoleHandler,fileHandler,errorHandler\n\n[logger_weibo]\nlevel=DEBUG\nhandlers=consoleHandler,fileHandler,errorHandler\nqualname=weibo\npropagate=0\n\n[handler_consoleHandler]\nclass=StreamHandler\nlevel=DEBUG\nformatter=consoleFormatter\nargs=(sys.stdout,)\n\n[handler_fileHandler]\nclass=handlers.TimedRotatingFileHandler\nlevel=INFO\nformatter=fileFormatter\nargs=('log/all.log', 'D', 1, 5, 'utf-8', False, False)\n\n[handler_errorHandler]\nclass=FileHandler\nlevel=WARNING\nformatter=errorFormatter\nargs=('log/error.log', 'a','utf-8')\n\n[formatter_consoleFormatter]\nformat=%(message)s\n\n[formatter_fileFormatter]\nformat=%(asctime)s - %(levelname)s - %(message)s\n\n[formatter_errorFormatter]\nformat=%(asctime)s - %(levelname)s - %(filename)s[:%(lineno)d] - %(message)s"
        },
        {
          "name": "requirements.txt",
          "type": "blob",
          "size": 0.0859375,
          "content": "lxml==5.3.0\npymongo==4.6.3\nPyMySQL==1.1.1\nRequests==2.32.0\nschedule==1.2.1\ntqdm==4.66.3\n"
        },
        {
          "name": "service.py",
          "type": "blob",
          "size": 7.833984375,
          "content": "from weibo import Weibo, handle_config_renaming\nimport const\nimport logging\nimport logging.config\nimport os\nfrom flask import Flask, jsonify, request\nimport sqlite3\nimport json\nfrom concurrent.futures import ThreadPoolExecutor\nimport threading\nimport uuid\nimport time\nfrom datetime import datetime\n\n# 1896820725 å¤©æ´¥è‚¡ä¾  2024-12-09T16:47:04\n\nDATABASE_PATH = './weibo/weibodata.db'\nprint(DATABASE_PATH)\n\n# å¦‚æœæ—¥å¿—æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º\nif not os.path.isdir(\"log/\"):\n    os.makedirs(\"log/\")\nlogging_path = os.path.split(os.path.realpath(__file__))[0] + os.sep + \"logging.conf\"\nlogging.config.fileConfig(logging_path)\nlogger = logging.getLogger(\"api\")\n\nconfig = {\n    \"user_id_list\": [\n        \"6067225218\", \n        \"1445403190\"\n        ],\n    \"only_crawl_original\": 1,\n    \"since_date\": 1,\n    \"start_page\": 1,\n    \"write_mode\": [\n        \"csv\",\n        \"json\",\n        \"sqlite\"\n    ],\n    \"original_pic_download\": 0,\n    \"retweet_pic_download\": 0,\n    \"original_video_download\": 0,\n    \"retweet_video_download\": 0,\n    \"download_comment\": 0,\n    \"comment_max_download_count\": 100,\n    \"download_repost\": 0,\n    \"repost_max_download_count\": 100,\n    \"user_id_as_folder_name\": 0,\n    \"remove_html_tag\": 1,\n    \"cookie\": \"your weibo cookie\",\n    \"mysql_config\": {\n        \"host\": \"localhost\",\n        \"port\": 3306,\n        \"user\": \"root\",\n        \"password\": \"123456\",\n        \"charset\": \"utf8mb4\"\n    },\n    \"mongodb_URI\": \"mongodb://[username:password@]host[:port][/[defaultauthdb][?options]]\",\n    \"post_config\": {\n        \"api_url\": \"https://api.example.com\",\n        \"api_token\": \"\"\n    }\n}\n\napp = Flask(__name__)\napp.config['JSON_AS_ASCII'] = False  # ç¡®ä¿JSONå“åº”ä¸­çš„ä¸­æ–‡ä¸ä¼šè¢«è½¬ä¹‰\napp.config['JSONIFY_MIMETYPE'] = 'application/json;charset=utf-8'\n\n# æ·»åŠ çº¿ç¨‹æ± å’Œä»»åŠ¡çŠ¶æ€è·Ÿè¸ª\nexecutor = ThreadPoolExecutor(max_workers=1)  # é™åˆ¶åªæœ‰1ä¸ªworkeré¿å…å¹¶å‘çˆ¬å–\ntasks = {}  # å­˜å‚¨ä»»åŠ¡çŠ¶æ€\n\n# åœ¨executorå®šä¹‰åæ·»åŠ ä»»åŠ¡é”ç›¸å…³å˜é‡\ncurrent_task_id = None\ntask_lock = threading.Lock()\n\ndef get_running_task():\n    \"\"\"è·å–å½“å‰è¿è¡Œçš„ä»»åŠ¡ä¿¡æ¯\"\"\"\n    if current_task_id and current_task_id in tasks:\n        task = tasks[current_task_id]\n        if task['state'] in ['PENDING', 'PROGRESS']:\n            return current_task_id, task\n    return None, None\n\ndef get_config(user_id_list=None):\n    \"\"\"è·å–é…ç½®ï¼Œå…è®¸åŠ¨æ€è®¾ç½®user_id_list\"\"\"\n    current_config = config.copy()\n    if user_id_list:\n        current_config['user_id_list'] = user_id_list\n    handle_config_renaming(current_config, oldName=\"filter\", newName=\"only_crawl_original\")\n    handle_config_renaming(current_config, oldName=\"result_dir_name\", newName=\"user_id_as_folder_name\")\n    return current_config\n\ndef run_refresh_task(task_id, user_id_list=None):\n    global current_task_id\n    try:\n        tasks[task_id]['state'] = 'PROGRESS'\n        tasks[task_id]['progress'] = 0\n        \n        config = get_config(user_id_list)\n        wb = Weibo(config)\n        tasks[task_id]['progress'] = 50\n        \n        wb.start()  # çˆ¬å–å¾®åšä¿¡æ¯\n        tasks[task_id]['progress'] = 100\n        tasks[task_id]['state'] = 'SUCCESS'\n        tasks[task_id]['result'] = {\"message\": \"å¾®åšåˆ—è¡¨å·²åˆ·æ–°\"}\n        \n    except Exception as e:\n        tasks[task_id]['state'] = 'FAILED'\n        tasks[task_id]['error'] = str(e)\n        logger.exception(e)\n    finally:\n        with task_lock:\n            if current_task_id == task_id:\n                current_task_id = None\n\n@app.route('/refresh', methods=['POST'])\ndef refresh():\n    global current_task_id\n    \n    # è·å–è¯·æ±‚å‚æ•°\n    data = request.get_json()\n    user_id_list = data.get('user_id_list') if data else None\n    \n    # éªŒè¯å‚æ•°\n    if not user_id_list or not isinstance(user_id_list, list):\n        return jsonify({\n            'error': 'Invalid user_id_list parameter'\n        }), 400\n    \n    # æ£€æŸ¥æ˜¯å¦æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡\n    with task_lock:\n        running_task_id, running_task = get_running_task()\n        if running_task:\n            return jsonify({\n                'task_id': running_task_id,\n                'status': 'Task already running',\n                'state': running_task['state'],\n                'progress': running_task['progress']\n            }), 409  # 409 Conflict\n        \n        # åˆ›å»ºæ–°ä»»åŠ¡\n        task_id = str(uuid.uuid4())\n        tasks[task_id] = {\n            'state': 'PENDING',\n            'progress': 0,\n            'created_at': datetime.now().isoformat(),\n            'user_id_list': user_id_list\n        }\n        current_task_id = task_id\n        \n    executor.submit(run_refresh_task, task_id, user_id_list)\n    return jsonify({\n        'task_id': task_id,\n        'status': 'Task started',\n        'state': 'PENDING',\n        'progress': 0,\n        'user_id_list': user_id_list\n    }), 202\n\n@app.route('/task/<task_id>', methods=['GET'])\ndef get_task_status(task_id):\n    task = tasks.get(task_id)\n    if not task:\n        return jsonify({'error': 'Task not found'}), 404\n        \n    response = {\n        'state': task['state'],\n        'progress': task['progress']\n    }\n    \n    if task['state'] == 'SUCCESS':\n        response['result'] = task.get('result')\n    elif task['state'] == 'FAILED':\n        response['error'] = task.get('error')\n        \n    return jsonify(response)\n\n@app.route('/weibos', methods=['GET'])\ndef get_weibos():\n    try:\n        conn = sqlite3.connect(DATABASE_PATH)\n        cursor = conn.cursor()\n        # æŒ‰created_atå€’åºæŸ¥è¯¢æ‰€æœ‰å¾®åš\n        cursor.execute(\"SELECT * FROM weibo ORDER BY created_at DESC\")\n        columns = [column[0] for column in cursor.description]\n        weibos = []\n        for row in cursor.fetchall():\n            weibo = dict(zip(columns, row))\n            weibos.append(weibo)\n        conn.close()\n        res1 = json.dumps(weibos, ensure_ascii=False)\n        print(res1)\n        res = jsonify(weibos)\n        print(res)\n        return res, 200\n    except Exception as e:\n        logger.exception(e)\n        return {\"error\": str(e)}, 500\n\n@app.route('/weibos/<weibo_id>', methods=['GET'])\ndef get_weibo_detail(weibo_id):\n    try:\n        conn = sqlite3.connect(DATABASE_PATH)\n        cursor = conn.cursor()\n        cursor.execute(\"SELECT * FROM weibo WHERE id=?\", (weibo_id,))\n        columns = [column[0] for column in cursor.description]\n        row = cursor.fetchone()\n        conn.close()\n        \n        if row:\n            weibo = dict(zip(columns, row))\n            return jsonify(weibo), 200\n        else:\n            return {\"error\": \"Weibo not found\"}, 404\n    except Exception as e:\n        logger.exception(e)\n        return {\"error\": str(e)}, 500\n\ndef schedule_refresh():\n    \"\"\"å®šæ—¶åˆ·æ–°ä»»åŠ¡\"\"\"\n    while True:\n        try:\n            # æ£€æŸ¥æ˜¯å¦æœ‰è¿è¡Œä¸­çš„ä»»åŠ¡\n            running_task_id, running_task = get_running_task()\n            if not running_task:\n                task_id = str(uuid.uuid4())\n                tasks[task_id] = {\n                    'state': 'PENDING',\n                    'progress': 0,\n                    'created_at': datetime.now().isoformat(),\n                    'user_id_list': config['user_id_list']  # ä½¿ç”¨é»˜è®¤é…ç½®\n                }\n                with task_lock:\n                    global current_task_id\n                    current_task_id = task_id\n                executor.submit(run_refresh_task, task_id, config['user_id_list'])\n                logger.info(f\"Scheduled task {task_id} started\")\n            \n            time.sleep(600)  # 10åˆ†é’Ÿé—´éš”\n        except Exception as e:\n            logger.exception(\"Schedule task error\")\n            time.sleep(60)  # å‘ç”Ÿé”™è¯¯æ—¶ç­‰å¾…1åˆ†é’Ÿåé‡è¯•\n\nif __name__ == \"__main__\":\n    # å¯åŠ¨å®šæ—¶ä»»åŠ¡çº¿ç¨‹\n    scheduler_thread = threading.Thread(target=schedule_refresh, daemon=True)\n    scheduler_thread.start()\n    \n    logger.info(\"æœåŠ¡å¯åŠ¨\")\n    # å¯åŠ¨Flaskåº”ç”¨\n    app.run(debug=True, use_reloader=False)  # å…³é—­reloaderé¿å…å¯åŠ¨ä¸¤æ¬¡"
        },
        {
          "name": "util",
          "type": "tree",
          "content": null
        },
        {
          "name": "weibo.py",
          "type": "blob",
          "size": 93.2431640625,
          "content": "#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\nimport codecs\nimport copy\nimport csv\nimport json\nimport logging\nimport logging.config\nimport math\nimport os\nimport random\nimport re\nimport sqlite3\nimport sys\nimport warnings\nimport webbrowser\nfrom collections import OrderedDict\nfrom datetime import date, datetime, timedelta\nfrom pathlib import Path\nfrom time import sleep\n\nimport requests\nfrom requests.exceptions import RequestException\nfrom lxml import etree\nfrom requests.adapters import HTTPAdapter\nfrom tqdm import tqdm\n\nimport const\nfrom util import csvutil\nfrom util.dateutil import convert_to_days_ago\nfrom util.notify import push_deer\n\nwarnings.filterwarnings(\"ignore\")\n\n# å¦‚æœæ—¥å¿—æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º\nif not os.path.isdir(\"log/\"):\n    os.makedirs(\"log/\")\nlogging_path = os.path.split(os.path.realpath(__file__))[0] + os.sep + \"logging.conf\"\nlogging.config.fileConfig(logging_path)\nlogger = logging.getLogger(\"weibo\")\n\n# æ—¥æœŸæ—¶é—´æ ¼å¼\nDTFORMAT = \"%Y-%m-%dT%H:%M:%S\"\n\nclass Weibo(object):\n    def __init__(self, config):\n        \"\"\"Weiboç±»åˆå§‹åŒ–\"\"\"\n        self.validate_config(config)\n        self.only_crawl_original = config[\"only_crawl_original\"]  # å–å€¼èŒƒå›´ä¸º0ã€1,ç¨‹åºé»˜è®¤å€¼ä¸º0,ä»£è¡¨è¦çˆ¬å–ç”¨æˆ·çš„å…¨éƒ¨å¾®åš,1ä»£è¡¨åªçˆ¬å–ç”¨æˆ·çš„åŸåˆ›å¾®åš\n        self.remove_html_tag = config[\n            \"remove_html_tag\"\n        ]  # å–å€¼èŒƒå›´ä¸º0ã€1, 0ä»£è¡¨ä¸ç§»é™¤å¾®åšä¸­çš„html tag, 1ä»£è¡¨ç§»é™¤\n        since_date = config[\"since_date\"]\n        # since_date è‹¥ä¸ºæ•´æ•°ï¼Œåˆ™å–è¯¥å¤©æ•°ä¹‹å‰çš„æ—¥æœŸï¼›è‹¥ä¸º yyyy-mm-ddï¼Œåˆ™å¢åŠ æ—¶é—´\n        if isinstance(since_date, int):\n            since_date = date.today() - timedelta(since_date)\n            since_date = since_date.strftime(DTFORMAT)\n        elif self.is_date(since_date):\n            since_date = \"{}T00:00:00\".format(since_date)\n        elif self.is_datetime(since_date):\n            pass\n        else:\n            logger.error(\"since_date æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ç¡®è®¤é…ç½®æ˜¯å¦æ­£ç¡®\")\n            sys.exit()\n        self.since_date = since_date  # èµ·å§‹æ—¶é—´ï¼Œå³çˆ¬å–å‘å¸ƒæ—¥æœŸä»è¯¥å€¼åˆ°ç°åœ¨çš„å¾®åšï¼Œå½¢å¼ä¸ºyyyy-mm-ddThh:mm:ssï¼Œå¦‚ï¼š2023-08-21T09:23:03\n        self.start_page = config.get(\"start_page\", 1)  # å¼€å§‹çˆ¬çš„é¡µï¼Œå¦‚æœä¸­é€”è¢«é™åˆ¶è€Œç»“æŸå¯ä»¥ç”¨æ­¤å®šä¹‰å¼€å§‹é¡µç \n        self.write_mode = config[\n            \"write_mode\"\n        ]  # ç»“æœä¿¡æ¯ä¿å­˜ç±»å‹ï¼Œä¸ºlistå½¢å¼ï¼Œå¯åŒ…å«csvã€mongoå’Œmysqlä¸‰ç§ç±»å‹\n        self.original_pic_download = config[\n            \"original_pic_download\"\n        ]  # å–å€¼èŒƒå›´ä¸º0ã€1, 0ä»£è¡¨ä¸ä¸‹è½½åŸåˆ›å¾®åšå›¾ç‰‡,1ä»£è¡¨ä¸‹è½½\n        self.retweet_pic_download = config[\n            \"retweet_pic_download\"\n        ]  # å–å€¼èŒƒå›´ä¸º0ã€1, 0ä»£è¡¨ä¸ä¸‹è½½è½¬å‘å¾®åšå›¾ç‰‡,1ä»£è¡¨ä¸‹è½½\n        self.original_video_download = config[\n            \"original_video_download\"\n        ]  # å–å€¼èŒƒå›´ä¸º0ã€1, 0ä»£è¡¨ä¸ä¸‹è½½åŸåˆ›å¾®åšè§†é¢‘,1ä»£è¡¨ä¸‹è½½\n        self.retweet_video_download = config[\n            \"retweet_video_download\"\n        ]  # å–å€¼èŒƒå›´ä¸º0ã€1, 0ä»£è¡¨ä¸ä¸‹è½½è½¬å‘å¾®åšè§†é¢‘,1ä»£è¡¨ä¸‹è½½\n        self.download_comment = config[\"download_comment\"]  # 1ä»£è¡¨ä¸‹è½½è¯„è®º,0ä»£è¡¨ä¸ä¸‹è½½\n        self.comment_max_download_count = config[\n            \"comment_max_download_count\"\n        ]  # å¦‚æœè®¾ç½®äº†ä¸‹è¯„è®ºï¼Œæ¯æ¡å¾®åšè¯„è®ºæ•°ä¼šé™åˆ¶åœ¨è¿™ä¸ªå€¼å†…\n        self.download_repost = config[\"download_repost\"]  # 1ä»£è¡¨ä¸‹è½½è½¬å‘,0ä»£è¡¨ä¸ä¸‹è½½\n        self.repost_max_download_count = config[\n            \"repost_max_download_count\"\n        ]  # å¦‚æœè®¾ç½®äº†ä¸‹è½¬å‘ï¼Œæ¯æ¡å¾®åšè½¬å‘æ•°ä¼šé™åˆ¶åœ¨è¿™ä¸ªå€¼å†…\n        self.user_id_as_folder_name = config.get(\n            \"user_id_as_folder_name\", 0\n        )  # ç»“æœç›®å½•åï¼Œå–å€¼ä¸º0æˆ–1ï¼Œå†³å®šç»“æœæ–‡ä»¶å­˜å‚¨åœ¨ç”¨æˆ·æ˜µç§°æ–‡ä»¶å¤¹é‡Œè¿˜æ˜¯ç”¨æˆ·idæ–‡ä»¶å¤¹é‡Œ\n        cookie = config.get(\"cookie\")  # å¾®åšcookieï¼Œå¯å¡«å¯ä¸å¡«\n        user_agent = \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\"\n        self.headers = {\"User_Agent\": user_agent, \"Cookie\": cookie}\n        self.mysql_config = config.get(\"mysql_config\")  # MySQLæ•°æ®åº“è¿æ¥é…ç½®ï¼Œå¯ä»¥ä¸å¡«\n        self.mongodb_URI = config.get(\"mongodb_URI\")  # MongoDBæ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä¸å¡«\n        self.post_config = config.get(\"post_config\")  # post_configï¼Œå¯ä»¥ä¸å¡«\n        user_id_list = config[\"user_id_list\"]\n        # é¿å…å¡ä½\n        if isinstance(user_id_list, list):\n            random.shuffle(user_id_list)\n\n        query_list = config.get(\"query_list\") or []\n        if isinstance(query_list, str):\n            query_list = query_list.split(\",\")\n        self.query_list = query_list\n        if not isinstance(user_id_list, list):\n            if not os.path.isabs(user_id_list):\n                user_id_list = (\n                    os.path.split(os.path.realpath(__file__))[0] + os.sep + user_id_list\n                )\n            self.user_config_file_path = user_id_list  # ç”¨æˆ·é…ç½®æ–‡ä»¶è·¯å¾„\n            user_config_list = self.get_user_config_list(user_id_list)\n        else:\n            self.user_config_file_path = \"\"\n            user_config_list = [\n                {\n                    \"user_id\": user_id,\n                    \"since_date\": self.since_date,\n                    \"query_list\": query_list,\n                }\n                for user_id in user_id_list\n            ]\n\n        self.user_config_list = user_config_list  # è¦çˆ¬å–çš„å¾®åšç”¨æˆ·çš„user_configåˆ—è¡¨\n        self.user_config = {}  # ç”¨æˆ·é…ç½®,åŒ…å«ç”¨æˆ·idå’Œsince_date\n        self.start_date = \"\"  # è·å–ç”¨æˆ·ç¬¬ä¸€æ¡å¾®åšæ—¶çš„æ—¥æœŸ\n        self.query = \"\"\n        self.user = {}  # å­˜å‚¨ç›®æ ‡å¾®åšç”¨æˆ·ä¿¡æ¯\n        self.got_count = 0  # å­˜å‚¨çˆ¬å–åˆ°çš„å¾®åšæ•°\n        self.weibo = []  # å­˜å‚¨çˆ¬å–åˆ°çš„æ‰€æœ‰å¾®åšä¿¡æ¯\n        self.weibo_id_list = []  # å­˜å‚¨çˆ¬å–åˆ°çš„æ‰€æœ‰å¾®åšid\n        self.long_sleep_count_before_each_user = 0 #æ¯ä¸ªç”¨æˆ·å‰çš„é•¿æ—¶é—´sleepé¿å…è¢«ban\n\n    def validate_config(self, config):\n        \"\"\"éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®\"\"\"\n\n        # éªŒè¯å¦‚ä¸‹1/0ç›¸å…³å€¼\n        argument_list = [\n            \"only_crawl_original\",\n            \"original_pic_download\",\n            \"retweet_pic_download\",\n            \"original_video_download\",\n            \"retweet_video_download\",\n            \"download_comment\",\n            \"download_repost\",\n        ]\n        for argument in argument_list:\n            if config[argument] != 0 and config[argument] != 1:\n                logger.warning(\"%så€¼åº”ä¸º0æˆ–1,è¯·é‡æ–°è¾“å…¥\", config[argument])\n                sys.exit()\n\n        # éªŒè¯query_list\n        query_list = config.get(\"query_list\") or []\n        if (not isinstance(query_list, list)) and (not isinstance(query_list, str)):\n            logger.warning(\"query_listå€¼åº”ä¸ºlistç±»å‹æˆ–å­—ç¬¦ä¸²,è¯·é‡æ–°è¾“å…¥\")\n            sys.exit()\n\n        # éªŒè¯write_mode\n        write_mode = [\"csv\", \"json\", \"mongo\", \"mysql\", \"sqlite\", \"post\"]\n        if not isinstance(config[\"write_mode\"], list):\n            sys.exit(\"write_modeå€¼åº”ä¸ºlistç±»å‹\")\n        for mode in config[\"write_mode\"]:\n            if mode not in write_mode:\n                logger.warning(\n                    \"%sä¸ºæ— æ•ˆæ¨¡å¼ï¼Œè¯·ä»csvã€jsonã€mongoå’Œmysqlä¸­æŒ‘é€‰ä¸€ä¸ªæˆ–å¤šä¸ªä½œä¸ºwrite_mode\", mode\n                )\n                sys.exit()\n        # éªŒè¯è¿è¡Œæ¨¡å¼\n        if \"sqlite\" not in config[\"write_mode\"] and const.MODE == \"append\":\n            logger.warning(\"appendæ¨¡å¼ä¸‹è¯·å°†sqliteåŠ å…¥write_modeä¸­\")\n            sys.exit()\n\n        # éªŒè¯user_id_list\n        user_id_list = config[\"user_id_list\"]\n        if (not isinstance(user_id_list, list)) and (not user_id_list.endswith(\".txt\")):\n            logger.warning(\"user_id_listå€¼åº”ä¸ºlistç±»å‹æˆ–txtæ–‡ä»¶è·¯å¾„\")\n            sys.exit()\n        if not isinstance(user_id_list, list):\n            if not os.path.isabs(user_id_list):\n                user_id_list = (\n                    os.path.split(os.path.realpath(__file__))[0] + os.sep + user_id_list\n                )\n            if not os.path.isfile(user_id_list):\n                logger.warning(\"ä¸å­˜åœ¨%sæ–‡ä»¶\", user_id_list)\n                sys.exit()\n\n        # éªŒè¯since_date\n        since_date = config[\"since_date\"]\n        if (not isinstance(since_date, int)) and (not self.is_datetime(since_date)) and (not self.is_date(since_date)):\n            logger.warning(\"since_dateå€¼åº”ä¸ºyyyy-mm-ddå½¢å¼ã€yyyy-mm-ddTHH:MM:SSå½¢å¼æˆ–æ•´æ•°ï¼Œè¯·é‡æ–°è¾“å…¥\")\n            sys.exit()\n\n        comment_max_count = config[\"comment_max_download_count\"]\n        if not isinstance(comment_max_count, int):\n            logger.warning(\"æœ€å¤§ä¸‹è½½è¯„è®ºæ•° (comment_max_download_count) åº”ä¸ºæ•´æ•°ç±»å‹\")\n            sys.exit()\n        elif comment_max_count < 0:\n            logger.warning(\"æœ€å¤§ä¸‹è½½è¯„è®ºæ•° (comment_max_download_count) åº”è¯¥ä¸ºæ­£æ•´æ•°\")\n            sys.exit()\n\n        repost_max_count = config[\"repost_max_download_count\"]\n        if not isinstance(repost_max_count, int):\n            logger.warning(\"æœ€å¤§ä¸‹è½½è½¬å‘æ•° (repost_max_download_count) åº”ä¸ºæ•´æ•°ç±»å‹\")\n            sys.exit()\n        elif repost_max_count < 0:\n            logger.warning(\"æœ€å¤§ä¸‹è½½è½¬å‘æ•° (repost_max_download_count) åº”è¯¥ä¸ºæ­£æ•´æ•°\")\n            sys.exit()\n\n    def is_datetime(self, since_date):\n        \"\"\"åˆ¤æ–­æ—¥æœŸæ ¼å¼æ˜¯å¦ä¸º %Y-%m-%dT%H:%M:%S\"\"\"\n        try:\n            datetime.strptime(since_date, DTFORMAT)\n            return True\n        except ValueError:\n            return False\n    \n    def is_date(self, since_date):\n        \"\"\"åˆ¤æ–­æ—¥æœŸæ ¼å¼æ˜¯å¦ä¸º %Y-%m-%d\"\"\"\n        try:\n            datetime.strptime(since_date, \"%Y-%m-%d\")\n            return True\n        except ValueError:\n            return False\n\n    def get_json(self, params):\n        \"\"\"è·å–ç½‘é¡µä¸­çš„ JSON æ•°æ®\"\"\"\n        url = \"https://m.weibo.cn/api/container/getIndex?\"\n        try:\n            r = requests.get(url, params=params, headers=self.headers, verify=False, timeout=10)\n            r.raise_for_status()  # å¦‚æœå“åº”çŠ¶æ€ç ä¸æ˜¯ 200ï¼Œä¼šæŠ›å‡º HTTPError\n            response_json = r.json()\n            return response_json, r.status_code\n        except RequestException as e:\n            logger.error(f\"è¯·æ±‚å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{e}\")\n            return {}, 500\n        except ValueError as ve:\n            logger.error(f\"JSON è§£ç å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{ve}\")\n            return {}, 500\n\n    def handle_captcha(self, js):\n        \"\"\"\n        å¤„ç†éªŒè¯ç æŒ‘æˆ˜ï¼Œæç¤ºç”¨æˆ·æ‰‹åŠ¨å®ŒæˆéªŒè¯ã€‚\n\n        å‚æ•°:\n            js (dict): API è¿”å›çš„ JSON æ•°æ®ã€‚\n\n        è¿”å›:\n            bool: å¦‚æœç”¨æˆ·æˆåŠŸå®ŒæˆéªŒè¯ç ï¼Œè¿”å› Trueï¼›å¦åˆ™è¿”å› Falseã€‚\n        \"\"\"\n        logger.debug(f\"æ”¶åˆ°çš„ JSON æ•°æ®ï¼š{js}\")\n        \n        captcha_url = js.get(\"url\")\n        if captcha_url:\n            logger.warning(\"æ£€æµ‹åˆ°éªŒè¯ç æŒ‘æˆ˜ã€‚æ­£åœ¨æ‰“å¼€éªŒè¯ç é¡µé¢ä»¥ä¾›æ‰‹åŠ¨éªŒè¯ã€‚\")\n            webbrowser.open(captcha_url)\n        else:\n            logger.warning(\"æ£€æµ‹åˆ°å¯èƒ½çš„éªŒè¯ç æŒ‘æˆ˜ï¼Œä½†æœªæä¾›éªŒè¯ç  URLã€‚è¯·æ‰‹åŠ¨æ£€æŸ¥æµè§ˆå™¨å¹¶å®ŒæˆéªŒè¯ç éªŒè¯ã€‚\")\n            return False\n        \n        logger.info(\"è¯·åœ¨æ‰“å¼€çš„æµè§ˆå™¨çª—å£ä¸­å®ŒæˆéªŒè¯ç éªŒè¯ã€‚\")\n        while True:\n            try:\n                            # ç­‰å¾…ç”¨æˆ·è¾“å…¥\n                user_input = input(\"å®ŒæˆéªŒè¯ç åï¼Œè¯·è¾“å…¥ 'y' ç»§ç»­ï¼Œæˆ–è¾“å…¥ 'q' é€€å‡ºï¼š\").strip().lower()\n\n                if user_input == 'y':\n                    logger.info(\"ç”¨æˆ·è¾“å…¥ 'y'ï¼Œç»§ç»­çˆ¬å–ã€‚\")\n                    return True\n                elif user_input == 'q':\n                    logger.warning(\"ç”¨æˆ·é€‰æ‹©é€€å‡ºï¼Œç¨‹åºä¸­æ­¢ã€‚\")\n                    sys.exit(\"ç”¨æˆ·é€‰æ‹©é€€å‡ºï¼Œç¨‹åºä¸­æ­¢ã€‚\")\n                else:\n                    logger.warning(\"æ— æ•ˆè¾“å…¥ï¼Œè¯·é‡æ–°è¾“å…¥ 'y' æˆ– 'q'ã€‚\")\n            except EOFError:\n                logger.error(\"è¯»å–ç”¨æˆ·è¾“å…¥æ—¶å‘ç”Ÿ EOFErrorï¼Œç¨‹åºé€€å‡ºã€‚\")\n                sys.exit(\"è¾“å…¥æµå·²å…³é—­ï¼Œç¨‹åºä¸­æ­¢ã€‚\")\n    \n    def get_weibo_json(self, page):\n        \"\"\"è·å–ç½‘é¡µä¸­å¾®åšjsonæ•°æ®\"\"\"\n        url = \"https://m.weibo.cn/api/container/getIndex?\"\n        params = (\n            {\n                \"container_ext\": \"profile_uid:\" + str(self.user_config[\"user_id\"]),\n                \"containerid\": \"100103type=401&q=\" + self.query,\n                \"page_type\": \"searchall\",\n            }\n            if self.query\n            else {\"containerid\": \"230413\" + str(self.user_config[\"user_id\"])}\n        )\n        params[\"page\"] = page\n\n        max_retries = 5\n        retries = 0\n        backoff_factor = 5\n\n        while retries < max_retries:\n            try:\n                response = requests.get(url, params=params, headers=self.headers, timeout=10)\n                response.raise_for_status()  # å¦‚æœå“åº”çŠ¶æ€ç ä¸æ˜¯ 200ï¼Œä¼šæŠ›å‡º HTTPError\n                js = response.json()\n                if 'data' in js:\n                    logger.info(f\"æˆåŠŸè·å–åˆ°é¡µé¢ {page} çš„æ•°æ®ã€‚\")\n                    return js\n                else:\n                    logger.warning(\"æœªèƒ½è·å–åˆ°æ•°æ®ï¼Œå¯èƒ½éœ€è¦éªŒè¯ç éªŒè¯ã€‚\")\n                    if self.handle_captcha(js):\n                        logger.info(\"ç”¨æˆ·å·²å®ŒæˆéªŒè¯ç éªŒè¯ï¼Œç»§ç»­è¯·æ±‚æ•°æ®ã€‚\")\n                        retries = 0  # é‡ç½®é‡è¯•è®¡æ•°å™¨\n                        continue\n                    else:\n                        logger.error(\"éªŒè¯ç éªŒè¯å¤±è´¥æˆ–æœªå®Œæˆï¼Œç¨‹åºå°†é€€å‡ºã€‚\")\n                        sys.exit()\n            except RequestException as e:\n                retries += 1\n                sleep_time = backoff_factor * (2 ** retries)\n                logger.error(f\"è¯·æ±‚å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{e}ã€‚ç­‰å¾… {sleep_time} ç§’åé‡è¯•...\")\n                sleep(sleep_time)\n            except ValueError as ve:\n                retries += 1\n                sleep_time = backoff_factor * (2 ** retries)\n                logger.error(f\"JSON è§£ç å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{ve}ã€‚ç­‰å¾… {sleep_time} ç§’åé‡è¯•...\")\n                sleep(sleep_time)\n        logger.error(\"è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè·³è¿‡å½“å‰é¡µé¢ã€‚\")\n        return {}\n    \n    def user_to_csv(self):\n        \"\"\"å°†çˆ¬å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯å†™å…¥csvæ–‡ä»¶\"\"\"\n        file_dir = os.path.split(os.path.realpath(__file__))[0] + os.sep + \"weibo\"\n        if not os.path.isdir(file_dir):\n            os.makedirs(file_dir)\n        file_path = file_dir + os.sep + \"users.csv\"\n        self.user_csv_file_path = file_path\n        result_headers = [\n            \"ç”¨æˆ·id\",\n            \"æ˜µç§°\",\n            \"æ€§åˆ«\",\n            \"ç”Ÿæ—¥\",\n            \"æ‰€åœ¨åœ°\",\n            \"å­¦ä¹ ç»å†\",\n            \"å…¬å¸\",\n            \"æ³¨å†Œæ—¶é—´\",\n            \"é˜³å…‰ä¿¡ç”¨\",\n            \"å¾®åšæ•°\",\n            \"ç²‰ä¸æ•°\",\n            \"å…³æ³¨æ•°\",\n            \"ç®€ä»‹\",\n            \"ä¸»é¡µ\",\n            \"å¤´åƒ\",\n            \"é«˜æ¸…å¤´åƒ\",\n            \"å¾®åšç­‰çº§\",\n            \"ä¼šå‘˜ç­‰çº§\",\n            \"æ˜¯å¦è®¤è¯\",\n            \"è®¤è¯ç±»å‹\",\n            \"è®¤è¯ä¿¡æ¯\",\n            \"ä¸Šæ¬¡è®°å½•å¾®åšä¿¡æ¯\",\n        ]\n        result_data = [\n            [\n                v.encode(\"utf-8\") if \"unicode\" in str(type(v)) else v\n                for v in self.user.values()\n            ]\n        ]\n        # å·²ç»æ’å…¥ä¿¡æ¯çš„ç”¨æˆ·æ— éœ€é‡å¤æ’å…¥ï¼Œè¿”å›çš„idæ˜¯ç©ºå­—ç¬¦ä¸²æˆ–å¾®åšid å‘å¸ƒæ—¥æœŸ%Y-%m-%d\n        last_weibo_msg = csvutil.insert_or_update_user(\n            logger, result_headers, result_data, file_path\n        )\n        self.last_weibo_id = last_weibo_msg.split(\" \")[0] if last_weibo_msg else \"\"\n        self.last_weibo_date = (\n            last_weibo_msg.split(\" \")[1]\n            if last_weibo_msg\n            else self.user_config[\"since_date\"]\n        )\n\n    def user_to_mongodb(self):\n        \"\"\"å°†çˆ¬å–çš„ç”¨æˆ·ä¿¡æ¯å†™å…¥MongoDBæ•°æ®åº“\"\"\"\n        user_list = [self.user]\n        self.info_to_mongodb(\"user\", user_list)\n        logger.info(\"%sä¿¡æ¯å†™å…¥MongoDBæ•°æ®åº“å®Œæ¯•\", self.user[\"screen_name\"])\n\n    def user_to_mysql(self):\n        \"\"\"å°†çˆ¬å–çš„ç”¨æˆ·ä¿¡æ¯å†™å…¥MySQLæ•°æ®åº“\"\"\"\n        mysql_config = {\n            \"host\": \"localhost\",\n            \"port\": 3306,\n            \"user\": \"root\",\n            \"password\": \"123456\",\n            \"charset\": \"utf8mb4\",\n        }\n        # åˆ›å»º'weibo'æ•°æ®åº“\n        create_database = \"\"\"CREATE DATABASE IF NOT EXISTS weibo DEFAULT\n                         CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci\"\"\"\n        self.mysql_create_database(mysql_config, create_database)\n        # åˆ›å»º'user'è¡¨\n        create_table = \"\"\"\n                CREATE TABLE IF NOT EXISTS user (\n                id varchar(20) NOT NULL,\n                screen_name varchar(30),\n                gender varchar(10),\n                statuses_count INT,\n                followers_count INT,\n                follow_count INT,\n                registration_time varchar(20),\n                sunshine varchar(20),\n                birthday varchar(40),\n                location varchar(200),\n                education varchar(200),\n                company varchar(200),\n                description varchar(400),\n                profile_url varchar(200),\n                profile_image_url varchar(200),\n                avatar_hd varchar(200),\n                urank INT,\n                mbrank INT,\n                verified BOOLEAN DEFAULT 0,\n                verified_type INT,\n                verified_reason varchar(140),\n                PRIMARY KEY (id)\n                ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4\"\"\"\n        self.mysql_create_table(mysql_config, create_table)\n        self.mysql_insert(mysql_config, \"user\", [self.user])\n        logger.info(\"%sä¿¡æ¯å†™å…¥MySQLæ•°æ®åº“å®Œæ¯•\", self.user[\"screen_name\"])\n\n    def user_to_database(self):\n        \"\"\"å°†ç”¨æˆ·ä¿¡æ¯å†™å…¥æ–‡ä»¶/æ•°æ®åº“\"\"\"\n        self.user_to_csv()\n        if \"mysql\" in self.write_mode:\n            self.user_to_mysql()\n        if \"mongo\" in self.write_mode:\n            self.user_to_mongodb()\n        if \"sqlite\" in self.write_mode:\n            self.user_to_sqlite()\n\n    def get_user_info(self):\n        \"\"\"è·å–ç”¨æˆ·ä¿¡æ¯\"\"\"\n        params = {\"containerid\": \"100505\" + str(self.user_config[\"user_id\"])}\n        url = \"https://m.weibo.cn/api/container/getIndex\"\n        \n        # è¿™é‡Œåœ¨è¯»å–ä¸‹ä¸€ä¸ªç”¨æˆ·çš„æ—¶å€™å¾ˆå®¹æ˜“è¢«banï¼Œéœ€è¦ä¼˜åŒ–ä¼‘çœ æ—¶é•¿\n        # åŠ ä¸€ä¸ªcountï¼Œä¸éœ€è¦ä¸€ä¸Šæ¥å•¥éƒ½æ²¡å¹²å°±sleep\n        if self.long_sleep_count_before_each_user > 0:\n            sleep_time = random.randint(30, 60)\n            # æ·»åŠ logï¼Œå¦åˆ™ä¸€èˆ¬ç”¨æˆ·ä¸çŸ¥é“ä»¥ä¸ºç¨‹åºå¡äº†\n            logger.info(f\"\"\"çŸ­æš‚sleep {sleep_time}ç§’ï¼Œé¿å…è¢«ban\"\"\")        \n            sleep(sleep_time)\n            logger.info(\"sleepç»“æŸ\")  \n        self.long_sleep_count_before_each_user = self.long_sleep_count_before_each_user + 1      \n\n        max_retries = 5  # è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé¿å…æ— é™å¾ªç¯\n        retries = 0\n        backoff_factor = 5  # æŒ‡æ•°é€€é¿çš„åŸºæ•°ï¼ˆç§’ï¼‰\n        \n        while retries < max_retries:\n            try:\n                response = requests.get(url, params=params, headers=self.headers, timeout=10)\n                response.raise_for_status()\n                js = response.json()\n                if 'data' in js and 'userInfo' in js['data']:\n                    info = js[\"data\"][\"userInfo\"]\n                    user_info = OrderedDict()\n                    user_info[\"id\"] = self.user_config[\"user_id\"]\n                    user_info[\"screen_name\"] = info.get(\"screen_name\", \"\")\n                    user_info[\"gender\"] = info.get(\"gender\", \"\")\n                    params = {\n                        \"containerid\": \"230283\" + str(self.user_config[\"user_id\"]) + \"_-_INFO\"\n                    }\n                    zh_list = [\"ç”Ÿæ—¥\", \"æ‰€åœ¨åœ°\", \"å°å­¦\", \"åˆä¸­\", \"é«˜ä¸­\", \"å¤§å­¦\", \"å…¬å¸\", \"æ³¨å†Œæ—¶é—´\", \"é˜³å…‰ä¿¡ç”¨\"]\n                    en_list = [\n                        \"birthday\",\n                        \"location\",\n                        \"education\",\n                        \"education\",\n                        \"education\",\n                        \"education\",\n                        \"company\",\n                        \"registration_time\",\n                        \"sunshine\",\n                    ]\n                    for i in en_list:\n                        user_info[i] = \"\"\n                    js, _ = self.get_json(params)\n                    if js[\"ok\"]:\n                        cards = js[\"data\"][\"cards\"]\n                        if isinstance(cards, list) and len(cards) > 1:\n                            card_list = cards[0][\"card_group\"] + cards[1][\"card_group\"]\n                            for card in card_list:\n                                if card.get(\"item_name\") in zh_list:\n                                    user_info[\n                                        en_list[zh_list.index(card.get(\"item_name\"))]\n                                    ] = card.get(\"item_content\", \"\")\n                    user_info[\"statuses_count\"] = self.string_to_int(\n                        info.get(\"statuses_count\", 0)\n                    )\n                    user_info[\"followers_count\"] = self.string_to_int(\n                        info.get(\"followers_count\", 0)\n                    )\n                    user_info[\"follow_count\"] = self.string_to_int(info.get(\"follow_count\", 0))\n                    user_info[\"description\"] = info.get(\"description\", \"\")\n                    user_info[\"profile_url\"] = info.get(\"profile_url\", \"\")\n                    user_info[\"profile_image_url\"] = info.get(\"profile_image_url\", \"\")\n                    user_info[\"avatar_hd\"] = info.get(\"avatar_hd\", \"\")\n                    user_info[\"urank\"] = info.get(\"urank\", 0)\n                    user_info[\"mbrank\"] = info.get(\"mbrank\", 0)\n                    user_info[\"verified\"] = info.get(\"verified\", False)\n                    user_info[\"verified_type\"] = info.get(\"verified_type\", -1)\n                    user_info[\"verified_reason\"] = info.get(\"verified_reason\", \"\")\n                    self.user = self.standardize_info(user_info)\n                    self.user_to_database()\n                    logger.info(f\"æˆåŠŸè·å–åˆ°ç”¨æˆ· {self.user_config['user_id']} çš„ä¿¡æ¯ã€‚\")\n                    return 0\n                else:\n                    logger.warning(\"æœªèƒ½è·å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦éªŒè¯ç éªŒè¯ã€‚\")\n                    if self.handle_captcha(js):\n                        logger.info(\"ç”¨æˆ·å·²å®ŒæˆéªŒè¯ç éªŒè¯ï¼Œç»§ç»­è¯·æ±‚ç”¨æˆ·ä¿¡æ¯ã€‚\")\n                        retries = 0  # é‡ç½®é‡è¯•è®¡æ•°å™¨\n                        continue\n                    else:\n                        logger.error(\"éªŒè¯ç éªŒè¯å¤±è´¥æˆ–æœªå®Œæˆï¼Œç¨‹åºå°†é€€å‡ºã€‚\")\n                        sys.exit()\n            except RequestException as e:\n                retries += 1\n                sleep_time = backoff_factor * (2 ** retries)\n                logger.error(f\"è¯·æ±‚å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{e}ã€‚ç­‰å¾… {sleep_time} ç§’åé‡è¯•...\")\n                sleep(sleep_time)\n            except ValueError as ve:\n                retries += 1\n                sleep_time = backoff_factor * (2 ** retries)\n                logger.error(f\"JSON è§£ç å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{ve}ã€‚ç­‰å¾… {sleep_time} ç§’åé‡è¯•...\")\n                sleep(sleep_time)\n        logger.error(\"è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œç¨‹åºå°†é€€å‡ºã€‚\")\n        sys.exit(\"è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œç¨‹åºå·²é€€å‡ºã€‚\")\n\n    def get_long_weibo(self, id):\n        \"\"\"è·å–é•¿å¾®åš\"\"\"\n        for i in range(5):\n            url = \"https://m.weibo.cn/detail/%s\" % id\n            logger.info(f\"\"\"URL: {url} \"\"\")\n            html = requests.get(url, headers=self.headers, verify=False).text\n            html = html[html.find('\"status\":') :]\n            html = html[: html.rfind('\"call\"')]\n            html = html[: html.rfind(\",\")]\n            html = \"{\" + html + \"}\"\n            js = json.loads(html, strict=False)\n            weibo_info = js.get(\"status\")\n            if weibo_info:\n                weibo = self.parse_weibo(weibo_info)\n                return weibo\n            sleep(random.randint(6, 10))\n\n    def get_pics(self, weibo_info):\n        \"\"\"è·å–å¾®åšåŸå§‹å›¾ç‰‡url\"\"\"\n        if weibo_info.get(\"pics\"):\n            pic_info = weibo_info[\"pics\"]\n            pic_list = [pic[\"large\"][\"url\"] for pic in pic_info]\n            pics = \",\".join(pic_list)\n        else:\n            pics = \"\"\n        return pics\n\n    def get_live_photo(self, weibo_info):\n        \"\"\"è·å–live photoä¸­çš„è§†é¢‘url\"\"\"\n        live_photo_list = weibo_info.get(\"live_photo\", [])\n        return live_photo_list\n\n    def get_video_url(self, weibo_info):\n        \"\"\"è·å–å¾®åšè§†é¢‘url\"\"\"\n        video_url = \"\"\n        video_url_list = []\n        if weibo_info.get(\"page_info\"):\n            if (\n                weibo_info[\"page_info\"].get(\"urls\")\n                or weibo_info[\"page_info\"].get(\"media_info\")\n            ) and weibo_info[\"page_info\"].get(\"type\") == \"video\":\n                media_info = weibo_info[\"page_info\"][\"urls\"]\n                if not media_info:\n                    media_info = weibo_info[\"page_info\"][\"media_info\"]\n                video_url = media_info.get(\"mp4_720p_mp4\")\n                if not video_url:\n                    video_url = media_info.get(\"mp4_hd_url\")\n                if not video_url:\n                    video_url = media_info.get(\"hevc_mp4_hd\")\n                if not video_url:\n                    video_url = media_info.get(\"mp4_sd_url\")\n                if not video_url:\n                    video_url = media_info.get(\"mp4_ld_mp4\")\n                if not video_url:\n                    video_url = media_info.get(\"stream_url_hd\")\n                if not video_url:\n                    video_url = media_info.get(\"stream_url\")\n        if video_url:\n            video_url_list.append(video_url)\n        live_photo_list = self.get_live_photo(weibo_info)\n        if live_photo_list:\n            video_url_list += live_photo_list\n        return \";\".join(video_url_list)\n\n    def download_one_file(self, url, file_path, type, weibo_id):\n        \"\"\"ä¸‹è½½å•ä¸ªæ–‡ä»¶(å›¾ç‰‡/è§†é¢‘)\"\"\"\n        try:\n\n            file_exist = os.path.isfile(file_path)\n            need_download = (not file_exist)\n            sqlite_exist = False\n            if \"sqlite\" in self.write_mode:\n                sqlite_exist = self.sqlite_exist_file(file_path)\n                if not sqlite_exist: \n                    need_download = True\n\n            if not need_download:\n                return \n\n            s = requests.Session()\n            s.mount('http://', HTTPAdapter(max_retries=5))\n            s.mount('https://', HTTPAdapter(max_retries=5))\n            try_count = 0\n            success = False\n            MAX_TRY_COUNT = 3\n            detected_extension = None\n            while try_count < MAX_TRY_COUNT:\n                try:\n                    response = s.get(\n                        url, headers=self.headers, timeout=(5, 10), verify=False\n                    )\n                    response.raise_for_status()\n                    downloaded = response.content\n                    try_count += 1\n\n                    # è·å–æ–‡ä»¶åç¼€\n                    url_path = url.split('?')[0]  # å»é™¤URLä¸­çš„å‚æ•°\n                    inferred_extension = os.path.splitext(url_path)[1].lower().strip('.')\n\n                    # é€šè¿‡ Magic Number æ£€æµ‹æ–‡ä»¶ç±»å‹\n                    if downloaded.startswith(b'\\xFF\\xD8\\xFF'):\n                        # JPEG æ–‡ä»¶\n                        if not downloaded.endswith(b'\\xff\\xd9'):\n                            logger.debug(f\"[DEBUG] JPEG æ–‡ä»¶ä¸å®Œæ•´: {url} ({try_count}/{MAX_TRY_COUNT})\")\n                            continue  # æ–‡ä»¶ä¸å®Œæ•´ï¼Œç»§ç»­é‡è¯•\n                        detected_extension = '.jpg'\n                    elif downloaded.startswith(b'\\x89PNG\\r\\n\\x1A\\n'):\n                        # PNG æ–‡ä»¶\n                        if not downloaded.endswith(b'IEND\\xaeB`\\x82'):\n                            logger.debug(f\"[DEBUG] PNG æ–‡ä»¶ä¸å®Œæ•´: {url} ({try_count}/{MAX_TRY_COUNT})\")\n                            continue  # æ–‡ä»¶ä¸å®Œæ•´ï¼Œç»§ç»­é‡è¯•\n                        detected_extension = '.png'\n                    else:\n                        # å…¶ä»–ç±»å‹ï¼Œä½¿ç”¨åŸæœ‰é€»è¾‘å¤„ç†\n                        if inferred_extension in ['mp4', 'mov', 'webm', 'gif', 'bmp', 'tiff']:\n                            detected_extension = '.' + inferred_extension\n                        else:\n                            # å°è¯•ä» Content-Type è·å–æ‰©å±•å\n                            content_type = response.headers.get('Content-Type', '').lower()\n                            if 'image/jpeg' in content_type:\n                                detected_extension = '.jpg'\n                            elif 'image/png' in content_type:\n                                detected_extension = '.png'\n                            elif 'video/mp4' in content_type:\n                                detected_extension = '.mp4'\n                            elif 'video/quicktime' in content_type:\n                                detected_extension = '.mov'\n                            elif 'video/webm' in content_type:\n                                detected_extension = '.webm'\n                            elif 'image/gif' in content_type:\n                                detected_extension = '.gif'\n                            else:\n                                # ä½¿ç”¨åŸæœ‰çš„æ‰©å±•åï¼Œå¦‚æœæ— æ³•ç¡®å®š\n                                detected_extension = '.' + inferred_extension if inferred_extension else ''\n\n                    # åŠ¨æ€è°ƒæ•´æ–‡ä»¶è·¯å¾„çš„æ‰©å±•å\n                    if detected_extension:\n                        file_path = re.sub(r'\\.\\w+$', detected_extension, file_path)\n\n                    # ä¿å­˜æ–‡ä»¶\n                    if not os.path.isfile(file_path):\n                        with open(file_path, \"wb\") as f:\n                            f.write(downloaded)\n                            logger.debug(\"[DEBUG] save \" + file_path)\n\n                    success = True\n                    logger.debug(\"[DEBUG] success \" + url + \"  \" + str(try_count))\n                    break  # ä¸‹è½½æˆåŠŸï¼Œé€€å‡ºé‡è¯•å¾ªç¯\n\n                except RequestException as e:\n                    try_count += 1\n                    logger.error(f\"[ERROR] è¯·æ±‚å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{e}ã€‚å°è¯•æ¬¡æ•°ï¼š{try_count}/{MAX_TRY_COUNT}\")\n                    sleep_time = 2 ** try_count  # æŒ‡æ•°é€€é¿\n                    sleep(sleep_time)\n                except Exception as e:\n                    logger.exception(f\"[ERROR] ä¸‹è½½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {e}\")\n                    break  # å¯¹äºå…¶ä»–å¼‚å¸¸ï¼Œé€€å‡ºé‡è¯•\n\n            if success:\n                if \"sqlite\" in self.write_mode and not sqlite_exist:\n                    self.insert_file_sqlite(\n                        file_path, weibo_id, url, downloaded\n                    )\n            else:\n                logger.debug(\"[DEBUG] failed \" + url + \" TOTALLY\")\n                error_file = self.get_filepath(type) + os.sep + \"not_downloaded.txt\"\n                with open(error_file, \"ab\") as f:\n                    error_entry = f\"{weibo_id}:{file_path}:{url}\\n\"\n                    f.write(error_entry.encode(sys.stdout.encoding))\n        except Exception as e:\n            error_file = self.get_filepath(type) + os.sep + \"not_downloaded.txt\"\n            with open(error_file, \"ab\") as f:\n                error_entry = f\"{weibo_id}:{file_path}:{url}\\n\"\n                f.write(error_entry.encode(sys.stdout.encoding))\n            logger.exception(e)\n\n    def sqlite_exist_file(self, url):\n        if not os.path.exists(self.get_sqlte_path()):\n            return True\n        con = self.get_sqlite_connection()\n        cur = con.cursor()\n\n        query_sql = \"\"\"SELECT url FROM bins WHERE path=? \"\"\"\n        count = cur.execute(query_sql, (url,)).fetchone()\n        con.close()\n        if count is None:\n            return False\n\n        return True\n\n    def insert_file_sqlite(self, file_path, weibo_id, url, binary):\n        if not weibo_id:\n            return\n        extension = Path(file_path).suffix\n        if not extension:\n            return\n        if len(binary) <= 0:\n            return\n\n        file_data = OrderedDict()\n        file_data[\"weibo_id\"] = weibo_id\n        file_data[\"ext\"] = extension\n        file_data[\"data\"] = binary\n        file_data[\"path\"] = file_path\n        file_data[\"url\"] = url\n\n        con = self.get_sqlite_connection()\n        self.sqlite_insert(con, file_data, \"bins\")\n        con.close()\n\n    def handle_download(self, file_type, file_dir, urls, w):\n        \"\"\"å¤„ç†ä¸‹è½½ç›¸å…³æ“ä½œ\"\"\"\n        file_prefix = w[\"created_at\"][:11].replace(\"-\", \"\") + \"_\" + str(w[\"id\"])\n        if file_type == \"img\":\n            if \",\" in urls:\n                url_list = urls.split(\",\")\n                for i, url in enumerate(url_list):\n                    index = url.rfind(\".\")\n                    if len(url) - index >= 5:\n                        file_suffix = \".jpg\"\n                    else:\n                        file_suffix = url[index:]\n                    file_name = file_prefix + \"_\" + str(i + 1) + file_suffix\n                    file_path = file_dir + os.sep + file_name\n                    self.download_one_file(url, file_path, file_type, w[\"id\"])\n            else:\n                index = urls.rfind(\".\")\n                if len(urls) - index > 5:\n                    file_suffix = \".jpg\"\n                else:\n                    file_suffix = urls[index:]\n                file_name = file_prefix + file_suffix\n                file_path = file_dir + os.sep + file_name\n                self.download_one_file(urls, file_path, file_type, w[\"id\"])\n        else:\n            file_suffix = \".mp4\"\n            if \";\" in urls:\n                url_list = urls.split(\";\")\n                if url_list[0].endswith(\".mov\"):\n                    file_suffix = \".mov\"\n                for i, url in enumerate(url_list):\n                    file_name = file_prefix + \"_\" + str(i + 1) + file_suffix\n                    file_path = file_dir + os.sep + file_name\n                    self.download_one_file(url, file_path, file_type, w[\"id\"])\n            else:\n                if urls.endswith(\".mov\"):\n                    file_suffix = \".mov\"\n                file_name = file_prefix + file_suffix\n                file_path = file_dir + os.sep + file_name\n                self.download_one_file(urls, file_path, file_type, w[\"id\"])\n\n    def download_files(self, file_type, weibo_type, wrote_count):\n        \"\"\"ä¸‹è½½æ–‡ä»¶(å›¾ç‰‡/è§†é¢‘)\"\"\"\n        try:\n            describe = \"\"\n            if file_type == \"img\":\n                describe = \"å›¾ç‰‡\"\n                key = \"pics\"\n            else:\n                describe = \"è§†é¢‘\"\n                key = \"video_url\"\n            if weibo_type == \"original\":\n                describe = \"åŸåˆ›å¾®åš\" + describe\n            else:\n                describe = \"è½¬å‘å¾®åš\" + describe\n            logger.info(\"å³å°†è¿›è¡Œ%sä¸‹è½½\", describe)\n            file_dir = self.get_filepath(file_type)\n            file_dir = file_dir + os.sep + describe\n            if not os.path.isdir(file_dir):\n                os.makedirs(file_dir)\n            for w in tqdm(self.weibo[wrote_count:], desc=\"Download progress\"):\n                if weibo_type == \"retweet\":\n                    if w.get(\"retweet\"):\n                        w = w[\"retweet\"]\n                    else:\n                        continue\n                if w.get(key):\n                    self.handle_download(file_type, file_dir, w.get(key), w)\n            logger.info(\"%sä¸‹è½½å®Œæ¯•,ä¿å­˜è·¯å¾„:\", describe)\n            logger.info(file_dir)\n        except Exception as e:\n            logger.exception(e)\n\n    def get_location(self, selector):\n        \"\"\"è·å–å¾®åšå‘å¸ƒä½ç½®\"\"\"\n        location_icon = \"timeline_card_small_location_default.png\"\n        span_list = selector.xpath(\"//span\")\n        location = \"\"\n        for i, span in enumerate(span_list):\n            if span.xpath(\"img/@src\"):\n                if location_icon in span.xpath(\"img/@src\")[0]:\n                    location = span_list[i + 1].xpath(\"string(.)\")\n                    break\n        return location\n\n    def get_article_url(self, selector):\n        \"\"\"è·å–å¾®åšä¸­å¤´æ¡æ–‡ç« çš„url\"\"\"\n        article_url = \"\"\n        text = selector.xpath(\"string(.)\")\n        if text.startswith(\"å‘å¸ƒäº†å¤´æ¡æ–‡ç« \"):\n            url = selector.xpath(\"//a/@data-url\")\n            if url and url[0].startswith(\"http://t.cn\"):\n                article_url = url[0]\n        return article_url\n\n    def get_topics(self, selector):\n        \"\"\"è·å–å‚ä¸çš„å¾®åšè¯é¢˜\"\"\"\n        span_list = selector.xpath(\"//span[@class='surl-text']\")\n        topics = \"\"\n        topic_list = []\n        for span in span_list:\n            text = span.xpath(\"string(.)\")\n            if len(text) > 2 and text[0] == \"#\" and text[-1] == \"#\":\n                topic_list.append(text[1:-1])\n        if topic_list:\n            topics = \",\".join(topic_list)\n        return topics\n\n    def get_at_users(self, selector):\n        \"\"\"è·å–@ç”¨æˆ·\"\"\"\n        a_list = selector.xpath(\"//a\")\n        at_users = \"\"\n        at_list = []\n        for a in a_list:\n            if \"@\" + a.xpath(\"@href\")[0][3:] == a.xpath(\"string(.)\"):\n                at_list.append(a.xpath(\"string(.)\")[1:])\n        if at_list:\n            at_users = \",\".join(at_list)\n        return at_users\n\n    def string_to_int(self, string):\n        \"\"\"å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°\"\"\"\n        if isinstance(string, int):\n            return string\n        elif string.endswith(\"ä¸‡+\"):\n            string = string[:-2] + \"0000\"\n        elif string.endswith(\"ä¸‡\"):\n            string = float(string[:-1]) * 10000\n        elif string.endswith(\"äº¿\"):\n            string = float(string[:-1]) * 100000000\n        return int(string)\n\n    def standardize_date(self, created_at):\n        \"\"\"æ ‡å‡†åŒ–å¾®åšå‘å¸ƒæ—¶é—´\"\"\"\n        if \"åˆšåˆš\" in created_at:\n            ts = datetime.now()\n        elif \"åˆ†é’Ÿ\" in created_at:\n            minute = created_at[: created_at.find(\"åˆ†é’Ÿ\")]\n            minute = timedelta(minutes=int(minute))\n            ts = datetime.now() - minute\n        elif \"å°æ—¶\" in created_at:\n            hour = created_at[: created_at.find(\"å°æ—¶\")]\n            hour = timedelta(hours=int(hour))\n            ts = datetime.now() - hour\n        elif \"æ˜¨å¤©\" in created_at:\n            day = timedelta(days=1)\n            ts = datetime.now() - day\n        else:\n            created_at = created_at.replace(\"+0800 \", \"\")\n            ts = datetime.strptime(created_at, \"%c\")\n\n        created_at = ts.strftime(DTFORMAT)\n        full_created_at = ts.strftime(\"%Y-%m-%d %H:%M:%S\")\n        return created_at, full_created_at\n\n    def standardize_info(self, weibo):\n        \"\"\"æ ‡å‡†åŒ–ä¿¡æ¯ï¼Œå»é™¤ä¹±ç \"\"\"\n        for k, v in weibo.items():\n            if (\n                \"bool\" not in str(type(v))\n                and \"int\" not in str(type(v))\n                and \"list\" not in str(type(v))\n                and \"long\" not in str(type(v))\n            ):\n                weibo[k] = (\n                    v.replace(\"\\u200b\", \"\")\n                    .encode(sys.stdout.encoding, \"ignore\")\n                    .decode(sys.stdout.encoding)\n                )\n        return weibo\n\n    def parse_weibo(self, weibo_info):\n        weibo = OrderedDict()\n        if weibo_info[\"user\"]:\n            weibo[\"user_id\"] = weibo_info[\"user\"][\"id\"]\n            weibo[\"screen_name\"] = weibo_info[\"user\"][\"screen_name\"]\n        else:\n            weibo[\"user_id\"] = \"\"\n            weibo[\"screen_name\"] = \"\"\n        weibo[\"id\"] = int(weibo_info[\"id\"])\n        weibo[\"bid\"] = weibo_info[\"bid\"]\n        text_body = weibo_info[\"text\"]\n        selector = etree.HTML(f\"{text_body}<hr>\" if text_body.isspace() else text_body)\n        if self.remove_html_tag:\n            text_list = selector.xpath(\"//text()\")\n            # è‹¥text_listä¸­çš„æŸä¸ªå­—ç¬¦ä¸²å…ƒç´ ä»¥ @ æˆ– # å¼€å§‹ï¼Œåˆ™å°†è¯¥å…ƒç´ ä¸å‰åå…ƒç´ åˆå¹¶ä¸ºæ–°å…ƒç´ ï¼Œå¦åˆ™ä¼šå¸¦æ¥æ²¡æœ‰å¿…è¦çš„æ¢è¡Œ\n            text_list_modified = []\n            for ele in range(len(text_list)):\n                if ele > 0 and (text_list[ele-1].startswith(('@','#')) or text_list[ele].startswith(('@','#'))):\n                    text_list_modified[-1] += text_list[ele]\n                else:\n                    text_list_modified.append(text_list[ele])\n            weibo[\"text\"] = \"\\n\".join(text_list_modified)\n        else:\n            weibo[\"text\"] = text_body\n        weibo[\"article_url\"] = self.get_article_url(selector)\n        weibo[\"pics\"] = self.get_pics(weibo_info)\n        weibo[\"video_url\"] = self.get_video_url(weibo_info)\n        weibo[\"location\"] = self.get_location(selector)\n        weibo[\"created_at\"] = weibo_info[\"created_at\"]\n        weibo[\"source\"] = weibo_info[\"source\"]\n        weibo[\"attitudes_count\"] = self.string_to_int(\n            weibo_info.get(\"attitudes_count\", 0)\n        )\n        weibo[\"comments_count\"] = self.string_to_int(\n            weibo_info.get(\"comments_count\", 0)\n        )\n        weibo[\"reposts_count\"] = self.string_to_int(weibo_info.get(\"reposts_count\", 0))\n        weibo[\"topics\"] = self.get_topics(selector)\n        weibo[\"at_users\"] = self.get_at_users(selector)\n        return self.standardize_info(weibo)\n\n    def print_user_info(self):\n        \"\"\"æ‰“å°ç”¨æˆ·ä¿¡æ¯\"\"\"\n        logger.info(\"+\" * 100)\n        logger.info(\"ç”¨æˆ·ä¿¡æ¯\")\n        logger.info(\"ç”¨æˆ·idï¼š%s\", self.user[\"id\"])\n        logger.info(\"ç”¨æˆ·æ˜µç§°ï¼š%s\", self.user[\"screen_name\"])\n        gender = \"å¥³\" if self.user[\"gender\"] == \"f\" else \"ç”·\"\n        logger.info(\"æ€§åˆ«ï¼š%s\", gender)\n        logger.info(\"ç”Ÿæ—¥ï¼š%s\", self.user[\"birthday\"])\n        logger.info(\"æ‰€åœ¨åœ°ï¼š%s\", self.user[\"location\"])\n        logger.info(\"æ•™è‚²ç»å†ï¼š%s\", self.user[\"education\"])\n        logger.info(\"å…¬å¸ï¼š%s\", self.user[\"company\"])\n        logger.info(\"é˜³å…‰ä¿¡ç”¨ï¼š%s\", self.user[\"sunshine\"])\n        logger.info(\"æ³¨å†Œæ—¶é—´ï¼š%s\", self.user[\"registration_time\"])\n        logger.info(\"å¾®åšæ•°ï¼š%d\", self.user[\"statuses_count\"])\n        logger.info(\"ç²‰ä¸æ•°ï¼š%d\", self.user[\"followers_count\"])\n        logger.info(\"å…³æ³¨æ•°ï¼š%d\", self.user[\"follow_count\"])\n        logger.info(\"urlï¼šhttps://m.weibo.cn/profile/%s\", self.user[\"id\"])\n        if self.user.get(\"verified_reason\"):\n            logger.info(self.user[\"verified_reason\"])\n        logger.info(self.user[\"description\"])\n        logger.info(\"+\" * 100)\n\n    def print_one_weibo(self, weibo):\n        \"\"\"æ‰“å°ä¸€æ¡å¾®åš\"\"\"\n        try:\n            logger.info(\"å¾®åšidï¼š%d\", weibo[\"id\"])\n            logger.info(\"å¾®åšæ­£æ–‡ï¼š%s\", weibo[\"text\"])\n            logger.info(\"åŸå§‹å›¾ç‰‡urlï¼š%s\", weibo[\"pics\"])\n            logger.info(\"å¾®åšä½ç½®ï¼š%s\", weibo[\"location\"])\n            logger.info(\"å‘å¸ƒæ—¶é—´ï¼š%s\", weibo[\"created_at\"])\n            logger.info(\"å‘å¸ƒå·¥å…·ï¼š%s\", weibo[\"source\"])\n            logger.info(\"ç‚¹èµæ•°ï¼š%d\", weibo[\"attitudes_count\"])\n            logger.info(\"è¯„è®ºæ•°ï¼š%d\", weibo[\"comments_count\"])\n            logger.info(\"è½¬å‘æ•°ï¼š%d\", weibo[\"reposts_count\"])\n            logger.info(\"è¯é¢˜ï¼š%s\", weibo[\"topics\"])\n            logger.info(\"@ç”¨æˆ·ï¼š%s\", weibo[\"at_users\"])\n            logger.info(\"urlï¼šhttps://m.weibo.cn/detail/%d\", weibo[\"id\"])\n        except OSError:\n            pass\n\n    def print_weibo(self, weibo):\n        \"\"\"æ‰“å°å¾®åšï¼Œè‹¥ä¸ºè½¬å‘å¾®åšï¼Œä¼šåŒæ—¶æ‰“å°åŸåˆ›å’Œè½¬å‘éƒ¨åˆ†\"\"\"\n        if weibo.get(\"retweet\"):\n            logger.info(\"*\" * 100)\n            logger.info(\"è½¬å‘éƒ¨åˆ†ï¼š\")\n            self.print_one_weibo(weibo[\"retweet\"])\n            logger.info(\"*\" * 100)\n            logger.info(\"åŸåˆ›éƒ¨åˆ†ï¼š\")\n        self.print_one_weibo(weibo)\n        logger.info(\"-\" * 120)\n\n    def get_one_weibo(self, info):\n        \"\"\"è·å–ä¸€æ¡å¾®åšçš„å…¨éƒ¨ä¿¡æ¯\"\"\"\n        try:\n            weibo_info = info[\"mblog\"]\n            weibo_id = weibo_info[\"id\"]\n            retweeted_status = weibo_info.get(\"retweeted_status\")\n            is_long = (\n                True if weibo_info.get(\"pic_num\") > 9 else weibo_info.get(\"isLongText\")\n            )\n            if retweeted_status and retweeted_status.get(\"id\"):  # è½¬å‘\n                retweet_id = retweeted_status.get(\"id\")\n                is_long_retweet = retweeted_status.get(\"isLongText\")\n                if is_long:\n                    weibo = self.get_long_weibo(weibo_id)\n                    if not weibo:\n                        weibo = self.parse_weibo(weibo_info)\n                else:\n                    weibo = self.parse_weibo(weibo_info)\n                if is_long_retweet:\n                    retweet = self.get_long_weibo(retweet_id)\n                    if not retweet:\n                        retweet = self.parse_weibo(retweeted_status)\n                else:\n                    retweet = self.parse_weibo(retweeted_status)\n                (\n                    retweet[\"created_at\"],\n                    retweet[\"full_created_at\"],\n                ) = self.standardize_date(retweeted_status[\"created_at\"])\n                weibo[\"retweet\"] = retweet\n            else:  # åŸåˆ›\n                if is_long:\n                    weibo = self.get_long_weibo(weibo_id)\n                    if not weibo:\n                        weibo = self.parse_weibo(weibo_info)\n                else:\n                    weibo = self.parse_weibo(weibo_info)\n            weibo[\"created_at\"], weibo[\"full_created_at\"] = self.standardize_date(\n                weibo_info[\"created_at\"]\n            )\n            return weibo\n        except Exception as e:\n            logger.exception(e)\n\n    def get_weibo_comments(self, weibo, max_count, on_downloaded):\n        \"\"\"\n        :weibo standardlized weibo\n        :max_count æœ€å¤§å…è®¸ä¸‹è½½æ•°\n        :on_downloaded ä¸‹è½½å®Œæˆæ—¶çš„å®ä¾‹æ–¹æ³•å›è°ƒ\n        \"\"\"\n        if weibo[\"comments_count\"] == 0:\n            return\n\n        logger.info(\n            \"æ­£åœ¨ä¸‹è½½è¯„è®º å¾®åšid:{id}\".format(id=weibo[\"id\"])\n        )\n        self._get_weibo_comments_cookie(weibo, 0, max_count, None, on_downloaded)\n\n    def get_weibo_reposts(self, weibo, max_count, on_downloaded):\n        \"\"\"\n        :weibo standardlized weibo\n        :max_count æœ€å¤§å…è®¸ä¸‹è½½æ•°\n        :on_downloaded ä¸‹è½½å®Œæˆæ—¶çš„å®ä¾‹æ–¹æ³•å›è°ƒ\n        \"\"\"\n        if weibo[\"reposts_count\"] == 0:\n            return\n\n        logger.info(\n            \"æ­£åœ¨ä¸‹è½½è½¬å‘ å¾®åšid:{id}\".format(id=weibo[\"id\"])\n        )\n        self._get_weibo_reposts_cookie(weibo, 0, max_count, 1, on_downloaded)\n\n    def _get_weibo_comments_cookie(\n        self, weibo, cur_count, max_count, max_id, on_downloaded\n    ):\n        \"\"\"\n        :weibo standardlized weibo\n        :cur_count  å·²ç»ä¸‹è½½çš„è¯„è®ºæ•°\n        :max_count æœ€å¤§å…è®¸ä¸‹è½½æ•°\n        :max_id å¾®åšè¿”å›çš„max_idå‚æ•°\n        :on_downloaded ä¸‹è½½å®Œæˆæ—¶çš„å®ä¾‹æ–¹æ³•å›è°ƒ\n        \"\"\"\n        if cur_count >= max_count:\n            return\n\n        id = weibo[\"id\"]\n        params = {\"mid\": id}\n        if max_id:\n            params[\"max_id\"] = max_id\n        url = \"https://m.weibo.cn/comments/hotflow?max_id_type=0\"\n        req = requests.get(\n            url,\n            params=params,\n            headers=self.headers,\n        )\n        json = None\n        error = False\n        try:\n            json = req.json()\n        except Exception as e:\n            # æ²¡æœ‰cookieä¼šæŠ“å–å¤±è´¥\n            # å¾®åšæ—¥æœŸå°äºæŸä¸ªæ—¥æœŸçš„ç”¨è¿™ä¸ªurlä¼šè¢«403 éœ€è¦ç”¨è€åŠæ³•å°è¯•ä¸€ä¸‹\n            error = True\n\n        if error:\n            # æœ€å¤§å¥½åƒåªèƒ½æœ‰50æ¡ TODO: improvement\n            self._get_weibo_comments_nocookie(weibo, 0, max_count, 1, on_downloaded)\n            return\n\n        data = json.get(\"data\")\n        if not data:\n            # æ–°æ¥å£æ²¡æœ‰æŠ“å–åˆ°çš„è€æ¥å£ä¹Ÿè¯•ä¸€ä¸‹\n            self._get_weibo_comments_nocookie(weibo, 0, max_count, 1, on_downloaded)\n            return\n\n        comments = data.get(\"data\")\n        count = len(comments)\n        if count == 0:\n            # æ²¡æœ‰äº†å¯ä»¥ç›´æ¥è·³å‡ºé€’å½’\n            return\n\n        if on_downloaded:\n            on_downloaded(weibo, comments)\n\n        # éšæœºç¡çœ ä¸€ä¸‹\n        if max_count % 40 == 0:\n            sleep(random.randint(1, 5))\n\n        cur_count += count\n        max_id = data.get(\"max_id\")\n\n        if max_id == 0:\n            return\n\n        self._get_weibo_comments_cookie(\n            weibo, cur_count, max_count, max_id, on_downloaded\n        )\n\n    def _get_weibo_comments_nocookie(\n        self, weibo, cur_count, max_count, page, on_downloaded\n    ):\n        \"\"\"\n        :weibo standardlized weibo\n        :cur_count  å·²ç»ä¸‹è½½çš„è¯„è®ºæ•°\n        :max_count æœ€å¤§å…è®¸ä¸‹è½½æ•°\n        :page ä¸‹è½½çš„é¡µç  ä» 1 å¼€å§‹\n        :on_downloaded ä¸‹è½½å®Œæˆæ—¶çš„å®ä¾‹æ–¹æ³•å›è°ƒ\n        \"\"\"\n        if cur_count >= max_count:\n            return\n        id = weibo[\"id\"]\n        url = \"https://m.weibo.cn/api/comments/show?id={id}&page={page}\".format(\n            id=id, page=page\n        )\n        req = requests.get(url)\n        json = None\n        try:\n            json = req.json()\n        except Exception as e:\n            logger.warning(\"æœªèƒ½æŠ“å–å®Œæ•´è¯„è®º å¾®åšid: {id}\".format(id=id))\n            return\n\n        data = json.get(\"data\")\n        if not data:\n            return\n        comments = data.get(\"data\")\n        count = len(comments)\n        if count == 0:\n            # æ²¡æœ‰äº†å¯ä»¥ç›´æ¥è·³å‡ºé€’å½’\n            return\n\n        if on_downloaded:\n            on_downloaded(weibo, comments)\n\n        cur_count += count\n        page += 1\n\n        # éšæœºç¡çœ ä¸€ä¸‹\n        if page % 2 == 0:\n            sleep(random.randint(1, 5))\n\n        req_page = data.get(\"max\")\n\n        if req_page == 0:\n            return\n\n        if page > req_page:\n            return\n        self._get_weibo_comments_nocookie(\n            weibo, cur_count, max_count, page, on_downloaded\n        )\n\n    def _get_weibo_reposts_cookie(\n        self, weibo, cur_count, max_count, page, on_downloaded\n    ):\n        \"\"\"\n        :weibo standardlized weibo\n        :cur_count  å·²ç»ä¸‹è½½çš„è½¬å‘æ•°\n        :max_count æœ€å¤§å…è®¸ä¸‹è½½æ•°\n        :page ä¸‹è½½çš„é¡µç  ä» 1 å¼€å§‹\n        :on_downloaded ä¸‹è½½å®Œæˆæ—¶çš„å®ä¾‹æ–¹æ³•å›è°ƒ\n        \"\"\"\n        if cur_count >= max_count:\n            return\n        id = weibo[\"id\"]\n        url = \"https://m.weibo.cn/api/statuses/repostTimeline\"\n        params = {\"id\": id, \"page\": page}\n        req = requests.get(\n            url,\n            params=params,\n            headers=self.headers,\n        )\n\n        json = None\n        try:\n            json = req.json()\n        except Exception as e:\n            logger.warning(\n                \"æœªèƒ½æŠ“å–å®Œæ•´è½¬å‘ å¾®åšid: {id}\".format(id=id)\n            )\n            return\n\n        data = json.get(\"data\")\n        if not data:\n            return\n        reposts = data.get(\"data\")\n        count = len(reposts)\n        if count == 0:\n            # æ²¡æœ‰äº†å¯ä»¥ç›´æ¥è·³å‡ºé€’å½’\n            return\n\n        if on_downloaded:\n            on_downloaded(weibo, reposts)\n\n        cur_count += count\n        page += 1\n\n        # éšæœºç¡çœ ä¸€ä¸‹\n        if page % 2 == 0:\n            sleep(random.randint(2, 5))\n\n        req_page = data.get(\"max\")\n\n        if req_page == 0:\n            return\n\n        if page > req_page:\n            return\n        self._get_weibo_reposts_cookie(weibo, cur_count, max_count, page, on_downloaded)\n\n    def is_pinned_weibo(self, info):\n        \"\"\"åˆ¤æ–­å¾®åšæ˜¯å¦ä¸ºç½®é¡¶å¾®åš\"\"\"\n        weibo_info = info[\"mblog\"]\n        isTop = weibo_info.get(\"isTop\")\n        if isTop:\n            return True\n        else:\n            return False\n    \n\n    def get_one_page(self, page):\n        \"\"\"è·å–ä¸€é¡µçš„å…¨éƒ¨å¾®åš\"\"\"\n        try:\n            js = self.get_weibo_json(page)\n            import json\n            with open('js.json','w') as f:\n                #å†™å…¥æ–¹å¼1ï¼Œç­‰ä»·äºä¸‹é¢è¿™è¡Œ\n                json.dump(js,f) #æŠŠåˆ—è¡¨numberså†…å®¹å†™å…¥åˆ°\"list.json\"æ–‡ä»¶ä¸­\n            if js[\"ok\"]:\n                weibos = js[\"data\"][\"cards\"]\n                \n                if self.query:\n                    weibos = weibos[0][\"card_group\"]\n                # å¦‚æœéœ€è¦æ£€æŸ¥cookieï¼Œåœ¨å¾ªç¯ç¬¬ä¸€ä¸ªäººçš„æ—¶å€™ï¼Œå°±è¦çœ‹çœ‹ä»…è‡ªå·±å¯è§çš„ä¿¡æ¯æœ‰æ²¡æœ‰ï¼Œè¦æ˜¯æ²¡æœ‰ç›´æ¥æŠ¥é”™\n                for w in weibos:\n                    if w[\"card_type\"] == 11:\n                        temp = w.get(\"card_group\",[0])\n                        if len(temp) >= 1:\n                            w = temp[0] or w\n                        else:\n                            w = w\n                    if w[\"card_type\"] == 9:\n                        wb = self.get_one_weibo(w)\n                        if wb:\n                            if (\n                                const.CHECK_COOKIE[\"CHECK\"]\n                                and (not const.CHECK_COOKIE[\"CHECKED\"])\n                                and wb[\"text\"].startswith(\n                                    const.CHECK_COOKIE[\"HIDDEN_WEIBO\"]\n                                )\n                            ):\n                                const.CHECK_COOKIE[\"CHECKED\"] = True\n                                logger.info(\"cookieæ£€æŸ¥é€šè¿‡\")\n                                if const.CHECK_COOKIE[\"EXIT_AFTER_CHECK\"]:\n                                    return True\n                            if wb[\"id\"] in self.weibo_id_list:\n                                continue\n                            created_at = datetime.strptime(wb[\"created_at\"], DTFORMAT)\n                            since_date = datetime.strptime(\n                                self.user_config[\"since_date\"], DTFORMAT\n                            )\n                            if const.MODE == \"append\":\n                                # appendæ¨¡å¼ä¸‹ä¸ä¼šå¯¹ç½®é¡¶å¾®åšåšä»»ä½•å¤„ç†\n\n                                # ç”±äºå¾®åšæœ¬èº«çš„è°ƒæ•´ï¼Œä¸‹é¢åˆ¤æ–­æ˜¯å¦ä¸ºç½®é¡¶çš„ä»£ç å·²å¤±æ•ˆï¼Œé»˜è®¤æ‰€æœ‰ç”¨æˆ·ç¬¬ä¸€æ¡å‡ä¸ºç½®é¡¶\n                                # if self.is_pinned_weibo(w):\n                                #     continue\n                                if const.CHECK_COOKIE[\"GUESS_PIN\"]:\n                                    const.CHECK_COOKIE[\"GUESS_PIN\"] = False\n                                    continue\n\n                                if self.first_crawler:\n                                    # ç½®é¡¶å¾®åšçš„å…·ä½“æ—¶é—´ä¸å¥½åˆ¤å®šï¼Œå°†éç½®é¡¶å¾®åšå½“æˆæœ€æ–°å¾®åšï¼Œå†™å…¥ä¸Šæ¬¡æŠ“å–idçš„csv\n                                    self.latest_weibo_id = str(wb[\"id\"])\n                                    csvutil.update_last_weibo_id(\n                                        wb[\"user_id\"],\n                                        str(wb[\"id\"]) + \" \" + wb[\"created_at\"],\n                                        self.user_csv_file_path,\n                                    )\n                                    self.first_crawler = False\n                                if str(wb[\"id\"]) == self.last_weibo_id:\n                                    if const.CHECK_COOKIE[\"CHECK\"] and (\n                                        not const.CHECK_COOKIE[\"CHECKED\"]\n                                    ):\n                                        # å·²ç»çˆ¬å–è¿‡æœ€æ–°çš„äº†ï¼Œåªæ˜¯æ²¡æ£€æŸ¥åˆ°cookieï¼Œä¸€æ—¦æ£€æŸ¥é€šè¿‡ï¼Œç›´æ¥æ”¾è¡Œ\n                                        const.CHECK_COOKIE[\"EXIT_AFTER_CHECK\"] = True\n                                        continue\n                                    if self.last_weibo_id == self.latest_weibo_id:\n                                        logger.info(\n                                            \"{} ç”¨æˆ·æ²¡æœ‰å‘æ–°å¾®åš\".format(\n                                                self.user[\"screen_name\"]\n                                            )\n                                        )\n                                    else:\n                                        logger.info(\n                                            \"å¢é‡è·å–å¾®åšå®Œæ¯•ï¼Œå°†æœ€æ–°å¾®åšidä» {} å˜æ›´ä¸º {}\".format(\n                                                self.last_weibo_id, self.latest_weibo_id\n                                            )\n                                        )\n                                    return True\n                                # ä¸Šä¸€æ¬¡æ ‡è®°çš„å¾®åšè¢«åˆ äº†ï¼Œå°±æŠŠä¸Šä¸€æ¡å¾®åšæ—¶é—´è®°å½•æ¨å‰ä¸¤å¤©ï¼Œå¤šæŠ“ç‚¹è¯„è®ºæˆ–è€…å¾®åšå†…å®¹ä¿®æ”¹\n                                # TODO æ›´åŠ åˆç†çš„æµç¨‹æ˜¯ï¼Œå³ä½¿è¯»å–åˆ°ä¸Šæ¬¡æ›´æ–°å¾®åšidï¼Œä¹ŸæŠ“å–å¢é‡è¯„è®ºï¼Œç”±æ­¤è·å¾—æ›´å¤šçš„è¯„è®º\n                                since_date = datetime.strptime(\n                                    convert_to_days_ago(self.last_weibo_date, 1),\n                                    DTFORMAT,\n                                )\n                            if created_at < since_date:\n                                if self.is_pinned_weibo(w):\n                                    continue\n                                # å¦‚æœè¦æ£€æŸ¥è¿˜æ²¡æœ‰æ£€æŸ¥cookieï¼Œä¸èƒ½ç›´æ¥è·³å‡º\n                                elif const.CHECK_COOKIE[\"CHECK\"] and (\n                                    not const.CHECK_COOKIE[\"CHECKED\"]\n                                ):\n                                    continue\n                                else:\n                                    logger.info(\n                                        \"{}å·²è·å–{}({})çš„ç¬¬{}é¡µ{}å¾®åš{}\".format(\n                                            \"-\" * 30,\n                                            self.user[\"screen_name\"],\n                                            self.user[\"id\"],\n                                            page,\n                                            'åŒ…å«\"' + self.query + '\"çš„'\n                                            if self.query\n                                            else \"\",\n                                            \"-\" * 30,\n                                        )\n                                    )\n                                    return True\n                            if (not self.only_crawl_original) or (\"retweet\" not in wb.keys()):\n                                self.weibo.append(wb)\n                                self.weibo_id_list.append(wb[\"id\"])\n                                self.got_count += 1\n                                # è¿™é‡Œæ˜¯ç³»ç»Ÿæ—¥å¿—è¾“å‡ºï¼Œå°½é‡åˆ«å¤ªæ‚\n                                logger.info(\n                                    \"å·²è·å–ç”¨æˆ· {} çš„å¾®åšï¼Œå†…å®¹ä¸º {}\".format(\n                                        self.user[\"screen_name\"], wb[\"text\"]\n                                    )\n                                )\n                                # self.print_weibo(wb)\n                            else:\n                                logger.info(\"æ­£åœ¨è¿‡æ»¤è½¬å‘å¾®åš\")\n                    \n                if const.CHECK_COOKIE[\"CHECK\"] and not const.CHECK_COOKIE[\"CHECKED\"]:\n                    logger.warning(\"ç»æ£€æŸ¥ï¼Œcookieæ— æ•ˆï¼Œç³»ç»Ÿé€€å‡º\")\n                    if const.NOTIFY[\"NOTIFY\"]:\n                        push_deer(\"ç»æ£€æŸ¥ï¼Œcookieæ— æ•ˆï¼Œç³»ç»Ÿé€€å‡º\")\n                    sys.exit()\n            else:\n                return True\n            logger.info(\n                \"{}å·²è·å–{}({})çš„ç¬¬{}é¡µå¾®åš{}\".format(\n                    \"-\" * 30, self.user[\"screen_name\"], self.user[\"id\"], page, \"-\" * 30\n                )\n            )\n        except Exception as e:\n            logger.exception(e)\n\n    def get_page_count(self):\n        \"\"\"è·å–å¾®åšé¡µæ•°\"\"\"\n        try:\n            weibo_count = self.user[\"statuses_count\"]\n            page_count = int(math.ceil(weibo_count / 10.0))\n            return page_count\n        except KeyError:\n            logger.exception(\n                \"ç¨‹åºå‡ºé”™ï¼Œé”™è¯¯åŸå› å¯èƒ½ä¸ºä»¥ä¸‹ä¸¤è€…ï¼š\\n\"\n                \"1.user_idä¸æ­£ç¡®ï¼›\\n\"\n                \"2.æ­¤ç”¨æˆ·å¾®åšå¯èƒ½éœ€è¦è®¾ç½®cookieæ‰èƒ½çˆ¬å–ã€‚\\n\"\n                \"è§£å†³æ–¹æ¡ˆï¼š\\n\"\n                \"è¯·å‚è€ƒ\\n\"\n                \"https://github.com/dataabc/weibo-crawler#å¦‚ä½•è·å–user_id\\n\"\n                \"è·å–æ­£ç¡®çš„user_idï¼›\\n\"\n                \"æˆ–è€…å‚è€ƒ\\n\"\n                \"https://github.com/dataabc/weibo-crawler#3ç¨‹åºè®¾ç½®\\n\"\n                \"ä¸­çš„â€œè®¾ç½®cookieâ€éƒ¨åˆ†è®¾ç½®cookieä¿¡æ¯\"\n            )\n\n    def get_write_info(self, wrote_count):\n        \"\"\"è·å–è¦å†™å…¥çš„å¾®åšä¿¡æ¯\"\"\"\n        write_info = []\n        for w in self.weibo[wrote_count:]:\n            wb = OrderedDict()\n            for k, v in w.items():\n                if k not in [\"user_id\", \"screen_name\", \"retweet\"]:\n                    if \"unicode\" in str(type(v)):\n                        v = v.encode(\"utf-8\")\n                    if k == \"id\":\n                        v = str(v) + \"\\t\"\n                    wb[k] = v\n            if not self.only_crawl_original:\n                if w.get(\"retweet\"):\n                    wb[\"is_original\"] = False\n                    for k2, v2 in w[\"retweet\"].items():\n                        if \"unicode\" in str(type(v2)):\n                            v2 = v2.encode(\"utf-8\")\n                        if k2 == \"id\":\n                            v2 = str(v2) + \"\\t\"\n                        wb[\"retweet_\" + k2] = v2\n                else:\n                    wb[\"is_original\"] = True\n            write_info.append(wb)\n        return write_info\n\n    def get_filepath(self, type):\n        \"\"\"è·å–ç»“æœæ–‡ä»¶è·¯å¾„\"\"\"\n        try:\n            dir_name = self.user[\"screen_name\"]\n            if self.user_id_as_folder_name:\n                dir_name = str(self.user_config[\"user_id\"])\n            file_dir = (\n                os.path.split(os.path.realpath(__file__))[0]\n                + os.sep\n                + \"weibo\"\n                + os.sep\n                + dir_name\n            )\n            if type == \"img\" or type == \"video\":\n                file_dir = file_dir + os.sep + type\n            if not os.path.isdir(file_dir):\n                os.makedirs(file_dir)\n            if type == \"img\" or type == \"video\":\n                return file_dir\n            file_path = file_dir + os.sep + str(self.user_config[\"user_id\"]) + \".\" + type\n            return file_path\n        except Exception as e:\n            logger.exception(e)\n\n    def get_result_headers(self):\n        \"\"\"è·å–è¦å†™å…¥ç»“æœæ–‡ä»¶çš„è¡¨å¤´\"\"\"\n        result_headers = [\n            \"id\",\n            \"bid\",\n            \"æ­£æ–‡\",\n            \"å¤´æ¡æ–‡ç« url\",\n            \"åŸå§‹å›¾ç‰‡url\",\n            \"è§†é¢‘url\",\n            \"ä½ç½®\",\n            \"æ—¥æœŸ\",\n            \"å·¥å…·\",\n            \"ç‚¹èµæ•°\",\n            \"è¯„è®ºæ•°\",\n            \"è½¬å‘æ•°\",\n            \"è¯é¢˜\",\n            \"@ç”¨æˆ·\",\n            \"å®Œæ•´æ—¥æœŸ\",\n        ]\n        if not self.only_crawl_original:\n            result_headers2 = [\"æ˜¯å¦åŸåˆ›\", \"æºç”¨æˆ·id\", \"æºç”¨æˆ·æ˜µç§°\"]\n            result_headers3 = [\"æºå¾®åš\" + r for r in result_headers]\n            result_headers = result_headers + result_headers2 + result_headers3\n        return result_headers\n\n    def write_csv(self, wrote_count):\n        \"\"\"å°†çˆ¬åˆ°çš„ä¿¡æ¯å†™å…¥csvæ–‡ä»¶\"\"\"\n        write_info = self.get_write_info(wrote_count)\n        result_headers = self.get_result_headers()\n        result_data = [w.values() for w in write_info]\n        file_path = self.get_filepath(\"csv\")\n        self.csv_helper(result_headers, result_data, file_path)\n\n    def csv_helper(self, headers, result_data, file_path):\n        \"\"\"å°†æŒ‡å®šä¿¡æ¯å†™å…¥csvæ–‡ä»¶\"\"\"\n        if not os.path.isfile(file_path):\n            is_first_write = 1\n        else:\n            is_first_write = 0\n        if sys.version < \"3\":  # python2.x\n            with open(file_path, \"ab\") as f:\n                f.write(codecs.BOM_UTF8)\n                writer = csv.writer(f)\n                if is_first_write:\n                    writer.writerows([headers])\n                writer.writerows(result_data)\n        else:  # python3.x\n\n            with open(file_path, \"a\", encoding=\"utf-8-sig\", newline=\"\") as f:\n                writer = csv.writer(f)\n                if is_first_write:\n                    writer.writerows([headers])\n                writer.writerows(result_data)\n        if headers[0] == \"id\":\n            logger.info(\"%dæ¡å¾®åšå†™å…¥csvæ–‡ä»¶å®Œæ¯•,ä¿å­˜è·¯å¾„:\", self.got_count)\n        else:\n            logger.info(\"%s ä¿¡æ¯å†™å…¥csvæ–‡ä»¶å®Œæ¯•ï¼Œä¿å­˜è·¯å¾„:\", self.user[\"screen_name\"])\n        logger.info(file_path)\n\n    def update_json_data(self, data, weibo_info):\n        \"\"\"æ›´æ–°è¦å†™å…¥jsonç»“æœæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå·²ç»å­˜åœ¨äºjsonä¸­çš„ä¿¡æ¯æ›´æ–°ä¸ºæœ€æ–°å€¼ï¼Œä¸å­˜åœ¨çš„ä¿¡æ¯æ·»åŠ åˆ°dataä¸­\"\"\"\n        data[\"user\"] = self.user\n        if data.get(\"weibo\"):\n            is_new = 1  # å¾…å†™å…¥å¾®åšæ˜¯å¦å…¨éƒ¨ä¸ºæ–°å¾®åšï¼Œå³å¾…å†™å…¥å¾®åšä¸jsonä¸­çš„æ•°æ®ä¸é‡å¤\n            for old in data[\"weibo\"]:\n                if weibo_info[-1][\"id\"] == old[\"id\"]:\n                    is_new = 0\n                    break\n            if is_new == 0:\n                for new in weibo_info:\n                    flag = 1\n                    for i, old in enumerate(data[\"weibo\"]):\n                        if new[\"id\"] == old[\"id\"]:\n                            data[\"weibo\"][i] = new\n                            flag = 0\n                            break\n                    if flag:\n                        data[\"weibo\"].append(new)\n            else:\n                data[\"weibo\"] += weibo_info\n        else:\n            data[\"weibo\"] = weibo_info\n        return data\n\n    def write_json(self, wrote_count):\n        \"\"\"å°†çˆ¬åˆ°çš„ä¿¡æ¯å†™å…¥jsonæ–‡ä»¶\"\"\"\n        data = {}\n        path = self.get_filepath(\"json\")\n        if os.path.isfile(path):\n            with codecs.open(path, \"r\", encoding=\"utf-8\") as f:\n                data = json.load(f)\n        weibo_info = self.weibo[wrote_count:]\n        data = self.update_json_data(data, weibo_info)\n        with codecs.open(path, \"w\", encoding=\"utf-8\") as f:\n            json.dump(data, f, ensure_ascii=False)\n        logger.info(\"%dæ¡å¾®åšå†™å…¥jsonæ–‡ä»¶å®Œæ¯•,ä¿å­˜è·¯å¾„:\", self.got_count)\n        logger.info(path)\n\n    def send_post_request_with_token(self, url, data, token, max_retries, backoff_factor):\n        headers = {\n            'Content-Type': 'application/json',\n            'api-token': f'{token}',\n        }\n        for attempt in range(max_retries + 1):\n            try:\n                response = requests.post(url, json=data, headers=headers)\n                if response.status_code == requests.codes.ok:\n                    return response.json()\n                else:\n                    raise RequestException(f\"Unexpected response status: {response.status_code}\")\n            except RequestException as e:\n                if attempt < max_retries:\n                    sleep(backoff_factor * (attempt + 1))  # é€æ­¥å¢åŠ ç­‰å¾…æ—¶é—´ï¼Œé¿å…é¢‘ç¹é‡è¯•\n                    continue\n                else:\n                    logger.error(f\"åœ¨å°è¯•{max_retries}æ¬¡å‘å‡ºPOSTè¿æ¥åï¼Œè¯·æ±‚å¤±è´¥ï¼š{e}\")\n\n    def write_post(self, wrote_count):\n        \"\"\"å°†çˆ¬åˆ°çš„ä¿¡æ¯é€šè¿‡POSTå‘å‡º\"\"\"\n        data = {}\n        data['user'] = self.user\n        weibo_info = self.weibo[wrote_count:]\n        if data.get('weibo'):\n            data['weibo'] += weibo_info\n        else:\n            data['weibo'] = weibo_info\n\n        if data:\n            self.send_post_request_with_token(self.post_config[\"api_url\"], data, self.post_config[\"api_token\"], 3, 2)\n            logger.info(u'%dæ¡å¾®åšé€šè¿‡POSTå‘é€åˆ° %s', len(data['weibo']), self.post_config[\"api_url\"])\n        else:\n            logger.info(u'æ²¡æœ‰è·å–åˆ°å¾®åšï¼Œç•¥è¿‡API POST')\n\n\n    def info_to_mongodb(self, collection, info_list):\n        \"\"\"å°†çˆ¬å–çš„ä¿¡æ¯å†™å…¥MongoDBæ•°æ®åº“\"\"\"\n        try:\n            import pymongo\n        except ImportError:\n            logger.warning(\"ç³»ç»Ÿä¸­å¯èƒ½æ²¡æœ‰å®‰è£…pymongoåº“ï¼Œè¯·å…ˆè¿è¡Œ pip install pymongo ï¼Œå†è¿è¡Œç¨‹åº\")\n            sys.exit()\n        try:\n            from pymongo import MongoClient\n\n            client = MongoClient(self.mongodb_URI)\n            db = client[\"weibo\"]\n            collection = db[collection]\n            if len(self.write_mode) > 1:\n                new_info_list = copy.deepcopy(info_list)\n            else:\n                new_info_list = info_list\n            for info in new_info_list:\n                if not collection.find_one({\"id\": info[\"id\"]}):\n                    collection.insert_one(info)\n                else:\n                    collection.update_one({\"id\": info[\"id\"]}, {\"$set\": info})\n        except pymongo.errors.ServerSelectionTimeoutError:\n            logger.warning(\"ç³»ç»Ÿä¸­å¯èƒ½æ²¡æœ‰å®‰è£…æˆ–å¯åŠ¨MongoDBæ•°æ®åº“ï¼Œè¯·å…ˆæ ¹æ®ç³»ç»Ÿç¯å¢ƒå®‰è£…æˆ–å¯åŠ¨MongoDBï¼Œå†è¿è¡Œç¨‹åº\")\n            sys.exit()\n\n    def weibo_to_mongodb(self, wrote_count):\n        \"\"\"å°†çˆ¬å–çš„å¾®åšä¿¡æ¯å†™å…¥MongoDBæ•°æ®åº“\"\"\"\n        self.info_to_mongodb(\"weibo\", self.weibo[wrote_count:])\n        logger.info(\"%dæ¡å¾®åšå†™å…¥MongoDBæ•°æ®åº“å®Œæ¯•\", self.got_count)\n\n    def mysql_create(self, connection, sql):\n        \"\"\"åˆ›å»ºMySQLæ•°æ®åº“æˆ–è¡¨\"\"\"\n        try:\n            with connection.cursor() as cursor:\n                cursor.execute(sql)\n        finally:\n            connection.close()\n\n    def mysql_create_database(self, mysql_config, sql):\n        \"\"\"åˆ›å»ºMySQLæ•°æ®åº“\"\"\"\n        try:\n            import pymysql\n        except ImportError:\n            logger.warning(\"ç³»ç»Ÿä¸­å¯èƒ½æ²¡æœ‰å®‰è£…pymysqlåº“ï¼Œè¯·å…ˆè¿è¡Œ pip install pymysql ï¼Œå†è¿è¡Œç¨‹åº\")\n            sys.exit()\n        try:\n            if self.mysql_config:\n                mysql_config = self.mysql_config\n            connection = pymysql.connect(**mysql_config)\n            self.mysql_create(connection, sql)\n        except pymysql.OperationalError:\n            logger.warning(\"ç³»ç»Ÿä¸­å¯èƒ½æ²¡æœ‰å®‰è£…æˆ–æ­£ç¡®é…ç½®MySQLæ•°æ®åº“ï¼Œè¯·å…ˆæ ¹æ®ç³»ç»Ÿç¯å¢ƒå®‰è£…æˆ–é…ç½®MySQLï¼Œå†è¿è¡Œç¨‹åº\")\n            sys.exit()\n\n    def mysql_create_table(self, mysql_config, sql):\n        \"\"\"åˆ›å»ºMySQLè¡¨\"\"\"\n        import pymysql\n\n        if self.mysql_config:\n            mysql_config = self.mysql_config\n        mysql_config[\"db\"] = \"weibo\"\n        connection = pymysql.connect(**mysql_config)\n        self.mysql_create(connection, sql)\n\n    def mysql_insert(self, mysql_config, table, data_list):\n        \"\"\"\n        å‘MySQLè¡¨æ’å…¥æˆ–æ›´æ–°æ•°æ®\n\n        Parameters\n        ----------\n        mysql_config: map\n            MySQLé…ç½®è¡¨\n        table: str\n            è¦æ’å…¥çš„è¡¨å\n        data_list: list\n            è¦æ’å…¥çš„æ•°æ®åˆ—è¡¨\n\n        Returns\n        -------\n        bool: SQLæ‰§è¡Œç»“æœ\n        \"\"\"\n        import pymysql\n\n        if len(data_list) > 0:\n            keys = \", \".join(data_list[0].keys())\n            values = \", \".join([\"%s\"] * len(data_list[0]))\n            if self.mysql_config:\n                mysql_config = self.mysql_config\n            mysql_config[\"db\"] = \"weibo\"\n            connection = pymysql.connect(**mysql_config)\n            cursor = connection.cursor()\n            sql = \"\"\"INSERT INTO {table}({keys}) VALUES ({values}) ON\n                     DUPLICATE KEY UPDATE\"\"\".format(\n                table=table, keys=keys, values=values\n            )\n            update = \",\".join(\n                [\" {key} = values({key})\".format(key=key) for key in data_list[0]]\n            )\n            sql += update\n            try:\n                cursor.executemany(sql, [tuple(data.values()) for data in data_list])\n                connection.commit()\n            except Exception as e:\n                connection.rollback()\n                logger.exception(e)\n            finally:\n                connection.close()\n\n    def weibo_to_mysql(self, wrote_count):\n        \"\"\"å°†çˆ¬å–çš„å¾®åšä¿¡æ¯å†™å…¥MySQLæ•°æ®åº“\"\"\"\n        mysql_config = {\n            \"host\": \"localhost\",\n            \"port\": 3306,\n            \"user\": \"root\",\n            \"password\": \"123456\",\n            \"charset\": \"utf8mb4\",\n        }\n        # åˆ›å»º'weibo'è¡¨\n        create_table = \"\"\"\n                CREATE TABLE IF NOT EXISTS weibo (\n                id varchar(20) NOT NULL,\n                bid varchar(12) NOT NULL,\n                user_id varchar(20),\n                screen_name varchar(30),\n                text text,\n                article_url varchar(100),\n                topics varchar(200),\n                at_users varchar(1000),\n                pics varchar(3000),\n                video_url varchar(1000),\n                location varchar(100),\n                created_at DATETIME,\n                source varchar(30),\n                attitudes_count INT,\n                comments_count INT,\n                reposts_count INT,\n                retweet_id varchar(20),\n                PRIMARY KEY (id)\n                ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4\"\"\"\n        self.mysql_create_table(mysql_config, create_table)\n\n        # è¦æ’å…¥çš„å¾®åšåˆ—è¡¨\n        weibo_list = []\n        # è¦æ’å…¥çš„è½¬å‘å¾®åšåˆ—è¡¨\n        retweet_list = []\n        if len(self.write_mode) > 1:\n            info_list = copy.deepcopy(self.weibo[wrote_count:])\n        else:\n            info_list = self.weibo[wrote_count:]\n        for w in info_list:\n            w[\"created_at\"] = w[\"full_created_at\"]\n            del w[\"full_created_at\"]\n\n            if \"retweet\" in w:\n                r = w[\"retweet\"]\n                r[\"retweet_id\"] = \"\"\n                r[\"created_at\"] = r[\"full_created_at\"]\n                del r[\"full_created_at\"]\n                retweet_list.append(r)\n                w[\"retweet_id\"] = r[\"id\"]\n                del w[\"retweet\"]\n            else:\n                w[\"retweet_id\"] = \"\"\n            weibo_list.append(w)\n        # åœ¨'weibo'è¡¨ä¸­æ’å…¥æˆ–æ›´æ–°å¾®åšæ•°æ®\n        self.mysql_insert(mysql_config, \"weibo\", retweet_list)\n        self.mysql_insert(mysql_config, \"weibo\", weibo_list)\n        logger.info(\"%dæ¡å¾®åšå†™å…¥MySQLæ•°æ®åº“å®Œæ¯•\", self.got_count)\n\n    def weibo_to_sqlite(self, wrote_count):\n        con = self.get_sqlite_connection()\n        weibo_list = []\n        retweet_list = []\n        if len(self.write_mode) > 1:\n            info_list = copy.deepcopy(self.weibo[wrote_count:])\n        else:\n            info_list = self.weibo[wrote_count:]\n        for w in info_list:\n            if \"retweet\" in w:\n                w[\"retweet\"][\"retweet_id\"] = \"\"\n                retweet_list.append(w[\"retweet\"])\n                w[\"retweet_id\"] = w[\"retweet\"][\"id\"]\n                del w[\"retweet\"]\n            else:\n                w[\"retweet_id\"] = \"\"\n            weibo_list.append(w)\n\n        comment_max_count = self.comment_max_download_count\n        repost_max_count = self.comment_max_download_count\n        download_comment = self.download_comment and comment_max_count > 0\n        download_repost = self.download_repost and repost_max_count > 0\n\n        count = 0\n        for weibo in weibo_list:\n            self.sqlite_insert_weibo(con, weibo)\n            if (download_comment) and (weibo[\"comments_count\"] > 0):\n                self.get_weibo_comments(\n                    weibo, comment_max_count, self.sqlite_insert_comments\n                )\n                count += 1\n                # ä¸ºé˜²æ­¢è¢«banæŠ“å–ä¸€å®šæ•°é‡çš„è¯„è®ºåéšæœºç¡3åˆ°6ç§’\n                if count % 20:\n                    sleep(random.randint(3, 6))\n            if (download_repost) and (weibo[\"reposts_count\"] > 0):\n                self.get_weibo_reposts(\n                    weibo, repost_max_count, self.sqlite_insert_reposts\n                )\n                count += 1\n                # ä¸ºé˜²æ­¢è¢«banæŠ“å–ä¸€å®šæ•°é‡çš„è½¬å‘åéšæœºç¡3åˆ°6ç§’\n                if count % 20:\n                    sleep(random.randint(3, 6))\n\n        for weibo in retweet_list:\n            self.sqlite_insert_weibo(con, weibo)\n\n        con.close()\n\n    def sqlite_insert_comments(self, weibo, comments):\n        if not comments or len(comments) == 0:\n            return\n        con = self.get_sqlite_connection()\n        for comment in comments:\n            data = self.parse_sqlite_comment(comment, weibo)\n            self.sqlite_insert(con, data, \"comments\")\n\n        con.close()\n\n    def sqlite_insert_reposts(self, weibo, reposts):\n        if not reposts or len(reposts) == 0:\n            return\n        con = self.get_sqlite_connection()\n        for repost in reposts:\n            data = self.parse_sqlite_repost(repost, weibo)\n            self.sqlite_insert(con, data, \"reposts\")\n\n        con.close()\n\n    def parse_sqlite_comment(self, comment, weibo):\n        if not comment:\n            return\n        sqlite_comment = OrderedDict()\n        sqlite_comment[\"id\"] = comment[\"id\"]\n\n        self._try_get_value(\"bid\", \"bid\", sqlite_comment, comment)\n        self._try_get_value(\"root_id\", \"rootid\", sqlite_comment, comment)\n        self._try_get_value(\"created_at\", \"created_at\", sqlite_comment, comment)\n        sqlite_comment[\"weibo_id\"] = weibo[\"id\"]\n\n        sqlite_comment[\"user_id\"] = comment[\"user\"][\"id\"]\n        sqlite_comment[\"user_screen_name\"] = comment[\"user\"][\"screen_name\"]\n        self._try_get_value(\n            \"user_avatar_url\", \"avatar_hd\", sqlite_comment, comment[\"user\"]\n        )\n        if self.remove_html_tag:\n            sqlite_comment[\"text\"] = re.sub('<[^<]+?>', '', comment[\"text\"]).replace('\\n', '').strip()\n        else:\n            sqlite_comment[\"text\"] = comment[\"text\"]\n        \n        sqlite_comment[\"pic_url\"] = \"\"\n        if comment.get(\"pic\"):\n            sqlite_comment[\"pic_url\"] = comment[\"pic\"][\"large\"][\"url\"]\n        self._try_get_value(\"like_count\", \"like_count\", sqlite_comment, comment)\n        return sqlite_comment\n\n    def parse_sqlite_repost(self, repost, weibo):\n        if not repost:\n            return\n        sqlite_repost = OrderedDict()\n        sqlite_repost[\"id\"] = repost[\"id\"]\n\n        self._try_get_value(\"bid\", \"bid\", sqlite_repost, repost)\n        self._try_get_value(\"created_at\", \"created_at\", sqlite_repost, repost)\n        sqlite_repost[\"weibo_id\"] = weibo[\"id\"]\n\n        sqlite_repost[\"user_id\"] = repost[\"user\"][\"id\"]\n        sqlite_repost[\"user_screen_name\"] = repost[\"user\"][\"screen_name\"]\n        self._try_get_value(\n            \"user_avatar_url\", \"profile_image_url\", sqlite_repost, repost[\"user\"]\n        )\n        text = repost.get(\"raw_text\")\n        if text:\n            text = text.split(\"//\", 1)[0]\n        if text is None or text == \"\" or text == \"Repost\":\n            text = \"è½¬å‘å¾®åš\"\n        sqlite_repost[\"text\"] = text\n        self._try_get_value(\"like_count\", \"attitudes_count\", sqlite_repost, repost)\n        return sqlite_repost\n\n    def _try_get_value(self, source_name, target_name, dict, json):\n        dict[source_name] = \"\"\n        value = json.get(target_name)\n        if value:\n            dict[source_name] = value\n\n    def sqlite_insert_weibo(self, con: sqlite3.Connection, weibo: dict):\n        sqlite_weibo = self.parse_sqlite_weibo(weibo)\n        self.sqlite_insert(con, sqlite_weibo, \"weibo\")\n\n    def parse_sqlite_weibo(self, weibo):\n        if not weibo:\n            return\n        sqlite_weibo = OrderedDict()\n        sqlite_weibo[\"user_id\"] = weibo[\"user_id\"]\n        sqlite_weibo[\"id\"] = weibo[\"id\"]\n        sqlite_weibo[\"bid\"] = weibo[\"bid\"]\n        sqlite_weibo[\"screen_name\"] = weibo[\"screen_name\"]\n        sqlite_weibo[\"text\"] = weibo[\"text\"]\n        sqlite_weibo[\"article_url\"] = weibo[\"article_url\"]\n        sqlite_weibo[\"topics\"] = weibo[\"topics\"]\n        sqlite_weibo[\"pics\"] = weibo[\"pics\"]\n        sqlite_weibo[\"video_url\"] = weibo[\"video_url\"]\n        sqlite_weibo[\"location\"] = weibo[\"location\"]\n        sqlite_weibo[\"created_at\"] = weibo[\"full_created_at\"]\n        sqlite_weibo[\"source\"] = weibo[\"source\"]\n        sqlite_weibo[\"attitudes_count\"] = weibo[\"attitudes_count\"]\n        sqlite_weibo[\"comments_count\"] = weibo[\"comments_count\"]\n        sqlite_weibo[\"reposts_count\"] = weibo[\"reposts_count\"]\n        sqlite_weibo[\"retweet_id\"] = weibo[\"retweet_id\"]\n        sqlite_weibo[\"at_users\"] = weibo[\"at_users\"]\n        return sqlite_weibo\n\n    def user_to_sqlite(self):\n        con = self.get_sqlite_connection()\n        self.sqlite_insert_user(con, self.user)\n        con.close()\n\n    def sqlite_insert_user(self, con: sqlite3.Connection, user: dict):\n        sqlite_user = self.parse_sqlite_user(user)\n        self.sqlite_insert(con, sqlite_user, \"user\")\n\n    def parse_sqlite_user(self, user):\n        if not user:\n            return\n        sqlite_user = OrderedDict()\n        sqlite_user[\"id\"] = user[\"id\"]\n        sqlite_user[\"nick_name\"] = user[\"screen_name\"]\n        sqlite_user[\"gender\"] = user[\"gender\"]\n        sqlite_user[\"follower_count\"] = user[\"followers_count\"]\n        sqlite_user[\"follow_count\"] = user[\"follow_count\"]\n        sqlite_user[\"birthday\"] = user[\"birthday\"]\n        sqlite_user[\"location\"] = user[\"location\"]\n        sqlite_user[\"edu\"] = user[\"education\"]\n        sqlite_user[\"company\"] = user[\"company\"]\n        sqlite_user[\"reg_date\"] = user[\"registration_time\"]\n        sqlite_user[\"main_page_url\"] = user[\"profile_url\"]\n        sqlite_user[\"avatar_url\"] = user[\"avatar_hd\"]\n        sqlite_user[\"bio\"] = user[\"description\"]\n        return sqlite_user\n\n    def sqlite_insert(self, con: sqlite3.Connection, data: dict, table: str):\n        if not data:\n            return\n        cur = con.cursor()\n        keys = \",\".join(data.keys())\n        values = \",\".join([\"?\"] * len(data))\n        sql = \"\"\"INSERT OR REPLACE INTO {table}({keys}) VALUES({values})\n                \"\"\".format(\n            table=table, keys=keys, values=values\n        )\n        cur.execute(sql, list(data.values()))\n        con.commit()\n\n    def get_sqlite_connection(self):\n        path = self.get_sqlte_path()\n        create = False\n        if not os.path.exists(path):\n            create = True\n\n        con = sqlite3.connect(path)\n\n        if create == True:\n            self.create_sqlite_table(connection=con)\n\n        return con\n\n    def create_sqlite_table(self, connection: sqlite3.Connection):\n        sql = self.get_sqlite_create_sql()\n        cur = connection.cursor()\n        cur.executescript(sql)\n        connection.commit()\n\n    def get_sqlte_path(self):\n        return \"./weibo/weibodata.db\"\n\n    def get_sqlite_create_sql(self):\n        create_sql = \"\"\"\n                CREATE TABLE IF NOT EXISTS user (\n                    id varchar(64) NOT NULL\n                    ,nick_name varchar(64) NOT NULL\n                    ,gender varchar(6)\n                    ,follower_count integer\n                    ,follow_count integer\n                    ,birthday varchar(10)\n                    ,location varchar(32)\n                    ,edu varchar(32)\n                    ,company varchar(32)\n                    ,reg_date DATETIME\n                    ,main_page_url text\n                    ,avatar_url text\n                    ,bio text\n                    ,PRIMARY KEY (id)\n                );\n\n                CREATE TABLE IF NOT EXISTS weibo (\n                    id varchar(20) NOT NULL\n                    ,bid varchar(12) NOT NULL\n                    ,user_id varchar(20)\n                    ,screen_name varchar(30)\n                    ,text varchar(2000)\n                    ,article_url varchar(100)\n                    ,topics varchar(200)\n                    ,at_users varchar(1000)\n                    ,pics varchar(3000)\n                    ,video_url varchar(1000)\n                    ,location varchar(100)\n                    ,created_at DATETIME\n                    ,source varchar(30)\n                    ,attitudes_count INT\n                    ,comments_count INT\n                    ,reposts_count INT\n                    ,retweet_id varchar(20)\n                    ,PRIMARY KEY (id)\n                );\n\n                CREATE TABLE IF NOT EXISTS bins (\n                    id integer PRIMARY KEY AUTOINCREMENT\n                    ,ext varchar(10) NOT NULL /*file extension*/\n                    ,data blob NOT NULL\n                    ,weibo_id varchar(20)\n                    ,comment_id varchar(20)\n                    ,path text\n                    ,url text\n                );\n\n                CREATE TABLE IF NOT EXISTS comments (\n                    id varchar(20) NOT NULL\n                    ,bid varchar(20) NOT NULL\n                    ,weibo_id varchar(32) NOT NULL\n                    ,root_id varchar(20) \n                    ,user_id varchar(20) NOT NULL\n                    ,created_at varchar(20)\n                    ,user_screen_name varchar(64) NOT NULL\n                    ,user_avatar_url text\n                    ,text varchar(1000)\n                    ,pic_url text\n                    ,like_count integer\n                    ,PRIMARY KEY (id)\n                );\n\n                CREATE TABLE IF NOT EXISTS reposts (\n                    id varchar(20) NOT NULL\n                    ,bid varchar(20) NOT NULL\n                    ,weibo_id varchar(32) NOT NULL\n                    ,user_id varchar(20) NOT NULL\n                    ,created_at varchar(20)\n                    ,user_screen_name varchar(64) NOT NULL\n                    ,user_avatar_url text\n                    ,text varchar(1000)\n                    ,like_count integer\n                    ,PRIMARY KEY (id)\n                );\n                \"\"\"\n        return create_sql\n\n    def update_user_config_file(self, user_config_file_path):\n        \"\"\"æ›´æ–°ç”¨æˆ·é…ç½®æ–‡ä»¶\"\"\"\n        with open(user_config_file_path, \"rb\") as f:\n            try:\n                lines = f.read().splitlines()\n                lines = [line.decode(\"utf-8-sig\") for line in lines]\n            except UnicodeDecodeError:\n                logger.error(\"%sæ–‡ä»¶åº”ä¸ºutf-8ç¼–ç ï¼Œè¯·å…ˆå°†æ–‡ä»¶ç¼–ç è½¬ä¸ºutf-8å†è¿è¡Œç¨‹åº\", user_config_file_path)\n                sys.exit()\n            for i, line in enumerate(lines):\n                info = line.split(\" \")\n                if len(info) > 0 and info[0].isdigit():\n                    if self.user_config[\"user_id\"] == info[0]:\n                        if len(info) == 1:\n                            info.append(self.user[\"screen_name\"])\n                            info.append(self.start_date)\n                        if len(info) == 2:\n                            info.append(self.start_date)\n                        if len(info) > 2:\n                            info[2] = self.start_date\n                        lines[i] = \" \".join(info)\n                        break\n        with codecs.open(user_config_file_path, \"w\", encoding=\"utf-8\") as f:\n            f.write(\"\\n\".join(lines))\n\n    def write_data(self, wrote_count):\n        \"\"\"å°†çˆ¬åˆ°çš„ä¿¡æ¯å†™å…¥æ–‡ä»¶æˆ–æ•°æ®åº“\"\"\"\n        if self.got_count > wrote_count:\n            if \"csv\" in self.write_mode:\n                self.write_csv(wrote_count)\n            if \"json\" in self.write_mode:\n                self.write_json(wrote_count)\n            if \"post\" in self.write_mode:\n                self.write_post(wrote_count)\n            if \"mysql\" in self.write_mode:\n                self.weibo_to_mysql(wrote_count)\n            if \"mongo\" in self.write_mode:\n                self.weibo_to_mongodb(wrote_count)\n            if \"sqlite\" in self.write_mode:\n                self.weibo_to_sqlite(wrote_count)\n            if self.original_pic_download:\n                self.download_files(\"img\", \"original\", wrote_count)\n            if self.original_video_download:\n                self.download_files(\"video\", \"original\", wrote_count)\n            if not self.only_crawl_original:\n                if self.retweet_pic_download:\n                    self.download_files(\"img\", \"retweet\", wrote_count)\n                if self.retweet_video_download:\n                    self.download_files(\"video\", \"retweet\", wrote_count)\n\n    def get_pages(self):\n        \"\"\"è·å–å…¨éƒ¨å¾®åš\"\"\"\n        try:\n            # ç”¨æˆ·idä¸å¯ç”¨\n            if self.get_user_info() != 0:\n                return\n            logger.info(\"å‡†å¤‡æœé›† {} çš„å¾®åš\".format(self.user[\"screen_name\"]))\n            if const.MODE == \"append\" and (\n                \"first_crawler\" not in self.__dict__ or self.first_crawler is False\n            ):\n                # æœ¬æ¬¡è¿è¡Œçš„æŸç”¨æˆ·é¦–æ¬¡æŠ“å–ï¼Œç”¨äºæ ‡è®°æœ€æ–°çš„å¾®åšid\n                self.first_crawler = True\n                const.CHECK_COOKIE[\"GUESS_PIN\"] = True\n            since_date = datetime.strptime(self.user_config[\"since_date\"], DTFORMAT)\n            today = datetime.today()\n            if since_date <= today:    # since_date è‹¥ä¸ºæœªæ¥åˆ™æ— éœ€æ‰§è¡Œ\n                page_count = self.get_page_count()\n                wrote_count = 0\n                page1 = 0\n                random_pages = random.randint(1, 5)\n                self.start_date = datetime.now().strftime(DTFORMAT)\n                pages = range(self.start_page, page_count + 1)\n                for page in tqdm(pages, desc=\"Progress\"):\n                    is_end = self.get_one_page(page)\n                    if is_end:\n                        break\n\n                    if page % 20 == 0:  # æ¯çˆ¬20é¡µå†™å…¥ä¸€æ¬¡æ–‡ä»¶\n                        self.write_data(wrote_count)\n                        wrote_count = self.got_count\n\n                    # é€šè¿‡åŠ å…¥éšæœºç­‰å¾…é¿å…è¢«é™åˆ¶ã€‚çˆ¬è™«é€Ÿåº¦è¿‡å¿«å®¹æ˜“è¢«ç³»ç»Ÿé™åˆ¶(ä¸€æ®µæ—¶é—´åé™\n                    # åˆ¶ä¼šè‡ªåŠ¨è§£é™¤)ï¼ŒåŠ å…¥éšæœºç­‰å¾…æ¨¡æ‹Ÿäººçš„æ“ä½œï¼Œå¯é™ä½è¢«ç³»ç»Ÿé™åˆ¶çš„é£é™©ã€‚é»˜\n                    # è®¤æ˜¯æ¯çˆ¬å–1åˆ°5é¡µéšæœºç­‰å¾…6åˆ°10ç§’ï¼Œå¦‚æœä»ç„¶è¢«é™ï¼Œå¯é€‚å½“å¢åŠ sleepæ—¶é—´\n                    if (page - page1) % random_pages == 0 and page < page_count:\n                        sleep(random.randint(6, 10))\n                        page1 = page\n                        random_pages = random.randint(1, 5)\n\n                self.write_data(wrote_count)  # å°†å‰©ä½™ä¸è¶³20é¡µçš„å¾®åšå†™å…¥æ–‡ä»¶\n            logger.info(\"å¾®åšçˆ¬å–å®Œæˆï¼Œå…±çˆ¬å–%dæ¡å¾®åš\", self.got_count)\n        except Exception as e:\n            logger.exception(e)\n\n    def get_user_config_list(self, file_path):\n        \"\"\"è·å–æ–‡ä»¶ä¸­çš„å¾®åšidä¿¡æ¯\"\"\"\n        with open(file_path, \"rb\") as f:\n            try:\n                lines = f.read().splitlines() \n                lines = [line.decode(\"utf-8-sig\") for line in lines]\n            except UnicodeDecodeError:\n                logger.error(\"%sæ–‡ä»¶åº”ä¸ºutf-8ç¼–ç ï¼Œè¯·å…ˆå°†æ–‡ä»¶ç¼–ç è½¬ä¸ºutf-8å†è¿è¡Œç¨‹åº\", file_path)\n                sys.exit()\n            user_config_list = []\n            # åˆ†è¡Œè§£æé…ç½®ï¼Œæ·»åŠ åˆ°user_config_list\n            for line in lines:\n                info = line.strip().split(\" \")    # å»é™¤å­—ç¬¦ä¸²é¦–å°¾ç©ºç™½å­—ç¬¦\n                if len(info) > 0 and info[0].isdigit():\n                    user_config = {}\n                    user_config[\"user_id\"] = info[0]\n                    # æ ¹æ®é…ç½®æ–‡ä»¶è¡Œçš„å­—æ®µæ•°ç¡®å®š since_date çš„å€¼\n                    if len(info) == 3:\n                        if self.is_datetime(info[2]):\n                            user_config[\"since_date\"] = info[2]\n                        elif self.is_date(info[2]):\n                            user_config[\"since_date\"] = \"{}T00:00:00\".format(info[2])\n                        elif info[2].isdigit():\n                            since_date = date.today() - timedelta(int(info[2]))\n                            user_config[\"since_date\"] = since_date.strftime(DTFORMAT)\n                        else:\n                            logger.error(\"since_date æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ç¡®è®¤é…ç½®æ˜¯å¦æ­£ç¡®\")\n                            sys.exit()\n                    else:\n                        user_config[\"since_date\"] = self.since_date\n                    # è‹¥è¶…è¿‡3ä¸ªå­—æ®µï¼Œåˆ™ç¬¬å››ä¸ªå­—æ®µä¸º query_list                    \n                    if len(info) > 3:\n                        user_config[\"query_list\"] = info[3].split(\",\")\n                    else:\n                        user_config[\"query_list\"] = self.query_list\n                    if user_config not in user_config_list:\n                        user_config_list.append(user_config)\n        return user_config_list\n\n    def initialize_info(self, user_config):\n        \"\"\"åˆå§‹åŒ–çˆ¬è™«ä¿¡æ¯\"\"\"\n        self.weibo = []\n        self.user = {}\n        self.user_config = user_config\n        self.got_count = 0\n        self.weibo_id_list = []\n\n    def start(self):\n        \"\"\"è¿è¡Œçˆ¬è™«\"\"\"\n        try:\n            for user_config in self.user_config_list:\n                if len(user_config[\"query_list\"]):\n                    for query in user_config[\"query_list\"]:\n                        self.query = query\n                        self.initialize_info(user_config)\n                        self.get_pages()\n                else:\n                    self.initialize_info(user_config)\n                    self.get_pages()\n                logger.info(\"ä¿¡æ¯æŠ“å–å®Œæ¯•\")\n                logger.info(\"*\" * 100)\n                if self.user_config_file_path and self.user:\n                    self.update_user_config_file(self.user_config_file_path)\n        except Exception as e:\n            logger.exception(e)\n\n\ndef handle_config_renaming(config, oldName, newName):\n    if oldName in config and newName not in config:\n        config[newName] = config[oldName]\n        del config[oldName]\n\ndef get_config():\n    \"\"\"è·å–config.jsonæ–‡ä»¶ä¿¡æ¯\"\"\"\n    config_path = os.path.split(os.path.realpath(__file__))[0] + os.sep + \"config.json\"\n    if not os.path.isfile(config_path):\n        logger.warning(\n            \"å½“å‰è·¯å¾„ï¼š%s ä¸å­˜åœ¨é…ç½®æ–‡ä»¶config.json\",\n            (os.path.split(os.path.realpath(__file__))[0] + os.sep),\n        )\n        sys.exit()\n    try:\n        with open(config_path, encoding=\"utf-8\") as f:\n            config = json.loads(f.read())\n            # é‡å‘½åä¸€äº›key, ä½†å‘å‰å…¼å®¹\n            handle_config_renaming(config, oldName=\"filter\", newName=\"only_crawl_original\")\n            handle_config_renaming(config, oldName=\"result_dir_name\", newName=\"user_id_as_folder_name\")\n            return config\n    except ValueError:\n        logger.error(\n            \"config.json æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·å‚è€ƒ \" \"https://github.com/dataabc/weibo-crawler#3ç¨‹åºè®¾ç½®\"\n        )\n        sys.exit()\n\n\ndef main():\n    try:\n        config = get_config()\n        wb = Weibo(config)\n        wb.start()  # çˆ¬å–å¾®åšä¿¡æ¯\n        if const.NOTIFY[\"NOTIFY\"]:\n            push_deer(\"æ›´æ–°äº†ä¸€æ¬¡å¾®åš\")\n    except Exception as e:\n        if const.NOTIFY[\"NOTIFY\"]:\n            push_deer(\"weibo-crawlerè¿è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¸º{}\".format(e))\n        logger.exception(e)\n\n\nif __name__ == \"__main__\":\n    main()\n"
        }
      ]
    }
  ]
}