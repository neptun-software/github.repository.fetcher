{
  "metadata": {
    "timestamp": 1736559668694,
    "page": 336,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjM0MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "zas023/JdBuyer",
      "stars": 4181,
      "defaultBranch": "main",
      "files": [
        {
          "name": "JdBuyer.py",
          "type": "blob",
          "size": 3.6591796875,
          "content": "# -*- coding: utf-8 -*-\nimport time\n\nfrom config import global_config\nfrom log import logger\nfrom exception import JDException\nfrom JdSession import Session\nfrom timer import Timer\nfrom utils import (\n    save_image,\n    open_image,\n    send_wechat\n)\n\n\nclass Buyer(object):\n    \"\"\"\n    äº¬ä¸œä¹°æ‰‹\n    \"\"\"\n\n    # åˆå§‹åŒ–\n    def __init__(self):\n        self.session = Session()\n        # å¾®ä¿¡æ¨é€\n        self.enableWx = global_config.getboolean('messenger', 'enable')\n        self.scKey = global_config.get('messenger', 'sckey')\n\n    ############## ç™»å½•ç›¸å…³ #############\n    # äºŒç»´ç ç™»å½•\n    def loginByQrCode(self):\n        if self.session.isLogin:\n            logger.info('ç™»å½•æˆåŠŸ')\n            return\n\n        # download QR code\n        qrCode = self.session.getQRcode()\n        if not qrCode:\n            raise JDException('äºŒç»´ç ä¸‹è½½å¤±è´¥')\n\n        fileName = 'QRcode.png'\n        save_image(qrCode, fileName)\n        logger.info('äºŒç»´ç è·å–æˆåŠŸï¼Œè¯·æ‰“å¼€äº¬ä¸œAPPæ‰«æ')\n        open_image(fileName)\n\n        # get QR code ticket\n        ticket = None\n        retryTimes = 85\n        for i in range(retryTimes):\n            ticket = self.session.getQRcodeTicket()\n            if ticket:\n                break\n            time.sleep(2)\n        else:\n            raise JDException('äºŒç»´ç è¿‡æœŸï¼Œè¯·é‡æ–°è·å–æ‰«æ')\n\n        # validate QR code ticket\n        if not self.session.validateQRcodeTicket(ticket):\n            raise JDException('äºŒç»´ç ä¿¡æ¯æ ¡éªŒå¤±è´¥')\n\n        logger.info('äºŒç»´ç ç™»å½•æˆåŠŸ')\n        self.session.isLogin = True\n        self.session.saveCookies()\n\n    ############## å¤–éƒ¨æ–¹æ³• #############\n    def buyItemInStock(self, skuId, areaId, skuNum=1, stockInterval=3, submitRetry=3, submitInterval=5, buyTime='2022-08-06 00:00:00'):\n        \"\"\"æ ¹æ®åº“å­˜è‡ªåŠ¨ä¸‹å•å•†å“\n        :skuId å•†å“sku\n        :areaId ä¸‹å•åŒºåŸŸid\n        :skuNum è´­ä¹°æ•°é‡\n        :stockInterval åº“å­˜æŸ¥è¯¢é—´éš”ï¼ˆå•ä½ç§’ï¼‰\n        :submitRetry ä¸‹å•å°è¯•æ¬¡æ•°\n        :submitInterval ä¸‹å•å°è¯•é—´éš”ï¼ˆå•ä½ç§’ï¼‰\n        :buyTime å®šæ—¶æ‰§è¡Œ\n        \"\"\"\n        self.session.fetchItemDetail(skuId)\n        timer = Timer(buyTime)\n        timer.start()\n\n        while True:\n            try:\n                if not self.session.getItemStock(skuId, skuNum, areaId):\n                    logger.info('ä¸æ»¡è¶³ä¸‹å•æ¡ä»¶ï¼Œ{0}såè¿›è¡Œä¸‹ä¸€æ¬¡æŸ¥è¯¢'.format(stockInterval))\n                else:\n                    logger.info('{0} æ»¡è¶³ä¸‹å•æ¡ä»¶ï¼Œå¼€å§‹æ‰§è¡Œ'.format(skuId))\n                    if self.session.trySubmitOrder(skuId, skuNum, areaId, submitRetry, submitInterval):\n                        logger.info('ä¸‹å•æˆåŠŸ')\n                        if self.enableWx:\n                            send_wechat(\n                                message='JdBuyerApp', desp='æ‚¨çš„å•†å“å·²ä¸‹å•æˆåŠŸï¼Œè¯·åŠæ—¶æ”¯ä»˜è®¢å•', sckey=self.scKey)\n                        return\n            except Exception as e:\n                logger.error(e)\n            time.sleep(stockInterval)\n\n\nif __name__ == '__main__':\n\n    # å•†å“sku\n    skuId = '100015253059'\n    # åŒºåŸŸid(å¯æ ¹æ®å·¥ç¨‹ area_id ç›®å½•æŸ¥æ‰¾)\n    areaId = '1_2901_55554_0'\n    # è´­ä¹°æ•°é‡\n    skuNum = 1\n    # åº“å­˜æŸ¥è¯¢é—´éš”(ç§’)\n    stockInterval = 3\n    # ç›‘å¬åº“å­˜åå°è¯•ä¸‹å•æ¬¡æ•°\n    submitRetry = 3\n    # ä¸‹å•å°è¯•é—´éš”(ç§’)\n    submitInterval = 5\n    # ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶é—´(æ™šäºå½“å‰æ—¶é—´ç«‹å³æ‰§è¡Œï¼Œé€‚ç”¨äºå®šæ—¶æŠ¢è´­ç±»)\n    buyTime = '2022-10-10 00:00:00'\n\n    buyer = Buyer()  # åˆå§‹åŒ–\n    buyer.loginByQrCode()\n    buyer.buyItemInStock(skuId, areaId, skuNum, stockInterval,\n                         submitRetry, submitInterval, buyTime)\n"
        },
        {
          "name": "JdBuyerApp.py",
          "type": "blob",
          "size": 10.2255859375,
          "content": "# -*- coding:utf-8 -*-\nimport sys\nimport os\nimport time\nimport json\n\nfrom PySide6.QtCore import Qt, QThread, Signal, QDateTime\nfrom PySide6.QtGui import QImage, QPixmap\nfrom PySide6.QtWidgets import (\n    QWidget,\n    QApplication,\n    QLabel,\n    QLineEdit,\n    QSlider,\n    QPushButton,\n    QGridLayout,\n    QDateTimeEdit\n)\n\nfrom timer import Timer\nfrom JdSession import Session\n\nNUM_LABEL_FORMAT = 'å•†å“è´­ä¹°æ•°é‡[{0}]ä¸ª'\nSTOCK_LABEL_FORMAT = 'åº“å­˜æŸ¥è¯¢é—´éš”[{0}]ç§’'\nDATA_FORMAT = '%H:%M:%S'\n\nif getattr(sys, 'frozen', False):\n    absPath = os.path.dirname(os.path.abspath(sys.executable))\nelif __file__:\n    absPath = os.path.dirname(os.path.abspath(__file__))\n\n\nclass JdBuyerUI(QWidget):\n\n    def __init__(self):\n        super().__init__()\n        self.session = Session()\n        self.ticketThread = TicketThread(self.session)\n        self.ticketThread.ticketSignal.connect(self.ticketSignal)\n        self.initUI()\n        self.loadData()\n\n    def loadData(self):\n        with open(os.path.join(absPath, 'config.json'), \"rb\") as f:\n            self.config = json.load(f)\n        self.skuEdit.setText(self.config.get('skuId'))\n        self.areaEdit.setText(self.config.get('areaId'))\n        self.passwordEdit.setText(self.config.get('password'))\n        self.numSlider.setValue(self.config.get('count'))\n        self.stockSlider.setValue(self.config.get('stockInterval'))\n        self.numLabel.setText(\n            NUM_LABEL_FORMAT.format(self.config.get('count')))\n        self.stockLabel.setText(STOCK_LABEL_FORMAT.format(\n            self.config.get('stockInterval')))\n\n    def saveData(self):\n        with open(os.path.join(absPath, 'config.json'), 'w', encoding='utf-8') as f:\n            # json.dump(my_list,f)\n            # ç›´æ¥æ˜¾ç¤ºä¸­æ–‡,ä¸ä»¥ASCIIçš„æ–¹å¼æ˜¾ç¤º\n            # json.dump(my_list,f,ensure_ascii=False)\n            # æ˜¾ç¤ºç¼©è¿›\n            json.dump(self.config, f, ensure_ascii=False, indent=2)\n\n    def initUI(self):\n        grid = QGridLayout()\n        grid.setSpacing(10)\n\n        # å•†å“SKU\n        skuLabel = QLabel('å•†å“SKU')\n        self.skuEdit = QLineEdit()\n        grid.addWidget(skuLabel, 1, 0)\n        grid.addWidget(self.skuEdit, 1, 1)\n\n        # åŒºåŸŸID\n        areaLabel = QLabel('åœ°åŒºID')\n        self.areaEdit = QLineEdit()\n        grid.addWidget(areaLabel, 2, 0)\n        grid.addWidget(self.areaEdit, 2, 1)\n\n        # è´­ä¹°æ•°é‡\n        self.numLabel = QLabel(NUM_LABEL_FORMAT.format(1))\n        self.numSlider = QSlider(Qt.Orientation.Horizontal, self)\n        self.numSlider.setTickPosition(QSlider.TicksBelow)\n        self.numSlider.setMinimum(1)\n        self.numSlider.setMaximum(9)\n        self.numSlider.valueChanged.connect(self.valuechange)\n        grid.addWidget(self.numLabel, 1, 3)\n        grid.addWidget(self.numSlider, 1, 4)\n\n        # å•†å“æŸ¥è¯¢é—´éš”\n        self.stockLabel = QLabel(STOCK_LABEL_FORMAT.format(3))\n        self.stockSlider = QSlider(Qt.Orientation.Horizontal, self)\n        self.stockSlider.setTickPosition(QSlider.TicksBelow)\n        self.stockSlider.setMinimum(1)\n        self.stockSlider.setMaximum(9)\n        self.stockSlider.valueChanged.connect(self.stockValuechange)\n        grid.addWidget(self.stockLabel, 2, 3)\n        grid.addWidget(self.stockSlider, 2, 4)\n\n        # æ”¯ä»˜å¯†ç \n        passwordLabel = QLabel('æ”¯ä»˜å¯†ç ')\n        self.passwordEdit = QLineEdit()\n        self.passwordEdit.setEchoMode(QLineEdit.Password)\n        self.passwordEdit.setPlaceholderText('ä½¿ç”¨è™šæ‹Ÿèµ„äº§æ—¶å¡«å†™')\n        self.passwordEdit.textChanged[str].connect(self.textChanged)\n        grid.addWidget(passwordLabel, 3, 0)\n        grid.addWidget(self.passwordEdit, 3, 1)\n\n        # å¼€å§‹æ—¶é—´\n        buyTimeLabel = QLabel('å®šæ—¶å¼€å§‹æ‰§è¡Œæ—¶é—´')\n        self.buyTimeEdit = QDateTimeEdit(QDateTime.currentDateTime(), self)\n        self.buyTimeEdit.setDisplayFormat(\"yyyy-MM-dd HH:mm:ss\")\n        grid.addWidget(buyTimeLabel, 3, 3)\n        grid.addWidget(self.buyTimeEdit, 3, 4)\n\n        # äºŒç»´ç \n        self.qrLabel = QLabel()\n        grid.addWidget(self.qrLabel, 4, 0, 1, 2)\n        self.qrLabel.hide()\n\n        # æ§åˆ¶æŒ‰é’®\n        self.endButton = QPushButton(\"ç»“æŸ\")\n        self.endButton.clicked[bool].connect(self.onClick)\n        self.startButton = QPushButton(\"å¼€å§‹\")\n        self.startButton.clicked[bool].connect(self.onClick)\n        grid.addWidget(self.endButton, 5, 0, 1, 2)\n        grid.addWidget(self.startButton, 5, 3, 1, 2)\n\n        self.endButton.setDisabled(True)\n\n        # ä¿¡æ¯å±•ç¤º\n        self.infoLabel = QLabel()\n        self.infoLabel.setText(\"å½“å‰ç™»å½•çŠ¶æ€æ˜¯: {0}\".format(\n            'å·²ç™»å½•' if self.session.isLogin else 'æœªç™»å½•'))\n        grid.addWidget(self.infoLabel, 6, 0, 2, 4)\n\n        self.setLayout(grid)\n\n        # self.setGeometry(300, 300, 350, 300)\n        self.setWindowTitle('äº¬ä¸œå°çŒªæ‰‹')\n        self.show()\n\n    # å¼€å¯ä¸‹å•ä»»åŠ¡\n    def startTask(self):\n        if not self.session.isLogin:\n            self.qrLogin()\n            self.infoLabel.setText('è¯·ä½¿ç”¨äº¬ä¸œæ‰«ç ç™»å½•')\n            return\n        self.config['buyTime'] = self.buyTimeEdit.text()\n        self.config['skuId'] = self.skuEdit.text()\n        self.config['areaId'] = self.areaEdit.text()\n        self.saveData()\n        self.buyerThread = BuyerThread(self.session, self.config)\n        self.buyerThread.infoSignal.connect(self.infoSignal)\n        self.buyerThread.start()\n\n    # æ‰«ç ç™»å½•\n    def qrLogin(self):\n        res = self.session.getQRcode()\n        img = QImage.fromData(res)\n        self.qrLabel.setPixmap(QPixmap.fromImage(img))\n        self.qrLabel.show()\n        self.ticketThread.start()\n\n    # å¼‚æ­¥çº¿ç¨‹ä¿¡å·\n    def ticketSignal(self, sec):\n        self.qrLabel.hide()\n        if sec == 'æˆåŠŸ':\n            self.startTask()\n        else:\n            # å¤±è´¥\n            self.infoLabel.setText(sec)\n            self.resumeSatrtBtn()\n\n    def infoSignal(self, sec):\n        self.qrLabel.hide()\n        self.infoLabel.setText(sec)\n\n    # æŒ‰é’®ç›‘å¬\n    def onClick(self, pressed):\n        source = self.sender()\n        if source.text() == 'å¼€å§‹':\n            self.startTask()\n            self.disableStartBtn()\n        if source.text() == 'ç»“æŸ':\n            self.handleStopBrn()\n\n    def handleStopBrn(self):\n        if self.session.isLogin:\n            self.buyerThread.pause()\n        else:\n            self.ticketThread.pause()\n        self.resumeSatrtBtn()\n\n    def disableStartBtn(self):\n        self.endButton.setDisabled(False)\n        self.startButton.setDisabled(True)\n\n    def resumeSatrtBtn(self):\n        self.endButton.setDisabled(True)\n        self.startButton.setDisabled(False)\n\n    # è¾“å…¥æ¡†ç›‘å¬\n    def textChanged(self, text):\n        password = self.passwordEdit.text()\n        self.config['password'] = password\n        self.session.password = password\n\n    # æ»‘å—ç›‘æ§\n    def valuechange(self):\n        num = self.numSlider.value()\n        self.config['count'] = num\n        self.numLabel.setText(NUM_LABEL_FORMAT.format(num))\n\n    def stockValuechange(self):\n        stock = self.stockSlider.value()\n        self.config['stockInterval'] = stock\n        self.stockLabel.setText(STOCK_LABEL_FORMAT.format(stock))\n\n# ç™»å½•ç›‘æ§çº¿ç¨‹\n\n\nclass TicketThread(QThread):\n    \"\"\" check ticket\n    \"\"\"\n    ticketSignal = Signal(str)\n\n    def __init__(self, session):\n        super().__init__()\n        self.session = session\n        self._isPause = False\n\n    def pause(self):\n        self._isPause = True\n\n    def run(self):\n        self._isPause = False\n        ticket = None\n        retry_times = 85\n        for i in range(retry_times):\n            if self._isPause:\n                self.ticketSignal.emit('å·²å–æ¶ˆç™»å½•')\n                return\n            ticket = self.session.getQRcodeTicket()\n            if ticket:\n                break\n            time.sleep(2)\n        else:\n            self.ticketSignal.emit('äºŒç»´ç è¿‡æœŸï¼Œè¯·é‡æ–°è·å–æ‰«æ')\n            return\n\n        # validate QR code ticket\n        if not self.session.validateQRcodeTicket(ticket):\n            self.ticketSignal.emit('äºŒç»´ç ä¿¡æ¯æ ¡éªŒå¤±è´¥')\n            return\n\n        self.ticketSignal.emit('æˆåŠŸ')\n        self.session.isLogin = True\n        self.session.saveCookies()\n\n# å•†å“ç›‘æ§çº¿ç¨‹\n\n\nclass BuyerThread(QThread):\n\n    infoSignal = Signal(str)\n\n    def __init__(self, session, taskParam):\n        super().__init__()\n        self.session = session\n        self.taskParam = taskParam\n        self._isPause = False\n\n    def pause(self):\n        self._isPause = True\n\n    def run(self):\n        sku_id = self.taskParam.get('skuId')\n        area_id = self.taskParam.get('areaId')\n        count = self.taskParam.get('count')\n        stock_interval = self.taskParam.get('stockInterval')\n        buyTime = self.taskParam.get('buyTime')\n\n        self.session.fetchItemDetail(sku_id)\n        submitRetry = 3\n        submitInterval = 5\n\n        timer = Timer(buyTime)\n        self.infoSignal.emit('å®šæ—¶ä¸­ï¼Œå°†äº {0} å¼€å§‹æ‰§è¡Œ'.format(buyTime))\n        timer.start()\n\n        while True:\n            if self._isPause:\n                self.infoSignal.emit('{0} å·²å–æ¶ˆä¸‹å•'.format(\n                    time.strftime(DATA_FORMAT, time.localtime())))\n                return\n            try:\n                if not self.session.getItemStock(skuId=sku_id, num=1, areaId=area_id):\n                    self.infoSignal.emit('{0} ä¸æ»¡è¶³ä¸‹å•æ¡ä»¶ï¼Œ{1}såè¿›è¡Œä¸‹ä¸€æ¬¡æŸ¥è¯¢'.format(\n                        time.strftime(DATA_FORMAT, time.localtime()), stock_interval))\n                else:\n                    self.infoSignal.emit('{0} æ»¡è¶³ä¸‹å•æ¡ä»¶ï¼Œå¼€å§‹æ‰§è¡Œ'.format(sku_id))\n                    if not self.session.prepareCart(sku_id, count, area_id):\n                        self.infoSignal.emit('{0} åŠ å…¥è´­ç‰©è½¦å¤±è´¥ï¼Œ{1}såè¿›è¡Œä¸‹ä¸€æ¬¡æŸ¥è¯¢'.format(\n                            time.strftime(DATA_FORMAT, time.localtime()), stock_interval))\n                    else:\n                        if self.session.submitOrderWitchTry(submitRetry, submitInterval):\n                            self.infoSignal.emit('ä¸‹å•æˆåŠŸ')\n                            return\n            except Exception as e:\n                self.infoSignal.emit(e)\n            time.sleep(stock_interval)\n\n\ndef main():\n\n    app = QApplication(sys.argv)\n    ui = JdBuyerUI()\n    sys.exit(app.exec())\n\n\nif __name__ == '__main__':\n    main()\n"
        },
        {
          "name": "JdSession.py",
          "type": "blob",
          "size": 18.8984375,
          "content": "# -*- coding:utf-8 -*-\nimport json\nimport os\nimport sys\nimport pickle\nimport random\nimport time\nimport requests\n\nfrom lxml import etree\n\nDEFAULT_TIMEOUT = 10\nDEFAULT_USER_AGENT = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36'\n\nif getattr(sys, 'frozen', False):\n    absPath = os.path.dirname(os.path.abspath(sys.executable))\nelif __file__:\n    absPath = os.path.dirname(os.path.abspath(__file__))\n\n\nclass Session(object):\n    \"\"\"\n    äº¬ä¸œä¹°æ‰‹\n    \"\"\"\n\n    # åˆå§‹åŒ–\n    def __init__(self):\n        self.userAgent = DEFAULT_USER_AGENT\n        self.headers = {'User-Agent': self.userAgent}\n        self.timeout = DEFAULT_TIMEOUT\n        self.itemDetails = dict()  # å•†å“ä¿¡æ¯ï¼šåˆ†ç±»idã€å•†å®¶id\n        self.username = 'jd'\n        self.isLogin = False\n        self.password = None\n        self.sess = requests.session()\n        try:\n            self.loadCookies()\n        except Exception:\n            pass\n\n    ############## ç™»å½•ç›¸å…³ #############\n    # ä¿å­˜ cookie\n    def saveCookies(self):\n        cookiesFile = os.path.join(\n            absPath, './cookies/{0}.cookies'.format(self.username))\n        directory = os.path.dirname(cookiesFile)\n        if not os.path.exists(directory):\n            os.makedirs(directory)\n        with open(cookiesFile, 'wb') as f:\n            pickle.dump(self.sess.cookies, f)\n\n    # åŠ è½½ cookie\n    def loadCookies(self):\n        cookiesFile = os.path.join(\n            absPath, './cookies/{0}.cookies'.format(self.username))\n        with open(cookiesFile, 'rb') as f:\n            local_cookies = pickle.load(f)\n        self.sess.cookies.update(local_cookies)\n        self.isLogin = self._validateCookies()\n\n    # éªŒè¯ cookie\n    def _validateCookies(self):\n        \"\"\"\n        é€šè¿‡è®¿é—®ç”¨æˆ·è®¢å•åˆ—è¡¨é¡µè¿›è¡Œåˆ¤æ–­ï¼šè‹¥æœªç™»å½•ï¼Œå°†ä¼šé‡å®šå‘åˆ°ç™»é™†é¡µé¢ã€‚\n        :return: cookiesæ˜¯å¦æœ‰æ•ˆ True/False\n        \"\"\"\n        url = 'https://order.jd.com/center/list.action'\n        payload = {\n            'rid': str(int(time.time() * 1000)),\n        }\n        try:\n            resp = self.sess.get(url=url, params=payload,\n                                 allow_redirects=False)\n            if self.respStatus(resp):\n                return True\n        except Exception as e:\n            return False\n\n        self.sess = requests.session()\n        return False\n\n    # è·å–ç™»å½•é¡µ\n    def getLoginPage(self):\n        url = \"https://passport.jd.com/new/login.aspx\"\n        page = self.sess.get(url, headers=self.headers)\n        return page\n\n    # è·å–ç™»å½•äºŒç»´ç \n    def getQRcode(self):\n        url = 'https://qr.m.jd.com/show'\n        payload = {\n            'appid': 133,\n            'size': 147,\n            't': str(int(time.time() * 1000)),\n        }\n        headers = {\n            'User-Agent': self.userAgent,\n            'Referer': 'https://passport.jd.com/new/login.aspx',\n        }\n        resp = self.sess.get(url=url, headers=headers, params=payload)\n\n        if not self.respStatus(resp):\n            return None\n\n        return resp.content\n\n    # è·å–Ticket\n    def getQRcodeTicket(self):\n        url = 'https://qr.m.jd.com/check'\n        payload = {\n            'appid': '133',\n            'callback': 'jQuery{}'.format(random.randint(1000000, 9999999)),\n            'token': self.sess.cookies.get('wlfstk_smdl'),\n            '_': str(int(time.time() * 1000)),\n        }\n        headers = {\n            'User-Agent': self.userAgent,\n            'Referer': 'https://passport.jd.com/new/login.aspx',\n        }\n        resp = self.sess.get(url=url, headers=headers, params=payload)\n\n        if not self.respStatus(resp):\n            return False\n\n        respJson = self.parseJson(resp.text)\n        if respJson['code'] != 200:\n            return None\n        else:\n            return respJson['ticket']\n\n    # éªŒè¯Ticket\n    def validateQRcodeTicket(self, ticket):\n        url = 'https://passport.jd.com/uc/qrCodeTicketValidation'\n        headers = {\n            'User-Agent': self.userAgent,\n            'Referer': 'https://passport.jd.com/uc/login?ltype=logout',\n        }\n        resp = self.sess.get(url=url, headers=headers, params={'t': ticket})\n\n        if not self.respStatus(resp):\n            return False\n\n        respJson = json.loads(resp.text)\n        if respJson['returnCode'] == 0:\n            return True\n        else:\n            return False\n\n    ############## å•†å“æ–¹æ³• #############\n    # è·å–å•†å“è¯¦æƒ…ä¿¡æ¯\n    def getItemDetail(self, skuId, skuNum=1, areaId=1):\n        \"\"\" æŸ¥è¯¢å•†å“è¯¦æƒ…\n        :param skuId\n        :return å•†å“ä¿¡æ¯ï¼ˆä¸‹å•æ¨¡å¼ã€åº“å­˜ï¼‰\n        \"\"\"\n        url = 'https://item-soa.jd.com/getWareBusiness'\n        payload = {\n            'skuId': skuId,\n            'area': areaId,\n            'num': skuNum\n        }\n        resp = requests.get(url=url, params=payload, headers=self.headers)\n        return resp\n\n    def fetchItemDetail(self, skuId):\n        \"\"\" è§£æå•†å“ä¿¡æ¯\n        :param skuId\n        \"\"\"\n        resp = self.getItemDetail(skuId).json()\n        shopId = resp['shopInfo']['shop']['shopId']\n        detail = dict(venderId=shopId)\n        if 'YuShouInfo' in resp:\n            detail['yushouUrl'] = resp['YuShouInfo']['url']\n        if 'miaoshaInfo' in resp:\n            detail['startTime'] = resp['miaoshaInfo']['startTime']\n            detail['endTime'] = resp['miaoshaInfo']['endTime']\n        self.itemDetails[skuId] = detail\n\n    ############## åº“å­˜æ–¹æ³• #############\n    def getItemStock(self, skuId, skuNum, areaId):\n        \"\"\"è·å–å•ä¸ªå•†å“åº“å­˜çŠ¶æ€\n        :param skuId: å•†å“id\n        :param num: å•†å“æ•°é‡\n        :param areadId: åœ°åŒºid\n        :return: å•†å“æ˜¯å¦æœ‰è´§ True/False\n        \"\"\"\n        resp = self.getItemDetail(skuId, skuNum, areaId).json()\n        return 'stockInfo' in resp and resp['stockInfo']['isStock']\n\n    ############## è´­ç‰©è½¦ç›¸å…³ #############\n\n    def uncheckCartAll(self):\n        \"\"\" å–æ¶ˆæ‰€æœ‰é€‰ä¸­å•†å“\n        return è´­ç‰©è½¦ä¿¡æ¯\n        \"\"\"\n        url = 'https://api.m.jd.com/api'\n\n        headers = {\n            'User-Agent': self.userAgent,\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'origin': 'https://cart.jd.com',\n            'referer': 'https://cart.jd.com'\n        }\n\n        data = {\n            'functionId': 'pcCart_jc_cartUnCheckAll',\n            'appid': 'JDC_mall_cart',\n            'body': '{\"serInfo\":{\"area\":\"\",\"user-key\":\"\"}}',\n            'loginType': 3\n        }\n\n        resp = self.sess.post(url=url, headers=headers, data=data)\n\n        # return self.respStatus(resp) and resp.json()['success']\n        return resp\n\n    def addCartSku(self, skuId, skuNum):\n        \"\"\" åŠ å…¥è´­å…¥è½¦\n        skuId å•†å“sku\n        skuNum è´­ä¹°æ•°é‡\n        retrun æ˜¯å¦æˆåŠŸ\n        \"\"\"\n        url = 'https://api.m.jd.com/api'\n\n        headers = {\n            'User-Agent': self.userAgent,\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'origin': 'https://cart.jd.com',\n            'referer': 'https://cart.jd.com'\n        }\n\n        data = {\n            'functionId': 'pcCart_jc_cartAdd',\n            'appid': 'JDC_mall_cart',\n            'body': '{\\\"operations\\\":[{\\\"carttype\\\":1,\\\"TheSkus\\\":[{\\\"Id\\\":\\\"' + skuId + '\\\",\\\"num\\\":' + str(skuNum) + '}]}]}',\n            'loginType': 3\n        }\n\n        resp = self.sess.post(url=url, headers=headers, data=data)\n\n        return self.respStatus(resp) and resp.json()['success']\n\n    def changeCartSkuCount(self, skuId, skuUid, skuNum, areaId):\n        \"\"\" ä¿®æ”¹è´­ç‰©è½¦å•†å“æ•°é‡\n        skuId å•†å“sku\n        skuUid å•†å“ç”¨æˆ·å…³ç³»\n        skuNum è´­ä¹°æ•°é‡\n        retrun æ˜¯å¦æˆåŠŸ\n        \"\"\"\n        url = 'https://api.m.jd.com/api'\n\n        headers = {\n            'User-Agent': self.userAgent,\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'origin': 'https://cart.jd.com',\n            'referer': 'https://cart.jd.com'\n        }\n\n        body = '{\\\"operations\\\":[{\\\"TheSkus\\\":[{\\\"Id\\\":\\\"'+skuId+'\\\",\\\"num\\\":'+str(\n            skuNum)+',\\\"skuUuid\\\":\\\"'+skuUid+'\\\",\\\"useUuid\\\":false}]}],\\\"serInfo\\\":{\\\"area\\\":\\\"'+areaId+'\\\"}}'\n        data = {\n            'functionId': 'pcCart_jc_changeSkuNum',\n            'appid': 'JDC_mall_cart',\n            'body': body,\n            'loginType': 3\n        }\n\n        resp = self.sess.post(url=url, headers=headers, data=data)\n\n        return self.respStatus(resp) and resp.json()['success']\n\n    def prepareCart(self, skuId, skuNum, areaId):\n        \"\"\" ä¸‹å•å‰å‡†å¤‡è´­ç‰©è½¦\n        1 å–æ¶ˆå…¨éƒ¨å‹¾é€‰ï¼ˆè¿”å›è´­ç‰©è½¦ä¿¡æ¯ï¼‰\n        2 å·²åœ¨è´­ç‰©è½¦åˆ™ä¿®æ”¹å•†å“æ•°é‡\n        3 ä¸åœ¨è´­ç‰©è½¦åˆ™åŠ å…¥è´­ç‰©è½¦\n        skuId å•†å“sku\n        skuNum å•†å“æ•°é‡\n        return True/False\n        \"\"\"\n        resp = self.uncheckCartAll()\n        respObj = resp.json()\n        if not self.respStatus(resp) or not respObj['success']:\n            raise Exception('è´­ç‰©è½¦å–æ¶ˆå‹¾é€‰å¤±è´¥')\n\n        # æ£€æŸ¥å•†å“æ˜¯å¦å·²åœ¨è´­ç‰©è½¦\n        cartInfo = respObj['resultData']['cartInfo']\n        if not cartInfo:\n            # è´­ç‰©è½¦ä¸ºç©º ç›´æ¥åŠ å…¥\n            return self.addCartSku(skuId, skuNum)\n\n        venders = cartInfo['vendors']\n\n        for vender in venders:\n            # if str(vender['vendorId']) != self.itemDetails[skuId]['vender_id']:\n            #     continue\n            items = vender['sorted']\n            for item in items:\n                if str(item['item']['Id']) == skuId:\n                    # åœ¨è´­ç‰©è½¦ä¸­ ä¿®æ”¹æ•°é‡\n                    return self.changeCartSkuCount(skuId, item['item']['skuUuid'], skuNum, areaId)\n        # ä¸åœ¨è´­ç‰©è½¦ä¸­\n        return self.addCartSku(skuId, skuNum)\n\n    ############## è®¢å•ç›¸å…³ #############\n\n    def trySubmitOrder(self, skuId, skuNum, areaId, retry=3, interval=5):\n        \"\"\"æäº¤è®¢å•\n        :return: è®¢å•æäº¤ç»“æœ True/False\n        \"\"\"\n        itemDetail = self.itemDetails[skuId]\n        isYushou = False\n        if 'yushouUrl' in itemDetail:\n            self.getPreSallCheckoutPage(skuId, skuNum)\n            isYushou = True\n        else:\n            self.prepareCart(skuId, skuNum, areaId)\n            self.getCheckoutPage()\n\n        for i in range(1, retry + 1):\n            ret, msg = self.submitOrder(isYushou)\n            if ret:\n                return True\n            else:\n                time.sleep(interval)\n        return False\n\n    def submitOrderWitchTry(self, retry=3, interval=4):\n        \"\"\"æäº¤è®¢å•ï¼Œå¹¶ä¸”å¸¦æœ‰é‡è¯•åŠŸèƒ½\n        :param retry: é‡è¯•æ¬¡æ•°\n        :param interval: é‡è¯•é—´éš”\n        :return: è®¢å•æäº¤ç»“æœ True/False\n        \"\"\"\n        for i in range(1, retry + 1):\n            self.getCheckoutPage()\n            sumbmitSuccess, msg = self.submitOrder()\n            if sumbmitSuccess:\n                return True\n            else:\n                if i < retry:\n                    time.sleep(interval)\n        return False\n\n    def getCheckoutPage(self):\n        \"\"\"è·å–è®¢å•ç»“ç®—é¡µé¢ä¿¡æ¯\n        :return: ç»“ç®—ä¿¡æ¯ dict\n        \"\"\"\n        url = 'http://trade.jd.com/shopping/order/getOrderInfo.action'\n        # url = 'https://cart.jd.com/gotoOrder.action'\n        payload = {\n            'rid': str(int(time.time() * 1000)),\n        }\n        headers = {\n            'User-Agent': self.userAgent,\n            'Referer': 'https://cart.jd.com/cart',\n        }\n        try:\n            resp = self.sess.get(url=url, params=payload, headers=headers)\n            if not self.respStatus(resp):\n                return\n\n            html = etree.HTML(resp.text)\n            self.eid = html.xpath(\"//input[@id='eid']/@value\")\n            self.fp = html.xpath(\"//input[@id='fp']/@value\")\n            self.risk_control = html.xpath(\"//input[@id='riskControl']/@value\")\n            self.track_id = html.xpath(\"//input[@id='TrackID']/@value\")\n\n            order_detail = {\n                # remove 'å¯„é€è‡³ï¼š ' from the begin\n                'address': html.xpath(\"//span[@id='sendAddr']\")[0].text[5:],\n                # remove 'æ”¶ä»¶äºº:' from the begin\n                'receiver':  html.xpath(\"//span[@id='sendMobile']\")[0].text[4:],\n                # remove 'ï¿¥' from the begin\n                'total_price':  html.xpath(\"//span[@id='sumPayPriceId']\")[0].text[1:],\n                'items': []\n            }\n            return order_detail\n        except Exception as e:\n            return\n\n    def getPreSallCheckoutPage(self, skuId, skuNum=1):\n        \"\"\"è·å–é¢„å”®å•†å“ç»“ç®—é¡µé¢ä¿¡æ¯\n        :return: ç»“ç®—ä¿¡æ¯ dict\n        \"\"\"\n        url = 'https://cart.jd.com/cart/dynamic/gateForSubFlow.action'\n        # url = 'https://cart.jd.com/gotoOrder.action'\n        payload = {\n            'wids': skuId,\n            'nums': skuNum,\n            'subType': 32\n        }\n        headers = {\n            'User-Agent': self.userAgent,\n            'Referer': 'https://cart.jd.com/cart',\n        }\n        try:\n            resp = self.sess.get(url=url, params=payload, headers=headers)\n            if not self.respStatus(resp):\n                return\n\n            html = etree.HTML(resp.text)\n            self.eid = html.xpath(\"//input[@id='eid']/@value\")\n            self.fp = html.xpath(\"//input[@id='fp']/@value\")\n            self.risk_control = html.xpath(\"//input[@id='riskControl']/@value\")\n            self.track_id = html.xpath(\"//input[@id='TrackID']/@value\")\n            order_detail = {\n                # remove 'å¯„é€è‡³ï¼š ' from the begin\n                'address': html.xpath(\"//span[@class='addr-info']\")[0].text,\n                # remove 'æ”¶ä»¶äºº:' from the begin\n                'receiver':  html.xpath(\"//span[@class='addr-name']\")[0].text,\n            }\n            return order_detail\n        except Exception as e:\n            return\n\n    def submitOrder(self, isYushou=False):\n        \"\"\"æäº¤è®¢å•\n        :return: True/False è®¢å•æäº¤ç»“æœ\n        \"\"\"\n        url = 'https://trade.jd.com/shopping/order/submitOrder.action'\n        # js function of submit order is included in https://trade.jd.com/shopping/misc/js/order.js?r=2018070403091\n\n        data = {\n            'overseaPurchaseCookies': '',\n            'vendorRemarks': '[]',\n            'submitOrderParam.sopNotPutInvoice': 'false',\n            'submitOrderParam.trackID': 'TestTrackId',\n            'submitOrderParam.ignorePriceChange': '0',\n            'submitOrderParam.btSupport': '0',\n            'riskControl': self.risk_control,\n            'submitOrderParam.isBestCoupon': 1,\n            'submitOrderParam.jxj': 1,\n            'submitOrderParam.trackId': self.track_id,\n            'submitOrderParam.eid': self.eid,\n            'submitOrderParam.fp': self.fp,\n            'submitOrderParam.needCheck': 1,\n        }\n\n        if isYushou:\n            data['submitOrderParam.needCheck'] = 1\n            data['preSalePaymentTypeInOptional'] = 2\n            data['submitOrderParam.payType4YuShou'] = 2\n\n        # add payment password when necessary\n        paymentPwd = self.password\n        if paymentPwd:\n            data['submitOrderParam.payPassword'] = ''.join(\n                ['u3' + x for x in paymentPwd])\n\n        headers = {\n            'User-Agent': self.userAgent,\n            'Host': 'trade.jd.com',\n            'Referer': 'http://trade.jd.com/shopping/order/getOrderInfo.action',\n        }\n\n        try:\n            resp = self.sess.post(url=url, data=data, headers=headers)\n            respJson = json.loads(resp.text)\n\n            if respJson.get('success'):\n                orderId = respJson.get('orderId')\n                return True, orderId\n            else:\n                message, result_code = respJson.get(\n                    'message'), respJson.get('resultCode')\n                if result_code == 0:\n                    self._saveInvoice()\n                    message = message + '(ä¸‹å•å•†å“å¯èƒ½ä¸ºç¬¬ä¸‰æ–¹å•†å“ï¼Œå°†åˆ‡æ¢ä¸ºæ™®é€šå‘ç¥¨è¿›è¡Œå°è¯•)'\n                elif result_code == 60077:\n                    message = message + '(å¯èƒ½æ˜¯è´­ç‰©è½¦ä¸ºç©º æˆ– æœªå‹¾é€‰è´­ç‰©è½¦ä¸­å•†å“)'\n                elif result_code == 60123:\n                    message = message + '(éœ€è¦åœ¨config.iniæ–‡ä»¶ä¸­é…ç½®æ”¯ä»˜å¯†ç )'\n                return False, message\n        except Exception as e:\n            return False, e\n\n    def _saveInvoice(self):\n        \"\"\"ä¸‹å•ç¬¬ä¸‰æ–¹å•†å“æ—¶å¦‚æœæœªè®¾ç½®å‘ç¥¨ï¼Œå°†ä»ç”µå­å‘ç¥¨åˆ‡æ¢ä¸ºæ™®é€šå‘ç¥¨\n        http://jos.jd.com/api/complexTemplate.htm?webPamer=invoice&groupName=%E5%BC%80%E6%99%AE%E5%8B%92%E5%85%A5%E9%A9%BB%E6%A8%A1%E5%BC%8FAPI&id=566&restName=jd.kepler.trade.submit&isMulti=true\n        :return:\n        \"\"\"\n        url = 'https://trade.jd.com/shopping/dynamic/invoice/saveInvoice.action'\n        data = {\n            \"invoiceParam.selectedInvoiceType\": 1,\n            \"invoiceParam.companyName\": \"ä¸ªäºº\",\n            \"invoiceParam.invoicePutType\": 0,\n            \"invoiceParam.selectInvoiceTitle\": 4,\n            \"invoiceParam.selectBookInvoiceContent\": \"\",\n            \"invoiceParam.selectNormalInvoiceContent\": 1,\n            \"invoiceParam.vatCompanyName\": \"\",\n            \"invoiceParam.code\": \"\",\n            \"invoiceParam.regAddr\": \"\",\n            \"invoiceParam.regPhone\": \"\",\n            \"invoiceParam.regBank\": \"\",\n            \"invoiceParam.regBankAccount\": \"\",\n            \"invoiceParam.hasCommon\": \"true\",\n            \"invoiceParam.hasBook\": \"false\",\n            \"invoiceParam.consigneeName\": \"\",\n            \"invoiceParam.consigneePhone\": \"\",\n            \"invoiceParam.consigneeAddress\": \"\",\n            \"invoiceParam.consigneeProvince\": \"è¯·é€‰æ‹©ï¼š\",\n            \"invoiceParam.consigneeProvinceId\": \"NaN\",\n            \"invoiceParam.consigneeCity\": \"è¯·é€‰æ‹©\",\n            \"invoiceParam.consigneeCityId\": \"NaN\",\n            \"invoiceParam.consigneeCounty\": \"è¯·é€‰æ‹©\",\n            \"invoiceParam.consigneeCountyId\": \"NaN\",\n            \"invoiceParam.consigneeTown\": \"è¯·é€‰æ‹©\",\n            \"invoiceParam.consigneeTownId\": 0,\n            \"invoiceParam.sendSeparate\": \"false\",\n            \"invoiceParam.usualInvoiceId\": \"\",\n            \"invoiceParam.selectElectroTitle\": 4,\n            \"invoiceParam.electroCompanyName\": \"undefined\",\n            \"invoiceParam.electroInvoiceEmail\": \"\",\n            \"invoiceParam.electroInvoicePhone\": \"\",\n            \"invokeInvoiceBasicService\": \"true\",\n            \"invoice_ceshi1\": \"\",\n            \"invoiceParam.showInvoiceSeparate\": \"false\",\n            \"invoiceParam.invoiceSeparateSwitch\": 1,\n            \"invoiceParam.invoiceCode\": \"\",\n            \"invoiceParam.saveInvoiceFlag\": 1\n        }\n        headers = {\n            'User-Agent': self.userAgent,\n            'Referer': 'https://trade.jd.com/shopping/dynamic/invoice/saveInvoice.action',\n        }\n        self.sess.post(url=url, data=data, headers=headers)\n\n    def parseJson(self, s):\n        begin = s.find('{')\n        end = s.rfind('}') + 1\n        return json.loads(s[begin:end])\n\n    def respStatus(self, resp):\n        if resp.status_code != requests.codes.OK:\n            return False\n        return True\n\n\nif __name__ == '__main__':\n\n    skuId = '100015253059'\n    areaId = '1_2901_55554_0'\n    skuNum = 1\n\n    session = Session()\n    print(session.getItemDetail(skuId, skuNum, areaId).text)\n"
        },
        {
          "name": "QRcode.png",
          "type": "blob",
          "size": 0.755859375,
          "content": null
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 3.908203125,
          "content": "<div id=\"top\"></div>\n\n<h1 align=\"center\">\n<img src=\"https://img.shields.io/github/contributors/zas023/Jdbuyer.svg?style=for-the-badge\" />\n<img src=\"https://img.shields.io/github/stars/zas023/Jdbuyer.svg?style=for-the-badge\" />\n<img src=\"https://img.shields.io/github/issues/zas023/Jdbuyer.svg?style=for-the-badge\" />\n<img src=\"https://img.shields.io/badge/platform-windows%20%7C%20macos-green?style=for-the-badge\" />\n<img src=\"https://img.shields.io/badge/license-GLP-important?style=for-the-badge\" />\n</h1>\n\n\n<!-- PROJECT LOGO -->\n<br />\n<div align=\"center\">\n  <a href=\"https://github.com/PlayCover/PlayCover\">\n    <img src=\"logo.ico\" alt=\"Logo\" width=\"100\" height=\"100\">\n  </a>\n\n  <h3 align=\"center\">Jdå°çŒªæ‰‹</h3>\n\n  <p align=\"center\">\n    ä¸€æ¬¾æ”¯æŒäº¬ä¸œè‡ªåŠ¨ä¸‹å•çš„å°å·¥å…·ã€‚\n    <br />\n    <br />\n  </p>\n</div>\n\n## 1 å…³äºé¡¹ç›®\n\næ¬¢è¿ä½¿ç”¨äº¬ä¸œå°çŒªæ‰‹ï¼Œå½“æ‚¨åœ¨äº¬ä¸œä¸Šæƒ³è¦è´­ä¹°çš„å•†å“æ— è´§æ—¶ï¼Œå°åŠ©æ‰‹å¯ä»¥å¸®åŠ©æ‚¨å…¨å¤©å€™ç›‘å¬å•†å“åº“å­˜ï¼Œå¹¶åœ¨æœ‰è´§æ—¶ç¬¬ä¸€æ—¶é—´è‡ªåŠ¨å°è¯•ä¸‹å•ï¼Œä¸”ä¸‹å•æˆåŠŸåæ”¯æŒå¾®ä¿¡é€šçŸ¥è§¦è¾¾ã€‚\n\n![](./assest/shootscreen.mac.png)\n\nğŸ“¢**æ³¨æ„**ï¼šç”±äºè´§æºæœ‰é™ï¼Œç›‘å¬åˆ°è´§æºåå¹¶ä¸èƒ½ä¿è¯ä¸€å®šä¸‹å•æˆåŠŸï¼Œåªèƒ½ä¿è¯è®©ä½ å’Œå…¨å›½é»„ç‰›ç«™åœ¨åŒä¸€èµ·è·‘çº¿ä¸Šï¼Œå‰©ä¸‹çš„äº¤ç»™å¥‡è¿¹ã€‚\n\n### 1.1 ChangeList\n\n- 2022-10-29\n\n1. æ–°å¢é¢„å”®å•†å“å®šé‡‘ä¸‹å•æ¨¡å¼\n2. åˆ‡æ¢åº“å­˜æŸ¥è¯¢æ–¹å¼ï¼ˆæ³¨æ„æ§åˆ¶é€Ÿåº¦ï¼‰\n\n## 2 é£Ÿç”¨æ•™ç¨‹\n\nç›®å‰è¯¥é¡¹ç›®æ”¯æŒä¸¤ç§ **Shell è„šæœ¬** å’Œ **GUI å›¾å½¢ç•Œé¢** ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œç›®å‰ Shell æ¨¡å¼æ”¯æŒæ—¥å¿—å’Œå¾®ä¿¡é€šçŸ¥ï¼Œä½†è¿˜éœ€ä¸€äº›é¢å¤–é…ç½®ï¼Œå¯æ ¹æ®è‡ªèº«æ¡ä»¶é€‰æ‹©å¯åŠ¨æ–¹å¼ã€‚\n\n### 2.1 Shell è„šæœ¬\n\n1. å®‰è£…è¿è¡Œç¯å¢ƒ\n\n- [Python](https://www.python.org/)\n\n2. å®‰è£…ç¬¬ä¸‰æ–¹åº“\n\n``` shell\npip install -r requirements.txt\n# or \npip3 install -r requirements.txt\n```\n\n3. ä¿®æ”¹é…ç½®\n\nè¿›å…¥é¡¹ç›®ç›®å½•ï¼Œæ‰¾åˆ° `config.ini` æ–‡ä»¶ï¼ŒæŒ‰ç…§å…¶ä¸­è¯´æ˜ä¿®æ”¹å¯¹äºé…ç½®ã€‚\n\n4. è¿è¡Œè„šæœ¬\n\nä¿®æ”¹é¡¹ç›®ä¸»æ–‡ä»¶ `JdBuyer.py` æœ€åéƒ¨åˆ†ä¸­ `skuId` å’Œ `areaId`ã€‚\n*å…¶ä½™å‚æ•°å­—è¯·æŒ‰æ³¨é‡Šè‡ªè¡Œé€‰æ‹©ä¿®æ”¹*\n\nç„¶åè¿è¡Œç¨‹åºï¼š\n``` python \npython JdBuyer.py\n# or\npython JdBuyer.py\n```\n\n### 2.2 GUI å›¾å½¢ç•Œé¢\n\nç›®å‰å¯æ”¯æŒ windows å’Œ macosï¼Œè¯·åˆ° [release](https://github.com/zas023/JdBuyer/releases) ä¸‹è½½å¯¹äºæ–‡ä»¶ï¼š\n\n- windwos ä¸‹è½½ JdBuyerApp.zipï¼Œè§£å‹ååŒå‡»è¿è¡Œå…¶ä¸­å¯æ‰§è¡Œæ–‡ä»¶å³å¯ï¼›\n\n- macos ä¸‹è½½ JdBuyerApp.appï¼Œä¸‹è½½åç›´æ¥åŒå‡»è¿è¡Œå³å¯ã€‚\n\n**1. å¦‚ä½•é…ç½®**\n\nè¿è¡Œç¨‹åºåï¼Œå¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰ä¸€ä¸‹äº”ä¸ªé…ç½®ï¼š\n\n|å‚æ•°åç§°|æ˜¯å¦å¿…å¡«|è¯´æ˜|\n|--|--|--|\n|å•†å“SKU|æ˜¯|äº¬ä¸œå•†å“è¯¦æƒ…é¡µé“¾æ¥ä¸­å¯ä»¥æ‰¾åˆ°,<br>å¦‚ https://item.jd.com/100015253061.html|\n|åœ°åŒºID|æ˜¯|ä¸‹å•åœ°å€æ‰€åœ¨çš„åœ°åŒº,<br>å¯ä»¥åœ¨å·¥ç¨‹ [area_id](./area_id) æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°|\n|è´­ä¹°å•†å“æ•°é‡|æ˜¯|é»˜è®¤1|\n|åº“å­˜æŸ¥è¯¢é—´éš”|æ˜¯|ç›‘å¬åº“å­˜çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤3ç§’|\n|æ”¯ä»˜å¯†ç |å¦|å¦‚éœ€ä½¿ç”¨è™šæ‹Ÿèµ„äº§ï¼Œå¦‚äº¬è±†ã€Eå¡ç­‰|\n\n*æ³¨ï¼šæ‰€æœ‰é…ç½®å‡åªä¼šä¿å­˜æœ¬åœ°ã€‚*\n\n**2. å¦‚ä½•è¿è¡Œ**\n\nå½“å®Œæˆä»¥ä¸Šé…ç½®åï¼Œç‚¹å‡»ã€å¼€å§‹ã€‘æŒ‰é’®å³å¯ï¼Œå¦‚æœå½“å‰æ˜¯æœªç™»é™†çŠ¶æ€ï¼Œä¼šè‡ªåŠ¨å¼¹å‡ºç™»é™†äºŒç»´ç ç­‰å¾…ä½ æ‰“å¼€äº¬ä¸œAPPæ‰«ç ç™»å½•ï¼Œç™»é™†æˆåŠŸåä¼šè‡ªåŠ¨å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚\n\n*æ³¨ï¼šå¦‚é•¿æ—¶é—´æœªç™»å½•æç¤ºäºŒç»´ç è¿‡æœŸï¼Œç‚¹å‡»ã€ç»“æŸã€‘æŒ‰é’®ï¼Œé‡æ–°ã€å¼€å§‹ã€‘å³å¯ã€‚*\n\n### 2.3 è§†é¢‘æ•™ç¨‹\n\n[Bç«™ä¼ é€é—¨ï¼Œè®°å¾—ä¸€é”®ä¸‰è¿å“¦ï¼](https://www.bilibili.com/video/BV1pe4y1e7ty)\n\n## 3 Todo\n- [x] æ”¯æŒæ‰«ç ç™»é™†\n- [ ] ç™»é™†çŠ¶æ€ä¿æ´»\n- [x] å¼€å‘å›¾å½¢ç•Œé¢\n\n# å…è´£å£°æ˜\n\næœ¬é¡¹ç›®æ‰€ç”¨èµ„æºå‡æºè‡ªç½‘ç»œï¼Œå¦‚æœ‰ä¾µçŠ¯æ‚¨çš„æƒç›Šï¼Œè¯·æ¥ä¿¡å‘ŠçŸ¥ï¼Œå°†ç«‹å³äºˆä»¥å¤„ç†ã€‚\n\nä»»ä½•ä»¥ä»»ä½•æ–¹å¼æŸ¥çœ‹æ­¤é¡¹ç›®çš„äººæˆ–ç›´æ¥æˆ–é—´æ¥ä½¿ç”¨è¯¥é¡¹ç›®ä»»ä½•ä½¿ç”¨è€…éƒ½åº”ä»”ç»†é˜…è¯»æ­¤å£°æ˜ã€‚ä¸€æ—¦ä½¿ç”¨å¹¶å¤åˆ¶äº†ä»»ä½•ç›¸å…³è„šæœ¬æˆ–Scripté¡¹ç›®çš„è§„åˆ™ï¼Œåˆ™è§†ä¸ºæ‚¨å·²æ¥å—æ­¤å…è´£å£°æ˜ã€‚\n\næ‚¨å¿…é¡»åœ¨ä¸‹è½½åçš„24å°æ—¶å†…ä»è®¡ç®—æœºæˆ–æ‰‹æœºä¸­å®Œå…¨åˆ é™¤ä»¥ä¸Šå†…å®¹ã€‚\n\n"
        },
        {
          "name": "area_id",
          "type": "tree",
          "content": null
        },
        {
          "name": "assest",
          "type": "tree",
          "content": null
        },
        {
          "name": "config.ini",
          "type": "blob",
          "size": 0.9443359375,
          "content": "[account]\n# è´¦å·åç§°ï¼Œé»˜è®¤ä¸º jd\n# éšæ„ï¼Œç”¨äºæœ¬åœ°ä¿å­˜è´¦å·ä¿¡æ¯ï¼Œæ–¹ä¾¿å¤šç”¨æˆ·ç™»å½•\nusername = ''\n\n# æ”¯ä»˜å¯†ç \n# å¦‚æœä½ çš„è´¦æˆ·ä¸­æœ‰å¯ç”¨çš„äº¬åˆ¸ï¼ˆæ³¨æ„ä¸æ˜¯ä¸œåˆ¸ï¼‰æˆ– åœ¨ä¸Šæ¬¡è´­ä¹°è®¢å•ä¸­ä½¿ç”¨äº†äº¬è±†ï¼Œ\n# é‚£ä¹ˆäº¬ä¸œå¯èƒ½ä¼šåœ¨ä¸‹å•æ—¶è‡ªåŠ¨é€‰æ‹©äº¬åˆ¸æ”¯ä»˜ æˆ– è‡ªåŠ¨å‹¾é€‰äº¬è±†æ”¯ä»˜ã€‚\n# æ­¤æ—¶ä¸‹å•ä¼šè¦æ±‚è¾“å…¥å…­ä½æ•°å­—çš„æ”¯ä»˜å¯†ç ã€‚è¯·åœ¨ä¸‹æ–¹é…ç½®ä½ çš„æ”¯ä»˜å¯†ç ï¼Œå¦‚ 123456 ã€‚\n# å¦‚æœæ²¡æœ‰ä¸Šè¿°æƒ…å†µï¼Œä¸‹æ–¹è¯·ç•™ç©ºã€‚\npayment_pwd = \n\n[config]\n# æŸ¥è¯¢åº“å­˜è¯·æ±‚è¶…æ—¶(ç§’)ï¼Œå¯é€‰é…ç½®ï¼Œé»˜è®¤10ç§’\ntimeout =\n\n# æ˜¯å¦ä½¿ç”¨éšæœº useragentï¼Œé»˜è®¤ä¸º false\nrandom_useragent = false\n\n[messenger]\n# ä½¿ç”¨äº†Serveré…±çš„æ¨é€æœåŠ¡\n# å¦‚æœæƒ³å¼€å¯ä¸‹å•æˆåŠŸåæ¶ˆæ¯æ¨é€ï¼Œåˆ™å°† enable è®¾ç½®ä¸º trueï¼Œé»˜è®¤ä¸º false ä¸å¼€å¯æ¨é€\n# å¼€å¯æ¶ˆæ¯æ¨é€å¿…é¡»å¡«å…¥ sckeyï¼Œå¦‚ä½•è·å–è¯·å‚è€ƒ http://sc.ftqq.com/3.versionã€‚æ„Ÿè°¢Serveré…±ï½\nenable = false\nsckey = "
        },
        {
          "name": "config.json",
          "type": "blob",
          "size": 0.09765625,
          "content": "{\n    \"skuId\": \"100015253061\",\n    \"areaId\": \"1_2901_4135\",\n    \"count\": 1,\n    \"stockInterval\": 3\n}"
        },
        {
          "name": "config.py",
          "type": "blob",
          "size": 0.755859375,
          "content": "# -*- coding: utf-8 -*-\nimport os\n\nimport configparser\n\n\nclass Config(object):\n\n    def __init__(self, config_file='config.ini'):\n        self._path = os.path.join(os.getcwd(), config_file)\n        if not os.path.exists(self._path):\n            raise FileNotFoundError(\"No such file: config.ini\")\n        self._config = configparser.ConfigParser()\n        self._config.read(self._path, encoding='utf-8')\n\n    def get(self, section, name, strip_blank=True, strip_quote=True):\n        s = self._config.get(section, name)\n        if strip_blank:\n            s = s.strip()\n        if strip_quote:\n            s = s.strip('\"').strip(\"'\")\n\n        return s\n\n    def getboolean(self, section, name):\n        return self._config.getboolean(section, name)\n\n\nglobal_config = Config()\n"
        },
        {
          "name": "exception.py",
          "type": "blob",
          "size": 0.1943359375,
          "content": "#!/usr/bin/env python\n# -*- encoding=utf8 -*-\nfrom log import logger\n\n\nclass JDException(Exception):\n\n    def __init__(self, message):\n        super().__init__(message)\n        logger.error(message)\n"
        },
        {
          "name": "log.py",
          "type": "blob",
          "size": 0.8056640625,
          "content": "#!/usr/bin/env python\n# -*- encoding=utf8 -*-\nimport logging\nimport logging.handlers\nimport os\nfrom time import strftime\n\nLOG_FILENAME = strftime(\"logs\\jd-buyer_%Y_%m_%d_%H.log\")\n\nlogger = logging.getLogger()\n\n\ndef set_logger():\n    path = os.path.dirname(os.getcwd()+ '\\\\logs\\\\') # åˆ¤æ–­æ—¥å¿—ç›®å½•\n    if not os.path.exists(path):\n        os.makedirs(path)\n    logger.setLevel(logging.INFO)\n    formatter = logging.Formatter('%(asctime)s %(levelname)s: %(message)s')\n\n    console_handler = logging.StreamHandler()\n    console_handler.setFormatter(formatter)\n    logger.addHandler(console_handler)\n\n    file_handler = logging.handlers.RotatingFileHandler(\n        LOG_FILENAME, maxBytes=10485760, backupCount=5, encoding=\"utf-8\")\n    file_handler.setFormatter(formatter)\n    logger.addHandler(file_handler)\n\n\nset_logger()\n"
        },
        {
          "name": "logo.ico",
          "type": "blob",
          "size": 272.060546875,
          "content": null
        },
        {
          "name": "requirements.txt",
          "type": "blob",
          "size": 0.048828125,
          "content": "lxml==4.9.1\npycryptodome==3.15.0\nrequests==2.28.0\n"
        },
        {
          "name": "testSession.py",
          "type": "blob",
          "size": 0.25,
          "content": "from JdSession import Session\n\nif __name__ == '__main__':\n\n    skuId = '10032192754328'\n    skuNum = 1\n    areaId = '1_2901_4135'\n\n    sess = Session()\n    sess.item_details[skuId] = sess._get_item_detail(skuId)\n\n    sess.prepareCart(skuId, skuNum, areaId)"
        },
        {
          "name": "timer.py",
          "type": "blob",
          "size": 0.482421875,
          "content": "# -*- coding:utf-8 -*-\nimport time\nfrom datetime import datetime\n\n\nclass Timer(object):\n\n    def __init__(self, buyTime, sleepInterval=0.5):\n\n        # '2018-09-28 22:45:50'\n        self.buy_time = datetime.strptime(buyTime, \"%Y-%m-%d %H:%M:%S\")\n        self.sleepInterval = sleepInterval\n\n    def start(self):\n        now_time = datetime.now\n        while True:\n            if now_time() >= self.buy_time:\n                break\n            else:\n                time.sleep(self.sleepInterval)\n"
        },
        {
          "name": "utils.py",
          "type": "blob",
          "size": 10.7958984375,
          "content": "#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport datetime\nimport json\nimport os\nimport random\nimport re\nfrom base64 import b64encode\n\nimport requests\nfrom Crypto.PublicKey import RSA\nfrom Crypto.Cipher import PKCS1_v1_5 as Cipher_pkcs1_v1_5\n\nfrom log import logger\n\nRSA_PUBLIC_KEY = \"\"\"-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDC7kw8r6tq43pwApYvkJ5lalja\nN9BZb21TAIfT/vexbobzH7Q8SUdP5uDPXEBKzOjx2L28y7Xs1d9v3tdPfKI2LR7P\nAzWBmDMn8riHrDDNpUpJnlAGUqJG9ooPn8j7YNpcxCa1iybOlc2kEhmJn5uwoanQ\nq+CA6agNkqly2H4j6wIDAQAB\n-----END PUBLIC KEY-----\"\"\"\n\nDEFAULT_TIMEOUT = 10\n\nDEFAULT_USER_AGENT = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36'\n\nUSER_AGENTS = [\n    \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.1 Safari/537.36\",\n    \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2226.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.4; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2224.3 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.93 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.124 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2049.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 4.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2049.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36\",\n    \"Mozilla/5.0 (X11; OpenBSD i386) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1944.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.3319.102 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.2309.372 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.2117.157 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.47 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1866.237 Safari/537.36\",\n    \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.137 Safari/4E423F\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.116 Safari/537.36 Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B334b Safari/531.21.10\",\n    \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.517 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1664.3 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1664.3 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.16 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1623.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.17 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.62 Safari/537.36\",\n    \"Mozilla/5.0 (X11; CrOS i686 4319.74.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.57 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.2 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1468.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1467.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1464.0 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1500.55 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.90 Safari/537.36\",\n    \"Mozilla/5.0 (X11; NetBSD) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.116 Safari/537.36\",\n    \"Mozilla/5.0 (X11; CrOS i686 3912.101.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.116 Safari/537.36\",\n    \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.60 Safari/537.17\",\n    \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1309.0 Safari/537.17\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.15 (KHTML, like Gecko) Chrome/24.0.1295.0 Safari/537.15\",\n    \"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.14 (KHTML, like Gecko) Chrome/24.0.1292.0 Safari/537.14\"\n]\n\ndef send_wechat(message, desp, sckey):\n    if not message.strip():\n        logger.error('Text of message is empty!')\n        return\n\n    now_time = str(datetime.datetime.now())\n    desp = '[{0}]'.format(now_time) if not desp else '{0} [{1}]'.format(desp, now_time)\n\n    try:\n        resp = requests.get(\n            'https://sc.ftqq.com/{}.send?text={}&desp={}'.format(sckey, message, desp)\n        )\n        resp_json = json.loads(resp.text)\n        if resp_json['data']['errno'] == 0:\n            logger.info('Message sent successfully [text: %s, desp: %s]', message, desp)\n        else:\n            logger.error('Fail to send message, reason: %s', resp.text)\n    except requests.exceptions.RequestException as req_error:\n        logger.error('Request error: %s', req_error)\n    except Exception as e:\n        logger.error('Fail to send message [text: %s, desp: %s]: %s', message, desp, e)\n\n\n\ndef encrypt_pwd(password, public_key=RSA_PUBLIC_KEY):\n    rsa_key = RSA.importKey(public_key)\n    encryptor = Cipher_pkcs1_v1_5.new(rsa_key)\n    cipher = b64encode(encryptor.encrypt(password.encode('utf-8')))\n    return cipher.decode('utf-8')\n\n\ndef encrypt_payment_pwd(payment_pwd):\n    return ''.join(['u3' + x for x in payment_pwd])\n\n\ndef response_status(resp):\n    if resp.status_code != requests.codes.OK:\n        print('Status: %u, Url: %s' % (resp.status_code, resp.url))\n        return False\n    return True\n\n\ndef open_image(image_file):\n    if os.name == \"nt\":\n        os.system('start ' + image_file)  # for Windows\n    else:\n        if os.uname()[0] == \"Linux\":\n            if \"deepin\" in os.uname()[2]:\n                os.system(\"deepin-image-viewer \" + image_file)  # for deepin\n            else:\n                os.system(\"eog \" + image_file)  # for Linux\n        else:\n            os.system(\"open \" + image_file)  # for Mac\n\n\ndef save_image(resp, image_file):\n    with open(image_file, 'wb') as f:\n        f.write(resp)\n\n\ndef parse_json(s):\n    begin = s.find('{')\n    end = s.rfind('}') + 1\n    return json.loads(s[begin:end])\n\n\ndef get_tag_value(tag, key='', index=0):\n    if key:\n        value = tag[index].get(key)\n    else:\n        value = tag[index].text\n    return value.strip(' \\t\\r\\n')\n\n\ndef parse_items_dict(d):\n    result = ''\n    for index, key in enumerate(d):\n        if index < len(d) - 1:\n            result = result + '{0} x {1}, '.format(key, d[key])\n        else:\n            result = result + '{0} x {1}'.format(key, d[key])\n    return result\n\n\ndef parse_sku_id(sku_ids):\n    \"\"\"å°†å•†å“idå­—ç¬¦ä¸²è§£æä¸ºå­—å…¸\n\n    å•†å“idå­—ç¬¦ä¸²é‡‡ç”¨è‹±æ–‡é€—å·è¿›è¡Œåˆ†å‰²ã€‚\n    å¯ä»¥åœ¨æ¯ä¸ªidåé¢ç”¨å†’å·åŠ ä¸Šæ•°å­—ï¼Œä»£è¡¨è¯¥å•†å“çš„æ•°é‡ï¼Œå¦‚æœä¸åŠ æ•°é‡åˆ™é»˜è®¤ä¸º1ã€‚\n\n    ä¾‹å¦‚ï¼š\n    è¾“å…¥  -->  è§£æç»“æœ\n    '123456' --> {'123456': '1'}\n    '123456,123789' --> {'123456': '1', '123789': '1'}\n    '123456:1,123789:3' --> {'123456': '1', '123789': '3'}\n    '123456:2,123789' --> {'123456': '2', '123789': '1'}\n\n    :param sku_ids: å•†å“idå­—ç¬¦ä¸²\n    :return: dict\n    \"\"\"\n    if isinstance(sku_ids, dict):  # é˜²æ­¢é‡å¤è§£æ\n        return sku_ids\n\n    sku_id_list = list(filter(bool, map(lambda x: x.strip(), sku_ids.split(','))))\n    result = dict()\n    for item in sku_id_list:\n        if ':' in item:\n            sku_id, count = map(lambda x: x.strip(), item.split(':'))\n            result[sku_id] = count\n        else:\n            result[item] = '1'\n    return result\n\n\ndef parse_area_id(area):\n    \"\"\"è§£æåœ°åŒºidå­—ç¬¦ä¸²ï¼šå°†åˆ†éš”ç¬¦æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ _\n    :param area: åœ°åŒºidå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨ _ æˆ– - è¿›è¡Œåˆ†å‰²ï¼‰ï¼Œå¦‚ 12_904_3375 æˆ– 12-904-3375\n    :return: è§£æåå­—ç¬¦ä¸²\n    \"\"\"\n    area_id_list = list(map(lambda x: x.strip(), re.split('_|-', area)))\n    area_id_list.extend((4 - len(area_id_list)) * ['0'])\n    return '_'.join(area_id_list)\n\n\ndef split_area_id(area):\n    \"\"\"å°†åœ°åŒºidå­—ç¬¦ä¸²æŒ‰ç…§ä¸‹åˆ’çº¿è¿›è¡Œåˆ‡å‰²ï¼Œæ„æˆæ•°ç»„ã€‚æ•°ç»„é•¿åº¦ä¸æ»¡4ä½åˆ™ç”¨'0'è¿›è¡Œå¡«å……ã€‚\n    :param area: åœ°åŒºidå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨ _ æˆ– - è¿›è¡Œåˆ†å‰²ï¼‰ï¼Œå¦‚ 12_904_3375 æˆ– 12-904-3375\n    :return: list\n    \"\"\"\n    area_id_list = list(map(lambda x: x.strip(), re.split('_|-', area)))\n    area_id_list.extend((4 - len(area_id_list)) * ['0'])\n    return area_id_list\n\n\ndef get_random_useragent():\n    \"\"\"ç”Ÿæˆéšæœºçš„UserAgent\n    :return: UserAgentå­—ç¬¦ä¸²\n    \"\"\"\n    return random.choice(USER_AGENTS)\n"
        }
      ]
    }
  ]
}