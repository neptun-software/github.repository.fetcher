{
  "metadata": {
    "timestamp": 1736565773263,
    "page": 701,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjcxMA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "audreyt/node-webworker-threads",
      "stars": 2296,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".editorconfig",
          "type": "blob",
          "size": 0.18359375,
          "content": "root = true\n\n[*]\nindent_style = space\nindent_size = 2\nend_of_line = lf\ncharset = utf-8\ntrim_trailing_whitespace = true\ninsert_final_newline = true\n\n[*.md]\ntrim_trailing_whitespace = false\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.1044921875,
          "content": "build\n.lock-wscript\n.DS_Store\nnode_modules\nnpm-debug.log\ndeps/minifier/bin/minify\nrun-all-tests-output.log\n"
        },
        {
          "name": ".npmignore",
          "type": "blob",
          "size": 0.0390625,
          "content": "threads_a_gogo.node\nbuild\n.lock-wscript\n"
        },
        {
          "name": ".travis.yml",
          "type": "blob",
          "size": 0.2548828125,
          "content": "language: node_js\n\nnode_js:\n - \"12\"\n - \"14\"\n - \"16\"\n\ninstall:\n- CXX=\"g++-4.8\" CC=\"gcc-4.8\" npm install\n\n# thanks to http://stackoverflow.com/a/30925448/1283667:\naddons:\n  apt:\n    sources:\n    - ubuntu-toolchain-r-test\n    packages:\n    - gcc-4.8\n    - g++-4.8\n"
        },
        {
          "name": "AUTHORS",
          "type": "blob",
          "size": 0.203125,
          "content": "//Threads_a_gogo AUTHORS\n\n2011-11-06 Jorge Chamorro Bieling   <jorge@jorgechamorro.com>\n2011-11-25 Juan Falgueras Cano      <juan.falgueras@gmail.com>\n2012-01-26 Bruno Jouhier            <bjouhier@gmail.com>\n"
        },
        {
          "name": "CHANGES.md",
          "type": "blob",
          "size": 3.2705078125,
          "content": "## 0.7.17\n\n* Fix Node 10.9.0 compatibility. (@vtrphan)\n\n## 0.7.16\n\n* Fix Windows load delay validation for Node v10.x. (@garymathews)\n* Add TypeScript definition. (@taoqf)\n* Fix compilation on Node v10.x. (@nicholasc)\n\n## 0.7.13\n\n* Allows overriding of console.log, console.error, fs.readFileSync (@ncthbrt)\n* Fixes a tiny memory leak in BSON destruction. (@823639792)\n\n## 0.7.12\n\n* Resolve compiler warnings on Node v7 (@davisjam)\n* Fix err handling propagation.\n\n## 0.7.9\n\n* Fix building on Windows. (@yufeih)\n* Upgrade to LiveScript 1.5.0 and Nan 2.4.x. (@brodybits)\n\n## 0.7.8\n\n* Fix building on nw and node for Windows 10. (@Demiguise)\n\n## 0.7.5\n\n## Documentation Fixes\n\n* Replace all use of process.nextTick() to setImmediate. (@Cyber1000)\n\n## 0.7.4\n\n## Bug Fixes\n\n* Fix memory leak during parameter passing. (@mnahkies)\n\n## 0.7.3\n\n### Compatibility\n\n* Support for Node 6.0.0.\n\n## 0.7.1\n\n### Bug Fixes\n\n* Green tests by allowing normal exit after `.terminate()`\n* Do not reuse threads after `.terminate()`; fixed #62.\n\n## 0.6.3\n\n### Bug Fixes\n\n* `.terminate()` now destroys thread immediately (@yufeih)\n\n## 0.6.2\n\n### Compatibility\n\n* Restored support for Node 0.10.40 (@smith-kyle)\n\n## 0.6.1\n\n### Bug Fixes\n\n* Fix crash on Node 4.x in the case of `pool.any.eval('undefined_function()')` (@brodybits)\n\n## 0.6.0\n\n### Compatibility\n\n* Support for Node 4.x (@brodybits)\n* Remove support for Node 0.8.x\n\n## 0.5.7\n\n### Compatibility\n\n* Support for io.js-3.3.1. (@marcominetti)\n\n## 0.5.6\n\n### Compatibility\n\n* Support for io.js-1.0.x/2.0.0. (@heavyk)\n\n## 0.5.5\n\n### Compatibility\n\n* Proper support for Node 0.11.x. (@caasi, @senditu, @gitawego)\n\n## 0.4.11\n\n* Correct a typo in `examples/ex05_pool.js`. (@naderchehab)\n\n## 0.4.10\n\n### Bug Fixes\n\n* Fix `pool.any.emit`. (@craigwinstanley, Jason Winshell)\n\n## 0.4.9\n\n### Bug Fixes\n\n* Fix compilation on Node 0.8.x (@RemcoTukker).\n* Upgrade LiveScript in devDependencies; no functional changes.\n\n## 0.4.8\n\n### Bug Fixes\n\n* Fix compilation with V8 3.20.x.\n\n## 0.4.7\n\n### Worker API\n\n* Errors during @postMessage are caught and raised in `onerror` handler, as per spec.\n\n## 0.4.6\n\n### Bug Fixes\n\n* Compatibility with Node.js 0.10.\n\n## 0.4.5\n\n### Bug Fixes\n\n* new Worker(\"filename.js\") was broken on OS X. (@dfellis)\n\n## 0.4.3\n\n### Bug Fixes\n\n* Fix Linux compilation issue introduced in 0.4.1. (@dfellis)\n\n* `importScripts` now checks if the files have been read entirely,\n  instead of (potentially) evaluating part of the file in case\n  of filesystem failure.\n\n## 0.4.2\n\n### Global Worker API\n\n* Set `onmessage = function(event) { ... }` directly now works\n  as specced. (Previously it required `self.onmessage = ...`.)\n\n## 0.4.1\n\n### Global Worker API\n\n* Add `importScripts` for loading on-disk files.\n\n* Add `console.log` and `console.error` from thread.js.\n\n## 0.4.0\n\n* Support for Windows with Node.js 0.9.3+.\n\n## 0.3.2\n\n* Fix BSON building on SunOS.\n\n## 0.3.1\n\n* Switch to BSON instead of JSON for message serialization.\n\n  Note that neither one supports circular structures or\n  native buffer objects yet.\n\n## 0.3.0\n\n* Require Node.js 0.8.\n\n## 0.2.3\n\n* Add SunOS to supported OSs; tested on Linux.\n\n## 0.2.2\n\n* Allow an empty `new Worker()` constructor.\n\n* Update API documentation in README.\n\n## 0.2.1\n\n* Allow any JSON-serializable structures in postMessage/onmessage.\n\n## 0.2.0\n\n* Initial release.\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.93359375,
          "content": "# CC0 1.0 Universal\n\nTo the extent possible under law, 唐鳳 has waived all copyright\nand related or neighboring rights to webworker-threads.\n\nThis work is published from Taiwan.\n\nhttp://creativecommons.org/publicdomain/zero/1.0\n\n# This module includes src/bson.cc and src/bson.h, under the Apache License v2.0:\n\nhttps://github.com/mongodb/js-bson/\n\nCopyright by Christian Amor Kvalheim and other contributors.\n\n# This module includes src/jslib.cc, under the MIT license:\n\nhttps://github.com/rob333/thread.js\n\nCopyright(C) 2012 by RobertL\n\n# This module is based on Threads_a_gogo, under the MIT license:\n\nhttps://github.com/xk/node-threads-a-gogo/blob/2665efb9d1d3cc0934ac2f5b6265b37a684d2e07/package.json#L24\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n====\n\nCopyright 2011 Proyectos Equis Ka, s.l., Jorge Chamorro Bieling and other \ncontributors. See the AUTHORS file. All rights reserved.\n\n====\n\nThis license applies to all parts of Threads_a_gogo that are not externally\nmaintained libraries.\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 19.529296875,
          "content": "# WebWorker Threads\n\n[![Build Status](https://travis-ci.org/audreyt/node-webworker-threads.svg)](https://travis-ci.org/audreyt/node-webworker-threads)\n\nThis is based on @xk (jorgechamorro)'s [Threads A GoGo for Node.js](https://github.com/audreyt/node-threads-a-gogo), but with an API conforming to the [Web Worker standard](http://www.w3.org/TR/workers/).\n\nThis module provides an asynchronous, evented and/or continuation passing style API for moving blocking/longish CPU-bound tasks out of Node's event loop to JavaScript threads that run in parallel in the background and that use all the available CPU cores automatically; all from within a single Node process.\n\n**Note**: If you would like to `require()` native modules in a worker, please consider using the process-based [tiny-worker](https://www.npmjs.com/package/tiny-worker) instead. It does not use threads, but the WebWorker API is compatible.\n\nThis module requires Node.js 0.10.0+ and a working [node-gyp toolchain](https://github.com/nodejs/node-gyp#installation).\n\n## Illustrated Writeup\n\nThere is an [illustrated writeup](http://aosabook.org/en/posa/from-socialcalc-to-ethercalc.html#multi-core-scaling) for the original use case of this module:\n\n<img src=\"http://aosabook.org/en/posa/ethercalc-images/scaling-threads.png\" alt=\"Event Threaded Server (multi-core)\" width=\"100%\">\n\n## Installing the module\n\nWith [npm](http://npmjs.org/):\n\n    npm install webworker-threads\n\nSample usage (adapted from [MDN](https://developer.mozilla.org/en-US/docs/DOM/Using_web_workers#Passing_data)):\n\n```js\nvar Worker = require('webworker-threads').Worker;\n// var w = new Worker('worker.js'); // Standard API\n\n// You may also pass in a function:\nvar worker = new Worker(function(){\n  postMessage(\"I'm working before postMessage('ali').\");\n  this.onmessage = function(event) {\n    postMessage('Hi ' + event.data);\n    self.close();\n  };\n});\nworker.onmessage = function(event) {\n  console.log(\"Worker said : \" + event.data);\n};\nworker.postMessage('ali');\n```\n\nA more involved example in [LiveScript](http://livescript.net/) syntax, with five threads:\n\n```coffee\n{ Worker } = require \\webworker-threads\n\nfor til 5 => (new Worker ->\n  fibo = (n) -> if n > 1 then fibo(n - 1) + fibo(n - 2) else 1\n  @onmessage = ({ data }) -> postMessage fibo data\n)\n  ..onmessage = ({ data }) ->\n    console.log \"[#{ @thread.id }] #data\"\n    @postMessage Math.ceil Math.random! * 30\n  ..postMessage Math.ceil Math.random! * 30\n\ndo spin = -> setImmediate spin\n```\n\n## Introduction\n\nAfter the initialization phase of a Node program, whose purpose is to setup listeners and callbacks to be executed in response to events, the next phase, the proper execution of the program, is orchestrated by the event loop whose duty is to [juggle events, listeners and callbacks quickly and without any hiccups nor interruptions that would ruin its performance](https://youtu.be/D0uA_NOb0PE).\n\nBoth the event loop and said listeners and callbacks run sequentially in a single thread of execution, Node's main thread. If any of them ever blocks, nothing else will happen for the duration of the block: no more events will be handled, no more callbacks nor listeners nor timeouts nor setImmediate()ed functions will have the chance to run and do their job, because they won't be called by the blocked event loop, and the program will turn sluggish at best, or appear to be frozen and dead at worst.\n\n### What is WebWorker-Threads\n\n`webworker-threads` provides an asynchronous API for CPU-bound tasks that's missing in Node.js:\n\n``` javascript\nvar Worker = require('webworker-threads').Worker;\nrequire('http').createServer(function (req,res) {\n  var fibo = new Worker(function() {\n    function fibo (n) {\n      return n > 1 ? fibo(n - 1) + fibo(n - 2) : 1;\n    }\n    this.onmessage = function (event) {\n      postMessage(fibo(event.data));\n    }\n  });\n  fibo.onmessage = function (event) {\n    res.end('fib(40) = ' + event.data);\n  };\n  fibo.postMessage(40);\n}).listen(port);\n```\n\nAnd it won't block the event loop because for each request, the `fibo` worker will run in parallel in a separate background thread.\n\n## API\n\n### Module API\n\n``` javascript\nvar Threads= require('webworker-threads');\n```\n\n##### .Worker\n\n`new Threads.Worker( [ file | function ] )` returns a Worker object.\n\n##### .create()\n\n`Threads.create( /* no arguments */ )` returns a thread object.\n\n##### .createPool( numThreads )\n\n`Threads.createPool( numberOfThreads )` returns a threadPool object.\n\n---\n### Web Worker API\n\n``` javascript\nvar worker= new Threads.Worker('worker.js');\nvar worker= new Threads.Worker(function(){ ... });\nvar worker= new Threads.Worker();\n```\n\n##### .postMessage( data )\n\n`worker.postMessage({ x: 1, y: 2 })` sends a data structure into the worker. The worker can receive it using the `onmessage` handler.\n\n##### .onmessage\n\n`worker.onmessage = function (event) { console.log(event.data) };` receives data from the worker's `postMessage` calls.\n\n##### .terminate()\n\n`worker.terminate()` terminates the worker thread.\n\n##### .addEventListener( type, cb )\n\n`worker.addEventListener('message', callback)` is equivalent to setting `worker.onmesssage = callback`.\n\n##### .dispatchEvent( event )\n\nCurrently unimplemented.\n\n##### .removeEventListener( type )\n\nCurrently unimplemented.\n\n##### .thread\n\nReturns the underlying `thread` object; see the next section for details.\nNote that this attribute is implementation-specific, and not part of W3C Web Worker API.\n\n---\n\n### Thread API\n\n``` javascript\nvar thread= Threads.create();\n```\n\n##### .id\n\n`thread.id` is a sequential thread serial number.\n\n##### .load( absolutePath [, cb] )\n\n`thread.load( absolutePath [, cb] )` reads the file at `absolutePath` and `thread.eval(fileContents, cb)`.\n\n##### .eval( program [, cb])\n\n`thread.eval( program [, cb])` converts `program.toString()` and eval()s it in the thread's global context, and (if provided) returns the completion value to `cb(err, completionValue)`.\n\n##### .on( eventType, listener )\n\n`thread.on( eventType, listener )` registers the listener `listener(data)` for any events of `eventType` that the thread `thread` may emit.\n\n##### .once( eventType, listener )\n\n`thread.once( eventType, listener )` is like `thread.on()`, but the listener will only be called once.\n\n##### .removeAllListeners( [eventType] )\n\n`thread.removeAllListeners( [eventType] )` deletes all listeners for all eventTypes. If `eventType` is provided, deletes all listeners only for the event type `eventType`.\n\n##### .emit( eventType, eventData [, eventData ... ] )\n\n`thread.emit( eventType, eventData [, eventData ... ] )` emits an event of `eventType` with `eventData` inside the thread `thread`. All its arguments are .toString()ed.\n\n##### .destroy( /* no arguments */ )\n\n`thread.destroy( /* no arguments */ )` destroys the thread.\n\n---\n### Thread pool API\n\n``` javascript\nthreadPool= Threads.createPool( numberOfThreads );\n```\n\n##### .load( absolutePath [, cb] )\n\n`threadPool.load( absolutePath [, cb] )` runs `thread.load( absolutePath [, cb] )` in all the pool's threads.\n\n##### .any.eval( program, cb )\n\n`threadPool.any.eval( program, cb )` is like `thread.eval()`, but in any of the pool's threads.\n\n##### .any.emit( eventType, eventData [, eventData ... ] )\n\n`threadPool.any.emit( eventType, eventData [, eventData ... ] )` is like `thread.emit()`, but in any of the pool's threads.\n\n##### .all.eval( program, cb )\n\n`threadPool.all.eval( program, cb )` is like `thread.eval()`, but in all the pool's threads.\n\n##### .all.emit( eventType, eventData [, eventData ... ] )\n\n`threadPool.all.emit( eventType, eventData [, eventData ... ] )` is like `thread.emit()`, but in all the pool's threads.\n\n##### .on( eventType, listener )\n\n`threadPool.on( eventType, listener )` is like `thread.on()`, but in all of the pool's threads.\n\n##### .totalThreads()\n\n`threadPool.totalThreads()` returns the number of threads in this pool: as supplied in `.createPool( number )`\n\n##### .idleThreads()\n\n`threadPool.idleThreads()` returns the number of threads in this pool that are currently idle (sleeping)\n\n##### .pendingJobs()\n\n`threadPool.pendingJobs()` returns the number of jobs pending.\n\n##### .destroy( [ rudely ] )\n\n`threadPool.destroy( [ rudely ] )` waits until `pendingJobs()` is zero and then destroys the pool. If `rudely` is truthy, then it doesn't wait for `pendingJobs === 0`.\n\n---\n### Global Web Worker API\n\nInside every Worker instance from webworker-threads, there's a global `self` object with these properties:\n\n##### .postMessage( data )\n\n`postMessage({ x: 1, y: 2 })` sends a data structure back to the main thread.\n\n##### .onmessage\n\n`onmessage = function (event) { ... }` receives data from the main thread's `.postMessage` calls.\n\n##### .close()\n\n`close()` stops the current thread.\n\n##### .addEventListener( type, cb )\n\n`addEventListener('message', callback)` is equivalent to setting `self.onmesssage = callback`.\n\n##### .dispatchEvent( event )\n\n`dispatchEvent({ type: 'message', data: data })` is the same as `self.postMessage(data)`.\n\n##### .removeEventListener( type )\n\nCurrently unimplemented.\n\n##### .importScripts( file [, file...] )\n\n`importScripts('a.js', 'b.js')` loads one or more files from the disk and `eval()` them in the worker's instance scope.\n\n##### .thread\n\nThe underlying `thread` object; see the next section for details.\nNote that this attribute is implementation-specific, and not part of W3C Web Worker API.\n\n---\n### Global Thread API\n\nInside every thread .create()d by webworker-threads, there's a global `thread` object with these properties:\n\n##### .id\n\n`thread.id` is the serial number of this thread\n\n##### .on( eventType, listener )\n\n`thread.on( eventType, listener )` is just like `thread.on()` above.\n\n##### .once( eventType, listener )\n\n`thread.once( eventType, listener )` is just like `thread.once()` above.\n\n##### .emit( eventType, eventData [, eventData ... ] )\n\n`thread.emit( eventType, eventData [, eventData ... ] )` is just like `thread.emit()` above.\n\n##### .removeAllListeners( [eventType] )\n\n`thread.removeAllListeners( [eventType] )` is just like `thread.removeAllListeners()` above.\n\n##### .nextTick( function )\n\n`thread.nextTick( function )` is like `process.nextTick()`, but much faster.\n\n---\n### Global Helper API\n\nInside every thread .create()d by webworker-threads, there are some helpers:\n\n##### console.log(arg1 [, arg2 ...])\n\nSame as `console.log` on the main process.\n\n##### console.error(arg1 [, arg2 ...])\n\nSame as `console.log`, except it prints to stderr.\n\n##### puts(arg1 [, arg2 ...])\n\n`puts(arg1 [, arg2 ...])` converts .toString()s and prints its arguments to stdout.\n\n## Developer guide\n\nSee the [developer guide](https://github.com/audreyt/node-webworker-threads/wiki) if you want to contribute.\n\n-----------\nWIP WIP WIP\n-----------\nNote that everything below this line is under construction and subject to change.\n-----------\n\n## Examples\n\n**A.-** Here's a program that makes Node's event loop spin freely and as fast as possible: it simply prints a dot to the console in each turn:\n\n    cat examples/quickIntro_loop.js\n    \n``` javascript\n(function spinForever () {\n  setImmediate(spinForever);\n})();\n```\n\n**B.-** Here's another program that adds to the one above a fibonacci(35) call in each turn, a CPU-bound task that takes quite a while to complete and that blocks the event loop making it spin slowly and clumsily. The point is simply to show that you can't put a job like that in the event loop because Node will stop performing properly when its event loop can't spin fast and freely due to a callback/listener/setImmediate()ed function that's blocking.\n\n    cat examples/quickIntro_blocking.js\n\n``` javascript\nfunction fibo (n) {\n  return n > 1 ? fibo(n - 1) + fibo(n - 2) : 1;\n}\n\n(function fiboLoop () {\n  process.stdout.write(fibo(35).toString());\n  setImmediate(fiboLoop);\n})();\n\n(function spinForever () {\n  setImmediate(spinForever);\n})();\n```\n\n**C.-** The program below uses `webworker-threads` to run the fibonacci(35) calls in a background thread, so Node's event loop isn't blocked at all and can spin freely again at full speed:\n\n    cat examples/quickIntro_oneThread.js\n  \n``` javascript\nfunction fibo (n) {\n  return n > 1 ? fibo(n - 1) + fibo(n - 2) : 1;\n}\n\nfunction cb (err, data) {\n  process.stdout.write(data);\n  this.eval('fibo(35)', cb);\n}\n\nvar thread= require('webworker-threads').create();\n\nthread.eval(fibo).eval('fibo(35)', cb);\n\n(function spinForever () {\n  process.stdout.write(\".\");\n  setImmediate(spinForever);\n})();\n```\n\n**D.-** This example is almost identical to the one above, only that it creates 5 threads instead of one, each running a fibonacci(35) in parallel and in parallel too with Node's event loop that keeps spinning happily at full speed in its own thread:\n\n    cat examples/quickIntro_fiveThreads.js\n  \n``` javascript\nfunction fibo (n) {\n  return n > 1 ? fibo(n - 1) + fibo(n - 2) : 1;\n}\n\nfunction cb (err, data) {\n  process.stdout.write(\" [\"+ this.id+ \"]\"+ data);\n  this.eval('fibo(35)', cb);\n}\n\nvar Threads= require('webworker-threads');\n\nThreads.create().eval(fibo).eval('fibo(35)', cb);\nThreads.create().eval(fibo).eval('fibo(35)', cb);\nThreads.create().eval(fibo).eval('fibo(35)', cb);\nThreads.create().eval(fibo).eval('fibo(35)', cb);\nThreads.create().eval(fibo).eval('fibo(35)', cb);\n\n(function spinForever () {\n  setImmediate(spinForever);\n})();\n```\n\n**E.-** The next one asks `webworker-threads` to create a pool of 10 background threads, instead of creating them manually one by one:\n\n    cat examples/multiThread.js\n\n``` javascript\nfunction fibo (n) {\n  return n > 1 ? fibo(n - 1) + fibo(n - 2) : 1;\n}\n\nvar numThreads= 10;\nvar threadPool= require('webworker-threads').createPool(numThreads).all.eval(fibo);\n\nthreadPool.all.eval('fibo(35)', function cb (err, data) {\n  process.stdout.write(\" [\"+ this.id+ \"]\"+ data);\n  this.eval('fibo(35)', cb);\n});\n\n(function spinForever () {\n  setImmediate(spinForever);\n})();\n```\n\n**F.-** This is a demo of the `webworker-threads` eventEmitter API, using one thread:\n\n    cat examples/quickIntro_oneThreadEvented.js\n\n``` javascript\nvar thread= require('webworker-threads').create();\nthread.load(__dirname + '/quickIntro_evented_childThreadCode.js');\n\n/*\n  This is the code that's .load()ed into the child/background thread:\n  \n  function fibo (n) {\n    return n > 1 ? fibo(n - 1) + fibo(n - 2) : 1;\n  }\n\n  thread.on('giveMeTheFibo', function onGiveMeTheFibo (data) {\n    this.emit('theFiboIs', fibo(+data)); //Emits 'theFiboIs' in the parent/main thread.\n  });\n  \n*/\n\n//Emit 'giveMeTheFibo' in the child/background thread.\nthread.emit('giveMeTheFibo', 35);\n\n//Listener for the 'theFiboIs' events emitted by the child/background thread.\nthread.on('theFiboIs', function cb (data) {\n  process.stdout.write(data);\n  this.emit('giveMeTheFibo', 35);\n});\n\n(function spinForever () {\n  setImmediate(spinForever);\n})();\n```\n\n**G.-** This is a demo of the `webworker-threads` eventEmitter API, using a pool of threads:\n\n    cat examples/quickIntro_multiThreadEvented.js\n\n``` javascript\nvar numThreads= 10;\nvar threadPool= require('webworker-threads').createPool(numThreads);\nthreadPool.load(__dirname + '/quickIntro_evented_childThreadCode.js');\n\n/*\n  This is the code that's .load()ed into the child/background threads:\n  \n  function fibo (n) {\n    return n > 1 ? fibo(n - 1) + fibo(n - 2) : 1;\n  }\n\n  thread.on('giveMeTheFibo', function onGiveMeTheFibo (data) {\n    this.emit('theFiboIs', fibo(+data)); //Emits 'theFiboIs' in the parent/main thread.\n  });\n  \n*/\n\n//Emit 'giveMeTheFibo' in all the child/background threads.\nthreadPool.all.emit('giveMeTheFibo', 35);\n\n//Listener for the 'theFiboIs' events emitted by the child/background threads.\nthreadPool.on('theFiboIs', function cb (data) {\n  process.stdout.write(\" [\"+ this.id+ \"]\"+ data);\n  this.emit('giveMeTheFibo', 35);\n});\n\n(function spinForever () {\n  setImmediate(spinForever);\n})();\n```\n\n## More examples\n\nThe `examples` directory contains a few more examples:\n\n* [ex01_basic](https://github.com/xk/node-threads-a-gogo/blob/master/examples/ex01_basic.md): Running a simple function in a thread.\n* [ex02_events](https://github.com/xk/node-threads-a-gogo/blob/master/examples/ex02_events.md): Sending events from a worker thread.\n* [ex03_ping_pong](https://github.com/xk/node-threads-a-gogo/blob/master/examples/ex03_ping_pong.md): Sending events both ways between the main thread and a worker thread.\n* [ex04_main](https://github.com/xk/node-threads-a-gogo/blob/master/examples/ex04_main.md): Loading the worker code from a file.\n* [ex05_pool](https://github.com/xk/node-threads-a-gogo/blob/master/examples/ex05_pool.md): Using the thread pool.\n* [ex06_jason](https://github.com/xk/node-threads-a-gogo/blob/master/examples/ex06_jason.md): Passing complex objects to threads.\n\n## Rationale\n\n[Node.js](http://nodejs.org) is the most awesome, cute and super-sexy piece of free, open source software.\n\nIts event loop can spin as fast and smooth as a turbo, and roughly speaking, **the faster it spins, the more power it delivers**. That's why [@ryah](http://twitter.com/ryah) took great care to ensure that no -possibly slow- I/O operations could ever block it: a pool of background threads (thanks to [Marc Lehmann's libeio library](http://software.schmorp.de/pkg/libeio.html)) handle any blocking I/O calls in the background, in parallel.\n\nIn Node it's verboten to write a server like this:\n\n``` javascript\nhttp.createServer(function (req,res) {\n  res.end( fs.readFileSync(path) );\n}).listen(port);\n```\nBecause synchronous I/O calls **block the turbo**, and without proper boost, Node.js begins to stutter and behaves clumsily. To avoid it there's the asynchronous version of `.readFile()`, in continuation passing style, that takes a callback:\n\n``` javascript\nfs.readfile(path, function cb (err, data) { /* ... */ });\n```\n\nIt's cool, we love it (*), and there's hundreds of ad hoc built-in functions like this in Node to help us deal with almost any variety of possibly slow, blocking I/O.\n\n### But what's with longish, CPU-bound tasks?\n\nHow do you avoid blocking the event loop, when the task at hand isn't I/O bound, and lasts more than a few fractions of a millisecond?\n\n``` javascript\nhttp.createServer(function cb (req,res) {\n  res.end( fibonacci(40) );\n}).listen(port);\n```\n\nYou simply can't, because there's no way... well, there wasn't before `webworker-threads`.\n\n### Why Threads\n\nThreads (kernel threads) are very interesting creatures. They provide:\n\n1.- Parallelism: All the threads run in parallel. On a single core processor, the CPU is switched rapidly back and forth among the threads providing the illusion that the threads are running in parallel, albeit on a slower CPU than the real one. With 10 compute-bound threads in a process, the threads would appear to be running in parallel, each one on a CPU with 1/10th the speed of the real CPU. On a multi-core processor, threads are truly running in parallel, and get time-sliced when the number of threads exceed the number of cores. So with 12 compute bound threads on a quad-core processor each thread will appear to run at 1/3rd of the nominal core speed.\n\n2.- Fairness: No thread is more important than another, cores and CPU slices are fairly distributed among threads by the OS scheduler.\n\n3.- Threads fully exploit all the available CPU resources in your system. On a loaded system running many tasks in many threads, the more cores there are, the faster the threads will complete. Automatically.\n\n### Why not multiple processes.\n\nThe \"can't block the event loop\" problem is inherent to Node's evented model. No matter how many Node processes you have running as a [Node-cluster](http://blog.nodejs.org/2011/10/04/an-easy-way-to-build-scalable-network-programs/), it won't solve its issues with CPU-bound tasks.\n\nLaunch a cluster of N Nodes running the example B (`quickIntro_blocking.js`) above, and all you'll get is N -instead of one- Nodes with their event loops blocked and showing a sluggish performance.\n"
        },
        {
          "name": "TODO.md",
          "type": "blob",
          "size": 0.4970703125,
          "content": "* Worker API\n    * `setTimeout` / `clearTimeout` / `setInterval` / `clearInterval`\n        Forwarding to the default implementation (in NativeModule TimerWrap).\n\n      Alternately, we can integrate this with our own `tick` function:\n\n        http://code.google.com/p/v8-juice/source/browse/branches/edge/src/client/shell/js/MockTimer.js\n        (derived from https://github.com/esbie/js-mock-timers)\n\n    * `onerror` handler\n        Catch runtime errors; also addEventListener 'error'.\n    * `dispatchEvent`?\n"
        },
        {
          "name": "benchmark",
          "type": "tree",
          "content": null
        },
        {
          "name": "binding.gyp",
          "type": "blob",
          "size": 0.69921875,
          "content": "{\n  \"targets\": [\n    {\n      \"target_name\": \"WebWorkerThreads\",\n      \"sources\": [\n        \"src/WebWorkerThreads.cc\"\n      ],\n      \"cflags!\": [\n        \"-fno-exceptions\",\n        \"-DV8_USE_UNSAFE_HANDLES\"\n      ],\n      \"cflags_cc!\": [\n        \"-fno-exceptions\",\n        \"-DV8_USE_UNSAFE_HANDLES\"\n      ],\n      \"include_dirs\": [\n        \"<!(node -e \\\"require('nan')\\\")\"\n      ],\n      \"win_delay_load_hook\": \"<!(node -e \\\"var v = process.version.substring(1).split('.')[0]; console.log(v > 0 && v < 4);\\\")\",\n      \"conditions\": [\n        [\n          \"OS==\\\"mac\\\"\",\n          {\n            \"xcode_settings\": {\n              \"GCC_ENABLE_CPP_EXCEPTIONS\": \"YES\"\n            }\n          }\n        ]\n      ]\n    }\n  ]\n}\n"
        },
        {
          "name": "deps",
          "type": "tree",
          "content": null
        },
        {
          "name": "examples",
          "type": "tree",
          "content": null
        },
        {
          "name": "index.d.ts",
          "type": "blob",
          "size": 4.2421875,
          "content": "\nexport interface Event {\n\tdata: any;\n}\n\nexport type CallBack = (...args: any[]) => any;\n\nexport interface WorkerConstructor {\n\tnew(jsfilepath: string): Worker;\n\tnew(fun: (this: Worker) => void): Worker;\n\tnew(): Worker;\n}\n\nexport interface Worker {\n\t// Returns the underlying thread object; see the next section for details. Note that this attribute is implementation-specific, and not part of W3C Web Worker API.\n\treadonly thread: Thread;\n\t// worker.postMessage({ x: 1, y: 2 }) sends a data structure into the worker. The worker can receive it using the onmessage handler.\n\tpostMessage(data: any): void;\n\t// worker.onmessage = function (event) { console.log(event.data) }; receives data from the worker's postMessage calls.\n\tonmessage(event: Event): void;\n\t// terminates the worker thread.\n\tterminate(): void;\n\t// worker.addEventListener('message', callback) is equivalent to setting worker.onmesssage = callback.\n\taddEventListener(type: string, cb: CallBack): void;\n\t// Currently unimplemented.\n\tdispatchEvent(type: string);\n\t// Currently unimplemented.\n\tremoveEventListener(type: string);\n}\n\nexport interface Thread {\n\treadonly id: number;\n\t// thread.load( absolutePath [, cb] ) reads the file at absolutePath and thread.eval(fileContents, cb).\n\tload(absolutePath: string, cb?: (this: Thread, err: any, data: any) => void): void;\n\n\t// thread.eval( program [, cb]) converts program.toString() and eval()s it in the thread's global context, and (if provided) returns the completion value to cb(err, completionValue).\n\teval<T extends { toString(): string; }>(program: T, cb?: (this: Thread, err: any, data: any) => void): this;\n\n\t// thread.on( eventType, listener ) registers the listener listener(data) for any events of eventType that the thread thread may emit.\n\ton(eventType: string, listener: (data: any) => void): this;\n\n\t// thread.once(eventType, listener) is like thread.on(), but the listener will only be called once.\n\tonce(eventType: string, listener: (data: any) => void): this;\n\n\t// thread.removeAllListeners([eventType]) deletes all listeners for all eventTypes.If eventType is provided, deletes all listeners only for the event type eventType.\n\tremoveAllListeners(eventType?: string): this;\n\n\t// thread.emit(eventType, eventData[, eventData ... ]) emits an event of eventType with eventData inside the thread thread.All its arguments are.toString()ed.\n\temit(eventType: string, ...eventDatas: any[]): this;\n\n\t// thread.destroy( /* no arguments */) destroys the thread.\n\tdestroy(): this;\n}\n\nexport interface ThreadPool {\n\t// threadPool.load( absolutePath [, cb] ) runs thread.load( absolutePath [, cb] ) in all the pool's threads.\n\tload(absolutePath: string, cb?: (this: Thread, err: any, data: any) => void): this;\n\n\treadonly any: {\n\t\t// threadPool.any.eval( program, cb ) is like thread.eval(), but in any of the pool's threads.\n\t\teval(program: any, cb?: (this: Thread, err: any, data: any) => void): ThreadPool;\n\n\t\t// threadPool.any.emit( eventType, eventData [, eventData ... ] ) is like thread.emit(), but in any of the pool's threads.\n\t\temit(eventType: string, ...eventData: any[]): ThreadPool;\n\t}\n\n\treadonly all: {\n\t\t// threadPool.all.eval( program, cb ) is like thread.eval(), but in all the pool's threads.\n\t\teval(program: any, cb?: (this: Thread, err: any, data: any) => void): ThreadPool;\n\n\t\t// threadPool.all.emit( eventType, eventData [, eventData ... ] ) is like thread.emit(), but in all the pool's threads.\n\t\temit(eventType: string, ...eventData: any[]): ThreadPool;\n\t}\n\n\n\t// threadPool.on( eventType, listener ) is like thread.on(), but in all of the pool's threads.\n\ton(eventType: string, listener: CallBack): this;\n\n\t// threadPool.totalThreads() returns the number of threads in this pool: as supplied in .createPool( number )\n\ttotalThreads(): number;\n\n\t// threadPool.idleThreads() returns the number of threads in this pool that are currently idle (sleeping)\n\tidleThreads(): number;\n\n\t// threadPool.pendingJobs() returns the number of jobs pending.\n\tpendingJobs(): number;\n\n\t// threadPool.destroy( [ rudely ] ) waits until pendingJobs() is zero and then destroys the pool. If rudely is truthy, then it doesn't wait for pendingJobs === 0.\n\tdestroy(rudely?: boolean): void;\n}\n\nexport const Worker: WorkerConstructor;\n\nexport function createPool(numThreads: number): ThreadPool;\n\nexport function create(): Thread;\n"
        },
        {
          "name": "index.js",
          "type": "blob",
          "size": 0.0986328125,
          "content": "var WebWorkerThreads = require('bindings')('WebWorkerThreads');\n \nmodule.exports = WebWorkerThreads;\n"
        },
        {
          "name": "package.json",
          "type": "blob",
          "size": 2.24609375,
          "content": "{\n  \"name\": \"webworker-threads\",\n  \"version\": \"0.8.0\",\n  \"main\": \"index.js\",\n  \"description\": \"Lightweight Web Worker API implementation with native threads\",\n  \"keywords\": [\n    \"threads\",\n    \"web worker\",\n    \"a gogo\"\n  ],\n  \"author\": {\n    \"name\": \"Audrey Tang\",\n    \"email\": \"audreyt@audreyt.org\",\n    \"twitter\": \"audreyt\"\n  },\n  \"homepage\": \"https://github.com/audreyt/node-webworker-threads\",\n  \"bugs\": {\n    \"url\": \"http://github.com/audreyt/node-webworker-threads/issues\",\n    \"email\": \"audreyt@audreyt.org\"\n  },\n  \"license\": \"(MIT AND Apache-2.0)\",\n  \"licenses\": [\n    {\n      \"type\": \"Apache License, Version 2.0\",\n      \"url\": \"http://www.apache.org/licenses/LICENSE-2.0\"\n    },\n    {\n      \"type\": \"MIT\",\n      \"url\": \"file:LICENSE\"\n    }\n  ],\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"http://github.com/audreyt/node-webworker-threads.git\"\n  },\n  \"scripts\": {\n    \"js\": \"env PATH=./node_modules/.bin:\\\"$PATH\\\" lsc -cj package.ls;\\ngcc deps/minifier/src/minify.c -o deps/minifier/bin/minify;\\nenv PATH=./node_modules/.bin:\\\"$PATH\\\" lsc -cbp src/worker.ls                    > src/worker.js;\\n./deps/minifier/bin/minify kWorker_js            < src/worker.js          > src/worker.js.c;\\nenv PATH=./node_modules/.bin:\\\"$PATH\\\" lsc -cbp src/events.ls                    > src/events.js;\\n./deps/minifier/bin/minify kEvents_js            < src/events.js          > src/events.js.c;\\nenv PATH=./node_modules/.bin:\\\"$PATH\\\" lsc -cbp src/createPool.ls                > src/createPool.js;\\n./deps/minifier/bin/minify kCreatePool_js        < src/createPool.js      > src/createPool.js.c;\\nenv PATH=./node_modules/.bin:\\\"$PATH\\\" lsc -cbp src/thread_nextTick.ls           > src/thread_nextTick.js;\\n./deps/minifier/bin/minify kThread_nextTick_js 1 < src/thread_nextTick.js > src/thread_nextTick.js.c;\\nenv PATH=./node_modules/.bin:\\\"$PATH\\\" lsc -cbp src/load.ls                      > src/load.js;\\n./deps/minifier/bin/minify kLoad_js 1 1          < src/load.js            > src/load.js.c;\",\n    \"pretest\": \"npm run js && node-gyp rebuild\",\n    \"test\": \"./run-all-tests.sh\"\n  },\n  \"dependencies\": {\n    \"bindings\": \"^1.3.0\",\n    \"nan\": \"^2.12.1\"\n  },\n  \"devDependencies\": {\n    \"livescript\": \"^1.6.0\",\n    \"tap\": \"^5.7.1\"\n  },\n  \"gypfile\": true,\n  \"engines\": {\n    \"node\": \">= 0.10.16\"\n  }\n}\n"
        },
        {
          "name": "package.ls",
          "type": "blob",
          "size": 2.115234375,
          "content": "#!/usr/bin/env lsc -cj\nname: \\webworker-threads\nversion: \\0.8.0\nmain: \\index.js\ndescription: 'Lightweight Web Worker API implementation with native threads'\nkeywords: [ 'threads' 'web worker' 'a gogo' ]\nauthor:\n  name: 'Audrey Tang'\n  email: \\audreyt@audreyt.org\n  twitter: \\audreyt\nhomepage: \\https://github.com/audreyt/node-webworker-threads\nbugs:\n  url: \\http://github.com/audreyt/node-webworker-threads/issues\n  email: \\audreyt@audreyt.org\nlicense: \"(MIT AND Apache-2.0)\"\nlicenses: [\n    { type: \"Apache License, Version 2.0\", url: \"http://www.apache.org/licenses/LICENSE-2.0\" }\n    { type: 'MIT', url: \"file:LICENSE\" }\n]\nrepository:\n  type: \\git\n  url: \\http://github.com/audreyt/node-webworker-threads.git\nscripts:\n#  prepublish: 'env PATH=./node_modules/.bin:\"$PATH\" lsc -cj package.ls'\n  js: \"\"\"\n    env PATH=./node_modules/.bin:\"$PATH\" lsc -cj package.ls;\n    gcc deps/minifier/src/minify.c -o deps/minifier/bin/minify;\n    env PATH=./node_modules/.bin:\"$PATH\" lsc -cbp src/worker.ls                    > src/worker.js;\n    ./deps/minifier/bin/minify kWorker_js            < src/worker.js          > src/worker.js.c;\n    env PATH=./node_modules/.bin:\"$PATH\" lsc -cbp src/events.ls                    > src/events.js;\n    ./deps/minifier/bin/minify kEvents_js            < src/events.js          > src/events.js.c;\n    env PATH=./node_modules/.bin:\"$PATH\" lsc -cbp src/createPool.ls                > src/createPool.js;\n    ./deps/minifier/bin/minify kCreatePool_js        < src/createPool.js      > src/createPool.js.c;\n    env PATH=./node_modules/.bin:\"$PATH\" lsc -cbp src/thread_nextTick.ls           > src/thread_nextTick.js;\n    ./deps/minifier/bin/minify kThread_nextTick_js 1 < src/thread_nextTick.js > src/thread_nextTick.js.c;\n    env PATH=./node_modules/.bin:\"$PATH\" lsc -cbp src/load.ls                      > src/load.js;\n    ./deps/minifier/bin/minify kLoad_js 1 1          < src/load.js            > src/load.js.c;\n  \"\"\"\n  pretest: 'npm run js && node-gyp rebuild'\n  test: './run-all-tests.sh'\ndependencies:\n  bindings: \\^1.3.0\n  nan: \\^2.12.1\ndev-dependencies:\n  livescript: \\^1.6.0\n  tap: \\^5.7.1\ngypfile: true\nengines: { node: '>= 0.10.16' }\n"
        },
        {
          "name": "run-all-tests.sh",
          "type": "blob",
          "size": 0.46484375,
          "content": "#!/usr/bin/env bash\n\nOUTPUT=\"./run-all-tests-output.log\"\n\nexit_code=0\n\nnode ./test-package.js > ${OUTPUT}\n\n_term() {\n  echo \"Caught SIGTERM signal!\"\n  kill -TERM \"$child\" 2>/dev/null\n}\n\ntrap _term SIGTERM\n\nfor filename in ./test/*.js; do\n    timeout 5s node \"${filename}\" >> ${OUTPUT} &\n\n    child=$!\n    wait \"${child}\"\n\n    if [ $? = 0 ]; then\n        echo ${filename} \"passed!\"\n    else\n        echo ${filename} \"failed!\"\n        exit_code=1\n    fi\ndone\n\nexit ${exit_code}\n"
        },
        {
          "name": "src",
          "type": "tree",
          "content": null
        },
        {
          "name": "test-import-script.js",
          "type": "blob",
          "size": 0.31640625,
          "content": "function foo (arg$){\n  var max, i$, n, j$, to$, i;\n  max = arg$.data.max;\n  search: for (i$ = 2; i$ <= max; ++i$) {\n    n = i$;\n    for (j$ = 2, to$ = Math.sqrt(n); j$ <= to$; ++j$) {\n      i = j$;\n      if (!(n % i)) {\n        continue search;\n      }\n    }\n    postMessage({\n      result: n\n    });\n  }\n  throw 'done';\n};\n"
        },
        {
          "name": "test-package.js",
          "type": "blob",
          "size": 0.740234375,
          "content": "var Threads = require('./'),\n    tap = require('tap');\n\ntap.test('echo worker', function(t) {\n  var echoWorker = new Threads.Worker(function() {\n    this.onmessage = function(event) {\n      this.postMessage(event.data);\n    };\n  });\n\n  var echoData = 'asdf';\n  echoWorker.onmessage = function(event) {\n    t.equal(event.data, echoData);\n    echoWorker.terminate();\n    t.end();\n  };\n\n  echoWorker.postMessage(echoData);\n});\n\ntap.test('eval pool', function(t) {\n  var tcount = 0;\n  function test() {\n    console.log('test function in thread pool');\n  }\n\n  var mypool = Threads.createPool(5);\n  mypool.all.eval(test);\n  mypool.all.eval('test()', function(err, data) {\n    ++tcount;\n    if (tcount == 5) {\n      mypool.destroy();\n      t.end();\n    }\n  });\n});\n"
        },
        {
          "name": "test.js",
          "type": "blob",
          "size": 1.1748046875,
          "content": "// Generated by LiveScript 1.3.1\n(function(){\n  var Worker, w, slice$ = [].slice;\n  Worker = require('./').Worker;\n  w = new Worker(function(){\n    importScripts('test-imported-script.js');\n    return this.onmessage = foo;\n  });\n  w.onmessage = function(arg$){\n    var result;\n    result = arg$.data.result;\n    return console.log(result + \" is a prime\");\n  };\n  w.onerror = function(arg$){\n    var message, this$ = this;\n    message = arg$.message;\n    console.log(\"Caught:\", message);\n    return (typeof setImmediate != 'undefined' && setImmediate !== null\n      ? setImmediate\n      : partialize$.apply(this, [setTimeout, [void 8, 100], [0]]))(function(){\n      return this$.terminate();\n    });\n  };\n  w.postMessage({\n    max: 100\n  });\n  function partialize$(f, args, where){\n    var context = this;\n    return function(){\n      var params = slice$.call(arguments), i,\n          len = params.length, wlen = where.length,\n          ta = args ? args.concat() : [], tw = where ? where.concat() : [];\n      for(i = 0; i < len; ++i) { ta[tw[0]] = params[i]; tw.shift(); }\n      return len < wlen && len ?\n        partialize$.apply(context, [f, ta, tw]) : f.apply(context, ta);\n    };\n  }\n}).call(this);\n"
        },
        {
          "name": "test.ls",
          "type": "blob",
          "size": 0.3994140625,
          "content": "#!/usr/bin/env lsc\n{ Worker } = (require './')\nw = new Worker ->\n  # This also works, but less elegant:\n  # ``onmessage`` = (data: {max}) ->\n  importScripts 'test-import-script.js';\n  @onmessage = foo\nw.onmessage = (data: {result}) ->\n  console.log \"#result is a prime\"\nw.onerror = ({message}) ->\n  console.log \"Caught:\", message\n  <~ (setImmediate ? setTimeout _, 100ms)\n  @terminate!\nw.postMessage max: 100\n"
        },
        {
          "name": "test",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}