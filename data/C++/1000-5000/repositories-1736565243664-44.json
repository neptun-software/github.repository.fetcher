{
  "metadata": {
    "timestamp": 1736565243664,
    "page": 44,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjUw",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "vcmi/vcmi",
      "stars": 4661,
      "defaultBranch": "develop",
      "files": [
        {
          "name": ".gitattributes",
          "type": "blob",
          "size": 0.095703125,
          "content": "*.json linguist-language=JSON-with-Comments\n*.h linguist-language=C++\n*.cpp linguist-language=C++\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.8623046875,
          "content": "/client/vcmiclient\n/server/vcmiserver\n/launcher/.lupdate\n/launcher/vcmilauncher\n/mapeditor/.lupdate\n/launcher/vcmilauncher_automoc.cpp\n/conan-*\n\nbuild/\n.cache/*\nout/\n/.qt\n*.dll\n*.exe\n*.depend\n*.o\n*.a\n*.so\n*.res\n*.layout\n*.pro.user\n*.pro.user.*\n*.swp\n*.h.gch\n*~\n*.autosave.*\n/CMakeLists.txt.user\nCMakeCache.txt\nCMakeFiles\nMakefile\ncmake_install.cmake\ninstall_manifest.txt\nmoc_*.cpp\nqrc_*.cpp\nui_*.h\n/CPackConfig.cmake\n/CPackSourceConfig.cmake\nbuild-*\nCMakeLists.txt.user.*\nDoxyfile\ndoc/*\nVCMI_VS11.sdf\n*.ipch\nVCMI_VS11.opensdf\n.DS_Store\n.directory\nCMakeUserPresets.json\ncompile_commands.json\nfuzzylite.pc\n\n# Visual Studio\n*.suo\n*.user\n/AI/*/RD\n/AI/BattleAI/*/RD\n/client/RD\n/launcher/RD\n/lib/RD\n/lib/minizip/RD\n/lib/minizip/*/RD\n/scripting/erm/RD\n/scripting/erm/*/RD\n/server/RD\n/test/RD\n/VCMI_VS11.VC.opendb\n/AI/FuzzyLite.lib\n/deps\n.vs/\n\n# Visual Studio Code\n/.vscode/\n\n# CLion\n.idea/\n"
        },
        {
          "name": ".gitmodules",
          "type": "blob",
          "size": 0.3447265625,
          "content": "[submodule \"test/googletest\"]\n\tpath = test/googletest\n\turl = https://github.com/google/googletest\n\tbranch = v1.15.x\n[submodule \"AI/FuzzyLite\"]\n\tpath = AI/FuzzyLite\n\turl = https://github.com/fuzzylite/fuzzylite.git\n\tbranch = release\n[submodule \"innoextract\"]\n\tpath = launcher/lib/innoextract\n\turl = https://github.com/vcmi/innoextract.git\n\tbranch = vcmi\n"
        },
        {
          "name": ".travis.yml",
          "type": "blob",
          "size": 2.4619140625,
          "content": "language: cpp\nos:\n- linux\n- osx\ndist: trusty\nsudo: required\nenv:\n  matrix:\n    - ignore=this\n  global:\n  - secure: NMg+qtQB4DIZ/KqlDeIn3K7A7Ydksdpnbv6Ha9n4bSSA0AT8wlPwbHXvQmiR8qYs6cnz4fyY6NVcBe7X3bdR8jWyPNAS0l0QByqG12q3dBpEtNNn0X5u/GS3wHse5+ObNAF9a83+xACTQj2UdxqHgJ3LFGzdBpQt3kLsc8NDnn8=\n\nmatrix:\n  exclude:\n  - env: ignore=this\n  include:\n  - os: linux\n    compiler: clang\n    env: VCMI_PLATFORM='linux' REAL_CC=clang-3.6 REAL_CXX=clang++-3.6 PACKAGE=clang-3.6\n      SUPPORT=libstdc++-4.8-dev\n  - os: linux\n    compiler: clang\n    env: VCMI_PLATFORM='linux' REAL_CC=clang-3.4 REAL_CXX=clang++-3.4 PACKAGE=clang-3.4\n      SUPPORT=libstdc++-4.8-dev\n  - os: linux\n    compiler: gcc\n    env: VCMI_PLATFORM='linux' REAL_CC=gcc-4.8   REAL_CXX=g++-4.8     PACKAGE=g++-4.8   SUPPORT=\n  - os: linux\n    env: VCMI_PLATFORM='mxe' MXE_TARGET=i686-w64-mingw32.shared VCMI_CMAKE_FLAGS='-DENABLE_TEST=0'\n    sudo: required\n  - os: osx\n    env: VCMI_PLATFORM='mac' VCMI_CMAKE_FLAGS='-DENABLE_TEST=0'\n\naddons:\n  apt:\n    update: true\n  coverity_scan:\n    project:\n      name: vcmi/vcmi\n      description: Build submitted via Travis CI\n    notification_email: coverity@arseniyshestakov.com\n    build_command_prepend: cov-configure --compiler clang-3.6 --comptype clangcc &&\n      cov-configure --comptype clangcxx --compiler clang++-3.6 && cmake -G Ninja ..\n      -DCMAKE_BUILD_TYPE=DEBUG -DENABLE_LAUNCHER=0 -DENABLE_EDITOR=0\n    build_command: ninja -j 3\n    branch_pattern: coverity_scan\n\nnotifications:\n  email:\n    recipients:\n    - noreply@vcmi.eu\n    on_success: change\n    on_failure: always\n\nbefore_install:\n- test $TRAVIS_BRANCH != coverity_scan -o ${TRAVIS_JOB_NUMBER##*.} = 1 || exit 0\n- . $TRAVIS_BUILD_DIR/CI/$VCMI_PLATFORM/before_install.sh\n\nbefore_script:\n- mkdir build\n- cd build\n- if [[ $TRAVIS_BRANCH != 'coverity_scan' ]];\n  then\n    source $TRAVIS_BUILD_DIR/CI/get_package_name.sh;\n    if [[ $VCMI_PLATFORM == 'mxe' ]];\n    then\n      /usr/lib/mxe/usr/bin/i686-w64-mingw32.shared-cmake -G Ninja .. $VCMI_CMAKE_FLAGS\n      -DPACKAGE_NAME_SUFFIX:STRING=\"$VCMI_PACKAGE_NAME_SUFFIX\"\n      -DPACKAGE_FILE_NAME:STRING=\"$VCMI_PACKAGE_FILE_NAME\";\n    else\n      cmake -G Ninja .. $VCMI_CMAKE_FLAGS\n      -DPACKAGE_NAME_SUFFIX:STRING=\"$VCMI_PACKAGE_NAME_SUFFIX\"\n      -DPACKAGE_FILE_NAME:STRING=\"$VCMI_PACKAGE_FILE_NAME\";\n    fi\n\n  fi\n  \nscript:\n- test $TRAVIS_BRANCH != coverity_scan || exit 0\n- ninja\n\nafter_success:\n- test $TRAVIS_BRANCH != coverity_scan || exit 0\n- . $TRAVIS_BUILD_DIR/CI/$VCMI_PLATFORM/upload_package.sh\n"
        },
        {
          "name": "AI",
          "type": "tree",
          "content": null
        },
        {
          "name": "AUTHORS.h",
          "type": "blob",
          "size": 4.09375,
          "content": "/*\n * AUTHORS.h, part of VCMI engine\n *\n * Authors: listed in file AUTHORS in main folder\n *\n * License: GNU General Public License v2.0 or later\n * Full text of license available in license.txt file, in main folder\n *\n */\n#pragma once\n\n//VCMI PROJECT CODE CONTRIBUTORS:\nconst std::vector<std::vector<std::string>> contributors = {\n//   Task          Name                    Aka                      E-Mail\n   { \"Idea\",       \"Michał Urbańczyk\",     \"Tow\",                   \"impono@gmail.com\"             },\n   { \"Idea\",       \"Mateusz B.\",           \"Tow dragon\",            \"matcio1@gmail.com\"            },\n\n   { \"Developing\", \"Andrea Palmate\",       \"afxgroup\",              \"andrea@amigasoft.net\"         },\n   { \"Developing\", \"Alexander Shishkin\",   \"alexvins\",              \"\"                             },\n   { \"Developing\", \"Rafal R.\",             \"ambtrip\",               \"ambtrip@wp.pl\"                },\n   { \"Developing\", \"Andrii Danylchenko\",   \"\",                      \"\"                             },\n   { \"Developing\", \"Benjamin Gentner\",     \"beegee\",                \"\"                             },\n   { \"Developing\", \"Piotr Wójcik\",         \"Chocimier\",             \"chocimier@tlen.pl\"            },\n   { \"Developing\", \"Dmitry Orlov\",         \"\",                      \"shubus.corporation@gmail.com\" },\n   { \"Developing\", \"\",                     \"Dydzio\",                \"blood990@gmail.com\"           },\n   { \"Developing\", \"Andrzej Żak\",          \"godric3\",               \"\"                             },\n   { \"Developing\", \"Henning Koehler\",      \"henningkoehlernz\",      \"henning.koehler.nz@gmail.com\" },\n   { \"Developing\", \"Ivan Savenko\",         \"\",                      \"saven.ivan@gmail.com\"         },\n   { \"Developing\", \"\",                     \"kambala-decapitator\",   \"decapitator@ukr.net\"          },\n   { \"Developing\", \"\",                     \"krs0\",                  \"\"                             },\n   { \"Developing\", \"\",                     \"Laserlicht\",            \"\"                             },\n   { \"Developing\", \"Alexey\",               \"Macron1Robot\",          \"\"                             },\n   { \"Developing\", \"Michał Kalinowski\",    \"\",                      \"feniks_fire@o2.pl\"            },\n   { \"Developing\", \"Vadim Glazunov\",       \"neweagle\",              \"neweagle@gmail.com\"           },\n   { \"Developing\", \"Andrey Cherkas\",       \"nordsoft\",              \"nordsoft@yahoo.com\"           },\n   { \"Developing\", \"Rickard Westerlund\",   \"Onion Knight\",          \"onionknigh@gmail.com\"         },\n   { \"Developing\", \"Yifeng Sun\",           \"phoebus118\",            \"pkusunyifeng@gmail.com\"       },\n   { \"Developing\", \"\",                     \"rilian-la-te\",          \"\"                             },\n   { \"Developing\", \"\",                     \"SoundSSGood\",           \"\"                             },\n   { \"Developing\", \"Stefan Pavlov\",        \"Ste\",                   \"mailste@gmail.com\"            },\n   { \"Developing\", \"Arseniy Shestakov\",    \"SXX\",                   \"me@arseniyshestakov.com\"      },\n   { \"Developing\", \"Lukasz Wychrystenko\",  \"tezeriusz\",             \"t0@czlug.icis.pcz.pl\"         },\n   { \"Developing\", \"Trevor Standley\",      \"tstandley\",             \"\"                             },\n   { \"Developing\", \"Vadim Markovtsev\",     \"\",                      \"gmarkhor@gmail.com\"           },\n   { \"Developing\", \"Frank Zago\",           \"ubuntux\",               \"\"                             },\n   { \"Developing\", \"\",                     \"vmarkovtsev\",           \"\"                             },\n   { \"Developing\", \"Tom Zielinski\",        \"Warmonger\",             \"Warmonger@vp.pl\"              },\n   { \"Developing\", \"Xiaomin Ding\",         \"\",                      \"dingding303@gmail.com\"        },\n   { \"Developing\", \"Fenghuang Rumeng\",     \"kdmcser\",               \"zqtndfj@gmail.com\"             },\n\n   { \"Testing\",    \"Ben Yan\",              \"by003\",                 \"benyan9110@gmail.com,\"        },\n   { \"Testing\",    \"\",                     \"Misiokles\",             \"\"                             },\n   { \"Testing\",    \"\",                     \"Povelitel\",             \"\"                             },\n};\n"
        },
        {
          "name": "CCallback.cpp",
          "type": "blob",
          "size": 13.23828125,
          "content": "/*\n * CCallback.cpp, part of VCMI engine\n *\n * Authors: listed in file AUTHORS in main folder\n *\n * License: GNU General Public License v2.0 or later\n * Full text of license available in license.txt file, in main folder\n *\n */\n#include \"StdInc.h\"\n#include \"CCallback.h\"\n\n#include \"lib/CCreatureHandler.h\"\n#include \"lib/gameState/CGameState.h\"\n#include \"client/CPlayerInterface.h\"\n#include \"client/Client.h\"\n#include \"lib/mapping/CMap.h\"\n#include \"lib/mapObjects/CGHeroInstance.h\"\n#include \"lib/mapObjects/CGTownInstance.h\"\n#include \"lib/texts/CGeneralTextHandler.h\"\n#include \"lib/CArtHandler.h\"\n#include \"lib/GameConstants.h\"\n#include \"lib/CPlayerState.h\"\n#include \"lib/UnlockGuard.h\"\n#include \"lib/battle/BattleInfo.h\"\n#include \"lib/networkPacks/PacksForServer.h\"\n#include \"lib/networkPacks/SaveLocalState.h\"\n\nbool CCallback::teleportHero(const CGHeroInstance *who, const CGTownInstance *where)\n{\n\tCastleTeleportHero pack(who->id, where->id, 1);\n\tsendRequest(pack);\n\treturn true;\n}\n\nvoid CCallback::moveHero(const CGHeroInstance *h, const int3 & destination, bool transit)\n{\n\tMoveHero pack({destination}, h->id, transit);\n\tsendRequest(pack);\n}\n\nvoid CCallback::moveHero(const CGHeroInstance *h, const std::vector<int3> & path, bool transit)\n{\n\tMoveHero pack(path, h->id, transit);\n\tsendRequest(pack);\n}\n\nint CCallback::selectionMade(int selection, QueryID queryID)\n{\n\treturn sendQueryReply(selection, queryID);\n}\n\nint CCallback::sendQueryReply(std::optional<int32_t> reply, QueryID queryID)\n{\n\tASSERT_IF_CALLED_WITH_PLAYER\n\tif(queryID == QueryID(-1))\n\t{\n\t\tlogGlobal->error(\"Cannot answer the query -1!\");\n\t\treturn -1;\n\t}\n\n\tQueryReply pack(queryID, reply);\n\tpack.player = *player;\n\treturn sendRequest(pack);\n}\n\nvoid CCallback::recruitCreatures(const CGDwelling * obj, const CArmedInstance * dst, CreatureID ID, ui32 amount, si32 level)\n{\n\t// TODO exception for neutral dwellings shouldn't be hardcoded\n\tif(player != obj->tempOwner && obj->ID != Obj::WAR_MACHINE_FACTORY && obj->ID != Obj::REFUGEE_CAMP)\n\t\treturn;\n\n\tRecruitCreatures pack(obj->id, dst->id, ID, amount, level);\n\tsendRequest(pack);\n}\n\nbool CCallback::dismissCreature(const CArmedInstance *obj, SlotID stackPos)\n{\n\tif((player && obj->tempOwner != player) || (obj->stacksCount()<2  && obj->needsLastStack()))\n\t\treturn false;\n\n\tDisbandCreature pack(stackPos,obj->id);\n\tsendRequest(pack);\n\treturn true;\n}\n\nbool CCallback::upgradeCreature(const CArmedInstance *obj, SlotID stackPos, CreatureID newID)\n{\n\tUpgradeCreature pack(stackPos,obj->id,newID);\n\tsendRequest(pack);\n\treturn false;\n}\n\nvoid CCallback::endTurn()\n{\n\tlogGlobal->trace(\"Player %d ended his turn.\", player->getNum());\n\tEndTurn pack;\n\tsendRequest(pack);\n}\nint CCallback::swapCreatures(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2)\n{\n\tArrangeStacks pack(1,p1,p2,s1->id,s2->id,0);\n\tsendRequest(pack);\n\treturn 0;\n}\n\nint CCallback::mergeStacks(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2)\n{\n\tArrangeStacks pack(2,p1,p2,s1->id,s2->id,0);\n\tsendRequest(pack);\n\treturn 0;\n}\n\nint CCallback::splitStack(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2, int val)\n{\n\tArrangeStacks pack(3,p1,p2,s1->id,s2->id,val);\n\tsendRequest(pack);\n\treturn 0;\n}\n\nint CCallback::bulkMoveArmy(ObjectInstanceID srcArmy, ObjectInstanceID destArmy, SlotID srcSlot)\n{\n\tBulkMoveArmy pack(srcArmy, destArmy, srcSlot);\n\tsendRequest(pack);\n\treturn 0;\n}\n\nint CCallback::bulkSplitStack(ObjectInstanceID armyId, SlotID srcSlot, int howMany)\n{\n\tBulkSplitStack pack(armyId, srcSlot, howMany);\n\tsendRequest(pack);\n\treturn 0;\n}\n\nint CCallback::bulkSmartSplitStack(ObjectInstanceID armyId, SlotID srcSlot)\n{\n\tBulkSmartSplitStack pack(armyId, srcSlot);\n\tsendRequest(pack);\n\treturn 0;\n}\n\nint CCallback::bulkMergeStacks(ObjectInstanceID armyId, SlotID srcSlot)\n{\n\tBulkMergeStacks pack(armyId, srcSlot);\n\tsendRequest(pack);\n\treturn 0;\n}\n\nbool CCallback::dismissHero(const CGHeroInstance *hero)\n{\n\tif(player!=hero->tempOwner) return false;\n\n\tDismissHero pack(hero->id);\n\tsendRequest(pack);\n\treturn true;\n}\n\nbool CCallback::swapArtifacts(const ArtifactLocation &l1, const ArtifactLocation &l2)\n{\n\tExchangeArtifacts ea;\n\tea.src = l1;\n\tea.dst = l2;\n\tsendRequest(ea);\n\treturn true;\n}\n\n/**\n * Assembles or disassembles a combination artifact.\n * @param hero Hero holding the artifact(s).\n * @param artifactSlot The worn slot ID of the combination- or constituent artifact.\n * @param assemble True for assembly operation, false for disassembly.\n * @param assembleTo If assemble is true, this represents the artifact ID of the combination\n * artifact to assemble to. Otherwise it's not used.\n */\nvoid CCallback::assembleArtifacts(const ObjectInstanceID & heroID, ArtifactPosition artifactSlot, bool assemble, ArtifactID assembleTo)\n{\n\tAssembleArtifacts aa(heroID, artifactSlot, assemble, assembleTo);\n\tsendRequest(aa);\n}\n\nvoid CCallback::bulkMoveArtifacts(ObjectInstanceID srcHero, ObjectInstanceID dstHero, bool swap, bool equipped, bool backpack)\n{\n\tBulkExchangeArtifacts bma(srcHero, dstHero, swap, equipped, backpack);\n\tsendRequest(bma);\n}\n\nvoid CCallback::scrollBackpackArtifacts(ObjectInstanceID hero, bool left)\n{\n\tManageBackpackArtifacts mba(hero, ManageBackpackArtifacts::ManageCmd::SCROLL_RIGHT);\n\tif(left)\n\t\tmba.cmd = ManageBackpackArtifacts::ManageCmd::SCROLL_LEFT;\n\tsendRequest(mba);\n}\n\nvoid CCallback::sortBackpackArtifactsBySlot(const ObjectInstanceID hero)\n{\n\tManageBackpackArtifacts mba(hero, ManageBackpackArtifacts::ManageCmd::SORT_BY_SLOT);\n\tsendRequest(mba);\n}\n\nvoid CCallback::sortBackpackArtifactsByCost(const ObjectInstanceID hero)\n{\n\tManageBackpackArtifacts mba(hero, ManageBackpackArtifacts::ManageCmd::SORT_BY_COST);\n\tsendRequest(mba);\n}\n\nvoid CCallback::sortBackpackArtifactsByClass(const ObjectInstanceID hero)\n{\n\tManageBackpackArtifacts mba(hero, ManageBackpackArtifacts::ManageCmd::SORT_BY_CLASS);\n\tsendRequest(mba);\n}\n\nvoid CCallback::manageHeroCostume(ObjectInstanceID hero, size_t costumeIndex, bool saveCostume)\n{\n\tManageEquippedArtifacts mea(hero, costumeIndex, saveCostume);\n\tsendRequest(mea);\n}\n\nvoid CCallback::eraseArtifactByClient(const ArtifactLocation & al)\n{\n\tEraseArtifactByClient ea(al);\n\tsendRequest(ea);\n}\n\nbool CCallback::buildBuilding(const CGTownInstance *town, BuildingID buildingID)\n{\n\tif(town->tempOwner!=player)\n\t\treturn false;\n\n\tif(canBuildStructure(town, buildingID) != EBuildingState::ALLOWED)\n\t\treturn false;\n\n\tBuildStructure pack(town->id,buildingID);\n\tsendRequest(pack);\n\treturn true;\n}\n\nbool CCallback::visitTownBuilding(const CGTownInstance *town, BuildingID buildingID)\n{\n\tif(town->tempOwner!=player)\n\t\treturn false;\n\n\tVisitTownBuilding pack(town->id, buildingID);\n\tsendRequest(pack);\n\treturn true;\n}\n\nvoid CBattleCallback::battleMakeSpellAction(const BattleID & battleID, const BattleAction & action)\n{\n\tassert(action.actionType == EActionType::HERO_SPELL);\n\tMakeAction mca(action);\n\tmca.battleID = battleID;\n\tsendRequest(mca);\n}\n\nint CBattleCallback::sendRequest(const CPackForServer & request)\n{\n\tint requestID = cl->sendRequest(request, *getPlayerID());\n\tif(waitTillRealize)\n\t{\n\t\tlogGlobal->trace(\"We'll wait till request %d is answered.\\n\", requestID);\n\t\tauto gsUnlocker = vstd::makeUnlockSharedGuardIf(CGameState::mutex, unlockGsWhenWaiting);\n\t\tCClient::waitingRequest.waitWhileContains(requestID);\n\t}\n\n\tboost::this_thread::interruption_point();\n\treturn requestID;\n}\n\nvoid CCallback::spellResearch( const CGTownInstance *town, SpellID spellAtSlot, bool accepted )\n{\n\tSpellResearch pack(town->id, spellAtSlot, accepted);\n\tsendRequest(pack);\n}\n\nvoid CCallback::swapGarrisonHero( const CGTownInstance *town )\n{\n\tif(town->tempOwner == *player || (town->garrisonHero && town->garrisonHero->tempOwner == *player ))\n\t{\n\t\tGarrisonHeroSwap pack(town->id);\n\t\tsendRequest(pack);\n\t}\n}\n\nvoid CCallback::buyArtifact(const CGHeroInstance *hero, ArtifactID aid)\n{\n\tif(hero->tempOwner != *player) return;\n\n\tBuyArtifact pack(hero->id,aid);\n\tsendRequest(pack);\n}\n\nvoid CCallback::trade(const ObjectInstanceID marketId, EMarketMode mode, TradeItemSell id1, TradeItemBuy id2, ui32 val1, const CGHeroInstance * hero)\n{\n\ttrade(marketId, mode, std::vector(1, id1), std::vector(1, id2), std::vector(1, val1), hero);\n}\n\nvoid CCallback::trade(const ObjectInstanceID marketId, EMarketMode mode, const std::vector<TradeItemSell> & id1, const std::vector<TradeItemBuy> & id2, const std::vector<ui32> & val1, const CGHeroInstance * hero)\n{\n\tTradeOnMarketplace pack;\n\tpack.marketId = marketId;\n\tpack.heroId = hero ? hero->id : ObjectInstanceID();\n\tpack.mode = mode;\n\tpack.r1 = id1;\n\tpack.r2 = id2;\n\tpack.val = val1;\n\tsendRequest(pack);\n}\n\nvoid CCallback::setFormation(const CGHeroInstance * hero, EArmyFormation mode)\n{\n\tSetFormation pack(hero->id, mode);\n\tsendRequest(pack);\n}\n\nvoid CCallback::recruitHero(const CGObjectInstance *townOrTavern, const CGHeroInstance *hero, const HeroTypeID & nextHero)\n{\n\tassert(townOrTavern);\n\tassert(hero);\n\n\tHireHero pack(hero->getHeroTypeID(), townOrTavern->id, nextHero);\n\tpack.player = *player;\n\tsendRequest(pack);\n}\n\nvoid CCallback::saveLocalState(const JsonNode & data)\n{\n\tSaveLocalState state;\n\tstate.data = data;\n\tstate.player = *player;\n\n\tsendRequest(state);\n}\n\nvoid CCallback::save( const std::string &fname )\n{\n\tcl->save(fname);\n}\n\nvoid CCallback::gamePause(bool pause)\n{\n\tif(pause)\n\t{\n\t\tGamePause pack;\n\t\tpack.player = *player;\n\t\tsendRequest(pack);\n\t}\n\telse\n\t{\n\t\tsendQueryReply(0, QueryID::CLIENT);\n\t}\n}\n\nvoid CCallback::sendMessage(const std::string &mess, const CGObjectInstance * currentObject)\n{\n\tASSERT_IF_CALLED_WITH_PLAYER\n\tPlayerMessage pm(mess, currentObject? currentObject->id : ObjectInstanceID(-1));\n\tif(player)\n\t\tpm.player = *player;\n\tsendRequest(pm);\n}\n\nvoid CCallback::buildBoat( const IShipyard *obj )\n{\n\tBuildBoat bb;\n\tbb.objid = dynamic_cast<const CGObjectInstance*>(obj)->id;\n\tsendRequest(bb);\n}\n\nCCallback::CCallback(CGameState * GS, std::optional<PlayerColor> Player, CClient * C)\n\t: CBattleCallback(Player, C)\n{\n\tgs = GS;\n\n\twaitTillRealize = false;\n\tunlockGsWhenWaiting = false;\n}\n\nCCallback::~CCallback() = default;\n\nbool CCallback::canMoveBetween(const int3 &a, const int3 &b)\n{\n\t//bidirectional\n\treturn gs->map->canMoveBetween(a, b);\n}\n\nstd::shared_ptr<const CPathsInfo> CCallback::getPathsInfo(const CGHeroInstance * h)\n{\n\treturn cl->getPathsInfo(h);\n}\n\nstd::optional<PlayerColor> CCallback::getPlayerID() const\n{\n\treturn CBattleCallback::getPlayerID();\n}\n\nint3 CCallback::getGuardingCreaturePosition(int3 tile)\n{\n\tif (!gs->map->isInTheMap(tile))\n\t\treturn int3(-1,-1,-1);\n\n\treturn gs->map->guardingCreaturePositions[tile.z][tile.x][tile.y];\n}\n\nvoid CCallback::dig( const CGObjectInstance *hero )\n{\n\tDigWithHero dwh;\n\tdwh.id = hero->id;\n\tsendRequest(dwh);\n}\n\nvoid CCallback::castSpell(const CGHeroInstance *hero, SpellID spellID, const int3 &pos)\n{\n\tCastAdvSpell cas;\n\tcas.hid = hero->id;\n\tcas.sid = spellID;\n\tcas.pos = pos;\n\tsendRequest(cas);\n}\n\nint CCallback::mergeOrSwapStacks(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2)\n{\n\tif(s1->getCreature(p1) == s2->getCreature(p2))\n\t\treturn mergeStacks(s1, s2, p1, p2);\n\telse\n\t\treturn swapCreatures(s1, s2, p1, p2);\n}\n\nvoid CCallback::registerBattleInterface(std::shared_ptr<IBattleEventsReceiver> battleEvents)\n{\n\tcl->additionalBattleInts[*player].push_back(battleEvents);\n}\n\nvoid CCallback::unregisterBattleInterface(std::shared_ptr<IBattleEventsReceiver> battleEvents)\n{\n\tcl->additionalBattleInts[*player] -= battleEvents;\n}\n\nCBattleCallback::CBattleCallback(std::optional<PlayerColor> player, CClient * C):\n\tcl(C),\n\tplayer(player)\n{\n}\n\nvoid CBattleCallback::battleMakeUnitAction(const BattleID & battleID, const BattleAction & action)\n{\n\tassert(!cl->gs->getBattle(battleID)->tacticDistance);\n\tMakeAction ma;\n\tma.ba = action;\n\tma.battleID = battleID;\n\tsendRequest(ma);\n}\n\nvoid CBattleCallback::battleMakeTacticAction(const BattleID & battleID, const BattleAction & action )\n{\n\tassert(cl->gs->getBattle(battleID)->tacticDistance);\n\tMakeAction ma;\n\tma.ba = action;\n\tma.battleID = battleID;\n\tsendRequest(ma);\n}\n\nstd::optional<BattleAction> CBattleCallback::makeSurrenderRetreatDecision(const BattleID & battleID, const BattleStateInfoForRetreat & battleState)\n{\n\treturn cl->playerint[getPlayerID().value()]->makeSurrenderRetreatDecision(battleID, battleState);\n}\n\nstd::shared_ptr<CPlayerBattleCallback> CBattleCallback::getBattle(const BattleID & battleID)\n{\n\tif (activeBattles.count(battleID))\n\t\treturn activeBattles.at(battleID);\n\n\tthrow std::runtime_error(\"Failed to find battle \" + std::to_string(battleID.getNum()) + \" of player \" + player->toString() + \". Number of ongoing battles: \" + std::to_string(activeBattles.size()));\n}\n\nstd::optional<PlayerColor> CBattleCallback::getPlayerID() const\n{\n\treturn player;\n}\n\nvoid CBattleCallback::onBattleStarted(const IBattleInfo * info)\n{\n\tif (activeBattles.count(info->getBattleID()) > 0)\n\t\tthrow std::runtime_error(\"Player \" + player->toString() + \" is already engaged in battle \" + std::to_string(info->getBattleID().getNum()));\n\n\tlogGlobal->debug(\"Battle %d started for player %s\", info->getBattleID(), player->toString());\n\tactiveBattles[info->getBattleID()] = std::make_shared<CPlayerBattleCallback>(info, *getPlayerID());\n}\n\nvoid CBattleCallback::onBattleEnded(const BattleID & battleID)\n{\n\tif (activeBattles.count(battleID) == 0)\n\t\tthrow std::runtime_error(\"Player \" + player->toString() + \" is not engaged in battle \" + std::to_string(battleID.getNum()));\n\n\tlogGlobal->debug(\"Battle %d ended for player %s\", battleID, player->toString());\n\tactiveBattles.erase(battleID);\n}\n"
        },
        {
          "name": "CCallback.h",
          "type": "blob",
          "size": 12.2958984375,
          "content": "/*\n * CCallback.h, part of VCMI engine\n *\n * Authors: listed in file AUTHORS in main folder\n *\n * License: GNU General Public License v2.0 or later\n * Full text of license available in license.txt file, in main folder\n *\n */\n#pragma once\n\n#include \"lib/CGameInfoCallback.h\"\n#include \"lib/battle/CPlayerBattleCallback.h\"\n#include \"lib/int3.h\" // for int3\n#include \"lib/networkPacks/TradeItem.h\"\n\nVCMI_LIB_NAMESPACE_BEGIN\n\nclass CGHeroInstance;\nclass CGameState;\nstruct CPath;\nclass CGObjectInstance;\nclass CArmedInstance;\nclass BattleAction;\nclass CGTownInstance;\nclass IShipyard;\nstruct CGPathNode;\nstruct CGPath;\nstruct CPathsInfo;\nclass PathfinderConfig;\nstruct CPack;\nstruct CPackForServer;\nclass IBattleEventsReceiver;\nclass IGameEventsReceiver;\nstruct ArtifactLocation;\nclass BattleStateInfoForRetreat;\n\nVCMI_LIB_NAMESPACE_END\n\n// in static AI build this file gets included into libvcmi\n#ifdef STATIC_AI\nVCMI_LIB_USING_NAMESPACE\n#endif\n\nclass CClient;\nstruct lua_State;\n\nclass IBattleCallback\n{\npublic:\n\tvirtual ~IBattleCallback() = default;\n\n\tbool waitTillRealize = false; //if true, request functions will return after they are realized by server\n\tbool unlockGsWhenWaiting = false;//if true after sending each request, gs mutex will be unlocked so the changes can be applied; NOTICE caller must have gs mx locked prior to any call to actiob callback!\n\t//battle\n\tvirtual void battleMakeSpellAction(const BattleID & battleID, const BattleAction & action) = 0;\n\tvirtual void battleMakeUnitAction(const BattleID & battleID, const BattleAction & action) = 0;\n\tvirtual void battleMakeTacticAction(const BattleID & battleID, const BattleAction & action) = 0;\n\tvirtual std::optional<BattleAction> makeSurrenderRetreatDecision(const BattleID & battleID, const BattleStateInfoForRetreat & battleState) = 0;\n\n\tvirtual std::shared_ptr<CPlayerBattleCallback> getBattle(const BattleID & battleID) = 0;\n\tvirtual std::optional<PlayerColor> getPlayerID() const = 0;\n};\n\nclass IGameActionCallback\n{\npublic:\n\t//hero\n\tvirtual void moveHero(const CGHeroInstance *h, const std::vector<int3> & path, bool transit) =0; //moves hero alongside provided path\n\tvirtual void moveHero(const CGHeroInstance *h, const int3 & destination, bool transit) =0; //moves hero alongside provided path\n\tvirtual bool dismissHero(const CGHeroInstance * hero)=0; //dismisses given hero; true - successfully, false - not successfully\n\tvirtual void dig(const CGObjectInstance *hero)=0;\n\tvirtual void castSpell(const CGHeroInstance *hero, SpellID spellID, const int3 &pos = int3(-1, -1, -1))=0; //cast adventure map spell\n\n\t//town\n\tvirtual void recruitHero(const CGObjectInstance *townOrTavern, const CGHeroInstance *hero, const HeroTypeID & nextHero=HeroTypeID::NONE)=0;\n\tvirtual bool buildBuilding(const CGTownInstance *town, BuildingID buildingID)=0;\n\tvirtual bool visitTownBuilding(const CGTownInstance *town, BuildingID buildingID)=0;\n\tvirtual void recruitCreatures(const CGDwelling *obj, const CArmedInstance * dst, CreatureID ID, ui32 amount, si32 level=-1)=0;\n\tvirtual bool upgradeCreature(const CArmedInstance *obj, SlotID stackPos, CreatureID newID=CreatureID::NONE)=0; //if newID==-1 then best possible upgrade will be made\n\tvirtual void spellResearch(const CGTownInstance *town, SpellID spellAtSlot, bool accepted)=0;\n\tvirtual void swapGarrisonHero(const CGTownInstance *town)=0;\n\n\tvirtual void trade(const ObjectInstanceID marketId, EMarketMode mode, TradeItemSell id1, TradeItemBuy id2, ui32 val1, const CGHeroInstance * hero)=0; //mode==0: sell val1 units of id1 resource for id2 resiurce\n\tvirtual void trade(const ObjectInstanceID marketId, EMarketMode mode, const std::vector<TradeItemSell> & id1, const std::vector<TradeItemBuy> & id2, const std::vector<ui32> & val1, const CGHeroInstance * hero)=0;\n\n\tvirtual int selectionMade(int selection, QueryID queryID) =0;\n\tvirtual int sendQueryReply(std::optional<int32_t> reply, QueryID queryID) =0;\n\tvirtual int swapCreatures(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2)=0;//swaps creatures between two possibly different garrisons // TODO: AI-unsafe code - fix it!\n\tvirtual int mergeStacks(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2)=0;//joins first stack to the second (creatures must be same type)\n\tvirtual int mergeOrSwapStacks(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2) =0; //first goes to the second\n\tvirtual int splitStack(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2, int val)=0;//split creatures from the first stack\n\t//virtual bool swapArtifacts(const CGHeroInstance * hero1, ui16 pos1, const CGHeroInstance * hero2, ui16 pos2)=0; //swaps artifacts between two given heroes\n\tvirtual bool swapArtifacts(const ArtifactLocation &l1, const ArtifactLocation &l2)=0;\n\tvirtual void scrollBackpackArtifacts(ObjectInstanceID hero, bool left) = 0;\n\tvirtual void sortBackpackArtifactsBySlot(const ObjectInstanceID hero) = 0;\n\tvirtual void sortBackpackArtifactsByCost(const ObjectInstanceID hero) = 0;\n\tvirtual void sortBackpackArtifactsByClass(const ObjectInstanceID hero) = 0;\n\tvirtual void manageHeroCostume(ObjectInstanceID hero, size_t costumeIndex, bool saveCostume) = 0;\n\tvirtual void assembleArtifacts(const ObjectInstanceID & heroID, ArtifactPosition artifactSlot, bool assemble, ArtifactID assembleTo)=0;\n\tvirtual void eraseArtifactByClient(const ArtifactLocation & al)=0;\n\tvirtual bool dismissCreature(const CArmedInstance *obj, SlotID stackPos)=0;\n\tvirtual void saveLocalState(const JsonNode & data)=0;\n\tvirtual void endTurn()=0;\n\tvirtual void buyArtifact(const CGHeroInstance *hero, ArtifactID aid)=0; //used to buy artifacts in towns (including spell book in the guild and war machines in blacksmith)\n\tvirtual void setFormation(const CGHeroInstance * hero, EArmyFormation mode)=0;\n\n\tvirtual void save(const std::string &fname) = 0;\n\tvirtual void sendMessage(const std::string &mess, const CGObjectInstance * currentObject = nullptr) = 0;\n\tvirtual void gamePause(bool pause) = 0;\n\tvirtual void buildBoat(const IShipyard *obj) = 0;\n\n\t// To implement high-level army management bulk actions\n\tvirtual int bulkMoveArmy(ObjectInstanceID srcArmy, ObjectInstanceID destArmy, SlotID srcSlot) = 0;\n\tvirtual int bulkSplitStack(ObjectInstanceID armyId, SlotID srcSlot, int howMany = 1) = 0;\n\tvirtual int bulkSmartSplitStack(ObjectInstanceID armyId, SlotID srcSlot) = 0;\n\tvirtual int bulkMergeStacks(ObjectInstanceID armyId, SlotID srcSlot) = 0;\n\t\n\t\n\t// Moves all artifacts from one hero to another\n\tvirtual void bulkMoveArtifacts(ObjectInstanceID srcHero, ObjectInstanceID dstHero, bool swap, bool equipped, bool backpack) = 0;\n};\n\nclass CBattleCallback : public IBattleCallback\n{\n\tstd::map<BattleID, std::shared_ptr<CPlayerBattleCallback>> activeBattles;\n\n\tstd::optional<PlayerColor> player;\n\nprotected:\n\tint sendRequest(const CPackForServer & request); //returns requestID (that'll be matched to requestID in PackageApplied)\n\tCClient *cl;\n\npublic:\n\tCBattleCallback(std::optional<PlayerColor> player, CClient * C);\n\tvoid battleMakeSpellAction(const BattleID & battleID, const BattleAction & action) override;//for casting spells by hero - DO NOT use it for moving active stack\n\tvoid battleMakeUnitAction(const BattleID & battleID, const BattleAction & action) override;\n\tvoid battleMakeTacticAction(const BattleID & battleID, const BattleAction & action) override; // performs tactic phase actions\n\tstd::optional<BattleAction> makeSurrenderRetreatDecision(const BattleID & battleID, const BattleStateInfoForRetreat & battleState) override;\n\n\tstd::shared_ptr<CPlayerBattleCallback> getBattle(const BattleID & battleID) override;\n\tstd::optional<PlayerColor> getPlayerID() const override;\n\n\tvoid onBattleStarted(const IBattleInfo * info);\n\tvoid onBattleEnded(const BattleID & battleID);\n\n\tfriend class CCallback;\n\tfriend class CClient;\n};\n\nclass CCallback : public CPlayerSpecificInfoCallback, public CBattleCallback, public IGameActionCallback\n{\npublic:\n\tCCallback(CGameState * GS, std::optional<PlayerColor> Player, CClient * C);\n\tvirtual ~CCallback();\n\n\t//client-specific functionalities (pathfinding)\n\tvirtual bool canMoveBetween(const int3 &a, const int3 &b);\n\tvirtual int3 getGuardingCreaturePosition(int3 tile);\n\tvirtual std::shared_ptr<const CPathsInfo> getPathsInfo(const CGHeroInstance * h);\n\n\tstd::optional<PlayerColor> getPlayerID() const override;\n\n\t//Set of metrhods that allows adding more interfaces for this player that'll receive game event call-ins.\n\tvoid registerBattleInterface(std::shared_ptr<IBattleEventsReceiver> battleEvents);\n\tvoid unregisterBattleInterface(std::shared_ptr<IBattleEventsReceiver> battleEvents);\n\n//commands\n\tvoid moveHero(const CGHeroInstance *h, const std::vector<int3> & path, bool transit) override;\n\tvoid moveHero(const CGHeroInstance *h, const int3 & destination, bool transit) override;\n\tbool teleportHero(const CGHeroInstance *who, const CGTownInstance *where);\n\tint selectionMade(int selection, QueryID queryID) override;\n\tint sendQueryReply(std::optional<int32_t> reply, QueryID queryID) override;\n\tint swapCreatures(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2) override;\n\tint mergeOrSwapStacks(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2) override; //first goes to the second\n\tint mergeStacks(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2) override; //first goes to the second\n\tint splitStack(const CArmedInstance *s1, const CArmedInstance *s2, SlotID p1, SlotID p2, int val) override;\n\tint bulkMoveArmy(ObjectInstanceID srcArmy, ObjectInstanceID destArmy, SlotID srcSlot) override;\n\tint bulkSplitStack(ObjectInstanceID armyId, SlotID srcSlot, int howMany = 1) override;\n\tint bulkSmartSplitStack(ObjectInstanceID armyId, SlotID srcSlot) override;\n\tint bulkMergeStacks(ObjectInstanceID armyId, SlotID srcSlot) override;\n\tbool dismissHero(const CGHeroInstance * hero) override;\n\tbool swapArtifacts(const ArtifactLocation &l1, const ArtifactLocation &l2) override;\n\tvoid assembleArtifacts(const ObjectInstanceID & heroID, ArtifactPosition artifactSlot, bool assemble, ArtifactID assembleTo) override;\n\tvoid bulkMoveArtifacts(ObjectInstanceID srcHero, ObjectInstanceID dstHero, bool swap, bool equipped = true, bool backpack = true) override;\n\tvoid scrollBackpackArtifacts(ObjectInstanceID hero, bool left) override;\n\tvoid sortBackpackArtifactsBySlot(const ObjectInstanceID hero) override;\n\tvoid sortBackpackArtifactsByCost(const ObjectInstanceID hero) override;\n\tvoid sortBackpackArtifactsByClass(const ObjectInstanceID hero) override;\n\tvoid manageHeroCostume(ObjectInstanceID hero, size_t costumeIdx, bool saveCostume) override;\n\tvoid eraseArtifactByClient(const ArtifactLocation & al) override;\n\tbool buildBuilding(const CGTownInstance *town, BuildingID buildingID) override;\n\tbool visitTownBuilding(const CGTownInstance *town, BuildingID buildingID) override;\n\tvoid recruitCreatures(const CGDwelling * obj, const CArmedInstance * dst, CreatureID ID, ui32 amount, si32 level=-1) override;\n\tbool dismissCreature(const CArmedInstance *obj, SlotID stackPos) override;\n\tbool upgradeCreature(const CArmedInstance *obj, SlotID stackPos, CreatureID newID=CreatureID::NONE) override;\n\tvoid saveLocalState(const JsonNode & data) override;\n\tvoid endTurn() override;\n\tvoid spellResearch(const CGTownInstance *town, SpellID spellAtSlot, bool accepted) override;\n\tvoid swapGarrisonHero(const CGTownInstance *town) override;\n\tvoid buyArtifact(const CGHeroInstance *hero, ArtifactID aid) override;\n\tvoid trade(const ObjectInstanceID marketId, EMarketMode mode, TradeItemSell id1, TradeItemBuy id2, ui32 val1, const CGHeroInstance * hero = nullptr) override;\n\tvoid trade(const ObjectInstanceID marketId, EMarketMode mode, const std::vector<TradeItemSell> & id1, const std::vector<TradeItemBuy> & id2, const std::vector<ui32> & val1, const CGHeroInstance * hero = nullptr) override;\n\tvoid setFormation(const CGHeroInstance * hero, EArmyFormation mode) override;\n\tvoid recruitHero(const CGObjectInstance *townOrTavern, const CGHeroInstance *hero, const HeroTypeID & nextHero=HeroTypeID::NONE) override;\n\tvoid save(const std::string &fname) override;\n\tvoid sendMessage(const std::string &mess, const CGObjectInstance * currentObject = nullptr) override;\n\tvoid gamePause(bool pause) override;\n\tvoid buildBoat(const IShipyard *obj) override;\n\tvoid dig(const CGObjectInstance *hero) override;\n\tvoid castSpell(const CGHeroInstance *hero, SpellID spellID, const int3 &pos = int3(-1, -1, -1)) override;\n\n//friends\n\tfriend class CClient;\n};\n"
        },
        {
          "name": "CI",
          "type": "tree",
          "content": null
        },
        {
          "name": "CMakeLists.txt",
          "type": "blob",
          "size": 32.6806640625,
          "content": "# Minimum required version greatly affect CMake behavior\n# So cmake_minimum_required must be called before the project()\n# 3.16.0 is used since it's used by our currently oldest supported system: Ubuntu-20.04\ncmake_minimum_required(VERSION 3.16.0)\n\nproject(VCMI)\n# TODO\n# Vckpg:\n# - Improve install code once there is better way to deploy DLLs and Qt plugins\n#\n# Other:\n# - Cleanup remove_directory copy_directory if performance will be a problem.\n# We can use some macro over copy_if_different since it's only work for single file.\n# - Find a way to move add_custom_command for assets deploy out of \"lib/CMakeLists.txt\"\n# - Consider to remove M_DATA_DIR, DM_BIN_DIR, DM_LIB_DIR and not use them in code as well\n# - Try to get rid of FOLDER override with define_property\n# It's used currently to make sure that 3rd-party dependencies in git submodules get proper FOLDER property\n# - Make FindFuzzyLite check for the right version and disable FORCE_BUNDLED_FL by default\n\nif(APPLE)\n\tif(CMAKE_SYSTEM_NAME STREQUAL \"Darwin\")\n\t\tset(APPLE_MACOS 1)\n\telse()\n\t\tset(APPLE_IOS 1)\n\tendif()\nendif()\n\n############################################\n#        User-provided options             #\n############################################\n\nif(NOT CMAKE_BUILD_TYPE)\n\tset(CMAKE_BUILD_TYPE RelWithDebInfo CACHE STRING\n\t\t\"Choose the type of build, options are: Debug Release RelWithDebInfo. Default is RelWithDebInfo.\"\n\t\tFORCE)\n\tset_property(CACHE CMAKE_BUILD_TYPE PROPERTY STRINGS Debug Release RelWithDebInfo)\nendif()\n\n# Platform-independent options\n\noption(ENABLE_CLIENT \"Enable compilation of game client\" ON)\noption(ENABLE_ERM \"Enable compilation of ERM scripting module\" OFF)\noption(ENABLE_LUA \"Enable compilation of LUA scripting module\" OFF)\noption(ENABLE_TRANSLATIONS \"Enable generation of translations for launcher and editor\" ON)\noption(ENABLE_NULLKILLER_AI \"Enable compilation of Nullkiller AI library\" ON)\noption(ENABLE_MINIMAL_LIB \"Build only core parts of vcmi library that are required for game lobby\" OFF)\noption(ENABLE_GOLDMASTER \"Build in public release mode in which some debug routines are disabled\" OFF)\n\n# Compilation options\n\noption(ENABLE_PCH \"Enable compilation using precompiled headers\" ON)\noption(ENABLE_DEBUG_CONSOLE \"Enable debug console for Windows builds\" ON)\noption(ENABLE_STRICT_COMPILATION \"Treat all compiler warnings as errors\" OFF)\noption(ENABLE_MULTI_PROCESS_BUILDS \"Enable /MP flag for MSVS solution\" ON)\noption(ENABLE_COLORIZED_COMPILER_OUTPUT \"Colorize compilation output (Clang/GNU).\" ON)\noption(ENABLE_CCACHE \"Speed up recompilation by caching previous compilations\" OFF)\n\n# Platform-specific options\n\nif(ANDROID)\n\tset(ANDROID_TARGET_SDK_VERSION \"34\" CACHE STRING \"Android target SDK version\")\n\tset(ANDROIDDEPLOYQT_OPTIONS \"\" CACHE STRING \"Additional androiddeployqt options separated by semi-colon\")\n\tset(ANDROID_GRADLE_PROPERTIES \"\" CACHE STRING \"Additional Gradle properties separated by semi-colon\")\n\n\tset(ENABLE_STATIC_LIBS ON)\n\tset(ENABLE_LAUNCHER ON)\nelse()\n\toption(ENABLE_STATIC_LIBS \"Build library and all components such as AI statically\" OFF)\n\toption(ENABLE_LAUNCHER \"Enable compilation of launcher\" ON)\nendif()\n\nif(APPLE_IOS)\n\tset(BUNDLE_IDENTIFIER_PREFIX \"\" CACHE STRING \"Bundle identifier prefix\")\n\tset(APP_DISPLAY_NAME \"VCMI\" CACHE STRING \"App name on the home screen\")\nendif()\n\nif(APPLE_IOS OR ANDROID)\n\tset(ENABLE_MONOLITHIC_INSTALL OFF)\n\tset(ENABLE_SINGLE_APP_BUILD ON)\n\tset(ENABLE_EDITOR OFF)\n\tset(ENABLE_TEST OFF)\n\tset(ENABLE_LOBBY OFF)\n\tset(ENABLE_SERVER OFF)\n\tset(COPY_CONFIG_ON_BUILD OFF)\nelse()\n\toption(ENABLE_MONOLITHIC_INSTALL \"Install everything in single directory on Linux and Mac\" OFF) # Used for Snap packages and also useful for debugging\n\toption(COPY_CONFIG_ON_BUILD \"Copies config folder into output directory at building phase\" ON)\n\toption(ENABLE_SERVER \"Enable compilation of dedicated server\" ON)\n\toption(ENABLE_EDITOR \"Enable compilation of map editor\" ON)\n\toption(ENABLE_SINGLE_APP_BUILD \"Builds client and launcher as single executable\" OFF)\n\toption(ENABLE_TEST \"Enable compilation of unit tests\" OFF)\n\toption(ENABLE_LOBBY \"Enable compilation of lobby server\" OFF)\nendif()\n\n# ERM depends on LUA implicitly\nif(ENABLE_ERM AND NOT ENABLE_LUA)\n\tset(ENABLE_LUA ON)\nendif()\n\ninclude(CMakeDependentOption)\ncmake_dependent_option(ENABLE_INNOEXTRACT \"Enable innoextract for GOG file extraction in launcher\" ON \"ENABLE_LAUNCHER\" OFF)\ncmake_dependent_option(ENABLE_GITVERSION \"Enable Version.cpp with Git commit hash\" ON \"NOT ENABLE_GOLDMASTER\" OFF)\n\n############################################\n#        Miscellaneous options             #\n############################################\n\nif (ENABLE_STATIC_LIBS AND CMAKE_CXX_COMPILER_ID STREQUAL \"GNU\")\n\tset(CMAKE_POSITION_INDEPENDENT_CODE ON)\nendif()\n\nif(ENABLE_COLORIZED_COMPILER_OUTPUT)\n\tif(CMAKE_CXX_COMPILER_ID STREQUAL \"Clang\")\n\t\tadd_compile_options(-fcolor-diagnostics)\n\telseif(CMAKE_CXX_COMPILER_ID STREQUAL \"GNU\")\n\t\tadd_compile_options(-fdiagnostics-color=always)\n\tendif()\nendif()\n\nif(ENABLE_CCACHE)\n\tfind_program(CCACHE ccache REQUIRED)\nendif()\n\n# The XCode and MSVC builds each require some more configuration further down.\nif(ENABLE_CCACHE)\n\tset(CMAKE_C_COMPILER_LAUNCHER \"ccache\")\n\tset(CMAKE_CXX_COMPILER_LAUNCHER \"ccache\")\nendif()\n\nif(ENABLE_CCACHE AND (CMAKE_GENERATOR STREQUAL \"Xcode\"))\n\t# https://stackoverflow.com/a/36515503/2278742\n\t# Set up wrapper scripts\n\tconfigure_file(xcode/launch-c.in   xcode/launch-c)\n\tconfigure_file(xcode/launch-cxx.in xcode/launch-cxx)\n\texecute_process(COMMAND chmod a+rx\n\t\t\t\t\t\t\t\t\t\t\t\"${CMAKE_BINARY_DIR}/xcode/launch-c\"\n\t\t\t\t\t\t\t\t\t\t\t\"${CMAKE_BINARY_DIR}/xcode/launch-cxx\")\n\t# Set Xcode project attributes to route compilation through our scripts\n\tset(CMAKE_XCODE_ATTRIBUTE_CC         \t\"${CMAKE_BINARY_DIR}/xcode/launch-c\")\n\tset(CMAKE_XCODE_ATTRIBUTE_CXX        \t\"${CMAKE_BINARY_DIR}/xcode/launch-cxx\")\n\tset(CMAKE_XCODE_ATTRIBUTE_LD         \t\"${CMAKE_BINARY_DIR}/xcode/launch-c\")\n\tset(CMAKE_XCODE_ATTRIBUTE_LDPLUSPLUS \t\"${CMAKE_BINARY_DIR}/xcode/launch-cxx\")\nendif()\n\n# Allow to pass package name from Travis CI\nset(PACKAGE_NAME_SUFFIX \"\" CACHE STRING \"Suffix for CPack package name\")\nset(PACKAGE_FILE_NAME \"\" CACHE STRING \"Override for CPack package filename\")\n\nset(CMAKE_MODULE_PATH ${CMAKE_HOME_DIRECTORY}/cmake_modules ${PROJECT_SOURCE_DIR}/CI)\n# Contains custom functions and macros, but don't altering any options\n\ninclude(VCMIUtils)\ninclude(VersionDefinition)\n\nvcmi_print_important_variables()\n\n# Options to enable folders in CMake generated projects for Visual Studio, Xcode, etc\n# Very useful to put 3rd-party libraries such as Minizip, GoogleTest and FuzzyLite in their own folders\nset_property(GLOBAL PROPERTY USE_FOLDERS TRUE)\n# Make FOLDER property inheritable\n# So when we set FOLDER property on AI directory all and targets inside will inherit it\n#\n# Important! This trick depend on undefined behavior since we override CMake own property.\n# In same time define_property documentation states it's function for custom properties.\ndefine_property(\n\tTARGET\n\tPROPERTY FOLDER\n\tINHERITED\n\tBRIEF_DOCS \"Set the folder name.\"\n\tFULL_DOCS  \"Use to organize targets in an IDE.\"\n)\n\n# Generate Version.cpp\nif(ENABLE_GITVERSION)\n\tadd_custom_target(update_version ALL\n\t\tBYPRODUCTS \"Version.cpp\"\n\t\tCOMMAND ${CMAKE_COMMAND} -DGIT_SHA1=\"${GIT_SHA1}\" -P \"${PROJECT_SOURCE_DIR}/cmake_modules/Version.cmake\"\n\t)\nelse()\n\tadd_definitions(-DVCMI_NO_EXTRA_VERSION)\nendif(ENABLE_GITVERSION)\n\nif(ENABLE_PCH)\n\tmacro(enable_pch name)\n\t\ttarget_precompile_headers(${name} PRIVATE $<$<COMPILE_LANGUAGE:CXX>:<StdInc.h$<ANGLE-R>>)\n\tendmacro(enable_pch)\nelse()\n\tmacro(enable_pch ignore)\n\tendmacro(enable_pch)\nendif()\n\n############################################\n#        Documentation section             #\n############################################\n\ninclude(UseDoxygen OPTIONAL)\n\n############################################\n#        Compile and linking options       #\n############################################\n\n#Enable C++17 Globally\nset (CMAKE_CXX_STANDARD 17)\n#General visibility options\nset(CMAKE_CXX_VISIBILITY_PRESET hidden)\nset(CMAKE_VISIBILITY_INLINES_HIDDEN 1)\n\n#Global fallback mapping\n# RelWithDebInfo falls back to Release, then MinSizeRel, and then to None (tbb in 22.04 requires it)\nset(CMAKE_MAP_IMPORTED_CONFIG_RELWITHDEBINFO RelWithDebInfo Release MinSizeRel None \"\")\n# MinSizeRel falls back to Release, then RelWithDebInfo, and then to None (tbb in 22.04 requires it)\nset(CMAKE_MAP_IMPORTED_CONFIG_MINSIZEREL MinSizeRel Release RelWithDebInfo None \"\")\n# Release falls back to RelWithDebInfo, then MinSizeRel, and then to None (tbb in 22.04 requires it)\nset(CMAKE_MAP_IMPORTED_CONFIG_RELEASE Release RelWithDebInfo MinSizeRel None \"\")\n\nset(CMAKE_XCODE_ATTRIBUTE_APP_DISPLAY_NAME ${APP_DISPLAY_NAME})\nset(CMAKE_XCODE_ATTRIBUTE_CLANG_ENABLE_OBJC_ARC YES)\nset(CMAKE_XCODE_ATTRIBUTE_DEBUG_INFORMATION_FORMAT[variant=Debug] dwarf)\nset(CMAKE_XCODE_ATTRIBUTE_ENABLE_BITCODE NO)\nset(CMAKE_XCODE_ATTRIBUTE_ENABLE_NS_ASSERTIONS NO)\nset(CMAKE_XCODE_ATTRIBUTE_ENABLE_NS_ASSERTIONS[variant=Debug] YES)\nset(CMAKE_XCODE_ATTRIBUTE_GCC_WARN_64_TO_32_BIT_CONVERSION NO)\nset(CMAKE_XCODE_ATTRIBUTE_MARKETING_VERSION ${APP_SHORT_VERSION})\nset(CMAKE_XCODE_ATTRIBUTE_ONLY_ACTIVE_ARCH NO)\nset(CMAKE_XCODE_ATTRIBUTE_ONLY_ACTIVE_ARCH[variant=Debug] YES)\n\n#Check for endian\nif(${CMAKE_VERSION} VERSION_LESS \"3.20.0\") \n\tinclude(TestBigEndian)\n\ttest_big_endian(VCMI_ENDIAN_BIG)\n\tif(VCMI_ENDIAN_BIG)\n\t\tadd_definitions(-DVCMI_ENDIAN_BIG)\n\tendif()\nelseif(${CMAKE_CXX_BYTE_ORDER} EQUAL \"BIG_ENDIAN\")\n\tadd_definitions(-DVCMI_ENDIAN_BIG)\nendif()\n\nif(ENABLE_LAUNCHER)\n\tadd_definitions(-DENABLE_LAUNCHER)\nendif()\n\nif(ENABLE_EDITOR)\n\tadd_definitions(-DENABLE_EDITOR)\nendif()\n\nif(ENABLE_SINGLE_APP_BUILD)\n\tadd_definitions(-DENABLE_SINGLE_APP_BUILD)\nendif()\n\nif(ENABLE_MINIMAL_LIB)\n\tadd_definitions(-DENABLE_MINIMAL_LIB)\nendif()\n\nif(ENABLE_GOLDMASTER)\n\tadd_definitions(-DENABLE_GOLDMASTER)\nendif()\n\nif(APPLE_IOS)\n\tset(CMAKE_MACOSX_RPATH 1)\n\tset(CMAKE_OSX_DEPLOYMENT_TARGET 12.0)\n\n\tif(NOT USING_CONAN)\n\t\tlist(APPEND CMAKE_FIND_ROOT_PATH \"${CMAKE_PREFIX_PATH}\") # required for Boost\n\t\tset(CMAKE_FIND_USE_CMAKE_ENVIRONMENT_PATH FALSE)\n\t\tset(CMAKE_FIND_USE_SYSTEM_ENVIRONMENT_PATH FALSE)\n\tendif()\n\n\tset(CMAKE_XCODE_ATTRIBUTE_CODE_SIGNING_ALLOWED NO)\n\tset(CMAKE_XCODE_ATTRIBUTE_CODE_SIGNING_ALLOWED_FOR_APPS YES)\n\tset(CMAKE_XCODE_ATTRIBUTE_PRODUCT_BUNDLE_IDENTIFIER \"${BUNDLE_IDENTIFIER_PREFIX}.$(PRODUCT_NAME)\")\n\tset(CMAKE_XCODE_ATTRIBUTE_TARGETED_DEVICE_FAMILY \"1,2\")\nendif()\n\nif(APPLE_MACOS)\n\t# Not supported by standard library of our current minimal target - macOS 10.14 or newer required\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fno-aligned-allocation\")\nendif()\n\nif(MINGW OR MSVC)\n\t# Windows Vista or newer for FuzzyLite 6 to compile\n\t# Except for conan which already has this definition in its preset\n\tif(NOT USING_CONAN)\n\t\tadd_definitions(-D_WIN32_WINNT=0x0600)\n\tendif()\n\n\t#delete lib prefix for dlls (libvcmi -> vcmi)\n\tset(CMAKE_SHARED_LIBRARY_PREFIX \"\")\n\n\tif(MSVC)\n\t\tif(ENABLE_CCACHE)\n\t\t\t# https://github.com/ccache/ccache/discussions/1154#discussioncomment-3611387\n\t\t\tfile(COPY_FILE\n\t\t\t\t${CCACHE} ${CMAKE_BINARY_DIR}/cl.exe\n\t\t\t\tONLY_IF_DIFFERENT)\n\n\t\t\tset(CMAKE_VS_GLOBALS\n\t\t\t\t\"CLToolExe=cl.exe\"\n\t\t\t\t\"CLToolPath=${CMAKE_BINARY_DIR}\"\n\t\t\t\t\"TrackFileAccess=false\"\n\t\t\t\t\"UseMultiToolTask=true\"\n\t\t\t)\n\t\tendif()\n\n\t\tadd_definitions(-DBOOST_ALL_NO_LIB)\n\t\tadd_definitions(-DBOOST_ALL_DYN_LINK)\n\t\tset(Boost_USE_STATIC_LIBS OFF)\n\n\t\t# Don't link with SDLMain\n\t\tif(ENABLE_DEBUG_CONSOLE)\n\t\t\tset(SDL2_BUILDING_LIBRARY ON)\n\t\t\tadd_definitions(-DVCMI_WITH_DEBUG_CONSOLE)\n\t\tendif()\n\n\t\t# Suppress warnings\n\t\tadd_definitions(-D_CRT_SECURE_NO_WARNINGS)\n\t\tadd_definitions(-D_SCL_SECURE_NO_WARNINGS)\n\t\tadd_definitions(-D_SILENCE_TR1_NAMESPACE_DEPRECATION_WARNING) # Fix gtest and gmock build\n\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /utf-8\")\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /bigobj\")\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /wd4250\") # 4250: 'class1' : inherits 'class2::member' via dominance\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /wd4251\") # 4251: class 'xxx' needs to have dll-interface to be used by clients of class 'yyy'\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /wd4244\") # 4244: conversion from 'xxx' to 'yyy', possible loss of data\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /wd4267\") # 4267: conversion from 'xxx' to 'yyy', possible loss of data\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /wd4275\") # 4275: non dll-interface class 'xxx' used as base for dll-interface class\n\n\t\tif(ENABLE_STRICT_COMPILATION)\n\t\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /WX\") # Treats all compiler warnings as errors\n\t\tendif()\n\n\t\tif(ENABLE_MULTI_PROCESS_BUILDS)\n\t\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} /MP\")\n\t\tendif()\n\n\t\t# Workaround: Visual Studio has issues with exports of classes that inherit templates\n\t\t# https://stackoverflow.com/questions/44960760/msvc-dll-exporting-class-that-inherits-from-template-cause-lnk2005-already-defin\n\t\t# Reported to Microsoft here:\n\t\t# https://developercommunity.visualstudio.com/content/problem/224597/linker-failing-because-of-multiple-definitions-of.html\n\t\tset(CMAKE_EXE_LINKER_FLAGS \"${CMAKE_EXE_LINKER_FLAGS} /FORCE:MULTIPLE\")\n\n\t\t# Required at least for compatibility with Boost 1.68 on Vcpkg\n\t\tset(SYSTEM_LIBS ${SYSTEM_LIBS} bcrypt)\n\tendif(MSVC)\n\n\tif(MINGW)\n\n\t\t# Temporary (?) workaround for failing builds on MinGW CI due to bug in TBB\n\t\tset(CMAKE_CXX_EXTENSIONS ON)\n\n\t\tset(SYSTEM_LIBS ${SYSTEM_LIBS} ole32 oleaut32 ws2_32 mswsock dbghelp bcrypt)\n\n\t\t# Check for iconv (may be needed for Boost.Locale)\n\t\tinclude(CheckLibraryExists)\n\t\tcheck_library_exists(iconv libiconv_open \"\" ICONV_FOUND)\n\t\tif(ICONV_FOUND)\n\t\t\tset(SYSTEM_LIBS ${SYSTEM_LIBS} iconv)\n\t\tendif()\n\tendif(MINGW)\nendif(MINGW OR MSVC)\n\nif(ANDROID)\n\tif(ANDROID_NDK_MAJOR LESS 23 AND ANDROID_ABI MATCHES \"^armeabi\")\n\t\t# libunwind must come before other shared libs:\n\t\t# https://android.googlesource.com/platform/ndk/+/master/docs/BuildSystemMaintainers.md#Unwinding\n\t\tlist(APPEND SYSTEM_LIBS unwind)\n\tendif()\n\tlist(APPEND SYSTEM_LIBS log)\nendif()\n\nif(CMAKE_CXX_COMPILER_ID STREQUAL \"GNU\" OR NOT WIN32)\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wall -Wextra\")\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wpointer-arith\")\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wuninitialized\")\n\n\tif (CMAKE_CXX_COMPILER_VERSION VERSION_GREATER_EQUAL 10.0 OR CMAKE_CXX_COMPILER_ID STREQUAL \"Clang\" )\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wmismatched-tags\")\n\tendif()\n\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wno-unused-parameter\")   # low chance of valid reports, a lot of emitted warnings\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wno-switch\")             # large number of false-positives, disabled\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wno-reorder\")            # large number of noise, low chance of any significant issues\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wno-sign-compare\")       # low chance of any significant issues\n\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wno-varargs\")            # emitted in fuzzylite headers, disabled\n\n\tif(ENABLE_STRICT_COMPILATION)\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Werror\")\n\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wno-error=array-bounds\") # false positives in boost::multiarray during release build, keep as warning-only\n\tendif()\n\n\tif(CMAKE_BUILD_TYPE STREQUAL \"Debug\")\n\t\tif(CMAKE_CXX_COMPILER_ID STREQUAL \"GNU\" AND NOT WIN32)\n\t\t\t# For gcc 14+ we can use -fhardened instead\n\t\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -D_GLIBCXX_ASSERTIONS -fstack-protector-strong -fstack-clash-protection\")\n\t\t\tif (CMAKE_SYSTEM_PROCESSOR STREQUAL \"AMD64\" OR CMAKE_SYSTEM_PROCESSOR STREQUAL \"x86_64\")\n\t\t\t\tset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fcf-protection=full\")\n\t\t\tendif()\n\t\tendif()\n\tendif()\n\n\t# Fix string inspection with lldb\n\t# https://stackoverflow.com/questions/58578615/cannot-inspect-a-stdstring-variable-in-lldb\n\tif(CMAKE_CXX_COMPILER_ID STREQUAL \"Clang\")\n\t\tset(CMAKE_CXX_FLAGS_DEBUG \"${CMAKE_CXX_FLAGS_DEBUG} -fstandalone-debug\")\n\tendif()\n\n\tif(UNIX)\n\t\tset(SYSTEM_LIBS ${SYSTEM_LIBS} ${CMAKE_DL_LIBS})\n\tendif()\nendif()\n\n# Check if some platform-specific libraries are needed for linking\nif(NOT WIN32 AND NOT APPLE_IOS)\n\tinclude(CheckLibraryExists)\n\n\t# Shared memory functions used by Boost.Interprocess\n\t# FindBoost handle linking with pthreads, but doesn't handle this\n\tCHECK_LIBRARY_EXISTS(rt shm_open \"\" HAVE_RT_LIB)\n\tif(HAVE_RT_LIB)\n\t\tset(SYSTEM_LIBS ${SYSTEM_LIBS} rt)\n\tendif()\n\tif(HAIKU)\n\t\tset(SYSTEM_LIBS ${SYSTEM_LIBS} network)\n\tendif()\nendif()\n\nif(ENABLE_LUA)\n\tadd_definitions(-DSCRIPTING_ENABLED=1)\nendif()\n\nif(USING_CONAN AND (MINGW AND CMAKE_HOST_UNIX))\n\t# Hack for workaround https://github.com/conan-io/conan-center-index/issues/15405\n\t# Remove once it will be fixed\n\texecute_process(COMMAND\n\t\tbash -c \"grep -rl Mf ${CONAN_INSTALL_FOLDER} | xargs sed -i 's/Mf/mf/g'\"\n\t)\n\t# Hack for workaround ffmpeg broken linking (conan ffmpeg forgots to link to ws2_32)\n\t# Remove once it will be fixed\n\texecute_process(COMMAND\n\t\tbash -c \"grep -rl secur32 ${CONAN_INSTALL_FOLDER} | xargs sed -i 's/secur32)/secur32 ws2_32)/g'\"\n\t)\n\texecute_process(COMMAND\n\t\tbash -c \"grep -rl secur32 ${CONAN_INSTALL_FOLDER} | xargs sed -i 's/secur32 mfplat/secur32 ws2_32 mfplat/g'\"\n\t)\n\t# Fixup tbb for cross-compiling on Conan\n\t# Remove once it will be fixed\n\texecute_process(COMMAND\n\t\tbash -c \"grep -rl tbb12 ${CONAN_INSTALL_FOLDER} | xargs sed -i 's/tbb tbb12/tbb12/g'\"\n\t)\nendif()\n\n############################################\n#        Finding packages                  #\n############################################\n\nset(BOOST_COMPONENTS date_time filesystem locale program_options system thread)\nif(ENABLE_INNOEXTRACT)\n\tlist(APPEND BOOST_COMPONENTS iostreams)\nendif()\nfind_package(Boost 1.48.0 REQUIRED COMPONENTS ${BOOST_COMPONENTS})\n\nfind_package(ZLIB REQUIRED)\n# Conan compatibility\nif(TARGET zlib::zlib)\n\tadd_library(ZLIB::ZLIB ALIAS zlib::zlib)\nendif()\n\noption(FORCE_BUNDLED_MINIZIP \"Force bundled Minizip library\" OFF)\nif(NOT FORCE_BUNDLED_MINIZIP)\n\tfind_package(minizip)\n\tif(TARGET minizip::minizip)\n\t\tadd_definitions(-DUSE_SYSTEM_MINIZIP)\n\tendif()\nendif()\n\nif (ENABLE_CLIENT)\n\tfind_package(ffmpeg COMPONENTS avutil swscale avformat avcodec swresample)\n\n\tfind_package(SDL2 REQUIRED)\n\tfind_package(SDL2_image REQUIRED)\n\tif(TARGET SDL2_image::SDL2_image)\n\t\tadd_library(SDL2::Image ALIAS SDL2_image::SDL2_image)\n\tendif()\n\tif(TARGET SDL2_image::SDL2_image-static)\n\t\tadd_library(SDL2::Image ALIAS SDL2_image::SDL2_image-static)\n\tendif()\n\tfind_package(SDL2_mixer REQUIRED)\n\tif(TARGET SDL2_mixer::SDL2_mixer)\n\t\tadd_library(SDL2::Mixer ALIAS SDL2_mixer::SDL2_mixer)\n\tendif()\n\tif(TARGET SDL2_mixer::SDL2_mixer-static)\n\t\tadd_library(SDL2::Mixer ALIAS SDL2_mixer::SDL2_mixer-static)\n\tendif()\n\tfind_package(SDL2_ttf REQUIRED)\n\tif(TARGET SDL2_ttf::SDL2_ttf)\n\t\tadd_library(SDL2::TTF ALIAS SDL2_ttf::SDL2_ttf)\n\tendif()\n\tif(TARGET SDL2_ttf::SDL2_ttf-static)\n\t\tadd_library(SDL2::TTF ALIAS SDL2_ttf::SDL2_ttf-static)\n\tendif()\nendif()\n\nif(ENABLE_LOBBY)\n\tfind_package(SQLite3 REQUIRED)\nendif()\n\nif(ENABLE_LAUNCHER OR ENABLE_EDITOR)\n\t# Widgets finds its own dependencies (QtGui and QtCore).\n\tfind_package(QT NAMES Qt6 Qt5 REQUIRED COMPONENTS Widgets Network)\n\tfind_package(Qt${QT_VERSION_MAJOR} REQUIRED COMPONENTS Widgets Network)\n\n\tif(ENABLE_TRANSLATIONS)\n\t\tfind_package(Qt${QT_VERSION_MAJOR} REQUIRED COMPONENTS LinguistTools)\n\t\tadd_definitions(-DENABLE_QT_TRANSLATIONS)\n\tendif()\nendif()\n\nif(NOT ENABLE_MINIMAL_LIB)\n\tfind_package(TBB REQUIRED)\nendif()\n\nif(ENABLE_LUA)\n\tfind_package(luajit)\n\n\tif(TARGET luajit::luajit)\n\t\tmessage(STATUS \"Using LuaJIT provided by system\")\n\telse()\n\t\tmessage(STATUS \"Cannot find LuaJIT! Fallback to using usual Lua.\")\n\t\tfind_package(Lua REQUIRED)\n\t\tif(Lua_FOUND)\n\t\t\tadd_library(luajit::luajit UNKNOWN IMPORTED)\n\t\t\tset_target_properties(luajit::luajit PROPERTIES\n\t\t\t\tINTERFACE_INCLUDE_DIRECTORIES \"${LUA_INCLUDE_DIR}\")\n\t\t\tset_target_properties(luajit::luajit PROPERTIES\n\t\t\t\tIMPORTED_LOCATION \"${LUA_LIBRARIES}\")\n\t\tendif()\n\tendif()\nendif()\n\n############################################\n#        Output directories                #\n############################################\n\nif(WIN32) # on Win everything goes into H3 root directory\n\tset(BIN_DIR \".\" CACHE STRING \"Where to install binaries\")\n\tset(LIB_DIR \".\" CACHE STRING \"Where to install main library\")\n\tset(DATA_DIR \".\" CACHE STRING \"Where to install data files\")\nelseif(APPLE)\n\t# includes lib path which determines where to install shared libraries (either /lib or /lib64)\n\tinclude(GNUInstallDirs)\n\n\tset(CMAKE_INSTALL_RPATH \"@executable_path/../Frameworks\")\n\tif(ENABLE_MONOLITHIC_INSTALL)\n\t\tset(BIN_DIR \".\" CACHE STRING \"Where to install binaries\")\n\t\tset(LIB_DIR \".\" CACHE STRING \"Where to install main library\")\n\t\tset(DATA_DIR \".\" CACHE STRING \"Where to install data files\")\n\telse()\n\t\tif(APPLE_MACOS)\n\t\t\tset(APP_BUNDLE_DIR \"${CMAKE_PROJECT_NAME}.app\")\n\t\t\tset(APP_BUNDLE_CONTENTS_DIR \"${APP_BUNDLE_DIR}/Contents\")\n\t\t\tset(APP_BUNDLE_BINARY_DIR \"${APP_BUNDLE_CONTENTS_DIR}/MacOS\")\n\t\t\tset(APP_BUNDLE_RESOURCES_DIR \"${APP_BUNDLE_CONTENTS_DIR}/Resources\")\n\n\t\t\tset(BIN_DIR \"${APP_BUNDLE_BINARY_DIR}\" CACHE STRING \"Where to install binaries\")\n\t\t\tset(LIB_DIR \"${APP_BUNDLE_CONTENTS_DIR}/Frameworks\" CACHE STRING \"Where to install main library\")\n\t\t\tset(DATA_DIR \"${APP_BUNDLE_RESOURCES_DIR}/Data\" CACHE STRING \"Where to install data files\")\n\t\telse()\n\t\t\tset(LIB_DIR \"Frameworks\")\n\t\t\tset(DATA_DIR \".\")\n\t\tendif()\n\tendif()\nelseif(ANDROID)\n\tinclude(GNUInstallDirs)\n\tset(LIB_DIR \"libs/${ANDROID_ABI}\")\n\n\t# required by Qt\n\tset(androidPackageSourceDir \"${CMAKE_SOURCE_DIR}/android\")\n\tset(androidQtBuildDir \"${CMAKE_BINARY_DIR}/android-build\")\n\tset(CMAKE_LIBRARY_OUTPUT_DIRECTORY \"${androidQtBuildDir}/${LIB_DIR}\")\nelse()\n\t# includes lib path which determines where to install shared libraries (either /lib or /lib64)\n\tinclude(GNUInstallDirs)\n\n\tif(ENABLE_MONOLITHIC_INSTALL)\n\t\tset(BIN_DIR \".\" CACHE STRING \"Where to install binaries\")\n\t\tset(LIB_DIR \".\" CACHE STRING \"Where to install main library\")\n\t\tset(DATA_DIR \".\" CACHE STRING \"Where to install data files\")\n\n\t\t# following constants only used for platforms using XDG (Linux, BSD, etc)\n\t\tadd_definitions(-DM_DATA_DIR=\"${DATA_DIR}\")\n\t\tadd_definitions(-DM_BIN_DIR=\"${BIN_DIR}\")\n\t\tadd_definitions(-DM_LIB_DIR=\"${LIB_DIR}\")\n\n\t\tset(CMAKE_INSTALL_RPATH \"$ORIGIN/\")\n\telse()\n\t\tif(NOT BIN_DIR)\n\t\t\tset(BIN_DIR \"${CMAKE_INSTALL_BINDIR}\" CACHE STRING \"Where to install binaries\")\n\t\tendif()\n\t\tif(NOT LIB_DIR)\n\t\t\tset(LIB_DIR \"${CMAKE_INSTALL_LIBDIR}/vcmi\" CACHE STRING \"Where to install main library\")\n\t\tendif()\n\t\tif(NOT DATA_DIR)\n\t\t\tset(DATA_DIR \"${CMAKE_INSTALL_DATAROOTDIR}/vcmi\" CACHE STRING \"Where to install data files\")\n\t\tendif()\n\n\t\t# following constants only used for platforms using XDG (Linux, BSD, etc)\n\t\tadd_definitions(-DM_DATA_DIR=\"${CMAKE_INSTALL_PREFIX}/${DATA_DIR}\")\n\t\tadd_definitions(-DM_BIN_DIR=\"${CMAKE_INSTALL_PREFIX}/${BIN_DIR}\")\n\t\tadd_definitions(-DM_LIB_DIR=\"${CMAKE_INSTALL_PREFIX}/${LIB_DIR}\")\n\n\t\tset(CMAKE_INSTALL_RPATH \"${CMAKE_INSTALL_PREFIX}/${LIB_DIR}\")\n\tendif()\nendif()\n\n# iOS/Android have flat libs directory structure\nif(APPLE_IOS OR ANDROID)\n\tset(AI_LIB_DIR \"${LIB_DIR}\")\n\tset(SCRIPTING_LIB_DIR \"${LIB_DIR}\")\nelse()\n\tset(AI_LIB_DIR \"${LIB_DIR}/AI\")\n\tset(SCRIPTING_LIB_DIR \"${LIB_DIR}/scripting\")\nendif()\n\n# common Qt paths\nif(ENABLE_LAUNCHER OR ENABLE_EDITOR)\n\tget_target_property(qmakePath Qt${QT_VERSION_MAJOR}::qmake IMPORTED_LOCATION)\n\tget_filename_component(qtDir \"${qmakePath}/../../\" ABSOLUTE)\n\tset(qtBinDir \"${qtDir}/bin\")\nendif()\n\n#######################################\n#        Add subdirectories           #\n#######################################\n\nif(APPLE_IOS)\n\tadd_subdirectory(ios)\nendif()\n\nif (ENABLE_CLIENT)\n\tadd_subdirectory_with_folder(\"AI\" AI)\nendif()\n\nadd_subdirectory(lib)\n\nif (ENABLE_CLIENT OR ENABLE_SERVER)\n\tadd_subdirectory(server)\nendif()\n\nif(ENABLE_ERM)\n\tadd_subdirectory(scripting/erm)\nendif()\n\nif(ENABLE_LUA)\n\tadd_subdirectory(scripting/lua)\nendif()\n\nif(NOT TARGET minizip::minizip)\n\tadd_subdirectory_with_folder(\"3rdparty\" lib/minizip)\n\tadd_library(minizip::minizip ALIAS minizip)\nendif()\n\nif(ENABLE_LAUNCHER OR ENABLE_EDITOR)\n\tadd_subdirectory(vcmiqt)\nendif()\n\nif(ENABLE_LAUNCHER)\n\tadd_subdirectory(launcher)\nendif()\n\nif(ENABLE_EDITOR)\n\tadd_subdirectory(mapeditor)\nendif()\n\nif(ENABLE_LOBBY)\n\tadd_subdirectory(lobby)\nendif()\n\nif (ENABLE_CLIENT)\n\tadd_subdirectory(client)\n\tadd_subdirectory(clientapp)\nendif()\n\nif(ENABLE_SERVER)\n\tadd_subdirectory(serverapp)\nendif()\n\nif(ENABLE_TEST)\n\tenable_testing()\n\tadd_subdirectory(test)\nendif()\n\n#######################################\n#        Installation section         #\n#######################################\n\nif(ANDROID)\n\tstring(REPLACE \";\" \"\\n\" ANDROID_GRADLE_PROPERTIES_MULTILINE \"${ANDROID_GRADLE_PROPERTIES}\")\n\tfile(WRITE \"${androidPackageSourceDir}/vcmi-app/gradle.properties\" \"signingRoot=${CMAKE_SOURCE_DIR}/CI/android\\n${ANDROID_GRADLE_PROPERTIES_MULTILINE}\")\n\n\tif(ANDROID_STL MATCHES \"_shared$\")\n\t\tset(stlLibName \"${CMAKE_SHARED_LIBRARY_PREFIX}${ANDROID_STL}${CMAKE_SHARED_LIBRARY_SUFFIX}\")\n\t\tinstall(FILES \"${CMAKE_SYSROOT}/usr/lib/${ANDROID_SYSROOT_LIB_SUBDIR}/${stlLibName}\"\n\t\t\tDESTINATION ${LIB_DIR}\n\t\t)\n\tendif()\nelse()\n\tinstall(DIRECTORY config DESTINATION ${DATA_DIR})\n\tif (ENABLE_CLIENT OR ENABLE_SERVER)\n\t\tinstall(DIRECTORY Mods DESTINATION ${DATA_DIR})\n\tendif()\nendif()\nif(ENABLE_LUA)\n\tinstall(DIRECTORY scripts DESTINATION ${DATA_DIR})\nendif()\n\n# that script is useless for Windows / iOS / Android\nif(NOT WIN32 AND NOT APPLE_IOS AND NOT ANDROID)\n\tinstall(FILES vcmibuilder DESTINATION ${BIN_DIR} PERMISSIONS\n\t\tOWNER_WRITE OWNER_READ OWNER_EXECUTE\n\t\t\t\t\tGROUP_READ GROUP_EXECUTE\n\t\t\t\t\tWORLD_READ WORLD_EXECUTE)\nendif()\n\n\nif(WIN32)\n\tif(TBB_FOUND AND MSVC)\n\t\tinstall_vcpkg_imported_tgt(TBB::tbb)\n\tendif()\n\n\tif(USING_CONAN)\n\t\t#Conan imports enabled\n\t\tvcmi_install_conan_deps(\"\\${CMAKE_INSTALL_PREFIX}\")\n\t\tfile(GLOB dep_files\n\t\t\t\t${dep_files}\n\t\t\t\t\"${CMAKE_SYSROOT}/bin/*.dll\" \n\t\t\t\t\"${CMAKE_SYSROOT}/lib/*.dll\" \n\t\t\t\t\"${CONAN_SYSTEM_LIBRARY_LOCATION}/libgcc_s_dw2-1.dll\" # for 32-bit only?\n\t\t\t\t\"${CONAN_SYSTEM_LIBRARY_LOCATION}/libgcc_s_seh-1.dll\" # for 64-bit only?\n\t\t\t\t\"${CONAN_SYSTEM_LIBRARY_LOCATION}/libstdc++-6.dll\")\n\telse()\n\t\tfile(GLOB dep_files\n\t\t\t\t${dep_files}\n\t\t\t\t\"${CMAKE_FIND_ROOT_PATH}/bin/*.dll\")\n\tendif()\n\n\tif(CMAKE_BUILD_TYPE STREQUAL \"Debug\")\n\t\t# Copy debug versions of libraries if build type is debug\n\t\tset(debug_postfix d)\n\tendif()\n\n\tif(ENABLE_LAUNCHER OR ENABLE_EDITOR)\n\t\tget_target_property(QtCore_location Qt${QT_VERSION_MAJOR}::Core LOCATION)\n\t\tget_filename_component(Qtbin_folder ${QtCore_location} PATH)\n\t\tfile(GLOB dep_files\n\t\t\t${dep_files}\n\t\t\t${Qtbin_folder}/Qt5Core${debug_postfix}.dll\n\t\t\t${Qtbin_folder}/Qt5Gui${debug_postfix}.dll\n\t\t\t${Qtbin_folder}/Qt5Widgets${debug_postfix}.dll\n\t\t\t${Qtbin_folder}/Qt5Network${debug_postfix}.dll\n\t\t\t${Qtbin_folder}/icu*.dll)\n\t\tget_target_property(integration_type Qt${QT_VERSION_MAJOR}::QWindowsIntegrationPlugin TYPE)\n\t\tif(NOT(integration_type STREQUAL \"INTERFACE_LIBRARY\"))\n\t\t\tget_target_property(integration_loc Qt${QT_VERSION_MAJOR}::QWindowsIntegrationPlugin LOCATION)\n\t\t\tinstall(\n\t\t\t\tFILES ${integration_loc}\n\t\t\t\tDESTINATION ${BIN_DIR}/platforms\n\t\t\t)\n\t\t\tinstall(\n\t\t\t\tFILES \"$<TARGET_FILE:Qt${QT_VERSION_MAJOR}::QWindowsVistaStylePlugin>\" \n\t\t\t\tDESTINATION ${BIN_DIR}/styles) \n\t\tendif()\n\tendif()\n\n\tinstall(FILES ${dep_files} DESTINATION ${BIN_DIR})\nendif(WIN32)\n\n#######################################\n#       Packaging section             #\n#######################################\n\nif(MSVC)\n\tSET(CMAKE_INSTALL_SYSTEM_RUNTIME_DESTINATION ${BIN_DIR})\n\tInclude(InstallRequiredSystemLibraries)\nendif()\n\nset(CPACK_PACKAGE_VERSION_MAJOR ${VCMI_VERSION_MAJOR})\nset(CPACK_PACKAGE_VERSION_MINOR ${VCMI_VERSION_MINOR})\nset(CPACK_PACKAGE_VERSION_PATCH ${VCMI_VERSION_PATCH})\n\n# vcmi does not have \"patch version\" in version string\nset(CPACK_PACKAGE_VERSION \"${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}\")\n#TODO: remove version from Global.h and use this one as define?\n\nset(CPACK_INCLUDE_TOPLEVEL_DIRECTORY 0)\n\nif(\"${PACKAGE_NAME_SUFFIX}\" STREQUAL \"\")\n\tset(CPACK_PACKAGE_NAME \"VCMI\")\nelse()\n\tset(CPACK_PACKAGE_NAME \"VCMI ${PACKAGE_NAME_SUFFIX}\")\nendif()\nif(\"${PACKAGE_FILE_NAME}\" STREQUAL \"\")\n\tset(CPACK_PACKAGE_FILE_NAME \"vcmi-${CPACK_PACKAGE_VERSION}\")\nelse()\n\tset(CPACK_PACKAGE_FILE_NAME \"${PACKAGE_FILE_NAME}\")\nendif()\nset(CPACK_PACKAGE_VENDOR \"VCMI team\")\n\nif(WIN32)\n\t# Note: due to NSI script generation process all of the backward slashes here are useful\n\tset(CPACK_MONOLITHIC_INSTALL 1)\n\tset(CPACK_RESOURCE_FILE_LICENSE \"${CMAKE_SOURCE_DIR}/license.txt\")\n\tset(CPACK_PACKAGE_INSTALL_DIRECTORY \"${CPACK_PACKAGE_NAME}\")\n\tif(\"${PACKAGE_NAME_SUFFIX}\" STREQUAL \"\")\n\t\tset(CPACK_NSIS_PACKAGE_NAME \"VCMI ${CPACK_PACKAGE_VERSION}\")\n\telse()\n\t\tset(CPACK_NSIS_PACKAGE_NAME \"VCMI ${CPACK_PACKAGE_VERSION} ${PACKAGE_NAME_SUFFIX} \")\n\tendif()\n\tif(CMAKE_SYSTEM_PROCESSOR MATCHES \".*64\")\n\t\tset(CPACK_NSIS_INSTALL_ROOT \"$PROGRAMFILES64\")\n\telse()\n\t\tset(CPACK_NSIS_INSTALL_ROOT \"$PROGRAMFILES\")\n\tendif()\n\n\tif(ENABLE_LAUNCHER)\n\t\tset(VCMI_MAIN_EXECUTABLE \"VCMI_launcher\")\n\telse()\n\t\tset(VCMI_MAIN_EXECUTABLE \"VCMI_client\")\n\tendif()\n\tset(CPACK_PACKAGE_EXECUTABLES \"${VCMI_MAIN_EXECUTABLE};VCMI\")\n\tset(CPACK_NSIS_EXTRA_INSTALL_COMMANDS \"\n\t\tCreateShortCut \\\\\\\"$DESKTOP\\\\\\\\VCMI.lnk\\\\\\\" \\\\\\\"$INSTDIR\\\\\\\\${VCMI_MAIN_EXECUTABLE}.exe\\\\\\\"\n\t\tExecShell '' 'netsh' 'advfirewall firewall add rule name=vcmi_server dir=in action=allow program=\\\\\\\"$INSTDIR\\\\\\\\vcmi_server.exe\\\\\\\" enable=yes profile=public,private' SW_HIDE\n\t\tExecShell '' 'netsh' 'advfirewall firewall add rule name=vcmi_client dir=in action=allow program=\\\\\\\"$INSTDIR\\\\\\\\vcmi_client.exe\\\\\\\" enable=yes profile=public,private' SW_HIDE\n\t\")\n\tset(CPACK_NSIS_EXTRA_UNINSTALL_COMMANDS \"\n\t\tDelete \\\\\\\"$DESKTOP\\\\\\\\VCMI.lnk\\\\\\\"\n\t\tExecShell '' 'netsh' 'advfirewall firewall delete rule name=vcmi_server' SW_HIDE\n\t\tExecShell '' 'netsh' 'advfirewall firewall delete rule name=vcmi_client' SW_HIDE\n\t\")\n\n\t# Strip MinGW CPack target if build configuration without debug info\n\tif(MINGW)\n\t\tif(NOT (CMAKE_BUILD_TYPE STREQUAL \"Debug\") OR (CMAKE_BUILD_TYPE STREQUAL \"RelWithDebInfo\"))\n\t\t\tset(CPACK_STRIP_FILES ON)\n\t\tendif()\n\tendif()\n\t# set the install/unistall icon used for the installer itself\n\t# There is a bug in NSI that does not handle full unix paths properly.\n\tset(CPACK_NSIS_MUI_ICON \"${CMAKE_CURRENT_SOURCE_DIR}/clientapp/icons\\\\\\\\vcmi.ico\")\n\tset(CPACK_NSIS_MUI_UNIICON \"${CMAKE_CURRENT_SOURCE_DIR}/clientapp/icons\\\\\\\\vcmi.ico\")\n\t# set the package header icon for MUI\n\tset(CPACK_PACKAGE_ICON \"${CMAKE_SOURCE_DIR}/clientapp/icons\\\\\\\\vcmi.ico\")\n\n\tset(CPACK_NSIS_MENU_LINKS \"http://vcmi.eu/\" \"VCMI Web Site\")\n\n\tset(CPACK_NSIS_INSTALLED_ICON_NAME \"VCMI_client.exe\")\n\tset(CPACK_NSIS_COMPRESSOR \"/SOLID lzma\")\n\tset(CPACK_NSIS_DISPLAY_NAME \"${CPACK_NSIS_PACKAGE_NAME}, open-source engine for Heroes of Might and Magic III \")\n\tset(CPACK_NSIS_HELP_LINK \"http://vcmi.eu/\")\n\tset(CPACK_NSIS_URL_INFO_ABOUT \"http://vcmi.eu/\")\n\tset(CPACK_NSIS_CONTACT @CPACK_PACKAGE_CONTACT@)\n\tset(CPACK_NSIS_EXECUTABLES_DIRECTORY \".\")\n\t# Use BundleUtilities to fix build when Vcpkg is used and disable it for mingw\n\tif(NOT (${CMAKE_CROSSCOMPILING}))\n\t\tadd_subdirectory(win)\n\tendif()\nelseif(APPLE_MACOS AND NOT ENABLE_MONOLITHIC_INSTALL)\n\tset(CPACK_MONOLITHIC_INSTALL 1)\n\tset(CPACK_GENERATOR \"DragNDrop\")\n\tset(CPACK_DMG_BACKGROUND_IMAGE \"${CMAKE_SOURCE_DIR}/osx/dmg_background.png\")\n\t# Workaround for this issue:\n\t# CPack Error: Error executing: /usr/bin/hdiutil detach \"/Volumes/VCMI\"\n\t# https://github.com/actions/runner-images/issues/7522#issuecomment-1564467252\n\tset(CPACK_COMMAND_HDIUTIL \"/usr/bin/sudo /usr/bin/hdiutil\")\n\t# CMake code for CPACK_DMG_DS_STORE executed before DS_STORE_SETUP_SCRIPT\n\t# So we can keep both enabled and this shouldn't hurt\n\t# set(CPACK_DMG_DS_STORE \"${CMAKE_SOURCE_DIR}/osx/dmg_DS_Store\")\n\tset(CPACK_DMG_DS_STORE_SETUP_SCRIPT \"${CMAKE_SOURCE_DIR}/osx/DS_Store_Setup.scpt\")\n\n\t# Always use \"VCMI\" as volume name so full path will be /Volumes/VCMI/\n\t# Otherwise DMG background image wouldn't work\n\t# Pre-generated DS_Store use absolute path to background image\n\tset(CPACK_DMG_VOLUME_NAME \"${CMAKE_PROJECT_NAME}\")\n\n\tinclude(GetGitRevisionDescription)\n\tget_git_head_revision(GIT_REFSPEC GIT_SHA1)\n\tstring(TIMESTAMP CURRENT_YEAR \"%Y\")\n\n\tset(MACOSX_BUNDLE_NAME \"${CMAKE_PROJECT_NAME}\")\n\tset(MACOSX_BUNDLE_BUNDLE_NAME \"${CMAKE_PROJECT_NAME}\")\n\tset(MACOSX_BUNDLE_COPYRIGHT \"Copyright © 2007-${CURRENT_YEAR} VCMI team\")\n\tset(MACOSX_BUNDLE_GUI_IDENTIFIER \"eu.vcmi.vcmi\")\n\tset(MACOSX_BUNDLE_BUNDLE_VERSION ${GIT_SHA1})\n\tset(MACOSX_BUNDLE_SHORT_VERSION_STRING ${APP_SHORT_VERSION})\n\tif(ENABLE_LAUNCHER)\n\t\tset(MACOSX_BUNDLE_EXECUTABLE_NAME \"vcmilauncher\")\n\telse()\n\t\tset(MACOSX_BUNDLE_EXECUTABLE_NAME \"vcmiclient\")\n\tendif()\n\tset(MACOSX_BUNDLE_ICON_FILE \"vcmi.icns\")\n\n\tinstall(FILES \"${CMAKE_SOURCE_DIR}/osx/vcmi.icns\" DESTINATION ${APP_BUNDLE_RESOURCES_DIR})\n\n\tconfigure_file(\"${CMAKE_SOURCE_DIR}/osx/Info.plist.in\" \"${CMAKE_BINARY_DIR}/Info.plist\")\n\tinstall(FILES \"${CMAKE_BINARY_DIR}/Info.plist\" DESTINATION ${APP_BUNDLE_CONTENTS_DIR})\n\n\t# Bundle fixing code must be in separate directory to be executed after all other install code\n\tadd_subdirectory(osx)\nelseif(APPLE_IOS)\n\tset(CPACK_GENERATOR ZIP)\n\tset(CPACK_ARCHIVE_FILE_EXTENSION ipa)\n\tset(CPACK_INCLUDE_TOPLEVEL_DIRECTORY OFF)\n\tset(CPACK_INSTALL_CMAKE_PROJECTS \"${CMAKE_CURRENT_BINARY_DIR};${CMAKE_PROJECT_NAME};app;/\")\nelse()\n\tset(CPACK_GENERATOR TGZ)\nendif()\n\ninclude(CPack)\n"
        },
        {
          "name": "CMakePresets.json",
          "type": "blob",
          "size": 16.8095703125,
          "content": "{\n    \"version\": 2,\n    \"configurePresets\": [\n        {\n            \"name\": \"release-binary-dir\",\n            \"hidden\": true,\n            \"binaryDir\": \"${sourceDir}/out/build/${presetName}\"\n        },\n        {\n            \"name\": \"build-with-conan\",\n            \"hidden\": true,\n            \"cacheVariables\": {\n                \"CMAKE_TOOLCHAIN_FILE\": \"${sourceDir}/conan-generated/conan_toolchain.cmake\",\n                \"FORCE_BUNDLED_MINIZIP\": \"OFF\"\n            }\n        },\n        {\n            \"name\": \"base-release\",\n            \"inherits\": \"release-binary-dir\",\n            \"hidden\": true,\n            \"cacheVariables\": {\n                \"CMAKE_INSTALL_PREFIX\": \"${sourceDir}/out/install/${presetName}\",\n                \"PACKAGE_FILE_NAME\" : \"$env{VCMI_PACKAGE_FILE_NAME}\",\n                \"PACKAGE_NAME_SUFFIX\" : \"$env{VCMI_PACKAGE_NAME_SUFFIX}\",\n                \"CMAKE_BUILD_TYPE\": \"RelWithDebInfo\",\n                \"ENABLE_TEST\": \"OFF\",\n                \"ENABLE_STRICT_COMPILATION\": \"ON\",\n                \"ENABLE_GOLDMASTER\": \"$env{VCMI_PACKAGE_GOLDMASTER}\",\n                \"ENABLE_PCH\" : \"OFF\"\n            }\n        },\n        {\n            \"name\": \"default-release\",\n            \"inherits\": \"base-release\",\n            \"hidden\": true,\n            \"generator\": \"Ninja\",\n            \"cacheVariables\": {\n                \"FORCE_BUNDLED_FL\": \"OFF\"\n            }\n        },\n        {\n            \"name\" : \"linux-release\",\n            \"inherits\" : \"default-release\",\n            \"hidden\": true,\n            \"cacheVariables\": {\n                \"CMAKE_INSTALL_PREFIX\" : \"/usr/local\"\n            }\n        },\n        {\n            \"name\": \"linux-test\",\n            \"inherits\": \"linux-release\",\n            \"hidden\": true,\n            \"cacheVariables\": {\n                \"ENABLE_LOBBY\": \"ON\",\n                \"ENABLE_TEST\": \"ON\",\n                \"ENABLE_LUA\": \"ON\"\n            }\n        },\n        {\n            \"name\": \"linux-clang-release\",\n            \"displayName\": \"Clang x86_64-pc-linux-gnu\",\n            \"description\": \"VCMI Linux Clang\",\n            \"inherits\": \"linux-release\",\n            \"cacheVariables\": {\n                \"CMAKE_C_COMPILER\": \"/usr/bin/clang\",\n                \"CMAKE_CXX_COMPILER\": \"/usr/bin/clang++\"\n            }\n        },\n        {\n            \"name\": \"linux-clang-release-ccache\",\n            \"displayName\": \"Clang x86_64-pc-linux-gnu with ccache\",\n            \"description\": \"VCMI Linux Clang with ccache\",\n            \"inherits\": \"linux-release\",\n            \"cacheVariables\": {\n                \"ENABLE_CCACHE\": \"ON\"\n            }\n        },\n        {\n            \"name\": \"linux-gcc-release\",\n            \"displayName\": \"GCC x86_64-pc-linux-gnu\",\n            \"description\": \"VCMI Linux GCC\",\n            \"inherits\": \"linux-release\",\n            \"cacheVariables\": {\n                \"ENABLE_LUA\" : \"ON\",\n                \"CMAKE_C_COMPILER\": \"/usr/bin/gcc\",\n                \"CMAKE_CXX_COMPILER\": \"/usr/bin/g++\"\n            }\n        },\n        {\n            \"name\": \"linux-gcc-release-ccache\",\n            \"displayName\": \"GCC x86_64-pc-linux-gnu with ccache\",\n            \"description\": \"VCMI Linux GCC with ccache\",\n            \"inherits\": \"linux-release\",\n            \"cacheVariables\": {\n                \"ENABLE_CCACHE\": \"ON\"\n            }\n        },\n        {\n            \"name\": \"linux-gcc-debug\",\n            \"displayName\": \"GCC x86_64-pc-linux-gnu (debug)\",\n            \"description\": \"VCMI Linux GCC (Debug)\",\n            \"inherits\": \"linux-release\",\n            \"cacheVariables\": {\n                \"CMAKE_BUILD_TYPE\": \"Debug\",\n                \"ENABLE_LUA\" : \"ON\",\n                \"CMAKE_C_COMPILER\": \"/usr/bin/gcc\",\n                \"CMAKE_CXX_COMPILER\": \"/usr/bin/g++\"\n            }\n        },\n        {\n            \"name\": \"linux-clang-test\",\n            \"displayName\": \"Clang x86_64-pc-linux-gnu with unit testing\",\n            \"description\": \"VCMI Linux Clang\",\n            \"inherits\": \"linux-test\",\n            \"cacheVariables\": {\n                \"CMAKE_C_COMPILER\": \"/usr/bin/clang\",\n                \"CMAKE_CXX_COMPILER\": \"/usr/bin/clang++\"\n            }\n        },\n        {\n            \"name\": \"linux-gcc-test\",\n            \"displayName\": \"GCC x86_64-pc-linux-gnu with unit testing\",\n            \"description\": \"VCMI Linux GCC\",\n            \"inherits\": \"linux-test\",\n            \"cacheVariables\": {\n                \"ENABLE_LUA\" : \"OFF\",\n                \"CMAKE_C_COMPILER\": \"/usr/bin/gcc\",\n                \"CMAKE_CXX_COMPILER\": \"/usr/bin/g++\"\n            }\n        },\n        {\n            \"name\": \"windows-mingw-release\",\n            \"displayName\": \"Windows x64 MinGW Release\",\n            \"description\": \"VCMI Windows Ninja using MinGW\",\n            \"inherits\": \"default-release\",\n            \"cacheVariables\": {\n                \"CMAKE_BUILD_TYPE\": \"Release\",\n                \"CMAKE_C_COMPILER\": \"gcc\",\n                \"CMAKE_CXX_COMPILER\": \"g++\"\n            }\n        },\n        {\n            \"name\": \"windows-msvc-release\",\n            \"displayName\": \"Windows x64 RelWithDebInfo\",\n            \"description\": \"VCMI RelWithDebInfo build\",\n            \"inherits\": \"default-release\",\n            \"generator\": \"Visual Studio 17 2022\",\n            \"architecture\": {\n                \"value\": \"x64\",\n                \"strategy\": \"set\"\n            },\n            \"cacheVariables\": {\n                \"CMAKE_TOOLCHAIN_FILE\": \"${sourceDir}/vcpkg/scripts/buildsystems/vcpkg.cmake\",\n                \"CMAKE_POLICY_DEFAULT_CMP0091\": \"NEW\",\n                \"FORCE_BUNDLED_MINIZIP\": \"ON\"\n\n            }\n        },\n        {\n            \"name\": \"windows-msvc-release-x86\",\n            \"displayName\": \"Windows x86 RelWithDebInfo\",\n            \"description\": \"VCMI RelWithDebInfo build\",\n            \"inherits\": \"default-release\",\n            \"generator\": \"Visual Studio 17 2022\",\n            \"cacheVariables\": {\n                \"CMAKE_TOOLCHAIN_FILE\": \"${sourceDir}/vcpkg/scripts/buildsystems/vcpkg.cmake\",\n                \"CMAKE_POLICY_DEFAULT_CMP0091\": \"NEW\",\n                \"FORCE_BUNDLED_MINIZIP\": \"ON\",\n                \"CMAKE_GENERATOR_PLATFORM\": \"WIN32\"\n            }\n        },\n        {\n            \"name\": \"windows-msvc-release-ccache\",\n            \"displayName\": \"Windows x64 RelWithDebInfo with ccache\",\n            \"description\": \"VCMI RelWithDebInfo build with ccache\",\n            \"inherits\": \"windows-msvc-release\",\n            \"cacheVariables\": {\n                \"ENABLE_CCACHE\": \"ON\"\n\n            }\n        },\n        {\n            \"name\": \"windows-mingw-conan-linux\",\n            \"displayName\": \"Ninja+Conan release\",\n            \"description\": \"VCMI Windows Ninja using Conan on Linux\",\n            \"inherits\": [\n                \"build-with-conan\",\n                \"default-release\"\n            ],\n            \"cacheVariables\": {\n                \"CMAKE_BUILD_TYPE\": \"Release\",\n                \"FORCE_BUNDLED_FL\": \"ON\"\n            }\n        },\n        {\n            \"name\": \"macos-ninja-release\",\n            \"displayName\": \"Ninja release\",\n            \"description\": \"VCMI MacOS Ninja\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"macos-conan-ninja-release\",\n            \"displayName\": \"Ninja+Conan release\",\n            \"description\": \"VCMI MacOS Ninja using Conan\",\n            \"inherits\": [\n                \"build-with-conan\",\n                \"default-release\"\n            ],\n            \"cacheVariables\": {\n                \"CMAKE_BUILD_TYPE\": \"Release\"\n            }\n        },\n        {\n            \"name\": \"macos-arm-conan-ninja-release\",\n            \"displayName\": \"Ninja+Conan arm64 release\",\n            \"description\": \"VCMI MacOS-arm64 Ninja using Conan\",\n            \"inherits\": \"macos-conan-ninja-release\"\n        },\n        {\n            \"name\": \"macos-xcode-release\",\n            \"displayName\": \"XCode release\",\n            \"description\": \"VCMI MacOS Xcode\",\n            \"inherits\": \"default-release\",\n            \"generator\": \"Xcode\"\n        },\n        {\n            \"name\": \"ios-device\",\n            \"displayName\": \"Base iOS device\",\n            \"description\": \"Base VCMI preset for iOS device\",\n            \"generator\": \"Xcode\",\n            \"binaryDir\": \"../build-${presetName}\",\n            \"cacheVariables\": {\n                \"CMAKE_SYSTEM_NAME\": \"iOS\",\n                \"FORCE_BUNDLED_FL\": \"ON\",\n                \"FORCE_BUNDLED_MINIZIP\": \"ON\",\n                \"ENABLE_EDITOR\" : \"OFF\"\n            }\n        },\n        {\n            \"name\": \"ios-simulator\",\n            \"displayName\": \"Base iOS simulator\",\n            \"description\": \"Base VCMI preset for iOS simulator\",\n            \"inherits\": \"ios-device\",\n            \"cacheVariables\": {\n                \"CMAKE_OSX_SYSROOT\": \"iphonesimulator\"\n            }\n        },\n        {\n            \"name\": \"ios-device-conan\",\n            \"displayName\": \"Base iOS device using Conan\",\n            \"description\": \"Base VCMI preset for iOS device using Conan\",\n            \"inherits\": [\n                \"build-with-conan\",\n                \"ios-device\"\n            ]\n        },\n        {\n            \"name\": \"base-ios-release\",\n            \"displayName\": \"Base iOS release\",\n            \"description\": \"Base VCMI preset for iOS release\",\n            \"inherits\": \"base-release\",\n            \"hidden\": true,\n            \"cacheVariables\": {\n                \"BUNDLE_IDENTIFIER_PREFIX\": \"eu.vcmi\"\n            }\n        },\n        {\n            \"name\": \"ios-release-conan\",\n            \"displayName\": \"iOS+Conan release\",\n            \"description\": \"VCMI iOS release using Conan\",\n            \"inherits\": [\n                \"base-ios-release\",\n                \"ios-device-conan\"\n            ],\n            \"cacheVariables\": {\n                \"ENABLE_PCH\" : \"ON\"\n            }\n        },\n        {\n            \"name\": \"ios-release-conan-ccache\",\n            \"displayName\": \"iOS+Conan release using ccache\",\n            \"description\": \"VCMI iOS release using Conan and ccache\",\n            \"inherits\": \"ios-release-conan\",\n            \"cacheVariables\": {\n                \"ENABLE_PCH\" : \"OFF\",\n                \"ENABLE_CCACHE\": \"ON\"\n            }\n        },\n        {\n            \"name\": \"ios-release-legacy\",\n            \"displayName\": \"iOS release using legacy dependencies\",\n            \"description\": \"VCMI iOS release using legacy dependencies\",\n            \"inherits\": [\n                \"base-ios-release\",\n                \"ios-device\"\n            ],\n            \"cacheVariables\": {\n                \"CMAKE_PREFIX_PATH\": \"${sourceDir}/build/iphoneos\"\n            }\n        },\n        {\n            \"name\": \"android-conan-ninja-release\",\n            \"displayName\": \"Android release\",\n            \"description\": \"VCMI Android Ninja using Conan\",\n            \"inherits\": [\n                \"build-with-conan\",\n                \"default-release\"\n            ],\n            \"cacheVariables\": {\n                \"CMAKE_BUILD_TYPE\": \"RelWithDebInfo\",\n                \"ANDROIDDEPLOYQT_OPTIONS\" : \"--aab\"\n            }\n        },\n        {\n            \"name\": \"android-daily-release\",\n            \"displayName\": \"Android daily release\",\n            \"description\": \"VCMI Android daily build\",\n            \"inherits\": \"android-conan-ninja-release\",\n            \"cacheVariables\": {\n                \"ANDROID_GRADLE_PROPERTIES\": \"applicationIdSuffix=.daily;signingConfig=dailySigning;applicationLabel=VCMI daily;applicationVariant=daily\"\n            }\n        }\n    ],\n    \"buildPresets\": [\n        {\n            \"name\": \"default-release\",\n            \"hidden\": true,\n            \"configuration\": \"RelWithDebInfo\"\n        },\n        {\n            \"name\": \"default-debug\",\n            \"hidden\": true,\n            \"configuration\": \"Debug\"\n        },\n        {\n            \"name\": \"linux-clang-release\",\n            \"configurePreset\": \"linux-clang-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"linux-clang-release-ccache\",\n            \"configurePreset\": \"linux-clang-release-ccache\",\n            \"inherits\": \"linux-clang-release\"\n        },\n        {\n            \"name\": \"linux-clang-test\",\n            \"configurePreset\": \"linux-clang-test\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"linux-gcc-test\",\n            \"configurePreset\": \"linux-gcc-test\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"linux-gcc-release\",\n            \"configurePreset\": \"linux-gcc-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"linux-gcc-release-ccache\",\n            \"configurePreset\": \"linux-gcc-release-ccache\",\n            \"inherits\": \"linux-gcc-release\"\n        },\n        {\n            \"name\": \"linux-gcc-debug\",\n            \"configurePreset\": \"linux-gcc-debug\",\n            \"inherits\": \"default-debug\"\n        },\n        {\n            \"name\": \"macos-xcode-release\",\n            \"configurePreset\": \"macos-xcode-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"macos-ninja-release\",\n            \"configurePreset\": \"macos-ninja-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"macos-conan-ninja-release\",\n            \"configurePreset\": \"macos-conan-ninja-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"macos-arm-conan-ninja-release\",\n            \"configurePreset\": \"macos-arm-conan-ninja-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"windows-mingw-release\",\n            \"configurePreset\": \"windows-mingw-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"windows-msvc-release\",\n            \"configurePreset\": \"windows-msvc-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"windows-msvc-release-x86\",\n            \"configurePreset\": \"windows-msvc-release-x86\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"windows-msvc-release-ccache\",\n            \"configurePreset\": \"windows-msvc-release-ccache\",\n            \"inherits\": \"windows-msvc-release\"\n        },\n        {\n            \"name\": \"windows-msvc-relwithdebinfo\",\n            \"configurePreset\": \"windows-msvc-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"windows-mingw-conan-linux\",\n            \"configurePreset\": \"windows-mingw-conan-linux\",\n            \"inherits\": \"default-release\",\n            \"configuration\": \"Release\"\n        },\n        {\n            \"name\": \"ios-release-conan\",\n            \"configurePreset\": \"ios-release-conan\",\n            \"inherits\": \"default-release\",\n            \"configuration\": \"Release\",\n            \"targets\": [\"vcmiclient\"],\n            \"nativeToolOptions\": [\n                \"CODE_SIGNING_ALLOWED_FOR_APPS=NO\"\n            ]\n        },\n        {\n            \"name\": \"ios-release-conan-ccache\",\n            \"configurePreset\": \"ios-release-conan-ccache\",\n            \"inherits\": \"ios-release-conan\"\n        },\n        {\n            \"name\": \"ios-release-legacy\",\n            \"configurePreset\": \"ios-release-legacy\",\n            \"inherits\": \"ios-release-conan\"\n        },\n        {\n            \"name\": \"android-conan-ninja-release\",\n            \"configurePreset\": \"android-conan-ninja-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"android-daily-release\",\n            \"configurePreset\": \"android-daily-release\",\n            \"inherits\": \"android-conan-ninja-release\"\n        }\n    ],\n    \"testPresets\": [\n        {\n            \"name\": \"default-release\",\n            \"hidden\": true,\n            \"output\": {\n                \"shortProgress\": true,\n                \"verbosity\": \"verbose\"\n            }\n        },\n        {\n          \"name\": \"linux-clang-release\",\n          \"configurePreset\": \"linux-clang-release\",\n          \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"linux-gcc-release\",\n            \"configurePreset\": \"linux-gcc-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"linux-clang-test\",\n            \"configurePreset\": \"linux-clang-test\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"linux-gcc-test\",\n            \"configurePreset\": \"linux-gcc-test\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"macos-xcode-release\",\n            \"configurePreset\": \"macos-xcode-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"macos-ninja-release\",\n            \"configurePreset\": \"macos-ninja-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"windows-mingw-release\",\n            \"configurePreset\": \"windows-mingw-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"windows-msvc-release\",\n            \"configurePreset\": \"windows-msvc-release\",\n            \"inherits\": \"default-release\"\n        },\n        {\n            \"name\": \"windows-mingw-conan-linux\",\n            \"configurePreset\": \"windows-mingw-conan-linux\",\n            \"inherits\": \"default-release\"\n        }\n    ]\n}\n"
        },
        {
          "name": "ChangeLog.md",
          "type": "blob",
          "size": 167.7060546875,
          "content": "# VCMI Project Changelog\n\n## 1.6.2 -> 1.6.3\n\n### Stability\n\n* Fixed possible crash on attempt to play corrupted video file\n* Fixed possible crash on invalid or corrupted game data\n* Fixed possible crash on invalid upscaling filter\n\n### Interface\n\n* Added right-click popup to Keymasters, Border Guards, and Border Gates that show all discovered objects of the same color\n* Added right-click popup to Obelisks that shows all discovered objects and their visitation status\n* Added support for randomly selected main menu backgrounds\n* Fixed display of long text in text-only right-click popups\n* Hero overview screen on map setup will now have scrollbars for hero desription when necessary\n* Fixed teleporter right-click popup appearing out of screen when interacting with teleporter near screen edge\n* Scenario Information window will now correctly replace random hero with actual starting hero\n\n### AI\n\n* Improved performance of Battle AI\n* Improved performance of pathfinding calculations\n* Reduced calculation of threat range, especially on low difficulties to improve performance\n* Fixed Nullkiller AI not considering nearby objects for visiting in some cases, breaking its exploration logic\n* Fixed Nullkiller AI not building town dwellings\n\n### Map Editor\n\n* Added option to convert .h3c files into .vcmp\n* It is now possible to configure town to have same faction as player\n\n## 1.6.1 -> 1.6.2\n\n### General\n\n* Holding Alt while in town will now highlight all interactive buildings in town\n* Fixed missing surrender video on battle results dialog\n* Game will no longer show custom campaigns dialog for short period when selecting Heroes III campaign\n* Added workaround for right mouse button being recognized as 'back' button on some Android devices\n* Fixed regression that caused second and further upgrades that were not functioning correctly\n* Fixed regression that sometime caused curved path that leads to a blocked monolith in random map generation\n* Fixed regression that broke several mechanics, such as issues with Legion artifacts or with Gelu/Dracon specialties\n* Fixed broken positioning for some images when selected scaling factor is different from prescaled texture factor\n\n### Stability\n\n* Game will now show list of mods with critical issues that might cause crash after game start\n* Fixed crash in map editor on attempt to copy wandering monster\n* Fixed crash on having unsupported mod (e.g. Era mod) in a preset\n* Fixed crash on attempt to update a mod that depends on unknown mod that is not installed or not available in repository\n* Fixed possible crash on attempt to flip an empty image\n* Fixed possible crash on attempt to remove old saves\n\n### Campaigns\n\n* Game will now select correct scenario in campaigns with multiple available scenarios\n* Added blink animation for campaign scenario selection\n\n### AI\n\n* Nullkiller AI will now only upgrade units if this would increase their AI value. Fixes possible freeze on upgrading units in some mods that can be upgraded in both directions\n* Nullkiller AI will no longer attempt to build Mage Guild of 4th or 5th levels in towns without such guild\n* Battle AI now correctly estimates damage for spells that completely eliminate a unit\n* Fixed bug preventing AI from casting damaging spells if his troops are unable to reach enemies, for example during siege\n\n## 1.6.0 -> 1.6.1\n\n### General\n\n* Right-click popup for Monoliths, Subterranean Gates and Whirlpools now shows location of all known entrances and exits.\n* Added support for importing and exporting mod presets in the launcher.\n* Added option to VCMI popup menu on Android to skip launcher and start game immediately.\n* Fixed defeat music not stopping when skipping defeat movie playback.\n* Launcher will now open start game tab instead of mods tab after initial setup if no mods were chosen for install\n\n### Performance\n\n* xbrz is no longer auto-selected on mobile platforms, and only xbrz2 can be auto-selected on PC platforms. Manual selection is unaffected.\n* Fixed a performance regression that more than doubled the time of random map generation.\n* Improved performance of the Nullkiller AI, which should now take turns up to twice as fast.\n* Minor xbrz performance improvements.\n\n### Stability\n\n* Fixed application freeze when clicking buttons with popup message on some versions of iOS\n* Fixed crash when trying to install a mod when no mod is selected\n* Fixed possible crash when trying to load non-existing frame from .def file\n* Fixed crash when right-clicking on modded market items, such as HotA's Junkman.\n* Fixed crash when trying to activate mod with recursive dependencies\n* Fixed crash when trying to activate Chronicles mod after failed import\n* Fixed crash when attempting to access a non-installed mod when repository checkout is off.\n* Show error message on failure to load filesystem instead of crashing in launcher\n* Added workaround for crash on attempt to delete non-existent save/map\n\n### Adventure AI\n\n* AI can now use all possible upgrades on Hill Fort, including alternative upgrades.\n* AI will now correctly identify and use 8th creature dwelling (e.g. Factory)\n* AI will now correctly identify 2nd level upgrades to dwellings (e.g. Cove) and score them accordingly.\n\n### Interface\n\n* Fixed poor alignment of hero primary skill descriptions in the Thieves' Guild menu.\n* Fixed missing description for spell school immunity in creature window\n* Fixed bonuses such as OPENING_BATTLE_SPELL not appearing in creature window.\n\n## 1.5.7 -> 1.6.0\n\n### Major changes\n\n* Greatly improved decision-making of NullkillerAI\n* Implemented support for multiple mod presets allowing player to quickly switch between them in Launcher\n* Implemented handicap system, with options to reduce income and growth in addition to starting resources restriction\n* Game will now show statistics after scenario completion, such as resources or army strength over time\n* Implemented spell quick selection panel in combat\n* Implemented adventure map overlay accessible via Alt key that highlights all interactive objects on screen\n* Implemented xBRZ upscaling filter\n* Added support for high-resolution graphical assets\n* It is now possible to import data from Heroes Chronicles (gog.com installer only) as custom campaigns\n* Added simple support for spell research feature from HotA that can be enabled via mod or game configuration editing\n* Implemented automatic selection of interface scaling. Selecting interface scaling manually will restore old behavior\n* VCMI will now launch in fullscreen on desktop systems. Use F4 hotkey or toggle option in settings to restore old behavior\n\n### General\n\n* Saved game size reduced by approximately 3 times, especially for large maps or games with a large number of mods.\n* Mods that modify game texts, such as descriptions of secondary skills, will now correctly override translation mods\n* Game will now correctly restore information such as hero path, order of heroes and towns, and list of sleeping heroes on loading a save game\n* Added translation for missing texts, such as random map descriptions, quick exchange buttons, wog commander abilities, moat names\n* When playing in non-English language using English Heroes III data files, game will now load all maps and campaigns using player language\n* Added `vcmiscrolls` cheat code that gives spell scrolls for every possible spells\n\n### Multiplayer\n\n* Added option to start vcmi server on randomly selected TCP port\n* Fixed potential desynchronization between server and clients on randomization of map objects if client and server run on different operating systems\n* Fixed possible freeze on receiving turn in multiplayer when player has town window opened\n* Fixed possible freeze if player is attacked by another player on first day of the week\n* If player disconnects from a multiplayer game, all other players will now receive notification in form of popup message instead of chat message\n* Fixed potentially missing disconnection notification in multiplayer if player disconnects due to connection loss\n* Game will now correctly show turn timers and simultaneous turns state on loading game\n\n### Stability\n\n* Fixed possible crash on connecting bluetooth mouse during gameplay on Android\n* VCMI will now write more detailed information to log file on crash due to uncaught exception\n* Fixed crash on transfer of multiple artifacts in a backpack to another hero on starting next campaign scenario without hero that held these artifacts before\n* Fixed crash on dismissing hero after picking up an artifact from hero doll\n* Fixed possible crash if creature with spell before attack bonus kills unit it was attacking with spell\n\n### Mechanics\n\n* Arrow tower will now prefer to attack more units that are viewed most dangerous instead of simply attacking top-most unit\n* Score in campaigns will now be correctly tracked for games loaded from a save\n* Fixed incorrect direction of Dragon Breath attack in some cases if wide creature attacks another wide creature\n* Map events and town events are now triggered on start of turn of player affected by event, in line with H3 instead of triggering on start of new day for all players\n* Neutral towns should now have initial garrison and weekly growth of garrison identical to H3\n* It is now possible to buy a new war machine in town if hero has different war machine in the slot\n* Fixed possible integer overflow if hero has unit with total AI value of over 2^31\n* Unicorn Glade in Rampart now correctly requires Dendroid Arches and not Homestead\n* Game will no longer place obstacles on ship-to-ship battles, in line with H3\n* Game will now place obstacles in battles in villages (towns without forts)\n* Battles in villages (towns without forts) now always occur on battlefield of native terrain\n* Fixed pathfinding through subterranean gates located on right edge of the map or next to terra incognita\n* Chain Lightning will now skip over creatures that are immune to this spell instead of targeting them but dealing no damage\n* Commanders spell resistance now uses golem-like logic which reduces damage instead of using dwarf-style change to block spell\n* It is now possible to target empty hex for shooters with area attack, such as Magog or Lich\n* View Earth will no longer reveal position of enemy heroes and towns\n* It is now possible to sell Grail, in line with Heroes III\n* Jeddite is no longer female\n* Mutare and Mutare Drake are now Overlord and not Warlock\n* Elixir of Life no longer affects siege machines\n* Banned skills known by hero now have minimal chance (1) instead of 0 to appear on levelup\n* The Transport Artifact victory condition fulfilled by the enemy AI will no longer trigger a victory for human players if \"standard victory\" is enabled on the map\n\n### Video / Audio\n\n* Fixed playback of audio stream with different formats from video files in some Heroes 3 versions\n* Video playback will not be replaced by a black square when another dialogue box is on top of the video.\n* When resuming video playback, the video will now be continued instead of being restarted.\n* Reduced video decompression artefacts for video formats that store RGB rather than YUV data.\n* Intro videos are now played inside a frame on resolutions higher than 800x600 instead of filling entire screen\n* Re-enabled idle animations for Conflux creatures in battles\n* .webm video with vp8 / vp9 codec are now supported on every platform\n* It is now possible to provide external audio stream for a video file (e.g. for translations)\n* It is now possible to provide external subtitles for a video file\n* Game will now correctly resume playback of terrain music on closing scenario information window in campaigns instead of playing main theme\n* Background music theme will now play at lower volume while intro speech in campaign intro / outro is playing\n* Added workaround for playback of corrupted `BladeFWCampaign.mp3` music file\n* Fixed computation of audio length for formats other than .wav. This fixes incorrect text scrolling speed in campaign intro/outro\n* Game will now use Noto family true type font to display characters not preset in Heroes III fonts\n* Added option to scale all in-game fonts when scalable true type fonts are in use\n* Some of the assets provided by VCMI are now available in higher resolution\n* Implemented support for semi-transparent spell effects, such as Life Drain or Resurrection (and many others)\n\n### Interface\n\n* It is now possible to search for a map object using Ctrl+F hotkey\n* Holding Alt while using move unit button on Exchange screen will now move entire army except for single unit in this slot\n* Added option to drag map with right-click\n* Added hotkeys to reorder list of owned towns or heroes\n* The number of units resurrected using the Life Drain ability is now written to the combat log.\n* Fixed order of popup dialogs after battle.\n* Creature window now displays source of all bonuses that creature has, such as creature ability, hero skill, hero artifact, etc.\n* Reduced font used for creature abilities description to reduce text clipping\n* Right-click on wandering monster on adventure map will now also show creature level and faction it belongs to\n* Added additional information to map right-click popup dialog: map author, map creation date, map version\n* Added scrollbars for selection of starting town, starting hero, and tavern invite if number of objects is too large to fit into the screen\n* Fixed incorrect battle turn queue displaying incorrect turn order when all units have waited\n* Semi-transparent shadows now correctly update their transparency during fading effects, such as resource pickups\n* Fixed swapped Overlord and Warlock models on adventure map\n* Fixed Heroes III bug - swapped icons of View Earth and View Air\n* Game will now save all names for human player in hotseat mode\n* Added unassigned by default shortcuts for toggling visibility of visitable and blocked tiles\n* Spellbook button in battle is now blocked if hero has no spellbook\n* Adventure map will no longer scroll if window is not in focus\n* Removed second info window when player loses his last town\n* Fixed hero path not updating correctly after hiring or dismissing creatures\n* Fixed missing description of a stack artifact when accessed through unit window\n* Fixed text overflow on campaign scenario window if campaign name is too long\n* Recruiting hero in town will now play \"new construction\" sound\n* Game will now correctly update displayed hero path when hiring or dismissing creatures that give movement penalty\n* Game will now show level, faction and attack range of wandering monsters in right-click popup window\n* Hovering over owned hero will now show movement points information in status bar\n* Quick backpack window is now also accessible via Shift+mouse click, similar to HD Mod\n* It is now possible to sort artifacts in backpack by cost, slot, or rarity class\n* Fixed incorrect display of names of VCMI maps in scenario selection if multiple VCMI map are present in list\n* Fixed bug leading to inability to select larger number of \"CPU only players\" in random map generation menu\n* It is now possible to delete saved games\n* Game will now promt to delete saves from no longer supported versions of VCMI\n* It is now possible to use scroll in touch popup windows\n* Name of spell provided by Shrine is now displayed in yellow color\n* Fixed right-click popup on hero in town placed outside of screen boundaries on low resolutions\n* Fixed misaligned button in 2-player alliance selector in random map generation menu\n* Damage range of Ballista in unit window now accounts for hero attack skill, in line with Heroes III\n* Changed format of automatic autosave to more human-readable version\n* Names of autosave folders are now left-aligned in save game list\n\n### Random Maps Generator\n\n* Implemented connection option 'forcePortal'\n* It is now possible to connect zone to itself using pair of portals\n* It is now possible for a random map template to change game settings\n* Road settings will now be correctly loaded when opening random map setup tab\n* Roads placed on the maps will now be curved a little bit to improve the look of the maps.\n* Added support for banning objects per zones\n* Added support for customizing objects frequency, value, and count per zone\n* Fixed values of Pandora Boxes with creatures to be in line with H3:SoD\n* Added sealed zone types, for entirely unpassable zones.\n* It is now possible to connect two zones with multiple connections of same or different types\n\n### Campaigns\n\n* It is now possible to use .zip archive for VCMI campaigns instead of raw gzip stream\n* Fixed handling of hero placeholders in VCMI map format (.vmap)\n* Fixed not functioning hero carryover in VCMI campaigns\n* Added support for campaign outro videos, such as outro in \"Song for the Father\" campaign\n* Added support for rim image for intro video, such as opening videos in Heroes Chronicles\n* Added support for custom loading screen in campaigns\n* Added support for custom region definitions (such as background images) for VCMI campaigns\n\n### Adventure AI\n\n* Greatly improved decision-making of NullkillerAI\n* NullkillerAI will now act differently based on difficulty level\n* Fixed several cases where Nullkiller AI can count same dangerous object twice, doubling expected army loss.\n* Nullkiller is now capable of visiting configurable objects from mods\n* Nullkiller now uses whirlpools for map movement\n* Fixed possible crash on AI attempting to visit town that is already being visited by this hero\n* It is now possible to configure NullkillerAI parameters separately for each game difficulty\n* Extended hardcoded logic of AI not taking creatures from Garrisons to all Heroes III: Restoration of Erathia campaigns, in line with original game\n\n### Combat AI\n\n* VCMI will now use BattleAI for battles with neutral enemies by default\n* Fixed bug where BattleAI attempts to move double-wide unit to an unreachable hex\n* Fixed a bug causing BattleAI to focus on unreachable targets and ignoring reachable enemies\n* AI can now correctly estimate effect of Dragon Breath and other similar abilities\n* Battle AI should now avoid ending turn on the moat\n* Fixed case where BattleAI will go around the map to attack ranged units if direct path is blocked by another unit\n* Fixed evaluation of effects of waiting if unit is under haste effect by Battle AI\n* Battle AI can now use location spells\n* Battle AI will now correctly avoid moving flying units into dangerous obstacles such as moat\n\n### Launcher\n\n* Implemented support for multiple mod presets allowing player to quickly switch between them\n* Added new Start Game page to Launcher which is now used when starting the game\n* Added option to create empty mod preset to quickly disable all mods\n* Added button to update all installed mods to Start Game page\n* Added diagnostics to detect common issues with Heroes III data files\n* Added built-in help descriptions for functionalities such as data files import to better explain them to players\n* It is now always possible to disable or uninstall a mod. Any mods that depend on this mod will be automatically disabled\n* It is now always possible to update a mod, even if there are mods that depend on this mod.\n* It is now possible to enable mod that conflicts with already active mod. Conflicting mods will be automatically disabled\n* If main mod is disabled, all its submods will have their active or inactive status shown as greyed-out for clarity\n* If mod depends or conflicts with a submod, Launcher will now also show name of parent mod in list of dependencies / conflicts\n* Game will now cache result of mod repository checkout and restore it immediately on next start. This removes flickering when game fills list of available mods.\n* Screenshot and Changelog tabs in mod description are now disabled for mods that do not have them.\n* Launcher will now correctly show conflicts on both sides - if mod A is marked as conflicting with B, then information on this conflict will be shown in description of both mod A and mod B (instead of only in mod B)\n* Added Swedish translation\n* Added better diagnostics for gog installer extraction errors\n* It is no longer possible to start installation or update for a mod that is already being downloaded\n* Fixed detection of existing Heroes III Complete or Shadow of Death data files during import\n\n### Map Editor\n\n* It is now possible to remove any map object as part of timed event\n* Implemented tracking of building requirements for Building Dialog\n* Added build/demolish/enable/disable all buildings options to Building Dialog in town properties\n* Added support for customization of heroes artifacts\n* Implemented configuration of patrol radius for heroes\n* It is now possible to set spells allowed or required to be present in Mages Guild\n* It is now possible to add timed events to a town\n* Fixed editor not marking mod as dependency if spells from mod are used in town Mages Guild or in hero starting spells\n* It is now possible to choose road types for random map generation in editor\n* Validator will now warn in case if map has players with no heroes or towns\n* Fixed broken transparency handling on some adventure map objects from mods\n* Fixed duplicated list of spells in Mage Guild in copy-pasted towns\n* Removed separate versioning of map editor. Map editor now has same version as VCMI\n* Timed events interfaces now counts days from 1, instead of from 0\n* Added Recent Files to File Menu and Toolbar\n* Fixed crash on attempting to save map with random dwelling\n\n### Modding\n\n* Json configuration files from different mods no longer can override each other to reduce possibility of a file name clash\n* Game will now load high-resolution assets when xbrz upscaler is in use from Data2x, Data3x, Data4x, or Sprites2x, Sprites3x, Sprites4x directories.\n* Game will now load high-resolution movies when xbrz upscaler is in use from Video2x, Video3x, Video4x directories\n* Added support for configurable flaggable objects that can provide bonuses or daily income to owning player\n* Added support for soft dependencies for mods, that only affect mod loading order (and as result - override order), without requiring dependent mod or allowing access to its identifiers\n* It is now possible to provide translations for mods that modify strings from original game, such as secondary skill descriptions\n* It is now possible to embed json data directly into mod.json instead of using list of files\n* Implemented detection of potential conflicts between mods. To enable, open Launcher and set \"Mod Validation\" option to \"Full\"\n* Fixed multiple issues with configurable town buildings\n* Added documentation for configurable town buildings. See docs/Moddders/Entities_Format/Town_Buildings_Format.md\n* Replaced some of hardcoded town buildings with configurable buildings. These building types are now deprecated and will be removed in future.\n* Added support for explicitly visitable town buildings that will activate only on click and not on construction or on hero visit (Mana Vortex from HotA)\n* It is now possible to add guards to a configurable objects. All H3 creature banks are now implemented as configurable object.\n* It is now possible to define starting position of units in a guarded configurable object\n* It is now possible to add description to an object with \"market\" handler\n* Added `canCastWithoutSkip` parameter to a spell. If such spell is cast by a creature, its turn will not end after a spellcast\n* Added `castOnlyOnSelf` parameter to a spell. Creature that can cast this spell can only cast it on themselves\n* Mod can now provide pregenerated assets in place of autogenerated, such as large spellbook.\n* Added support for 'fused' artifacts, as alternative to combined artifacts\n* Added support for custom music and opening sound for a battlefield\n* Added support for multiple music tracks for towns\n* Added support for multiple music tracks for terrains on adventure map\n* Fixed several cases where vcmi will report errors in json without specifying filename of invalid file\n* Fixed selection of gendered sprites for heroes on adventure map\n* It is now possible to change minimal values of primary skills for heroes\n* Added support for HotA Bank building from Factory\n* Added support for HotA Grotto buiding from Cove\n* Added support for HotA-style 8th creature in town\n* Town building can now define war machine produced in this building (Blacksmith or Ballista Yard)\n* Town building can now define provided fortifications - health of walls, towers, presence of moat, identifier of creature shooter on tower\n* War Machines Factory no longer unconditionally contain war machines from the original game, allowing mods to define list of war machines from scratch\n* Added MECHANICAL bonus\n* Added DISINTEGRATE bonus\n* Added INVINCIBLE bonus\n* Added PRISM_HEX_ATTACK_BREATH bonus\n* Added THIEVES_GUILD_ACCESS bonus that changes amount of information available in thieves guild\n* TimesStackLevelUpdater now supports commanders\n* Black market restock period setting now correctly restocks on specified date instead of restocking on all dates other than specified one\n* Json Validator will now attempt to detect typos when encountering unknown property in Json\n* Added `translate missing` command that will export only untranslated strings into `translationsMissing` directory, separated per mod\n* Added support for text subtitiles for video files\n* Added validation of objects with \"market\" and \"flaggable\" handlers\n* Added \"special\" property for secondary skills\n\n## 1.5.6 -> 1.5.7\n\n* Fixed game freeze if player is attacked in online multiplayer game by another player when he has unread dialogs, such as new week notification\n* Fixed possible game crash after being attacked by enemy with artifact that blocks spellcasting\n* Fixed heroes on map limit game setting not respected when moving hero from town garrison.\n* Add workaround to fix possible crash on attempt to start previously generated random map that has players without owned heroes or towns\n* Fixed crash on right-clicking spell icon when receiving unlearnable spells from Pandora\n* Fixed possible text overflow in match information box in online lobby\n* Fixed overlapping text in lobby login window\n* Fixed excessive removal of open dialogs such as new week or map events on new turn\n* Fixed objects like Mystical Gardens not resetting their state on new week correctly\n\n## 1.5.5 -> 1.5.6\n\n### Stability\n\n* Fixed possible crash on transferring hero to next campaign scenario if hero has combined artifact some components of which can be transferred\n* Fixed possible crash on transferring hero to next campaign scenario that has creature with faction limiter in his army\n* Fixed possible crash on application shutdown due to incorrect destruction order of UI entities\n\n### Multiplayer\n\n* Mod compatibility issues when joining a lobby room now use color coding to make them less easy to miss.\n* Incompatible mods are now placed before compatible mods when joining lobby room.\n* Fixed text overflow in online lobby interface\n* Fixed jittering simultaneous turns slider after moving it twice over short period\n* Fixed non-functioning slider in invite to game room dialog\n\n### Interface\n\n* Fixed some shortcuts that were not active during the enemy's turn, such as Thieves' Guild.\n* Game now correctly uses melee damage calculation when forcing a melee attack with a shooter.\n* Game will now close all open dialogs on start of our turn, to avoid bugs like locked right-click popups\n\n### Map Objects\n\n* Spells the hero can't learn are no longer hidden when received from a rewardable object, such as the Pandora Box\n* Spells that cannot be learned are now displayed with gray text in the name of the spell.\n* Configurable objects with scouted state such as Witch Hut in HotA now correctly show their reward on right click after vising them but refusing to accept reward\n* Right-click tooltip on map dwelling now always shows produced creatures. Player that owns the dwelling can also see number of creatures available for recruit\n\n### Modding\n\n* Fixed possible crash on invalid SPELL_LIKE_ATTACK bonus\n* Added compatibility check when loading maps with old names for boats\n\n## 1.5.4 -> 1.5.5\n\n* Fixed crash when advancing to the next scenario in campaigns when the hero not transferring has a combination artefact that can be transferred to the next scenario.\n* Fixed game not updating information such as hero path and current music on new day\n* Changed default battle queue hotkey from Q to Z to match HD Mod / HotA\n* Changed default hotkey for finishing battle with quick combat from E to Z to match HD Mod / HotA\n* Creature casting now uses both F and G keyboard hotkeys\n* Shift+left click now directly opens the hero window when two heroes are in town\n* Fixed handling of alternative actions for creatures that have more than two potential actions, such as move, shoot, and cast spells.\n\n## 1.5.3 -> 1.5.4\n\n### Stability\n\n* Fixed a possible crash when clicking on an adventure map when another player is taking a turn in multiplayer mode.\n* Failure to extract a mod will now display an error message instead of a silent crash.\n* Fixed crash on opening town hall screen of a town from a mod with invalid building identifier\n* Fixed crash when faerie dragons die after casting Ice Ring on themselves.\n\n### Mechanics\n\n* The scholar will now correctly upgrade a skill if the visiting hero has offered a skill at either the basic or advanced level.\n* Hero now reveals Fog of War when receiving new or upgraded secondary skills (such as scouting).\n* AI will now always act after all human players during simturns instead of acting after host player\n\n### Interface\n\n* Pressing the up and down keys on the town screen will now move to the next or previous town instead of scrolling through the list of towns.\n* Long text in scenario name and highscore screen now shortened to fit the interface\n* Game now moves cursor to tap event position when using software cursor with touch screen input\n* Right-click popup on spell scroll campaign bonus now shows spell name instead of artefact name\n* Damage estimation tooltip will no longer show damage greater than the targeted unit's health.\n\n### Random Maps Generator\n\n* Generator will try to place roads even further away from zone borders\n* Fixed rare crash when placing two quest artefacts in the same location at the same time\n\n### AI\n\n* Improved performance of Nullkiller AI\n* Stupid AI no longer overestimates damage when killing entire unit\n* Fixed a bug leading to Battle AI not using spells when sieging town with Citadel or Castle built\n* Fixed an unsigned integer overflow that caused the Nullkiller AI to overestimate the total army strength after merging two armies.\n\n### Launcher\n\n* Added button to reset touchscreen tutorial on mobile systems\n* Launcher will now warn if player selects Gog Galaxy installer instead of offline installer\n* Launcher will now ask for the .bin file first as it is usually listed first in the file system view\n* Extraction failure now displays error message instead of crashing\n* Launcher will now use the header signature to check the file type instead of the extension when using the gog.com installer.\n* Fixed broken controller sensitivity configuration options\n* Fixed manual file installation on Android\n\n### Map Editor\n\n* Icons and translations now embedded in executable file\n\n### Modding\n\n* Improved bonus format validation\n* Validator now reports valid values for enumeration fields\n* Fixed missing addInfo field for bonuses that use the BONUS_OWNER_UPDATER propagation updater.\n\n## 1.5.2 -> 1.5.3\n\n### Stability\n\n* Fixed possible crash when hero class has no valid commander.\n* Fixed crash when pressing spacebar or enter during combat when hero has no tactics skill.\n* Fixed crash when receiving a commander level-up after winning a battle in a garrison owned by an enemy player.\n* Fixed possible crash when exiting a multiplayer game.\n* Game will now display an error message and exit after loading instead of crashing silently if a creature's combat animation is missing.\n* Game should now generate crash dump on uncaught c++ exception throw\n* Fixed crash when player finishes game with negative score\n* Fixed crash when opening tavern window in some localisations\n* Fixed crash on loading previously generated random map when mods that add object with same name are used\n* Game will now display an error message instead of silent crash if game data directory is not accessible\n\n### Mechanics\n\n* Transport Artefact victory condition will no longer trigger if another player has completed it.\n* Fixed wandering monster combat not triggering when landing in its zone of control when flying from above the monster using the Fly spell.\n* Fixed potentially infinite movement loop when the hero has Admiral's Hat whirlpool immunity and the hero tries to enter and exit the same whirlpool.\n* If game picks gold for a random resource pile that has predetermined by map amount, its amount will be correctly multiplied by 100\n* Fixed hero not being able to learn spells from a mod in some cases, even if they are available from the town's mage guild.\n* The game will now actually take resources from seers' huts with the Gather Resources mission instead of awarding them.\n* Heroes with double spell points will no longer trigger the Mana Vortex.\n* If turn timer runs out during pve battle game will end player turn after a battle instead of forcing retreat\n\n### Interface\n\n* Fixed reversed button functions in Exchange Window\n* Fixed allied towns being missing from the list when using the advanced or expert Town Portal spell.\n* Fixed corrupted UI that could appear for a frame under certain conditions\n* The '*' symbol and non-printable characters can no longer be used in savegames due to Windows file system restrictions.\n* Pressing Ctrl while hovering over the adventure map will now display tile coordinates in the status bar.\n* Selection of another hero while hero is selected now requires Shift press instead of Ctrl\n* Fixed hero troops in the info box view flashing briefly during hero movement.\n* Reduced excessive memory usage on adventure map by several hundreds of megabytes (most noticeable on systems with large screen resolution)\n* Haptic feedback is now enabled by default on Android and on iOS\n* It is now possible to scroll through artifacts backpack using mouse wheel or swipe\n\n### Launcher\n\n* Android now uses the same Qt-based launcher as other systems\n* Fixed attempt to install a submod when installing new mod that depends on a submod of another mod\n* Fixed wrong order of activating mods in chain when installing multiple mods at once\n* Mod list no longer shows mod version column. Version is now only shown in the mod description.\n* Launcher will now skip the Heroes 3 data import step if data has been found automatically\n* Fixed import of existing data files on iOS. This option now requires iOS 13 or later\n* Fixed import using offline installer on iOS.\n* Buttons to open data directories in the Help tab are now hidden on mobile systems if they can't be opened with file browser\n* Added the configuration files directory to the Help tab as it is located separately on Linux systems\n* Removed H3 data language selection during setup in favor of auto-detection\n* Replaced checkboxes with toggle buttons for easier of access on touchscreens.\n* Icons and translations now embedded in executable file\n* Added interface for configuring several previously existing but inaccessible options in Launcher:\n  * Selection of input tolerance precision for all input types\n  * Relative cursor mode for mobile systems (was only available on Android)\n  * Haptic feedback toggle for mobile systems (was only available on Android)\n  * Sound and music volume (was only available in game)\n  * Selection of long touch interval (was only available in game)\n  * Selection of upscaling filter used by SDL\n  * Controller input sensitivity and acceleration.\n\n### AI\n\n* Fixed crash when Nullkiller AI tries to explore after losing the hero in combat.\n* Fixed rare crash when Nullkiller AI tries to use portals\n* Fixed potential crash when Nullkiller AI has access to Town Portal spell\n* Fixed potential crash when Battle AI selects a spell to cast from a hero with summon spells.\n* Several fixes to Nullkiller AI exploration logic\n* Fixed bug leading to Battle AI doing nothing if targeted unit is unreachable\n\n### Random Maps Generator\n\n* Fixed crash when player selects a random number of players and selects a different colour to play, resulting in a non-continuous list of players.\n* Fixed rare crash when generating maps with water\n\n### Map Editor\n\n* Fixed crash on closing map editor\n\n### Modding\n\n* Added new building type 'thievesGuild' which implements HotA building in Cove.\n* Creature terrain limiter now actually accepts terrain as parameter\n\n## 1.5.1 -> 1.5.2\n\n### Stability\n\n* Fixed crash on closing game while combat or map animations are playing\n* Fixed crash on closing game while network thread is waiting for dialog to be closed\n* Fixed random crash on starting random map with 'random' number of players\n* Fixed crash caused by thread races on loading map list\n* Failure to read data from network connection will show up as 'disconnection' and not as a crash\n* Fixed a possible crash when replaying a manually played battle with the 'unlimited battle replay' option set\n* Fixed crash when loading save made on a 64-bit system or connecting to multiplayer game with a 64-bit host on a 32-bit system (and vice versa)\n* Fixed crash when ending a battle in a draw when a hero has the Necromancy skill\n* Fixed crash when having SPELL_LIKE_ATTACK bonus with invalid spell ID\n* Fixed transfer of non-first artefacts in backpack if hero does not transfer as well\n* Game will now abort loading if a corrupt mod is detected instead of crashing without explanation later\n\n### Multiplayer\n\n* Contact between allied players will no longer break simturns\n* Having hero in range of object owned by another player will now be registered as contact\n* Multiplayer saves are now visible when starting a single player game\n* Added chat command '!vote' to initiate a vote to change the duration of simultaneous turns or to change turn timers\n* Added chat command '!help' to list all available chat commands\n* All multiplayer chat commands now use a leading exclamation mark\n\n### Campaigns\n\n* If the hero attacks an enemy player and is defeated, he will be correctly registered as defeated by the defending player.\n* Allow standard victory condition on 'To kill a hero' campaign mission in line with H3\n* Fixes Adrienne starting without Inferno spell in campaign\n\n### Interface\n\n* For artefacts that are part of a combined artefact, the game will now show which component of that artefact your hero has.\n* Fixed broken in 1.5.1 shortcut for artifact sets saving\n* Fixed full screen toggle (F4) not applying changes immediately\n* Retaliation preview now accounts for creatures that don't receive retaliations (Sprites, Archdevils, etc)\n* Fixed not visible retaliation preview if damage estimation string is longer than battle log line due to long creature name\n* Game will now select last save on loading screen\n* High Scores screen and Campaign Epilogue screen are now displayed with background on resolutions higher than 800x600\n* Fixed non-functioning shortcut 'P' to access Puzzle Map from adventure map\n* Added keyboard shortcuts to markets and altars. 'Space' to confirm deal and 'M' to trade maximum possible amount\n* Pressing 'Escape' in main menu will now trigger 'Back' and 'Quit' buttons\n* Added keyboard shortcuts to hero exchange window:\n  * 'F10' will now swap armies\n  * 'F11' will now swap artifacts. Additionally, 'Ctrl+F11' will swap equipped artifacts, and 'Shift+F11' will swap backpacks\n  * Added unassigned shortcuts to move armies or artifacts to left or right side\n* Added keyboard shortcuts to access buildings from town interface:\n  * 'F' will now open Fort window\n  * 'B' will now open Town Hall window\n  * 'G' will now open Mage Guild window\n  * 'M' will now open Marketplace\n  * 'R' will now open recruitment interface\n  * 'T' will now open Tavern window\n  * 'G' will now open Thieves Guild\n  * 'E' will now open hero exchange screen, if both heroes are present in town\n  * 'H' will now open hero screen. Additionally, 'Shift+H' will open garrisoned hero screen, and 'Ctrl+H' will open visiting hero screen\n  * 'Space' will now swap visiting and garrisoned heroes\n* Added keyboard shortcuts to switch between tabs in Scenario Selection window:\n  * 'E' will open Extra Options tab\n  * 'T' will open Turn Options tab\n  * 'I' will open Invite Players window (only for lobby games)\n  * 'R' will now replay video in campaigns\n* Added keyboard shortcuts to Adventure map:\n  * 'Ctrl+L' will now prompt to open Load Game screen\n  * 'Ctrl+M' will now prompt to go to main menu\n  * 'Ctrl+N' will now prompt to go to New Game screen\n  * 'Ctrl+Q' will now prompt to quit game\n  * Page Up, Page Down, Home and End keys will now move hero on adventure map similar to numpad equivalents\n  * Fixed non-functioning shortcuts '+' and '-' on numpad to zoom adventure map\n* Added keyboard shortcuts to Battle interface:\n  * 'V' now allows to view information of hovered unit\n  * 'I' now allows to view information of active unit\n\n### Mechanics\n\n* Game will no longer pick creatures exclusive to AB campaigns for random creatures or for Refugee Camp, in line with H3\n* If original movement rules are on, it is not possible to attack guards from visitable object directly, only from free tile\n* Fixed bug leading that allowed picking up objects while flying on top of water\n* Hero can now land when flying from guarded tile to accessible guarded tile irregardless of original movement rules switch\n* Interface will now use same arrow for U-turns in path as H3\n\n### AI\n\n* Nullkiller AI can now explore the map\n* Nullkiller AI will no longer use the map reveal cheat when allied with a human or when playing on low difficulty\n* Nullkiller AI is now used by default for allied players\n\n### Launcher\n\n* When extracting data from gog.com offline installer game will extract files directly into used data directory instead of temporary directory\n\n### Map Editor\n\n* Fixed victory / loss conditions widget initialization\n\n### Modding\n\n* Hero specialties with multiple bonuses that have TIMES_HERO_LEVEL updater now work as expected\n* Spells that apply multiple bonuses with same type and subtype but different value type now work as expected\n* Added option to toggle layout of guards in creature banks\n\n## 1.5.0 -> 1.5.1\n\n### Stability\n\n* Fixed possible crash on accessing faction description\n* Fixed possible thread race on exit to main menu\n* Game will now show error message instead of silent crash on corrupted H3 data\n* Fixed possible crash on double-deletion of quest artifacts placed by RMG\n* Fixed crash on loading save made in version 1.4 with removed from map Quest Guards\n* Added workaround for crash on accessing Altar of Sacrifice on saves made in 1.4\n* Fixed possible crash on map restart request\n* Fixed crash on attempt to open scenario list with no save or map selected\n* Fixed crash on host resolving error when connecting to online lobby\n* If json file specified in mod.json is missing, vcmi will now only log an error instead of crashing\n\n### Interface\n\n* Added retaliation damage and kills preview when hovering over units that can be attacked in melee during combat\n* Clicking on combat log would now open a window with full combat log history\n* Removed message length limit in text input fields, such as global lobby chat\n* Tapping on already active text input field will display on-screen keyboard on systems with one\n* Fixed possible freeze when trying to move hero if hero has non-zero movement points but not enough to reach first tile in path\n* Fixed selection of the wrong reward in dialogs such as the level-up window when double-clicking on it\n* Fixed launch of wrong map or save when double-clicking in scenario list screen\n* Right-clicking on a hero in a tavern will now select that hero as well, in line with H3\n* Fixed slow map list parsing when hota map format is enabled\n* MacOS and iOS can now use either Ctrl or Cmd key for all keyboard shortcuts\n* Small windows no longer dim the entire screen by default\n\n### Mechanics\n\n* Recruiting a hero will now immediately reveal the fog of war around him\n* When both a visiting hero and a garrisoned hero are in town, the garrisoned hero will visit town buildings first.\n\n### Multiplayer\n\n* Fixed in-game chat text not being visible after switching from achannel with a long history\n* Fixed lag when switching to channel with long history\n* Game now automatically scrolls in-game chat on new messages\n* Game will now only plays chat sound for active channel and for private channels\n* Cheats are now disabled by default in multiplayer\n* Game will now show status of cheats and battle replays on map start\n* It is possible to change cheats or battle replay on game loading\n* It is now possible to join rooms hosted by different hotfix versions, e.g. 1.5.1 can join 1.5.0 games\n* Fixed game rooms remaining visible in the lobby even after they have been closed\n* Fixed possible lag when there is a player in lobby with a very slow (or dying) connection\n* Game will show correctly if player has been invited into a room\n* Fixed overflow in invite window when there are more than 8 players in the lobby\n\n### Random Maps Generator\n\n* Generator will now prefer to place roads away from zone borders\n\n### AI\n\n* Fixed possible crash when Nullkiller AI tries to upgrade army\n* Nullkiller AI will now recruit new heroes if he left with 0 heroes\n* AI in combat now knows when an enemy unit has used all of its retaliations.\n\n### Map Editor\n\n* Fixed setting up hero types of heroes in Prisons placed in map editor\n* Fixed crash on setting up Seer Hut in map editor\n* Added text auto-completion hints for army widget\n* Editor will now automatically add .vmap extensions when saving map\n* Fixed text size in map validation window\n\n## 1.4.5 -> 1.5.0\n\n### General\n\n* Added Portuguese (Brazilian) translation\n* Added basic support for game controllers\n* Added option to disable cheats in game\n* Game will no longer run vcmiserver as a separate process on desktop systems\n* Game will no longer show server error messages in game chat in release builds\n* Implemented switchable artifact sets from HD Mod\n\n### Stability\n\n* Fixed possible crash in Altar of Sacrifice\n* Fixed possible crash on activation of 'Enchanted' bonus\n* Fixed possible race condition on random maps generation on placement treasures near border with water zone\n* Fixed crash on missing video files\n* Fixed crash on using healing spell as 'casts before/after attack' bonus\n* Fixed crash on defeating hero that was located in boat on game start\n* Fixed possible crash on turn timer running out while player has town screen open\n* Fixed crash when player has manual control of arrow towers during siege\n* Fixed crash on attempt to attack with Magma Elementals with Erdamon as hero\n* Fixed crash on attempt to access removed Quest Guard\n* Fixed crash on moving through whirlpool when hero has no troops other than commander\n* Fixed possible freeze when moving hero over events that give enough experience to cause a level-up\n* Fixed possible crash on movement of double-wide creatures next to gates during siege\n* Fixed possible hanging app on attempt to close game during loading\n\n### Multiplayer\n\n* Game map will no longer be locked during turn of other human players, allowing to change hero paths or inspect towns or heroes\n* Game will now correctly block most of player actions outside of their turn\n* Implemented new lobby, available in game with persistent accounts and chat\n* Removed old lobby previously available in launcher\n* Fixed potential crash that could occur if two players act at the very same time\n* Game will no longer pause due to network lag after every tile when instant movement speed is selected in multiplayer\n* Game will now show \"X player's turn\" dialog on new turn in online multiplayer\n* Fixed loading of turn timers state from saved games\n* Simultaneous turns will now break when players are 1 turn away from each other instead of 2 turns\n* Implemented rolling and banning of towns before game start\n\n### Interface\n\n* Implemented configurable keyboard shortcuts, editable in file config/shortcutsConfig.json\n* Fixed broken keyboard shortcuts in main menu\n* If UI Enhancements are enabled, the game will skip confirmation dialogs when entering owned dwellings or refugee camp.\n* It is now possible to move artifact to or from backpack using Alt+click\n* It is now possible to transfer artifact to another hero during exchange using Ctrl+click\n* It is no longer possible to start single scenario by pressing \"Enter\", in line with H3 and to prevent interference with game chat\n* Empty treasure banks will no longer ask for confirmation when entering\n* Game will now save last used difficulty settings\n* Opening random map tab or scenario selection tab in pregame will no longer reset starting towns or heroes unless different map was selected\n* Town Portal dialog will now show town icons\n* Town Portal dialog will now show town info on right click\n* Town Portal dialog will center on town on clicking it\n* Town Portal dialog now uses same town ordering as in adventure map interface\n* Game will now remember scrolling position of hero backpack\n* Heroes can now be recruited from the tavern by double-clicking on them\n* Added status bar to the backpack window\n* Quick backpack window is now only available when enabled Interface enhancements\n* Fixed assembly of artifacts in the backpack when backpack is full\n* Attempt to use enemy turn replay feature will now show \"Not implemented\" message\n* It is now possible to configure size of small battle queue in config file\n* Opening hero window in town will now open exchange dialog if there are two heroes in town, allowing artifact exchange\n* Fixed positioning of FPS counter after resolution change\n* It is now possible to access extra options window from campaigns startup dialog\n* Size of message boxes should now match H3 better. Maximum-size message box will always be smaller than screen size\n* If monsters are willing to join for money, game will now show gold icon in this dialog box\n* Fixed visual duplication of artifacts on Altar of Sacrifice\n* Fixed translation of some bonuses using incorrect language\n* Added option to use 'nearest' rounding mode for UI scaling\n* Fixed various minor bugs in trade window interface\n* Removed animation of spawning of every single new monster on new month\n* Game will now correctly reset artifact drag-and-drop cursor if player opens another dialog on top of hero window\n* If player has no valid saves, game will pick \"NEWGAME\" as proposed save name instead of empty field\n* Fixed incorrect visitation sounds of Crypt, Shipwreck and Abandoned Ship\n* Fixed double sound playback on capturing mines\n* Recruitment costs that consist from 3 different resources should now fit recruitment window UI better\n\n### Campaigns\n\n* Game will now correctly track who defeated the hero or wandering monsters for related quests and victory conditions\n* Birth of a Barbarian: Yog will now start the third scenario with Angelic Alliance in his inventory\n* Birth of a Barbarian: Heroes with Angelic Alliance components are now considered to be mission-critical and can't be dismissed or lost in combat\n* Birth of a Barbarian: Yog can no longer purchase spellbook from the Mage Guild\n* Birth of a Barbarian: Yog will no longer gain Spellpower or Knowledge when leveling up\n* Birth of a Barbarian: Scenarios with mission to deliver an artifact will no longer end after just defeating enemies\n* Dungeons and Devils: AI will no longer take troops from garrisons in \"Fall of Steadwick\" scenario, in line with H3\n* Gem will now have her class set to \"Sorceress\" in campaigns\n* Fixed missing names for heroes who have their names customized in map after being transferred to the next scenario\n* Artifact transfer will now work correctly if the hero holding the transferable artifact is not also transferring\n* Fixed crash on opening of some campaigns in the French version from gog.com\n* Fixed crash on advancing to campaign mission in which you can pick hero as starting bonus\n* It is now possible to replay the intro movie from the scenario information window\n* When playing the intro video, the subtitles are now correctly synchronized with the audio\n* Fixed invalid string on right-clicking secondary skill starting bonus\n\n### Battles\n\n* Added option to enable unlimited combat replays during game setup\n* Added option to instantly end battle using quick combat (shortcut: 'e')\n* Added option to replace auto-combat button action with instant end using quick combat\n* Battles against AI players can now be done using quick combat\n* Disabling battle queue will now correctly reposition hero statistics preview popup\n* Fixed positioning of unit stack size label\n\n### Mechanics\n\n* It is no longer possible to learn spells from Pandora or events if hero can not learn them\n* Fixed behavior of 'Dimension Door' spell to be in line with H3:SoD\n* Fixed behavior of 'Fly' spell to be in line with H3:SoD\n* If it is not possible to cast 'Dimension Door', game will show message immediately on picking spell in spellbook\n* Added options to configure 'Dimension Door' spell to be in line with HotA\n* Casting 'Town Portal' while in boat will now show correct message box instead of server error\n* Game will now take mana before visiting town after casting 'Town Portal', allowing Mana Vortex to correctly replenish all mana points\n* Fixed loading of negative luck and morale in events, pandoras and quests on h3m maps\n* Fixed incorrect 'duplicate hero' error on loading of some vmap maps\n* Fixed previously broken digging of the Grail\n* Successful digging for Grail will now show correct message\n* Game will now correctly update movement range after rearranging armies\n* It is no longer possible for two towns with random names to have same name, just like in H3\n* Creatures that were consumed by Demon Summon ability will no longer return to life after the battle\n* Effects of melee-only or ranged-only spells, such as Bloodlust or Precision are no longer cumulative\n* It is no longer possible to use summoning spells if such spell would summon 0 creatures\n* It is now possible to assemble or disassemble artifacts while in Altar of Sacrifice\n* It is no longer possible to move war machines to Altar of Sacrifice\n* If HotA mod is enabled, game will no longer incorrectly replace all prisons on map with HotA version\n* Fixed regression leading to large elemental dwellings being used as replacements for random dwellings\n\n### Random Maps Generator\n\n* Game will now save last used RMG settings in game and in editor\n* Reduced number of obstacles placed in water zones\n* Treasure values in water zone should now be similar to values from HotA, due to bugs in H3:SoD values\n* Random map templates can now have optional description visible in random map setup\n* Implemented biomes system, for more consistent and natural obstacles placement\n* Implemented Penrose tiling to produce more natural zone edges\n* Increased minimal density of obstacles on surface level of the map\n* Decreased minimal density of obstacles on undergound level of the map\n* Density of objects should now closely resemble H3 RMG\n* Generator will now avoid routing road under guarded objects whenever possible\n* Generator will now avoid placing guards near roads\n* Generator will not place a guard near the road if it's stronger than 1/3 of max guard strength for this zone\n* Interactive objects will now appear on top of static objects\n* Windmill will now appear on top of all other objects\n\n### Launcher\n\n* Launcher now supports installation of Heroes 3 data using gog.com offline installer thanks to innoextract tool\n* Fixed loading of mod screenshots if player opens screenshots tab without any preloaded screenshots\n* Fixed installation of mods if it has non-installed submod as dependency\n* It is now possible to import game settings using drag-and-drop\n* Added button to import mods, maps, or settings in addition to drag-and-drop\n* Added Spanish translation to launcher\n* Added Portuguese translation to launcher\n\n### Map Editor\n\n* Added Chinese translation to map editor\n* Added Portuguese translation to map editor\n* Mod list in settings will now correctly show submods of submods\n* Fixed display of resource type and quantity in mines\n* Fixed inability to change object owner in editor\n* Added map sizes larger than XL in map editor\n* It is now possible to customize hero spells\n\n### AI\n\n* Fixed possible crash on updating NKAI pathfinding data\n* Fixed possible crash if hero has only commander left without army\n* Fixed possible crash on attempt to build tavern in a town\n* Fixed counting mana usage cost of Fly spell\n* Added estimation of value of Pyramid and Cyclops Stockpile\n* Reduced memory usage and improved performance of AI pathfinding\n* Added experimental and disabled by default implementation of object graph\n* It is now possible to configure AI settings via config file\n* Improved parallelization when AI has multiple heroes\n* AI-controlled creatures will now correctly move across wide moat in Fortress\n* Fixed system error messages caused by visitation of Trading Posts by VCAI\n* Patrolling heroes will never retreat from the battle\n* AI will now consider strength of town garrison and not just strength of visiting hero when deciding to attack town\n\n### Modding\n\n* Added new game setting that allows inviting heroes to taverns\n* It is now possible to add creature or faction description accessible via right-click of the icon\n* Fixed reversed Overlord and Warlock classes mapping\n* Added 'selectAll' mode for configurable objects which grants all potential rewards\n* It is now possible to use most of json5 format in vcmi json files\n* Main mod.json file (including any submods) now requires strict json, without comments or extra commas\n* Replaced bonus MANA_PER_KNOWLEDGE with MANA_PER_KNOWLEDGE_PERCENTAGE to avoid rounding error with mysticism\n* Factions can now be marked as 'special', banning them from random selection\n* Replaced 'convert txt' text export command with more convenient 'translate' and 'translate maps' commands\n* Game will now report cases where minimal damage of a creature is greater than maximal damage\n* Added bonuses RESOURCES_CONSTANT_BOOST and RESOURCES_TOWN_MULTIPLYING_BOOST\n\n## 1.4.4 -> 1.4.5\n\n### Stability\n\n* Fixed crash on creature spellcasting\n* Fixed crash on unit entering magical obstacles such as quicksands\n* Fixed freeze on map loading on some systems\n* Fixed crash on attempt to start campaign with unsupported map\n* Fixed crash on opening creature information window with invalid SPELL_IMMUNITY bonus\n\n### Random Maps Generator\n\n* Fixed placement of guards sometimes resulting into open connection into third zone\n* Fixed rare crash on multithreaded access during placement of artifacts or wandering monsters\n\n### Map Editor\n\n* Fixed inspector using wrong editor for some values\n\n### AI\n\n* Fixed bug leading to AI not attacking wandering monsters in some cases\n* Fixed crash on using StupidAI for autocombat or for enemy players\n\n## 1.4.3 -> 1.4.4\n\n### General\n\n* Fixed crash on generation of random maps\n\n## 1.4.2 -> 1.4.3\n\n### General\n\n* Fixed the synchronisation of the audio and video of the opening movies.\n* Fixed a bug that caused spells from mods to not show up in the Mage's Guild.\n* Changed the default SDL driver on Windows from opengl to autodetection\n* When a hero visits a town with a garrisoned hero, they will now automatically exchange spells if one of them has the Scholar skill.\n* Movement and mana points are now replenished for new heroes in taverns.\n\n### Multiplayer\n\n* Simturn contact detection will now correctly check for hero moving range\n* Simturn contact detection will now ignore wandering monsters\n* Right-clicking the Simturns AI option now displays a tooltip\n* Interaction attempts with other players during simturns will now have more concise error messages\n* Turn timers are now limited to 24 hours in order to prevent bugs caused by an integer overflow.\n* Fixed delays when editing turn timer duration\n* Ending a turn during simturns will now block the interface correctly.\n\n### Campaigns\n\n* Player will no longer start the United Front of Song for the Father campaign with two Nimbuses.\n* Fixed missing campaign description after loading saved game\n* Campaign completion checkmarks will now be displayed after the entire campaign has been completed, rather than just after the first scenario.\n* Fixed positioning of prologue and epilogue text during campaign scenario intros\n\n### Interface\n\n* Added an option to hide adventure map window when town or battle window are open\n* Fixed switching between pages on small version of spellbook\n* Saves with long filenames are now truncated in the UI to prevent overflow.\n* Added option to sort saved games by change date\n* Game now shows correct resource when selecting start bonus\n* It is now possible to inspect commander skills during battles.\n* Fixed incorrect cursor being displayed when hovering over navigable water tiles\n* Fixed incorrect cursor display when hovering over water objects accessible from shore\n\n### Stability\n\n* Fixed a crash when using the 'vcmiobelisk' cheat more than once.\n* Fixed crash when reaching level 201. The maximum level is now limited to 197.\n* Fixed crash when accessing a spell with an invalid SPELLCASTER bonus\n* Fixed crash when trying to play music for an inaccessible tile\n* Fixed memory corruption on loading of old mods with illegal 'index' field\n* Fixed possible crash on server shutdown on Android\n* Fixed possible crash when the affinity of the hero class is set to an invalid value\n* Fixed crash on invalid creature in hero army due to outdated or broken mods\n* Failure to initialise video subsystem now displays error message instead of silent crash\n\n### Random Maps Generator\n\n* Fixed possible creation of a duplicate hero in a random map when the player has chosen the starting hero.\n* Fixed banning of quest artifacts on random maps\n* Fixed banning of heroes in prison on random maps\n\n### Battles\n\n* Battle turn queue now displays current turn\n* Added option to show unit statistics sidebar in battle\n* Right-clicking on a unit in the battle turn queue now displays the unit details popup.\n* Fixed error messages for SUMMON_GUARDIANS and TRANSMUTATION bonuses\n* Fixed Dendroid Bind ability\n* Black Dragons no longer hate Giants, only Titans\n* Spellcasting units such as Archangels can no longer cast spells on themselves.\n* Coronius specialty will now correctly select affected units\n\n### Launcher\n\n* Welcome screen will automatically detect existing Heroes 3 installation on Windows\n* It is now possible to install mods by dragging and dropping onto the launcher.\n* It is now possible to install maps and campaigns by dragging and dropping onto the launcher.\n* Czech launcher translation added\n* Added option to select preferred SDL driver in launcher\n\n### Map Editor\n\n* Fixed saving of allowed abilities, spells, artifacts or heroes\n\n### AI\n\n* AI will no longer attempt to move immobilized units, such as those under the effect of Dendroid Bind.\n* Fixed shooters not shooting when they have a range penalty\n* Fixed Fire Elemental spell casting\n* Fixed rare bug where unit would sometimes do nothing in battle\n\n### Modding\n\n* Added better reporting of \"invalid identifiers\" errors with suggestions on how to fix them\n* Added FEROCITY bonus (HotA Aysiud)\n* Added ENEMY_ATTACK_REDUCTION bonus (HotA Nix)\n* Added REVENGE bonus (HotA Haspid)\n* Extended DEATH_STARE bonus to support Pirates ability (HotA)\n* DEATH_STARE now supports spell ID in addInfo field to override used spell\n* SPELL_BEFORE_ATTACK bonus now supports spell priorities\n* FIRST_STRIKE bonus supports subtypes damageTypeMelee, damageTypeRanged and damageTypeAll\n* BLOCKS_RETALIATION now also blocks FIRST_STRIKE bonus\n* Added 'canCastOnSelf' field for spells to allow creatures to cast spells on themselves.\n\n## 1.4.1 -> 1.4.2\n\n### General\n\n* Restored support for Windows 7\n* Restored support for 32-bit builds\n* Implemented quick backpack window for slot-specific artifact selection, activated via mouse wheel / swipe gesture\n* Added option to search for specific spell in the spellbook\n* Added option to skip fading animation on adventure map\n* Using alt-tab to switch to another application will no longer activate in-game console/chat\n* Increased frequency of checks for server startup to improve server connection time\n* added nwcfollowthewhiterabbit / vcmiluck cheat: the currently selected hero permanently gains maximum luck.\n* added nwcmorpheus / vcmimorale cheat: the currently selected hero permanently gains maximum morale.\n* added nwcoracle / vcmiobelisk cheat: the puzzle map is permanently revealed.\n* added nwctheone / vcmigod cheat: reveals the whole map, gives 5 archangels in each empty slot, unlimited movement points and permanent flight to currently selected hero\n\n### Launcher\n\n* Launcher will now properly show mod installation progress\n* Launcher will now correctly select preferred language on first start\n\n### Multiplayer\n\n* Timers for all players will now be visible at once\n* Turn options menu will correctly open for guests when host switches to it\n* Guests will correctly see which roads are allowed for random maps by host\n* Game will now correctly deactivate unit when timer runs out in pvp battle\n* Game will show turn, battle and unit timers separately during battles\n* Timer in pvp battles will be only active if unit timer is non-zero\n* Timer during adventure map turn will be active only if turn timer is non-zero\n* Game will now send notifications to players when simultaneous turns end\n\n### Stability\n\n* Fixed crash on clicking town or hero list on MacOS and iOS\n* Fixed crash on closing vcmi on Android\n* Fixed crash on disconnection from multiplayer game\n* Fixed crash on finishing game on last day of the month\n* Fixed crash on loading h3m maps with mods that alter Witch Hut, Shrine or Scholar\n* Fixed crash on opening creature morale detalisation in some localizations\n* Fixed possible crash on starting a battle when opening sound from previous battle is still playing\n* Fixed crash on map loading in case if there is no suitable option for a random dwelling\n* Fixed crash on usage of radial wheel to reorder towns or heroes\n* Fixed possible crash on random map generation\n* Fixed crash on attempting to transfer last creature when stack experience is enabled\n* Fixed crash on accessing invalid settings options\n* Fixed server crash on receiving invalid message from player\n* Added check for presence of Armageddon Blade campaign files to avoid crash on some Heroes 3 versions\n\n### Random Maps Generator\n\n* Improved performance of random maps generation\n* Rebalance of treasure values and density\n* Improve junction zones generation by spacing Monoliths\n* Reduced amount of terrain decorations to level more in line with H3\n* Generator will now avoid path routing near map border\n* Generator will now check full object area for minimum distance requirement\n* Fixed routing of roads behind Subterranean Gates, Monoliths and Mines\n* Fixed remaining issues with placement of Corpse\n* Fixed placement of one-tile prisons from HotA\n* Fixed spawning of Armageddon's Blade and Vial of Dragon Blood on random maps\n\n### Interface\n\n* Right-clicking hero icon during levelup dialog will now show hero status window\n* Added indicator of current turn to unit turn order panel in battles\n* Reduces upscaling artifacts on large spellbook\n* Game will now display correct date of saved games on Android\n* Fixed black screen appearing during spellbook page flip animation\n* Fixed description of \"Start map with hero\" bonus in campaigns\n* Fixed invisible chat text input in game lobby\n* Fixed positioning of chat history in game lobby\n* \"Infobar Creature Management\" option is now enabled by default\n* \"Large Spellbook\" option is now enabled by default\n\n### Mechanics\n\n* Anti-magic garrison now actually blocks spell casting\n* Berserk spell will no longer cancel if affected unit performs counterattack\n* Frenzy spell can no longer be casted on units that should be immune to it\n* Master Genie will no longer attempt to cast beneficial spell on creatures immune to it\n* Vitality and damage skills of a commander will now correctly grow with level\n\n### Modding\n\n* Added UNTIL_OWN_ATTACK duration type for bonuses\n* Configurable objects with visit mode \"first\" and \"random\" now respect \"canRefuse\" flag\n\n## 1.4.0 -> 1.4.1\n\n### General\n\n* Fixed position for interaction with starting heroes\n* Fixed smooth map scrolling when running at high framerate\n* Fixed calculation of Fire Shield damage when caster has artifacts that increase its damage\n* Fixed untranslated message when visiting signs with random text\n* Fixed slider scrolling to maximum value when clicking on \"scroll right\" button\n* Fixed events and seer huts not activating in some cases\n* Fixed bug leading to Artifact Merchant selling Grails in loaded saved games\n* Fixed placement of objects in random maps near the top border of the map\n* Creatures under Slayer spell will no longer deal additional damage to creatures not affected by Slayer\n* Description of a mod in Launcher will no longer be converted to lower-case\n* Game will no longer fail to generate random map when AI-only players option is set to non-zero value\n* Added option to mute audio when VCMI window is not active\n* Added option to disable smooth map scrolling\n* Reverted ban on U-turns in pathfinder\n\n### Stability\n\n* Fixed crash on using mods made for VCMI 1.3\n* Fixed crash on generating random map with large number of monoliths\n* Fixed crash on losing mission-critical hero in battle\n* Fixed crash on generating growth detalization in some localizations\n* Fixed crash on loading of some user-made maps\n\n## 1.3.2 -> 1.4.0\n\n### General\n\n* Implemented High Score screen\n* Implemented tracking of completed campaigns\n* \"Secret\" Heroes 3 campaigns now require completion of prerequisite campaigns first\n* Completing a campaign will now return player to campaign selection window instead of main menu\n* Game will now play video on winning or losing a game\n* Game will now correctly check for mod compatibility when loading saved games\n* Game client will no longer load conflicting mods if player have both of them enabled\n* If some mods fail to load due to missing dependencies or conflicts, game client will display message on opening main menu\n* Game will no longer crash on loading save with different mod versions and will show error message instead\n* Saved games are now 2-3 times smaller than before\n* Added Vietnamese translation\n* Failure to connect to a MP game will now show proper error message\n* Added VSync support\n* Implemented tutorial\n* Implemented support for playback of audio from video files\n* Windows Installer will now automatically add required firewall rules\n* Game audio will now be disabled if game window is not focused\n* Fixed formatting of date and time of a savegame on Android\n* Added list of VCMI authors to credits screen\n* Quick combat is now disabled by default\n* Spectator mode in single player is now disabled\n\n### Multiplayer\n\n* Implemented simultaneous turns\n* Implemented turn timers, including chess timers version\n* Game will now hide entire adventure map on hotseat turn transfer\n* Added option to pause game timer while on system options window\n* Implemented localization support for maps\n* Game will now use texts from local player instead of host\n* Multiple fixes to validation of player requests by server\n\n### Android\n\n* Heroes 3 data import now accepts files in any case\n* Fixed detection of Heroes 3 data presence when 'data' directory uses lower case\n\n### Touchscreen\n\n* Added tutorial video clips that explain supported touch gestures\n* Double tap will now be correctly interpreted as double click, e.g. to start scenario via double-click\n* Implemented snapping to 100% scale for adventure map zooming\n* Implemented smooth scrolling for adventure map\n* Implemented radial wheel to reorder list of owned towns and heroes\n* Implemented radial wheel for hero exchange in towns\n\n### Launcher\n\n* When a mod is being downloaded, the launcher will now correctly show progress as well as its total size\n* Double-clicking mod name will now perform expected action, e.g. install/update/enable or disable\n* Launcher will now show mod extraction progress instead of freezing\n* \"Friendly AI\" option will now correctly display current type of friendly AI\n* Player can now correctly switch to global chat after disconnect\n* \"Resolve mods conflicts\" button now attempts to fix all mods if nothing is selected\n* Implemented support for mention in game lobby\n* Implemented support for global and room channels in game lobby\n* Added option to reconnect to game lobby\n\n### Editor\n\n* It is now possible to configure rewards for Seer Hut, Pandora Boxes and Events\n* It is now possible to configure quest (limiter) in Seer Hut and Quest Guards\n* It is now possible to configure events and rumors in map editor\n* Improved army configuration interface\n* Added option to customize hero skills\n* It is now possible to select object on map for win/loss conditions or for main town\n* Random dwellings can now be linked to a random town\n* Added map editor zoom\n* Added objects lock functionality\n* It is now possible to configure hero placeholders in map editor\n* Fixed duplicate artifact image on mouse drag\n* Lasso tool will no longer skip tiles\n* Fixed layout of roads and rivers\n\n### Stability\n\n* Fix possible crash on generating random map\n* Fixed multiple memory leaks in game client\n* Fixed crash on casting Hypnotize multiple times\n* Fixed crash on attempting to move all artifacts from hero that has no artifacts\n* Fixed crash on attempting to load corrupted .def file\n* Fixed crash on clicking on empty Altar of Sacrifice slots\n\n### AI\n\n* BattleAI should now see strong stacks even if blocked by weak stacks.\n* BattleAI will now prefers targets slower than own stack even if they are not reachable this turn.\n* Improved BattleAI performance when selecting spell to cast\n* Improved BattleAI performance when selection unit action\n* Improved BattleAI spell selection logic\n* Nullkiller AI can now use Fly and Water Walk spells\n\n### Campaigns\n\n* Implemented voice-over audio support for Heroes 3 campaigns\n* Fixes victory condition on 1st scenario of \"Long Live the King\" campaign\n* Fixed loading of defeat/victory icon and message for some campaign scenarios\n\n### Interface\n\n* Implemented adventure map dimming on opening windows\n* Clicking town hall icon on town screen will now open town hall\n* Clicking buildings in town hall will now show which resources are missing (if any)\n* Fixed incorrect positioning of total experience text on Altar of Sacrifice\n* Game will now show correct video file on battle end\n* Game will now correctly loop battle end animation video\n* Implemented larger version of spellbooks that displays up to 24 spells at once\n* Spell scrolls in hero inventory now show icon of contained spell\n* Fixed incorrect hero morale tooltip after visiting adventure map objects\n* Fixed incorrect information for skills in hero exchange window\n* Confirmation button will now be disabled on automatic server connect dialog\n* Attempting to recruit creature in town with no free slots in garrisons will now correctly show error message\n\n### Main Menu\n\n* Implemented window for quick selection of starting hero, town and bonus\n* Implemented map preview in scenario selection and game load screen accessible via right click on map\n* Show exact map size in map selection\n* Added support for folders in scenario selection and save/load screens\n* Added support for \"Show Random Maps\" button in random map setup screen\n* Added starting hero preview screen\n* Added option to change name of player while in map setup screen\n* Implemented loading screen with progress bar\n* Game will now stay on loading screen while random map generation is in process\n* Team Alignments popup in scenario options will no longer show empty teams\n* Fixed missing borders on team alignments configuration window in random maps\n* Fixed map difficulty icon on save/load screen\n* Main menu animation will no longer appear on top of new game / load game text\n\n### Adventure Map Interface\n\n* Picking up an artifact on adventure map will now show artifact assembly dialog if such option exists\n* Minimap will now preserve correct aspect ratio on rectangular maps\n* Fixed slot highlighting when an artifact is being assembled\n* Ctrl-click on hero will now select him instead of changing path of active hero\n* In selection windows (level up window, treasure chest pickup, etc) it is now possible to select reward via double-click\n* Attacking wandering monsters with preconfigured message will now correctly show the message\n* Revisit object button will now be blocked if there is no object to revisit\n* Fixed missing tooltip for \"revisit object\" button\n* Fixed calculation of fow reveal range for all objects\n* Attempt to close game will now ask for confirmation\n* Right-clicking previously visited Seer Huts or Quest Guards will show icon with preview of quest goal\n* Right-clicking owned dwellings will show amount of creatures available to for recruitment\n* Right-clicking previously visited creature banks will show exact guards composition with their portraits\n* Right-clicking artifacts on map will show artifact description\n* Right-clicking objects that give bonus to hero will show object description\n\n### Mechanics\n\n* Heroes in tavern will correctly lose effects from spells or visited objects on new day\n* Fixed multiple bugs in offering of Wisdom and Spell Schools on levelup. Mechanic should now work identically to Heroes 3\n* Retreated heroes will no longer restore their entire mana pool on new day\n* Fixed Grail in Crypt on some custom maps\n* Added support for repeatable quests in Seer Huts\n* Using \"Sacrifice All\" on Altar will now correctly place all creatures but one on altar\n* Fixed probabilities of luck and morale\n* Blinded stack no longer can get morale\n* Creature that attacks while standing in moat will now correctly receive moat damage\n* Player resources are now limited to 1 000 000 000 to prevent overflow\n* It is no longer possible to escape from town without fort\n* Pathfinder will no longer make U-turns when moving onto visitable objects while flying\n* Pathfinder will no longer make paths that go over teleporters without actually using them\n* Game will now correctly update guard status of tiles that are guarded by multiple wandering monsters\n* Moving onto Garrisons and Border Guards entrance tiles that are guarded by wandering monsters will now correctly trigger battle\n* It is no longer possible to build second boat in shipyard when shipyard should be blocked by boat with hero\n* Gundula is now Offense specialist and not Sorcery, as in H3\n\n### Random Maps Generator\n\n* Increased tolerance for placement of Subterranean Gates\n* Game will now select random object template out of available options instead of picking first one\n* It is no longer possible to create map with a single team\n* Game will no longer route roads through non-removable treasure objects, such as Corpse\n* Fixed placement of treasure piles with non-removable objects, such as Corpse\n* Fixed interface no displaying correct random map settings in some cases\n* Fixed misleading error \"no info for player X found\"\n* Fixed bug leading to AI players defeated on day one.\n\n### Modding\n\n* All bonuses now require string as a subtype. See documentation for exact list of possible strings for each bonus.\n* Changes to existing objects parameters in mods will now be applied to ongoing saves\n* Fixed handling of engine version compatibility check\n* Added support for giving arbitrary bonuses to AI players\n* Most mods of type \"Translation\" are now hidden in Launcher\n* Added new mod type: \"Compatibility\". Mods of this type are hidden in Launcher and are always active if they are compatible.\n* Added new mod type: \"Maps\"\n* Added new TERRAIN_NATIVE bonus that makes any terrain native to affected units\n* SPELL_DURATION now allows subtypes. If set to spell, bonus will only affect specified spell\n* Both game client and launcher will now correctly handle dependencies that are not in lower case\n* Implemented support for refusable Witch Hut and Scholar\n* Added \"variables\" to configurable objects that are shared between all rewards\n* Added visit mode \"limiter\" for configurable objects. Hero will be considered as \"visited this object\" if he fulfills provided condition\n* Added option to customize text displayed for visited objects, e.g. show \"Already learned\" instead of \"Visited\"\n* Added option to define custom description of configurable object, accessible via right-click\n* Added option to show object content icons on right-click\n* Object now allows checking whether hero can learn spell\n* Object limiter now allows checking whether hero can learn skill\n* Object reward may now reveal terrain around visiting hero (e.g. Redwood Observatory)\n\n## 1.3.1 -> 1.3.2\n\n### GENERAL\n\n* VCMI now uses new application icon\n* Added initial version of Czech translation\n* Game will now use tile hero is moving from for movement cost calculations, in line with H3\n* Added option to open hero backpack window in hero screen\n* Added detection of misclicks for touch inputs to make hitting small UI elements easier\n* Hero commander will now gain option to learn perks on reaching master level in corresponding abilities\n* It is no longer possible to stop movement while moving over water with Water Walk\n* Game will now automatically update hero path if it was blocked by another hero\n* Added \"vcmiartifacts angelWings\" form to \"give artifacts\" cheat\n\n### STABILITY\n\n* Fixed freeze in Launcher on repository checkout and on mod install\n* Fixed crash on loading VCMI map with placed Abandoned Mine\n* Fixed crash on loading VCMI map with neutral towns\n* Fixed crash on attempting to visit unknown object, such as Market of Time\n* Fixed crash on attempting to teleport unit that is immune to a spell\n* Fixed crash on switching fullscreen mode during AI turn\n\n### CAMPAIGNS\n\n* Fixed reorderging of hero primary skills after moving to next scenario in campaigns\n\n### BATTLES\n\n* Conquering a town will now correctly award additional 500 experience points\n* Quick combat is now enabled by default\n* Fixed invisible creatures from SUMMON_GUARDIANS and TRANSMUTATION bonuses\n* Added option to toggle spell usage by AI in quick combat\n* Fixed updating of spell point of enemy hero in game interface after spell cast\n* Fixed wrong creature spellcasting shortcut (now set to \"F\")\n* It is now possible to perform melee attack by creatures with spells, especially area spells\n* Right-click will now properly end spellcast mode\n* Fixed cursor preview when casting spell using touchscreen\n* Long tap during spell casting will now properly abort the spell\n\n### INTERFACE\n\n* Added \"Fill all empty slots with 1 creature\" option to radial wheel in garrison windows\n* Context popup for adventure map monsters will now show creature icon\n* Game will now show correct victory message for gather troops victory condition\n* Fixed incorrect display of number of owned Sawmills in Kingdom Overview window\n* Fixed incorrect color of resource bar in hotseat mode\n* Fixed broken toggle map level button in world view mode\n* Fixed corrupted interface after opening puzzle window from world view mode\n* Fixed blocked interface after attempt to start invalid map\n* Add yellow border to selected commander grandmaster ability\n* Always use bonus description for commander abilities instead of not provided wog-specific translation  \n* Fix scrolling when commander has large number of grandmaster abilities\n* Fixed corrupted message on another player defeat\n* Fixed unavailable Quest Log button on maps with quests\n* Fixed incorrect values on a difficulty selector in save load screen\n* Removed invalid error message on attempting to move non-existing unit in exchange window\n\n### RANDOM MAP GENERATOR\n\n* Fixed bug leading to unreachable resources around mines\n\n### MAP EDITOR\n\n* Fixed crash on maps containing abandoned mines\n* Fixed crash on maps containing neutral objects\n* Fixed problem with random map initialized in map editor\n* Fixed problem with initialization of random dwellings\n\n## 1.3.0 -> 1.3.1\n\n### GENERAL\n\n* Fixed framerate drops on hero movement with active hota mod\n* Fade-out animations will now be skipped when instant hero movement speed is used\n* Restarting loaded campaign scenario will now correctly reapply starting bonus\n* Reverted FPS limit on mobile systems back to 60 fps\n* Fixed loading of translations for maps and campaigns\n* Fixed loading of preconfigured starting army for heroes with preconfigured spells\n* Background battlefield obstacles will now appear below creatures\n* it is now possible to load save game located inside mod\n* Added option to configure reserved screen area in Launcher on iOS\n* Fixed border scrolling when game window is maximized\n\n### AI PLAYER\n\n* BattleAI: Improved performance of AI spell selection\n* NKAI: Fixed freeze on attempt to exchange army between garrisoned and visiting hero\n* NKAI: Fixed town threat calculation\n* NKAI: Fixed recruitment of new heroes\n* VCAI: Added workaround to avoid freeze on attempting to reach unreachable location\n* VCAI: Fixed spellcasting by Archangels\n\n### RANDOM MAP GENERATOR\n\n* Fixed placement of roads inside rock in underground\n* Fixed placement of shifted creature animations from HotA\n* Fixed placement of treasures at the boundary of wide connections\n* Added more potential locations for quest artifacts in zone\n\n### STABILITY\n\n* When starting client without H3 data game will now show message instead of silently crashing\n* When starting invalid map in campaign, game will now show message instead of silently crashing\n* Blocked loading of saves made with different set of mods to prevent crashes\n* Fixed crash on starting game with outdated mods\n* Fixed crash on attempt to sacrifice all your artifacts in Altar of Sacrifice\n* Fixed crash on leveling up after winning battle as defender\n* Fixed possible crash on end of battle opening sound\n* Fixed crash on accepting battle result after winning battle as defender\n* Fixed possible crash on casting spell in battle by AI\n* Fixed multiple possible crashes on managing mods on Android\n* Fixed multiple possible crashes on importing data on Android\n* Fixed crash on refusing rewards from town building\n* Fixed possible crash on threat evaluation by NKAI\n* Fixed crash on using haptic feedback on some Android systems\n* Fixed crash on right-clicking flags area in RMG setup mode\n* Fixed crash on opening Blacksmith window and Build Structure dialogs in some localizations\n* Fixed possible crash on displaying animated main menu\n* Fixed crash on recruiting hero in town located on the border of map\n\n## 1.2.1 -> 1.3.0\n\n### GENERAL\n\n* Implemented automatic interface scaling to any resolution supported by monitor\n* Implemented UI scaling option to scale game interface\n* Game resolution and UI scaling can now be changed without game restart\n* Fixed multiple issues with borderless fullscreen mode\n* On mobile systems game will now always run at native resolution with configurable UI scaling\n* Implemented support for Horn of the Abyss map format\n* Implemented option to replay results of quick combat\n* Added translations to French and Chinese\n* All in-game cheats are now case-insensitive\n* Added high-definition icon for Windows\n* Fix crash on connecting to server on FreeBSD and Flatpak builds\n* Save games now consist of a single file\n* Added H3:SOD cheat codes as alternative to vcmi cheats\n* Fixed several possible crashes caused by autocombat activation\n* Fixed artifact lock icon in localized versions of the game\n* Fixed possible crash on changing hardware cursor\n\n### TOUCHSCREEN SUPPORT\n\n* VCMI will now properly recognizes touch screen input\n* Implemented long tap gesture that shows popup window. Tap once more to close popup\n* Long tap gesture duration can now be configured in settings\n* Implemented radial menu for army management, activated via swiping creature icon\n* Implemented swipe gesture for scrolling through lists\n* All windows that have sliders in UI can now be scrolled using swipe gesture\n* Implemented swipe gesture for attack direction selection: swipe from enemy position to position you want to attack from\n* Implemented pinch gesture for zooming adventure map\n* Implemented haptic feedback (vibration) for long press gesture\n\n### LAUNCHER\n\n* Launcher will now attempt to automatically detect language of OS on first launch\n* Added \"About\" tab with information about project and environment\n* Added separate options for Allied AI and Enemy AI for adventure map\n* Patially fixed displaying of download progress for mods\n* Fixed potential crash on opening mod information for mods with a changelog\n* Added option to configure number of autosaves\n\n### MAP EDITOR\n\n* Fixed crash on cutting random town\n* Added option to export entire map as an image\n* Added validation for placing multiple heroes into starting town\n* It is now possible to have single player on a map\n* It is now possible to configure teams in editor\n\n### AI PLAYER\n\n* Fixed potential crash on accessing market (VCAI)\n* Fixed potentially infinite turns (VCAI)\n* Reworked object prioritizing\n* Improved town defense against enemy heroes\n* Improved town building (mage guild and horde)\n* Various behavior fixes\n\n### GAME MECHANICS\n\n* Hero retreating after end of 7th turn will now correctly appear in tavern\n* Implemented hero backpack limit (disabled by default)\n* Fixed Admiral's Hat movement points calculation\n* It is now possible to access Shipwrecks from coast\n* Hero path will now be correctly updated on equipping/unequipping Levitation Boots or Angel Wings\n* It is no longer possible to abort movement while hero is flying over water\n* Fixed digging for Grail\n* Implemented \"Survive beyond a time limit\" victory condition\n* Implemented \"Defeat all monsters\" victory condition\n* 100% damage resistance or damage reduction will make unit immune to a spell\n* Game will now randomly select obligatory skill for hero on levelup instead of always picking Fire Magic\n* Fixed duration of bonuses from visitable object such as Idol of Fortune\n* Rescued hero from prison will now correctly reveal map around him\n* Lighthouses will no longer give movement bonus on land\n\n### CAMPAIGNS\n\n* Fixed transfer of artifacts into next scenario\n* Fixed crash on advancing to next scenario with heroes from mods\n* Fixed handling of \"Start with building\" campaign bonus\n* Fixed incorrect starting level of heroes in campaigns\n* Game will now play correct music track on scenario selection window\n* Dracon woll now correctly start without spellbook in Dragon Slayer campaign\n* Fixed frequent crash on moving to next scenario during campaign\n* Fixed inability to dismiss heroes on maps with \"capture town\" victory condition\n\n### RANDOM MAP GENERATOR\n\n* Improved zone placement, shape and connections\n* Improved zone passability for better gameplay\n* Improved treasure distribution and treasure values to match SoD closely\n* Navigation and water-specific spells are now banned on maps without water\n* RMG will now respect road settings set in menu\n* Tweaked many original templates so they allow new terrains and factions\n* Added \"bannedTowns\", \"bannedTerrains\", \"bannedMonsters\" zone properties\n* Added \"road\" property to connections\n* Added monster strength \"none\"\n* Support for \"wide\" connections\n* Support for new \"fictive\" and \"repulsive\" connections\n* RMG will now run faster, utilizing many CPU cores\n* Removed random seed number from random map description\n\n### INTERFACE\n\n* Adventure map is now scalable and can be used with any resolution without mods\n* Adventure map interface is now correctly blocked during enemy turn\n* Visiting creature banks will now show amount of guards in bank\n* It is now possible to arrange army using status window\n* It is now possible to zoom in or out using mouse wheel or pinch gesture\n* It is now possible to reset zoom via Backspace hotkey\n* Receiving a message in chat will now play sound\n* Map grid will now correctly display on map start\n* Fixed multiple issues with incorrect updates of save/load game screen\n* Fixed missing fortifications level icon in town tooltip\n* Fixed positioning of resource label in Blacksmith window\n* Status bar on inactive windows will no longer show any tooltip from active window\n* Fixed highlighting of possible artifact placements when exchanging with allied hero\n* Implemented sound of flying movement (for Fly spell or Angel Wings)\n* Last symbol of entered cheat/chat message will no longer trigger hotkey\n* Right-clicking map name in scenario selection will now show file name\n* Right-clicking save game in save/load screen will now show file name and creation date\n* Right-clicking in town fort window will now show creature information popup\n* Implemented pasting from clipboard (Ctrl+V) for text input\n\n### BATTLES\n\n* Implemented Tower moat (Land Mines)\n* Implemented defence reduction for units in moat\n* Added option to always show hero status window\n* Battle opening sound can now be skipped with mouse click\n* Fixed movement through moat of double-hexed units\n* Fixed removal of Land Mines and Fire Walls\n* Obstacles will now correctly show up either below or above unit\n* It is now possible to teleport a unit through destroyed walls\n* Added distinct overlay image for showing movement range of highlighted unit\n* Added overlay for displaying shooting range penalties of units\n\n### MODDING\n\n* Implemented initial version of VCMI campaign format\n* Implemented spell cast as possible reward for configurable object\n* Implemented support for configurable buildings in towns\n* Implemented support for placing prison, tavern and heroes on water\n* Implemented support for new boat types\n* It is now possible for boats to use other movement layers, such as \"air\"\n* It is now possible to use growing artifacts on artifacts that can be used by hero\n* It is now possible to configure town moat\n* Palette-cycling animation of terrains and rivers can now be configured in json\n* Game will now correctly resolve identifier in unexpected form (e.g. 'bless' vs 'spell.bless' vs 'core:bless')\n* Creature specialties that use short form ( \"creature\" : \"pikeman\" ) will now correctly affect all creature upgrades\n* It is now possible to configure spells for Shrines\n* It is now possible to configure upgrade costs per level for Hill Forts\n* It is now possible to configure boat type for Shipyards on adventure map and in town\n* Implemented support for HotA-style adventure map images for monsters, with offset\n* Replaced (SCHOOL)_SPELL_DMG_PREMY with SPELL_DAMAGE bonus (uses school as subtype).\n* Removed bonuses (SCHOOL)_SPELLS - replaced with SPELLS_OF_SCHOOL\n* Removed DIRECT_DAMAGE_IMMUNITY bonus - replaced by 100% spell damage resistance\n* MAGIC_SCHOOL_SKILL subtype has been changed for consistency with other spell school bonuses\n* Configurable objects can now be translated\n* Fixed loading of custom battlefield identifiers for map objects\n\n## 1.2.0 -> 1.2.1\n\n### GENERAL\n\n* Implemented spell range overlay for Dimension Door and Scuttle Boat\n* Fixed movement cost penalty from terrain\n* Fixed empty Black Market on game start\n* Fixed bad morale happening after waiting\n* Fixed good morale happening after defeating last enemy unit\n* Fixed death animation of Efreeti killed by petrification attack\n* Fixed crash on leaving to main menu from battle in hotseat mode\n* Fixed music playback on switching between towns\n* Special months (double growth and plague) will now appear correctly\n* Adventure map spells are no longer visible on units in battle\n* Attempt to cast spell with no valid targets in hotseat will show appropriate error message\n* RMG settings will now show all existing in game templates and not just those suitable for current settings\n* RMG settings (map size and two-level maps) that are not compatible with current template will be blocked\n* Fixed centering of scenario information window\n* Fixed crash on empty save game list after filtering\n* Fixed blocked progress in Launcher on language detection failure\n* Launcher will now correctly handle selection of Ddata directory in H3 install\n* Map editor will now correctly save message property for events and pandoras\n* Fixed incorrect saving of heroes portraits in editor\n\n## 1.1.1 -> 1.2.0\n\n### GENERAL\n\n* Adventure map rendering was entirely rewritten with better, more functional code\n* Client battle code was heavily reworked, leading to better visual look & feel and fixing multiple minor battle bugs / glitches\n* Client mechanics are now framerate-independent, rather than speeding up with higher framerate\n* Implemented hardware cursor support\n* Heroes III language can now be detected automatically\n* Increased targeted framerate from 48 to 60\n* Increased performance of UI updates\n* Fixed bonus values of heroes who specialize in secondary skills\n* Fixed bonus values of heroes who specialize in creatures\n* Fixed damage increase from Adela's Bless specialty\n* Fixed missing obstacles in battles on subterranean terrain\n* Video files now play at correct speed\n* Fixed crash on switching to second mission in campaigns\n* New cheat code: vcmiazure - give 5000 azure dragons in every empty slot\n* New cheat code: vcmifaerie - give 5000 faerie dragons in every empty slot\n* New cheat code: vcmiarmy or vcminissi - give specified creatures in every empty slot. EG: vcmiarmy imp\n* New cheat code: vcmiexp or vcmiolorin - give specified amount of experience to current hero. EG: vcmiexp 10000\n* Fixed oversided message window from Scholar skill that had confirmation button outside game window\n* Fixed loading of prebuilt creature hordes from h3m maps\n* Fixed volume of ambient sounds when changing game sounds volume\n* Fixed might&magic affinities of Dungeon heroes\n* Fixed Roland's specialty to affect Swordsmen/Crusaders instead of Griffins\n* Buying boat in town of an ally now correctly uses own resources instead of stealing them from ally\n* Default game difficulty is now set to \"normal\" instead of \"easy\"\n* Fixed crash on missing music files\n\n### MAP EDITOR\n\n* Added translations to German, Polish, Russian, Spanish, Ukrainian\n* Implemented cut/copy/paste operations\n* Implemented lasso brush for terrain editing\n* Toolbar actions now have names\n* Added basic victory and lose conditions\n\n### LAUNCHER\n\n* Added initial Welcome/Setup screen for new players\n* Added option to install translation mod if such mod exists and player's H3 version has different language\n* Icons now have higher resolution, to prevent upscaling artifacts\n* Added translations to German, Polish, Russian, Spanish, Ukrainian\n* Mods tab layout has been adjusted based on feedback from players\n* Settings tab layout has been redesigned to support longer texts\n* Added button to start map editor directly from Launcher\n* Simplified game starting flow from online lobby\n* Mod description will now show list of languages supported by mod\n* Launcher now uses separate mod repository from vcmi-1.1 version to prevent mod updates to unsupported versions\n* Size of mod list and mod details sub-windows can now be adjusted by player\n\n### AI PLAYER\n\n* Nullkiller AI is now used by default\n* AI should now be more active in destroying heroes causing treat on AI towns\n* AI now has higher priority for resource-producing mines\n* Increased AI priority of town dwelling upgrades\n* AI will now de-prioritize town hall upgrades when low on resources\n* Messages from cheats used by AI are now hidden\n* Improved army gathering from towns\n* AI will now attempt to exchange armies between main heroes to get the strongest hero with the strongest army.\n* Improved Pandora handling\n* AI takes into account fort level now when evaluating enemy town capturing priority.\n* AI can not use allied shipyard now to avoid freeze\n* AI will avoid attacking creatures standing on draw-bridge tile during siege if the bridge is closed.\n* AI will consider retreat during siege if it can not do anything (catapult is destroyed, no destroyed walls exist)\n\n### RANDOM MAP GENERATOR\n\n* Random map generator can now be used without vcmi-extras mod\n* RMG will no longer place shipyards or boats at very small lakes\n* Fixed placement of shipyards in invalid locations\n* Fixed potential game hang on generation of random map\n* RMG will now generate additional monolith pairs to create required number of zone connections\n* RMG will try to place Subterranean Gates as far away from other objects (including each other) as possible\n* RMG will now try to place objects as far as possible in both zones sharing a guard, not only the first one.\n* Use only one template for an object in zone\n* Objects with limited per-map count will be distributed evenly among zones with suitable terrain\n* Objects above zone treasure value will not be considered for placement\n* RMG will prefer terrain-specific templates for objects placement\n* RMG will place Towns and Monoliths first in order to generate long roads across the zone.\n* Adjust the position of center town in the zone for better look & feel on S maps.\n* Description of random map will correctly show number of levels\n* Fixed amount of creatures found in Pandora Boxes to match H3\n* Visitable objects will no longer be placed on top of the map, obscured by map border\n\n### ADVENTURE MAP\n\n* Added option to replace popup messages on object visiting with messages in status window\n* Implemented different hero movement sounds for offroad movement\n* Cartographers now reveal terrain in the same way as in H3\n* Status bar will now show movement points information on pressing ALT or after enabling option in settings\n* It is now not possible to receive rewards from School of War without required gold amount\n* Owned objects, like Mines and Dwellings will always show their owner in status bar\n* It is now possible to interact with on-map Shipyard when no hero is selected\n* Added option to show amount of creatures as numeric range rather than adjective\n* Added option to show map grid\n* Map swipe is no longer exclusive for phones and can be enabled on desktop platforms\n* Added more graduated settings for hero movement speed\n* Map scrolling is now more graduated and scrolls with pixel-level precision\n* Hero movement speed now matches H3\n* Improved performance of adventure map rendering\n* Fixed embarking and disembarking sounds\n* Fixed selection of \"new week\" animation for status window\n* Object render order now mostly matches H3\n* Fixed movement cost calculation when using \"Fly\" spell or \"Angel Wings\"\n* Fixed game freeze on using Town Portal to teleport into town with unvisited Battle Scholar Academy\n* Fixed invalid ambient sound of Whirlpool\n* Hero path will now be correctly removed on defeating monsters that are at the end of hero path\n* Seer Hut tooltips will now show messages for correct quest type\n\n### INTERFACE\n\n* Implemented new settings window\n* Added framerate display option\n* Fixed white status bar on server connection screen\n* Buttons in battle window now correctly show tooltip in status bar\n* Fixed cursor image during enemy turn in combat\n* Game will no longer prompt to assemble artifacts if they fall into backpack\n* It is now possible to use in-game console for vcmi commands\n* Stacks sized 1000-9999 units will not be displayed as \"1k\"\n* It is now possible to select destination town for Town Portal via double-click\n* Implemented extended options for random map tab: generate G+U size, select RMG template, manage teams and roads\n\n### HERO SCREEN\n\n* Fixed cases of incorrect artifact slot highlighting\n* Improved performance of artifact exchange operation\n* Picking up composite artifact will immediately unlock slots\n* It is now possible to swap two composite artifacts\n\n### TOWN SCREEN\n\n* Fixed gradual fade-in of a newly built building\n* Fixed duration of building fade-in to match H3\n* Fixed rendering of Shipyard in Castle\n* Blacksmith purchase button is now properly locked if artifact slot is occupied by another warmachine\n* Added option to show number of available creatures in place of growth\n* Fixed possible interaction with hero / town list from adventure map while in town screen\n* Fixed missing left-click message popup for some town buildings\n* Moving hero from garrison by pressing space will now correctly show message \"Cannot have more than 8 adventuring heroes\"\n\n### BATTLES\n\n* Added settings for even faster animation speed than in H3\n* Added display of potential kills numbers into attack tooltip in status bar\n* Added option to skip battle opening music entirely\n* All effects will now wait for battle opening sound before playing\n* Hex highlighting will now be disabled during enemy turn\n* Fixed incorrect log message when casting spell that kills zero units\n* Implemented animated cursor for spellcasting\n* Fixed multiple issues related to ordering of creature animations\n* Fixed missing flags from hero animations when opening menus\n* Fixed rendering order of moat and grid shadow\n* Jousting bonus from Champions will now be correctly accounted for in damage estimation\n* Building Castle building will now provide walls with additional health point\n* Speed of all battle animations should now match H3\n* Fixed missing obstacles on subterranean terrain\n* Ballistics mechanics now matches H3 logic\n* Arrow Tower base damage should now match H3\n* Destruction of wall segments will now remove ranged attack penalty\n* Force Field cast in front of drawbridge will now block it as in H3\n* Fixed computations for Behemoth defense reduction ability\n* Bad luck (if enabled) will now multiple all damage by 50%, in line with other damage reducing mechanics\n* Fixed highlighting of movement range for creatures standing on a corpse\n* All battle animations now have same duration/speed as in H3\n* Added missing combat log message on resurrecting creatures\n* Fixed visibility of blue border around targeted creature when spellcaster is making turn\n* Fixed selection highlight when in targeted creature spellcasting mode\n* Hovering over hero now correctly shows hero cursor\n* Creature currently making turn is now highlighted in the Battle Queue\n* Hovering over creature icon in Battle Queue will highlight this creature in the battlefield\n* New battle UI extension allows control over creatures' special abilities\n* Fixed crash on activating auto-combat in battle\n* Fixed visibility of unit creature amount labels and timing of their updates\n* Firewall will no longer hit double-wide units twice when passing through\n* Unicorn Magic Damper Aura ability now works multiplicatively with Resistance\n* Orb of Vulnerability will now negate Resistance skill\n\n### SPELLS\n\n* Hero casting animation will play before spell effect\n* Fire Shield: added sound effect\n* Fire Shield: effect now correctly plays on defending creature\n* Earthquake: added sound effect\n* Earthquake: spell will not select sections that were already destroyed before cast\n* Remove Obstacles: fixed error message when casting on maps without obstacles\n* All area-effect spells (e.g. Fireball) will play their effect animation on top\n* Summoning spells: added fade-in effect for summoned creatures\n* Fixed timing of hit animation for damage-dealing spells\n* Obstacle-creating spells: UI is now locked during effect animation\n* Obstacle-creating spells: added sound effect\n* Added reverse death animation for spells that bring stack back to life\n* Bloodlust: implemented visual effect\n* Teleport: implemented visual fade-out and fade-in effect for teleporting\n* Berserk: Fixed duration of effect\n* Frost Ring: Fixed spell effect range\n* Fixed several cases where multiple different effects could play at the same time\n* All spells that can affecte multiple targets will now highlight affected stacks\n* Bless and Curse now provide +1 or -1 to base damage on Advanced & Expert levels\n\n### ABILITIES\n\n* Rebirth (Phoenix): Sound will now play in the same time as animation effect\n* Master Genie spellcasting: Sound will now play in the same time as animation effect\n* Power Lich, Magogs: Sound will now play in the same time as attack animation effect\n* Dragon Breath attack now correctly uses different attack animation if multiple targets are hit\n* Petrification: implemented visual effect\n* Paralyze: added visual effect\n* Blind: Stacks will no longer retaliate on attack that blinds them\n* Demon Summon: Added animation effect for summoning\n* Fire shield will no longer trigger on non-adjacent attacks, e.g. from Dragon Breath\n* Weakness now has correct visual effect\n* Added damage bonus for opposite elements for Elementals\n* Added damage reduction for Magic Elemental attacks against creatures immune to magic\n* Added incoming damage reduction to Petrify\n* Added counter-attack damage reduction for Paralyze\n\n### MODDING\n\n* All configurable objects from H3 now have their configuration in json\n* Improvements to functionality of configurable objects\n* Replaced `SECONDARY_SKILL_PREMY` bonus with separate bonuses for each skill.\n* Removed multiple bonuses that can be replaced with another bonus.\n* It is now possible to define new hero movement sounds in terrains\n* Implemented translation support for mods\n* Implemented translation support for .h3m maps and .h3c campaigns\n* Translation mods are now automatically disabled if player uses different language\n* Files with new Terrains, Roads and Rivers are now validated by game\n* Parameters controlling effect of attack and defences stats on damage are now configurable in defaultMods.json\n* New bonus: `LIMITED_SHOOTING_RANGE`. Creatures with this bonus can only use ranged attack within specified range\n* Battle window and Random Map Tab now have their layout defined in json file\n* Implemented code support for alternative actions mod\n* Implemented code support for improved random map dialog\n* It is now possible to configure number of creature stacks in heroes' starting armies\n* It is now possible to configure number of constructed dwellings in towns on map start\n* Game settings previously located in defaultMods.json are now loaded directly from mod.json\n* It is now possible for spellcaster units to have multiple spells (but only for targeting different units)\n* Fixed incorrect resolving of identifiers in commander abilities and stack experience definitions\n\n## 1.1.0 -> 1.1.1\n\n### GENERAL\n\n* Fixed missing sound in Polish version from gog.com\n* Fixed positioning of main menu buttons in localized versions of H3\n* Fixed crash on transferring artifact to commander\n* Fixed game freeze on receiving multiple artifact assembly dialogs after combat\n* Fixed potential game freeze on end of music playback\n* macOS/iOS: fixed sound glitches\n* Android: upgraded version of SDL library\n* Android: reworked right click gesture and relative pointer mode\n* Improved map loading speed\n* Ubuntu PPA: game will no longer crash on assertion failure\n\n### ADVENTURE MAP\n\n* Fixed hero movement lag in single-player games\n* Fixed number of drowned troops on visiting Sirens to match H3\n* iOS: pinch gesture visits current object (Spacebar behavior) instead of activating in-game console\n\n### TOWNS\n\n* Fixed displaying growth bonus from Statue of Legion\n* Growth bonus tooltip ordering now matches H3\n* Buy All Units dialog will now buy units starting from the highest level\n\n### LAUNCHER\n\n* Local mods can be disabled or uninstalled\n* Fixed styling of Launcher interface\n\n### MAP EDITOR\n\n* Fixed saving of roads and rivers\n* Fixed placement of heroes on map\n\n## 1.0.0 -> 1.1.0\n\n### GENERAL\n\n* iOS is supported\n* Mods and their versions and serialized into save files. Game checks mod compatibility before loading\n* Logs are stored in system default logs directory\n* LUA/ERM libs are not compiled by default\n* FFMpeg dependency is optional now\n* Conan package manager is supported for MacOS and iOS\n\n### MULTIPLAYER\n\n* Map is passed over network, so different platforms are compatible with each other\n* Server self-killing is more robust\n* Unlock in-game console while opponent's turn\n* Host can control game session by using console commands\n* Control over player is transferred to AI if client escaped the game\n* Reconnection mode for crashed client processes\n* Playing online is available using proxy server\n\n### ADVENTURE MAP\n\n* Fix for digging while opponent's turn\n* Supported right click for quick recruit window\n* Fixed problem with quests are requiring identical artefacts\n* Bulk move and swap artifacts\n* Pause & resume for towns and terrains music themes\n* Feature to assemble/disassemble artefacts in backpack\n* Clickable status bar to send messages\n* Heroes no longer have chance to receive forbidden skill on leveling up\n* Fixed visibility of newly recruited heroes near town\n* Fixed missing artifact slot in Artifact Merchant window\n\n### BATTLES\n\n* Fix healing/regeneration behaviour and effect\n* Fix crashes related to auto battle\n* Implemented ray projectiles for shooters\n* Introduced default tower shooter icons\n* Towers destroyed during battle will no longer be listed as casualties\n\n### AI\n\n* BattleAI: Target prioritizing is now based on damage difference instead of health difference\n* Nullkiller AI can retreat and surrender\n* Nullkiller AI doesn't visit allied dwellings anymore\n* Fixed a few freezes in Nullkiller AI\n\n### RANDOM MAP GENERATOR\n\n* Speedup generation of random maps\n* Necromancy cannot be learned in Witch Hut on random maps\n\n### MODS\n\n* Supported rewardable objects customization\n* Battleground obstacles are extendable now with VLC mechanism\n* Introduced \"compatibility\" section into mods settings\n* Fixed bonus system for custom advmap spells\n* Supported customisable town entrance placement\n* Fixed validation of mods with new adventure map objects\n\n### LAUNCHER\n\n* Fixed problem with duplicated mods in the list\n* Launcher shows compatible mods only\n* Uninstall button was moved to the left of layout\n* Unsupported resolutions are not shown\n* Lobby for online gameplay is implemented\n\n### MAP EDITOR\n\n* Basic version of Qt-based map editor\n\n## 0.99 -> 1.0.0\n\n### GENERAL\n\n* Spectator mode was implemented through command-line options\n* Some main menu settings get saved after returning to main menu - last selected map, save etc.\n* Restart scenario button should work correctly now\n* Skyship Grail works now immediately after capturing without battle\n* Lodestar Grail implemented\n* Fixed Gargoyles immunity\n* New bonuses:\n  * SOUL_STEAL - \"WoG ghost\" ability, should work somewhat same as in H3\n  * TRANSMUTATION - \"WoG werewolf\"-like ability\n  * SUMMON_GUARDIANS - \"WoG santa gremlin\"-like ability + two-hex unit extension\n  * CATAPULT_EXTRA_SHOTS - defines number of extra wall attacks for units that can do so\n  * RANGED_RETALIATION - allows ranged counterattack\n  * BLOCKS_RANGED_RETALIATION - disallow enemy ranged counterattack\n  * SECONDARY_SKILL_VAL2 - set additional parameter for certain secondary skills\n  * MANUAL_CONTROL - grant manual control over war machine\n  * WIDE_BREATH - melee creature attacks affect many nearby hexes\n  * FIRST_STRIKE - creature counterattacks before attack if possible\n  * SYNERGY_TARGET - placeholder bonus for Mod Design Team (subject to removal in future)\n  * SHOOTS_ALL_ADJACENT - makes creature shots affect all neighbouring hexes\n  * BLOCK_MAGIC_BELOW - allows blocking spells below particular spell level. HotA cape artifact can be implemented with this\n  * DESTRUCTION - creature ability for killing extra units after hit, configurable\n\n### MULTIPLAYER\n\n* Loading support. Save from single client could be used to load all clients.\n* Restart support. All clients will restart together on same server.\n* Hotseat mixed with network game. Multiple colors can be controlled by each client.\n\n### SPELLS\n\n* Implemented cumulative effects for spells\n\n### MODS\n\n* Improve support for WoG commander artifacts and skill descriptions\n* Added support for modding of original secondary skills and creation of new ones.\n* Map object sounds can now be configured via json\n* Added bonus updaters for hero specialties\n* Added allOf, anyOf and noneOf qualifiers for bonus limiters\n* Added bonus limiters: alignment, faction and terrain\n* Supported new terrains, new battlefields, custom water and rock terrains\n* Following special buildings becomes available in the fan towns:\n  * attackVisitingBonus\n  * defenceVisitingBonus\n  * spellPowerVisitingBonus\n  * knowledgeVisitingBonus\n  * experienceVisitingBonus\n  * lighthouse\n  * treasury\n\n### SOUND\n\n* Fixed many missing or wrong pickup and visit sounds for map objects\n* All map objects now have ambient sounds identical to OH3\n\n### RANDOM MAP GENERATOR\n\n* Random map generator supports water modes (normal, islands)\n* Added config randomMap.json with settings for map generator\n* Added parameter for template allowedWaterContent\n* Extra resource packs appear nearby mines\n* Underground can be player starting place for factions allowed to be placed underground\n* Improved obstacles placement aesthetics\n* Rivers are generated on the random maps\n* RMG works more stable, various crashes have been fixed\n* Treasures requiring guards are guaranteed to be protected\n\n### VCAI\n\n* Reworked goal decomposition engine, fixing many loopholes. AI will now pick correct goals faster.\n* AI will now use universal pathfinding globally\n* AI can use Summon  Boat and Town Portal\n* AI can gather and save resources on purpose\n* AI will only buy army on demand instead of every turn\n* AI can distinguish the value of all map objects\n* General speed optimizations\n\n### BATTLES\n\n* Towers should block ranged retaliation\n* AI can bypass broken wall with moat instead of standing and waiting until gate is destroyed\n* Towers do not attack war machines automatically\n* Draw is possible now as battle outcome in case the battle ends with only summoned creatures (both sides loose)\n\n### ADVENTURE MAP\n\n* Added buttons and keyboard shortcuts to quickly exchange army and artifacts between heroes\n* Fix: Captured town should not be duplicated on the UI\n\n### LAUNCHER\n\n* Implemented notifications about updates\n* Supported redirection links for downloading mods\n\n## 0.98 -> 0.99\n\n### GENERAL\n\n* New Bonus NO_TERRAIN_PENALTY\n* Nomads will remove Sand movement penalty from army\n* Flying and water walking is now supported in pathfinder\n* New artifacts supported\n  * Angel Wings\n  * Boots of Levitation\n* Implemented rumors in tavern window\n* New cheat codes:\n  * vcmiglaurung - gives 5000 crystal dragons into each slot\n  * vcmiungoliant - conceal fog of war for current player\n* New console commands:\n  * gosolo - AI take control over human players and vice versa\n  * controlai - give control of one or all AIs to player\n  * set hideSystemMessages on/off - suppress server messages in chat\n\n### BATTLES\n\n* Drawbridge mechanics implemented (animation still missing)\n* Merging of town and visiting hero armies on siege implemented\n* Hero info tooltip for skills and mana implemented\n\n### ADVENTURE AI\n\n* Fixed AI trying to go through underground rock\n* Fixed several cases causing AI wandering aimlessly\n* AI can again pick best artifacts and exchange artifacts between heroes\n* AI heroes with patrol enabled won't leave patrol area anymore\n\n### RANDOM MAP GENERATOR\n\n* Changed fractalization algorithm so it can create cycles\n* Zones will not have straight paths anymore, they are totally random\n* Generated zones will have different size depending on template setting\n* Added Thieves Guild random object (1 per zone)\n* Added Seer Huts with quests that match OH3\n* RMG will guarantee at least 100 pairs of Monoliths are available even if there are not enough different defs\n\n## 0.97 -> 0.98\n\n### GENERAL\n\n* Pathfinder can now find way using Monoliths and Whirlpools (only used if hero has protection)\n\n### ADVENTURE AI\n\n* AI will try to use Monolith entrances for exploration\n* AI will now always revisit each exit of two way monolith if exit no longer visible\n* AI will eagerly pick guarded and blocked treasures\n\n### ADVENTURE MAP\n\n* Implemented world view\n* Added graphical fading effects\n\n### SPELLS\n\n* New spells handled:\n  * Earthquake\n  * View Air\n  * View Earth\n  * Visions\n  * Disguise\n* Implemented CURE spell negative dispel effect\n* Added LOCATION target for spells castable on any hex with new target modifiers\n\n### BATTLES\n\n* Implemented OH3 stack split / upgrade formulas according to AlexSpl\n\n### RANDOM MAP GENERATOR\n\n* Underground tunnels are working now\n* Implemented \"junction\" zone type\n* Improved zone placing algorithm\n* More balanced distribution of treasure piles\n* More obstacles within zones\n\n## 0.96 -> 0.97 (Nov 01 2014)\n\n### GENERAL\n\n* (windows) Moved VCMI data directory from '%userprofile%\\vcmi' to '%userprofile%\\Documents\\My Games\\vcmi'\n* (windows) (OSX) Moved VCMI save directory from 'VCMI_DATA\\Games' to 'VCMI_DATA\\Saves'\n* (linux)\n* Changes in used librries:\n  * VCMI can now be compiled with SDL2\n  * Movies will use ffmpeg library\n  * change boost::bind to std::bind\n  * removed boost::assign\n  * Updated FuzzyLite to 5.0\n* Multiplayer load support was implemented through command-line options\n\n### ADVENTURE AI\n\n* Significantly optimized execution time, AI should be much faster now.\n\n### ADVENTURE MAP\n\n* Non-latin characters can now be entered in chat window or used for save names.\n* Implemented separate speed for owned heroes and heroes owned by other players\n\n### GRAPHICS\n\n* Better upscaling when running in fullscreen mode.\n* New creature/commader window\n* New resolutions and bonus icons are now part of a separate mod\n* Added graphics for GENERAL_DAMAGE_REDUCTION bonus (Kuririn)\n\n### RANDOM MAP GENERATOR\n\n* Random map generator now creates complete and playable maps, should match original RMG\n* All important features from original map templates are implemented\n* Fixed major crash on removing objects\n* Undeground zones will look just like surface zones\n\n### LAUNCHER\n\n* Implemented switch to disable intro movies in game\n\n## 0.95 -> 0.96 (Jul 01 2014)\n\n### GENERAL\n\n* (linux) now VCMI follows XDG specifications. See <http://forum.vcmi.eu/viewtopic.php?t=858>\n\n### ADVENTURE AI\n\n* Optimized speed and removed various bottlenecks.\n\n### ADVENTURE MAP\n\n* Heroes auto-level primary and secondary skill levels according to experience\n\n### BATTLES\n\n* Wall hit/miss sound will be played when using catapult during siege\n\n### SPELLS\n\n* New configuration format\n\n### RANDOM MAP GENERATOR\n\n* Towns from mods can be used\n* Reading connections, terrains, towns and mines from template\n* Zone placement\n* Zone borders and connections, fractalized paths inside zones\n* Guard generation\n* Treasure piles generation (so far only few removable objects)\n\n### MODS\n\n* Support for submods - mod may have their own \"submods\" located in <modname>/Mods directory\n* Mods may provide their own changelogs and screenshots that will be visible in Launcher\n* Mods can now add new (offensive, buffs, debuffs) spells and change existing\n* Mods can use custom mage guild background pictures and videos for taverns, setting of resources daily income for buildings\n\n### GENERAL\n\n* Added configuring of heroes quantity per player allowed in game\n\n## 0.94 -> 0.95 (Mar 01 2014)\n\n### GENERAL\n\n* Components of combined artifacts will now display info about entire set.\n* Implements level limit\n* Added WoG creature abilities by Kuririn\n* Implemented a confirmation dialog when pressing Alt + F4 to quit the game\n* Added precompiled header compilation for CMake (can be enabled per flag)\n* VCMI will detect changes in text files using crc-32 checksum\n* Basic support for unicode. Internally vcmi always uses utf-8\n* (linux) Launcher will be available as \"VCMI\" menu entry from system menu/launcher\n* (linux) Added a SIGSEV violation handler to vcmiserver executable for logging stacktrace (for convenience)\n\n### ADVENTURE AI\n\n* AI will use fuzzy logic to compare and choose multiple possible subgoals.\n* AI will now use SectorMap to find a way to guarded / covered objects.\n* Significantly improved exploration algorithm.\n* Locked heroes now try to decompose their goals exhaustively.\n* Fixed (common) issue when AI found neutral stacks infinitely strong.\n* Improvements for army exchange criteria.\n* GatherArmy may include building dwellings in town (experimental).\n* AI should now conquer map more aggressively and much faster\n* Fuzzy rules will be printed out at map launch (if AI log is enabled)\n\n### CAMPAIGNS\n\n* Implemented move heroes to next scenario\n* Support for non-standard victory conditions for H3 campaigns\n* Campaigns use window with bonus & scenario selection than scenario information window from normal maps\n* Implemented hero recreate handling (e.g. Xeron will be recreated on AB campaign)\n* Moved place bonus hero before normal random hero and starting hero placement -> same behaviour as in OH3\n* Moved placing campaign heroes before random object generation -> same behaviour as in OH3\n\n### TOWNS\n\n* Extended building dependencies support\n\n### MODS\n\n* Custom victory/loss conditions for maps or campaigns\n* 7 days without towns loss condition is no longer hardcoded\n* Only changed mods will be validated\n\n## 0.93 -> 0.94 (Oct 01 2013)\n\n### GENERAL\n\n* New Launcher application, see\n* Filesystem now supports zip archives. They can be loaded similarly to other archives in filesystem.json. Mods can use Content.zip instead of Content/ directory.\n* fixed \"get txt\" console command\n* command \"extract\" to extract file by name\n* command \"def2bmp\" to convert def into set of frames.\n* fixed crash related to cammander's SPELL_AFTER_ATTACK spell id not initialized properly (text id was resolved on copy of bonus)\n* fixed duels, added no-GUI mode for automatic AI testing\n* Sir Mullich is available at the start of the game\n* Upgrade cost will never be negative.\n* support for Chinese fonts (GBK 2-byte encoding)\n\n### ADVENTURE MAP\n\n* if Quick Combat option is turned on, battles will be resolved by AI\n* first hero is awakened on new turn\n* fixed 3000 gems reward in shipwreck\n\n### BATTLES\n\n* autofight implemented\n* most of the animations is time-based\n* simplified postioning of units in battle, should fix remaining issues with unit positioning\n* synchronized attack/defence animation\n* spell animation speed uses game settings\n* fixed disrupting ray duration\n* added logging domain for battle animations\n* Fixed crashes on Land Mines / Fire Wall casting.\n* UI will be correctly greyed-out during opponent turn\n* fixed remaining issues with blit order\n* Catapult attacks should be identical to H3. Catapult may miss and attack another part of wall instead (this is how it works in H3)\n* Fixed Remove Obstacle.\n* defeating hero will yield 500 XP\n* Added lots of missing spell immunities from Strategija\n* Added stone gaze immunity for Troglodytes (did you know about it?)\n* damage done by turrets is properly increased by built buldings\n* Wyverns will cast Poison instead of Stone Gaze.\n\n### TOWN\n\n* Fixed issue that allowed to build multiple boats in town.\n* fix for lookout tower\n\n## 0.92 -> 0.93 (Jun 01 2013)\n\n### GENERAL\n\n* Support for SoD-only installations, WoG becomes optional addition\n* New logging framework\n* Negative luck support, disabled by default\n* Several new icons for creature abilities (Fire Shield, Non-living, Magic Mirror, Spell-like Attack)\n* Fixed stack artifact (and related buttons) not displaying in creature window.\n* Fixed crash at month of double population.\n\n### MODS\n\n* Improved json validation. Now it support most of features from latest json schema draft.\n* Icons use path to icon instead of image indexes.\n* It is possible to edit data of another mod or H3 data via mods.\n* Mods can access only ID's from dependencies, virtual \"core\" mod and itself (optional for some mods compatibility)\n* Removed no longer needed field \"projectile spins\"\n* Heroes: split heroes.json in manner similar to creatures\\factions; string ID's for H3 heroes; h3 hero classes and artifacts can be modified via json.\n\n### BATTLES\n\n* Fixed Death Stare of Commanders\n* Projectile blitting should be closer to original H3. But still not perfect.\n* Fixed missing Mirth effects\n* Stack affected by Berserk should not try to attack itself\n* Fixed several cases of incorrect positioning of creatures in battles\n* Fixed abilities of Efreet.\n* Fixed broken again palette in some battle backgrounds\n\n### TOWN\n\n* VCMI will not crash if building selection area is smaller than def\n* Detection of transparency on selection area is closer to H3\n* Improved handling buildings with mode \"auto\":\n  * they will be properly processed (new creatures will be added if dwelling, spells learned if mage guild, and so on)\n  * transitive dependencies are handled (A makes B build, and B makes C and D)\n\n### SOUND\n\n* Added missing WoG creature sounds (from Kuririn).\n* The Windows package comes with DLLs needed to play .ogg files\n* (linux) convertMP3 option for vcmibuilder for systems where SDL_Mixer can't play mp3's\n* some missing sounds for battle effects\n\n### ARTIFACTS\n\n* Several fixes to combined artifacts added via mods.\n* Fixed Spellbinder's Hat giving level 1 spells instead of 5.\n* Fixed incorrect components of Cornucopia.\n* Cheat code with grant all artifacts, including the ones added by mods\n\n## 0.91 -> 0.92 (Mar 01 2013)\n\n### GENERAL\n\n* hero crossover between missions in campaigns\n* introduction before missions in campaigns\n\n### MODS\n\n* Added CREATURE_SPELL_POWER for commanders\n* Added spell modifiers to various spells: Hypnotize (Astral), Firewall (Luna), Landmine\n* Fixed ENEMY_DEFENCE_REDUCTION, GENERAL_ATTACK_REDUCTION\n* Extended usefulness of ONLY_DISTANCE_FIGHT, ONLY_MELEE_FIGHT ranges\n* Double growth creatures are configurable now\n* Drain Life now has % effect depending on bonus value\n* Stack can use more than 2 attacks. Additional attacks can now be separated as \"ONLY_MELEE_FIGHT and \"ONLY_DISTANCE_FIGHT\".\n* Moat damage configurable\n* More config options for spells:\n  * mind immunity handled by config\n  * direct damage immunity handled by config\n  * immunity icon configurable\n  * removed mind_spell flag\n* creature config use string ids now.\n* support for string subtype id in short bonus format\n* primary skill identifiers for bonuses\n\n## 0.9 -> 0.91 (Feb 01 2013)\n\n### GENERAL\n\n* VCMI build on OS X is now supported\n* Completely removed autotools\n* Added RMG interace and ability to generate simplest working maps\n* Added loading screen\n\n### MODS\n\n* Simplified mod structure. Mods from 0.9 will not be compatible.\n* Mods can be turned on and off in config/modSettings.json file\n* Support for new factions, including:\n  * New towns\n  * New hero classes\n  * New heroes\n  * New town-related external dwellings\n* Support for new artifact, including combined, commander and stack artifacts\n* Extended configuration options\n  * All game objects are referenced by string identifiers\n  * Subtype resolution for bonuses\n\n### BATTLES\n\n* Support for \"enchanted\" WoG ability\n\n### ADVENTURE AI\n\n* AI will try to use Subterranean Gate, Redwood Observatory and Cartographer for exploration\n* Improved exploration algorithm\n* AI will prioritize dwellings and mines when there are no opponents visible\n\n## 0.89 -> 0.9 (Oct 01 2012)\n\n### GENERAL\n\n* Provisional support creature-adding mods\n* New filesystem allowing easier resource adding/replacing\n* Reorganized package for better compatibility with HotA and not affecting the original game\n* Moved many hard-coded settings into text config files\n* Commander level-up dialog\n* New Quest Log window\n* Fixed a number of bugs in campaigns, support for starting hero selection bonus.\n\n### BATTLES\n\n* New graphics for Stack Queue\n* Death Stare works identically to H3\n* No explosion when catapult fails to damage the wall\n* Fixed crash when attacking stack dies before counterattack\n* Fixed crash when attacking stack dies in the Moat just before the attack\n* Fixed Orb of Inhibition and Recanter's Cloak (they were incorrectly implemented)\n* Fleeing hero won't lose artifacts.\n* Spellbook won't be captured.\n\n### ADVENTURE AI\n\n* support for quests (Seer Huts, Quest Guardians, and so)\n* AI will now wander with all the heroes that have spare movement points. It should prevent stalling.\n* AI will now understand threat of Abandoned Mine.\n* AI can now exchange armies between heroes. By default, it will pass army to main hero.\n* Fixed strange case when AI found allied town extremely dangerous\n* Fixed crash when AI tried to \"revisit\" a Boat\n* Fixed crash when hero assigned to goal was lost when attempting realizing it\n* Fixed a possible freeze when exchanging resources at marketplace\n\n### BATTLE AI\n\n* It is possible to select a battle AI module used by VCMI by typing into the console \"setBattleAI <name>\". The names of available modules are \"StupidAI\" and \"BattleAI\". BattleAI may be a little smarter but less stable. By the default, StupidAI will be used, as in previous releases.\n* New battle AI module: \"BattleAI\" that is smarter and capable of casting some offensive and enchantment spells\n\n## 0.88 -> 0.89 (Jun 01 2012)\n\n### GENERAL\n\n* Mostly implemented Commanders feature (missing level-up dialog)\n* Support for stack artifacts\n* New creature window graphics contributed by fishkebab\n* Config file may have multiple upgrades for creatures\n* CTRL+T will open marketplace window\n* G will open thieves guild window if player owns at least one town with tavern\n* Implemented restart functionality. CTRL+R will trigger a quick restart\n* Save game screen and returning to main menu will work if game was started with --start option\n* Simple mechanism for detecting game desynchronization after init\n* 1280x800 resolution graphics, contributed by Topas\n\n### ADVENTURE MAP\n\n* Fixed monsters regenerating casualties from battle at the start of new week.\n* T in adventure map will switch to next town\n\n### BATTLES\n\n* It's possible to switch active creature during tacts phase by clicking on stack\n* After battle artifacts of the defeated hero (and his army) will be taken by winner\n* Rewritten handling of battle obstacles. They will be now placed following H3 algorithm.\n* Fixed crash when death stare or acid breath activated on stack that was just killed\n* First aid tent can heal only creatures that suffered damage\n* War machines can't be healed by tent\n* Creatures casting spells won't try to cast them during tactic phase\n* Console tooltips for first aid tent\n* Console tooltips for teleport spell\n* Cursor is reset to pointer when action is requested\n* Fixed a few other missing or wrong tooltips/cursors\n* Implemented opening creature window by l-clicking on stack\n* Fixed crash on attacking walls with Cyclop Kings\n* Fixed and simplified Teleport casting\n* Fixed Remove Obstacle spell\n* New spells supported:\n  * Chain Lightning\n  * Fire Wall\n  * Force Field\n  * Land Mine\n  * Quicksands\n  * Sacrifice\n\n### TOWNS\n\n* T in castle window will open a tavern window (if available)\n\n### PREGAME\n\n* Pregame will use same resolution as main game\n* Support for scaling background image\n* Customization of graphics with config file.\n\n### ADVENTURE AI\n\n* basic rule system for threat evaluation\n* new town development logic\n* AI can now use external dwellings\n* AI will weekly revisit dwellings & mills\n* AI will now always pick best stacks from towns\n* AI will recruit multiple heroes for exploration\n* AI won't try attacking its own heroes\n\n## 0.87 -> 0.88 (Mar 01 2012)\n\n* added an initial version of new adventure AI: VCAI\n* system settings window allows to change default resolution\n* introduced unified JSON-based settings system\n* fixed all known localization issues\n* Creature Window can handle descriptions of spellcasting abilities\n* Support for the clone spell\n\n## 0.86 -> 0.87 (Dec 01 2011)\n\n### GENERAL\n\n* Pathfinder can find way using ships and subterranean gates\n* Hero reminder & sleep button\n\n### PREGAME\n\n* Credits are implemented\n\n### BATTLES\n\n* All attacked hexes will be highlighted\n* New combat abilities supported:\n  * Spell Resistance aura\n  * Random spellcaster (Genies)\n  * Mana channeling\n  * Daemon summoning\n  * Spellcaster (Archangel Ogre Mage, Elementals, Faerie Dragon)\n  * Fear\n  * Fearless\n  * No wall penalty\n  * Enchanter\n  * Bind\n  * Dispel helpful spells\n\n## 0.85 -> 0.86 (Sep 01 2011)\n\n### GENERAL\n\n* Reinstated music support\n* Bonus system optimizations (caching)\n* converted many config files to JSON\n* .tga file support\n* New artifacts supported\n  * Admiral's Hat\n  * Statue of Legion\n  * Titan's Thunder\n\n### BATTLES\n\n* Correct handling of siege obstacles\n* Catapult animation\n* New combat abilities supported\n  * Dragon Breath\n  * Three-headed Attack\n  * Attack all around\n  * Death Cloud / Fireball area attack\n  * Death Blow\n  * Lightning Strike\n  * Rebirth\n* New WoG abilities supported\n  * Defense Bonus\n  * Cast before attack\n  * Immunity to direct damage spells\n* New spells supported\n  * Magic Mirror\n  * Titan's Lightning Bolt\n\n## 0.84 -> 0.85 (Jun 01 2011)\n\n### GENERAL\n\n* Support for stack experience\n* Implemented original campaign selection screens\n* New artifacts supported:\n  * Statesman's Medal\n  * Diplomat's Ring\n  * Ambassador's Sash\n\n### TOWNS\n\n* Implemented animation for new town buildings\n* It's possible to sell artifacts at Artifact Merchants\n\n### BATTLES\n\n* Neutral monsters will be split into multiple stacks\n* Hero can surrender battle to keep army\n* Support for Death Stare, Support for Poison, Age, Disease, Acid Breath, Fire / Water / Earth / Air immunities and Receptiveness\n* Partial support for Stone Gaze, Paralyze, Mana drain\n\n## 0.83 -> 0.84 (Mar 01 2011)\n\n### GENERAL\n\n* Bonus system has been rewritten\n* Partial support for running VCMI in duel mode (no adventure map, only one battle, ATM only AI-AI battles)\n* New artifacts supported:\n  * Angellic Alliance\n  * Bird of Perception\n  * Emblem of Cognizance\n  * Spell Scroll\n  * Stoic Watchman\n\n### BATTLES\n\n* Better animations handling\n* Defensive stance is supported\n\n### HERO\n\n* New secondary skills supported:\n  * Artillery\n  * Eagle Eye\n  * Tactics\n\n### AI PLAYER\n\n* new AI leading neutral creatures in combat, slightly better then previous\n\n## 0.82 -> 0.83 (Nov 01 2010)\n\n### GENERAL\n\n* Alliances support\n* Week of / Month of events\n* Mostly done pregame for MP games (temporarily only for local clients)\n* Support for 16bpp displays\n* Campaigns:\n  * support for building bonus\n  * moving to next map after victory\n* Town Portal supported\n* Vial of Dragon Blood and Statue of Legion supported\n\n### HERO\n\n* remaining specialities have been implemented\n\n### TOWNS\n\n* town events supported\n* Support for new town structures: Deiety of Fire and Escape Tunnel\n\n### BATTLES\n\n* blocked retreating from castle\n\n## 0.81 -> 0.82 (Aug 01 2010)\n\n### GENERAL\n\n* Some of the starting bonuses in campaigns are supported\n* It's possible to select difficulty level of mission in campaign\n* new cheat codes:\n  * vcmisilmaril - player wins\n  * vcmimelkor - player loses\n\n### ADVENTURE MAP\n\n* Neutral armies growth implemented (10% weekly)\n* Power rating of neutral stacks\n* Favourable Winds reduce sailing cost\n\n### HERO\n\n* Learning secondary skill supported.\n* Most of hero specialities are supported, including:\n  * Creature specialities (progressive, fixed, Sir Mullich)\n  * Spell damage specialities (Deemer), fixed bonus (Ciele)\n  * Secondary skill bonuses\n  * Creature Upgrades (Gelu)\n  * Resource generation\n  * Starting Skill (Adrienne)\n\n### TOWNS\n\n* Support for new town structures:\n  * Artifact Merchant\n  * Aurora Borealis\n  * Castle Gates\n  * Magic University\n  * Portal of Summoning\n  * Skeleton transformer\n  * Veil of Darkness\n\n### OBJECTS\n\n* Stables will now upgrade Cavaliers to Champions.\n* New object supported:\n  * Abandoned Mine\n  * Altar of Sacrifice\n  * Black Market\n  * Cover of Darkness\n  * Hill Fort\n  * Refugee Camp\n  * Sanctuary\n  * Tavern\n  * University\n  * Whirlpool\n\n## 0.8 -> 0.81 (Jun 01 2010)\n\n### GENERAL\n\n* It's possible to start campaign\n* Support for build grail victory condition\n* New artifacts supported:\n  * Angel's Wings\n  * Boots of levitation\n  * Orb of Vulnerability\n  * Ammo cart\n  * Golden Bow\n  * Hourglass of Evil Hour\n  * Bow of Sharpshooter\n  * Armor of the Damned\n\n### ADVENTURE MAP\n\n* Creatures now guard surrounding tiles\n* New adventura map spells supported:\n  * Summon Boat\n  * Scuttle Boat\n  * Dimension Door\n  * Fly\n  * Water walk\n\n### BATTLES\n\n* A number of new creature abilities supported\n* First Aid Tent is functional\n* Support for distance/wall/melee penalties & no * penalty abilities\n* Reworked damage calculation to fit OH3 formula better\n* Luck support\n* Teleportation spell\n\n### HERO\n\n* First Aid secondary skill\n* Improved formula for necromancy to match better OH3\n\n### TOWNS\n\n* Sending resources to other players by marketplace\n* Support for new town structures:\n  * Lighthouse\n  * Colossus\n  * Freelancer's Guild\n  * Guardian Spirit\n  * Necromancy Amplifier\n  * Soul Prison\n\n### OBJECTS\n\n* New object supported:\n  * Freelancer's Guild\n  * Trading Post\n  * War Machine Factory\n\n## 0.75 -> 0.8 (Mar 01 2010)\n\n### GENERAL\n\n* Victory and loss conditions are supported. It's now possible to win or lose the game.\n* Implemented assembling and disassembling of combination artifacts.\n* Kingdom Overview screen is now available.\n* Implemented Grail (puzzle map, digging, constructing ultimate building)\n* Replaced TTF fonts with original ones.\n\n### ADVENTURE MAP\n\n* Implemented rivers animations (thx to GrayFace).\n\n### BATTLES\n\n* Fire Shield spell (and creature ability) supported\n* affecting morale/luck and casting spell after attack creature abilities supported\n\n### HERO\n\n* Implementation of Scholar secondary skill\n\n### TOWN\n\n* New left-bottom info panel functionalities.\n\n### TOWNS\n\n* new town structures supported:\n  * Ballista Yard\n  * Blood Obelisk\n  * Brimstone Clouds\n  * Dwarven Treasury\n  * Fountain of Fortune\n  * Glyphs of Fear\n  * Mystic Pond\n  * Thieves Guild\n  * Special Grail functionalities for Dungeon, Stronghold and Fortress\n\n### OBJECTS\n\n* New objects supported:\n  * Border gate\n  * Den of Thieves\n  * Lighthouse\n  * Obelisk\n  * Quest Guard\n  * Seer hut\n\nA lot of of various bugfixes and improvements:\n<http://bugs.vcmi.eu/changelog_page.php?version_id=14>\n\n## 0.74 -> 0.75 (Dec 01 2009)\n\n### GENERAL\n\n* Implemented \"main menu\" in-game option.\n* Hide the mouse cursor while displaying a popup window.\n* Better handling of huge and empty message boxes (still needs more changes)\n* Fixed several crashes when exiting.\n\n### ADVENTURE INTERFACE\n\n* Movement cursor shown for unguarded enemy towns.\n* Battle cursor shown for guarded enemy garrisons.\n* Clicking on the border no longer opens an empty info windows\n\n### HERO WINDOW\n\n* Improved artifact moving. Available slots are highlighted. Moved artifact is bound to mouse cursor.\n\n### TOWNS\n\n* new special town structures supported:\n  * Academy of Battle Scholars\n  * Cage of Warlords\n  * Mana Vortex\n  * Stables\n  * Skyship (revealing entire map only)\n\n### OBJECTS\n\n* External dwellings increase town growth\n* Right-click info window for castles and garrisons you do not own shows a rough amount of creatures instead of none\n* Scholar won't give unavailable spells anymore.\n\nA lot of of various bugfixes and improvements:\n<http://bugs.vcmi.eu/changelog_page.php?version_id=2>\n\n## 0.73 -> 0.74 (Oct 01 2009)\n\n### GENERAL\n\n* Scenario Information window\n* Save Game window\n* VCMI window should start centered\n* support for Necromancy and Ballistics secondary skills\n* new artifacts supported, including those improving Necromancy, Legion Statue parts, Shackles of War and most of combination artifacts (but not combining)\n* VCMI client has its own icon (thx for graphic to Dikamilo)\n* Ellipsis won't be split when breaking text on several lines\n* split button will be grayed out when no creature is selected\n* fixed issue when splitting stack to the hero with only one creatures\n* a few fixes for shipyard window\n\n### ADVENTURE INTERFACE\n\n* Cursor shows if tile is accessible and how many turns away\n* moving hero with arrow keys / numpad\n* fixed Next Hero button behaviour\n* fixed Surface/Underground switch button in higher resolutions\n\n### BATTLES\n\n* partial siege support\n* new stack queue for higher resolutions (graphics made by Dru, thx!)\n* 'Q' pressing toggles the stack queue displaying (so it can be enabled/disabled it with single key press)\n* more creatures special abilities supported\n* battle settings will be stored\n* fixed crashes occurring on attacking two hex creatures from back\n* fixed crash when clicking on enemy stack without moving mouse just after receiving action\n* even large stack numbers will fit the boxes\n* when active stack is killed by spell, game behaves properly\n* shooters attacking twice (like Grand Elves) won't attack twice in melee\n* ballista can shoot even if there's an enemy creature next to it\n* improved obstacles placement, so they'll better fit hexes (thx to Ivan!)\n* selecting attack directions works as in H3\n* estimating damage that will be dealt while choosing stack to be attacked\n* modified the positioning of battle effects, they should look about right now.\n* after selecting a spell during combat, l-click is locked for any action other than casting.\n* flying creatures will be blitted over all other creatures, obstacles and wall\n* obstacles and units should be printed in better order (not tested)\n* fixed armageddon animation\n* new spells supported:\n  * Anti-Magic\n  * Cure\n  * Resurrection\n  * Animate Dead\n  * Counterstrike\n  * Berserk\n  * Hypnotize\n  * Blind\n  * Fire Elemental\n  * Earth Elemental\n  * Water Elemental\n  * Air Elemental\n  * Remove obstacle\n\n### TOWNS\n\n* enemy castle can be taken over\n* only one capitol per player allowed (additional ones will be lost)\n* garrisoned hero can buy a spellbook\n* heroes available in tavern should be always different\n* ship bought in town will be correctly placed\n* new special town structures supported:\n  * Lookout Tower\n  * Temple of Valhalla\n  * Wall of Knowledge\n  * Order of Fire\n\n### HERO WINDOW\n\n* war machines cannot be unequiped\n\n### PREGAME\n\n* sorting: a second click on the column header sorts in descending order.\n* advanced options tab: r-click popups for selected town, hero and bonus\n* starting scenario / game by double click\n* arrows in options tab are hidden when not available\n* subtitles for chosen hero/town/bonus in pregame\n\n### OBJECTS\n\n* fixed pairing Subterranean Gates\n* New objects supported:\n  * Borderguard & Keymaster Tent\n  * Cartographer\n  * Creature banks\n  * Eye of the Magi & Hut of the Magi\n  * Garrison\n  * Stables\n  * Pandora Box\n  * Pyramid\n\n## 0.72 -> 0.73 (Aug 01 2009)\n\n### GENERAL\n\n* infowindow popup will be completely on screen\n* fixed possible crash with in game console\n* fixed crash when gaining artifact after r-click on hero in tavern\n* Estates / hero bonuses won't give resources on first day.\n* video handling (intro, main menu animation, tavern animation, spellbook animation, battle result window)\n* hero meeting window allowing exchanging armies and artifacts between heroes on adventure map\n* 'T' hotkey opens marketplace window\n* giving starting spells for heroes\n* pressing enter or escape close spellbook\n* removed redundant quotation marks from skills description and artifact events texts\n* disabled autosaving on first turn\n* bonuses from bonus artifacts\n* increased char per line limit for subtitles under components\n* corrected some exp/level values\n* primary skills cannot be negative\n* support for new artifacts: Ring of Vitality, Ring of Life, Vial of Lifeblood, Garniture of Interference, Surcoat of Counterpoise, Boots of Polarity\n* fixed timed events reappearing\n* saving system options\n* saving hero direction\n* r-click popups on enemy heroes and towns\n* hero leveling formula matches the H3\n\n### ADVENTURE INTERFACE\n\n* Garrisoning, then removing hero from garrison move him at the end of the heroes list\n* The size of the frame around the map depends on the screen size.\n* spellbook shows adventure spells when opened on adventure map\n* erasing path after picking objects with last movement point\n\n### BATTLES\n\n* spell resistance supported (secondary skill, artifacts, creature skill)\n* corrected damage inflicted by spells and ballista\n* added some missing projectile infos\n* added native terrain bonuses in battles\n* number of units in stack in battle should better fit the box\n* non-living and undead creatures have now always 0 morale\n* displaying luck effect animation\n* support for battleground overlays:\n  * cursed ground\n  * magic plains\n  * fiery fields\n  * rock lands\n  * magic clouds\n  * lucid pools\n  * holy ground\n  * clover field\n  * evil fog\n\n### TOWNS\n\n* fixes for horde buildings\n* garrisoned hero can buy a spellbook if he is selected or if there is no visiting hero\n* capitol bar in town hall is grey (not red) if already one exists\n* fixed crash on entering hall when town was near map edge\n\n### HERO WINDOW\n\n* garrisoned heroes won't be shown on the list\n* artifacts will be present on morale/luck bonuses list\n\n### PREGAME\n\n* saves are sorted primary by map format, secondary by name\n* fixed displaying date of saved game (uses local time, removed square character)\n\n### OBJECTS\n\n* Fixed primary/secondary skill levels given by a scholar.\n* fixed problems with 3-tiles monoliths\n* fixed crash with flaggable building next to map edge\n* fixed some descriptions for events\n* New objects supported:\n  * Buoy\n  * Creature Generators\n  * Flotsam\n  * Mermaid\n  * Ocean bottle\n  * Sea Chest\n  * Shipwreck Survivor\n  * Shipyard\n  * Sirens\n\n## 0.71 -> 0.72 (Jun 1 2009)\n\n### GENERAL\n\n* many sound effects and music\n* autosave (to 5 subsequent files)\n* artifacts support (most of them)\n* added internal game console (activated on TAB)\n* fixed 8 hero limit to check only for wandering heroes (not garrisoned)\n* improved randomization\n* fixed crash on closing application\n* VCMI won't always give all three stacks in the starting armies\n* fix for drawing starting army creatures count\n* Diplomacy secondary skill support\n* timed events won't cause resources amount to be negative\n* support for sorcery secondary skill\n* redundant quotation marks from artifact descriptions are removed\n* no income at the first day\n\n### ADVENTURE INTERFACE\n\n* fixed crasbug occurring on revisiting objects (by pressing space)\n* always restoring default cursor when movng mouse out of the terrain\n* fixed map scrolling with ctrl+arrows when some windows are opened\n* clicking scrolling arrows in town/hero list won't open town/hero window\n* pathfinder will now look for a path going via printed positions of roads when it's possible\n* enter can be used to open window with selected hero/town\n\n### BATTLES\n\n* many creatures special skills implemented\n* battle will end when one side has only war machines\n* fixed some problems with handling obstacles info\n* fixed bug with defending / waiting while no stack is active\n* spellbook button is inactive when hero cannot cast any spell\n* obstacles will be placed more properly when resolution is different than 800x600\n* canceling of casting a spell by pressing Escape or R-click (R-click on a creatures does not cancel a spell)\n* spellbook cannot be opened by L-click on hero in battle when it shouldn't be possible\n* new spells:\n  * frost ring\n  * fireball\n  * inferno\n  * meteor shower\n  * death ripple\n  * destroy undead\n  * dispel\n  * armageddon\n  * disrupting ray\n  * protection from air\n  * protection from fire\n  * protection from water\n  * protection from earth\n  * precision\n  * slayer\n\n### TOWNS\n\n* resting in town with mage guild will replenih all the mana points\n* fixed Blacksmith\n* the number of creatures at the beginning of game is their base growth\n* it's possible to enter Tavern via Brotherhood of Sword\n\n### HERO WINDOW\n\n* fixed mana limit info in the hero window\n* war machines can't be removed\n* fixed problems with removing artifacts when all visible slots in backpack are full\n\n### PREGAME\n\n* clicking on \"advanced options\" a second time now closes the tab instead of refreshing it.\n* Fix position of maps names.\n* Made the slider cursor much more responsive. Speedup the map select screen.\n* Try to behave when no maps/saves are present.\n* Page Up / Page Down / Home / End hotkeys for scrolling through scenarios / games list\n\n### OBJECTS\n\n* Neutral creatures can join or escape depending on hero strength (escape formula needs to be improved)\n* leaving guardians in flagged mines.\n* support for Scholar object\n* support for School of Magic\n* support for School of War\n* support for Pillar of Fire\n* support for Corpse\n* support for Lean To\n* support for Wagon\n* support for Warrior's Tomb\n* support for Event\n* Corpse (Skeleton) will be accessible from all directions\n\n## 0.7 -> 0.71 (Apr 01 2009)\n\n### GENERAL\n\n* fixed scrolling behind window problem (now it's possible to scroll with CTRL + arrows)\n* morale/luck system and corresponding sec. skills supported\n* fixed crash when hero get level and has less than two sec. skills to choose between\n* added keybindings for components in selection window (eg. for treasure chest dialog): 1, 2, and so on. Selection dialog can be closed with Enter key\n* proper handling of custom portraits of heroes\n* fixed problems with non-hero/town defs not present in def list but present on map (occurring probably only in case of def substitution in map editor)\n* fixed crash when there was no hero available to hire for some player\n* fixed problems with 1024x600 screen resolution\n* updating blockmap/visitmap of randomized objects\n* fixed crashes on loading maps with flag all mines/dwelling victory condition\n* further fixes for leveling-up (stability and identical offered skills bug)\n* splitting window allows to rebalance two stack with the same creatures\n* support for numpad keyboard\n* support for timed events\n\n### ADVENTURE INTERFACE\n\n* added \"Next hero\" button functionality\n* added missing path arrows\n* corrected centering on hero's position\n* recalculating hero path after reselecting hero\n* further changes in pathfinder making it more like original one\n* orientation of hero can't be change if movement points are exhausted\n* campfire, borderguard, bordergate, questguard will be accessible from the top\n* new movement cost calculation algorithm\n* fixed sight radious calculation\n* it's possible to stop hero movement\n* faster minimap refreshing\n* provisional support for \"Save\" button in System Options Window\n* it's possible to revisit object under hero by pressing Space\n\n### BATTLES\n\n* partial support for battle obstacles\n* only one spell can be casted per turn\n* blocked opening sepllbook if hero doesn't have a one\n* spells not known by hero can't be casted\n* spell books won't be placed in War Machine slots after battle\n* attack is now possible when hex under cursor is not displayed\n* glowing effect of yellow border around creatures\n* blue glowing border around hovered creature\n* made animation on battlefield more smooth\n* standing stacks have more static animation\n* probably fixed problem with displaying corpses on battlefield\n* fixes for two-hex creatures actions\n* fixed hero casting spell animation\n* corrected stack death animation\n* battle settings will be remembered between battles\n* improved damage calculation formula\n* correct handling of flying creatures in battles\n* a few tweaks in battle path/available hexes calculation (more of them is needed)\n* amounts of units taking actions / being an object of actions won't be shown until action ends\n* fixed positions of stack queue and battle result window when resolution is != 800x600\n* corrected duration of frenzy spell which was incorrect in certain cases\n* corrected hero spell casting animation\n* better support for battle backgrounds\n* blocked \"save\" command during battle\n* spellbook displays only spells known by Hero\n* New spells supported:\n  * Mirth\n  * Sorrow\n  * Fortune\n  * Misfortune\n\n### TOWN INTERFACE\n\n* cannot build more than one capitol\n* cannot build shipyard if town is not near water\n* Rampart's Treasury requires Miner's Guild\n* minor improvements in Recruitment Window\n* fixed crash occurring when clicking on hero portrait in Tavern Window, minor improvements for Tavern Window\n* proper updating resdatabar after building structure in town or buying creatures (non 800x600 res)\n* fixed blinking resdatabar in town screen when buying (800x600)\n* fixed horde buildings displaying in town hall\n* forbidden buildings will be shown as forbidden, even if there are no res / other conditions are not fulfilled\n\n### PREGAME\n\n* added scrolling scenario list with mouse wheel\n* fixed mouse slow downs\n* cannot select heroes for computer player (pregame)\n* no crash if uses gives wrong resolution ID number\n* minor fixes\n\n### OBJECTS\n\n* windmill gives 500 gold only during first week ever (not every month)\n* After the first visit to the Witch Hut, right-click/hover tip mentions the skill available.\n* New objects supported:\n  * Prison\n  * Magic Well\n  * Faerie Ring\n  * Swan Pond\n  * Idol of Fortune\n  * Fountain of Fortune\n  * Rally Flag\n  * Oasis\n  * Temple\n  * Watering Hole\n  * Fountain of Youth\n  * support for Redwood Observatory\n  * support for Shrine of Magic Incantation / Gesture / Thought\n  * support for Sign / Ocean Bottle\n\n### AI PLAYER\n\n* Minor improvements and fixes.\n\n## 0.64 -> 0.7 (Feb 01 2009)\n\n### GENERAL\n\n* move some settings to the config/settings.txt file\n* partial support for new screen resolutions\n* it's possible to set game resolution in pregame (type 'resolution' in the console)\n* /Data and /Sprites subfolders can be used for adding files not present in .lod archives\n* fixed crashbug occurring when hero levelled above 15 level\n* support for non-standard screen resolutions\n* F4 toggles between full-screen and windowed mode\n* minor improvements in creature card window\n* splitting stacks with the shift+click\n* creature card window contains info about modified speed\n\n### ADVENTURE INTERFACE\n\n* added water animation\n* speed of scrolling map and hero movement can be adjusted in the System Options Window\n* partial handling r-clicks on adventure map\n\n### TOWN INTERFACE\n\n* the scroll tab won't remain hanged to our mouse position if we move the mouse is away from the scroll bar\n* fixed cloning creatures bug in garrisons (and related issues)\n\n### BATTLES\n\n* support for the Wait command\n* magic arrow *really* works\n* war machines support partially added\n* queue of stacks narrowed\n* spell effect animation displaying improvements\n* positive/negative spells cannot be cast on hostile/our stacks\n* showing spell effects affecting stack in creature info window\n* more appropriate coloring of stack amount box when stack is affected by a spell\n* battle console displays notifications about wait/defend commands\n* several reported bugs fixed\n* new spells supported:\n  * Haste\n  * lightning bolt\n  * ice bolt\n  * slow\n  * implosion\n  * forgetfulness\n  * shield\n  * air shield\n  * bless\n  * curse\n  * bloodlust\n  * weakness\n  * stone skin\n  * prayer\n  * frenzy\n\n### AI PLAYER\n\n* Genius AI (first VCMI AI) will control computer creatures during the combat.\n\n### OBJECTS\n\n* Guardians property for resources is handled\n* support for Witch Hut\n* support for Arena\n* support for Library of Enlightenment\n\nAnd a lot of minor fixes\n\n## 0.63 -> 0.64 (Nov 01 2008)\n\n### GENERAL\n\n* sprites from /Sprites folder are handled correctly\n* several fixes for pathfinder and path arrows\n* better handling disposed/predefined heroes\n* heroes regain 1 mana point each turn\n* support for mistycisim and intelligence skills\n* hero hiring possible\n* added support for a number of hotkeys\n* it's not possible anymore to leave hero level-up window without selecting secondary skill\n* many minor improvements\n\n* Added some kind of simple chatting functionality through console. Implemented several WoG cheats equivalents:\n  * woggaladriel -> vcmiainur\n  * wogoliphaunt -> vcminoldor\n  * wogshadowfax -> vcminahar\n  * wogeyeofsauron -> vcmieagles\n  * wogisengard -> vcmiformenos\n  * wogsaruman -> vcmiistari\n  * wogpathofthedead -> vcmiangband\n  * woggandalfwhite -> vcmiglorfindel\n\n### ADVENTURE INTERFACE\n\n* clicking on a tile in advmap view when a path is shown will not only hide it but also calculate a new one\n* slowed map scrolling\n* blocked scrolling adventure map with mouse when left ctrl is pressed\n* blocked map scrolling when dialog window is opened\n* scholar will be accessible from the top\n\n### TOWN INTERFACE\n\n* partially done tavern window (only hero hiring functionality)\n\n### BATTLES\n\n* water elemental will really be treated as 2 hex creature\n* potential infinite loop in reverseCreature removed\n* better handling of battle cursor\n* fixed blocked shooter behavior\n* it's possible in battles to check remeaining HP of neutral stacks\n* partial support for Magic Arrow spell\n* fixed bug with dying unit\n* stack queue hotkey is now 'Q'\n* added shots limit\n\n## 0.62 -> 0.63 (Oct 01 2008)\n\n### GENERAL\n\n* coloured console output, logging all info to txt files\n* it's possible to use other port than 3030 by passing it as an additional argument\n* removed some redundant warnings\n* partially done spellbook\n* Alt+F4 quits the game\n* some crashbugs was fixed\n* added handling of navigation, logistics, pathfinding, scouting end estates secondary skill\n* magical hero are given spellbook at the beginning\n* added initial secondary skills for heroes\n\n### BATTLES\n\n* very significant optimization of battles\n* battle summary window\n* fixed crashbug occurring sometimes on exiting battle\n* confirm window is shown before retreat\n* graphic stack queue in battle (shows when 'c' key is pressed)\n* it's possible to attack enemy hero\n* neutral monster army disappears when defeated\n* casualties among hero army and neutral creatures are saved\n* better animation handling in battles\n* directional attack in battles\n* mostly done battle options (although they're not saved)\n* added receiving exp (and leveling-up) after a won battle\n* added support for archery, offence and armourer secondary abilities\n* hero's primary skills accounted for damage dealt by creatures in battle\n\n### TOWNS\n\n* mostly done marketplace\n* fixed crashbug with battles on swamps and rough terrain\n* counterattacks\n* heroes can learn new spells in towns\n* working resource silo\n* fixed bug with the mage guild when no spells available\n* it's possible to build lighthouse\n\n### HERO WINDOW\n\n* setting army formation\n* tooltips for artifacts in backpack\n\n### ADVENTURE INTERFACE\n\n* fixed bug with disappearing head of a hero in adventure map\n* some objects are no longer accessible from the top\n* no tooltips for objects under FoW\n* events won't be shown\n* working Subterranean Gates, Monoliths\n* minimap shows all flaggable objects (towns, mines, etc.)\n* artifacts we pick up go to the appropriate slot (if free)\n\n## 0.61 -> 0.62 (Sep 01 2008)\n\n### GENERAL\n\n* restructured to the server-client model\n* support for heroes placed in towns\n* upgrading creatures\n* working gaining levels for heroes (including dialog with skill selection)\n* added graphical cursor\n* showing creature amount in the creature info window\n* giving starting bonus\n\n### CASTLES\n\n* icon in infobox showing that there is hero in town garrison\n* fort/citadel/castle screen\n* taking last stack from the heroes army should be impossible (or at least harder)\n* fixed reading forbidden structures\n* randomizing spells in towns\n* viewing hero window in the town screen\n* possibility of moving hero into the garrison\n* mage guild screen\n* support for blacksmith\n* if hero doesn't have a spell book, he can buy one in a mage guild\n* it's possible to build glyph of fear in fortress\n* creatures placeholders work properly\n\n### ADVENTURE INTERFACE\n\n* hopefully fixed problems with wrong town defs (village/fort/capitol)\n\n### HERO WINDOW\n\n* bugfix: splitting stacks works in hero window\n* removed bug causing significant increase of CPU consumption\n\n### BATTLES\n\n* shooting\n* removed some displaying problems\n* showing last group of frames in creature animation won't crash\n* added start moving and end moving animations\n* fixed moving two-hex creatures\n* showing/hiding graphic cursor\n* a part of using graphic cursor\n* slightly optimized showing of battle interface\n* animation of getting hit / death by shooting is displayed when it should be\n* improved pathfinding in battles, removed problems with displaying movement, adventure map interface won't be called during battles.\n* minor optimizations\n\n### PREGAME\n\n* updates settings when selecting new map after changing sorting criteria\n* if sorting not by name, name will be used as a secondary criteria\n* when filter is applied a first available map is selected automatically\n* slider position updated after sorting in pregame\n\n### OBJECTS\n\n* support for the Tree of knowledge\n* support for Campfires\n* added event message when picking artifact\n\n## 0.6 -> 0.61 (Jun 15 2008)\n\n### IMPROVEMENTS\n\n* improved attacking in the battles\n* it's possible to kill hostile stack\n* animations won't go in the same phase\n* Better pathfinder\n* \"%s\" substitutions in Right-click information in town hall\n* windmill won't give wood\n* hover text for heroes\n* support for ZSoft-style PCX files in /Data\n* Splitting: when moving slider to the right so that 0 is left in old slot the army is moved\n* in the townlist in castle selected town will by placed on the 2nd place (not 3rd)\n* stack at the limit of unit's range can now be attacked\n* range of unit is now properly displayed\n* battle log is scrolled down when new event occurs\n* console is closed when application exits\n\n### BUGFIXES\n\n* stack at the limit of unit's range can now be attacked\n* good background for the town hall screen in Stronghold\n* fixed typo in hall.txt\n* VCMI won't crash when r-click neutral stack during the battle\n* water won't blink behind shipyard in the Castle\n* fixed several memory leaks\n* properly displaying two-hex creatures in recruit/split/info window\n* corrupted map file won't cause crash on initializing main menu\n\n## 0.59 -> 0.6 (Jun 1 2008)\n\n* partially done attacking in battles\n* screen isn't now refreshed while blitting creature info window\n* r-click creature info windows in battles\n* no more division by 0 in slider\n* \"plural\" reference names for Conflux creatures (starting armies of Conflux heroes should now be working)\n* fixed estate problems\n* fixed blinking mana vortex\n* grail increases creature growths\n* new pathfinder\n* several minor improvements\n\n## 0.58 -> 0.59 (May 24 2008 - closed, test release)\n\n* fixed memory leak in battles\n* blitting creature animations to rects in the recruitment window\n* fixed wrong creatures def names\n* better battle pathfinder and unit reversing\n* improved slider ( #58 )\n* fixed problems with horde buildings (won't block original dwellings)\n* giving primary skill when hero get level (but there is still no dialog)\n* if an upgraded creature is available it'll be shown as the first in a recruitment window\n* creature levels not messed in Fortress\n* war machines are added to the hero's inventory, not to the garrison\n* support for H3-style PCX graphics in Data/\n* VCMI won't crash when is unable to initialize audio system\n* fixed displaying wrong town defs\n* improvements in recruitment window (slider won't allow to select more creatures than we can afford)\n* creature info window (only r-click)\n* callback for buttons/lists based on boost::function\n* a lot of minor improvements\n\n## 0.55 -> 0.58 (Apr 20 2008 - closed, test release)\n\n### TOWNS\n\n* recruiting creatures\n* working creature growths (including castle and horde building influences)\n* towns give income\n* town hall screen\n* building buildings (requirements and cost are handled)\n* hints for structures\n* updating town infobox\n\n### GARRISONS\n\n* merging stacks\n* splitting stacks\n\n### BATTLES\n\n* starting battles\n* displaying terrain, animations of heroes, units, grid, range of units, battle menu with console, amounts of units in stacks\n* leaving battle by pressing flee button\n* moving units in battles and displaying their ranges\n* defend command for units\n\n### GENERAL\n\n* a number of minor fixes and improvements\n\n## 0.54 -> 0.55 (Feb 29 2008)\n\n* Sprites/ folder works for h3sprite.lod same as Data/ for h3bitmap.lod (but it's still experimental)\n* randomization quantity of creatures on the map\n* fix of Pandora's Box handling\n* reading disposed/predefined heroes\n* new command - \"get txt\" - VCMI will extract all .txt files from h3bitmap.lod to the Extracted_txts/ folder.\n* more detailed logs\n* reported problems with hero flags resolved\n* heroes cannot occupy the same tile\n* hints for most of creature generators\n* some minor stuff\n\n## 0.53b -> 0.54 (Feb 23 2008 - first public release)\n\n* given hero is placed in the town entrance\n* some objects such as river delta won't be blitted \"on\" hero\n* tiles under FoW are inaccessible\n* giving random hero on RoE maps\n* improved protection against hero duplication\n* fixed starting values of primary abilities of random heroes on RoE/AB maps\n* right click popups with infoboxes for heroes/towns lists\n* new interface coloring (many thanks to GrayFace ;])\n* fixed bug in object flag's coloring\n* added hints in town lists\n* eliminated square from city hints\n\n## 0.53 - 0.53b (Feb 20 2008)\n\n* added giving default buildings in towns\n* town infobox won't crash on empty town\n\n## 0.52 - 0.53 (Feb 18 2008)\n\n* hopefully the last bugfix of Pandora's Box\n* fixed blockmaps of generated heroes\n* disposed hero cannot be chosen in scenario settings (unless he is in prison)\n* fixed town randomization\n* fixed hero randomization\n* fixed displaying heroes in preGame\n* fixed selecting/deselecting artifact slots in hero window\n* much faster pathfinder\n* memory usage and load time significantly decreased\n* it's impossible to select empty artifact slot in hero window\n* fixed problem with FoW displaying on minimap on L-sized maps\n* fixed crashbug in hero list connected with heroes dismissing\n* mostly done town infobox\n* town daily income is properly calculated\n\n## 0.51 - 0.52 (Feb 7 2008)\n\n* [feature] giving starting hero\n* [feature] VCMI will try to use files from /Data folder instead of those from h3bitmap.lod\n* [feature] picked artifacts are added to hero's backpack\n* [feature] possibility of choosing player to play\n* [bugfix] ZELP.TXT file *should* be handled correctly even it is non-english\n* [bugfix] fixed crashbug in reading defs with negative left/right margins\n* [bugfix] improved randomization\n* [bugfix] pathfinder can't be cheated (what caused errors)\n\n## 0.5 - 0.51 (Feb 3 2008)\n\n* close button properly closes (same does 'q' key)\n* two players can't have selected same hero\n* double click on \"Show Available Scenarios\" won't reset options\n* fixed possible crashbug in town/hero lists\n* fixed crashbug in initializing game caused by wrong prisons handling\n* fixed crashbug on reading hero's custom artifacts in RoE maps\n* fixed crashbug on reading custom Pandora's Box in RoE maps\n* fixed crashbug on reading blank Quest Guards\n* better console messages\n* map reading speed up (though it's still slow, especially on bigger maps)\n\n## 0.0 -> 0.5 (Feb 2 2008 - first closed release)\n\n* Main menu and New game screens\n* Scenario selection, part of advanced options support\n* Partially done adventure map, town and hero interfaces\n* Moving hero\n* Interactions with several objects (mines, resources, mills, and others)\n"
        },
        {
          "name": "Global.h",
          "type": "blob",
          "size": 22.6767578125,
          "content": "/*\n * Global.h, part of VCMI engine\n *\n * Authors: listed in file AUTHORS in main folder\n *\n * License: GNU General Public License v2.0 or later\n * Full text of license available in license.txt file, in main folder\n *\n */\n#pragma once\n\n/* ---------------------------------------------------------------------------- */\n/* Compiler detection */\n/* ---------------------------------------------------------------------------- */\n// Fixed width bool data type is important for serialization\nstatic_assert(sizeof(bool) == 1, \"Bool needs to be 1 byte in size.\");\n\n/* ---------------------------------------------------------------------------- */\n/* System detection. */\n/* ---------------------------------------------------------------------------- */\n// Based on: http://sourceforge.net/p/predef/wiki/OperatingSystems/\n//\t and on: http://stackoverflow.com/questions/5919996/how-to-detect-reliably-mac-os-x-ios-linux-windows-in-c-preprocessor\n// TODO?: Should be moved to vstd\\os_detect.h (and then included by Global.h)\n#ifdef _WIN16\t\t\t// Defined for 16-bit environments\n#  error \"16-bit Windows isn't supported\"\n#elif defined(_WIN64)\t// Defined for 64-bit environments\n#  define VCMI_WINDOWS\n#  define VCMI_WINDOWS_64\n#elif defined(_WIN32)\t// Defined for both 32-bit and 64-bit environments\n#  define VCMI_WINDOWS\n#  define VCMI_WINDOWS_32\n#elif defined(_WIN32_WCE)\n#  error \"Windows CE isn't supported\"\n#elif defined(__linux__) || defined(__gnu_linux__) || defined(linux) || defined(__linux)\n#  define VCMI_UNIX\n#  define VCMI_XDG\n#  if defined(__ANDROID__) || defined(ANDROID)\n#    define VCMI_ANDROID\n#  endif\n#elif defined(__FreeBSD_kernel__) || defined(__FreeBSD__)\n#  define VCMI_UNIX\n#  define VCMI_XDG\n#  define VCMI_FREEBSD\n#elif defined(__OpenBSD__)\n#  define VCMI_UNIX\n#  define VCMI_XDG\n#  define VCMI_OPENBSD\n#elif defined(__HAIKU__)\n#  define VCMI_UNIX\n#  define VCMI_XDG\n#  define VCMI_HAIKU\n#elif defined(__GNU__) || defined(__gnu_hurd__) || (defined(__MACH__) && !defined(__APPLE__))\n#  define VCMI_UNIX\n#  define VCMI_XDG\n#  define VCMI_HURD\n#elif defined(__APPLE__) && defined(__MACH__)\n#  define VCMI_UNIX\n#  define VCMI_APPLE\n#  include \"TargetConditionals.h\"\n#  if TARGET_OS_SIMULATOR || TARGET_IPHONE_SIMULATOR\n#    define VCMI_IOS\n#    define VCMI_IOS_SIM\n#  elif TARGET_OS_IPHONE\n#    define VCMI_IOS\n#  elif TARGET_OS_MAC\n#    define VCMI_MAC\n#  else\n//#  warning \"Unknown Apple target.\"?\n#  endif\n#else\n#  error \"This platform isn't supported\"\n#endif\n\n#if defined(VCMI_ANDROID) || defined(VCMI_IOS)\n#define VCMI_MOBILE\n#endif\n\n/* ---------------------------------------------------------------------------- */\n/* Commonly used C++, Boost headers */\n/* ---------------------------------------------------------------------------- */\n#ifdef VCMI_WINDOWS\n#  ifndef WIN32_LEAN_AND_MEAN\n#    define WIN32_LEAN_AND_MEAN\t\t // Exclude rarely-used stuff from Windows headers - delete this line if something is missing.\n#  endif\n#  ifndef NOMINMAX\n#    define NOMINMAX\t\t\t\t // Exclude min/max macros from <Windows.h>. Use std::[min/max] from <algorithm> instead.\n#  endif\n#  ifndef _NO_W32_PSEUDO_MODIFIERS\n#    define _NO_W32_PSEUDO_MODIFIERS // Exclude more macros for compiling with MinGW on Linux.\n#  endif\n#endif\n\n/* ---------------------------------------------------------------------------- */\n/* A macro to force inlining some of our functions */\n/* ---------------------------------------------------------------------------- */\n// Compiler (at least MSVC) is not so smart here-> without that displaying is MUCH slower\n#ifdef _MSC_VER\n#  define STRONG_INLINE __forceinline\n#elif __GNUC__\n#  define STRONG_INLINE inline __attribute__((always_inline))\n#else\n#  define STRONG_INLINE inline\n#endif\n\n// Required for building boost::stacktrace on macOS.\n// See https://github.com/boostorg/stacktrace/issues/88\n#if defined(VCMI_APPLE)\n#define _GNU_SOURCE\n#endif\n\n#define _USE_MATH_DEFINES\n\n#include <algorithm>\n#include <any>\n#include <array>\n#include <atomic>\n#include <bitset>\n#include <cassert>\n#include <climits>\n#include <cmath>\n#include <codecvt>\n#include <cstdlib>\n#include <cstdio>\n#include <fstream>\n#include <functional>\n#include <iomanip>\n#include <iostream>\n#include <map>\n#include <memory>\n#include <mutex>\n#include <numeric>\n#include <optional>\n#include <queue>\n#include <random>\n#include <regex>\n#include <set>\n#include <shared_mutex>\n#include <sstream>\n#include <string>\n#include <unordered_map>\n#include <unordered_set>\n#include <utility>\n#include <variant>\n#include <vector>\n\n//The only available version is 3, as of Boost 1.50\n#include <boost/version.hpp>\n\n#define BOOST_FILESYSTEM_VERSION 3\n#if BOOST_VERSION > 105000\n#  define BOOST_THREAD_VERSION 3\n#endif\n#if BOOST_VERSION == 107400\n#  define BOOST_ALLOW_DEPRECATED_HEADERS\n#endif\n#define BOOST_THREAD_DONT_PROVIDE_THREAD_DESTRUCTOR_CALLS_TERMINATE_IF_JOINABLE 1\n//need to link boost thread dynamically to avoid https://stackoverflow.com/questions/35978572/boost-thread-interupt-does-not-work-when-crossing-a-dll-boundary\n//for example VCAI::finish() may freeze on thread join after interrupt when linking this statically\n#ifndef BOOST_THREAD_USE_DLL\n#  define BOOST_THREAD_USE_DLL\n#endif\n#define BOOST_BIND_NO_PLACEHOLDERS\n\n#if BOOST_VERSION >= 106600\n#define BOOST_ASIO_ENABLE_OLD_SERVICES\n#endif\n\n#include <boost/algorithm/hex.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/crc.hpp>\n#include <boost/current_function.hpp>\n#include <boost/container/small_vector.hpp>\n#include <boost/container/static_vector.hpp>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/posix_time/time_formatters.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/format.hpp>\n#include <boost/functional/hash.hpp>\n#include <boost/lexical_cast.hpp>\n#ifdef VCMI_WINDOWS\n#include <boost/locale/generator.hpp>\n#endif\n#include <boost/logic/tribool.hpp>\n#include <boost/multi_array.hpp>\n#include <boost/range/adaptor/filtered.hpp>\n#include <boost/range/adaptor/reversed.hpp>\n#include <boost/range/algorithm.hpp>\n#include <boost/thread/thread_only.hpp>\n#include <boost/thread/shared_mutex.hpp>\n#include <boost/thread/recursive_mutex.hpp>\n#include <boost/thread/once.hpp>\n\n#ifndef M_PI\n#  define M_PI 3.14159265358979323846\n#endif\n\n/* ---------------------------------------------------------------------------- */\n/* Usings */\n/* ---------------------------------------------------------------------------- */\nusing namespace std::placeholders;\nnamespace range = boost::range;\n\n/* ---------------------------------------------------------------------------- */\n/* Typedefs */\n/* ---------------------------------------------------------------------------- */\n// Integral data types\ntypedef uint64_t ui64; //unsigned int 64 bits (8 bytes)\ntypedef uint32_t ui32;  //unsigned int 32 bits (4 bytes)\ntypedef uint16_t ui16; //unsigned int 16 bits (2 bytes)\ntypedef uint8_t ui8; //unsigned int 8 bits (1 byte)\ntypedef int64_t si64; //signed int 64 bits (8 bytes)\ntypedef int32_t si32; //signed int 32 bits (4 bytes)\ntypedef int16_t si16; //signed int 16 bits (2 bytes)\ntypedef int8_t si8; //signed int 8 bits (1 byte)\n\n// Lock typedefs\nusing TLockGuard = std::lock_guard<std::mutex>;\nusing TLockGuardRec = std::lock_guard<std::recursive_mutex>;\n\n/* ---------------------------------------------------------------------------- */\n/* Macros */\n/* ---------------------------------------------------------------------------- */\n// Import + Export macro declarations\n#ifdef VCMI_WINDOWS\n#  ifdef VCMI_DLL_STATIC\n#    define DLL_IMPORT\n#    define DLL_EXPORT\n#  elif defined(__GNUC__)\n#    define DLL_IMPORT __attribute__((dllimport))\n#    define DLL_EXPORT __attribute__((dllexport))\n#  else\n#    define DLL_IMPORT __declspec(dllimport)\n#    define DLL_EXPORT __declspec(dllexport)\n#  endif\n#  define ELF_VISIBILITY\n#else\n#  ifdef __GNUC__\n#    define DLL_IMPORT\t__attribute__ ((visibility(\"default\")))\n#    define DLL_EXPORT __attribute__ ((visibility(\"default\")))\n#    define ELF_VISIBILITY __attribute__ ((visibility(\"default\")))\n#  endif\n#endif\n\n#ifdef VCMI_DLL\n#  define DLL_LINKAGE DLL_EXPORT\n#else\n#  define DLL_LINKAGE DLL_IMPORT\n#endif\n\n#define THROW_FORMAT(message, formatting_elems)  throw std::runtime_error(boost::str(boost::format(message) % formatting_elems))\n\n// old iOS SDKs compatibility\n#ifdef VCMI_IOS\n#include <AvailabilityVersions.h>\n\n#ifndef __IPHONE_13_0\n#define __IPHONE_13_0 130000\n#endif\n#endif // VCMI_IOS\n\n// single-process build makes 2 copies of the main lib by wrapping it in a namespace\n#ifdef VCMI_LIB_NAMESPACE\n#define VCMI_LIB_NAMESPACE_BEGIN namespace VCMI_LIB_NAMESPACE {\n#define VCMI_LIB_NAMESPACE_END }\n#define VCMI_LIB_USING_NAMESPACE using namespace VCMI_LIB_NAMESPACE;\n#define VCMI_LIB_WRAP_NAMESPACE(x) VCMI_LIB_NAMESPACE::x\n#else\n#define VCMI_LIB_NAMESPACE_BEGIN\n#define VCMI_LIB_NAMESPACE_END\n#define VCMI_LIB_USING_NAMESPACE\n#define VCMI_LIB_WRAP_NAMESPACE(x) ::x\n#endif\n\n/* ---------------------------------------------------------------------------- */\n/* VCMI standard library */\n/* ---------------------------------------------------------------------------- */\n#include <vstd/CLoggerBase.h>\n\nVCMI_LIB_NAMESPACE_BEGIN\n\nnamespace vstd\n{\n\t// combine hashes. Present in boost but not in std\n\ttemplate <class T>\n\tinline void hash_combine(std::size_t& seed, const T& v)\n\t{\n\t\tstd::hash<T> hasher;\n\t\tseed ^= hasher(v) + 0x9e3779b9 + (seed<<6) + (seed>>2);\n\t}\n\n\t//returns true if container c contains item i\n\ttemplate <typename Container, typename Item>\n\tbool contains(const Container & c, const Item &i)\n\t{\n\t\treturn std::find(std::begin(c), std::end(c),i) != std::end(c);\n\t}\n\n\t//returns true if container c contains item i\n\ttemplate <typename Container, typename Pred>\n\tbool contains_if(const Container & c, Pred p)\n\t{\n\t\treturn std::find_if(std::begin(c), std::end(c), p) != std::end(c);\n\t}\n\n\t//returns true if map c contains item i\n\ttemplate <typename V, typename Item, typename Item2>\n\tbool contains(const std::map<Item,V> & c, const Item2 &i)\n\t{\n\t\treturn c.find(i)!=c.end();\n\t}\n\n\t//returns true if unordered set c contains item i\n\ttemplate <typename Item>\n\tbool contains(const std::unordered_set<Item> & c, const Item &i)\n\t{\n\t\treturn c.find(i)!=c.end();\n\t}\n\n\ttemplate <typename V, typename Item, typename Item2>\n\tbool contains(const std::unordered_map<Item,V> & c, const Item2 &i)\n\t{\n\t\treturn c.find(i)!=c.end();\n\t}\n\n\t//returns position of first element in vector c equal to s, if there is no such element, -1 is returned\n\ttemplate <typename Container, typename T2>\n\tint find_pos(const Container & c, const T2 &s)\n\t{\n\t\tint i=0;\n\t\tfor (auto iter = std::begin(c); iter != std::end(c); iter++, i++)\n\t\t\tif(*iter == s)\n\t\t\t\treturn i;\n\t\treturn -1;\n\t}\n\n\t//Func f tells if element matches\n\ttemplate <typename Container, typename Func>\n\tint find_pos_if(const Container & c, const Func &f)\n\t{\n\t\tauto ret = boost::range::find_if(c, f);\n\t\tif(ret != std::end(c))\n\t\t\treturn std::distance(std::begin(c), ret);\n\n\t\treturn -1;\n\t}\n\n\t//returns iterator to the given element if present in container, end() if not\n\ttemplate <typename Container, typename Item>\n\ttypename Container::iterator find(Container & c, const Item &i)\n\t{\n\t\treturn std::find(c.begin(),c.end(),i);\n\t}\n\n\t//returns const iterator to the given element if present in container, end() if not\n\ttemplate <typename Container, typename Item>\n\ttypename Container::const_iterator find(const Container & c, const Item &i)\n\t{\n\t\treturn std::find(c.begin(),c.end(),i);\n\t}\n\n\t// returns existing value from map, or default value if key does not exists\n\ttemplate <typename Map>\n\tconst typename Map::mapped_type & find_or(const Map& m, const typename Map::key_type& key, const typename Map::mapped_type& defaultValue) {\n\t\tauto it = m.find(key);\n\t\tif (it == m.end())\n\t\t\treturn defaultValue;\n\t\treturn it->second;\n\t}\n\n\t// given a map from keys to values, creates a new map from values to keys \n\ttemplate<typename K, typename V>\n\tstatic std::map<V, K> reverseMap(const std::map<K, V>& m) {\n\t\tstd::map<V, K> r;\n \t\tfor (const auto& kv : m)\n\t\t\tr[kv.second] = kv.first;\n\t\treturn r;\n\t}\n\n\t//returns first key that maps to given value if present, returns success via found if provided\n\ttemplate <typename Key, typename T>\n\tKey findKey(const std::map<Key, T> & map, const T & value, bool * found = nullptr)\n\t{\n\t\tfor(auto iter = map.cbegin(); iter != map.cend(); iter++)\n\t\t{\n\t\t\tif(iter->second == value)\n\t\t\t{\n\t\t\t\tif(found)\n\t\t\t\t\t*found = true;\n\t\t\t\treturn iter->first;\n\t\t\t}\n\t\t}\n\t\tif(found)\n\t\t\t*found = false;\n\t\treturn Key();\n\t}\n\n\t//removes element i from container c, returns false if c does not contain i\n\ttemplate <typename Container, typename Item>\n\ttypename Container::size_type operator-=(Container &c, const Item &i)\n\t{\n\t\ttypename Container::iterator itr = find(c,i);\n\t\tif(itr == c.end())\n\t\t\treturn false;\n\t\tc.erase(itr);\n\t\treturn true;\n\t}\n\n\t//assigns greater of (a, b) to a and returns maximum of (a, b)\n\ttemplate <typename t1, typename t2>\n\tt1 &amax(t1 &a, const t2 &b)\n\t{\n\t\tif(a >= (t1)b)\n\t\t\treturn a;\n\t\telse\n\t\t{\n\t\t\ta = t1(b);\n\t\t\treturn a;\n\t\t}\n\t}\n\n\t//assigns smaller of (a, b) to a and returns minimum of (a, b)\n\ttemplate <typename t1, typename t2>\n\tt1 &amin(t1 &a, const t2 &b)\n\t{\n\t\tif(a <= (t1)b)\n\t\t\treturn a;\n\t\telse\n\t\t{\n\t\t\ta = t1(b);\n\t\t\treturn a;\n\t\t}\n\t}\n\n\t//makes a to fit the range <b, c>\n\ttemplate <typename T>\n\tvoid abetween(T &value, const T &min, const T &max)\n\t{\n\t\tvalue = std::clamp(value, min, max);\n\t}\n\n\t//checks if a is between b and c\n\ttemplate <typename t1, typename t2, typename t3>\n\tbool isbetween(const t1 &value, const t2 &min, const t3 &max)\n\t{\n\t\treturn value > (t1)min && value < (t1)max;\n\t}\n\n\t//checks if a is within b and c\n\ttemplate <typename t1, typename t2, typename t3>\n\tbool iswithin(const t1 &value, const t2 &min, const t3 &max)\n\t{\n\t\treturn value >= (t1)min && value <= (t1)max;\n\t}\n\n\ttemplate <typename t1, typename t2>\n\tstruct assigner\n\t{\n\tpublic:\n\t\tt1 &op1;\n\t\tt2 op2;\n\t\tassigner(t1 &a1, const t2 & a2)\n\t\t\t:op1(a1), op2(a2)\n\t\t{}\n\t\tvoid operator()()\n\t\t{\n\t\t\top1 = op2;\n\t\t}\n\t};\n\n\t//deleted pointer and sets it to nullptr\n\ttemplate <typename T>\n\tvoid clear_pointer(T* &ptr)\n\t{\n\t\tdelete ptr;\n\t\tptr = nullptr;\n\t}\n\n\ttemplate <typename Container>\n\ttypename Container::const_reference circularAt(const Container &r, size_t index)\n\t{\n\t\tassert(r.size());\n\t\tindex %= r.size();\n\t\tauto itr = std::begin(r);\n\t\tstd::advance(itr, index);\n\t\treturn *itr;\n\t}\n\n\ttemplate <typename Container, typename Item>\n\tvoid erase(Container &c, const Item &item)\n\t{\n\t\tc.erase(boost::remove(c, item), c.end());\n\t}\n\n\ttemplate<typename Range, typename Predicate>\n\tvoid erase_if(Range &vec, Predicate pred)\n\t{\n\t\tvec.erase(boost::remove_if(vec, pred),vec.end());\n\t}\n\n\ttemplate<typename Elem, typename Predicate>\n\tvoid erase_if(std::set<Elem> &setContainer, Predicate pred)\n\t{\n\t\tauto itr = setContainer.begin();\n\t\tauto endItr = setContainer.end();\n\t\twhile(itr != endItr)\n\t\t{\n\t\t\tauto tmpItr = itr++;\n\t\t\tif(pred(*tmpItr))\n\t\t\t\tsetContainer.erase(tmpItr);\n\t\t}\n\t}\n\n\ttemplate<typename Elem, typename Predicate>\n\tvoid erase_if(std::unordered_set<Elem> &setContainer, Predicate pred)\n\t{\n\t\tauto itr = setContainer.begin();\n\t\tauto endItr = setContainer.end();\n\t\twhile(itr != endItr)\n\t\t{\n\t\t\tauto tmpItr = itr++;\n\t\t\tif(pred(*tmpItr))\n\t\t\t\tsetContainer.erase(tmpItr);\n\t\t}\n\t}\n\n\t//works for map and std::map, maybe something else\n\ttemplate<typename Key, typename Val, typename Predicate>\n\tvoid erase_if(std::map<Key, Val> &container, Predicate pred)\n\t{\n\t\tauto itr = container.begin();\n\t\tauto endItr = container.end();\n\t\twhile(itr != endItr)\n\t\t{\n\t\t\tauto tmpItr = itr++;\n\t\t\tif(pred(*tmpItr))\n\t\t\t\tcontainer.erase(tmpItr);\n\t\t}\n\t}\n\n\t//works for std::unordered_map, maybe something else\n\ttemplate<typename Key, typename Val, typename Predicate>\n\tvoid erase_if(std::unordered_map<Key, Val> & container, Predicate pred)\n\t{\n\t\tauto itr = container.begin();\n\t\tauto endItr = container.end();\n\t\twhile(itr != endItr)\n\t\t{\n\t\t\tauto tmpItr = itr++;\n\t\t\tif(pred(*tmpItr))\n\t\t\t\tcontainer.erase(tmpItr);\n\t\t}\n\t}\n\n\t// Removes all duplicate elements from the vector\n\ttemplate<typename T>\n\tvoid unique(std::vector<T> &vec)\n\t{\n\t\tstd::sort(vec.begin(), vec.end());\n\t\tauto newEnd = std::unique(vec.begin(), vec.end());\n\t\tvec.erase(newEnd, vec.end());\n\t}\n\n\ttemplate<typename InputRange, typename OutputIterator, typename Predicate>\n\tOutputIterator copy_if(const InputRange &input, OutputIterator result, Predicate pred)\n\t{\n\t\treturn std::copy_if(std::cbegin(input), std::end(input), result, pred);\n\t}\n\n\ttemplate <typename Container>\n\tstd::insert_iterator<Container> set_inserter(Container &c)\n\t{\n\t\treturn std::inserter(c, c.end());\n\t}\n\n\t//Returns iterator to the element for which the value of ValueFunction is minimal\n\ttemplate<class ForwardRange, class ValueFunction>\n\tauto minElementByFun(const ForwardRange& rng, ValueFunction vf) -> decltype(std::begin(rng))\n\t{\n\t\t/* Clang crashes when instantiating this function template and having PCH compilation enabled.\n\t\t * There is a bug report here: http://llvm.org/bugs/show_bug.cgi?id=18744\n\t\t * Current bugfix is to don't use a typedef for decltype(*std::begin(rng)) and to use decltype\n\t\t * directly for both function parameters.\n\t\t */\n\t\treturn boost::min_element(rng, [&] (decltype(*std::begin(rng)) lhs, decltype(*std::begin(rng)) rhs) -> bool\n\t\t{\n\t\t\treturn vf(lhs) < vf(rhs);\n\t\t});\n\t}\n\n\t//Returns iterator to the element for which the value of ValueFunction is maximal\n\ttemplate<class ForwardRange, class ValueFunction>\n\tauto maxElementByFun(const ForwardRange& rng, ValueFunction vf) -> decltype(std::begin(rng))\n\t{\n\t\t/* Clang crashes when instantiating this function template and having PCH compilation enabled.\n\t\t * There is a bug report here: http://llvm.org/bugs/show_bug.cgi?id=18744\n\t\t * Current bugfix is to don't use a typedef for decltype(*std::begin(rng)) and to use decltype\n\t\t * directly for both function parameters.\n\t\t */\n\t\treturn boost::max_element(rng, [&] (decltype(*std::begin(rng)) lhs, decltype(*std::begin(rng)) rhs) -> bool\n\t\t{\n\t\t\treturn vf(lhs) < vf(rhs);\n\t\t});\n\t}\n\n\t/// Increments value by specific delta\n\t/// similar to std::next but works with other types, e.g. enum class\n\ttemplate<typename T>\n\tT next(const T &obj, int change)\n\t{\n\t\treturn static_cast<T>(static_cast<ptrdiff_t>(obj) + change);\n\t}\n\n\ttemplate <typename Container>\n\ttypename Container::value_type backOrNull(const Container &c) //returns last element of container or nullptr if it is empty (to be used with containers of pointers)\n\t{\n\t\tif(c.size())\n\t\t\treturn c.back();\n\t\telse\n\t\t\treturn typename Container::value_type();\n\t}\n\n\ttemplate <typename Container>\n\ttypename Container::value_type frontOrNull(const Container &c) //returns first element of container or nullptr if it is empty (to be used with containers of pointers)\n\t{\n\t\tif(c.size())\n\t\t\treturn c.front();\n\t\telse\n\t\t\treturn nullptr;\n\t}\n\n\ttemplate <typename Container, typename Index>\n\tbool isValidIndex(const Container &c, Index i)\n\t{\n\t\treturn i >= 0  &&  i < c.size();\n\t}\n\n\ttemplate <typename Container>\n\ttypename Container::const_reference atOrDefault(const Container &r, size_t index, const typename Container::const_reference &defaultValue)\n\t{\n\t\tif(index < r.size())\n\t\t\treturn r[index];\n\n\t\treturn defaultValue;\n\t}\n\n\ttemplate <typename Container, typename Item>\n\tbool erase_if_present(Container &c, const Item &item)\n\t{\n\t\tauto i = std::find(c.begin(), c.end(), item);\n\t\tif (i != c.end())\n\t\t{\n\t\t\tc.erase(i);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\ttemplate <typename V, typename Item, typename Item2>\n\tbool erase_if_present(std::map<Item,V> & c, const Item2 &item)\n\t{\n\t\tauto i = c.find(item);\n\t\tif (i != c.end())\n\t\t{\n\t\t\tc.erase(i);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttemplate<typename T>\n\tvoid removeDuplicates(std::vector<T> &vec)\n\t{\n\t\tstd::sort(vec.begin(), vec.end());\n\t\tvec.erase(std::unique(vec.begin(), vec.end()), vec.end());\n\t}\n\n\ttemplate <typename T>\n\tvoid concatenate(std::vector<T> &dest, const std::vector<T> &src)\n\t{\n\t\tdest.reserve(dest.size() + src.size());\n\t\tdest.insert(dest.end(), src.begin(), src.end());\n\t}\n\n\ttemplate <typename T>\n\tstd::vector<T> intersection(std::vector<T> &v1, std::vector<T> &v2)\n\t{\n\t\tstd::vector<T> v3;\n\t\tstd::sort(v1.begin(), v1.end());\n\t\tstd::sort(v2.begin(), v2.end());\n\t\tstd::set_intersection(v1.begin(), v1.end(), v2.begin(), v2.end(), std::back_inserter(v3));\n\t\treturn v3;\n\t}\n\n\ttemplate <typename T>\n\tstd::set<T> difference(const std::set<T> &s1, const std::set<T> s2)\n\t{\n\t\tstd::set<T> s3;\n\t\tstd::set_difference(s1.begin(), s1.end(), s2.begin(), s2.end(), std::inserter(s3, s3.end()));\n\t\treturn s3;\n\t}\n\n\ttemplate <typename Key, typename V>\n\tbool containsMapping(const std::multimap<Key,V> & map, const std::pair<const Key,V> & mapping)\n\t{\n\t\tauto range = map.equal_range(mapping.first);\n\t\tfor(auto contained = range.first; contained != range.second; contained++)\n\t\t{\n\t\t\tif(mapping.second == contained->second)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t//c++20 feature\n\ttemplate<typename Arithmetic, typename Floating>\n\tArithmetic lerp(const Arithmetic & a, const Arithmetic & b, const Floating & f)\n\t{\n\t\treturn a + (b - a) * f;\n\t}\n\n\t/// Divides dividend by divisor and rounds result up\n\t/// For use with integer-only arithmetic\n\ttemplate<typename Integer1, typename Integer2>\n\tInteger1 divideAndCeil(const Integer1 & dividend, const Integer2 & divisor)\n\t{\n\t\tstatic_assert(std::is_integral_v<Integer1> && std::is_integral_v<Integer2>, \"This function should only be used with integral types\");\n\t\treturn (dividend + divisor - 1) / divisor;\n\t}\n\n\t/// Divides dividend by divisor and rounds result to nearest\n\t/// For use with integer-only arithmetic\n\ttemplate<typename Integer1, typename Integer2>\n\tInteger1 divideAndRound(const Integer1 & dividend, const Integer2 & divisor)\n\t{\n\t\tstatic_assert(std::is_integral_v<Integer1> && std::is_integral_v<Integer2>, \"This function should only be used with integral types\");\n\t\treturn (dividend + divisor / 2 - 1) / divisor;\n\t}\n\n\t/// Divides dividend by divisor and rounds result down\n\t/// For use with integer-only arithmetic\n\ttemplate<typename Integer1, typename Integer2>\n\tInteger1 divideAndFloor(const Integer1 & dividend, const Integer2 & divisor)\n\t{\n\t\tstatic_assert(std::is_integral_v<Integer1> && std::is_integral_v<Integer2>, \"This function should only be used with integral types\");\n\t\treturn dividend / divisor;\n\t}\n\n\ttemplate<typename Floating>\n\tbool isAlmostZero(const Floating & value)\n\t{\n\t\tconstexpr Floating epsilon(0.00001);\n\t\treturn std::abs(value) <= epsilon;\n\t}\n\n\ttemplate<typename Floating1, typename Floating2>\n\tbool isAlmostEqual(const Floating1 & left, const Floating2 & right)\n\t{\n\t\tusing Floating = decltype(left + right);\n\t\tconstexpr Floating epsilon(0.00001);\n\t\tconst Floating relativeEpsilon = std::max(std::abs(left), std::abs(right)) * epsilon;\n\t\tconst Floating value = std::abs(left - right);\n\t\treturn value <= relativeEpsilon;\n\t}\n\n\t///compile-time version of std::abs for ints for int3, in clang++15 std::abs is constexpr\n\tstatic constexpr int abs(int i) {\n\t\tif(i < 0) return -i;\n\t\treturn i;\n\t}\n\n\t///C++23\n\ttemplate< class Enum > constexpr std::underlying_type_t<Enum> to_underlying( Enum e ) noexcept\n\t{\n\t\treturn static_cast<std::underlying_type_t<Enum>>(e);\n\t}\n}\nusing vstd::operator-=;\n\nVCMI_LIB_NAMESPACE_END\n"
        },
        {
          "name": "Mods",
          "type": "tree",
          "content": null
        },
        {
          "name": "Version.cpp.in",
          "type": "blob",
          "size": 0.357421875,
          "content": "/*\n * Version.cpp.in, part of VCMI engine\n *\n * Authors: listed in file AUTHORS in main folder\n *\n * License: GNU General Public License v2.0 or later\n * Full text of license available in license.txt file, in main folder\n *\n */\n#include \"Version.h\"\n\nVCMI_LIB_NAMESPACE_BEGIN\n\nnamespace GameConstants\n{\nconst char GIT_SHA1[] = \"@GIT_SHA1@\";\n}\n\nVCMI_LIB_NAMESPACE_END\n"
        },
        {
          "name": "Version.h",
          "type": "blob",
          "size": 0.1396484375,
          "content": "#pragma once\n\n#include \"StdInc.h\"\n\nVCMI_LIB_NAMESPACE_BEGIN\n\nnamespace GameConstants\n{\nextern const char GIT_SHA1[];\n}\n\nVCMI_LIB_NAMESPACE_END\n"
        },
        {
          "name": "android",
          "type": "tree",
          "content": null
        },
        {
          "name": "client",
          "type": "tree",
          "content": null
        },
        {
          "name": "clientapp",
          "type": "tree",
          "content": null
        },
        {
          "name": "cmake_modules",
          "type": "tree",
          "content": null
        },
        {
          "name": "conanfile.py",
          "type": "blob",
          "size": 15.7763671875,
          "content": "from conan import ConanFile\nfrom conan.errors import ConanInvalidConfiguration\nfrom conan.tools.apple import is_apple_os\nfrom conan.tools.build import cross_building\nfrom conan.tools.cmake import CMakeDeps, CMakeToolchain\nfrom conans import tools\n\nrequired_conan_version = \">=1.51.3\"\n\nclass VCMI(ConanFile):\n    settings = \"os\", \"compiler\", \"build_type\", \"arch\"\n\n    _libRequires = [\n        \"boost/[^1.69]\",\n        \"minizip/[~1.2.12]\",\n    ]\n    _clientRequires = [\n        # Versions between 2.5-2.8 have broken loading of palette sdl images which a lot of mods use\n        # there is workaround that require disabling cmake flag which is not available in conan recipes. \n        # Bug is fixed in version 2.8, however it is not available in conan at the moment\n        \"sdl_image/2.0.5\", \n        \"sdl_ttf/[>=2.0.18]\",\n        \"onetbb/[^2021.7 <2021.10]\",  # 2021.10+ breaks mobile builds due to added hwloc dependency\n        \"xz_utils/[>=5.2.5]\", # Required for innoextract\n    ]\n\n    requires = _libRequires + _clientRequires\n\n    options = {\n        \"default_options_of_requirements\": [True, False],\n        \"with_apple_system_libs\": [True, False],\n        \"with_ffmpeg\": [True, False],\n        \"with_luajit\": [True, False],\n    }\n    default_options = {\n        \"default_options_of_requirements\": False,\n        \"with_apple_system_libs\": False,\n        \"with_ffmpeg\": True,\n        \"with_luajit\": False,\n\n        \"boost/*:shared\": True,\n        \"minizip/*:shared\": True,\n    }\n\n    def configure(self):\n        self.options[\"ffmpeg\"].shared = self.settings.os == \"Android\" # using shared version results in less total project size on Android\n        self.options[\"freetype\"].shared = self.settings.os == \"Android\"\n\n        # SDL_image and Qt depend on it, in iOS both are static\n        self.options[\"libpng\"].shared = self.settings.os != \"iOS\"\n        # static Qt for iOS is the only viable option at the moment\n        self.options[\"qt\"].shared = self.settings.os != \"iOS\"\n\n        # TODO: enable for all platforms\n        if self.settings.os == \"Android\":\n            self.options[\"bzip2\"].shared = True\n            self.options[\"libiconv\"].shared = True\n            self.options[\"zlib\"].shared = True\n\n        # TODO: enable for all platforms?\n        if self.settings.os == \"Windows\":\n            self.options[\"sdl\"].shared = True\n            self.options[\"sdl_image\"].shared = True\n            self.options[\"sdl_mixer\"].shared = True\n            self.options[\"sdl_ttf\"].shared = True\n\n        if self.settings.os == \"iOS\": \n            # TODO: ios - newer sdl fails to link\n            self.requires(\"sdl/2.26.1\")\n            self.requires(\"sdl_mixer/2.0.4\")\n        elif self.settings.os == \"Android\":\n            # On Android SDL version must be same as version of Java wrapper for SDL in VCMI source code\n            # Wrapper can be found in following directory: android/vcmi-app/src/main/java/org/libsdl/app\n            self.requires(\"sdl/2.26.5\")\n            self.requires(\"sdl_mixer/2.0.4\")\n        else:\n            # upcoming SDL version 3.0+ is not supported at the moment due to API breakage\n            # SDL versions between 2.22-2.26.1 have broken sound\n            self.requires(\"sdl/[^2.26 || >=2.0.20 <=2.22.0]\")\n            self.requires(\"sdl_mixer/[>=2.0.4]\")\n\n        if self.settings.os == \"Android\":\n            self.options[\"qt\"].android_sdk = tools.get_env(\"ANDROID_HOME\", default=\"\")\n\n        if self.options.default_options_of_requirements:\n            return\n\n        # we need only the following Boost parts:\n        # date_time filesystem iostreams locale program_options system thread\n        # some other parts are also enabled because they're dependents\n        # see e.g. conan-center-index/recipes/boost/all/dependencies\n        self.options[\"boost\"].without_context = True\n        self.options[\"boost\"].without_contract = True\n        self.options[\"boost\"].without_coroutine = True\n        self.options[\"boost\"].without_fiber = True\n        self.options[\"boost\"].without_graph = True\n        self.options[\"boost\"].without_graph_parallel = True\n        self.options[\"boost\"].without_json = True\n        self.options[\"boost\"].without_log = True\n        self.options[\"boost\"].without_math = True\n        self.options[\"boost\"].without_mpi = True\n        self.options[\"boost\"].without_nowide = True\n        self.options[\"boost\"].without_python = True\n        self.options[\"boost\"].without_serialization = True\n        self.options[\"boost\"].without_stacktrace = True\n        self.options[\"boost\"].without_test = True\n        self.options[\"boost\"].without_timer = True\n        self.options[\"boost\"].without_type_erasure = True\n        self.options[\"boost\"].without_wave = True\n        self.options[\"boost\"].without_url = True\n\n        self.options[\"ffmpeg\"].disable_all_bitstream_filters = True\n        self.options[\"ffmpeg\"].disable_all_decoders = True\n        self.options[\"ffmpeg\"].disable_all_demuxers = True\n        self.options[\"ffmpeg\"].disable_all_encoders = True\n        self.options[\"ffmpeg\"].disable_all_filters = True\n        self.options[\"ffmpeg\"].disable_all_hardware_accelerators = True\n        self.options[\"ffmpeg\"].disable_all_muxers = True\n        self.options[\"ffmpeg\"].disable_all_parsers = True\n        self.options[\"ffmpeg\"].disable_all_protocols = True\n\n        self.options[\"ffmpeg\"].with_asm = False\n        self.options[\"ffmpeg\"].with_bzip2 = False\n        self.options[\"ffmpeg\"].with_freetype = False\n        self.options[\"ffmpeg\"].with_libaom = False\n        self.options[\"ffmpeg\"].with_libdav1d = False\n        self.options[\"ffmpeg\"].with_libiconv = False\n        self.options[\"ffmpeg\"].with_libmp3lame = False\n        self.options[\"ffmpeg\"].with_libsvtav1 = False\n        self.options[\"ffmpeg\"].with_libvpx = False\n        self.options[\"ffmpeg\"].with_libwebp = False\n        self.options[\"ffmpeg\"].with_libx264 = False\n        self.options[\"ffmpeg\"].with_libx265 = False\n        self.options[\"ffmpeg\"].with_lzma = True\n        self.options[\"ffmpeg\"].with_openh264 = False\n        self.options[\"ffmpeg\"].with_openjpeg = False\n        self.options[\"ffmpeg\"].with_opus = False\n        self.options[\"ffmpeg\"].with_programs = False\n        self.options[\"ffmpeg\"].with_sdl = False\n        self.options[\"ffmpeg\"].with_ssl = False\n        self.options[\"ffmpeg\"].with_vorbis = False\n        self.options[\"ffmpeg\"].with_zlib = False\n        if self.settings.os != \"Android\":\n            self.options[\"ffmpeg\"].with_libfdk_aac = False\n\n        self.options[\"ffmpeg\"].avcodec = True\n        self.options[\"ffmpeg\"].avdevice = False\n        self.options[\"ffmpeg\"].avfilter = False\n        self.options[\"ffmpeg\"].avformat = True\n        self.options[\"ffmpeg\"].postproc = False\n        self.options[\"ffmpeg\"].swresample = True # For resampling of audio in 'planar' formats\n        self.options[\"ffmpeg\"].swscale = True    # For video scaling\n\n        # We want following options supported:\n        # H3:SoD - .bik and .smk\n        # H3:HD  -  ogg container / theora video / vorbis sound (not supported by vcmi at the moment, but might be supported in future)\n        # and for mods - webm container / vp8 or vp9 video / opus sound\n        # TODO: add av1 support for mods (requires enabling libdav1d which currently fails to build via Conan)\n        self.options[\"ffmpeg\"].enable_protocols = \"file\"\n        self.options[\"ffmpeg\"].enable_demuxers = \"bink,binka,ogg,smacker,webm_dash_manifest\"\n        self.options[\"ffmpeg\"].enable_parsers = \"opus,vorbis,vp8,vp9,webp\"\n        self.options[\"ffmpeg\"].enable_decoders = \"bink,binkaudio_dct,binkaudio_rdft,smackaud,smacker,theora,vorbis,vp8,vp9,opus\"\n\n        #optionally, for testing - enable ffplay/ffprobe binaries in conan package:\n        #if self.settings.os == \"Windows\":\n        #    self.options[\"ffmpeg\"].with_programs = True\n        #    self.options[\"ffmpeg\"].avfilter = True\n        #    self.options[\"ffmpeg\"].with_sdl = True\n        #    self.options[\"ffmpeg\"].enable_filters = \"aresample,scale\"\n\n        self.options[\"sdl\"].sdl2main = self.settings.os != \"iOS\"\n        self.options[\"sdl\"].vulkan = False\n\n        # bmp, png are the only ones that needs to be supported\n        # dds support may be useful for HD edition, but not supported by sdl_image at the moment\n        self.options[\"sdl_image\"].gif = False\n        self.options[\"sdl_image\"].lbm = False\n        self.options[\"sdl_image\"].pnm = False\n        self.options[\"sdl_image\"].pcx = False\n        #self.options[\"sdl_image\"].qoi = False # sdl_image >=2.6\n        self.options[\"sdl_image\"].svg = False\n        self.options[\"sdl_image\"].tga = False\n        self.options[\"sdl_image\"].with_libjpeg = False\n        self.options[\"sdl_image\"].with_libtiff = False\n        self.options[\"sdl_image\"].with_libwebp = False\n        self.options[\"sdl_image\"].xcf = False\n        self.options[\"sdl_image\"].xpm = False\n        self.options[\"sdl_image\"].xv = False\n        if is_apple_os(self):\n            self.options[\"sdl_image\"].imageio = True\n\n        # mp3, ogg and wav are the only ones that needs to be supported\n        # opus is nice to have, but fails to build in CI\n        # flac can be considered, but generally unnecessary\n        self.options[\"sdl_mixer\"].flac = False\n        self.options[\"sdl_mixer\"].modplug = False\n        self.options[\"sdl_mixer\"].opus = False\n        if self.settings.os == \"iOS\" or self.settings.os == \"Android\":\n            # only available in older sdl_mixer version, removed in newer version\n            self.options[\"sdl_mixer\"].mad = False\n            self.options[\"sdl_mixer\"].mikmod = False\n            self.options[\"sdl_mixer\"].nativemidi = False\n\n        def _disableQtOptions(disableFlag, options):\n            return \" \".join([f\"-{disableFlag}-{tool}\" for tool in options])\n\n        _qtOptions = [\n            _disableQtOptions(\"no\", [\n                \"gif\",\n                \"ico\",\n            ]),\n            _disableQtOptions(\"no-feature\", [\n                # xpm format is required for Drag'n'Drop support\n                \"imageformat_bmp\",\n                \"imageformat_jpeg\",\n                \"imageformat_ppm\",\n                \"imageformat_xbm\",\n\n                # we need only macdeployqt\n                # TODO: disabling these doesn't disable generation of CMake targets\n                # TODO: in Qt 6.3 it's a part of qtbase\n                # \"assistant\",\n                # \"designer\",\n                # \"distancefieldgenerator\",\n                # \"kmap2qmap\",\n                # \"linguist\",\n                # \"makeqpf\",\n                # \"pixeltool\",\n                # \"qdbus\",\n                # \"qev\",\n                # \"qtattributionsscanner\",\n                # \"qtdiag\",\n                # \"qtpaths\",\n                # \"qtplugininfo\",\n            ]),\n        ]\n        self.options[\"qt\"].config = \" \".join(_qtOptions)\n        self.options[\"qt\"].qttools = True\n        self.options[\"qt\"].qtandroidextras = self.settings.os == \"Android\" # TODO: in Qt 6 it's part of Core\n        self.options[\"qt\"].with_freetype = self.settings.os == \"Android\"\n        self.options[\"qt\"].with_libjpeg = False\n        self.options[\"qt\"].with_md4c = False\n        self.options[\"qt\"].with_mysql = False\n        self.options[\"qt\"].with_odbc = False\n        self.options[\"qt\"].with_openal = False\n        self.options[\"qt\"].with_pq = False\n        self.options[\"qt\"].openssl = not is_apple_os(self)\n        if self.settings.os == \"iOS\" or self.settings.os == \"Android\":\n            self.options[\"qt\"].opengl = \"es2\"\n        if not is_apple_os(self) and self.settings.os != \"Android\" and cross_building(self):\n            self.options[\"qt\"].cross_compile = self.env[\"CONAN_CROSS_COMPILE\"]\n        # TODO: add for all platforms after updating recipe\n        if self.settings.os == \"Android\":\n            self.options[\"qt\"].essential_modules = False\n        # No Qt OpenGL for cross-compiling for Windows, Conan does not support it\n        if self.settings.os == \"Windows\" and cross_building(self):\n            self.options[\"qt\"].opengl = \"no\"\n\n        # transitive deps\n        # doesn't link to overridden bzip2 & zlib, the tool isn't needed anyway\n        self.options[\"pcre2\"].build_pcre2grep = False\n        # executable not needed\n        if self.settings.os == \"Android\":\n            self.options[\"sqlite3\"].build_executable = False\n\n    def requirements(self):\n        self.requires(\"freetype/[~2.12.1]\", override=True) # sdl_ttf / Qt\n        self.requires(\"libpng/[~1.6.39]\", override=True) # freetype / qt / sdl_image\n\n        # client\n        if self.options.with_ffmpeg:\n            self.requires(\"ffmpeg/[>=4.4]\")\n\n        # launcher\n        if self.settings.os == \"Android\":\n            self.requires(\"qt/[~5.15.14]\")\n        else:\n            self.requires(\"qt/[~5.15.2]\")\n        # TODO: version range doesn't work in Conan v1\n        if self.options[\"qt\"].openssl:\n            self.requires(\"openssl/1.1.1s\")\n\n        # use Apple system libraries instead of external ones\n        if self.options.with_apple_system_libs and is_apple_os(self):\n            systemLibsOverrides = [\n                \"bzip2/1.0.8\",\n                \"libiconv/1.17\",\n                \"sqlite3/3.39.2\",\n                \"zlib/1.2.12\",\n            ]\n            for lib in systemLibsOverrides:\n                self.requires(f\"{lib}@vcmi/apple\", override=True)\n        elif self.settings.os == \"Android\":\n            self.requires(\"zlib/1.2.12@vcmi/android\", override=True)\n        else:\n            self.requires(\"zlib/[~1.2.13]\", override=True) # minizip / Qt\n            self.requires(\"libiconv/[~1.17]\", override=True) # ffmpeg / sdl\n\n        # TODO: the latest official release of LuaJIT (which is quite old) can't be built for arm\n        if self.options.with_luajit and not str(self.settings.arch).startswith(\"arm\"):\n            self.requires(\"luajit/[~2.0.5]\")\n\n    def validate(self):\n        if self.options.with_apple_system_libs and not is_apple_os(self):\n            raise ConanInvalidConfiguration(\"with_apple_system_libs is only for Apple platforms\")\n        if self.options.with_apple_system_libs and self.options.default_options_of_requirements:\n            raise ConanInvalidConfiguration(\"with_apple_system_libs and default_options_of_requirements can't be True at the same time\")\n\n    def generate(self):\n        tc = CMakeToolchain(self)\n        tc.variables[\"USING_CONAN\"] = True\n        tc.variables[\"CONAN_INSTALL_FOLDER\"] = self.install_folder\n        if self.settings.os == \"Android\":\n            tc.variables[\"CMAKE_ANDROID_API\"] = str(self.settings.os.api_level)\n            tc.variables[\"ANDROID_SYSROOT_LIB_SUBDIR\"] = {\n                'armv7': 'arm-linux-androideabi',\n                'armv8': 'aarch64-linux-android',\n                'x86': 'i686-linux-android',\n                'x86_64': 'x86_64-linux-android',\n            }.get(str(self.settings.arch))\n        if cross_building(self) and self.settings.os == \"Windows\":\n            tc.variables[\"CONAN_SYSTEM_LIBRARY_LOCATION\"] = self.env[\"CONAN_SYSTEM_LIBRARY_LOCATION\"]\n        tc.generate()\n\n        deps = CMakeDeps(self)\n        if tools.get_env(\"GENERATE_ONLY_BUILT_CONFIG\", default=False):\n            deps.generate()\n            return\n\n        # allow using prebuilt deps with all configs\n        # credits to https://github.com/conan-io/conan/issues/11607#issuecomment-1188500937 for the workaround\n        configs = [\n            \"Debug\",\n            \"MinSizeRel\",\n            \"Release\",\n            \"RelWithDebInfo\",\n        ]\n        for config in configs:\n            print(f\"generating CMakeDeps for {config}\")\n            deps.configuration = config\n            deps.generate()\n\n    def imports(self):\n        if is_apple_os(self):\n            self.copy(\"*.dylib\", \"Frameworks\", \"lib\")\n        elif self.settings.os == \"Windows\":\n            self.copy(\"*.dll\", src=\"bin/archdatadir/plugins/platforms\", dst=\"platforms\")\n            self.copy(\"*.dll\", src=\"bin/archdatadir/plugins/styles\", dst=\"styles\")\n            self.copy(\"*.dll\", src=\"@bindirs\", dst=\"\", excludes=\"archdatadir/*\")\n        elif self.settings.os == \"Android\":\n            self.copy(\"*.so\", \".\", \"lib\")\n"
        },
        {
          "name": "config",
          "type": "tree",
          "content": null
        },
        {
          "name": "debian",
          "type": "tree",
          "content": null
        },
        {
          "name": "docs",
          "type": "tree",
          "content": null
        },
        {
          "name": "fuzzylite.pc.in",
          "type": "blob",
          "size": 0.2490234375,
          "content": "prefix=@CMAKE_INSTALL_PREFIX@\nexec_prefix=${prefix}\nincludedir=${exec_prefix}/include\nlibdir=${exec_prefix}/lib\n\nName: fuzzylite\nDescription: A fuzzy logic control library in C++\nVersion: @FL_VERSION@\nLibs: -L${libdir} -lfuzzylite\nCflags: -I${includedir}\n"
        },
        {
          "name": "include",
          "type": "tree",
          "content": null
        },
        {
          "name": "ios",
          "type": "tree",
          "content": null
        },
        {
          "name": "launcher",
          "type": "tree",
          "content": null
        },
        {
          "name": "lib",
          "type": "tree",
          "content": null
        },
        {
          "name": "license.txt",
          "type": "blob",
          "size": 14.7646484375,
          "content": "    GNU GENERAL PUBLIC LICENSE\n\t\t       Version 2, June 1991\n\n Copyright (C) 1989, 1991 Free Software Foundation, Inc.,\n 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA\n Everyone is permitted to copy and distribute verbatim copies\n of this license document, but changing it is not allowed.\n\n\t\t\t    Preamble\n\n  The licenses for most software are designed to take away your\nfreedom to share and change it.  By contrast, the GNU General Public\nLicense is intended to guarantee your freedom to share and change free\nsoftware--to make sure the software is free for all its users.  This\nGeneral Public License applies to most of the Free Software\nFoundation's software and to any other program whose authors commit to\nusing it.  (Some other Free Software Foundation software is covered by\nthe GNU Lesser General Public License instead.)  You can apply it to\nyour programs, too.\n\n  When we speak of free software, we are referring to freedom, not\nprice.  Our General Public Licenses are designed to make sure that you\nhave the freedom to distribute copies of free software (and charge for\nthis service if you wish), that you receive source code or can get it\nif you want it, that you can change the software or use pieces of it\nin new free programs; and that you know you can do these things.\n\n  To protect your rights, we need to make restrictions that forbid\nanyone to deny you these rights or to ask you to surrender the rights.\nThese restrictions translate to certain responsibilities for you if you\ndistribute copies of the software, or if you modify it.\n\n  For example, if you distribute copies of such a program, whether\ngratis or for a fee, you must give the recipients all the rights that\nyou have.  You must make sure that they, too, receive or can get the\nsource code.  And you must show them these terms so they know their\nrights.\n\n  We protect your rights with two steps: (1) copyright the software, and\n(2) offer you this license which gives you legal permission to copy,\ndistribute and/or modify the software.\n\n  Also, for each author's protection and ours, we want to make certain\nthat everyone understands that there is no warranty for this free\nsoftware.  If the software is modified by someone else and passed on, we\nwant its recipients to know that what they have is not the original, so\nthat any problems introduced by others will not reflect on the original\nauthors' reputations.\n\n  Finally, any free program is threatened constantly by software\npatents.  We wish to avoid the danger that redistributors of a free\nprogram will individually obtain patent licenses, in effect making the\nprogram proprietary.  To prevent this, we have made it clear that any\npatent must be licensed for everyone's free use or not licensed at all.\n\n  The precise terms and conditions for copying, distribution and\nmodification follow.\n\n\t\t    GNU GENERAL PUBLIC LICENSE\n   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION\n\n  0. This License applies to any program or other work which contains\na notice placed by the copyright holder saying it may be distributed\nunder the terms of this General Public License.  The \"Program\", below,\nrefers to any such program or work, and a \"work based on the Program\"\nmeans either the Program or any derivative work under copyright law:\nthat is to say, a work containing the Program or a portion of it,\neither verbatim or with modifications and/or translated into another\nlanguage.  (Hereinafter, translation is included without limitation in\nthe term \"modification\".)  Each licensee is addressed as \"you\".\n\nActivities other than copying, distribution and modification are not\ncovered by this License; they are outside its scope.  The act of\nrunning the Program is not restricted, and the output from the Program\nis covered only if its contents constitute a work based on the\nProgram (independent of having been made by running the Program).\nWhether that is true depends on what the Program does.\n\n  1. You may copy and distribute verbatim copies of the Program's\nsource code as you receive it, in any medium, provided that you\nconspicuously and appropriately publish on each copy an appropriate\ncopyright notice and disclaimer of warranty; keep intact all the\nnotices that refer to this License and to the absence of any warranty;\nand give any other recipients of the Program a copy of this License\nalong with the Program.\n\nYou may charge a fee for the physical act of transferring a copy, and\nyou may at your option offer warranty protection in exchange for a fee.\n\n  2. You may modify your copy or copies of the Program or any portion\nof it, thus forming a work based on the Program, and copy and\ndistribute such modifications or work under the terms of Section 1\nabove, provided that you also meet all of these conditions:\n\n    a) You must cause the modified files to carry prominent notices\n    stating that you changed the files and the date of any change.\n\n    b) You must cause any work that you distribute or publish, that in\n    whole or in part contains or is derived from the Program or any\n    part thereof, to be licensed as a whole at no charge to all third\n    parties under the terms of this License.\n\n    c) If the modified program normally reads commands interactively\n    when run, you must cause it, when started running for such\n    interactive use in the most ordinary way, to print or display an\n    announcement including an appropriate copyright notice and a\n    notice that there is no warranty (or else, saying that you provide\n    a warranty) and that users may redistribute the program under\n    these conditions, and telling the user how to view a copy of this\n    License.  (Exception: if the Program itself is interactive but\n    does not normally print such an announcement, your work based on\n    the Program is not required to print an announcement.)\n\nThese requirements apply to the modified work as a whole.  If\nidentifiable sections of that work are not derived from the Program,\nand can be reasonably considered independent and separate works in\nthemselves, then this License, and its terms, do not apply to those\nsections when you distribute them as separate works.  But when you\ndistribute the same sections as part of a whole which is a work based\non the Program, the distribution of the whole must be on the terms of\nthis License, whose permissions for other licensees extend to the\nentire whole, and thus to each and every part regardless of who wrote it.\n\nThus, it is not the intent of this section to claim rights or contest\nyour rights to work written entirely by you; rather, the intent is to\nexercise the right to control the distribution of derivative or\ncollective works based on the Program.\n\nIn addition, mere aggregation of another work not based on the Program\nwith the Program (or with a work based on the Program) on a volume of\na storage or distribution medium does not bring the other work under\nthe scope of this License.\n\n  3. You may copy and distribute the Program (or a work based on it,\nunder Section 2) in object code or executable form under the terms of\nSections 1 and 2 above provided that you also do one of the following:\n\n    a) Accompany it with the complete corresponding machine-readable\n    source code, which must be distributed under the terms of Sections\n    1 and 2 above on a medium customarily used for software interchange; or,\n\n    b) Accompany it with a written offer, valid for at least three\n    years, to give any third party, for a charge no more than your\n    cost of physically performing source distribution, a complete\n    machine-readable copy of the corresponding source code, to be\n    distributed under the terms of Sections 1 and 2 above on a medium\n    customarily used for software interchange; or,\n\n    c) Accompany it with the information you received as to the offer\n    to distribute corresponding source code.  (This alternative is\n    allowed only for noncommercial distribution and only if you\n    received the program in object code or executable form with such\n    an offer, in accord with Subsection b above.)\n\nThe source code for a work means the preferred form of the work for\nmaking modifications to it.  For an executable work, complete source\ncode means all the source code for all modules it contains, plus any\nassociated interface definition files, plus the scripts used to\ncontrol compilation and installation of the executable.  However, as a\nspecial exception, the source code distributed need not include\nanything that is normally distributed (in either source or binary\nform) with the major components (compiler, kernel, and so on) of the\noperating system on which the executable runs, unless that component\nitself accompanies the executable.\n\nIf distribution of executable or object code is made by offering\naccess to copy from a designated place, then offering equivalent\naccess to copy the source code from the same place counts as\ndistribution of the source code, even though third parties are not\ncompelled to copy the source along with the object code.\n\n  4. You may not copy, modify, sublicense, or distribute the Program\nexcept as expressly provided under this License.  Any attempt\notherwise to copy, modify, sublicense or distribute the Program is\nvoid, and will automatically terminate your rights under this License.\nHowever, parties who have received copies, or rights, from you under\nthis License will not have their licenses terminated so long as such\nparties remain in full compliance.\n\n  5. You are not required to accept this License, since you have not\nsigned it.  However, nothing else grants you permission to modify or\ndistribute the Program or its derivative works.  These actions are\nprohibited by law if you do not accept this License.  Therefore, by\nmodifying or distributing the Program (or any work based on the\nProgram), you indicate your acceptance of this License to do so, and\nall its terms and conditions for copying, distributing or modifying\nthe Program or works based on it.\n\n  6. Each time you redistribute the Program (or any work based on the\nProgram), the recipient automatically receives a license from the\noriginal licensor to copy, distribute or modify the Program subject to\nthese terms and conditions.  You may not impose any further\nrestrictions on the recipients' exercise of the rights granted herein.\nYou are not responsible for enforcing compliance by third parties to\nthis License.\n\n  7. If, as a consequence of a court judgment or allegation of patent\ninfringement or for any other reason (not limited to patent issues),\nconditions are imposed on you (whether by court order, agreement or\notherwise) that contradict the conditions of this License, they do not\nexcuse you from the conditions of this License.  If you cannot\ndistribute so as to satisfy simultaneously your obligations under this\nLicense and any other pertinent obligations, then as a consequence you\nmay not distribute the Program at all.  For example, if a patent\nlicense would not permit royalty-free redistribution of the Program by\nall those who receive copies directly or indirectly through you, then\nthe only way you could satisfy both it and this License would be to\nrefrain entirely from distribution of the Program.\n\nIf any portion of this section is held invalid or unenforceable under\nany particular circumstance, the balance of the section is intended to\napply and the section as a whole is intended to apply in other\ncircumstances.\n\nIt is not the purpose of this section to induce you to infringe any\npatents or other property right claims or to contest validity of any\nsuch claims; this section has the sole purpose of protecting the\nintegrity of the free software distribution system, which is\nimplemented by public license practices.  Many people have made\ngenerous contributions to the wide range of software distributed\nthrough that system in reliance on consistent application of that\nsystem; it is up to the author/donor to decide if he or she is willing\nto distribute software through any other system and a licensee cannot\nimpose that choice.\n\nThis section is intended to make thoroughly clear what is believed to\nbe a consequence of the rest of this License.\n\n  8. If the distribution and/or use of the Program is restricted in\ncertain countries either by patents or by copyrighted interfaces, the\noriginal copyright holder who places the Program under this License\nmay add an explicit geographical distribution limitation excluding\nthose countries, so that distribution is permitted only in or among\ncountries not thus excluded.  In such case, this License incorporates\nthe limitation as if written in the body of this License.\n\n  9. The Free Software Foundation may publish revised and/or new versions\nof the General Public License from time to time.  Such new versions will\nbe similar in spirit to the present version, but may differ in detail to\naddress new problems or concerns.\n\nEach version is given a distinguishing version number.  If the Program\nspecifies a version number of this License which applies to it and \"any\nlater version\", you have the option of following the terms and conditions\neither of that version or of any later version published by the Free\nSoftware Foundation.  If the Program does not specify a version number of\nthis License, you may choose any version ever published by the Free Software\nFoundation.\n\n  10. If you wish to incorporate parts of the Program into other free\nprograms whose distribution conditions are different, write to the author\nto ask for permission.  For software which is copyrighted by the Free\nSoftware Foundation, write to the Free Software Foundation; we sometimes\nmake exceptions for this.  Our decision will be guided by the two goals\nof preserving the free status of all derivatives of our free software and\nof promoting the sharing and reuse of software generally.\n\n\t\t\t    NO WARRANTY\n\n  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY\nFOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN\nOTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES\nPROVIDE THE PROGRAM \"AS IS\" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED\nOR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS\nTO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE\nPROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,\nREPAIR OR CORRECTION.\n\n  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING\nWILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR\nREDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,\nINCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING\nOUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED\nTO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY\nYOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER\nPROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE\nPOSSIBILITY OF SUCH DAMAGES.\n\n\t\t     END OF TERMS AND CONDITIONS"
        },
        {
          "name": "lobby",
          "type": "tree",
          "content": null
        },
        {
          "name": "mapeditor",
          "type": "tree",
          "content": null
        },
        {
          "name": "osx",
          "type": "tree",
          "content": null
        },
        {
          "name": "rpm",
          "type": "tree",
          "content": null
        },
        {
          "name": "scripting",
          "type": "tree",
          "content": null
        },
        {
          "name": "scripts",
          "type": "tree",
          "content": null
        },
        {
          "name": "server",
          "type": "tree",
          "content": null
        },
        {
          "name": "serverapp",
          "type": "tree",
          "content": null
        },
        {
          "name": "test",
          "type": "tree",
          "content": null
        },
        {
          "name": "vcmibuilder",
          "type": "blob",
          "size": 7.2373046875,
          "content": "#!/bin/bash -e\n\n#\n# VCMI data builder script\n# Extracts game data from various sources and creates a tree with the right files\n#\n# Authors: listed in file AUTHORS in main folder\n#\n# This program is free software; you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation; either version 2 of the License, or\n# (at your option) any later version.\n#\n\n# no console arguments - print help\nif [ $# -eq 0 ] ; then\n\tprint_help=true\nfi\n\n# command line parsing\n# can't use system getopt which is not cross-platform (BSD/Mac)\n# can't use built-in getopts which can't parse long options (too difficult to avoid - e.g. CD1/CD2)\nwhile [ $# -gt 0 ]\ndo\n\tcase $1 in\n\t\t--cd1) cd1_dir=$2           ; shift 2 ;;\n\t\t--cd2) cd2_dir=$2           ; shift 2 ;;\n\t\t--gog) gog_file=$2          ; shift 2 ;;\n\t\t--data) data_dir=$2         ; shift 2 ;;\n\t\t--dest) dest_dir=$2         ; shift 2 ;;\n\t\t--convertMP3) useffmpeg=true; shift 1 ;;\n\t\t--validate) validate=true   ; shift 1 ;;\n\t\t*) print_help=true          ; shift 1 ;;\n\tesac\ndone\n\nif [[ -n \"$print_help\" ]]\nthen\n\techo \"VCMI data builder utility\"\n\techo \"Usage: vcmibuilder <options>\"\n\techo \"Options:\"\n\techo \" --cd1 DIRECTORY  \" \"Path to mounted first CD with Heroes 3 install files\"\n\techo \"                  \" \"Requires unshield\"\n\techo\n\techo \" --cd2 DIRECTORY  \" \"Path to second CD with Heroes 3 data files.\"\n\techo\n\techo \" --gog EXECUTABLE \" \"Path to gog.com executable\"\n\techo \"                  \" \"Requires innoextract ( http://constexpr.org/innoextract/ )\"\n\techo\n\techo \" --data DIRECTORY \" \"Path to installed Heroes 3 data\"\n\techo\n\techo \" --convertMP3     \" \"Convert all mp3 files into ogg/vorbis\"\n\techo \"                  \" \"Requires ffmpeg or avconv\"\n\techo\n\techo \" --dest DIRECTORY \" \"Path where resulting data will be placed. Default is ~/.local/share/vcmi\"\n\techo\n\techo \" --validate       \" \"Run basic validness checks\"\n\texit 0\nfi\n\n# test if a program version ($1) is less than the required one ($2)\nverlt() {\n\t[ \"$1\" = \"$2\" ] && return 1 || \\\n\t[ \"$1\" = \"`echo -e \"$1\\n$2\" | sort -V | head -n1`\" ]\n}\n\n# test presence of program $1, $2 will be passed as parameters to test presence\ntest_utility ()\n{\n\t$1 $2 > /dev/null 2>&1 || { echo \"$1 was not found. Please install it\" 1>&2 ; exit 1; }\n}\n\n# print error message and exit\nfail ()\n{\n\t$2\n\techo \"$1\" 1>&2\n\trm -rf \"$temp_dir\"\n\n\texit 1\n}\n\n# print warning to stderr.\nwarning ()\n{\n\techo \"$1\" 1>&2\n\twarn_user=true\n}\n\n#checks whether specified directory exists. Also works with globs\ndir_exists() {\n\t[ -d \"$1\" ]\n}\n\n# check if selected options are correct.\n\nif [[ -n \"$data_dir\" ]]\nthen\n\tif [[ -n \"$gog_file\" ]] || [[ -n \"$cd1_dir\" ]] || [[ -n \"$cd2_dir\" ]]\n\tthen\n\t\twarning \"Warning: Installed data dir was specified. Both gog and cd options will be ignored\"\n\t\tunset gog_file cd1_dir cd2_dir\n\tfi\nfi\n\nif [[ -n \"$gog_file\" ]]\nthen\n\ttest_utility \"innoextract\"\n\tif [[ -n \"$cd1_dir\" ]] || [[ -n \"$cd2_dir\" ]]\n\tthen\n\t\twarning \"Warning: Both gog and cd options were specified. cd options will be ignored\"\n\t\tunset cd1_dir cd2_dir\n\tfi\nfi\n\nif [[ -n \"$gog_file\" ]]\nthen\n\tcurrentver=\"$(innoextract --version | head -n1 | cut -d ' ' -f2)\"\n\trequiredver=\"1.6\"\n\tif verlt $currentver $requiredver;\n\tthen\n\t\tfail \"innoextract version is $currentver, update it to version $requiredver or higher\"\n\tfi\nfi\n\nif [[ -n \"$useffmpeg\" ]]\nthen\n\tffmpeg -version > /dev/null 2>&1 && AUDIO_CONV=ffmpeg\n\tavconv -version > /dev/null 2>&1 && AUDIO_CONV=avconv\n\tif [[ -z \"$AUDIO_CONV\" ]]\n\tthen\n\t\tfail \"Error: neither ffmpeg nor avconv were found. Please install it.\"\n\tfi\nfi\n\nif [[ -n \"$cd1_dir\" ]]\nthen\n\ttest_utility \"unshield\" \"-V\"\nfi\n\nif [[ -z \"$gog_file\" ]] && [[ -z \"$data_dir\" ]] && ( [[ -z \"$cd1_dir\" ]] || [[ -z \"$cd2_dir\" ]] )\nthen\n\twarning \"Warning: Selected options will not create complete Heroes 3 data!\"\nfi\n\n# if at least one warning has been printed - ask for confirmation\nif [[ -n \"$warn_user\" ]]\nthen\n\tread -p \"Do you wish to continue? (y/n) \" -n 1\n\techo #print eol\n\tif [[ ! $REPLY =~ ^[Yy]$ ]]\n\tthen\n\t\texit 1\n\tfi\nfi\n\nif [[ -z \"$dest_dir\" ]]\nthen\n\tif [[ \"$(uname)\" == Darwin ]]\n\tthen\n\t\tdest_dir=\"$HOME/Library/Application Support/vcmi\"\n\telif [[ -z \"$XDG_DATA_HOME\" ]]\n\tthen\n\t\tdest_dir=\"$HOME/.local/share/vcmi\"\n\telse\n\t\tdest_dir=\"$XDG_DATA_HOME/vcmi\"\n\tfi\nfi\n\ntemp_dir=\"$dest_dir\"/buildertmp\n\n# start installation\n\nmkdir -p \"$dest_dir\"\nmkdir -p \"$temp_dir\"\n\nif [[ -n \"$gog_file\" ]]\nthen\n\tdata_dir=\"$temp_dir\"/gog\n\tmkdir -p \"$data_dir\"\n\n\t# innoextract always reports error (iconv 84 error). Just test file for presence\n\ttest -f \"$gog_file\" || fail \"Error: gog.com executable was not found!\"\n\tgog_file=\"$(cd \"$(dirname \"$gog_file\")\"; pwd)/$(basename \"$gog_file\")\"\n\tcd \"$data_dir\" && innoextract \"$gog_file\"\n\t\n\t# some versions of gog.com installer (or innoextract tool?) place game files inside /app directory\n\tif dir_exists \"$data_dir\"/app/[Dd][Aa][Tt][Aa]\n\tthen\n\t\tdata_dir=\"$data_dir\"/app\n\tfi\nfi\n\nif [[ -n \"$cd1_dir\" ]]\nthen\n\tdata_dir=\"$temp_dir\"/cddir\n\tmkdir -p \"$data_dir\"\n\tunshield -d \"$data_dir\" x \"$cd1_dir\"/_setup/data1.cab || fail \"Error: failed to extract from Install Shield installer!\" \"rm -rf $data_dir\"\n\n\t# a bit tricky - different releases have different root directory. Move extracted files to data_dir\n\tif [ -d \"$data_dir\"/Heroes3 ]\n\tthen\n\t\tmv \"$data_dir\"/Heroes3/* \"$data_dir\"\n\telif [ -d \"$data_dir\"\"/Program_Files\" ]\n\tthen\n\t\tmv \"$data_dir\"/Program_Files/* \"$data_dir\"\n\telif [ -d \"$data_dir\"\"/LangInde_Program_Files\" ]\n\tthen\n\t\tmv \"$data_dir\"/LangInde_Program_Files/* \"$data_dir\"\n\telse\n\t\techo \"Error: failed to find extracted game files!\"\n\t\techo \"Extracted directories are: \"\n\t\tls -la \"$data_dir\"\n\t\techo \"Please report this on vcmi.eu\"\n\t\texit 1;\n\tfi\nfi\n\nif [[ -n \"$cd2_dir\" ]]\nthen\n\tmkdir -p \"$dest_dir\"/Data\n\n\tif [ -d \"$cd2_dir\"/heroes3 ]\n\tthen\n\t\tcp \"$cd2_dir\"/heroes3/Data/Heroes3.vid \"$dest_dir\"/Data/Heroes3.vid\n\t\tcp \"$cd2_dir\"/heroes3/Data/Heroes3.snd \"$dest_dir\"/Data/Heroes3-cd2.snd\n\telse\n\t\tcp \"$cd2_dir\"/Heroes3/Data/Heroes3.vid \"$dest_dir\"/Data/Heroes3.vid\n\t\tcp \"$cd2_dir\"/Heroes3/Data/Heroes3.snd \"$dest_dir\"/Data/Heroes3-cd2.snd\n\tfi\nfi\n\nif [[ -n \"$data_dir\" ]]\nthen\n\t# this folder is named differently from time to time\n\t# bash also has `shopt -s nocaseglob` but we don't want this to\n\t# accidentally influence other parts of this script\n\t# since the directory names are short, we use this pattern matching\n\tcp -r \"$data_dir\"/[Dd][Aa][Tt][Aa] \"$dest_dir\"\n\tcp -r \"$data_dir\"/[Mm][Aa][Pp][Ss] \"$dest_dir\"\n\tcp -r \"$data_dir\"/[Mm][Pp]3 \"$dest_dir\"\nfi\n\nif [[ -n \"$useffmpeg\" ]]\nthen\n\t# now when all music files were installed convert them to ogg\n\techo \"Converting mp3 files...\"\n\n\tOIFS=\"$IFS\"\n\tIFS=$'\\n'\n\n\tfor file in `find \"$dest_dir\" -type f -iname \"*.mp3\"`\n\tdo\n\t\techo \"Converting $file\"\n\t\togg=${file%.*}\n\t\t$AUDIO_CONV -y -i \"$file\" -acodec libvorbis \"$ogg\".ogg 2>/dev/null || fail \"Error: failed to convert $file to ogg/vorbis using $AUDIO_CONV\" \"rm -f \"$ogg\".ogg\"\n\t\trm -f $file\n\tdone\n\n\tIFS=\"$OIFS\"\nfi\n\nif [[ -n \"$validate\" ]]\nthen\n\ttest -f \"$dest_dir\"/[Dd][Aa][Tt][Aa]/H3bitmap.lod || fail \"Error: Heroes 3 data files are missing!\"\n\ttest -f \"$dest_dir\"/[Dd][Aa][Tt][Aa]/H3sprite.lod || fail \"Error: Heroes 3 data files are missing!\"\n\ttest -f \"$dest_dir\"/[Dd][Aa][Tt][Aa]/VIDEO.VID    || fail \"Error: Heroes 3 data files (CD2) are missing!\"\n\t#test -d \"$dest_dir\"/Mods/vcmi/Data                || fail \"Error: VCMI data files are missing!\"\nfi\n\nrm -rf \"$temp_dir\"\n"
        },
        {
          "name": "vcmiqt",
          "type": "tree",
          "content": null
        },
        {
          "name": "win",
          "type": "tree",
          "content": null
        },
        {
          "name": "xcode",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}