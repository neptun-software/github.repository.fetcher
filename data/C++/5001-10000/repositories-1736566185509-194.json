{
  "metadata": {
    "timestamp": 1736566185509,
    "page": 194,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjIwMA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "OpenAtomFoundation/pika",
      "stars": 5934,
      "defaultBranch": "unstable",
      "files": [
        {
          "name": ".clang-format",
          "type": "blob",
          "size": 5.2529296875,
          "content": "---\nLanguage:        Cpp\n# BasedOnStyle:  Google\nAccessModifierOffset: -1\nAlignAfterOpenBracket: Align\nAlignConsecutiveMacros: None\nAlignConsecutiveAssignments: None\nAlignConsecutiveBitFields: None\nAlignConsecutiveDeclarations: None\nAlignEscapedNewlines: Left\nAlignOperands:   Align\nAlignTrailingComments: true\nAllowAllArgumentsOnNextLine: true\nAllowAllConstructorInitializersOnNextLine: true\nAllowAllParametersOfDeclarationOnNextLine: true\nAllowShortEnumsOnASingleLine: true\nAllowShortBlocksOnASingleLine: Never\nAllowShortCaseLabelsOnASingleLine: false\nAllowShortFunctionsOnASingleLine: All\nAllowShortLambdasOnASingleLine: All\nAllowShortIfStatementsOnASingleLine: WithoutElse\nAllowShortLoopsOnASingleLine: true\nAlwaysBreakAfterDefinitionReturnType: None\nAlwaysBreakAfterReturnType: None\nAlwaysBreakBeforeMultilineStrings: true\nAlwaysBreakTemplateDeclarations: Yes\nAttributeMacros:\n  - __capability\nBinPackArguments: true\nBinPackParameters: true\nBraceWrapping:\n  AfterCaseLabel:  false\n  AfterClass:      false\n  AfterControlStatement: Never\n  AfterEnum:       false\n  AfterFunction:   false\n  AfterNamespace:  false\n  AfterObjCDeclaration: false\n  AfterStruct:     false\n  AfterUnion:      false\n  AfterExternBlock: false\n  BeforeCatch:     false\n  BeforeElse:      false\n  BeforeLambdaBody: false\n  BeforeWhile:     false\n  IndentBraces:    false\n  SplitEmptyFunction: true\n  SplitEmptyRecord: true\n  SplitEmptyNamespace: true\nBreakBeforeBinaryOperators: None\nBreakBeforeConceptDeclarations: true\nBreakBeforeBraces: Attach\nBreakBeforeInheritanceComma: false\nBreakInheritanceList: BeforeColon\nBreakBeforeTernaryOperators: true\nBreakConstructorInitializersBeforeComma: false\nBreakConstructorInitializers: BeforeColon\nBreakAfterJavaFieldAnnotations: false\nBreakStringLiterals: true\nColumnLimit:     120\nCommentPragmas:  '^ IWYU pragma:'\nCompactNamespaces: false\nConstructorInitializerAllOnOneLineOrOnePerLine: true\nConstructorInitializerIndentWidth: 4\nContinuationIndentWidth: 4\nCpp11BracedListStyle: true\nDeriveLineEnding: true\nDerivePointerAlignment: true\nDisableFormat:   false\nEmptyLineBeforeAccessModifier: LogicalBlock\nExperimentalAutoDetectBinPacking: false\nFixNamespaceComments: true\nForEachMacros:\n  - foreach\n  - Q_FOREACH\n  - BOOST_FOREACH\nStatementAttributeLikeMacros:\n  - Q_EMIT\nIncludeBlocks:   Preserve\nIncludeCategories:\n  - Regex:           '^<ext/.*\\.h>'\n    Priority:        2\n    SortPriority:    0\n    CaseSensitive:   false\n  - Regex:           '^<.*\\.h>'\n    Priority:        1\n    SortPriority:    0\n    CaseSensitive:   false\n  - Regex:           '^<.*'\n    Priority:        2\n    SortPriority:    0\n    CaseSensitive:   false\n  - Regex:           '.*'\n    Priority:        3\n    SortPriority:    0\n    CaseSensitive:   false\nIncludeIsMainRegex: '([-_](test|unittest))?$'\nIncludeIsMainSourceRegex: ''\nIndentCaseLabels: true\nIndentCaseBlocks: false\nIndentGotoLabels: true\nIndentPPDirectives: AfterHash\nIndentExternBlock: AfterExternBlock\nIndentRequires:  false\nIndentWidth:     2\nIndentWrappedFunctionNames: false\nInsertTrailingCommas: None\nJavaScriptQuotes: Leave\nJavaScriptWrapImports: true\nKeepEmptyLinesAtTheStartOfBlocks: false\nMacroBlockBegin: ''\nMacroBlockEnd:   ''\nMaxEmptyLinesToKeep: 1\nNamespaceIndentation: None\nObjCBinPackProtocolList: Never\nObjCBlockIndentWidth: 2\nObjCBreakBeforeNestedBlockParam: true\nObjCSpaceAfterProperty: false\nObjCSpaceBeforeProtocolList: true\nPenaltyBreakAssignment: 2\nPenaltyBreakBeforeFirstCallParameter: 1\nPenaltyBreakComment: 300\nPenaltyBreakFirstLessLess: 120\nPenaltyBreakString: 1000\nPenaltyBreakTemplateDeclaration: 10\nPenaltyExcessCharacter: 1000000\nPenaltyReturnTypeOnItsOwnLine: 200\nPenaltyIndentedWhitespace: 0\nPointerAlignment: Left\nRawStringFormats:\n  - Language:        Cpp\n    Delimiters:\n      - cc\n      - CC\n      - cpp\n      - Cpp\n      - CPP\n      - 'c++'\n      - 'C++'\n    CanonicalDelimiter: ''\n    BasedOnStyle:    google\n  - Language:        TextProto\n    Delimiters:\n      - pb\n      - PB\n      - proto\n      - PROTO\n    EnclosingFunctions:\n      - EqualsProto\n      - EquivToProto\n      - PARSE_PARTIAL_TEXT_PROTO\n      - PARSE_TEST_PROTO\n      - PARSE_TEXT_PROTO\n      - ParseTextOrDie\n      - ParseTextProtoOrDie\n      - ParseTestProto\n      - ParsePartialTestProto\n    CanonicalDelimiter: ''\n    BasedOnStyle:    google\nReflowComments:  true\nSortIncludes:    true\nSortJavaStaticImport: Before\nSortUsingDeclarations: true\nSpaceAfterCStyleCast: false\nSpaceAfterLogicalNot: false\nSpaceAfterTemplateKeyword: true\nSpaceBeforeAssignmentOperators: true\nSpaceBeforeCaseColon: false\nSpaceBeforeCpp11BracedList: false\nSpaceBeforeCtorInitializerColon: true\nSpaceBeforeInheritanceColon: true\nSpaceBeforeParens: ControlStatements\nSpaceAroundPointerQualifiers: Default\nSpaceBeforeRangeBasedForLoopColon: true\nSpaceInEmptyBlock: false\nSpaceInEmptyParentheses: false\nSpacesBeforeTrailingComments: 2\nSpacesInAngles:  false\nSpacesInConditionalStatement: false\nSpacesInContainerLiterals: true\nSpacesInCStyleCastParentheses: false\nSpacesInParentheses: false\nSpacesInSquareBrackets: false\nSpaceBeforeSquareBrackets: false\nBitFieldColonSpacing: Both\nStandard:        Auto\nStatementMacros:\n  - Q_UNUSED\n  - QT_REQUIRE_VERSION\nTabWidth:        8\nUseCRLF:         false\nUseTab:          Never\nWhitespaceSensitiveMacros:\n  - STRINGIZE\n  - PP_STRINGIZE\n  - BOOST_PP_STRINGIZE\n  - NS_SWIFT_NAME\n  - CF_SWIFT_NAME\n...\n\n"
        },
        {
          "name": ".clang-tidy",
          "type": "blob",
          "size": 7.7109375,
          "content": "---\nChecks:     '\n            bugprone-*,\n            clang-analyzer-*,\n            google-*,\n            modernize-*,\n            performance-*,\n            portability-*,\n            -readability-*,\n            -cppcoreguidelines-*,\n            -bugprone-easily-swappable-parameters,\n            -bugprone-implicit-widening-of-multiplication-result,\n            -bugprone-reserved-identifier,\n            -bugprone-signed-char-misuse,\n            -bugprone-branch-clone,\n            -clang-analyzer-cplusplus.NewDelete,\n            -clang-analyzer-cplusplus.NewDeleteLeaks,\n            -clang-analyzer-security.insecureAPI.rand,\n            -clang-analyzer-cplusplus.InnerPointer,\n            -clang-analyzer-core.CallAndMessage,\n            -clang-analyzer-deadcode.DeadStores,\n            -clang-diagnostic-implicit-int-float-conversion,\n            -clang-diagnostic-unused-command-line-argument,\n            -clang-diagnostic-ignored-optimization-argument,\n            -google-readability-avoid-underscore-in-googletest-name,\n            -google-default-arguments,\n            -google-explicit-constructor,\n            -google-runtime-int,\n            -modernize-avoid-c-arrays,\n            -modernize-use-nodiscard,\n            -modernize-use-trailing-return-type,\n            -modernize-pass-by-value,\n            -modernize-concat-nested-namespaces,\n            -modernize-return-braced-init-list,\n\t\t\t      -modernize-use-equals-delete,\n\t\t\t      -modernize-redundant-void-arg,\n            -readability-convert-member-functions-to-static,\n            -readability-identifier-length,\n            -readability-function-cognitive-complexity,\n            -readability-magic-numbers,\n            -readability-make-member-function-const,\n            -readability-qualified-auto,\n            -readability-redundant-access-specifiers,\n            -readability-function-size,\n            -readability-else-after-return,\n            -readability-use-anyofallof,\n            -readability-implicit-bool-conversion,\n            -use_of_tag_name_without_tag,\n            '\n# naming check\nCheckOptions:\n  - { key: readability-identifier-naming.ClassCase,                value: CamelCase  }\n  - { key: readability-identifier-naming.EnumCase,                 value: CamelCase  }\n  - { key: readability-identifier-naming.FunctionCase,             value: CamelCase  }\n  - { key: readability-identifier-naming.NamespaceCase,            value: lower_case }\n  - { key: readability-identifier-naming.StructCase,               value: CamelCase  }\n  - { key: readability-identifier-naming.UnionCase,                value: CamelCase  }\n  - { key: readability-identifier-naming.TemplateParameterCase,    value: CamelCase  }\n  - { key: readability-identifier-naming.MacroDefinitionCase,      value: UPPER_CASE }\n  \n  - { key: readability-identifier-naming.GlobalConstantCase,       value: CamelCase  }\n  - { key: readability-identifier-naming.GlobalConstantPrefix,     value: k          }\n  - { key: readability-identifier-naming.MemberConstantCase,       value: CamelCase  }\n  - { key: readability-identifier-naming.MemberConstantPrefix,     value: k          }\n  - { key: readability-identifier-naming.EnumConstantCase,         value: CamelCase  }\n  - { key: readability-identifier-naming.EnumConstantPrefix,       value: k          }\n  # - { key: readability-identifier-naming.StaticConstantCase,       value: CamelCase  }\n  # - { key: readability-identifier-naming.StaticConstantPrefix,     value: k          }\n  # - { key: readability-identifier-naming.ConstantCase,             value: CamelCase  }\n  # - { key: readability-identifier-naming.ConstantPrefix,           value: k          }\n  # - { key: readability-identifier-naming.ConstantParameterCase,     value: lower_case}\n\n  - { key: readability-identifier-naming.GlobalVariableCase,       value: lower_case }\n  - { key: readability-identifier-naming.GlobalVariablePrefix,     value: g_pika_    }\n  - { key: readability-identifier-naming.VariableCase,             value: lower_case }\n  \n  - { key: readability-identifier-naming.PublicMethodCase,         value: CamelCase  }\n  - { key: readability-identifier-naming.PrivateMethodCase,        value: camelBack  }\n  - { key: readability-identifier-naming.ProtectedMethodCase,      value: camelBack  }\n  - { key: readability-identifier-naming.MemberCase,               value: lower_case }\n  - { key: readability-identifier-naming.MemberSuffix,             value: _          }\n\nWarningsAsErrors: '*'\nHeaderFilterRegex: '((pstd|net|storage)/include/.+\\.h|include/pika_.+\\.h)'\nAnalyzeTemporaryDtors: true\n\n#### Disabled checks and why: #####\n#\n# -readability-convert-member-functions-to-static,\n#     This check started going off in the upgrade from clang-tidy-8 to clang-tidy-12.  It is not always correct because \n#     we hide the reference implementation in another repository.\n# -clang-analyzer-security.insecureAPI.rand, -clang-analyzer-security.insecureAPI.rand, -bugprone-unhandled-self-assignment, \n# -bugprone-implicit-widening-of-multiplication-result\n#     These have not been investigated yet.\n# -bugprone-reserved-identifier, \n#     Fails due to use of some __SHORT_FILE__ symbol, originating from very old code.\n# -bugprone-suspicious-include, \n#     False positive due to GTest code.\n# -bugprone-too-small-loop-variable,\n#     Complains about uint8_t or uint16_t when the limit on the loop is a container's .size() (size_t).\n#     We usually do this when we know the maximum size of the container though, so propose leaving disabled.\n# -clang-analyzer-cplusplus.NewDelete,\n#     Seems to generate false positives. Suggest relying on ASAN and valgrind for memory stuff.\n# -clang-analyzer-cplusplus.NewDeleteLeaks,\n#     Seems to generate false positives. Suggest relying on ASAN and valgrind for memory stuff.\n# -modernize-use-nodiscard,\n#     New C++17 feature, slightly polarizing. Would clutter codebase.\n# -modernize-avoid-c-arrays,\n#     Let's not deal with people doing ridiculous things to hack around this. If it bites them, it bites them.\n# -bugprone-signed-char-misuse, -clang-diagnostic-implicit-int-float-conversion, -readability-make-member-function-const, \n# -readability-qualified-auto, -readability-redundant-access-specifiers\n#     These were previously disabled for not being available in clang-tidy-8. They are now available on our clang-tidy-12, \n#     and potentially worth investigating/fixing.\n# -bugprone-exception-escape\n#     Weird. No idea how to resolve.\n# -bugprone-branch-clone,\n#    frequent misidentification\n# -google-default-arguments\n#    Too many virtual functions in pika have default parameters, specifically void Do(std::shared_ptr<Partition> partition = nullptr)\n# -clang-analyzer-cplusplus.InnerPointer\n#     I don't know why this bug in the RocksDB library fails to suppress detection.So I have to disable this check.\n#--google-explicit-constructor\n#     There are so many implicit convert in pika\n#--use_of_tag_name_without_tag\n#     like class member is class , If there is no class tag, an error will be reported\n#     class A{  B b_;  } -> error ;  class A{  class B b_;  } -> no error ; \n#-clang-analyzer-core.CallAndMessage\n#     pika/src/storage/src/scope_record_lock.h \n#     Always detect a null pointer and call the TryLock method\n#     Called C++ object pointer is null [clang-analyzer-core.CallAndMessage,-warnings-as-errors]\n#     lock_mgr_->UnLock(key);\n#-clang-analyzer-deadcode.DeadStores\n#    error detection in some places\n#-google-runtime-int\n#    todo discussed, because there are so many of `long` and `long long` in pika, so disable for now\n#-clang-diagnostic-unused-command-line-argument\n#    because there are to many compile command error in github ci, but no error in local environment\n#    See in build folder compile_commands.json\n#-clang-diagnostic-ignored-optimization-argument\n#    The reason disabled this is same as above.\n"
        },
        {
          "name": ".dockerignore",
          "type": "blob",
          "size": 0.619140625,
          "content": "# Compiled Object files\n*.slo\n*.lo\n*.o\n*.obj\n*pb.cc\n*pb.h\n\n# Precompiled Headers\n*.gch\n*.pch\n\n# Compiled Dynamic libraries\n*.so\n*.dylib\n*.dll\n\n# Fortran module files\n*.mod\n\n# Compiled Static libraries\n*.lai\n*.la\n*.a\n*.lib\n\n# Executables\n*.exe\n*.out\n*.app\n\n# Log path\nmake_config.mk\nlog/\nlib/\ntools/aof_to_pika\ntools/benchmark_client\ntools/binlog_sender\ntools/codis2pika\ntools/kubeblocks_helm\ntools/manifest_generator\ntools/pika-port\ntools/pika_keys_analysis\ntools/pika_to_txt\ntools/rdb_to_pika\ntools/redis-copy\ntools/txt_to_pika\ndocker/\noutput/\n\n# DB\ndb/\ndump/\n\n# third party\ngdb.txt\ntags\n\nmake_config.mk\nsrc/*.d\nsrc/build_version.cc\n"
        },
        {
          "name": ".gitattributes",
          "type": "blob",
          "size": 0.025390625,
          "content": "tests/* linguist-vendored\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.62890625,
          "content": "# vim temp files\n*.swp\n# Compiled Object files\n*.slo\n*.lo\n*.o\n*.obj\n*pb.cc\n*pb.h\nbuild\ncmake-build-debug\ncmake-build-release\n\n# Precompiled Headers\n*.gch\n*.pch\n\n# Compiled Dynamic libraries\n*.so\n*.dylib\n*.dll\n\n\n# Compiled Static libraries\n*.lai *.la\n*.a\n*.lib\n\n# Executables\n*.exe\n*.out\n*.app\n\n# Log path\nmake_config.mk\nlog/\nlib/\noutput/\n\n# DB\ndb/\ndump/\nsrc/dbsync/\n\n# third party\ngdb.txt\ntags\n\n# IDE\n.vscode\n.DS_Store\n\n# generate\nmake_config.mk\nsrc/*.d\nsrc/build_version.cc\n\n#cache\n.cache\n\n.idea/\n\n\n#build\nbuild/\nbuildtrees\ndeps\npkg\n\n#develop container\n.devcontainer\n\n# include codis fe javascript lib files\n!codis/cmd/fe/assets/**\n\ntests/tmp\n"
        },
        {
          "name": ".gitmodule",
          "type": "blob",
          "size": 0.484375,
          "content": "[submodule \"tools/pika_migrate/third/blackwidow\"]\n        url = https://github.com/Qihoo360/blackwidow.git\n[submodule \"tools/pika_migrate/third/slash\"]\n        url = https://github.com/Qihoo360/slash.git\n[submodule \"tools/pika_migrate/third/pink\"]\n        url = https://github.com/Qihoo360/pink.git\n[submodule \"tools/pika_migrate/third/glog\"]\n        url = https://github.com/Qihoo360/glog.git\n[submodule \"tools/pika_migrate/third/rocksdb\"]\n        url = https://github.com/facebook/rocksdb.git\n\n"
        },
        {
          "name": ".travis.yml",
          "type": "blob",
          "size": 0.5009765625,
          "content": "sudo: required\ndist: trusty\nlanguage: cpp\n\nos:\n  - linux\n\nenv:\n  global:\n    - PROTOBUF_VERSION=2.5.0\n\ninstall:\n  - wget https://github.com/protocolbuffers/protobuf/releases/download/v$PROTOBUF_VERSION/protobuf-$PROTOBUF_VERSION.tar.bz2\n  - tar xvf protobuf-$PROTOBUF_VERSION.tar.bz2\n  - ( cd protobuf-$PROTOBUF_VERSION && ./configure --prefix=/usr && make -j$(nproc) && sudo make install )\n\naddons:\n  apt:\n    packages: ['libsnappy-dev', 'libprotobuf-dev', 'libgoogle-glog-dev']\n\ncompiler:\n  - gcc\n\nscript: make\n"
        },
        {
          "name": "CHANGELOG.MD",
          "type": "blob",
          "size": 80.1416015625,
          "content": "# V4.0.2\n\n## New features\n\n- After the Pika slave instance executes slaveof no one to remove the replication relationship with the master node, the slaveof information is persisted into the configuration file. [#2973](https://github.com/OpenAtomFoundation/pika/pull/2973) @[cheniujh](https://github.com/cheniujh)\n\n- Added support for backup and recovery in master-slave mode for Pika-Operator. [#2968](https://github.com/OpenAtomFoundation/pika/pull/2968) @[buzhimingyonghu](https://github.com/buzhimingyonghu)\n\n- Added the `log-net-activities` parameter in the configuration file to dynamically enable or disable the logging of certain connection-related activities. This can be adjusted with `config get/set`. [#2964](https://github.com/OpenAtomFoundation/pika/pull/2964) @[cheniujh](https://github.com/cheniujh)\n\n- Added the `repl_connect_status` metric to Pika info and integrated it into `pika_exporter` to facilitate monitoring of the replication status. [#2961](https://github.com/OpenAtomFoundation/pika/pull/2961) @[cheniujh](https://github.com/cheniujh)\n\n- Upgraded `kubeblocks` to version 0.9, improving and optimizing Pika-Operator to simplify code and support instance scale-down. [#2860](https://github.com/OpenAtomFoundation/pika/pull/2860) @[XiaoLiang2333](https://github.com/XiaoLiang2333)\n\n- Pika-Operator now supports starting in master-slave mode. See the README document for more details. [#2903](https://github.com/OpenAtomFoundation/pika/pull/2903) @[XiaoLiang2333](https://github.com/XiaoLiang2333)\n\n- Added `keyspace_hits` and `keyspace_misses` metrics to `pika_exporter`, enabling users to monitor key hit rates. [#2579](https://github.com/OpenAtomFoundation/pika/pull/2579) @[chenbt](https://github.com/chenbt)\n\n- RedisCache now avoids storing large keys to prevent excessive memory usage or the eviction of frequently accessed hot keys, which could impact performance. [#2557](https://github.com/OpenAtomFoundation/pika/pull/2557) @[QlQlqiqi](https://github.com/QlQlqiqi)\n\n## Improvement\n\n- Pika now supports dynamically modifying the `max-subcompactions` parameter to optimize the `compact` operation for L0 layers at runtime. [#2965](https://github.com/OpenAtomFoundation/pika/pull/2965) @[cheniujh](https://github.com/cheniujh)\n\n- Improved the `log-retention-time` parameter to dynamically adjust the number of days for log retention. [#2963](https://github.com/OpenAtomFoundation/pika/pull/2963) @[cheniujh](https://github.com/cheniujh)\n\n- Moved the `Pika-Migrate` code to the `tools` folder to simplify binary compilation in different environments for data migration. [#2941](https://github.com/OpenAtomFoundation/pika/pull/2941) @[chenbt-hz](https://github.com/chenbt-hz)\n\n- Added Go tests for Pika complex data types and management commands to ensure service stability. [#2840](https://github.com/OpenAtomFoundation\n\n- Updated the `actions/checkout` in GitHub Actions workflow to v5 for enhanced security and performance. [#2833](https://github.com/OpenAtomFoundation/pika/pull/2833) @[baerwang](https://github.com/baerwang)\n\n- Added a new compact strategy in Pika to optimize write performance by prioritizing files unused for the longest time or files with the most deleted entries. [#2557](https://github.com/OpenAtomFoundation/pika/pull/2557) @[QlQlqiqi](https://github.com/QlQlqiqi)\n\n## Bugfix\n\n- Fixed the `rpoplpush` command cache update issue, which caused inconsistency between the database and cache. [#2976](https://github.com/OpenAtomFoundation/pika/pull/2976) @[cheniujh](https://github.com/cheniujh)\n\n- Fixed compatibility issues between different versions of Pika-Exporter, which caused excessive logging and wasted disk resources. [#2971](https://github.com/OpenAtomFoundation/pika/pull/2971) @[buzhimingyonghu](https://github.com/buzhimingyonghu)\n\n- Adjusted the log level of `slowlog` to INFO to address the issue of triple logging, which consumed excessive disk space. [#2948](https://github.com/OpenAtomFoundation/pika/pull/2948) @[buzhimingyonghu](https://github.com/buzhimingyonghu)\n\n- Improved CI stability by resolving specific failure issues. [#2937](https://github.com/OpenAtomFoundation/pika/pull/2937) @[chejinge](https://github.com/chejinge)\n\n- Fixed an issue where Pika instances could not set administrator passwords independently. [#2920](https://github.com/OpenAtomFoundation/pika/issues/2920) @[buzhimingyonghu](https://github.com/buzhimingyonghu)\n\n- Resolved a reference counter destructor issue in the epoll loop for `std::shared_ptr in_conn` objects, ensuring Pika connections are closed in a timely manner. [#2904](https://github.com/OpenAtomFoundation/pika/pull/2904) @[cheniujh](https://github.com/cheniujh)\n\n- Fixed a cache inconsistency issue caused by the `zpopmin` command during deletion operations. [#2892](https://github.com/OpenAtomFoundation/pika/issues/2892) @[chejinge](https://github.com/chejinge)\n\n\n\n# V4.0.1\n\n## New Features\n\n- Added a switch for the RTC function. If `Get`/`HGet` misses the cache on the RTC path, when it moves to the normal path, it directly reads from the DB without reading from the cache [#2841](https://github.com/OpenAtomFoundation/pika/pull/2841) @[cheniujh](https://github.com/cheniujh)\n\n- Optimized the Pika access cache with the RTC model to improve read performance of the Pika service [#2837](https://github.com/OpenAtomFoundation/pika/pull/2837) @[cheniujh](https://github.com/cheniujh)\n\n- Added a scheduled task for log deletion, set to delete logs every 7 days by default. This can be configured in the config file based on your needs [#2829](https://github.com/OpenAtomFoundation/pika/pull/2829) @[XiaoLiang2333](https://github.com/XiaoLiang2333)\n\n## Improvement\n\n- Added a data cleaning function to facilitate users in cleaning data during upgrades [#2888](https://github.com/OpenAtomFoundation/pika/pull/2888) @[QlQlqiqi](https://github.com/QlQlqiqi)\n\n- Changed the value in Floyd’s stored `data` field to milliseconds to be compatible with Redis commands [#2857](https://github.com/OpenAtomFoundation/pika/pull/2857) @[luky116](https://github.com/luky116)\n\n- The `flushall` command now writes `flushdb` to the binlog. If in multi-DB mode, a separate log is written for each DB to ensure correct consumption order by replica nodes [#2846](https://github.com/OpenAtomFoundation/pika/pull/2846) @[cheniujh](https://github.com/cheniujh)\n\n- Removed unnecessary logs to avoid excessive disk usage, which could impact data read/write operations [#2840](https://github.com/OpenAtomFoundation/pika/pull/2840) @[chejinge](https://github.com/chejinge)\n\n- The `incr` and `append` commands use `pksetexat` when transferring binlog to prevent incorrect operations that could cause data expiration issues, leading to dirty data [#2833](https://github.com/OpenAtomFoundation/pika/pull/2833) @[chejinge](https://github.com/chejinge)\n\n- Modified the Pika replica node binlog consumption thread model to ensure the consumption order of `binlog` [#2708](https://github.com/OpenAtomFoundation/pika/pull/2708) @[cheniujh](https://github.com/cheniujh)\n\n- Added more RocksDB metrics by introducing the `open_rocksdb_statistics_tickers` field in the configuration. By default, it's set to `no`, but turning it on will incur an additional 1.5% performance cost [#2658](https://github.com/OpenAtomFoundation/pika/pull/2658) @[baixin01](https://github.com/baixin01)\n\n## Bugfix\n\n- Fixed inaccurate cache data usage by Pika, which caused incorrect monitoring results [#2899](https://github.com/OpenAtomFoundation/pika/pull/2899) @[chejinge](https://github.com/chejinge)\n\n- Fixed the issue where an exception error signal from the `zremrangebyrank` command could cause Pika to crash [#2891](https://github.com/OpenAtomFoundation/pika/pull/2891) @[chejinge](https://github.com/chejinge)\n\n- Fixed the issue where the `Rpushx` command did not update RedisCache, leading to DB and cache inconsistency [#2879](https://github.com/OpenAtomFoundation/pika/pull/2879) @[hahahashen](https://github.com/hahahashen)\n\n- Fixed the incorrect connection termination process in the `kill client` command [#2862](https://github.com/OpenAtomFoundation/pika/pull/2862) @[cheniujh](https://github.com/cheniujh)\n\n- Fixed the issue where `blpop`/`brpop` did not update the cache when updating the DB, potentially causing inconsistency between RocksDB and RedisCache [#2858](https://github.com/OpenAtomFoundation/pika/pull/2858) @[cheniujh](https://github.com/cheniujh)\n\n- Fixed the issue where Pika did not support Redis-Sentinel [#2854](https://github.com/OpenAtomFoundation/pika/pull/2854) @[cheniujh](https://github.com/cheniujh)\n\n- Fixed inconsistent results when executing the `hincrby` command multiple times [#2836](https://github.com/OpenAtomFoundation/pika/pull/2836) @[luky116](https://github.com/luky116)\n\n- Replaced CentOS with Rocky as the default environment for GitHub CI. The process now supports MacOS/Ubuntu/Rocky [#2823](https://github.com/OpenAtomFoundation/pika/pull/2823) @[QlQlqiqi](https://github.com/QlQlqiqi)\n\n- Modified the `client watch` mechanism, where keys will become invalid if modified by anyone (including the client itself) [#2815](https://github.com/OpenAtomFoundation/pika/pull/2815) @[luky116](https://github.com/luky116)\n\n- Resolved inaccurate `slave_priority` assignment in Pika, which could cause the replica node to fail to promote to master, preventing the use of Redis-Sentinel [#2813](https://github.com/OpenAtomFoundation/pika/pull/2813) @[chejinge](https://github.com/chejinge)\n\n- Transaction commands now update both DB and RedisCache to avoid inconsistencies between the two [#2812](https://github.com/OpenAtomFoundation/pika/pull/2812) @[luky116](https://github.com/luky116)\n\n- Optimized master-slave replication to ensure that the SlaveNode on the master enters DBSync state before submitting the `bgsave` task, preventing binlog deletion during extreme cases while `bgsave` is being executed [#2798](https://github.com/OpenAtomFoundation/pika/pull/2798) @[cheniujh](https://github.com/cheniujh)\n\n- Modified the binlog handling logic during master-slave replication to ensure sequential execution and prevent inconsistencies between master and replica [#2794](https://github.com/OpenAtomFoundation/pika/pull/2794) @[cheniujh](https://github.com/cheniujh)\n\n- Fixed inaccurate BlockCache calculations [#2797](https://github.com/OpenAtomFoundation/pika/pull/2797) @[bigdaronlee163](https://github.com/bigdaronlee163)\n\n- Added flag bits, timestamps, and return value mechanisms to ensure Pika correctly handles conflicts when executing `flushdb` while processing asynchronous deletion of old directories [#2790](https://github.com/OpenAtomFoundation/pika/pull/2790) @[cheniujh](https://github.com/cheniujh)\n\n- Fixed the issue where inconsistent data amounts between master and replica during Redis-Sentinel failover could cause the state transition to error [#2766](https://github.com/OpenAtomFoundation/pika/pull/2766) @[cheniujh](https://github.com/cheniujh)\n\n- Fixed the issue where multiple replica instance expansions could cause full replication to fail [#2756](https://github.com/OpenAtomFoundation/pika/pull/2756) @[cheniujh](https://github.com/cheniujh)\n\n\n# v3.5.5\n\n## New Features\n\n- Add a switch for the RTC model, allowing control over whether to enable the RTC model[#2841](https://github.com/OpenAtomFoundation/pika/pull/2841)@[cheniujh](https://github.com/cheniujh)\n\n- Use the RTC model to handle Pika access caching, improving Pika's read performance #2837 by[#2837](https://github.com/OpenAtomFoundation/pika/pull/2837)@[cheniujh](https://github.com/cheniujh)\n\n- For the incr and append commands, use the pksetexat command during binlog transmission to prevent data from not expiring due to incorrect operations, which could result in stale data[#2833](https://github.com/OpenAtomFoundation/pika/pull/2833)@[chejinge](https://github.com/chejinge)\n\n- Add a scheduled task to delete logs, which by default deletes logs every 7 days. This can be configured in the config file based on your needs[#2829](https://github.com/OpenAtomFoundation/pika/pull/2829)@[XiaoLiang2333](https://github.com/XiaoLiang2333)\n\n- Move management commands out of the main thread to prevent blocking the main thread due to frequent or time-consuming management command calls[#2727](https://github.com/OpenAtomFoundation/pika/pull/2727)@[chejinge](https://github.com/chejinge)\n\n- Organize Pika threads to avoid resource waste caused by starting unnecessary threads [#2697](https://github.com/OpenAtomFoundation/pika/pull/2697)@[chejinge](https://github.com/chejinge)\n\n- Add the Pika benchmark tool to improve testing efficiency and generate visualized statistical charts.[#2697](https://github.com/OpenAtomFoundation/pika/pull/2697)@[chejinge](https://github.com/chejinge)\n\n\n## Improvements\n\n- Optimize master-slave replication to ensure that the SlaveNode on the Master side enters the DBSync state before submitting the bgsave task, preventing the binlog from being cleared during the bgsave execution in extreme cases[#2798](https://github.com/OpenAtomFoundation/pika/pull/2798)@[cheniujh](https://github.com/cheniujh)\n\n- Support dynamic adjustment of more RocksDB parameters, allowing users to adjust parameters based on different business scenarios to improve Pika's read and write performance[#2728](https://github.com/OpenAtomFoundation/pika/pull/2728)@[cheniujh](https://github.com/cheniujh)\n\n- Optimize the locking mechanism when applying binlog to reduce unnecessary lock contention[#2773](https://github.com/OpenAtomFoundation/pika/pull/2773)@[cheniujh](https://github.com/cheniujh)\n\n- Add TCL tests for the Geo data type and fix bugs encountered during testing[#2753](https://github.com/OpenAtomFoundation/pika/pull/2753)@[saz97](https://github.com/saz97)\n\n- Update the Pika Docker README, allowing deployment of the Pika service in Docker according to the README[#2743](https://github.com/OpenAtomFoundation/pika/pull/2743)@[luky116](https://github.com/luky116)\n\n- The Pkpatternmatchdel command now supports deleting Redis Stream data types[#2723](https://github.com/OpenAtomFoundation/pika/pull/2723)@[wangshao1](https://github.com/wangshao1)\n\n- Add a replication status metric repl_connect_status, making it easier for operations personnel to clearly determine the current master-slave replication status[#2656](https://github.com/OpenAtomFoundation/pika/pull/2656)@[cheniujh](https://github.com/cheniujh)\n\n- Refactor the master-slave replication thread model on the slave node to minimize binlog consumption blocking issues[#2638](https://github.com/OpenAtomFoundation/pika/pull/2638)@[cheniujh](https://github.com/cheniujh)\n\n- Add dynamic adjustment parameters for the RocksDB Compaction strategy, allowing users to adjust the Compaction strategy according to their business needs to reduce the performance impact of the Compaction operation [#2538](https://github.com/OpenAtomFoundation/pika/pull/2735)@[wangshao1](https://github.com/wangshao1)\n\n\n## Bugfixes\n\n- Modify the timeout for the Pika automated test client to connect to the server, preventing test failures due to long disconnections[#2863](https://github.com/OpenAtomFoundation/pika/pull/2863)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed an incorrect process in the kill client command for terminating connections [#2862](https://github.com/OpenAtomFoundation/pika/pull/2862)@[cheniujh](https://github.com/cheniujh)\n\n- Fix an issue where blpop/brpop would not update the RedisCache when updating the database, which could cause inconsistencies between the RocksDB and the RedisCache [#2858](https://github.com/OpenAtomFoundation/pika/pull/2858)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed an issue where Pika did not support Redis-Sentinel.[#2854](https://github.com/OpenAtomFoundation/pika/pull/2854)@[cheniujh](https://github.com/cheniujh)\n\n- Modify the flushall logic to avoid multiple data cleanups during unified processing[#2846](https://github.com/OpenAtomFoundation/pika/pull/2846)@[cheniujh](https://github.com/cheniujh)\n\n- The GitHub CI (Continuous Integration) workflow will support three environments overall: macOS, Ubuntu, and Rocky[#2823](https://github.com/OpenAtomFoundation/pika/pull/2823)@[QlQlqiqi](https://github.com/QlQlqiqi)\n\n- The PkPatternMatchDel command now deletes RedisCache entries along with the database entries, preventing inconsistencies between the RocksDB and the RedisCache. [#2839](https://github.com/OpenAtomFoundation/pika/pull/2839)@[chejinge](https://github.com/chejinge)\n\n- Optimize the scope of read locks to avoid inconsistencies between master and slave data due to repeated binlog consumption #2818 by[#2818](https://github.com/OpenAtomFoundation/pika/pull/2818)@[cheniujh](https://github.com/cheniujh)\n\n- Modify the client watch key so that it becomes invalid if modified by anyone (including the client's own modifications)[#2815](https://github.com/OpenAtomFoundation/pika/pull/2815)@[luky116](https://github.com/luky116)\n\n- Modified the default value of slave_priority to prevent master-slave switch failures due to the absence of this setting by operations personnel.[#2813](https://github.com/OpenAtomFoundation/pika/pull/2813)@[chejinge](https://github.com/chejinge)\n\n- The MULTI command now updates the cache simultaneously when updating the database, preventing issues with data retrieval.[#2812](https://github.com/OpenAtomFoundation/pika/pull/2812)@[luky116](https://github.com/luky116)\n\n- Fixed the issue of Sentinel role reversal errors during master-slave switching caused by data inconsistency between the master and slave nodes during the switch[#2808](https://github.com/OpenAtomFoundation/pika/pull/2808)@[cheniujh](https://github.com/cheniujh)\n\n- Modified the handling logic of flushdb binlog during master-slave replication to ensure sequential execution, preventing inconsistencies between master and slave data. [#2808](https://github.com/OpenAtomFoundation/pika/pull/2808)@[cheniujh](https://github.com/cheniujh)\n\n- Fix an issue where an error log would be output when executing slaveof no one[#2800](https://github.com/OpenAtomFoundation/pika/pull/2800)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed inaccuracies in Pika block-cache information calculation, which resulted in incorrect memory usage calculations.[#2797](https://github.com/OpenAtomFoundation/pika/pull/2797)@[bigdaronlee163](https://github.com/bigdaronlee163)\n\n- Modify the Handling Logic of FLUSHDB in Binlog During Master-Slave Replication to Ensure Sequential Execution and Prevent Inconsistencies Between Master and Slave[#2794](https://github.com/OpenAtomFoundation/pika/pull/2794)@[cheniujh](https://github.com/cheniujh)\n\n- Added flag, timestamp, and return value mechanisms to ensure correct handling of conflicts when executing flushdb and processing asynchronous deletion of old directories in Pika.[#2790](https://github.com/OpenAtomFoundation/pika/pull/2790)@[cheniujh](https://github.com/cheniujh)\n\n- Fix an issue where the PKPatternMatchDel command did not delete the iterator, which could result in incomplete data deletion in RocksDB[#2786](https://github.com/OpenAtomFoundation/pika/pull/2786)@[wangshao1](https://github.com/wangshao1)\n\n- Rename timerTaskThread_ to timer_task_thread_[#2776](https://github.com/OpenAtomFoundation/pika/pull/2776)@[cheniujh](https://github.com/cheniujh)\n\n- Fix an issue where the min-blob-size parameter would fail to parse, causing errors in KV separation[#2767](https://github.com/OpenAtomFoundation/pika/pull/2767)@[wangshao1](https://github.com/wangshao1)\n\n- Fix the issue of incorrect state reversal during sentinel master-slave switch caused by data inconsistency between the master and slave nodes [#2766](https://github.com/OpenAtomFoundation/pika/pull/2766) @[cheniujh](https://github.com/cheniujh)\n\n- Fix an issue where the Zverank command would calculate incorrectly, leading to erroneous return values[#2763](https://github.com/OpenAtomFoundation/pika/pull/2763)@[chejinge](https://github.com/chejinge)\n\n- Fix an issue where the Pksetat command did not update the RedisCache while updating the database, which could cause inconsistencies between the RocksDB and the RedisCache.[#2759](https://github.com/OpenAtomFoundation/pika/pull/2759)@[chejinge](https://github.com/chejinge)\n\n- Fixed an error occurring during data migration with Pika-port.[#2758](https://github.com/OpenAtomFoundation/pika/pull/2758)@[guangkun123](https://github.com/guangkun123)\n\n- Fix an issue where the RsynClient did not handle failures after an abnormal exit, resulting in incomplete data during full replication[#2756](https://github.com/OpenAtomFoundation/pika/pull/2756)@[cheniujh](https://github.com/cheniujh)\n\n- Fix an issue where Pika could not be expanded in batches[#2746](https://github.com/OpenAtomFoundation/pika/pull/2746)@[cheniujh](https://github.com/cheniujh)\n\n- Corrected uninitialized parameters in slotsscan and bgsave commands to ensure proper balancing.[#2745](https://github.com/OpenAtomFoundation/pika/pull/2745)@[chejinge](https://github.com/chejinge)\n\n- Fix an issue where incorrect return values from the SlotMigrate command could interrupt data migration[#2741](https://github.com/OpenAtomFoundation/pika/pull/2741)@[wangshao1](https://github.com/wangshao1)\n\n- Pksetexat updates the RedisCache while updating the database to avoid inconsistencies between the RocksDB and the RedisCache.[#2736](https://github.com/OpenAtomFoundation/pika/pull/2736) @[longfar-ncy](https://github.com/longfar-ncy)\n\n- Fix an issue where the RedisCache layer could cause inconsistencies between\n  the RocksDB and the RedisCache due to not using the TTL parsed by the storage layer[#2729](https://github.com/OpenAtomFoundation/pika/pull/2729)@[luky116](https://github.com/luky116)\n\n- Fix an issue where Stream-type data could not be compacted by RocksDB, causing expired data to persist[#2724](https://github.com/OpenAtomFoundation/pika/pull/2724)@[wangshao1](https://github.com/wangshao1)\n\n- Fix an issue where ACL authentication might fail sporadically[#2714](https://github.com/OpenAtomFoundation/pika/pull/2714)@[luky116](https://github.com/luky116)\n\n- Fixed an issue where Pika cmdID assignment in the Cmd initialization function could cause data  race  during concurrent construction.[#2692](https://github.com/OpenAtomFoundation/pika/pull/2692)@[gukj-spel](https://github.com/gukj-spel)\n\n- Fixed a potential race condition in Spop when writing binlog.[#2674](https://github.com/OpenAtomFoundation/pika/pull/2674)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed a data race issue in server_stat.[#2671](https://github.com/OpenAtomFoundation/pika/pull/2671)@[cheniujh](https://github.com/cheniujh)\n\n- Enhanced the full sync process to automatically retry after a timeout in multi-DB environments..[#2667](https://github.com/OpenAtomFoundation/pika/pull/2667)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed a potential window crash issue under timeout scenarios in multi-DB master-slave environments.[#2666](https://github.com/OpenAtomFoundation/pika/pull/2666)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed repeated unlocking issues in master-slave sync rate limiting logic.[#2657](https://github.com/OpenAtomFoundation/pika/pull/2657)@[cheniujh](https://github.com/cheniujh)\n\n# v4.0.0\n\n## New features\n\n- Added TCL tests for Pika Geo data type and fixed defects found during testing.[#2753](https://github.com/OpenAtomFoundation/pika/pull/2753)@[saz97](https://github.com/saz97)\n\n- Pika now supports compilation and packaging on the FreeBSD14 platform.[#2711](https://github.com/OpenAtomFoundation/pika/pull/2711)@[lqxhub](https://github.com/lqxhub)\n\n- Pika thread reorganization to avoid starting too many unnecessary threads, Threads are named for easier issue localization. [#2697](https://github.com/OpenAtomFoundation/pika/pull/2697)@[chejinge](https://github.com/chejinge)\n\n- Mget supports multi-key query caching. Keys that miss are recorded and queried in the DB, improving Pika service read performance. [#2675](https://github.com/OpenAtomFoundation/pika/pull/2675)@[chejinge](https://github.com/chejinge)\n\n- Codis supports the info command, allowing querying of Codis-proxy's info information. [#2688](https://github.com/OpenAtomFoundation/pika/pull/2688)@[chienguo](https://github.com/chienguo)\n\n- Added Gtest for Floyd's compaction-filter.[#2669](https://github.com/OpenAtomFoundation/pika/pull/2669)@[Mixficsol](https://github.com/Mixficsol)\n\n- Codis-proxy adds new monitoring metrics such as P99 and P95 response times. [#2668](https://github.com/OpenAtomFoundation/pika/pull/2668)@[chejinge](https://github.com/chejinge)\n\n- Added Pika benchmarking metrics to improve benchmarking efficiency and output visualized statistical charts.[#2663](https://github.com/OpenAtomFoundation/pika/pull/2663)@[luky116](https://github.com/luky116)\n\n- Pika master-slave replication adds a new monitoring metric `repl_connect_status` to more clearly and accurately determine the current status of master-slave replication. [#2638](https://github.com/OpenAtomFoundation/pika/pull/2638)@[cheniujh](https://github.com/cheniujh)\n\n- Pika does not support duplicate keys of different types. Writing a duplicate key returns an invalid type error. [#2609](https://github.com/OpenAtomFoundation/pika/pull/2609)@[Mixficsol](https://github.com/Mixficsol)\n\n- Added support for partition index filtering.[#2601](https://github.com/OpenAtomFoundation/pika/pull/2601)@[vacheli](https://github.com/vacheli)\n\n- Pika supports the third-generation storage engine Floyd, optimizing the use of multiple rocksdb instances, the use of Blobs, and the cleanup of expired data to improve the read and write performance of Pika instances.[#2413](https://github.com/OpenAtomFoundation/pika/pull/2413)@[wangshao1](https://github.com/wangshao1)\n\n## Improvement\n\n- Updated the Pika Docker Readme to allow deploying Pika services in Docker according to the Readme. [#2743](https://github.com/OpenAtomFoundation/pika/pull/2743)@[luky116](https://github.com/luky116)\n\n- Improved query-caching mechanisms to reduce redundant meta value queries, enhancing both read and write performance of Pika services.[#2735](https://github.com/OpenAtomFoundation/pika/pull/2735)@[wangshao1](https://github.com/wangshao1)\n\n- Supports dynamic adjustment of more RocksDB parameters. Users can adjust parameters according to different business usage scenarios to improve Pika's read and write performance.[#2728](https://github.com/OpenAtomFoundation/pika/pull/2728)@[cheniujh](https://github.com/cheniujh)\n\n- Isolated types for HyperLogLog and String to ensure clear distinction between HyperLogLog and String operations.[#2720](https://github.com/OpenAtomFoundation/pika/pull/2720)@[saz97](https://github.com/saz97)\n\n- Updated PR title validation to disallow Chinese characters at the end of titles. [#2718](https://github.com/OpenAtomFoundation/pika/pull/2718)@[baerwang](https://github.com/baerwang)\n\n- Refactored the master-slave synchronization thread model for slave nodes in master-slave replication mode to minimize binlog consumption blocking issues.[#2638](https://github.com/OpenAtomFoundation/pika/pull/2638)@[cheniujh](https://github.com/cheniujh)\n\n- Added dynamic adjustment parameters for RocksDB Compaction strategy, allowing users to adjust the strategy based on their business needs to reduce the performance impact of Compaction operations.[#2538](https://github.com/OpenAtomFoundation/pika/pull/2538)@[MalikHou](https://github.com/MalikHou)\n\n## Bugfix\n\n- Solve the issue where failing to destruct 'iter' causes 'pkpatternmatchdel' not to delete 'iter' before returning, potentially leading to RocksDB perpetually referencing a version, causing data inconsistency.[#2785](https://github.com/OpenAtomFoundation/pika/pull/2785)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed an issue with parsing the config parameter min-blob-size when it includes units.[#2767](https://github.com/OpenAtomFoundation/pika/pull/2767)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed an issue with abnormal return values in ZREVRANK.[#2763](https://github.com/OpenAtomFoundation/pika/pull/2763)@[chejinge](https://github.com/chejinge)\n\n- Fixed an error occurring during data migration with Pika-port.[#2758](https://github.com/OpenAtomFoundation/pika/pull/2758)@[guangkun123](https://github.com/guangkun123)\n\n- Fixed an issue causing the Dbsize command to crash at runtime due to buffer overrun on heap allocation.  [#2749](https://github.com/OpenAtomFoundation/pika/pull/2749)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed an issue where multiple slaves connecting to the master during batch scaling could cause incomplete data on some slave nodes due to multiple bgsave operations in a short time.[#2746](https://github.com/OpenAtomFoundation/pika/pull/2746)@[cheniujh](https://github.com/cheniujh)\n\n- Corrected uninitialized parameters in slotsscan and bgsave commands to ensure proper balancing.[#2745](https://github.com/OpenAtomFoundation/pika/pull/2745)@[chejinge](https://github.com/chejinge)\n\n- Fixed an issue in Slotmigrate where return values were set incorrectly, terminating data migration in exceptional scenarios. [#2741](https://github.com/OpenAtomFoundation/pika/pull/2741)@[chejinge](https://github.com/chejinge)\n\n- Fixed an issue in Mget where not using the parsing ttl function caused some keys' ttl not to be updated, leading to data inconsistencies.[#2730](https://github.com/OpenAtomFoundation/pika/pull/2730)@[chejinge](https://github.com/chejinge)\n\n- Fixed an issue where the pkpatternmatchdel command caused anomalies in stream data deletion due to incorrect usage.[#2726](https://github.com/OpenAtomFoundation/pika/pull/2726)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed an issue where pkpatternmatchdel could not correctly delete the corresponding keys.[#2717](https://github.com/OpenAtomFoundation/pika/pull/2717)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed an ACL password verification error.[#2714](https://github.com/OpenAtomFoundation/pika/pull/2714)@[luky116](https://github.com/luky116)\n\n- Fixed an issue where the Keyspace command did not count Stream type data. [#2705](https://github.com/OpenAtomFoundation/pika/pull/2705)@[wangshao1](https://github.com/wangshao1)\n\n- Customized processing logic for some commands to avoid binlog write issues that caused binlog parsing failures on slave nodes. [#2693](https://github.com/OpenAtomFoundation/pika/pull/2693)@[cheniujh ](https://github.com/cheniujh)\n\n- Fixed an issue where Pika cmdID assignment in the Cmd initialization function could cause data  race  during concurrent construction.[#2692](https://github.com/OpenAtomFoundation/pika/pull/2692)@[gukj-spel](https://github.com/gukj-spel)\n\n- Fixed an issue where ExpectedStale did not consider String types, causing incorrect returns if there were expired String type keys.[#2682](https://github.com/OpenAtomFoundation/pika/pull/2682)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed a potential race condition in Spop when writing binlog.[#2674](https://github.com/OpenAtomFoundation/pika/pull/2674)@[cheniujh](https://github.com/cheniujh)\n\n- Added error messages for unreasonable db instance settings.[#2672](https://github.com/OpenAtomFoundation/pika/pull/2672)@[Mixficsol](https://github.com/Mixficsol)\n\n- Fixed a data race issue in server_stat.[#2671](https://github.com/OpenAtomFoundation/pika/pull/2671)@[cheniujh](https://github.com/cheniujh)\n\n- Enhanced the full sync process to automatically retry after a timeout in multi-DB environments..[#2667](https://github.com/OpenAtomFoundation/pika/pull/2667)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed a potential window crash issue under timeout scenarios in multi-DB master-slave environments.[#2666](https://github.com/OpenAtomFoundation/pika/pull/2666)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed repeated unlocking issues in master-slave sync rate limiting logic.[#2657](https://github.com/OpenAtomFoundation/pika/pull/2657)@[cheniujh](https://github.com/cheniujh)\n\n- Release now supports automatic packaging of binary compilation packages for CentOS7 and CentOS8 platforms.[#2535](https://github.com/OpenAtomFoundation/pika/pull/2535)@[baerwang](https://github.com/baerwang)\n\n- Fixed an issue where the getrange command on the Codis side did not return the expected result.[#2510](https://github.com/OpenAtomFoundation/pika/pull/2510)@[luky116](https://github.com/luky116)\n\n\n# v3.5.4\n\n## New features\n\n- Support for dynamic adjustment of full synchronization speed limit parameters rsync-timeout-ms and throttle-bytes-per-second[#2633](https://github.com/OpenAtomFoundation/pika/pull/2633)@[cheniujh](https://github.com/cheniujh)\n\n- Pika disk I/O speed limit parameters support OnlyRead, OnlyWrite, ReadAndWrite, with the default being OnlyWrite[#2599](https://github.com/OpenAtomFoundation/pika/pull/2599)@[vacheli](https://github.com/vacheli)\n\n- Display the results of info key space 1 in info all and show it on the monitoring interface [#2603](https://github.com/OpenAtomFoundation/pika/pull/2603)@[XiaoLiang2333](https://github.com/XiaoLiang2333)\n\n## Improvement\n\n- Added Go tests for the slotsmigrate[#2576](https://github.com/OpenAtomFoundation/pika/pull/2576)@[chejinge](https://github.com/chejinge)\n\n- Optimization of `INFO` command execution time, reducing disk check frequency [#2554](https://github.com/OpenAtomFoundation/pika/pull/2554) @[wangshao1](https://github.com/wangshao1)\n\n- Added Redis tcl tests for five basic data types commands [#2527](https://github.com/OpenAtomFoundation/pika/pull/2527)@[Mixficsol](https://github.com/Mixficsol)\n\n## Bugfix\n\n- Fixed an issue where using Pika Exporter could result in uneven slots distribution[#2651](https://github.com/OpenAtomFoundation/pika/pull/2651)@[chejinge](https://github.com/chejinge)\n\n- Fixed an issue where the Codis dashboard could not correctly update the master instance status[#2650](https://github.com/OpenAtomFoundation/pika/pull/2650)@[vacheli](https://github.com/vacheli)\n\n- Fixed a master-slave synchronization anomaly caused by Redis transaction binlog parsing failure[#2642](https://github.com/OpenAtomFoundation/pika/pull/2642)@[chejinge](https://github.com/chejinge)\n\n- Fixed an issue where starting Pika Exporter without parameters caused startup failure[#2640](https://github.com/OpenAtomFoundation/pika/pull/2640)@[Polaris3003](https://github.com/Polaris3003)\n\n- Fixed an issue where using Pika Operator to start a Codis-proxy cluster caused a panic[#2632](https://github.com/OpenAtomFoundation/pika/pull/2633)@[chejinge](https://github.com/chejinge)\n\n- Fixed an issue where the cp command failed during automated tests of binaries compiled in CI [#2614](https://github.com/OpenAtomFoundation/pika/pull/2614)@[cheniujh](https://github.com/cheniujh)\n\n- Fixed an issue where an uninitialized variable caused cache startup failure[#2613](https://github.com/OpenAtomFoundation/pika/pull/2613)@[chejinge](https://github.com/chejinge)\n\n- Fixed the abnormal function of dynamically modifying parameters of userpass and userblacklist[#2600](https://github.com/OpenAtomFoundation/pika/pull/2600)@[chejinge](https://github.com/chejinge)\n\n- Fix the problem of inconsistent scard sscan results[#2596](https://github.com/OpenAtomFoundation/pika/pull/2596)@[chejinge](https://github.com/chejinge)\n\n- Fix the problem that when max-rsync-parallel-num is greater than 4, slave will coredump during master-slave replication[#2595](https://github.com/OpenAtomFoundation/pika/pull/2595)@[chejinge](https://github.com/chejinge)\n\n- Adjust the number of thread pool threads that are not commonly used to avoid performance loss due to idle running[#2590](https://github.com/OpenAtomFoundation/pika/pull/2590) @[chejinge](https://github.com/chejinge)\n\n- Fix the problem of Pika transaction edge test case not passing[#2586](https://github.com/OpenAtomFoundation/pika/pull/2586) @[chejinge](https://github.com/chejinge)\n\n- change cache-model to cache-mode[#2585](https://github.com/OpenAtomFoundation/pika/pull/2585)@[chejinge](https://github.com/chejinge)\n\n- Fix the problem of `info all` deadlock after using info keyspace[#2584](https://github.com/OpenAtomFoundation/pika/pull/2584) @[chejinge](https://github.com/chejinge)\n\n- Solve the problem of incompatibility between 353 and 352 extreme scenarios caused by modifying the dictionary order of zsetscorekeycomparatorimpl[#2583](https://github.com/OpenAtomFoundation/pika/pull/2583) @[wangshao1](https://github.com/wangshao1)\n\n- Fix compact deadlock problem[#2581](https://github.com/OpenAtomFoundation/pika/pull/2581) @[chejinge](https://github.com/chejinge)\n\n- Slotmigrate add go test[#2576](https://github.com/OpenAtomFoundation/pika/pull/2576)@[chejinge](https://github.com/chejinge)\n\n- Update pika version used by `Pika Operater`[#2572](https://github.com/OpenAtomFoundation/pika/pull/2572)@[chejinge](https://github.com/chejinge)\n\n- Fix the problem of abnormal blockcache value after config rewrite[#2561](https://github.com/OpenAtomFoundation/pika/pull/2561)@[chejinge](https://github.com/chejinge)\n\n- Fixed the problem of incorrect value after slotmigrate config rewrite[#2548](https://github.com/OpenAtomFoundation/pika/pull/2548)@[chejinge](https://github.com/chejinge)\n\n- Fix the problem that spop may cause inconsistency between master and slave data[#2541](https://github.com/OpenAtomFoundation/pika/pull/2541)@[chenbt-hz](https://github.com/chenbt-hz)\n\n- Fix the problem of out of bounds in CloseFd(it->second[i])[#2539](https://github.com/OpenAtomFoundation/pika/pull/2539)@[chejinge](https://github.com/chejinge)\n\n- Fix the potential deadlocks in `Flushall` and `FlushDB`, and remove the `FlushSubDB` interface[#2533](https://github.com/OpenAtomFoundation/pika/pull/2533)@[Mixficsol](https://github.com/Mixficsol)\n\n- Add a parameter to control whether to clean up data files generated by TCL tests, preventing obsolete data from occupying disk space[#2507](https://github.com/OpenAtomFoundation/pika/pull/2507)@[Mixficsol](https://github.com/Mixficsol)\n\n# v3.5.3\n\n## New features\n\n- Pika supports ACL[#2013](https://github.com/OpenAtomFoundation/pika/pull/2013) @[lqxhub](https://github.com/lqxhub)\n\n- Automatically resume service when Codis dashboard coroutine panics[#2349](https://github.com/OpenAtomFoundation/pika/pull/2349)@[chengyu-l](https://github.com/chengyu-l)\n\n- During the full replication process, the slave node of the pika service does not receive read traffic requests.[#2197](https://github.com/OpenAtomFoundation/pika/pull/2197)  @[tedli](https://github.com/tedli)\n\n- Pika cache adds bimap data type.[#2253](https://github.com/OpenAtomFoundation/pika/pull/2253)  @[chejinge](https://github.com/chejinge)\n\n- Delete the remaining Slots in Sharing mode. There is only DB under Pika, and there are multiple DBs under one Pika.[#2251](https://github.com/OpenAtomFoundation/pika/pull/2251) @[Mixficsol](https://github.com/Mixficsol)\n\n- Pika exporter exposes cache-related data collection indicators.[#2318](https://github.com/OpenAtomFoundation/pika/pull/2318) @[dingxiaoshuai](https://github.com/dingxiaoshuai123)\n\n- Pika supports separation of fast and slow commands.[#2162](https://github.com/OpenAtomFoundation/pika/pull/2162) @[dingxiaoshuai](https://github.com/dingxiaoshuai123)\n\n- After pika executes bgsave, retain the unix timepoint.[#2167](https://github.com/OpenAtomFoundation/pika/pull/2167) @[hero-heng](https://github.com/hero-heng)\n\n- Pika supports dynamic configuration of the disable_auto_compations parameter.[#2257](https://github.com/OpenAtomFoundation/pika/pull/2257) @[hero-heng](https://github.com/hero-heng)\n\n- Pika supports Redis Stream.[#1955](https://github.com/OpenAtomFoundation/pika/pull/1955) @[KKorpse](https://github.com/KKorpse)\n\n- Pika supports large key analysis tools[#2195](https://github.com/OpenAtomFoundation/pika/pull/2195) @[sjcsjc123](https://github.com/sjcsjc123)\n\n- Pika supports dynamic adjustment of Pika cache parameters[#2253](https://github.com/OpenAtomFoundation/pika/pull/2253)  @[chejinge](https://github.com/chejinge)\n\n- Updated Pika benchmark tool to support more interface stress tests.[#2222](https://github.com/OpenAtomFoundation/pika/pull/2222)@[wangshao1](https://github.com/wangshao1)\n\n- Pika Operator supports automatic expansion of pika clusters.[#2121](https://github.com/OpenAtomFoundation/pika/pull/2121)@[machinly](https://github.com/machinly/)\n\n- Add the CompactRange command to support compacting keys within a certain range.[#2163](https://github.com/OpenAtomFoundation/pika/pull/2163)@[u6th9d](https://github.com/u6th9d)\n\n- Add small time cost compaction policy.[#2172](https://github.com/OpenAtomFoundation/pika/pull/2172)@[u6th9d](https://github.com/u6th9d)\n\n- Upgrade RocksDB version to v8.7.3.[#2157](https://github.com/OpenAtomFoundation/pika/pull/2157)@[JasirVoriya](https://github.com/JasirVoriya)\n\n- Pika distributed cluster Codis proxy adds new observable indicators.[#2199](https://github.com/OpenAtomFoundation/pika/pull/2199)@[dingxiaoshuai](https://github.com/dingxiaoshuai123)\n\n- Pika distributed cluster supports automatic failover.[#2386](https://github.com/OpenAtomFoundation/pika/pull/2386)@[chengyu-l](https://github.com/chengyu-l)\n\n- Pika supports redis rename-command function.[#2455](https://github.com/OpenAtomFoundation/pika/pull/2455)@[Mixficsol](https://github.com/Mixficsol)\n\n- Optimize codis slot migration speed and support dynamic modification of migration thread and speed.[#2486](https://github.com/OpenAtomFoundation/pika/pull/2486) @[chejinge](https://github.com/chejinge)\n\n- Pika supports dynamic adjustment of the max-conn-rbuf-size parameter.[#2434](https://github.com/OpenAtomFoundation/pika/pull/2434) @[HappyUncle](https://github.com/HappyUncle)\n\n- Pika-operator supports namespace and can deploy different clusters under different namespaces.[#2480](https://github.com/OpenAtomFoundation/pika/pull/2480) @[Y-Rookie](https://github.com/Y-Rookie)\n\n- Pika-operator supports monitoring indicator collection and automatically launches Pika-experter.[#2451](https://github.com/OpenAtomFoundation/pika/pull/2451) @[chengyu-l](https://github.com/chengyu-l)\n\n- ACL forward compatible with userblacklist.[#2459](https://github.com/OpenAtomFoundation/pika/pull/2459) @[dingxiaoshuai](https://github.com/dingxiaoshuai)\n\n- Enriched Pika TCL test set .[#2497](https://github.com/OpenAtomFoundation/pika/pull/2497) @[Mixficsol](https://github.com/Mixficsol)\n\n- Enriched Pika Gotest test set.[#2502](https://github.com/OpenAtomFoundation/pika/pull/2502) @[Mixficsol](https://github.com/Mixficsol)\n\n## Bugfix\n\n- Fixed an issue where Pika would accidentally delete dump files during full replication from the node.[#2377](https://github.com/OpenAtomFoundation/pika/pull/2377)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed the processing logic after the slave node receives an abnormal response packet from the master during the master-slave replication process.[#2319](https://github.com/OpenAtomFoundation/pika/pull/2319)@[wangshao1](https://github.com/wangshao1)\n\n- Call disable compaction when pika executes the shutdown command to improve the process exit speed. [#2345](https://github.com/OpenAtomFoundation/pika/pull/2345) @[panlei-coder](https://github.com/panlei-coder)\n\n- Fix the problem of inaccurate Codis-dashboard Redis Memory value.[#2337](https://github.com/OpenAtomFoundation/pika/pull/2337) @[Mixficsol](https://github.com/Mixficsol)\n\n- The INFO command is time-consuming and optimized to reduce the frequency of disk checks. [#2197](https://github.com/OpenAtomFoundation/pika/pull/2197)  @[chejinge](https://github.com/chejinge)\n\n- Fixed the issue where rsync deletes temporary files with incorrect paths and fails to delete them, causing rocksdb to fail to open.[#2186](https://github.com/OpenAtomFoundation/pika/pull/2186)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed the problem that the compact, bgsave, and info keyspace commands did not specify the db name, resulting in some coredump commands.[#2194](https://github.com/OpenAtomFoundation/pika/pull/2194)@[u6th9d](https://github.com/u6th9d)\n\n- Codis dashboard uses info replication instead of info command to search master ip to reduce the performance impact on Pika. [#2198](https://github.com/OpenAtomFoundation/pika/pull/2198)  @[chenbt-hz](https://github.com/chenbt-hz)\n\n- Fix Pika cache to use edge cases to solve the problem of cache and DB data inconsistency in some scenarios.[#2225](https://github.com/OpenAtomFoundation/pika/pull/2225)  @[chejinge](https://github.com/chejinge)\n\n- Fixed the issue where Segmentation fault would be reported when the dump folder is empty.[#2265](https://github.com/OpenAtomFoundation/pika/pull/2265)  @[chenbt-hz](https://github.com/chenbt-hz)\n\n- Fixed the problem that some command caches did not take effect due to flag calculation errors.[#2217](https://github.com/OpenAtomFoundation/pika/pull/2217) @[lqxhub](https://github.com/lqxhub)\n\n- Fixed the problem that in master-slave replication mode, after the master instance flushdb, the slave instance cannot be accessed due to deadlock.[#2249](https://github.com/OpenAtomFoundation/pika/pull/2249)@[ForestLH](https://github.com/ForestLH)\n\n- Fixed the issue where some commands did not judge the return value of RocksDB.[#2187](https://github.com/OpenAtomFoundation/pika/pull/2187)@[callme-taota](https://github.com/callme-taota)\n\n- Fixed the problem that some command caches did not take effect due to flag calculation errors.[#2217](https://github.com/OpenAtomFoundation/pika/pull/2217) @[lqxhub](https://github.com/lqxhub)\n\n- Fixed the problem that in master-slave replication mode, after the master instance flushdb, the slave instance cannot be accessed due to deadlock.[#2249](https://github.com/OpenAtomFoundation/pika/pull/2249)@[ForestLH](https://github.com/ForestLH)\n\n- Fixed the issue where some commands did not judge the return value of RocksDB.[#2187](https://github.com/OpenAtomFoundation/pika/pull/2187)@[callme-taota](https://github.com/callme-taota)\n\n- Fix the problem of info keyspace returning wrong results.[#2369](https://github.com/OpenAtomFoundation/pika/pull/2369)@[Mixficsol](https://github.com/Mixficsol)\n\n- Standard function return value and initial value.[#2176](https://github.com/OpenAtomFoundation/pika/pull/2176)@[Mixficsol](https://github.com/Mixficsol)\n\n- Fixed the problem of inaccurate network monitoring indicator statistics.[#2234](https://github.com/OpenAtomFoundation/pika/pull/2234)@[chengyu-l](https://github.com/chengyu-l)\n\n- Fixed an issue where some parameters in configuration file loading were abnormal.[#2218](https://github.com/OpenAtomFoundation/pika/pull/2218)@[jettcc](https://github.com/jettcc)\n\n- Fix Codis dashboard cpu used 100%.[#2393](https://github.com/OpenAtomFoundation/pika/pull/2393)@[chengyu-l](https://github.com/chengyu-l)\n\n- Fix the problem of abnormal display of master and slave roles in Codis fe of pika.[#2387](https://github.com/OpenAtomFoundation/pika/pull/2387)@[chengyu-l](https://github.com/chengyu-l)\n\n- Fix the problem of data inconsistency after migrating data.[#2485](https://github.com/OpenAtomFoundation/pika/pull/2485)@[chejinge](https://github.com/chejinge)\n\n- Fix dbsize calculation error problem.[#2494](https://github.com/OpenAtomFoundation/pika/pull/2494)@[chejinge](https://github.com/chejinge)\n\n- Fixed the issue of inaccurate display of the Codis-dashboard interface after scaling up or down or starting and stopping pods.[#2475](https://github.com/OpenAtomFoundation/pika/pull/2475)@[chengyu-l](https://github.com/chengyu-l)\n\n- Fix the problem of repeated locking of DB layer.[#2372](https://github.com/OpenAtomFoundation/pika/pull/2372) @[Mixficsol](https://github.com/Mixficsol)\n\n- Fixed the problem of data loss caused by failure to perform full copy.[#2439](https://github.com/OpenAtomFoundation/pika/pull/2439)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed the problem that during the master-slave replication process, the master instance did not correctly respond to the slave's synchronization request when executing bgsave.[#2437](https://github.com/OpenAtomFoundation/pika/pull/2437)@[wangshao1](https://github.com/wangshao1)\n\n- During the full copy process, add data synchronization status to clarify the data synchronization progress.[#2430](https://github.com/OpenAtomFoundation/pika/pull/2430)@[baixin01](https://github.com/baixin01)\n\n- Fixed the issue where the slave database did not lock the key of the operation when applying binlog, resulting in data inconsistency.[#2409](https://github.com/OpenAtomFoundation/pika/pull/2490) @[chejinge](https://github.com/chejinge)\n\n- Fix the problem of master instance coredump during codis slot migration process.[#2415](https://github.com/OpenAtomFoundation/pika/pull/2415) @[chejinge](https://github.com/chejinge)\n\n- Fixed the problem of deleting the dump file being used during the master-slave replication process.[#2377](https://github.com/OpenAtomFoundation/pika/pull/2377)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed the problem of rsync response error from slave instance during master-slave replication process.[#2319](https://github.com/OpenAtomFoundation/pika/pull/2319)@[wangshao1](https://github.com/wangshao1)\n\n- Fixed the problem that in master-slave replication mode, after the master instance flushdb, the slave instance cannot be accessed due to deadlock.[#2372](https://github.com/OpenAtomFoundation/pika/pull/2372) @[Mixficsol](https://github.com/Mixficsol)\n\n\n# v3.5.2\n\n## New features\n\n- Pika supports Redis transactions.  [#2124](https://github.com/OpenAtomFoundation/pika/pull/2124) @[ForestLH](https://github.com/ForestLH)\n\n- Pika adds a cache layer for hot and cold data separation, improving read performance. [#2133](https://github.com/OpenAtomFoundation/pika/pull/2133) @[chejinge](https://github.com/chejinge)@[Mixficsol](https://github.com/Mixficsol)\n\n- Codis-Proxy supports dynamic configuration parameter modification.  [#2103](https://github.com/OpenAtomFoundation/pika/pull/2103) @[dingxiaoshuai123](https://github.com/dingxiaoshuai123)\n\n- Completing Go Test cases.  [#2063](https://github.com/OpenAtomFoundation/pika/pull/2063)@[dingxiaoshuai123](https://github.com/dingxiaoshuai123)\n\n- Adds cache to improve compilation speed on CI.  [#2088](https://github.com/OpenAtomFoundation/pika/pull/2088)@[baerwang](https://github.com/baerwang)\n\n## Bugfix\n\n- Fixed coredump issue when using SETRANGE command in Pika.  [#2125](https://github.com/OpenAtomFoundation/pika/issues/2125) @[chejinge](https://github.com/chejinge)\n\n- Fixed full replication issue caused by deleting Clearreplicationid from binlog.  [#2136](https://github.com/OpenAtomFoundation/pika/issues/2136) @[Mixficsol](https://github.com/Mixficsol)\n\n- Modified lock granularity to improve binlog writing performance in Pika.  [#2129](https://github.com/OpenAtomFoundation/pika/pull/2129) @[wangshao1](https://github.com/wangshao1)\n\n- Added redis-copy traffic replication tool.  [#2044](https://github.com/OpenAtomFoundation/pika/issues/2044) @[Mixficsol](https://github.com/Mixficsol)\n\n- Fixed potential data overflow issue in complex data types member variables.  [#2016](https://github.com/OpenAtomFoundation/pika/pull/2106)  @[u6th9d](https://github.com/u6th9d)\n\n- Fixed incorrect return value issue in decr command. [#2092](https://github.com/OpenAtomFoundation/pika/pull/2092) @[dingxiaoshuai123](https://github.com/dingxiaoshuai123)\n\n- Fixed issue where SETRANGE and SETBIT commands did not retain the original key's expiration time. [#2095](https://github.com/OpenAtomFoundation/pika/pull/2095) @[u6th9d](https://github.com/u6th9d)\n\n\n\n# v3.5.1\n\n## New features\n\n- slow log Adds statistics on queue waiting time [#1997](https://github.com/OpenAtomFoundation/pika/pull/1997) @[wangshao1](https://github.com/wangshao1)\n\n- ReplicationID is used for primary/secondary replication [#1951](https://github.com/OpenAtomFoundation/pika/pull/1951) @[Mixficsol](https://github.com/Mixficsol)\n\n- WAL uses the disablewal command to support dynamic shutdown [#2015](https://github.com/OpenAtomFoundation/pika/pull/2015) @[Mixficsol](https://github.com/Mixficsol)\n\n- The number of threads flushed and the number of threads compaction dynamically adjust into one [#2014](flush线程数和compaction线程数动态调整，合二为一) @[Tianpingan](https://github.com/Tianpingan)\n\n- The RocksDB version was upgraded to v8.3.3 [#1999](https://github.com/OpenAtomFoundation/pika/issues/1999) @[dingxiaoshuai123](https://github.com/dingxiaoshuai123)\n\n- Added documentation for configuring Pika in Macos environment [#2003](https://github.com/OpenAtomFoundation/pika/pull/2003) @[klboke](https://github.com/klboke)\n\n- Added the ability to periodically print the length of the work queue to quickly locate problems when the queue is blocked [#1978](https://github.com/OpenAtomFoundation/pika/pull/1978) @[Tianpingan](https://github.com/Tianpingan)\n\n- Added an indicator to detect the entire cluster using a `pika_exporter` [#1953](https://github.com/OpenAtomFoundation/pika/pull/1953) @[chenbt-hz](https://github.com/chenbt-hz)\n\n- Realize automatic registration of Pika service on K8s environment, and automatically register at startup, so as to realize self-organization of cluster [#1931](https://github.com/OpenAtomFoundation/pika/pull/1931) @[machinly](https://github.com/machinly)\n\n\n## Bugfix\n\n- Reduces unnecessary log printing by the exporter, reducing CPU utilization [#1945](https://github.com/OpenAtomFoundation/pika/pull/1945) @[Mixficsol](https://github.com/Mixficsol)\n\n- The sentinel mechanism has been upgraded to carry out logical deletion of primary nodes that fall offline [#1949](https://github.com/OpenAtomFoundation/pika/pull/1949) @[Mixficsol](https://github.com/Mixficsol)\n\n- Adjust the rate_limit parameter to fix the situation that RPS is 0 during pressure measurement [#2009](https://github.com/OpenAtomFoundation/pika/pull/2009) @[chejinge](https://github.com/chejinge)\n\n- Fixed the logical determination of empty path when traversing data files in INFODATA command [#1996](https://github.com/OpenAtomFoundation/pika/pull/1996) @[Mixficsol](https://github.com/Mixficsol)\n\n- Improved the description of some missing parts of the document [#1962](https://github.com/OpenAtomFoundation/pika/pull/1962) @[baerwang](https://github.com/baerwang)\n\n- Use make-j to improve build speed [#1933](https://github.com/OpenAtomFoundation/pika/pull/1933) @[xiezheng-XD](https://github.com/xiezheng-XD)\n\n- Fixed an issue where large burrs appeared on the Codis line [#2016](https://github.com/OpenAtomFoundation/pika/pull/2016) @[chejinge](https://github.com/chejinge)\n\n- Fixed an issue where tools could not be compiled in Macos [#2011](https://github.com/OpenAtomFoundation/pika/pull/2011) @[A2ureStone](https://github.com/A2ureStone)\n\n\n\n# v3.5.0\n\n## Major features\n\n### 1.Removal of Rsync\n\n* In v3.5.0, we removed Rsync and replaced it with a self-developed full synchronization scheme, which has the features of breakpoint continuation, rate limit, file inspection and so on\n\n  [#1805](https://github.com/OpenAtomFoundation/pika/pull/1805)  [#1591](https://github.com/OpenAtomFoundation/pika/issues/1591) [#1816](https://github.com/OpenAtomFoundation/pika/pull/1816) [#1818](https://github.com/OpenAtomFoundation/pika/pull/1818) [#1820](https://github.com/OpenAtomFoundation/pika/pull/1820)\n\n  [@wangshao1](https://github.com/wangshao1) [@chejinge](https://github.com/chejinge) [@luky116](https://github.com/luky116)\n\n1. Remove Rsync.\n2. Implement breakpoint resuming, rate limitation, and file verification.\n3. When synchronizing master-slave in Pika, perform the master run_id verification.\n\n### 2.Compatibility with More Redis Commands\n\n* More Redis commands are compatible and supported in v3.5.0.\n\n  [#1273](https://github.com/OpenAtomFoundation/pika/pull/1273) [#1660](https://github.com/OpenAtomFoundation/pika/pull/1660) [#1245](https://github.com/OpenAtomFoundation/pika/pull/1245) [#1548](https://github.com/OpenAtomFoundation/pika/pull/1548) [#1843](https://github.com/OpenAtomFoundation/pika/pull/1843)\n\n  [@wanghenshui](https://github.com/wanghenshui)  [@Mixficsol](https://github.com/Mixficsol) [@weedge](https://github.com/weedge) [@cheniujh](https://github.com/cheniujh)\n\n1. Support the UNLINK command.\n2. Support the INFO COMMANDSTATS command.\n3. Support the HELLO and SETNAME commands.\n4. Support the BLPOP and BRPOP commands.\n5. Added Pika original command DISKRECOVERY\n\n### 3.RocksDB Version Upgrade and Tiered Compression\n\n* In v3.5.0, we upgraded RocksDB to version v8.1.1 and implemented tiered compression.\n\n  [#1396](https://github.com/OpenAtomFoundation/pika/pull/1396) [#1365](https://github.com/OpenAtomFoundation/pika/pull/1365)  [#1189](https://github.com/OpenAtomFoundation/pika/pull/1189)\n\n  [@lqxhub](https://github.com/lqxhub)  [@chejinge](https://github.com/chejinge)\n\n1. Upgraded RocksDB version to v8.1.1.\n2. Implemented tiered compression for RocksDB.\n3. Added the RocksDB cache configuration option \"num-shard-bits\" to read from the configuration file.\n\n### 4.Support for BlobDB:\n\n* In v3.5.0, we added support for BlobDB KV separation.\n\n  [#1456](https://github.com/OpenAtomFoundation/pika/pull/1456)\n\n  [@lqxhub](https://github.com/lqxhub)\n\n1. With this update, Pika now supports the separation of KV (Key-Value) data using BlobDB.\n\n### 5.Codis Cluster Mode based on Codis\n\n* In v3.5.0, we introduced the Codis Cluster Mode and added support for the command to migrate Codis slots.\n\n  [#1279](https://github.com/OpenAtomFoundation/pika/pull/1279) [#1311](https://github.com/OpenAtomFoundation/pika/pull/1311) [#1492](https://github.com/OpenAtomFoundation/pika/pull/1492) [#1662](https://github.com/OpenAtomFoundation/pika/pull/1662) [#1682](https://github.com/OpenAtomFoundation/pika/pull/1682) [#1632](https://github.com/OpenAtomFoundation/pika/pull/1632)  [#1700](https://github.com/OpenAtomFoundation/pika/pull/1700)\n\n  [@WyattJia](https://github.com/WyattJia) [@chejinge](https://github.com/chejinge) [@luky116](https://github.com/luky116) [@yaoyinnan](https://github.com/yaoyinnan)\n\n1. Introducing Codis into Pika.\n2. Introducing Codis CI into the project.\n3. Supporting the command for Codis slot migration.\n4. Adding the \"slotmigrate\" status indicator for whether it is in the process of reloading.\n\n### 6.Observability\n\n* In v3.5.0, we introduced the `pika_exporter` tool to monitor the observability metrics of Pika. Subsequently, we added several new metrics to enhance Pika's observability.\n\n  [#1388](https://github.com/OpenAtomFoundation/pika/pull/1388)  [#1733](https://github.com/OpenAtomFoundation/pika/pull/1733)  [#1751](https://github.com/OpenAtomFoundation/pika/pull/1751)  [#1736](https://github.com/OpenAtomFoundation/pika/pull/1736) [#1560](https://github.com/OpenAtomFoundation/pika/pull/1560)  [#1696](https://github.com/OpenAtomFoundation/pika/pull/1696)\n\n  [@chenbt-hz](https://github.com/chenbt-hz)  [@yaoyinnan](https://github.com/yaoyinnan) [@Mixficsol](https://github.com/Mixficsol)\n\n1. Added Pika observability system `pika_exporter`.\n2. Introduced monitoring metrics for network I/O traffic.\n3. Added metrics for tracking command execution durations.\n4. Introduced \"estimate_pending_compaction_bytes\" metric to analyze fragmentation.\n5. Added RocksDB metrics.\n\n### 7.Cloud-Native Deployment\n\n* In v3.5.0, we introduced an MVP version of pika-operator, which focuses on enabling the quick deployment of a single-instance Pika service on Kubernetes.\n\n  [#1243](https://github.com/OpenAtomFoundation/pika/pull/1243) [#1330](https://github.com/OpenAtomFoundation/pika/pull/1330) [#1347](https://github.com/OpenAtomFoundation/pika/pull/1347)\n\n  [@machinly](https://github.com/machinly)\n\n1. Implemented fast deployment of a single-instance Pika service on Kubernetes.\n2. Implemented Pika deployment in the MiniKube environment.\n3. Added End-to-End (E2E) tests to the pika-operator.\n\n### 8.Cross-platform compilation\n\n* In v3.5.0, Pika supports cross-platform compilation and can be compiled and used on MacOS, CentOS, and Ubuntu platforms.\n\n  [#1372](https://github.com/OpenAtomFoundation/pika/pull/1372)  [#1488](https://github.com/OpenAtomFoundation/pika/pull/1488)\n\n  [@loveyacper](https://github.com/loveyacper)  [@Mixficsol](https://github.com/Mixficsol)\n\n1. Supports MacOS platform\n\n### 9.Multi-platform CI, Go integration tests, TCL unit tests, PythonE2E tests, CTest unit tests\n\n* In v3.5.0, several testing and integration features were added to ensure Pika's robustness across multiple platforms.\n\n  [#1534](https://github.com/OpenAtomFoundation/pika/pull/1534) [#1772](https://github.com/OpenAtomFoundation/pika/pull/1772)  [#1769](https://github.com/OpenAtomFoundation/pika/pull/1769)  [#1347](https://github.com/OpenAtomFoundation/pika/pull/1347)  [#1268](https://github.com/OpenAtomFoundation/pika/pull/1268)  [#1693](https://github.com/OpenAtomFoundation/pika/pull/1693) [#1362](https://github.com/OpenAtomFoundation/pika/pull/1362)  [#1538](https://github.com/OpenAtomFoundation/pika/pull/1538)  [#1246](https://github.com/OpenAtomFoundation/pika/pull/1246)   [#1357](https://github.com/OpenAtomFoundation/pika/pull/1357)  [#1534](https://github.com/OpenAtomFoundation/pika/pull/1534) [#1772](https://github.com/OpenAtomFoundation/pika/pull/1772)\n\n  [@machinly](https://github.com/machinly)  [@wanghenshui](https://github.com/wanghenshui) [@chenbt-hz](https://github.com/chenbt-hz)  [@Tangruilin](https://github.com/Tangruilin)  [@kernelai](https://github.com/kernelai) [@Mixficsol](https://github.com/Mixficsol)\n\n1. Added CI on CentOS environment to ensure compatibility on this platform.\n2. Added CI on MacOS environment to validate Pika's behavior on MacOS.\n3. Introduced an End-to-End (E2E) testing framework to comprehensively test Pika's functionality from end to end.\n4. Integrated CMake build environment in Github CI Workflow to facilitate the compilation process.\n5. Implemented a \"populate\" method in TCL scripts to simulate Redis debug populate method for test data population.\n6. Introduced a script to enable easy execution of unit tests.\n7. Added CMake files in Blackwidow and included unit tests for Blackwidow.\n8. Utilized CTest for conducting unit tests to ensure code correctness.\n9. Ported Redis testing scripts to Pika to leverage existing tests and verify Pika's compatibility with Redis.\n10. Included new tasks in the CI pipeline to verify successful compilation of Pika on CentOS systems.\n\n# Features\n\n- Added automatic rate limiting for \"compact\" operation to reduce its impact on the latency of upper-layer data read and write operations. [#1374](https://github.com/OpenAtomFoundation/pika/pull/1374) [@wanghenshui](https://github.com/wanghenshui)\n- Introduced the \"aof_to_pika\" toolset for data conversion. [#1340](https://github.com/OpenAtomFoundation/pika/pull/1340) [@Axlgrep](https://github.com/Axlgrep)\n- Implemented the printing of the Pika logo. [#1787](https://github.com/OpenAtomFoundation/pika/pull/1787) [@Mixficsol](https://github.com/Mixficsol)\n- Optimized certain code portions using clang-tidy. [#1701](https://github.com/OpenAtomFoundation/pika/pull/1701) [#1730](https://github.com/OpenAtomFoundation/pika/pull/1730) [@longfar-ncy](https://github.com/longfar-ncy)\n- Refactored C++98-style code to C++11-style following C++ coding guidelines. [#1684](https://github.com/OpenAtomFoundation/pika/pull/1684) [@chejinge](https://github.com/chejinge)\n- Introduced support for the \"snappy\" library. [#1216](https://github.com/OpenAtomFoundation/pika/pull/1216) [@kernelai](https://github.com/kernelai)\n- Added CLA (Contributor License Agreement) file. [#1260](https://github.com/OpenAtomFoundation/pika/pull/1260) [@kernelai](https://github.com/kernelai)\n- Extended memory-related configuration options to support units in K, M, or G. [#1307](https://github.com/OpenAtomFoundation/pika/pull/1307) [@lqxhub](https://github.com/lqxhub)\n- Added libunwind as a dependency library. [#1316](https://github.com/OpenAtomFoundation/pika/pull/1316) [@kernelai](https://github.com/kernelai)\n- Included a compilation script for Pika. [#1356](https://github.com/OpenAtomFoundation/pika/pull/1356) [@lqxhub](https://github.com/lqxhub)\n- Added \"rate-limiter-bandwidth\" option to pika.conf for rate limiting. [#1272](https://github.com/OpenAtomFoundation/pika/pull/1272) [@wanghenshui](https://github.com/wanghenshui)\n- Enhanced the \"info\" command by adding \"redis_version\" information. [#1403](https://github.com/OpenAtomFoundation/pika/pull/1403) [@wanghenshui](https://github.com/wanghenshui)\n- Provided CMake support for aof_to_pika tool. [#1436](https://github.com/OpenAtomFoundation/pika/pull/1436) [@A2ureStone](https://github.com/A2ureStone)\n- Introduced clang-formatted shell scripts. [#1448](https://github.com/OpenAtomFoundation/pika/pull/1448) [@lqxhub](https://github.com/lqxhub)\n- Added a configuration option to disable the compilation of command docs. [#1642](https://github.com/OpenAtomFoundation/pika/pull/1642) [@tedli](https://github.com/tedli)\n- Provided CMake support for benchmark_client, binlog_sender, manifest_generator, rdb_to_pika, txt_to_pika, pika_to_txt, and pika_port. [#1451](https://github.com/OpenAtomFoundation/pika/pull/1451) [@A2ureStone](https://github.com/A2ureStone)\n\n# Improvement\n\n- Removed sharding mode from Pika for uniformity. [#1481](https://github.com/OpenAtomFoundation/pika/pull/1481) [@chejinge](https://github.com/chejinge)\n- Added slot numbers to the configuration (config) settings. [#1664](https://github.com/OpenAtomFoundation/pika/pull/1664) [@luky116](https://github.com/luky116)\n- Unified the naming of partitions as slots. [#1571](https://github.com/OpenAtomFoundation/pika/pull/1571) [#1655](https://github.com/OpenAtomFoundation/pika/pull/1655) [@chejinge](https://github.com/chejinge)\n- Replaced Monitor thread with the Monitor command. [#1551](https://github.com/OpenAtomFoundation/pika/pull/1551) [@loveyacper](https://github.com/loveyacper)\n- Added checks for empty and incorrect passwords during server startup. [#1645](https://github.com/OpenAtomFoundation/pika/pull/1645) [@hqh-cell](https://github.com/hqh-cell)\n- Refactored pstd_mutex. [#1440](https://github.com/OpenAtomFoundation/pika/pull/1440) [@4kangjc](https://github.com/4kangjc)\n- Modified the command information key-space response data. [#1450](https://github.com/OpenAtomFoundation/pika/pull/1450) [@lqxhub](https://github.com/lqxhub)\n- Merged common code between pstd and storage. [#1419](https://github.com/OpenAtomFoundation/pika/pull/1419) [@4kangjc](https://github.com/4kangjc)\n- Added \"spop\" command by count. [#1434](https://github.com/OpenAtomFoundation/pika/pull/1434) [@ChanphongGu](https://github.com/ChanphongGu)\n- Provided documentation for Pika Docker images. [#1557](https://github.com/OpenAtomFoundation/pika/pull/1557) [@machinly](https://github.com/machinly)\n- Replaced the old GetEnv interface with RocksDB's GetFileSystem interface. [#1213](https://github.com/OpenAtomFoundation/pika/pull/1213) [@kernelai](https://github.com/kernelai)\n- Added scattered Pika documentation. [#1193](https://github.com/OpenAtomFoundation/pika/pull/1193) [@fengpeiyuan](https://github.com/fengpeiyuan)\n- Upgraded CMake to version 3.18. [#1366](https://github.com/OpenAtomFoundation/pika/pull/1366) [@AlexStocks](https://github.com/AlexStocks)\n- Added a format tool to Pika. [#1512](https://github.com/OpenAtomFoundation/pika/pull/1512) [@liuqian1990](https://github.com/liuqian1990)\n- Added clang-tidy support to Pika. [#1515](https://github.com/OpenAtomFoundation/pika/pull/1515) [#1730](https://github.com/OpenAtomFoundation/pika/pull/1730) [@ForestLH](https://github.com/ForestLH) [@longfar-ncy](https://github.com/longfar-ncy)\n- Launched Pika and pika-operator in MiniKube. [#1330](https://github.com/OpenAtomFoundation/pika/pull/1330) [@machinly](https://github.com/machinly)\n- Applied Google coding style to clang-format. [#1479](https://github.com/OpenAtomFoundation/pika/pull/1479) [@Mixficsol](https://github.com/Mixficsol)\n- Refactored pstd/env using std::filesystem. [#1470](https://github.com/OpenAtomFoundation/pika/pull/1470) [@4kangjc](https://github.com/4kangjc)\n- Added Slice to pstd::GetFixed. [#1425](https://github.com/OpenAtomFoundation/pika/pull/1425) [@4kangjc](https://github.com/4kangjc)\n- Used inline variables in header files. [#1407](https://github.com/OpenAtomFoundation/pika/pull/1407) [@4kangjc](https://github.com/4kangjc)\n- Formatted code using clang-formats. [#1378](https://github.com/OpenAtomFoundation/pika/pull/1378) [@AlexStocks](https://github.com/AlexStocks)\n- Moved pika-operator to the pika-tools directory. [#1468](https://github.com/OpenAtomFoundation/pika/pull/1468) [@luky116](https://github.com/luky116)\n- Added Codis to Pika migration tool. [#1514](https://github.com/OpenAtomFoundation/pika/pull/1514) [@chenbt-hz](https://github.com/chenbt-hz)\n\n# Bugfixes\n\n- Fixed coredump caused by incompatible CPU instruction sets. [#1812](https://github.com/OpenAtomFoundation/pika/pull/1812) [@chejinge](https://github.com/chejinge)\n- Fixed abnormal exit issue in the Monitor command. [#1804](https://github.com/OpenAtomFoundation/pika/pull/1804) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed incomplete configuration overwrite. [#1800](https://github.com/OpenAtomFoundation/pika/pull/1800) [@yaoyinnan](https://github.com/yaoyinnan)\n- Fixed CTest tests on MacOS. [#1789](https://github.com/OpenAtomFoundation/pika/pull/1789) [#1721](https://github.com/OpenAtomFoundation/pika/pull/1721) [#1782](https://github.com/OpenAtomFoundation/pika/pull/1782) [@tedli](https://github.com/tedli) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed loading master-run-id from the configuration file during process startup, which caused the need for re-syncing historical data on slave nodes. [#1778](https://github.com/OpenAtomFoundation/pika/pull/1778) [@luky116](https://github.com/luky116)\n- Fixed format error in overrides option during Pika single test. [#1768](https://github.com/OpenAtomFoundation/pika/pull/1768) [@A2ureStone](https://github.com/A2ureStone)\n- Fixed command to retrieve INFO xxx (INFO data, INFO stats) by index instead of using INFO ALL. [#1762](https://github.com/OpenAtomFoundation/pika/pull/1762) [@yaoyinnan](https://github.com/yaoyinnan)\n- Improved instantaneous_metric to collect network metrics every 5 seconds. [#1757](https://github.com/OpenAtomFoundation/pika/pull/1757) [@yaoyinnan](https://github.com/yaoyinnan)\n- Improved config get to return complete parameters. [#1593](https://github.com/OpenAtomFoundation/pika/issues/1593) [@luky116](https://github.com/luky116)\n- Fixed possible empty slot issue. [#1712](https://github.com/OpenAtomFoundation/pika/pull/1712) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed some bugs related to version selection in the makefile. [#1714](https://github.com/OpenAtomFoundation/pika/pull/1714) [@luky116](https://github.com/luky116)\n- Fixed bug in executing HSET for the first time. [#1710](https://github.com/OpenAtomFoundation/pika/pull/1710) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed the issue of binlog offset on slave nodes being greater than master nodes, causing TrySync failure. [#1681](https://github.com/OpenAtomFoundation/pika/issues/1681) [@luky116](https://github.com/luky116)\n- Fixed a NOAUTH error test, where any command would give an error when AUTH is required. [#1680](https://github.com/OpenAtomFoundation/pika/pull/1680) [@hqh-cell](https://github.com/hqh-cell)\n- Fixed the issue of binlog files not being automatically cleaned up when exceeding the limit. [#1679](https://github.com/OpenAtomFoundation/pika/pull/1679) [@luky116](https://github.com/luky116)\n- Fixed issues with LPUSHX and RPUSHX multi-element insertion. [#1525](https://github.com/OpenAtomFoundation/pika/pull/1525) [@ForestLH](https://github.com/ForestLH)\n- Fixed error in executing the BGSAVE command. [#1523](https://github.com/OpenAtomFoundation/pika/pull/1523) [@Brokenice0415](https://github.com/Brokenice0415)\n- Fixed the use of io_uring when closing RocksDB to prevent errors during linking. [#1489](https://github.com/OpenAtomFoundation/pika/pull/1489) [@lqxhub](https://github.com/lqxhub)\n- Fixed MacOS environment Pika compilation warnings. [#1740](https://github.com/OpenAtomFoundation/pika/pull/1740) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed error message for unsupported commands, adapted for go-redis. [#1244](https://github.com/OpenAtomFoundation/pika/pull/1244) [@wgqi1126](https://github.com/wgqi1126)\n- Fixed a protobuf3 compilation warning. [#1267](https://github.com/OpenAtomFoundation/pika/pull/1267) [@wanghenshui](https://github.com/wanghenshui)\n- Fixed bugs in EXISTS and DEL commands in sharding mode. [#1277](https://github.com/OpenAtomFoundation/pika/pull/1277) [@wanghenshui](https://github.com/wanghenshui)\n- Fixed rsync auth bug. [#1278](https://github.com/OpenAtomFoundation/pika/pull/1278) [@wanghenshui](https://github.com/wanghenshui)\n- Fixed rewrite result format to comply with Redis standards. [#1339](https://github.com/OpenAtomFoundation/pika/pull/1339) [@lqxhub](https://github.com/lqxhub)\n- Fixed SET NX/XX return values to match Redis behavior. [#1343](https://github.com/OpenAtomFoundation/pika/pull/1343) [@gtygo](https://github.com/gtygo)\n- Fixed missing pika_master_link_status and pika_slave_priority indicators in exporter. [#1726](https://github.com/OpenAtomFoundation/pika/pull/1726) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed potential coredump when Pika uses too many file descriptors, preventing it from exceeding the ulimit. [#1346](https://github.com/OpenAtomFoundation/pika/pull/1346) [@kernelai](https://github.com/kernelai)\n- Fixed initialization of group members in classes to prevent unexpected closure of the connection between redis-cli and Pika. [#1390](https://github.com/OpenAtomFoundation/pika/pull/1390) [@AlexStocks](https://github.com/AlexStocks)\n- Fixed delete_dir snprintf bug. [#1400](https://github.com/OpenAtomFoundation/pika/pull/1400) [@wanghenshui](https://github.com/wanghenshui)\n- Fixed thread num limitation. [#1401](https://github.com/OpenAtomFoundation/pika/pull/1401) [@wanghenshui](https://github.com/wanghenshui)\n- Fixed redis-benchmark to get config from Pika. [#1402](https://github.com/OpenAtomFoundation/pika/pull/1402) [@wanghenshui](https://github.com/wanghenshui)\n- Fixed initialization of class members. [#1406](https://github.com/OpenAtomFoundation/pika/pull/1406) [@AlexStocks](https://github.com/AlexStocks)\n- Fixed issues in Pika's master-slave synchronization tests on MacOS. [#1776](https://github.com/OpenAtomFoundation/pika/pull/1776) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed NULL to nullptr. [#1408](https://github.com/OpenAtomFoundation/pika/pull/1408) [@AlexStocks](https://github.com/AlexStocks)\n- Fixed size boundary of ttl to set the expiration timestamp. [#1413](https://github.com/OpenAtomFoundation/pika/pull/1413) [@ForestLH](https://github.com/ForestLH)\n- Fixed access to nullptr. [#1414](https://github.com/OpenAtomFoundation/pika/pull/1414) [#1426](https://github.com/OpenAtomFoundation/pika/pull/1426) [@fly1ngpengu1ns](https://github.com/fly1ngpengu1ns) [@Pikachu1412](https://github.com/Pikachu1412)\n- Fixed Monitor command. [#1424](https://github.com/OpenAtomFoundation/pika/pull/1424) [@loveyacper](https://github.com/loveyacper)\n- Fixed partitionInfo::operator to return a boolean value. [#1427](https://github.com/OpenAtomFoundation/pika/pull/1427) [@4kangjc](https://github.com/4kangjc)\n- Fixed access to nullptr in src/net. [#1453](https://github.com/OpenAtomFoundation/pika/pull/1453) [@gitveg](https://github.com/gitveg)\n- Fixed c++17 build failure in aof_reader. [#1454](https://github.com/OpenAtomFoundation/pika/pull/1454) [@lqxhub](https://github.com/lqxhub)\n- Fixed compilation warnings. [#1455](https://github.com/OpenAtomFoundation/pika/pull/1455) [@wangchuande](https://github.com/wangchuande)\n- Fixed occasional build failure in operator. [#1464](https://github.com/OpenAtomFoundation/pika/pull/1464) [@machinly](https://github.com/machinly)\n- Fixed CondVar to allow exiting. [#1475](https://github.com/OpenAtomFoundation/pika/pull/1475) [@lqxhub](https://github.com/lqxhub)\n- Fixed libfmt debug build name error. [#1476](https://github.com/OpenAtomFoundation/pika/pull/1476) [@lqxhub](https://github.com/lqxhub)\n- Fixed abnormal exit issue in the Monitor command. [#1804](https://github.com/OpenAtomFoundation/pika/pull/1804) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed abnormal binlog offset issue on slave nodes. [#1681](https://github.com/OpenAtomFoundation/pika/issues/1681) [@luky116](https://github.com/luky116)\n- Fixed \"no auth\" error in unit tests. [#1680](https://github.com/OpenAtomFoundation/pika/pull/1680) [@hqh-cell](https://github.com/hqh-cell)\n- Fixed issue where binlog files exceeding the limit were not being deleted. [#1679](https://github.com/OpenAtomFoundation/pika/pull/1679) [@luky116](https://github.com/luky116)\n- Fixed string-related unit tests. [#1675](https://github.com/OpenAtomFoundation/pika/pull/1675) [@Mixficsol](https://github.com/Mixficsol)\n- Fixed issue where tmp files were not deleted during abnormal exit in Codis. [#1661](https://github.com/OpenAtomFoundation/pika/issues/1661) [@yaoyinnan](https://github.com/yaoyinnan)\n- Fixed inconsistency in data replication between master and slave. [#1638](https://github.com/OpenAtomFoundation/pika/issues/1638) [@cheniujh](https://github.com/cheniujh)\n- Fixed failure to retrieve Metrics indicators in the INFO command. [#1646](https://github.com/OpenAtomFoundation/pika/issues/1646) [@chejinge](https://github.com/chejinge)\n- Fixed a type error in basic type on one side. [#1625](https://github.com/OpenAtomFoundation/pika/pull/1625) [@chenbt-hz](https://github.com/chenbt-hz)\n- Fixed incorrect parameter prompts for LPOP and RPOP interfaces. [#1520](https://github.com/OpenAtomFoundation/pika/issues/1520) [@luky116](https://github.com/luky116)\n- Fixed the issue where Pika remained in an erroneous state after clearing data due to the instance's disk being full, requiring a restart to recover. [#1765](https://github.com/OpenAtomFoundation/pika/pull/1765) [#1822](https://github.com/OpenAtomFoundation/pika/pull/1822) [#1843](https://github.com/OpenAtomFoundation/pika/pull/1843) [@Yangsx-1](https://github.com/Yangsx-1) [@Mixficsol](https://github.com/Mixficsol)\n\n# Notice\n\n* Removed the Proxy feature introduced in version 3.4. [#1274](https://github.com/OpenAtomFoundation/pika/pull/1274) [@wanghenshui](https://github.com/wanghenshui)\n* Removed the submodule. [#1312](https://github.com/OpenAtomFoundation/pika/pull/1312) [@wanghenshui](https://github.com/wanghenshui)\n* Removed the sharding command. [#1469](https://github.com/OpenAtomFoundation/pika/pull/1469) [@chejinge](https://github.com/chejinge)\n* Removed tcmalloc. [#1472](https://github.com/OpenAtomFoundation/pika/pull/1472) [@Mixficsol](https://github.com/Mixficsol)\n* Added protect mode for the leader. [#1276](https://github.com/OpenAtomFoundation/pika/pull/1276) [@wanghenshui](https://github.com/wanghenshui)\n* Synchronized the latest code from Codis to the Pika repository. [#1279](https://github.com/OpenAtomFoundation/pika/pull/1279) [@WyattJia](https://github.com/WyattJia)\n* Added external dependency libraries in CMake files. [#1281](https://github.com/OpenAtomFoundation/pika/pull/1281) [@kernelai](https://github.com/kernelai)\n* Added a list of external dependency libraries in CMake files. [#1285](https://github.com/OpenAtomFoundation/pika/pull/1285) [@kernelai](https://github.com/kernelai)\n* Created a static link library for Pika, allowing it to be directly linked with dependent libraries to form Pika's binary package. [#1310](https://github.com/OpenAtomFoundation/pika/pull/1310) [@Tangruilin](https://github.com/Tangruilin)\n* Made protobuf generation independent of the local environment, enabled multi-core compilation, and fixed the pthread error on Debian. [#1314](https://github.com/OpenAtomFoundation/pika/pull/1314) [@lqxhub](https://github.com/lqxhub)\n* Renamed \"slash\" to \"pstd\". [#1348](https://github.com/OpenAtomFoundation/pika/pull/1348) [@AlexStocks](https://github.com/AlexStocks)\n* Renamed the \"src/pink\" directory to \"src/net\". [#1350](https://github.com/OpenAtomFoundation/pika/pull/1350) [@AlexStocks](https://github.com/AlexStocks)\n* Renamed the words \"bw\" and \"blackwidow\" to \"storage\". [#1352](https://github.com/OpenAtomFoundation/pika/pull/1352) [#1353](https://github.com/OpenAtomFoundation/pika/pull/1353) [@AlexStocks](https://github.com/AlexStocks)\n* Updated the compiler requirement documentation. [#1420](https://github.com/OpenAtomFoundation/pika/pull/1420) [@4kangjc](https://github.com/4kangjc)\n* Replaced invalid links. [#1430](https://github.com/OpenAtomFoundation/pika/pull/1430) [#1441](https://github.com/OpenAtomFoundation/pika/pull/1441) [#1471](https://github.com/OpenAtomFoundation/pika/pull/1471) [@gitveg](https://github.com/gitveg) [@1321034767](https://github.com/1321034767) [@chiehwarm](https://github.com/chiehwarm)\n* Upgraded Redis from 4.3.3 to 4.4.4 in /tools/codis2pika/test. [#1536](https://github.com/OpenAtomFoundation/pika/pull/1536) [@dependabot](https://chat.openai.com/)\n* Upgraded golang.org/x/sys from 0.0.0-20210927094055-39ccf1dd6fa6 to 0.1.0 in /tools/codis2pika. [#1535](https://github.com/OpenAtomFoundation/pika/pull/1535) [@dependabot](https://chat.openai.com/)\n* Replaced new/delete with smart pointers. [#1503](https://github.com/OpenAtomFoundation/pika/pull/1503) [#1502](https://github.com/OpenAtomFoundation/pika/pull/1502) [#1493](https://github.com/OpenAtomFoundation/pika/pull/1493) [@cheniujh](https://github.com/cheniujh) [@A2ureStone](https://github.com/A2ureStone) [@iiiuwioajdks](https://github.com/iiiuwioajdks)\n* Replaced fprintf with glog. [#1421](https://github.com/OpenAtomFoundation/pika/pull/1421) [@Mixficsol](https://github.com/Mixficsol)\n"
        },
        {
          "name": "CHANGELOG_CN.MD",
          "type": "blob",
          "size": 72.91796875,
          "content": "# V4.0.2\n\n## New features\n\n- Pika 从实例执行完 slaveof no one 与主节点解除主从关系后，将 slaveof 信息持久化到配置文件中[#2973](https://github.com/OpenAtomFoundation/pika/pull/2973)@[cheniujh](https://github.com/cheniujh)\n\n- Pika-Operater 主从模式支持数据备份和恢复的功能[#2968](https://github.com/OpenAtomFoundation/pika/pull/2968)@[buzhimingyonghu](https://github.com/buzhimingyonghu)\n\n- 在配置文件中添加 log-net-activities 参数，支持动态关闭或者建立连接部分日志的打印，可以 config get/set动态调整[#2964](https://github.com/OpenAtomFoundation/pika/pull/2964)@[cheniujh](https://github.com/cheniujh)\n\n- 将 Pika info 指标中提供的 repl_connect_status 加入到了 pika_exporter，方便运维同学对 Pika 的主从状态判断[#2961](https://github.com/OpenAtomFoundation/pika/pull/2961)@[cheniujh](https://github.com/cheniujh)\n\n- 升级 kubeblocks 至 0.9 版本，对 Pika-operater 做升级和优化，简化代码，支持实例的缩容[#2860](https://github.com/OpenAtomFoundation/pika/pull/2860)@[XiaoLiang2333](https://github.com/XiaoLiang2333）\n\n- Pika-Operater 支持拉起主从模式，拉起方式详见 readme 文档[#2903](https://github.com/OpenAtomFoundation/pika/pull/2903)@[XiaoLiang2333](https://github.com/XiaoLiang2333）\n\n- Pika-Exporter 支持新增 keyspace_hits、keyspace_misses 指标，运维同学可以根据指标判断当前业务 key 的命中率[#2579](https://github.com/OpenAtomFoundation/pika/pull/2579)@[chenbt](https://github.com/chenbt）\n\n- RedisCache 中不存储大 key, 避免占用内存过多或者存储大 key 将业务多次访问的热 key 淘汰掉，影响性能[#2557](https://github.com/OpenAtomFoundation/pika/pull/2557)@[QlQlqiqi](https://github.com/QlQlqiqi)\n\n## Improvement\n\n- Pika 支持动态修改 max-subcompactions 配置参数，可以对 L0 层的 compact 操作做运行时优化[#2965](https://github.com/OpenAtomFoundation/pika/pull/2965)@[cheniujh](https://github.com/cheniujh)\n\n- 优化 log-retention-time 配置参数，可以动态调整日志保存的天数[#2963](https://github.com/OpenAtomFoundation/pika/pull/2963)@[cheniujh](https://github.com/cheniujh)\n\n- 将 Pika-Migrate 的代码移除至 tools 文件夹下，方便不同环境编译二进制进行数据迁移[#2941](https://github.com/OpenAtomFoundation/pika/pull/2941)@[chenbt-hz](https://github.com/chenbt-hz)\n\n- 为 Pika 复杂数据类型及管理命令添加 Go Test，保证服务的稳定性[#2840](https://github.com/OpenAtomFoundation/pika/pull/2901)@[tsinow](https://github.com/tsinow)\n\n- 更新 GitHub Action 工作流中的 actions/checkout 为 v5, 增强安全性和性能[#2833](https://github.com/OpenAtomFoundation/pika/pull/2833)@[baerwang](https://github.com/baerwang)\n\n- Pika 支持新的 compact 策略，增加最长时间未使用文件和最多删除条目文件的 compact 策略 ，提升 Pika 写性能[#2557](https://github.com/OpenAtomFoundation/pika/pull/2557)@[QlQlqiqi](https://github.com/QlQlqiqi)\n\n## Bugfix\n\n- 修复 rpoplpush 命令未更新缓存，导致数据库、缓存数据不一致的问题[#2976](https://github.com/OpenAtomFoundation/pika/pull/2976)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 Pika-Exporter 上下版本不兼容，导致 Exporter 日志打印过多浪费磁盘资源的问题[#2971](https://github.com/OpenAtomFoundation/pika/pull/2971)@[buzhimingyonghu](https://github.com/buzhimingyonghu)\n\n- 将 slowlog 的日志级别调整成为 INFO，解决 Slowlog 同时打印三份，会导致磁盘占用过多的问题[#2948](https://github.com/OpenAtomFoundation/pika/pull/2948)@[buzhimingyonghu](https://github.com/buzhimingyonghu)\n\n- 修复 CI 稳定性不通过的问题[#2937](https://github.com/OpenAtomFoundation/pika/pull/2937)@[chejinge](https://github.com/chejinge)\n\n- 修复 Pika 实例无法单独设置管理员密码的问题[#2920](https://github.com/OpenAtomFoundation/pika/issues/2920)@[buzhimingyonghu](https://github.com/buzhimingyonghu)\n\n- 修复 epoll 循环中 std::shared_ptr in_conn 对象的引用计数器的析构位置，确保 Pika 不会出现连接不及时关闭的现象[#2904](https://github.com/OpenAtomFoundation/pika/pull/2904)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 Zpopmin 命令执行删除操作时未更新缓存，导致数据库缓存不一致的问题[#2892](https://github.com/OpenAtomFoundation/pika/issues/2892)@[chejinge](https://github.com/chejinge)\n\n\n\n# V4.0.1\n\n## New features\n\n- 为RTC功能添加开关，如果Get/HGet在RTC路径上就未命中缓存，后面流转到正常路径上时直接读DB，不再读cache[#2841](https://github.com/OpenAtomFoundation/pika/pull/2841)@[cheniujh](https://github.com/cheniujh)\n\n- 用 RTC 模型处理 Pika 访问缓存部分，提升 Pika 服务的读性能[#2837](https://github.com/OpenAtomFoundation/pika/pull/2837)@[cheniujh](https://github.com/cheniujh)\n\n- 添加定时删除日志的任务，默认 7 天删除一次，可以根据自己需求在 config 文件中进行配置[#2829](https://github.com/OpenAtomFoundation/pika/pull/2829)@[XiaoLiang2333](https://github.com/XiaoLiang2333)\n\n## Improvement\n\n- 添加数据清洗函数，方便用户在升级过程中进行清洗数据[#2888](https://github.com/OpenAtomFoundation/pika/pull/2888)@[QlQlqiqi](https://github.com/QlQlqiqi)\n\n- 将 Floyd 存储的 data 字段中的值改为 ms 级别，与 Redis 命令保持兼容[#2857](https://github.com/OpenAtomFoundation/pika/pull/2857)@[luky116](https://github.com/luky116)\n\n- flushall 命令写 flushdb 为 binlog，如果是多 DB 状态，每个 DB 分别写一条，保证从节点消费的顺序 [#2846](https://github.com/OpenAtomFoundation/pika/pull/2846)@[cheniujh](https://github.com/cheniujh)\n\n- 删除不必要的日志，避免磁盘消费过大，影响业务数据读写[#2840](https://github.com/OpenAtomFoundation/pika/pull/2840)@[chejinge](https://github.com/chejinge)\n\n- incr、append 命令在传输 binlog 时，使用 pksetexat 命令，防止因为不正确的操作导致数据无法过期，出现脏数据[#2833](https://github.com/OpenAtomFoundation/pika/pull/2833)@[chejinge](https://github.com/chejinge)\n\n- 修改 Pika 从节点消费 binlog 的线程模型，保证 binlog 的消费顺序[#2708](https://github.com/OpenAtomFoundation/pika/pull/2708)@[cheniujh](https://github.com/cheniujh)\n\n- 添加更多的 RocksDB 指标，配置中增加 open_rocksdb_statistics_tickers  字段，默认为no。开启会损耗+1.5%[#2658](https://github.com/OpenAtomFoundation/pika/pull/2658)@[baixin01](https://github.com/baixin01)\n\n## Bugfix\n\n- 修复 Pika 进程使用 cache 数据不准确，导致监控不准确的问题[#2899](https://github.com/OpenAtomFoundation/pika/pull/2899)@[chejinge](https://github.com/chejinge)\n\n- 修复执行 zremrangebyrank 命令出现异常错误信号，导致 Pika 进程崩溃的问题[#2891](https://github.com/OpenAtomFoundation/pika/pull/2891)@[chejinge](https://github.com/chejinge)\n\n- 修复 Rpushx 命令执行时未更新 RedisCache 的问题，避免出现 DB、缓存不一致的问题[#2879](https://github.com/OpenAtomFoundation/pika/pull/2879)@[hahahashen](https://github.com/hahahashen)\n\n- 修复 kill client 命令杀连接流程不正确的问题[#2862](https://github.com/OpenAtomFoundation/pika/pull/2862)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 blpop/brpop 更新数据库的时候未更新缓存可能回导致 RocksDB 数据库与 RedisCache 缓存不一致的现象[#2858](https://github.com/OpenAtomFoundation/pika/pull/2858)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 Pika 不支持 Redis-Sentinel 的问题[#2854](https://github.com/OpenAtomFoundation/pika/pull/2854)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 hincrby 命令多次执行返回结果不一致的问题[#2836](https://github.com/OpenAtomFoundation/pika/pull/2836)@[luky116](https://github.com/luky116)\n\n- 用 Rocky 环境替代 CentOS, github CI 流程总体支持 MacOS/Ubuntu/Rocky 三个环境[#2823](https://github.com/OpenAtomFoundation/pika/pull/2823)@[QlQlqiqi](https://github.com/QlQlqiqi)\n\n- 修改 client watch 的 key，被任何人修改（包括自己的改动），都会失效的问题[#2815](https://github.com/OpenAtomFoundation/pika/pull/2815)@[luky116](https://github.com/luky116)\n\n- 解决 Pika slave_prorority 赋值不准确导致从节点无法升主，不能使用 Redis-Sentinel 的问题[#2813](https://github.com/OpenAtomFoundation/pika/pull/2813)@[chejinge](https://github.com/chejinge)\n\n- 事务命令处理走 DB 的同时，走 RedisCache 避免出现 DB、缓存不一致的情况[#2812](https://github.com/OpenAtomFoundation/pika/pull/2812)@[luky116](https://github.com/luky116)\n\n- 优化主从复制，确保 Master 端的 SlaveNode 在提交 bgsave 任务前进入 DBSync 状态，防止bgsave执行时的 binlog 在极端情况下被清除[#2798](https://github.com/OpenAtomFoundation/pika/pull/2798)@[cheniujh](https://github.com/cheniujh)\n\n- 修改主从复制过程中 flushdb binlog 的处理逻辑，确保按照顺序执行，避免出现主从不一致的情况[#2794](https://github.com/OpenAtomFoundation/pika/pull/2794)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 BlockCache 计算不准确的问题[#2797](https://github.com/OpenAtomFoundation/pika/pull/2797)@[bigdaronlee163](https://github.com/bigdaronlee163)\n\n- 添加标志位、时间戳和返回值机制，确保 Pika 在执行 flushdb 且处理异步删除旧目录时冲突时正确处理[#2790](https://github.com/OpenAtomFoundation/pika/pull/2790)@[cheniujh](https://github.com/cheniujh)\n\n- 修复集群模式主备自动容灾过程中，老主节点降备过程中，因为 sent_offset 和 acked_offset 不相等，导致状态 Error 的情况[#2789](https://github.com/OpenAtomFoundation/pika/pull/2714)@[luky116](https://github.com/luky116)\n\n- PkpatternMatchDel 在删除数据库的同时删除 RedisCache，保证数据的一致性[#2777](https://github.com/OpenAtomFoundation/pika/pull/2777)@[haiyang426](https://github.com/haiyang426)\n\n- timerTaskThread_ 重命令为 timer_task_thread_[#2776](https://github.com/OpenAtomFoundation/pika/pull/2776)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 Sentinel 主从切换时，由于主节点和从节点数据量不一致导致主从切换状态扭转错误问题[#2766](https://github.com/OpenAtomFoundation/pika/pull/2766)@[cheniujh](https://github.com/cheniujh)\n\n- 修复连续扩容多个从实例，全量复制失败的问题[#2756](https://github.com/OpenAtomFoundation/pika/pull/2756)@[cheniujh](https://github.com/cheniujh)\n\n# v3.5.5\n\n## New features\n\n- 给 RTC 模型增加处理开关，可以根据开关控制是否开启 RTC 模型[#2841](https://github.com/OpenAtomFoundation/pika/pull/2841)@[cheniujh](https://github.com/cheniujh)\n\n- 用 RTC 模型处理 Pika 访问缓存部分，提升 Pika 服务的读性能[#2837](https://github.com/OpenAtomFoundation/pika/pull/2837)@[cheniujh](https://github.com/cheniujh)\n\n- incr、append 命令在传输 binlog 时，使用 pksetexat 命令，防止因为不正确的操作导致数据无法过期，出现脏数据[#2833](https://github.com/OpenAtomFoundation/pika/pull/2833)@[chejinge](https://github.com/chejinge)\n\n- 添加定时删除日志的任务，默认 7 天删除一次，可以根据自己需求在 config 文件中进行配置[#2829](https://github.com/OpenAtomFoundation/pika/pull/2829)@[XiaoLiang2333](https://github.com/XiaoLiang2333)\n\n- 将管理命令移出主线程，防止因为管理命令调用频繁或者耗时过高，阻塞主线程[#2727](https://github.com/OpenAtomFoundation/pika/pull/2727)@[chejinge](https://github.com/chejinge)\n\n- Pika 线程整理，避免启动无用线程造成资源浪费[#2697](https://github.com/OpenAtomFoundation/pika/pull/2697)@[chejinge](https://github.com/chejinge)\n\n- 添加 pika benchark 工具，旨在提升压测效率，并输出可视化的统计图表[#2663](https://github.com/OpenAtomFoundation/pika/pull/2663)@[luky116](https://github.com/luky116)\n\n\n## Improvement\n\n- 优化主从复制，确保 Master 端的 SlaveNode 在提交 bgsave 任务前进入 DBSync 状态，防止bgsave执行时的 binlog 在极端情况下被清除[#2798](https://github.com/OpenAtomFoundation/pika/pull/2798)@[cheniujh](https://github.com/cheniujh)\n\n- 优化 Apply binlog 时锁机制，减少不必要的锁竞争[#2773](https://github.com/OpenAtomFoundation/pika/pull/2773)@[cheniujh](https://github.com/cheniujh)\n\n- 添加 Geo 数据类型的 TCL 测试，并修复测试过程中遇到的 bug[#2753](https://github.com/OpenAtomFoundation/pika/pull/2753)@[saz97](https://github.com/saz97)\n\n- 更新 Pika Docker Readme, 可以按照 Readme 在 Docker 中部署 Pika 服务[#2743](https://github.com/OpenAtomFoundation/pika/pull/2743)@[luky116](https://github.com/luky116)\n\n- 支持对更多的 RocksDB 参数进行动态调整，用户根据不同的业务使用场景调整参数提升 Pika 的读写性能[#2728](https://github.com/OpenAtomFoundation/pika/pull/2728)@[cheniujh](https://github.com/cheniujh)\n\n- Pkpatternmatchdel 命令支持删除 Redis Stream 数据类型[#2723](https://github.com/OpenAtomFoundation/pika/pull/2723)@[wangshao1](https://github.com/wangshao1)\n\n- 重构主从复制模式 slave 节点的主从同步线程模型，尽可能减少 binlog 消费阻塞问题[#2638](https://github.com/OpenAtomFoundation/pika/pull/2638)@[cheniujh](https://github.com/cheniujh)\n\n- 增加主从复制状态指标 repl_connect_status，方便运维人员清晰明确的判断当前的主从复制状态[#2656](https://github.com/OpenAtomFoundation/pika/pull/2656)@[cheniujh](https://github.com/cheniujh)\n\n- 新增 RocksDB Compaction 策略动态调整参数，用户可以根据业务调整 Compaction 策略，降低 Compaction 操作对服务性能的损耗[#2538](https://github.com/OpenAtomFoundation/pika/pull/2735)@[wangshao1](https://github.com/wangshao1)\n\n- 对事务新增 TCL 测试并修复测试中遇到的 bug[#2844](https://github.com/OpenAtomFoundation/pika/pull/2844)@[luky116](https://github.com/luky116)\n\n\n## Bugfix\n\n- 修改 Pika 自动化测试客户端链接 server 端的超时时间，避免因为长时间断开导致测试失败[#2863](https://github.com/OpenAtomFoundation/pika/pull/2863)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 kill client 命令杀连接流程不正确的[#2862](https://github.com/OpenAtomFoundation/pika/pull/2862)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 `blpop/brpop` 更新数据库的时候未更新缓存可能回导致 RocksDB 数据库与 RedisCache 缓存不一致的现象[#2858](https://github.com/OpenAtomFoundation/pika/pull/2858)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 Pika 不支持 Redis-Sentinel 的问题[#2854](https://github.com/OpenAtomFoundation/pika/pull/2854)@[cheniujh](https://github.com/cheniujh)\n\n- 修改 `flushall` 的逻辑避免统一处理时，多清理一次数据[#2846](https://github.com/OpenAtomFoundation/pika/pull/2846)@[cheniujh](https://github.com/cheniujh)\n\n- `PkPatternMatchDel` 命令在删除 DB 的同时删除 RedisCache，避免出现 RocksDB 数据库与 RedisCache 缓存数据不一致的情况[#2839](https://github.com/OpenAtomFoundation/pika/pull/2839)@[chejinge](https://github.com/chejinge)\n\n- 用 Rocky 环境替代 CentOS, github CI 流程总体支持 MacOS/Ubuntu/Rocky 三个环境[#2823](https://github.com/OpenAtomFoundation/pika/pull/2823)@[QlQlqiqi ](https://github.com/QlQlqiqi)\n\n- 优化读锁的范围，避免因为重复消费 binlog 导致主、从数据不一致的问题[#2818](https://github.com/OpenAtomFoundation/pika/pull/2818)@[cheniujh](https://github.com/cheniujh)\n\n- 修改 client watch 的 key，被任何人修改（包括自己的改动），都会失效的问题[#2815](https://github.com/OpenAtomFoundation/pika/pull/2815)@[luky116](https://github.com/luky116)\n\n- 修改 slave_priority 的默认值，防止因为运维同学没有设置该值，导致主从切换失败[#2813](https://github.com/OpenAtomFoundation/pika/pull/2813)@[chejinge](https://github.com/chejinge)\n\n- Multi 命令更新数据库的同时更新缓存，避免读取不到数据[#2810](https://github.com/OpenAtomFoundation/pika/pull/2810)@[luky116](https://github.com/luky116)\n\n- 修复执行 `slaveof no one` 时出现异常日志输出的问题[#2800](https://github.com/OpenAtomFoundation/pika/pull/2800)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 Pika block-cache 信息计算不准确，内存使用计算不标准的问题[#2797](https://github.com/OpenAtomFoundation/pika/pull/2797)@[bigdaronlee163](https://github.com/bigdaronlee163)\n\n- 修改主从复制过程中 flushdb binlog 的处理逻辑，确保按照顺序执行，避免出现主从不一致的情况[#2794](https://github.com/OpenAtomFoundation/pika/pull/2794)@[cheniujh](https://github.com/cheniujh)\n\n- 添加标志位、时间戳和返回值机制，确保 Pika 在执行 flushdb 且处理异步删除旧目录时冲突时正确处理[#2790](https://github.com/OpenAtomFoundation/pika/pull/2790)@[cheniujh](https://github.com/cheniujh)\n\n- 修改主从复制过程中 flushdb binlog 的处理逻辑，确保按照顺序执行，避免出现主从不一致的情况[#2790](https://github.com/OpenAtomFoundation/pika/pull/2790)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 `PKPatternMatchDel` 命令未删除迭代器可能会导致 RocksDB 删除数据不彻底的问题[#2786](https://github.com/OpenAtomFoundation/pika/pull/2786)@[wangshao1](https://github.com/wangshao1)\n\n- timerTaskThread_ 重命令为 timer_task_thread_[#2776](https://github.com/OpenAtomFoundation/pika/pull/2776)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 min-blob-size 参数解析失败，导致 kv 分离使用出错的问题[#2767](https://github.com/OpenAtomFoundation/pika/pull/2767)@[wangshao1](https://github.com/wangshao1)\n\n- 修复 sentinel 主从切换时，由于主节点和从节点数据量不一致导致主从切换状态扭转错误问题[#2766](https://github.com/OpenAtomFoundation/pika/pull/2766)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 `Zverank` 命令计算错误，导致返回值错误的问题[#2763](https://github.com/OpenAtomFoundation/pika/pull/2763)@[chejinge](https://github.com/chejinge)\n\n- 修复 `Pksetat` 命令更新 DB 的同时未更新 RedisCache 缓存，可能会存在 RocksDB 数据库与 RedisCache 缓存不一致的问题[#2759](https://github.com/OpenAtomFoundation/pika/pull/2759)@[chejinge](https://github.com/chejinge)\n\n- 修复 Pika-port 传输数据过程中报错的问题[#2758](https://github.com/OpenAtomFoundation/pika/pull/2758)@[guangkun123](https://github.com/guangkun123)\n\n- 修复 RsynClient 异常退出后，未做失败处理导致全量复制数据不完整的问题[#2756](https://github.com/OpenAtomFoundation/pika/pull/2756)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 Pika 不能批量扩容的问题[#2746](https://github.com/OpenAtomFoundation/pika/pull/2746)@[cheniujh](https://github.com/cheniujh)\n\n- 修复参数未初始化导致 slotsscan 等命令不能和 bgsave 命令相互制衡的问题[#2745](https://github.com/OpenAtomFoundation/pika/pull/2745)@[chejinge](https://github.com/chejinge)\n\n- 修复 SlotMigrate 返回值错误，可能会导致数据迁移中断的问题[#2741](https://github.com/OpenAtomFoundation/pika/pull/2741)@[wangshao1](https://github.com/wangshao1)\n\n- Pksetexat 更新数据库的同时更新 RedisCache，避免出现RocksDB 数据库与 RedisCache 缓存不一致的问题[#2736](https://github.com/OpenAtomFoundation/pika/pull/2736)@[longfar-ncy](https://github.com/longfar-ncy)\n\n- 修复 RedisCache 层因为没有使用 storage 层解析的 ttl 可能会导致 RocksDB 数据库与 RedisCache 缓存不一致的问题[#2729](https://github.com/OpenAtomFoundation/pika/pull/2729)@[chejinge](https://github.com/chejinge)\n\n- 修复 Stream 类型数据不能被 RocksDB compaction 会导致过期数据一直存在的问题[#2724](https://github.com/OpenAtomFoundation/pika/pull/2724)@[wangshao1](https://github.com/wangshao1)\n\n- 修复 ACL 认证可能会偶发性失败的问题[#2714](https://github.com/OpenAtomFoundation/pika/pull/2714)@[luky116](https://github.com/luky116)\n\n- 修复 Pika cmdID 赋值在 Cmd 初始函数中，可能会导致并发构造的时候出现内存泄漏的问题[#2692](https://github.com/OpenAtomFoundation/pika/pull/2692)@[gukj-spel](https://github.com/gukj-spel)\n\n- 修复 Spop 在写 binlog 时可能会出现竞态问题[#2674](https://github.com/OpenAtomFoundation/pika/pull/2674)@[cheniujh](https://github.com/cheniujh)\n\n- 修复 server_stat 中的数据竞态问题[#2671](https://github.com/OpenAtomFoundation/pika/pull/2671)@[cheniujh](https://github.com/cheniujh)\n\n- 修复多 DB 下全量同步超时后不重试的问题[#2667](https://github.com/OpenAtomFoundation/pika/pull/2667)@[cheniujh](https://github.com/cheniujh)\n\n- 修复多 DB 主从超时场景下，可能会出现窗口崩溃的问题[#2666](https://github.com/OpenAtomFoundation/pika/pull/2666)@[cheniujh](https://github.com/cheniujh)\n\n- 修复主从同步限速逻辑中重复解锁的问题[#2657](https://github.com/OpenAtomFoundation/pika/pull/2657)@[cheniujh](https://github.com/cheniujh)\n\n# v4.0.0\n\n## New features\n\n- Pika Geo 数据类型增加 TCL 测试，并修复测试过程中遇到的缺陷[#2753](https://github.com/OpenAtomFoundation/pika/pull/2753)@[saz97](https://github.com/saz97)\n\n- Pika 支持在 FreeBSD14 平台上进行编译打包[#2711](https://github.com/OpenAtomFoundation/pika/pull/2711)@[lqxhub](https://github.com/lqxhub)\n\n- Pika 线程整理，避免启动过多无用线程，对不同的线程进行命名，方便问题定位[#2697](https://github.com/OpenAtomFoundation/pika/pull/2697)@[chejinge](https://github.com/chejinge)\n\n- Mget 支持多 key 查询缓存, 记录未命中的 key 去 DB 中查询，提升 Pika 服务的读性能[#2675](https://github.com/OpenAtomFoundation/pika/pull/2675)@[chejinge](https://github.com/chejinge)\n\n- Codis 支持 info 命令, 可以通过该命令查询 Codis-proxy 的 info 信息[#2688](https://github.com/OpenAtomFoundation/pika/pull/2688)@[chienguo](https://github.com/chienguo)\n\n- 添加 Floyd 的 compaction-filter 的 Gtest[#2669](https://github.com/OpenAtomFoundation/pika/pull/2669)@[Mixficsol ](https://github.com/Mixficsol)\n\n- Codis-proxy 新增 P99 P95 等监控耗时指标[#2668](https://github.com/OpenAtomFoundation/pika/pull/2668)@[chejinge](https://github.com/chejinge)\n\n- 添加 Pika 压测指标，提升 Pika 压测效率，并输出可视化的统计图表[#2663](https://github.com/OpenAtomFoundation/pika/pull/2663)@[luky116](https://github.com/luky116)\n\n- Pika 主从复制新增监控指标 repl_connect_status, 可以更加明确清晰的确定当前的主从复制的状态[#2638](https://github.com/OpenAtomFoundation/pika/pull/2638)@[cheniujh](https://github.com/cheniujh)\n\n- Pika 不支持不同类型的重复 key, 写入重复 key 返回非法类型[#2609](https://github.com/OpenAtomFoundation/pika/pull/2609)@[Mixficsol](https://github.com/Mixficsol)\n\n- 添加支持分区索引过滤的功能[#2601](https://github.com/OpenAtomFoundation/pika/pull/2601)@[vacheli](https://github.com/vacheli)\n\n- Pika 支持第三代存储引擎 Floyd, 通过支持多 rocksdb 实例、对 Blob 的使用进行优化、对过期数据的清理进行优化，提升了 Pika 实例的读写性能[#2413](https://github.com/OpenAtomFoundation/pika/pull/2413)@[wangshao1](https://github.com/wangshao1)\n\n## Improvement\n\n- 更新 Pika Docker Readme, 可以按照 Readme 在 Docker 中部署 Pika 服务[#2743](https://github.com/OpenAtomFoundation/pika/pull/2743)@[luky116](https://github.com/luky116)\n\n- 优化重复查询 meta value 导致影响 Pika 服务读写性能的问题[#2735](https://github.com/OpenAtomFoundation/pika/pull/2735)@[wangshao1](https://github.com/wangshao1)\n\n- 支持对更多的 RocksDB 参数进行动态调整，用户根据不同的业务使用场景调整参数提升 Pika 的读写性能[#2728](https://github.com/OpenAtomFoundation/pika/pull/2728)@[cheniujh](https://github.com/cheniujh)\n\n- 对 HyperLogLog 和 String 进行类型隔离，确保 HyperLogLog 操作与 String 操作明确区分开[#2720](https://github.com/OpenAtomFoundation/pika/pull/2720)@[saz97](https://github.com/saz97)\n\n- 更新了 PR 标题验证，不允许在标题末尾出现中文字符[#2718](https://github.com/OpenAtomFoundation/pika/pull/2718)@[baerwang](https://github.com/baerwang)\n\n- 重构主从复制模式 slave 节点的主从同步线程模型，尽可能减少 binlog 消费阻塞问题[#2638](https://github.com/OpenAtomFoundation/pika/pull/2638)@[cheniujh](https://github.com/cheniujh)\n\n- 新增 RocksDB Compaction 策略动态调整参数，用户可以根据业务调整 Compaction 策略，降低  Compaction 操作对服务性能的损耗[#2538](https://github.com/OpenAtomFoundation/pika/pull/2538)@[MalikHou](https://github.com/MalikHou)\n\n## Bugfix\n\n- 修复 iter 未被析构，导致 pkpatternmatchdel 在返回之前不会删除 iter，这可能会导致 rocksdb 永远引用一个版本，导致数据不符合预期的问题[#2785](https://github.com/OpenAtomFoundation/pika/pull/2785)@[wangshao1](https://github.com/wangshao1)\n\n- 修复 config 参数 min-blob-size 带单位时解析错误的问题[#2767](https://github.com/OpenAtomFoundation/pika/pull/2767)@[wangshao1](https://github.com/wangshao1)\n\n- 修复 zverank 返回值异常的问题[#2763](https://github.com/OpenAtomFoundation/pika/pull/2763)@[chejinge](https://github.com/chejinge)\n\n- 修复 Pika-port 传输数据过程中报错的问题[#2758](https://github.com/OpenAtomFoundation/pika/pull/2758)@[guangkun123](https://github.com/guangkun123)\n\n- 修复因为堆上分配的缓冲区越界导致 Dbsize 命令运行时崩溃的问题 [#2749](https://github.com/OpenAtomFoundation/pika/pull/2749)@[wangshao1](https://github.com/wangshao1)\n\n- 修复批量扩容时，多个 slave 同时连接 master, 短时间多次 bgsave 导致部分从节点数据不完整的问题[#2746](https://github.com/OpenAtomFoundation/pika/pull/2746)@[cheniujh](https://github.com/cheniujh)\n\n- 修复参数未初始化导致 slotsscan 等命令不能和 bgsave 命令相互制衡的问题[#2745](https://github.com/OpenAtomFoundation/pika/pull/2745)@[chejinge](https://github.com/chejinge)\n\n- 修复 Slotmigrate 迁移数据的过程中，返回值设置错误，异常场景下会终止数据迁移的问题[#2741](https://github.com/OpenAtomFoundation/pika/pull/2741)@[chejinge](https://github.com/chejinge)\n\n- 修复 Mget 没有使用解析 ttl 的函数导致出现部分key的ttl未被更新，数据不一致的问题[#2730](https://github.com/OpenAtomFoundation/pika/pull/2730)@[chejinge](https://github.com/chejinge)\n\n- 修复 pkpatternmatchdel 命令使用错误导致的 stream 类型数据删除异常的问题[#2726](https://github.com/OpenAtomFoundation/pika/pull/2726)@[wangshao1](https://github.com/wangshao1)\n\n- 修复 pkpatternmatchdel 不能正确删除掉对应的 keys 的问题[#2717](https://github.com/OpenAtomFoundation/pika/pull/2717)@[wangshao1](https://github.com/wangshao1)\n\n- 修复 ACL 密码验证错误问题[#2714](https://github.com/OpenAtomFoundation/pika/pull/2714)@[luky116](https://github.com/luky116)\n\n- 修复 Keyspace 命令未计算 Stream 类型数据的问题[#2705](https://github.com/OpenAtomFoundation/pika/pull/2705)@[wangshao1](https://github.com/wangshao1)\n\n- 对部分命令定制化处理逻辑，避免写 binlog 导致从节点的 binlog 解析失败的问题[#2693](https://github.com/OpenAtomFoundation/pika/pull/2693)@[cheniujh ](https://github.com/cheniujh)\n\n- 修复 Pika cmdID 赋值在 Cmd 初始函数中，可能会导致并发构造的时候出现内存泄漏的问题[#2692](https://github.com/OpenAtomFoundation/pika/pull/2692)@[gukj-spel](https://github.com/gukj-spel)\n\n- 修复 ExpectedStale 未考虑 String 类型, 如果存在已经过期的 String 类型的 key, ExpectedStale 会返回错误的问题[#2682](https://github.com/OpenAtomFoundation/pika/pull/2682)@[wangshao1](https://github.com/wangshao1)\n\n- 修复 Spop 在写 binlog 时可能会出现竞态问题[#2674](https://github.com/OpenAtomFoundation/pika/pull/2674)@[cheniujh](https://github.com/cheniujh)\n\n- db instance 设置不合理时，给用户错误提示[#2672](https://github.com/OpenAtomFoundation/pika/pull/2672)@[Mixficsol](https://github.com/Mixficsol)\n\n- 修复 server_stat 中的数据竞态问题[#2671](https://github.com/OpenAtomFoundation/pika/pull/2671)@[cheniujh](https://github.com/cheniujh)\n\n- 修复多 DB 下全量同步超时后不重试的问题[#2667](https://github.com/OpenAtomFoundation/pika/pull/2667)@[cheniujh](https://github.com/cheniujh)\n\n- 修复多 DB 主从超时场景下，可能会出现窗口崩溃的问题[#2666](https://github.com/OpenAtomFoundation/pika/pull/2666)@[cheniujh](https://github.com/cheniujh)\n\n- 修复主从同步限速逻辑中重复解锁的问题[#2657](https://github.com/OpenAtomFoundation/pika/pull/2657)@[cheniujh](https://github.com/cheniujh)\n\n- 发版支持自动打包 centos7 和 centos8 平台的二进制编译包[#2535](https://github.com/OpenAtomFoundation/pika/pull/2535)@[baerwang](https://github.com/baerwang)\n\n- 修复 Codis 侧的 getrange 命令没有返回预期结果的问题[#2510](https://github.com/OpenAtomFoundation/pika/pull/2510)@[luky116](https://github.com/luky116)\n\n\n# v3.5.4\n\n## New features\n\n- Pika 支持动态调整全量同步限速参数 rsync-timeout-ms 和 throttle-bytes-per-second[#2633](https://github.com/OpenAtomFoundation/pika/pull/2633)@[cheniujh](https://github.com/cheniujh)\n\n- 将 info key space 1 的结果输出至 info all 并展示到监控界面中[#2603](https://github.com/OpenAtomFoundation/pika/pull/2603)@[XiaoLiang2333](https://github.com/XiaoLiang2333)\n\n- Pika 磁盘IO 限速参数支持 OnlyRead、OnlyWrite、ReadAndWrite，默认支持OnlyWrite[#2599](https://github.com/OpenAtomFoundation/pika/pull/2599)@[vacheli](https://github.com/vacheli)\n\n## Improvement\n\n- slotmigrate 添加 go test [#2576](https://github.com/OpenAtomFoundation/pika/pull/2576)@[chejinge](https://github.com/chejinge)\n\n- INFO 命令耗时优化，降低查磁盘频率 [#2554](https://github.com/OpenAtomFoundation/pika/pull/2554) @[wangshao1](https://github.com/wangshao1)\n\n- 对五种基本数据类型命令增加 Redis tcl 测试 [#2527](https://github.com/OpenAtomFoundation/pika/pull/2527)@[Mixficsol](https://github.com/Mixficsol)\n\n## Bugfix\n\n- 修复使用 `Pika Exporter` 时可能会出现 slots 分配不均衡的问题[#2651](https://github.com/OpenAtomFoundation/pika/pull/2651)@[chejinge](https://github.com/chejinge)\n\n- 修复 Codis dashboard 不能正确更新 master 实例状态的问题[#2650](https://github.com/OpenAtomFoundation/pika/pull/2650)@[vacheli](https://github.com/vacheli)\n\n- 修复 Redis 事务 binlog 解析失败导致的主从同步异常问题[#2642](https://github.com/OpenAtomFoundation/pika/pull/2642)@[chejinge](https://github.com/chejinge)\n\n- 修复 `Pika Expoter` 启动时不带参数导致启动失败问题[#2640](https://github.com/OpenAtomFoundation/pika/pull/2640)@[Polaris3003](https://github.com/Polaris3003)\n\n- 修复使用 `Pika Operater` 拉起集群`Codis-proxy` panic 的问题  [#2632](https://github.com/OpenAtomFoundation/pika/pull/2633)@[chejinge](https://github.com/chejinge)\n\n- 修复 CI 编译出的二进制进行自动化测试时 cp 命令失败问题[#2614](https://github.com/OpenAtomFoundation/pika/pull/2614)@[cheniujh](https://github.com/cheniujh)\n\n- 修复变量未初始化导致 cache 启动失败的问题[#2613](https://github.com/OpenAtomFoundation/pika/pull/2613)@[chejinge](https://github.com/chejinge)\n\n- 修复 userpass 和 userblacklist 动态修改参数功能异常问题[#2600](https://github.com/OpenAtomFoundation/pika/pull/2600)@[chejinge](https://github.com/chejinge)\n\n- 修复 scard sscan 结果不一致的问题[#2596](https://github.com/OpenAtomFoundation/pika/pull/2596)@[chejinge](https://github.com/chejinge)\n\n- 修复当 max-rsync-parallel-num 大于4，slave 会在主从复制时 coredump 的问题[#2595](https://github.com/OpenAtomFoundation/pika/pull/2595)@[chejinge](https://github.com/chejinge)\n\n- 调整不常用的线程池线程数，避免因为空跑导致性能损耗[#2590](https://github.com/OpenAtomFoundation/pika/pull/2590) @[chejinge](https://github.com/chejinge)\n\n- 修复 Pika 事务边缘测试 case 不通过的问题[#2586](https://github.com/OpenAtomFoundation/pika/pull/2586) @[chejinge](https://github.com/chejinge)\n\n- 将 cache-model 修改成 cache-mode[#2585](https://github.com/OpenAtomFoundation/pika/pull/2585)@[chejinge](https://github.com/chejinge)\n\n- 修复使用 `info keyspace` 后，`info all` 死锁的问题[#2584](https://github.com/OpenAtomFoundation/pika/pull/2584) @[chejinge](https://github.com/chejinge)\n\n- 修复因修改 zsetscorekeycomparatorimpl 字典序比较熟顺序，导致353 352极端场景不兼容的问题[#2583](https://github.com/OpenAtomFoundation/pika/pull/2583) @[wangshao1](https://github.com/wangshao1)\n\n- 修复 `compact` 死锁的问题 [#2581](https://github.com/OpenAtomFoundation/pika/pull/2581) @[chejinge](https://github.com/chejinge)\n\n- slotmigrate 添加 go test [#2576](https://github.com/OpenAtomFoundation/pika/pull/2576)@[chejinge](https://github.com/chejinge)\n\n- 更新 `Pika Operater` 使用的 pika 版本[#2572](https://github.com/OpenAtomFoundation/pika/pull/2572)@[chejinge](https://github.com/chejinge)\n\n- 修复 config rewrite 后 blockcache 数值异常的问题[#2561](https://github.com/OpenAtomFoundation/pika/pull/2561)@[chejinge](https://github.com/chejinge)\n\n- 修复 slotmigrate 动态修复后值错误的问题[#2548](https://github.com/OpenAtomFoundation/pika/pull/2548)@[chejinge](https://github.com/chejinge)\n\n- 修复 spop 可能会出现主从数据不一致的问题[#2541](https://github.com/OpenAtomFoundation/pika/pull/2541)@[chenbt-hz](https://github.com/chenbt-hz)\n\n- 修复 CloseFd(it->second[i]) 出现越界的问题[#2539](https://github.com/OpenAtomFoundation/pika/pull/2539)@[chejinge](https://github.com/chejinge)\n\n- 修复 Flushall 和 FlushDB 死锁的隐患，并删除 FlushSubDB 接口[#2533](https://github.com/OpenAtomFoundation/pika/pull/2533)@[Mixficsol](https://github.com/Mixficsol)\n\n- 增加参数控制是否清理 tcl 测试后产生的数据文件，防止废弃数据占据磁盘[#2507](https://github.com/OpenAtomFoundation/pika/pull/2507)@[Mixficsol](https://github.com/Mixficsol)\n\n\n# v3.5.3\n\n## 新特性\n\n- Pika 支持 ACL[#2013](https://github.com/OpenAtomFoundation/pika/pull/2013) @[lqxhub](https://github.com/lqxhub)\n\n- 在 Codis dashboard 协程 panic 时自动恢复服务[#2349](https://github.com/OpenAtomFoundation/pika/pull/2349)@[chengyu-l](https://github.com/chengyu-l)\n\n- 在全量复制的过程中，pika 服务的从节点不接收读流量请求 [#2197](https://github.com/OpenAtomFoundation/pika/pull/2197)  @[tedli](https://github.com/tedli)\n\n- Pika cache 新增 bimap 数据类型[#2253](https://github.com/OpenAtomFoundation/pika/pull/2253)  @[chejinge](https://github.com/chejinge)\n\n- 删除 Sharing 模式残留的 Slot，Pika 下只有 DB，一个 Pika 下有多个 DB[#2251](https://github.com/OpenAtomFoundation/pika/pull/2251) @[Mixficsol](https://github.com/Mixficsol)\n\n- Pika exporter 暴露 cache 相关的数据采集指标[#2318](https://github.com/OpenAtomFoundation/pika/pull/2318) @[dingxiaoshuai](https://github.com/dingxiaoshuai123)\n\n- Pika 支持快慢命令分离[#2162](https://github.com/OpenAtomFoundation/pika/pull/2162) @[dingxiaoshuai](https://github.com/dingxiaoshuai123)\n\n- pika 执行完成 Bgsave后, 保留 unix timepoint[#2167](https://github.com/OpenAtomFoundation/pika/pull/2167) @[hero-heng](https://github.com/hero-heng)\n\n- Pika 支持动态配置 disable_auto_compations 参数[#2257](https://github.com/OpenAtomFoundation/pika/pull/2257) @[hero-heng](https://github.com/hero-heng)\n\n- Pika 支持 Redis Stream[#1955](https://github.com/OpenAtomFoundation/pika/pull/1955) @[KKorpse](https://github.com/KKorpse)\n\n- Pika 支持大 key 分析工具[#2195](https://github.com/OpenAtomFoundation/pika/pull/2195) @[sjcsjc123](https://github.com/sjcsjc123)\n\n- Pika 支持动态调整 Pika cache 参数[#2253](https://github.com/OpenAtomFoundation/pika/pull/2253) @[chejinge](https://github.com/chejinge)\n\n- 更新 Pika benchmark 工具支持更多的接口压测[#2222](https://github.com/OpenAtomFoundation/pika/pull/2222)@[wangshao1](https://github.com/wangshao1)\n\n- Pika Operator 支持 pika 集群自动扩容[#2121](https://github.com/OpenAtomFoundation/pika/pull/2121)@[machinly](https://github.com/machinly/)\n\n- 添加 CompactRange 命令支持对一定范围内的 key 进行 compact[#2163](https://github.com/OpenAtomFoundation/pika/pull/2163)@[u6th9d](https://github.com/u6th9d)\n\n- 提升 Compaction 速度减少 Compaction 耗时[#2172](https://github.com/OpenAtomFoundation/pika/pull/2172)@[u6th9d](https://github.com/u6th9d)\n\n- 升级 RocksDB 版本到 v8.7.3[#2157](https://github.com/OpenAtomFoundation/pika/pull/2157)@[JasirVoriya](https://github.com/JasirVoriya)\n\n- Pika 分布式集群 Codis proxy 新增可观测指标[#2199](https://github.com/OpenAtomFoundation/pika/pull/2199)@[dingxiaoshuai](https://github.com/dingxiaoshuai123)\n\n- Pika 分布式集群支持自动 failover[#2386](https://github.com/OpenAtomFoundation/pika/pull/2386)@[chengyu-l](https://github.com/chengyu-l)\n\n- Pika 支持 redis rename-command 功能[#2455](https://github.com/OpenAtomFoundation/pika/pull/2455)@[Mixficsol](https://github.com/Mixficsol)\n\n- 优化 codis slot 迁移速度，支持动态修改迁移线程和速度[#2486](https://github.com/OpenAtomFoundation/pika/pull/2486) @[chejinge](https://github.com/chejinge)\n\n- Pika 支持动态调整 max-conn-rbuf-size 参数[#2434](https://github.com/OpenAtomFoundation/pika/pull/2434) @[HappyUncle](https://github.com/HappyUncle)\n\n- Pika-operator 支持 namespace，可以在不同的 namespace 下部署不同的集群[#2480](https://github.com/OpenAtomFoundation/pika/pull/2480) @[Y-Rookie](https://github.com/Y-Rookie)\n\n- Pika-operator 支持监控指标采集，自动拉起 Pika-expoter[#2451](https://github.com/OpenAtomFoundation/pika/pull/2451) @[chengyu-l](https://github.com/chengyu-l)\n\n- ACL 向前兼容 userblacklist[#2459](https://github.com/OpenAtomFoundation/pika/pull/2459) @[dingxiaoshuai](https://github.com/dingxiaoshuail)\n\n- 丰富了 Pika TCL 测试集[#2497](https://github.com/OpenAtomFoundation/pika/pull/2497) @[Mixficsol](https://github.com/Mixficsol)\n\n- 丰富了 Pika Gotest 测试集[#2502](https://github.com/OpenAtomFoundation/pika/pull/2502) @[Mixficsol](https://github.com/Mixficsol)\n\n## Bugfix\n\n- 修复 Pika 有从节点进行全量复制期间会误删除 dump 文件的问题[#2377](https://github.com/OpenAtomFoundation/pika/pull/2377)@[wangshao1](https://github.com/wangshao1)\n\n- 修复主从复制过程中, slave 节点收到 master 异常回包后的处理逻辑[#2319](https://github.com/OpenAtomFoundation/pika/pull/2319)@[wangshao1](https://github.com/wangshao1)\n\n- 在 Pika 执行 shutdown 命令时调用 disable compaction, 提升进程退出速度 [#2345](https://github.com/OpenAtomFoundation/pika/pull/2345) @[panlei-coder](https://github.com/panlei-coder)\n\n- 修复 Codis-dashboard Redis Memory 值不准确的问题[#2337](https://github.com/OpenAtomFoundation/pika/pull/2337) @[Mixficsol](https://github.com/Mixficsol)\n\n- INFO 命令耗时优化，降低查磁盘频率 [#2197](https://github.com/OpenAtomFoundation/pika/pull/2197)  @[chejinge](https://github.com/chejinge)\n\n- 修复 Rsync 删除临时文件路径不对，删除失败，导致rocksdb打开失败的问题[#2186](https://github.com/OpenAtomFoundation/pika/pull/2186)@[wangshao1](https://github.com/wangshao1)\n\n- 修复 Compact ,Bgsave ,Info keyspace 命令未指定db名称，导致部分命令 coredump 的问题[#2194](https://github.com/OpenAtomFoundation/pika/pull/2194)@[u6th9d](https://github.com/u6th9d)\n\n- Codis dashboard 用 info replication 替代 info 命令查寻 master ip 降低对 Pika 的性能影响 [#2198](https://github.com/OpenAtomFoundation/pika/pull/2198)  @[chenbt-hz](https://github.com/chenbt-hz)\n\n- 修复 Pika cache 使用边缘case，解决部分场景下 cache 和 DB 数据不一致的问题[#2225](https://github.com/OpenAtomFoundation/pika/pull/2225)  @[chejinge](https://github.com/chejinge)\n\n- 修复当 dump 文件夹为空时，会启动报错 Segmentation fault 的问题[#2265](https://github.com/OpenAtomFoundation/pika/pull/2265)  @[chenbt-hz](https://github.com/chenbt-hz)\n\n- 修复因为flag计算错误,导致的部分命令缓存没有生效问题[#2217](https://github.com/OpenAtomFoundation/pika/pull/2217) @[lqxhub](https://github.com/lqxhub)\n\n- 修复主从复制模式下，主实例 flushdb 后，从实例因为死锁导致的不能访问的问题[#2249](https://github.com/OpenAtomFoundation/pika/pull/2249)@[ForestLH](https://github.com/ForestLH)\n\n- 修复部分命令未对 RocksDB 的返回值进行判断的问题[#2187](https://github.com/OpenAtomFoundation/pika/pull/2187)@[callme-taota](https://github.com/callme-taota)\n\n- 规范函数的返回值及初始值[#2176](https://github.com/OpenAtomFoundation/pika/pull/2176)@[Mixficsol](https://github.com/Mixficsol)\n\n- 修复网络监控指标统计不准确的问题[#2234](https://github.com/OpenAtomFoundation/pika/pull/2234)@[chengyu-l](https://github.com/chengyu-l)\n\n- 修复配置文件加载部分参数异常的问题[#2218](https://github.com/OpenAtomFoundation/pika/pull/2218)@[jettcc](https://github.com/jettcc)\n\n- 修复 Codis dashboard cpu 100% 的问题[#2393](https://github.com/OpenAtomFoundation/pika/pull/2393)@[chengyu-l](https://github.com/chengyu-l)\n\n- 修复 Codis fe pika 主从角色显示异常的问题[#2387](https://github.com/OpenAtomFoundation/pika/pull/2387)@[chengyu-l](https://github.com/chengyu-l)\n\n- 修复迁移数据后数据不一致的问题[#2485](https://github.com/OpenAtomFoundation/pika/pull/2485)@[chejinge](https://github.com/chejinge)\n\n- 修复dbsize 计算错误问题[#2494](https://github.com/OpenAtomFoundation/pika/pull/2494)@[chejinge](https://github.com/chejinge)\n\n- 修复扩缩容或者 pod 起停后，Codis-dashboard 界面显示不准确的问题[#2475](https://github.com/OpenAtomFoundation/pika/pull/2475)@[chengyu-l](https://github.com/chengyu-l)\n\n- 修复 DB 层重复上锁的问题[#2372](https://github.com/OpenAtomFoundation/pika/pull/2372) @[Mixficsol](https://github.com/Mixficsol)\n\n- 修复全量复制失败后，未做处理导致数据丢失问题[#2439](https://github.com/OpenAtomFoundation/pika/pull/2439)@[wangshao1](https://github.com/wangshao1)\n\n- 修复主从复制过程中，主实例执行 bgsave 过程中，没有正确回应从的同步请求[#2437](https://github.com/OpenAtomFoundation/pika/pull/2437)@[wangshao1](https://github.com/wangshao1)\n\n- 全量复制过程中，添加数据同步状态，明确数据同步进度[#2430](https://github.com/OpenAtomFoundation/pika/pull/2430)@[baixin01](https://github.com/baixin01)\n\n- 修复从库在 Apply binlog 时，没有对操作的 key 加锁，导致数据不一致的问题[#2409](https://github.com/OpenAtomFoundation/pika/pull/2490) @[chejinge](https://github.com/chejinge)\n\n- 修复 codis slot 迁移过程中 master 实例 coredump 的问题[#2415](https://github.com/OpenAtomFoundation/pika/pull/2415) @[chejinge](https://github.com/chejinge)\n\n- 修复在主从复制过程中，删除正在使用的 dump 文件的问题[#2377](https://github.com/OpenAtomFoundation/pika/pull/2377)@[wangshao1](https://github.com/wangshao1)\n\n- 修复主从复制过程中从实例 rsync 响应错误的问题[#2319](https://github.com/OpenAtomFoundation/pika/pull/2319)@[wangshao1](https://github.com/wangshao1)\n\n- 修复主从复制模式下，主实例flushdb后，从实例因死锁而无法访问的问题[#2372](https://github.com/OpenAtomFoundation/pika/pull/2372) @[Mixficsol](https://github.com/Mixficsol)\n\n# v3.5.2\n\n## 新特性\n\n- Pika 支持 Redis 事务 [#2124](https://github.com/OpenAtomFoundation/pika/pull/2124) @[ForestLH](https://github.com/ForestLH)\n\n- Pika 上层增加缓存层实现冷热数据分离，提升读性能 [#2133](https://github.com/OpenAtomFoundation/pika/pull/2133) @[chejinge](https://github.com/chejinge)@[Mixficsol](https://github.com/Mixficsol)\n\n- Codis-Proxy 支持动态修改配置参数 [#2103](https://github.com/OpenAtomFoundation/pika/pull/2103) @[dingxiaoshuai123](https://github.com/dingxiaoshuai123)\n\n- 补全 Go Test 测试用例 [#2063](https://github.com/OpenAtomFoundation/pika/pull/2063)@[dingxiaoshuai123](https://github.com/dingxiaoshuai123)\n\n- CI 增加 cache 提升编译速度 [#2088](https://github.com/OpenAtomFoundation/pika/pull/2088)@[baerwang](https://github.com/baerwang)\n\n## Bugfix\n\n- 修复 pika 在使用 SETRANGE 命令出现 coredump的问题 [#2125](https://github.com/OpenAtomFoundation/pika/issues/2125) @[chejinge](https://github.com/chejinge)\n\n- 修复因删除 Clearreplicationid 写进 binlog 导致的全量复制问题 [#2136](https://github.com/OpenAtomFoundation/pika/issues/2136) @[Mixficsol](https://github.com/Mixficsol)\n\n- 修改锁粒度，提升 pika 写 binlog 的性能 [#2129](https://github.com/OpenAtomFoundation/pika/pull/2129) @[wangshao1](https://github.com/wangshao1)\n\n- 增加 redis-copy 流量复制工具 [#2044](https://github.com/OpenAtomFoundation/pika/issues/2044)  @[Mixficsol](https://github.com/Mixficsol)\n\n- 修复复杂数据类型成员变量可能出现数据溢出  [#2016](https://github.com/OpenAtomFoundation/pika/pull/2106)  @[u6th9d](https://github.com/u6th9d)\n\n- 修复 decr 命令返回值错误问题 [#2092](https://github.com/OpenAtomFoundation/pika/pull/2092) @[dingxiaoshuai123](https://github.com/dingxiaoshuai123)\n\n- 修复 setrange 和 setbit 命令没有保留原 key 的过期时间的问题 [#2095](https://github.com/OpenAtomFoundation/pika/pull/2095) @[u6th9d](https://github.com/u6th9d)\n\n\n# v3.5.1\n\n## 新特性\n\n- slow log 增加队列等待时间统计 [#1997](https://github.com/OpenAtomFoundation/pika/pull/1997) @[wangshao1](https://github.com/wangshao1)\n\n- 主从复制使用 ReplicationID [#1951](https://github.com/OpenAtomFoundation/pika/pull/1951) @[Mixficsol](https://github.com/Mixficsol)\n\n- WAL 以 disablewal 命令方式支持动态关闭 [#2015](https://github.com/OpenAtomFoundation/pika/pull/2015) @[Mixficsol](https://github.com/Mixficsol)\n\n- flush 线程数和 compaction 线程数动态调整，合二为一 [#2014](flush线程数和compaction线程数动态调整，合二为一) @[Tianpingan](https://github.com/Tianpingan)\n\n- 升级了 RocksDB 版本到 v8.3.3 [#1999](https://github.com/OpenAtomFoundation/pika/issues/1999) @[dingxiaoshuai123](https://github.com/dingxiaoshuai123)\n\n- 增加了 Macos 环境下配置 Pika 的使用方法文档 [#2003](https://github.com/OpenAtomFoundation/pika/pull/2003) @[klboke](https://github.com/klboke)\n\n- 新增周期性打印工作队列的长度功能，在队列阻塞的时候可以快速定位问题 [#1978](https://github.com/OpenAtomFoundation/pika/pull/1978) @[Tianpingan](https://github.com/Tianpingan)\n\n- 新增利用一个 `pika_exporter` 检测整个集群的指标 [#1953](https://github.com/OpenAtomFoundation/pika/pull/1953) @[chenbt-hz](https://github.com/chenbt-hz)\n\n- 实现在 K8s 环境上 Pika 服务的自动注册，在启动时自动注册，从而实现集群的自组织 [#1931](https://github.com/OpenAtomFoundation/pika/pull/1931) @[machinly](https://github.com/machinly)\n\n## Bugfix\n\n- 减少了 exporter 非必要的日志打印，降低 CPU 利用率 [#1945](https://github.com/OpenAtomFoundation/pika/pull/1945) @[Mixficsol](https://github.com/Mixficsol)\n\n- 升级了 sentinel 机制，对于掉线的主节点，进行逻辑删除 [#1949](https://github.com/OpenAtomFoundation/pika/pull/1949) @[Mixficsol](https://github.com/Mixficsol)\n\n- 调整 rate_limit 参数，修复压测时出现 RPS 为 0 的情况 [#2009](https://github.com/OpenAtomFoundation/pika/pull/2009) @[chejinge](https://github.com/chejinge)\n\n- 修复了 INFODATA 命令中对于遍历数据文件时出现空路径的逻辑判断 [#1996](https://github.com/OpenAtomFoundation/pika/pull/1996) @[Mixficsol](https://github.com/Mixficsol)\n\n- 完善了文档的一些部分缺失的描述 [#1962](https://github.com/OpenAtomFoundation/pika/pull/1962) @[baerwang](https://github.com/baerwang)\n\n- 使用 make -j 提高构建速度 [#1933](https://github.com/OpenAtomFoundation/pika/pull/1933) @[xiezheng-XD](https://github.com/xiezheng-XD)\n\n- 解决了 Codis 在线上出现大毛刺的问题 [#2016](https://github.com/OpenAtomFoundation/pika/pull/2016) @[chejinge](https://github.com/chejinge)\n\n- 修复了 Macos 环境下编译使用 tools 导致编译不过的问题 [#2011](https://github.com/OpenAtomFoundation/pika/pull/2011) @[A2ureStone](https://github.com/A2ureStone)\n\n\n# v3.5.0\n\n## 重大特性\n\n### 1.去除 Rsync\n\n* 在 v3.5.0 版本我们去除了 Rsync，使用自研的全量同步方案替代 Rsync，这个版本的全量同步有断点续传，速率限制，文件检验等特点\n\n  [#1805](https://github.com/OpenAtomFoundation/pika/pull/1805)  [#1591](https://github.com/OpenAtomFoundation/pika/issues/1591) [#1816](https://github.com/OpenAtomFoundation/pika/pull/1816) [#1818](https://github.com/OpenAtomFoundation/pika/pull/1818) [#1820](https://github.com/OpenAtomFoundation/pika/pull/1820)\n\n  [@wangshao1](https://github.com/wangshao1) [@chejinge](https://github.com/chejinge) [@luky116](https://github.com/luky116)\n\n1. 去除 Rsync\n2. 实现断点续传，速率限制，文件检验\n3. Pika 主从同步时，进行 master run_id 的检验\n\n### 2.兼容更多 Redis 命令\n\n* 在 v3.5.0 版本我们兼容并支持了更多的 Redis 命令\n\n  [#1273](https://github.com/OpenAtomFoundation/pika/pull/1273) [#1660](https://github.com/OpenAtomFoundation/pika/pull/1660) [#1245](https://github.com/OpenAtomFoundation/pika/pull/1245) [#1548](https://github.com/OpenAtomFoundation/pika/pull/1548) [#1843](https://github.com/OpenAtomFoundation/pika/pull/1843)\n\n  [@wanghenshui](https://github.com/wanghenshui)  [@Mixficsol](https://github.com/Mixficsol) [@weedge](https://github.com/weedge) [@cheniujh](https://github.com/cheniujh)\n\n1. 支持 UNLINK 命令\n2. 支持 INFO COMMANDSTATS 命令\n3. 支持 HELLO、SETNAME 命令\n4. 支持 BLPOP、BRPOP 命令\n5. 新增 Pika 原创命令 DISKRECOVERY\n\n### 3.RocksDB 版本升级和分级压缩\n\n- 在 v3.5.0 版本我们对 RocksDB 进行了升级使其达到了 v8.1.1 版本，实现分级压缩\n\n  [#1396](https://github.com/OpenAtomFoundation/pika/pull/1396) [#1365](https://github.com/OpenAtomFoundation/pika/pull/1365)  [#1189](https://github.com/OpenAtomFoundation/pika/pull/1189)\n\n  [@lqxhub](https://github.com/lqxhub)  [@chejinge](https://github.com/chejinge)\n\n1. 升级 RocksDB 版本到 v8.1.1\n2. 实现 RocksDB 分级压缩\n3. 新增 RocksDB 缓存配置项 num-shard-bits 能够从配置文件中读取\n\n### 4.支持 Blobdb\n\n* 在 v3.5.0 版本我们支持 BlobDB KV 分离\n\n  [#1456](https://github.com/OpenAtomFoundation/pika/pull/1456)\n\n  [@lqxhub](https://github.com/lqxhub)\n\n1. 支持 BlobDB KV 分离\n\n### 5.基于 Codis 的集群模式\n\n* 在 v3.5.0 版本中我们引入了 Codis 集群模式并支持了 Codis 迁移 slot 的命令\n\n  [#1279](https://github.com/OpenAtomFoundation/pika/pull/1279) [#1311](https://github.com/OpenAtomFoundation/pika/pull/1311) [#1492](https://github.com/OpenAtomFoundation/pika/pull/1492) [#1662](https://github.com/OpenAtomFoundation/pika/pull/1662) [#1682](https://github.com/OpenAtomFoundation/pika/pull/1682) [#1632](https://github.com/OpenAtomFoundation/pika/pull/1632)  [#1700](https://github.com/OpenAtomFoundation/pika/pull/1700)\n\n  [@WyattJia](https://github.com/WyattJia) [@chejinge](https://github.com/chejinge) [@luky116](https://github.com/luky116) [@yaoyinnan](https://github.com/yaoyinnan)\n\n1. 引入 Codis 到 Pika\n2. 引入 Codis 的 CI\n3. 支持 Codis 迁移 slot 命令\n4. 新增是否在 reload 的 slotmigrate 状态\n\n### 6.可观测性\n\n- 在 v3.5.0 版本我们新加了 pika_exporter 工具来监测 Pika 的可观测性指标，并在后期添加了一些新的指标来完善 Pika 的可观测性\n\n  [#1388](https://github.com/OpenAtomFoundation/pika/pull/1388)  [#1733](https://github.com/OpenAtomFoundation/pika/pull/1733)  [#1751](https://github.com/OpenAtomFoundation/pika/pull/1751)  [#1736](https://github.com/OpenAtomFoundation/pika/pull/1736) [#1560](https://github.com/OpenAtomFoundation/pika/pull/1560)  [#1696](https://github.com/OpenAtomFoundation/pika/pull/1696)\n\n  [@chenbt-hz](https://github.com/chenbt-hz)  [@yaoyinnan](https://github.com/yaoyinnan) [@Mixficsol](https://github.com/Mixficsol)\n\n1. 新增 Pika 可观测系统 pika_exporter\n2. 新增网络 I/O 流量监控指标\n3. 新增命令统计耗时指标\n4. 新增 estimate_pending_compaction_bytes 度量来分析碎片率指标\n5. 新增 RocksDB 指标\n\n### 7.云原生部署\n\n- 在 v3.5.0 版本我们实现了一个 pika-operator mvp 版本，主要实现了 Pika 单实例服务在 K8s 上的快速部署\n\n  [#1243](https://github.com/OpenAtomFoundation/pika/pull/1243) [#1330](https://github.com/OpenAtomFoundation/pika/pull/1330) [#1347](https://github.com/OpenAtomFoundation/pika/pull/1347)\n\n  [@machinly](https://github.com/machinly)\n\n1. 实现 Pika 单例服务在 K8s 上快速部署\n2. 实现了在 MiniKube 环境中部署 Pika\n3. 给 pika-operator 添加 E2E 测试\n\n### 8.跨平台编译\n\n* 在 v3.5.0 版本，Pika 支持 MacOS 平台，CentOS 平台，Ubuntu 平台进行编译使用\n\n  [#1372](https://github.com/OpenAtomFoundation/pika/pull/1372)  [#1488](https://github.com/OpenAtomFoundation/pika/pull/1488)\n\n  [@loveyacper](https://github.com/loveyacper)  [@Mixficsol](https://github.com/Mixficsol)\n\n1. 支持 MacOS 平台\n\n### 9.多平台 CI、Go 集成测试、TCL 单元测试、PythonE2E 测试、CTest 单元测试\n\n* 在 v3.5.0 版本我们支持了 Ubuntu，CentOS，MacOS 下的 CI，在测试方面新加了 Go 的集成测试，TCL 单元测试，Python 的 E2E 测试\n\n  [#1534](https://github.com/OpenAtomFoundation/pika/pull/1534) [#1772](https://github.com/OpenAtomFoundation/pika/pull/1772)  [#1769](https://github.com/OpenAtomFoundation/pika/pull/1769)  [#1347](https://github.com/OpenAtomFoundation/pika/pull/1347)  [#1268](https://github.com/OpenAtomFoundation/pika/pull/1268)  [#1693](https://github.com/OpenAtomFoundation/pika/pull/1693) [#1362](https://github.com/OpenAtomFoundation/pika/pull/1362)  [#1538](https://github.com/OpenAtomFoundation/pika/pull/1538)  [#1246](https://github.com/OpenAtomFoundation/pika/pull/1246)   [#1357](https://github.com/OpenAtomFoundation/pika/pull/1357)  [#1534](https://github.com/OpenAtomFoundation/pika/pull/1534) [#1772](https://github.com/OpenAtomFoundation/pika/pull/1772)\n\n  [@machinly](https://github.com/machinly)  [@wanghenshui](https://github.com/wanghenshui) [@chenbt-hz](https://github.com/chenbt-hz)  [@Tangruilin](https://github.com/Tangruilin)  [@kernelai](https://github.com/kernelai) [@Mixficsol](https://github.com/Mixficsol)\n\n1. 新增 CentOS 环境下的 CI\n2. 新增 MacOS 环境下的 CI\n3. 新增 E2E 测试框架\n4. 新增在 Github CI Workflow 中添加 CMake 编译环境\n5. 新增在 TCL 脚本中 populate 方法模拟 Redis debug populate 方法，用以填充测试数据\n6. 新增单测启动脚本\n7. 新增在 blackwidow 中添加 cmake 文件，添加对 blackwidow 的单元测试\n8. 使用 CTest 进行单元测试\n9. 移植 Redis 测试脚本\n10. 在 CI 流程中添加新的任务，以验证 Pika 是否能在 CentOS 系统上成功编译\n\n# 新增功能\n\n- 新增对 compact 进行自动限速，降低 compact 对上层数据读写延迟造成影响 [#1374](https://github.com/OpenAtomFoundation/pika/pull/1374) [@wanghenshui](https://github.com/wanghenshui)\n- 新增 aof_to_pika 工具集 [#1340](https://github.com/OpenAtomFoundation/pika/pull/1340) [@Axlgrep](https://github.com/Axlgrep)\n- 新增 Pika 的打印 Logo [#1787](https://github.com/OpenAtomFoundation/pika/pull/1787) [@Mixficsol](https://github.com/Mixficsol)\n- 新增使用 clang-tidy 优化了部分代码 [#1701](https://github.com/OpenAtomFoundation/pika/pull/1701)  [#1730](https://github.com/OpenAtomFoundation/pika/pull/1730)  [@longfar-ncy](https://github.com/longfar-ncy)\n- 新增将 C++98 风格的代码统一更换成 C++11 风格，使用 C++ 编码规范编程 [#1684](https://github.com/OpenAtomFoundation/pika/pull/1684) [@chejinge](https://github.com/chejinge)\n- 新增 snappy 库 [#1216](https://github.com/OpenAtomFoundation/pika/pull/1216) [@kernelai](https://github.com/kernelai)\n- 新增 CLA 文件 [#1260](https://github.com/OpenAtomFoundation/pika/pull/1260) [@kernelai](https://github.com/kernelai)\n- 新增内存相关的配置支持 K|M|G 单位 [#1307](https://github.com/OpenAtomFoundation/pika/pull/1307) [@lqxhub](https://github.com/lqxhub)\n- 新增添加 libunwind 依赖库 [#1316](https://github.com/OpenAtomFoundation/pika/pull/1316) [@kernelai](https://github.com/kernelai)\n- 新增编译 Pika 脚本 [#1356](https://github.com/OpenAtomFoundation/pika/pull/1356) [@lqxhub](https://github.com/lqxhub)\n- 新增 pika.conf 中添加 \"rate-limiter-bandwidth\" 选项 [#1272](https://github.com/OpenAtomFoundation/pika/pull/1272) [@wanghenshui](https://github.com/wanghenshui)\n- 新增 INFO 命令添加 redis_version 信息 [#1403](https://github.com/OpenAtomFoundation/pika/pull/1403) [@wanghenshui](https://github.com/wanghenshui)\n- 新增对 aof_to_pika 的 CMake 支持 [#1436](https://github.com/OpenAtomFoundation/pika/pull/1436) [@A2ureStone](https://github.com/A2ureStone)\n- 新增 clang 格式的 shell 脚本 [#1448](https://github.com/OpenAtomFoundation/pika/pull/1448) [@lqxhub](https://github.com/lqxhub)\n- 新增配置项禁用编译 command docs [#1642](https://github.com/OpenAtomFoundation/pika/pull/1642) [@tedli](https://github.com/tedli)\n- 新增 benchmark_client， binlog_sender，manifest_generator，rdb_to_pika，txt_to_pika，pika_to_txt，pika_port 的 CMake 支持 [#1451](https://github.com/OpenAtomFoundation/pika/pull/1451) [@A2ureStone](https://github.com/A2ureStone)\n\n# 改进\n\n- Pika 模式统一去除 sharding 模式 [#1481](https://github.com/OpenAtomFoundation/pika/pull/1481) [@chejinge](https://github.com/chejinge)\n- 在 config 中添加槽位号 [#1664](https://github.com/OpenAtomFoundation/pika/pull/1664) [@luky116](https://github.com/luky116)\n- 统一 partition 命名为 slot [#1571](https://github.com/OpenAtomFoundation/pika/pull/1571)  [#1655](https://github.com/OpenAtomFoundation/pika/pull/1655) [@chejinge](https://github.com/chejinge)\n- 用 Monitor 命令替换 Monitor 线程 [#1551](https://github.com/OpenAtomFoundation/pika/pull/1551) [@loveyacper](https://github.com/loveyacper)\n- 增加了启动服务器时对空密码和错误密码的 requipass 判断 [#1645](https://github.com/OpenAtomFoundation/pika/pull/1645) [@hqh-cell](https://github.com/hqh-cell)\n- 重构 pstd_mutex [#1440](https://github.com/OpenAtomFoundation/pika/pull/1440) [@4kangjc](https://github.com/4kangjc)\n- 修改命令信息键空间响应数据 [#1450](https://github.com/OpenAtomFoundation/pika/pull/1450) [@lqxhub](https://github.com/lqxhub)\n- 合并 pstd 和 storage 的相同代码 [#1419](https://github.com/OpenAtomFoundation/pika/pull/1419) [@4kangjc](https://github.com/4kangjc)\n- 按计数添加 spop [#1434](https://github.com/OpenAtomFoundation/pika/pull/1434) [@ChanphongGu](https://github.com/ChanphongGu)\n- 添加 Pika docker 镜像说明 [#1557](https://github.com/OpenAtomFoundation/pika/pull/1557) [@machinly](https://github.com/machinly)\n- 用 RocksDB GetFileSystem 接口替换旧有的 GetEnv 接口 [#1213](https://github.com/OpenAtomFoundation/pika/pull/1213) [@kernelai](https://github.com/kernelai)\n- 新增散落在外的 Pika 文档 [#1193](https://github.com/OpenAtomFoundation/pika/pull/1193) [@fengpeiyuan](https://github.com/fengpeiyuan)\n- CMake 升级到 3.18 [#1366](https://github.com/OpenAtomFoundation/pika/pull/1366) [@AlexStocks](https://github.com/AlexStocks)\n- 给 Pika 添加 format 工具 [#1512](https://github.com/OpenAtomFoundation/pika/pull/1512) [@liuqian1990](https://github.com/liuqian1990)\n- 为 Pika 添加 clang-tidy [#1515](https://github.com/OpenAtomFoundation/pika/pull/1515)  [#1730](https://github.com/OpenAtomFoundation/pika/pull/1730) [@ForestLH](https://github.com/ForestLH) [@longfar-ncy](https://github.com/longfar-ncy)\n- 在 MiniKube 中把 Pika 和 pika-operator 运行起来 [#1330](https://github.com/OpenAtomFoundation/pika/pull/1330) [@machinly](https://github.com/machinly)\n- 给 clang-format 添加谷歌编码风格 [#1479](https://github.com/OpenAtomFoundation/pika/pull/1479) [@Mixficsol](https://github.com/Mixficsol)\n- 使用 std::filesystem 重构 pstd / env [#1470](https://github.com/OpenAtomFoundation/pika/pull/1470) [@4kangjc](https://github.com/4kangjc)\n- pstd::GetFixed 添加 Slice [#1425](https://github.com/OpenAtomFoundation/pika/pull/1425) [@4kangjc](https://github.com/4kangjc)\n- 在头文件中使用内联变量 [#1407](https://github.com/OpenAtomFoundation/pika/pull/1407) [@4kangjc](https://github.com/4kangjc)\n- 使用 clang-format 对代码进行格式化 [#1378](https://github.com/OpenAtomFoundation/pika/pull/1378) [@AlexStocks](https://github.com/AlexStocks)\n- 移动 pika-operator 到 pika-tools 目录 [#1468](https://github.com/OpenAtomFoundation/pika/pull/1468) [@luky116](https://github.com/luky116)\n- 给 Pika 添加 Codis -> Pika 迁移工具 [#1514](https://github.com/OpenAtomFoundation/pika/pull/1514) [@chenbt-hz](https://github.com/chenbt-hz)\n\n# Bug 修复\n\n- 修复不同 CPU 指令集不兼容导致 coredump [#1812](https://github.com/OpenAtomFoundation/pika/pull/1812) [@chejinge](https://github.com/chejinge)\n- 修复 Monitor 命令异常退出问题 [#1804](https://github.com/OpenAtomFoundation/pika/pull/1804) [@Mixficsol](https://github.com/Mixficsol)\n- 修复不完整的配置覆盖 [#1800](https://github.com/OpenAtomFoundation/pika/pull/1800) [@yaoyinnan](https://github.com/yaoyinnan)\n- 修复 MacOS 环境下的 CTest 测试 [#1789](https://github.com/OpenAtomFoundation/pika/pull/1789)  [#1721](https://github.com/OpenAtomFoundation/pika/pull/1721) [#1782](https://github.com/OpenAtomFoundation/pika/pull/1782)  [@tedli](https://github.com/tedli) [@Mixficsol](https://github.com/Mixficsol)\n- 修复进程启动时从配置文件加载 master-run-id 失败，导致从节点需要重新同步历史数据 [#1778](https://github.com/OpenAtomFoundation/pika/pull/1778) [@luky116](https://github.com/luky116)\n- 修复 Pika 单测时 overrides 选项格式出错 [#1768](https://github.com/OpenAtomFoundation/pika/pull/1768) [@A2ureStone](https://github.com/A2ureStone)\n- 修复通过配置指定获取 INFO xxx (INFO data, INFO stats) 的索引，而不是使用INFO ALL [#1762](https://github.com/OpenAtomFoundation/pika/pull/1762) [@yaoyinnan](https://github.com/yaoyinnan)\n- 修复 instantaneous_metric 并每5秒收集一次网络指标 [#1757](https://github.com/OpenAtomFoundation/pika/pull/1757) [@yaoyinnan](https://github.com/yaoyinnan)\n- 修复完善 config get 返回的参数 [#1593](https://github.com/OpenAtomFoundation/pika/issues/1593) [@luky116](https://github.com/luky116)\n- 修复 slot 可能为空的问题 [#1712](https://github.com/OpenAtomFoundation/pika/pull/1712) [@Mixficsol](https://github.com/Mixficsol)\n- 修复中 makefile 中对版本选择执行的一些 bug [#1714](https://github.com/OpenAtomFoundation/pika/pull/1714) [@luky116](https://github.com/luky116)\n- 修复 HSET 第一次不能成功执行的问题 [#1710](https://github.com/OpenAtomFoundation/pika/pull/1710) [@Mixficsol](https://github.com/Mixficsol)\n- 修复 slave 节点的 binlog offset 比 master 节点大，导致 TrySync 失败 [#1681](https://github.com/OpenAtomFoundation/pika/issues/1681) [@luky116](https://github.com/luky116)\n- 修复了一个 NOAUTH 错误的测试，该错误是任意命令，当需要 AUTH 时给出错误 [#1680](https://github.com/OpenAtomFoundation/pika/pull/1680) [@hqh-cell](https://github.com/hqh-cell)\n- 修复了 binlog 文件超出上限不会自动清理问题 [#1679](https://github.com/OpenAtomFoundation/pika/pull/1679) [@luky116](https://github.com/luky116)\n- 修复 LPUSHX 和 RPUSHX 多元素插入的问题 [#1525](https://github.com/OpenAtomFoundation/pika/pull/1525) [@ForestLH](https://github.com/ForestLH)\n- 修复 BGSAVE 命令执行报错问题 [#1523](https://github.com/OpenAtomFoundation/pika/pull/1523) [@Brokenice0415](https://github.com/Brokenice0415)\n- 修复关闭 RocksDB 使用 io_uring， 防止在链接时报错 [#1489](https://github.com/OpenAtomFoundation/pika/pull/1489) [@lqxhub](https://github.com/lqxhub)\n- 修复 MacOS 环境下 Pika 编译警告问题 [#1740](https://github.com/OpenAtomFoundation/pika/pull/1740) [@Mixficsol](https://github.com/Mixficsol)\n- 修复不支持的命令报错消息，适配 go-redis [#1244](https://github.com/OpenAtomFoundation/pika/pull/1244) [@wgqi1126](https://github.com/wgqi1126)\n- 修复一个 protobuf3 的编译告警 [#1267](https://github.com/OpenAtomFoundation/pika/pull/1267) [@wanghenshui](https://github.com/wanghenshui)\n- 修复 sharding 模式下 EXISTS 和 DEL 两个命令的 bug [#1277](https://github.com/OpenAtomFoundation/pika/pull/1277) [@wanghenshui](https://github.com/wanghenshui)\n- 修复 rsync auth bug [#1278](https://github.com/OpenAtomFoundation/pika/pull/1278) [@wanghenshui](https://github.com/wanghenshui)\n- 修复按照 Redis 标准修复 rewrite 返回结果形式 [#1339](https://github.com/OpenAtomFoundation/pika/pull/1339) [@lqxhub](https://github.com/lqxhub)\n- 修复修改 SET NX/XX 返回值，与 Redis 保持一致 [#1343](https://github.com/OpenAtomFoundation/pika/pull/1343) [@gtygo](https://github.com/gtygo)\n- 修复 exporter 中缺失 pika_master_link_status 和 pika_slave_priority indicators 两张图 [#1726](https://github.com/OpenAtomFoundation/pika/pull/1726) [@Mixficsol](https://github.com/Mixficsol)\n- 修复防止当 Pika 使用的文件描述符超过 ulimit 限制时程序 coredump [#1346](https://github.com/OpenAtomFoundation/pika/pull/1346) [@kernelai](https://github.com/kernelai)\n- 修复在类中初始化群成员的值以防止 redis-cli 与 Pika 的链接被意外关闭 [#1390](https://github.com/OpenAtomFoundation/pika/pull/1390) [@AlexStocks](https://github.com/AlexStocks)\n- 修复 delete_dir snprintf bug [#1400](https://github.com/OpenAtomFoundation/pika/pull/1400) [@wanghenshui](https://github.com/wanghenshui)\n- 修复限制 thread num [#1401](https://github.com/OpenAtomFoundation/pika/pull/1401) [@wanghenshui](https://github.com/wanghenshui)\n- 修复 redis-benchmark 从 Pika 获取 config [#1402](https://github.com/OpenAtomFoundation/pika/pull/1402) [@wanghenshui](https://github.com/wanghenshui)\n- 修复初始化类成员 [#1406](https://github.com/OpenAtomFoundation/pika/pull/1406) [@AlexStocks](https://github.com/AlexStocks)\n- 修复 MacOS 环境下主从同步测试的问题 [#1776](https://github.com/OpenAtomFoundation/pika/pull/1776) [@Mixficsol](https://github.com/Mixficsol)\n- 修复 NULL 为 nullptr [#1408](https://github.com/OpenAtomFoundation/pika/pull/1408) [@AlexStocks](https://github.com/AlexStocks)\n- 修复 ttl 的 size 边界设置过期时间戳 [#1413](https://github.com/OpenAtomFoundation/pika/pull/1413) [@ForestLH](https://github.com/ForestLH)\n- 修复访问空指针 [#1414](https://github.com/OpenAtomFoundation/pika/pull/1414) [#1426](https://github.com/OpenAtomFoundation/pika/pull/1426) [@fly1ngpengu1ns](https://github.com/fly1ngpengu1ns) [@Pikachu1412](https://github.com/Pikachu1412)\n- 修复 Monitor 命令 [#1424](https://github.com/OpenAtomFoundation/pika/pull/1424) [@loveyacper](https://github.com/loveyacper)\n- 修复 partitionInfo::operator 回布尔值 [#1427](https://github.com/OpenAtomFoundation/pika/pull/1427) [@4kangjc](https://github.com/4kangjc)\n- 修复访问 src/net 中的空指针问题 [#1453](https://github.com/OpenAtomFoundation/pika/pull/1453) [@gitveg](https://github.com/gitveg)\n- 修复 aof_reader c++17 构建失败 [#1454](https://github.com/OpenAtomFoundation/pika/pull/1454) [@lqxhub](https://github.com/lqxhub)\n- 修复编译警告 [#1455](https://github.com/OpenAtomFoundation/pika/pull/1455) [@wangchuande](https://github.com/wangchuande)\n- 修复 operator 构建偶尔失败的问题 [#1464](https://github.com/OpenAtomFoundation/pika/pull/1464) [@machinly](https://github.com/machinly)\n- 修复 CondVar 无法退出的问题 [#1475](https://github.com/OpenAtomFoundation/pika/pull/1475) [@lqxhub](https://github.com/lqxhub)\n- 修复 libfmt 调试构建名称错误 [#1476](https://github.com/OpenAtomFoundation/pika/pull/1476) [@lqxhub](https://github.com/lqxhub)\n- 修复 Monitor 命令异常退出问题 [#1804](https://github.com/OpenAtomFoundation/pika/pull/1804) [@Mixficsol](https://github.com/Mixficsol)\n- 修复 slave 节点 binlog offset 异常问题 [#1681](https://github.com/OpenAtomFoundation/pika/issues/1681) [@luky116](https://github.com/luky116)\n- 修复单元测试 no auth 报错问题 [#1680](https://github.com/OpenAtomFoundation/pika/pull/1680) [@hqh-cell](https://github.com/hqh-cell)\n- 修复 binlog 文件超过上限不会被删除的问题 [#1679](https://github.com/OpenAtomFoundation/pika/pull/1679) [@luky116](https://github.com/luky116)\n- 修复 string 相关单元测试 [#1675](https://github.com/OpenAtomFoundation/pika/pull/1675) [@Mixficsol](https://github.com/Mixficsol)\n- 修复 Codis 异常退出时 tmp 文件没有删除的问题 [#1661](https://github.com/OpenAtomFoundation/pika/issues/1661) [@yaoyinnan](https://github.com/yaoyinnan)\n- 修复主从复制数据不一致的问题 [#1638](https://github.com/OpenAtomFoundation/pika/issues/1638) [@cheniujh](https://github.com/cheniujh)\n- 修复 INFO 命令 Metrics 指标获取失败的问题 [#1646](https://github.com/OpenAtomFoundation/pika/issues/1646) [@chejinge](https://github.com/chejinge)\n- 修复单侧 basic 类型错误的问题 [#1625](https://github.com/OpenAtomFoundation/pika/pull/1625) [@chenbt-hz](https://github.com/chenbt-hz)\n- 修复 LPOP, RPOP 接口提示参数不对的问题 [#1520](https://github.com/OpenAtomFoundation/pika/issues/1520) [@luky116](https://github.com/luky116)\n- 修复实例硬盘容量满清理数据后，Pika 仍然保持错误的状态，需要重启才能恢复的问题 [#1765](https://github.com/OpenAtomFoundation/pika/pull/1765) [#1822](https://github.com/OpenAtomFoundation/pika/pull/1822) [#1843](https://github.com/OpenAtomFoundation/pika/pull/1843) [@Yangsx-1](https://github.com/Yangsx-1) [@Mixficsol](https://github.com/Mixficsol)\n\n# 注意事项\n\n* 删除 3.4 引入的 Proxy [#1274](https://github.com/OpenAtomFoundation/pika/pull/1274) [@wanghenshui](https://github.com/wanghenshui)\n* 删除 submodule [#1312](https://github.com/OpenAtomFoundation/pika/pull/1312) [@wanghenshui](https://github.com/wanghenshui)\n* 删除 sharding 命令 [#1469](https://github.com/OpenAtomFoundation/pika/pull/1469) [@chejinge](https://github.com/chejinge)\n* 删除 tcmalloc [#1472](https://github.com/OpenAtomFoundation/pika/pull/1472) [@Mixficsol](https://github.com/Mixficsol)\n* 对 leader 添加 protect 模式 [#1276](https://github.com/OpenAtomFoundation/pika/pull/1276) [@wanghenshui](https://github.com/wanghenshui)\n* 把 Codis 最新代码同步到 Pika 仓库中 [#1279](https://github.com/OpenAtomFoundation/pika/pull/1279) [@WyattJia](https://github.com/WyattJia)\n* 在 CMake 文件中添加外部依赖库 [#1281](https://github.com/OpenAtomFoundation/pika/pull/1281) [@kernelai](https://github.com/kernelai)\n* 在 CMake 文件中添加外部依赖库列表 [#1285](https://github.com/OpenAtomFoundation/pika/pull/1285) [@kernelai](https://github.com/kernelai)\n* 将 Pika 制作了一个静态链接库，可以直接和依赖库链接构成 Pika 的二进制包 [#1310](https://github.com/OpenAtomFoundation/pika/pull/1310) [@Tangruilin](https://github.com/Tangruilin)\n* protbuf 生成不依赖本机环境，加多核编译，修复 debian 下连接缺少 pthread 的报错 [#1314](https://github.com/OpenAtomFoundation/pika/pull/1314) [@lqxhub](https://github.com/lqxhub)\n* 把 slash 重命名为 pstd [#1348](https://github.com/OpenAtomFoundation/pika/pull/1348) [@AlexStocks](https://github.com/AlexStocks)\n* 把目录 src/pink 重命名为 src/net [#1350](https://github.com/OpenAtomFoundation/pika/pull/1350) [@AlexStocks](https://github.com/AlexStocks)\n* 把单词 bw 和 blackwidow 重命名为 storage [#1352](https://github.com/OpenAtomFoundation/pika/pull/1352)  [#1353](https://github.com/OpenAtomFoundation/pika/pull/1353) [@AlexStocks](https://github.com/AlexStocks)\n* 更新编译器要求文档 [#1420](https://github.com/OpenAtomFoundation/pika/pull/1420) [@4kangjc](https://github.com/4kangjc)\n* 替换无效链接 [#1430](https://github.com/OpenAtomFoundation/pika/pull/1430) [#1441](https://github.com/OpenAtomFoundation/pika/pull/1441) [#1471](https://github.com/OpenAtomFoundation/pika/pull/1471) [@gitveg](https://github.com/gitveg) [@1321034767](https://github.com/1321034767) [@chiehwarm](https://github.com/chiehwarm)\n* 将 /tools/codis2pika/test 中的 Redis 从 4.3.3 升级到 4.4.4 [#1536](https://github.com/OpenAtomFoundation/pika/pull/1536) [@dependabot]()\n* 将 golang.org/x/sys 从 /tools/codis2pika 中的 0.0.0-20210927094055-39ccf1dd6fa6 提升到 0.1.0 [#1535](https://github.com/OpenAtomFoundation/pika/pull/1535) [@dependabot]()\n* 用智能指针替换 new/delete [#1503](https://github.com/OpenAtomFoundation/pika/pull/1503)  [#1502](https://github.com/OpenAtomFoundation/pika/pull/1502) [#1493](https://github.com/OpenAtomFoundation/pika/pull/1493) [@cheniujh](https://github.com/cheniujh) [@A2ureStone](https://github.com/A2ureStone) [@iiiuwioajdks](https://github.com/iiiuwioajdks)\n* 用 glog 替换 fprintf [#1421](https://github.com/OpenAtomFoundation/pika/pull/1421) [@Mixficsol](https://github.com/Mixficsol)\n"
        },
        {
          "name": "CMakeLists.txt",
          "type": "blob",
          "size": 20.7060546875,
          "content": "cmake_minimum_required(VERSION 3.18)\n\n# Avoid warning about DOWNLOAD_EXTRACT_TIMESTAMP in CMake 3.24:\nif(CMAKE_VERSION VERSION_GREATER_EQUAL \"3.24.0\")\n  cmake_policy(SET CMP0135 NEW)\nendif()\n\nset(CMAKE_CXX_STANDARD 17)\nproject(pika)\nset(CMAKE_EXPORT_COMPILE_COMMANDS ON)\nenable_testing()\n\nif (CMAKE_CXX_COMPILER_ID STREQUAL \"Clang\")\n  # using Clang\n  if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS \"5.0\")\n    message(FATAL_ERROR \"Clang version must be greater than 5.0\")\n  endif()\nelseif (CMAKE_CXX_COMPILER_ID STREQUAL \"GNU\")\n  # using GCC\n  if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS \"7.0\")\n    message(FATAL_ERROR \"GCC G++ version must be greater than 7.0\")\n  endif()\nendif()\n\nlink_directories(\"/opt/rh/gcc-toolset-13/root/lib/gcc/x86_64-redhat-linux/13\")\n\n############# You should enable sanitizer if you are developing pika #############\n# Uncomment the following two lines to enable AddressSanitizer to detect memory leaks and other memory-related bugs.\n#set(CMAKE_BUILD_TYPE \"Debug\")\n#set(CMAKE_CXX_FLAGS_DEBUG \"${CMAKE_CXX_FLAGS_DEBUG} -fsanitize=address  -O0 -fno-omit-frame-pointer -fno-optimize-sibling-calls\")\n\n# [Notice] AddressSanitizer and ThreadSanitizer can not be enabled at the same time.\n\n# Uncomment the following two lines to enable ThreadSanitizer to detect data race and other thread-related issue.\n#set(CMAKE_BUILD_TYPE \"Debug\")\n#set(CMAKE_CXX_FLAGS_DEBUG \"${CMAKE_CXX_FLAGS_DEBUG} -fsanitize=thread -O0 -fno-omit-frame-pointer -fno-optimize-sibling-calls\")\n\nstring(TOLOWER ${CMAKE_HOST_SYSTEM_PROCESSOR} HOST_ARCH)\n\nif(NOT CMAKE_BUILD_TYPE)\n  set(CMAKE_BUILD_TYPE RELEASE)\nendif()\n\nstring(TOUPPER ${CMAKE_BUILD_TYPE} BUILD_TYPE)\n\nif(${BUILD_TYPE} STREQUAL DEBUG)\n  set(LIB_BUILD_TYPE DEBUG)\nelseif(${BUILD_TYPE} STREQUAL MINSIZEREL)\n  set(LIB_BUILD_TYPE MINSIZEREL)\nelseif(${BUILD_TYPE} STREQUAL RELWITHDEBINFO)\n  set(LIB_BUILD_TYPE RELWITHDEBINFO)\nelse()\n  set(LIB_BUILD_TYPE RELEASE)\n  set(CMAKE_CXX_FLAGS_RELEASE \"-O2 -g -DNDEBUG\")\nendif()\n\nif(CMAKE_SYSTEM_NAME MATCHES \"Darwin\")\n   set(CMAKE_CXX_FLAGS \"-pthread\")\n   add_definitions(-DOS_MACOSX)\nelseif (CMAKE_SYSTEM_NAME MATCHES \"FreeBSD\")\n    set(CMAKE_CXX_FLAGS \"-pthread\")\n    add_definitions(-DOS_FREEBSD)\nelseif(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n   if(CMAKE_CXX_COMPILER_ID STREQUAL \"Clang\")\n     set(CMAKE_EXE_LINKER_FLAGS \"-stdlib=libc++ -fuse-ld=lld -lc++ -lc++abi ${CMAKE_EXE_LINKER_FLAGS}\")\n     set(CMAKE_CXX_FLAGS \"-stdlib=libc++ -pthread ${CMAKE_CXX_FLAGS}\")\n   elseif(CMAKE_CXX_COMPILER_ID STREQUAL \"GNU\")\n     set(CMAKE_EXE_LINKER_FLAGS \"-static-libgcc -static-libstdc++\")\n     set(CMAKE_CXX_FLAGS \"-pthread -Wl,--no-as-needed -ldl\")\n   endif()\n   add_definitions(-DOS_LINUX)\nelse()\n   message(FATAL_ERROR \"only support linux or macOs or FreeBSD\")\nendif()\n\nif(HOST_ARCH MATCHES \"x86_64\" OR HOST_ARCH MATCHES \"i386\")\n  set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -msse -msse4.2\")\nelseif(HOST_ARCH MATCHES \"arm\")\n  set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -march=armv8-a+crc+crypto -moutline-atomics\")\nendif()\n\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fno-omit-frame-pointer\")\n\nset(EP_BASE_SUFFIX \"buildtrees\")\nset_property(DIRECTORY PROPERTY EP_BASE ${CMAKE_CURRENT_SOURCE_DIR}/${EP_BASE_SUFFIX})\nlist(APPEND CMAKE_MODULE_PATH \"${CMAKE_CURRENT_LIST_DIR}/cmake/modules/\")\nset(STAGED_INSTALL_PREFIX ${CMAKE_CURRENT_SOURCE_DIR}/deps)\nset(CMAKE_UTILS_DIR ${CMAKE_CURRENT_SOURCE_DIR}/utils)\nset(INSTALL_INCLUDEDIR ${STAGED_INSTALL_PREFIX}/include)\nset(INSTALL_LIBDIR ${STAGED_INSTALL_PREFIX}/lib)\nset(INSTALL_LIBDIR_64 ${STAGED_INSTALL_PREFIX}/lib64)\nset(CMAKE_PREFIX_PATH ${CMAKE_PREFIX_PATH} ${STAGED_INSTALL_PREFIX})\n\nexecute_process(COMMAND sh ${CMAKE_UTILS_DIR}/Get_OS_Version.sh\n  OUTPUT_VARIABLE OS_VERSION)\n\nmessage(STATUS \"${PROJECT_NAME} staged install: ${STAGED_INSTALL_PREFIX}\")\nmessage(STATUS \"Current platform: ${OS_VERSION} \")\ncmake_host_system_information(RESULT CPU_CORE QUERY NUMBER_OF_LOGICAL_CORES)\nmessage(STATUS \"Cpu core ${CPU_CORE}\")\n\nfind_program(AUTOCONF\n        autoconf\n        PATHS /usr/bin /usr/local/bin)\n\nif (${AUTOCONF} MATCHES AUTOCONF-NOTFOUND)\n  message(FATAL_ERROR \"not find autoconf on localhost\")\nendif()\n\n#set(CLANG_SEARCH_PATH \"/usr/local/bin\" \"/usr/bin\" \"/usr/local/opt/llvm/bin\"\n#                      \"/usr/local/opt/llvm@12/bin\")\nfind_program(CLANG_TIDY_BIN\n        NAMES clang-tidy clang-tidy-12\n        HINTS ${CLANG_SEARCH_PATH})\nif (\"${CLANG_TIDY_BIN}\" STREQUAL \"CLANG_TIDY_BIN-NOTFOUND\")\n  message(WARNING \"couldn't find clang-tidy.\")\nelse ()\n  message(STATUS \"found clang-tidy at ${CLANG_TIDY_BIN}\")\nendif ()\n\nfind_program(CLANG_APPLY_REPLACEMENTS_BIN\n        NAMES clang-apply-replacements clang-apply-replacements-12\n        HINTS ${CLANG_SEARCH_PATH})\n\nif (\"${CLANG_APPLY_REPLACEMENTS_BIN}\" STREQUAL \"CLANG_APPLY_REPLACEMENTS_BIN-NOTFOUND\")\n    message(WARNING \"couldn't find clang-apply-replacements.\")\nelse ()\n    message(STATUS \"found clang-apply-replacements at ${CLANG_APPLY_REPLACEMENTS_BIN}\")\nendif ()\n\noption(WITH_COMMAND_DOCS \"build with command docs support\" OFF)\nif (WITH_COMMAND_DOCS)\n  add_definitions(-DWITH_COMMAND_DOCS)\nendif()\n\ninclude(protogen.cmake)\ninclude(ExternalProject)\n\nExternalProject_Add(gtest\n  URL\n  https://github.com/google/googletest/archive/refs/tags/release-1.12.1.tar.gz\n  URL_HASH\n  MD5=e82199374acdfda3f425331028eb4e2a\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  BUILD_ALWAYS\n  1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nif(${OS_VERSION} MATCHES \"Rocky\" OR ${OS_VERSION} MATCHES \"CentOS\")\n  set(GTEST_LIBRARY ${INSTALL_LIBDIR_64}/libgtest.a)\n  set(GTEST_MAIN_LIBRARY ${INSTALL_LIBDIR_64}/libgtest_main.a)\n  set(GMOCK_LIBRARY ${INSTALL_LIBDIR_64}/libgmock.a)\nelse()\n  set(GTEST_LIBRARY ${INSTALL_LIBDIR}/libgtest.a)\n  set(GTEST_MAIN_LIBRARY ${INSTALL_LIBDIR}/libgtest_main.a)\n  set(GMOCK_LIBRARY ${INSTALL_LIBDIR}/libgmock.a)\nendif()\n\nset(GTEST_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\nset(GTEST_MAIN_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\nset(GMOCK_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n\nExternalProject_Add(gflags\n  URL\n  https://github.com/gflags/gflags/archive/refs/tags/v2.2.2.tar.gz\n  URL_HASH\n  MD5=1a865b93bacfa963201af3f75b7bd64c\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  BUILD_ALWAYS\n  1\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  -DGFLAGS_NAMESPACE=gflags\n  -DBUILD_STATIC_LIBS=ON\n  -DBUILD_SHARED_LIBS=OFF\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nif(${LIB_BUILD_TYPE} STREQUAL DEBUG)\n  set(LIB_GFLAGS libgflags_debug.a)\nelse()\n  set(LIB_GFLAGS libgflags.a)\nendif()\n\nset(GFLAGS_LIBRARY ${INSTALL_LIBDIR}/${LIB_GFLAGS})\nset(GFLAGS_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n\nif(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n  ExternalProject_Add(unwind\n    DEPENDS\n    URL\n    https://github.com/libunwind/libunwind/releases/download/v1.6.2/libunwind-1.6.2.tar.gz\n    URL_HASH\n    MD5=f625b6a98ac1976116c71708a73dc44a\n    DOWNLOAD_NO_PROGRESS\n    1\n    UPDATE_COMMAND\n    \"\"\n    LOG_CONFIGURE\n    1\n    LOG_BUILD\n    1\n    LOG_INSTALL\n    1\n    CONFIGURE_COMMAND\n    <SOURCE_DIR>/configure --prefix=${STAGED_INSTALL_PREFIX} --enable-minidebuginfo=no --enable-zlibdebuginfo=no --enable-shared=no --with-pic\n    BUILD_IN_SOURCE\n    1\n    BUILD_COMMAND\n    make -j${CPU_CORE}\n    INSTALL_COMMAND\n    make install\n  )\n  set(LIBUNWIND_LIBRARY ${INSTALL_LIBDIR}/libunwind.a)\n  set(LIBUNWIND_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n  set(LIBUNWIND_NAME unwind)\n  set(LIBUNWIND_ON ON)\nelse()\n  set(LIBUNWIND_ON OFF)\nendif()\n\nExternalProject_Add(glog\n  DEPENDS\n  gflags\n  gtest\n  ${LIBUNWIND_NAME}\n  URL\n  https://github.com/google/glog/archive/refs/tags/v0.6.0.tar.gz\n  URL_HASH\n  MD5=c98a6068bc9b8ad9cebaca625ca73aa2\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  BUILD_ALWAYS\n  1\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  -DWITH_GFLAGS=ON\n  -DBUILD_TESTING=OFF\n  -DBUILD_SHARED_LIBS=OFF\n  -DWITH_UNWIND=${LIBUNWIND_ON}\n  -DCMAKE_PREFIX_PATH=${CMAKE_PREFIX_PATH}\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nif(${LIB_BUILD_TYPE} STREQUAL DEBUG)\n  set(LIB_GLOG libglogd.a)\nelse()\n  set(LIB_GLOG libglog.a)\nendif()\n\nif(${OS_VERSION} MATCHES \"Rocky\" OR ${OS_VERSION} MATCHES \"CentOS\")\n  set(GLOG_LIBRARY ${INSTALL_LIBDIR_64}/${LIB_GLOG})\nelse()\n  set(GLOG_LIBRARY ${INSTALL_LIBDIR}/${LIB_GLOG})\nendif()\nset(GLOG_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n\nExternalProject_Add(snappy\n  DEPENDS\n  URL\n  https://github.com/google/snappy/archive/refs/tags/1.1.7.tar.gz\n  URL_HASH\n  MD5=ee9086291c9ae8deb4dac5e0b85bf54a\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  -DSNAPPY_BUILD_TESTS=OFF\n  -DBUILD_STATIC_LIBS=ON\n  -DBUILD_SHARED_LIBS=OFF\n  BUILD_ALWAYS\n  1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nif(${OS_VERSION} MATCHES \"Rocky\" OR ${OS_VERSION} MATCHES \"CentOS\")\n  set(SNAPPY_LIBRARY ${INSTALL_LIBDIR_64}/libsnappy.a)\nelse()\n  set(SNAPPY_LIBRARY ${INSTALL_LIBDIR}/libsnappy.a)\nendif()\n\nset(SNAPPY_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n\nExternalProject_Add(zstd\n  DEPENDS\n  URL\n  https://github.com/facebook/zstd/releases/download/v1.5.4/zstd-1.5.4.tar.gz\n  URL_HASH\n  MD5=2352b1f9ccc7446641046bb3d440c3ed\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  SOURCE_SUBDIR\n  build/cmake\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  -DBUILD_TESTING=OFF\n  -DZSTD_BUILD_STATIC=ON\n  -DZSTD_BUILD_SHARED=OFF\n  BUILD_ALWAYS\n  1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nif(${OS_VERSION} MATCHES \"Rocky\" OR ${OS_VERSION} MATCHES \"CentOS\")\n  set(ZSTD_LIBRARY ${INSTALL_LIBDIR_64}/libzstd.a)\nelse()\n  set(ZSTD_LIBRARY ${INSTALL_LIBDIR}/libzstd.a)\nendif()\n\nset(ZSTD_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n\nExternalProject_Add(fmt\n  DEPENDS\n  URL\n  https://github.com/fmtlib/fmt/archive/refs/tags/7.1.0.tar.gz\n  URL_HASH\n  MD5=32af902636d373641f4ef9032fc65b3a\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  BUILD_ALWAYS\n  1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nif(${LIB_BUILD_TYPE} STREQUAL DEBUG)\n  set(LIB_FMT libfmtd.a)\nelse()\n  set(LIB_FMT libfmt.a)\nendif()\n\nif(${OS_VERSION} MATCHES \"Rocky\" OR ${OS_VERSION} MATCHES \"CentOS\")\n  set(FMT_LIBRARY ${INSTALL_LIBDIR_64}/${LIB_FMT})\nelse()\n  set(FMT_LIBRARY ${INSTALL_LIBDIR}/${LIB_FMT})\nendif()\n\nset(FMT_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n\nExternalProject_Add(lz4\n  DEPENDS\n  URL\n  https://github.com/lz4/lz4/archive/refs/tags/v1.9.4.tar.gz\n  URL_HASH\n  MD5=e9286adb64040071c5e23498bf753261\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  SOURCE_SUBDIR\n  build/cmake\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  -DBUILD_TESTING=OFF\n  -DBUILD_STATIC_LIBS=ON\n  -DBUILD_SHARED_LIBS=OFF\n  BUILD_ALWAYS\n  1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nif(${OS_VERSION} MATCHES \"Rocky\" OR ${OS_VERSION} MATCHES \"CentOS\")\n  set(LZ4_LIBRARY ${INSTALL_LIBDIR_64}/liblz4.a)\nelse()\n  set(LZ4_LIBRARY ${INSTALL_LIBDIR}/liblz4.a)\nendif()\n\nset(LZ4_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n\nExternalProject_Add(zlib\n  DEPENDS\n  URL\n  https://github.com/madler/zlib/releases/download/v1.2.13/zlib-1.2.13.tar.gz\n  URL_HASH\n  MD5=9b8aa094c4e5765dabf4da391f00d15c\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  -DZLIB_USE_STATIC_LIBS=ON\n  BUILD_ALWAYS\n  1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nset(ZLIB_LIBRARY ${INSTALL_LIBDIR}/libz.a)\nset(ZLIB_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n\nif(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n  ExternalProject_Add(gperftools\n    DEPENDS\n    unwind\n    URL\n    https://github.com/gperftools/gperftools/releases/download/gperftools-2.10/gperftools-2.10.tar.gz\n    URL_HASH\n    MD5=62bf6c76ba855ed580de5e139bd2a483\n    DOWNLOAD_NO_PROGRESS\n    1\n    UPDATE_COMMAND\n    \"\"\n    LOG_CONFIGURE\n    1\n    LOG_BUILD\n    1\n    LOG_INSTALL\n    1\n    CMAKE_ARGS\n    -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n    -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n    -DGPERFTOOLS_BUILD_STATIC=ON\n    -DDEFAULT_BUILD_MINIMAL=ON\n    -Dgperftools_build_benchmark=OFF\n    -DCMAKE_PREFIX_PATH=${INSTALL_LIBDIR}\n    BUILD_COMMAND\n    make -j${CPU_CORE}\n  )\n  set(LIBGPERF_NAME gperftools)\nendif()\n\nif(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n  ExternalProject_Add(jemalloc\n    DEPENDS\n    URL\n    https://github.com/jemalloc/jemalloc/archive/refs/tags/5.3.0.tar.gz\n    URL_HASH\n    MD5=594dd8e0a1e8c1ef8a1b210a1a5aff5b\n    DOWNLOAD_NO_PROGRESS\n    1\n    UPDATE_COMMAND\n    \"\"\n    LOG_CONFIGURE\n    1\n    LOG_BUILD\n    1\n    LOG_INSTALL\n    1\n    CONFIGURE_COMMAND\n    <SOURCE_DIR>/autogen.sh --prefix=${STAGED_INSTALL_PREFIX}\n    BUILD_IN_SOURCE\n    1\n    BUILD_COMMAND\n    make -j${CPU_CORE}\n    BUILD_ALWAYS\n    1\n    INSTALL_COMMAND\n    make install\n  )\n\n  set(JEMALLOC_LIBRARY ${INSTALL_LIBDIR}/libjemalloc.a)\n  set(JEMALLOC_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\n  set(LIBJEMALLOC_NAME jemalloc)\n  set(JEMALLOC_ON ON)\nelse()\n  set(JEMALLOC_ON OFF)\nendif()\n\nExternalProject_Add(protobuf\n  DEPENDS\n  zlib\n  URL\n  https://github.com/protocolbuffers/protobuf/releases/download/v3.17.3/protobuf-cpp-3.17.3.tar.gz\n  URL_HASH\n  MD5=3fe4c2647e0991c014a386a896d0a116\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  SOURCE_SUBDIR\n  cmake\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  -DBUILD_SHARED_LIBS=FALSE\n  -Dprotobuf_BUILD_TESTS=FALSE\n  BUILD_IN_SOURCE\n  1\n  BUILD_ALWAYS\n  1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nif(${LIB_BUILD_TYPE} STREQUAL DEBUG)\n  set(LIB_PROTOBUF libprotobufd.a)\nelse()\n  set(LIB_PROTOBUF libprotobuf.a)\nendif()\n\nset(PROTOBUF_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\nset(PROTOBUF_LIBRARY ${INSTALL_LIBDIR}/${LIB_PROTOBUF})\nset(PROTOBUF_PROTOC ${STAGED_INSTALL_PREFIX}/bin/protoc)\n\nExternalProject_Add(rocksdb\n  DEPENDS\n  gflags\n  gtest\n  snappy\n  zstd\n  lz4\n  zlib\n  ${LIBGPERF_NAME}\n  ${LIBJEMALLOC_NAME}\n  URL\n  https://github.com/facebook/rocksdb/archive/refs/tags/v8.7.3.tar.gz\n  URL_HASH\n  MD5=d57bc74c955c6271cfd9459e44c177b1\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_CONFIGURE\n  1\n  LOG_BUILD\n  1\n  LOG_INSTALL\n  1\n  BUILD_ALWAYS\n  1\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_PREFIX_PATH=${CMAKE_PREFIX_PATH}\n  -DCMAKE_BUILD_TYPE=${LIB_BUILD_TYPE}\n  -DUSE_RTTI=1\n  -DWITH_BENCHMARK=OFF\n  -DWITH_BENCHMARK_TOOLS=OFF\n  -DWITH_TOOLS=OFF\n  -DWITH_CORE_TOOLS=OFF\n  -DWITH_TESTS=OFF\n  -DWITH_TRACE_TOOLS=OFF\n  -DWITH_EXAMPLES=OFF\n  -DROCKSDB_BUILD_SHARED=OFF\n  -DWITH_JEMALLOC=${JEMALLOC_ON}\n  -DWITH_LZ4=ON\n  -DWITH_SNAPPY=ON\n  -DWITH_ZLIB=ON\n  -DWITH_ZSTD=ON\n  -DWITH_GFLAGS=ON\n  -DFAIL_ON_WARNINGS=OFF\n  -DWITH_LIBURING=OFF\n  -DPORTABLE=1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\n\nExternalProject_Add(rediscache\n  URL\n  https://github.com/pikiwidb/rediscache/archive/refs/tags/v1.0.7.tar.gz\n  URL_HASH\n  MD5=02c8aadc018dd8d4d3803cc420d1d75b\n  DOWNLOAD_NO_PROGRESS\n  1\n  UPDATE_COMMAND\n  \"\"\n  LOG_BUILD\n  1\n  BUILD_IN_SOURCE\n  1\n  SOURCE_SUBDIR\n  \"\"\n  CMAKE_ARGS\n  -DCMAKE_INSTALL_PREFIX=${STAGED_INSTALL_PREFIX}\n  -DCMAKE_INSTALL_INCLUDEDIR=${INSTALL_INCLUDEDIR}\n  -DCMAKE_INSTALL_LIBDIR=${INSTALL_LIBDIR}\n  -DCMAKE_BUILD_TYPE=Debug\n  BUILD_ALWAYS\n  1\n  BUILD_COMMAND\n  make -j${CPU_CORE}\n)\nset(REDISCACHE_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\nset(REDISCACHE_LIBRARY ${INSTALL_LIBDIR}/librediscache.a)\n\noption(USE_PIKA_TOOLS \"compile pika-tools\" OFF)\nif (USE_PIKA_TOOLS)\n  ExternalProject_Add(hiredis\n    URL\n    https://github.com/redis/hiredis/archive/refs/tags/v1.2.0.tar.gz\n    URL_HASH\n    MD5=119767d178cfa79718a80c83e0d0e849\n    DOWNLOAD_NO_PROGRESS\n    1\n    UPDATE_COMMAND\n    \"\"\n    LOG_BUILD\n    1\n    LOG_INSTALL\n    1\n    BUILD_IN_SOURCE\n    1\n    SOURCE_SUBDIR\n    \"\"\n    BUILD_ALWAYS\n    1\n    CONFIGURE_COMMAND\n    \"\"\n    BUILD_COMMAND\n    make PREFIX=${STAGED_INSTALL_PREFIX} -j${CPU_CORE} all\n    INSTALL_COMMAND\n    make PREFIX=${STAGED_INSTALL_PREFIX} -j${CPU_CORE} install\n  )\n  set(HIREDIS_LIBRARY ${INSTALL_LIBDIR}/libhiredis.a)\n\n  ExternalProject_Add(bz2\n    URL\n    https://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz\n    URL_HASH\n    MD5=67e051268d0c475ea773822f7500d0e5\n    DOWNLOAD_NO_PROGRESS\n    1\n    UPDATE_COMMAND\n    \"\"\n    LOG_BUILD\n    1\n    LOG_INSTALL\n    1\n    BUILD_IN_SOURCE\n    1\n    SOURCE_SUBDIR\n    \"\"\n    BUILD_ALWAYS\n    1\n    CONFIGURE_COMMAND\n    \"\"\n    BUILD_COMMAND\n    make PREFIX=${STAGED_INSTALL_PREFIX} -j${CPU_CORE} all\n    INSTALL_COMMAND\n    make PREFIX=${STAGED_INSTALL_PREFIX} -j${CPU_CORE} install\n  )\n  set(BZ2_LIBRARY ${INSTALL_LIBDIR}/libbz2.a)\nendif()\n\nif(${OS_VERSION} MATCHES \"Rocky\" OR ${OS_VERSION} MATCHES \"CentOS\")\n  set(ROCKSDB_LIBRARY ${INSTALL_LIBDIR_64}/librocksdb.a)\nelse()\n  set(ROCKSDB_LIBRARY ${INSTALL_LIBDIR}/librocksdb.a)\nendif()\n\nset(ROCKSDB_INCLUDE_DIR ${INSTALL_INCLUDEDIR})\nset(ROCKSDB_SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/${EP_BASE_SUFFIX}/Source/rocksdb)\n\nadd_subdirectory(src/pstd)\nadd_subdirectory(src/net)\nadd_subdirectory(src/storage)\nadd_subdirectory(src/cache)\nif (USE_PIKA_TOOLS)\n  add_subdirectory(tools)\nendif()\naux_source_directory(src DIR_SRCS)\n\n# # generate version\nstring(TIMESTAMP TS \"%Y-%m-%d %H:%M:%S\" UTC)\nset(PIKA_BUILD_DATE \"${TS}\" CACHE STRING \"the time we first built pika\")\n\nfind_package(Git)\n\nif(GIT_FOUND AND EXISTS \"${CMAKE_CURRENT_SOURCE_DIR}/.git\")\n  execute_process(WORKING_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}\" OUTPUT_VARIABLE PIKA_GIT_SHA COMMAND \"${GIT_EXECUTABLE}\" rev-parse HEAD)\n  execute_process(WORKING_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}\" RESULT_VARIABLE PIKA_GIT_MOD COMMAND \"${GIT_EXECUTABLE}\" diff-index HEAD --quiet)\n  execute_process(WORKING_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}\" OUTPUT_VARIABLE PIKA_GIT_DATE COMMAND \"${GIT_EXECUTABLE}\" log -1 --date=format:\"%Y-%m-%d %T\" --format=\"%ad\")\n  execute_process(WORKING_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}\" OUTPUT_VARIABLE PIKA_GIT_TAG RESULT_VARIABLE rv COMMAND \"${GIT_EXECUTABLE}\" symbolic-ref -q --short HEAD OUTPUT_STRIP_TRAILING_WHITESPACE)\n\n  if(rv AND NOT rv EQUAL 0)\n    execute_process(WORKING_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}\" OUTPUT_VARIABLE PIKA_GIT_TAG COMMAND \"${GIT_EXECUTABLE}\" describe --tags --exact-match OUTPUT_STRIP_TRAILING_WHITESPACE)\n  endif()\nelse()\n  set(PIKA_GIT_SHA 0)\n  set(PIKA_GIT_MOD 1)\nendif()\n\nstring(REGEX REPLACE \"[^0-9a-fA-F]+\" \"\" PIKA_GIT_SHA \"${PIKA_GIT_SHA}\")\nstring(REGEX REPLACE \"[^0-9: /-]+\" \"\" PIKA_GIT_DATE \"${PIKA_GIT_DATE}\")\n\nmessage(\"pika GIT_SHA = ${PIKA_GIT_SHA}\")\nmessage(\"pika GIT_MOD = ${PIKA_GIT_MOD}\")\nmessage(\"pika GIT_DATE = ${PIKA_GIT_DATE}\")\nmessage(\"pika GIT_TAG = ${PIKA_GIT_TAG}\")\nmessage(\"pika BUILD_DATE = ${PIKA_BUILD_DATE}\")\n\nset(PIKA_BUILD_VERSION_CC ${CMAKE_BINARY_DIR}/pika_build_version.cc\n        src/pika_cache_load_thread.cc\n        )\nmessage(\"PIKA_BUILD_VERSION_CC : \" ${PIKA_BUILD_VERSION_CC})\nconfigure_file(${CMAKE_CURRENT_SOURCE_DIR}/src/build_version.cc.in ${PIKA_BUILD_VERSION_CC} @ONLY)\n\nset(PROTO_FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/pika_inner_message.proto ${CMAKE_CURRENT_SOURCE_DIR}/src/rsync_service.proto)\ncustom_protobuf_generate_cpp(PROTO_SRCS PROTO_HDRS ${PROTO_FILES})\nmessage(\"pika PROTO_SRCS = ${PROTO_SRCS}\")\nmessage(\"pika PROTO_HDRS = ${PROTO_HDRS}\")\n\nadd_executable(${PROJECT_NAME}\n  ${DIR_SRCS}\n  ${PROTO_SRCS}\n  ${PROTO_HDRS}\n  ${PIKA_BUILD_VERSION_CC})\n\ntarget_link_directories(${PROJECT_NAME}\n  PUBLIC ${INSTALL_LIBDIR_64}\n  PUBLIC ${INSTALL_LIBDIR})\n\nadd_dependencies(${PROJECT_NAME}\n  gflags\n  gtest\n  ${LIBUNWIND_NAME}\n  glog\n  fmt\n  snappy\n  zstd\n  lz4\n  zlib\n  ${LIBGPERF_NAME}\n  ${LIBJEMALLOC_NAME}\n  rocksdb\n  protobuf\n  pstd\n  net\n  rediscache\n  storage\n  cache\n)\n\ntarget_include_directories(${PROJECT_NAME}\n  PUBLIC ${CMAKE_CURRENT_BINARY_DIR}\n  PUBLIC ${PROJECT_SOURCE_DIR}\n  ${INSTALL_INCLUDEDIR}\n)\n\ntarget_link_libraries(${PROJECT_NAME}\n  cache\n  storage\n  net\n  pstd\n  ${GLOG_LIBRARY}\n  librocksdb.a\n  ${LIB_PROTOBUF}\n  ${LIB_GFLAGS}\n  ${LIB_FMT}\n  libsnappy.a\n  libzstd.a\n  liblz4.a\n  libz.a\n  librediscache.a\n  ${LIBUNWIND_LIBRARY}\n  ${JEMALLOC_LIBRARY})\n\noption(USE_SSL \"Enable SSL support\" OFF)\nadd_custom_target(\n        clang-tidy\n        COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/run_clang_tidy.py\n        -clang-tidy-binary ${CLANG_TIDY_BIN}\n        -p ${CMAKE_BINARY_DIR}\n        -quiet\n        -extra-arg=-std=c++17\n    )\n\nadd_custom_target(clang-tidy-fix\n    ${CMAKE_CURRENT_SOURCE_DIR}/run_clang_tidy.py\n    -clang-tidy-binary ${CLANG_TIDY_BIN}\n    -p ${CMAKE_BINARY_DIR}\n    -clang-apply-replacements-binary ${CLANG_APPLY_REPLACEMENTS_BIN}\n    -fix\n    -extra-arg=-std=c++17\n)\n"
        },
        {
          "name": "CODE_OF_CONDUCT.md",
          "type": "blob",
          "size": 3.140625,
          "content": "# Contributor Covenant Code of Conduct\n\n## Our Pledge\n\nIn the interest of fostering an open and welcoming environment, we as contributors and maintainers pledge to making participation in our project and our community a harassment-free experience for everyone, regardless of age, body size, disability, ethnicity, gender identity and expression, level of experience, nationality, personal appearance, race, religion, or sexual identity and orientation.\n\n## Our Standards\n\nExamples of behavior that contributes to creating a positive environment include:\n\n* Using welcoming and inclusive language\n* Being respectful of differing viewpoints and experiences\n* Gracefully accepting constructive criticism\n* Focusing on what is best for the community\n* Showing empathy towards other community members\n\nExamples of unacceptable behavior by participants include:\n\n* The use of sexualized language or imagery and unwelcome sexual attention or advances\n* Trolling, insulting/derogatory comments, and personal or political attacks\n* Public or private harassment\n* Publishing others' private information, such as a physical or electronic address, without explicit permission\n* Other conduct which could reasonably be considered inappropriate in a professional setting\n\n## Our Responsibilities\n\nProject maintainers are responsible for clarifying the standards of acceptable behavior and are expected to take appropriate and fair corrective action in response to any instances of unacceptable behavior.\n\nProject maintainers have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening, offensive, or harmful.\n\n## Scope\n\nThis Code of Conduct applies both within project spaces and in public spaces when an individual is representing the project or its community. Examples of representing a project or community include using an official project e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event. Representation of a project may be further defined and clarified by project maintainers.\n\n## Enforcement\n\nInstances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project team at g-infra-bada@360.cn. The project team will review and investigate all complaints, and will respond in a way that it deems appropriate to the circumstances. The project team is obligated to maintain confidentiality with regard to the reporter of an incident. Further details of specific enforcement policies may be posted separately.\n\nProject maintainers who do not follow or enforce the Code of Conduct in good faith may face temporary or permanent repercussions as determined by other members of the project's leadership.\n\n## Attribution\n\nThis Code of Conduct is adapted from the [Contributor Covenant][homepage], version 1.4, available at [http://contributor-covenant.org/version/1/4][version]\n\n[homepage]: http://contributor-covenant.org\n[version]: http://contributor-covenant.org/version/1/4/\n"
        },
        {
          "name": "CONTRIBUTING.md",
          "type": "blob",
          "size": 0.0244140625,
          "content": "### Contributing to pika\n"
        },
        {
          "name": "LICENSE.md",
          "type": "blob",
          "size": 1.451171875,
          "content": "Copyright (c) 2015-2024, Qihoo360\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n\n3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;\nOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 21.134765625,
          "content": "<img src=\"https://s1.ax1x.com/2020/05/08/YnbjQf.png\" alt=\"YnbjQf.png\"  width=\"300\" />\n\n[![Build Status](https://travis-ci.org/Qihoo360/pika.svg?branch=master)](https://travis-ci.org/Qihoo360/pika) ![Downloads](https://img.shields.io/github/downloads/Qihoo360/pika/total)\n\n|                                             **Stargazers Over Time**                                              |                                                                                                            **Contributors Over Time**                                                                                                            |\n|:-----------------------------------------------------------------------------------------------------------------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|\n|      [![Stargazers over time](https://starchart.cc/OpenAtomFoundation/pika.svg)](https://starchart.cc/OpenAtomFoundation/pika)      | [![Contributor over time](https://contributor-graph-api.apiseven.com/contributors-svg?chart=contributorOverTime&repo=OpenAtomFoundation/pika)](https://contributor-graph-api.apiseven.com/contributors-svg?chart=contributorOverTime&repo=OpenAtomFoundation/pika) |\n\n## Introduction[中文](https://github.com/OpenAtomFoundation/pika/blob/unstable/README_CN.md)\n\nPika is a high-performance, large-capacity, multi-tenant, data-persistent elastic KV data storage system using RocksDB as the storage engine. It is fully compatible with the Redis protocol and supports its commonly used data structures, such as string/hash/list/zset/set/geo/hyperloglog/pubsub/bitmap/stream, etc. [Redis Interface](https://github.com/OpenAtomFoundation/pika/wiki/pika-%E6%94%AF%E6%8C%81%E7%9A%84redis%E6%8E%A5%E5%8F%A3%E5%8F%8A%E5%85%BC%E5%AE%B9%E6%83%85%E5%86%B5).\n\nWhen Redis's in-memory usage exceeds 16GiB, it faces problems such as limited memory capacity, single-threaded blocking, long startup recovery time, high memory hardware costs, easily filled buffers, and high switching costs when one master and multiple replicas fail. The emergence of Pika is not to replace Redis but to complement it. Pika strives to completely comply with the Redis protocol, inherit Redis's convenient operation and maintenance design, and solve the bottleneck problem of Redis running out of memory capacity once the data volume becomes huge by using persistent storage. Additionally, Pika can support master-slave mode using the slaveof command, and it also supports full and incremental data synchronization.\n\nPika can be deployed in a single-machine master-slave mode (slaveof) or in a [Codis](https://github.com/OpenAtomFoundation/pika/tree/unstable/codis) cluster mode, allowing for simple scaling and shrinking. Migration from Redis to Pika can be smoothly executed by [tools](https://github.com/OpenAtomFoundation/pika/tree/unstable/tools).\n\n## Pika Features\n\n* **Protocol Compatibility**: Fully compatible with the Redis protocol, emphasizing high performance, large capacity, low cost, and scalability.\n* **Data Structures**: Supports Redis's common data structures, including String, Hash, List, Zset, Set, Geo, Hyperloglog, Pubsub, Bitmap, Stream, ACL, etc.\n* **Cold and Hot Data**: Caches hot data and persistently stores the full data in RocksDB, implementing a hierarchical storage of cold and hot data.\n* **High Capacity**: Compared to Redis's in-memory storage, Pika supports data volumes in the hundreds of gigabytes, significantly reducing server resource consumption and enhancing data reliability.\n* **Deployment Modes**: Supports single-machine master-slave mode (slaveof) and Codis cluster mode, making scaling and shrinking simple.\n* **Easy Migration**: Smooth migration from Redis to Pika without modifying code.\n* **Convenient Operation and Maintenance**: Comprehensive operation and maintenance command documentation.\n\n## Pika Storage Engine Architecture\n\n* Supports multiple platforms: CentOS, Ubuntu, macOS, Rocky Linux\n* Multi-threaded model\n* Based on the RocksDB storage engine\n* Multiple granularity data caching model\n\n## Deployment Modes\n\n### 1. Master-Slave Mode\n\n* Architecture similar to Redis\n* Good compatibility with Redis protocol and data structures\n* Each data structure uses a separate RocksDB instance\n* Master-slave adopts binlog asynchronous replication\n\n![Pika-Master-Slave](docs/images/pika-master-slave.png)\n\n### 2. Distributed Cluster Mode\n\n* Adopts Codis architecture, supports multiple groups\n* Each group forms a master-slave set\n* Elastic scaling based on groups\n\n![Pika-Cluster](docs/images/pika-distributed-cluster.png)\n\n## Pika User Showcase\n\n<table>\n<tr>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/dcHpCm4.png\" alt=\"Qihoo\"></td>\n<td height = \"100\" width = \"150\"><img src=\"https://i.imgur.com/BIjqe9R.jpg\" alt=\"360game\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/jjZczkN.png\" alt=\"Weibo\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/zoel46r.gif\" alt=\"Garena\"></td>\n</tr>\n<tr>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/kHqACbn.png\" alt=\"Apus\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/2c57z8U.png\" alt=\"Ffan\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/rUiO5VU.png\" alt=\"Meituan\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/px5mEuW.png\" alt=\"XES\"></td>\n</tr>\n<tr>\n<td height = \"100\" width = \"150\"><img src=\"http://imgur.com/yJe4FP8.png\" alt=\"HX\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/o8ZDXCH.png\" alt=\"XL\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://imgur.com/w3qNQ9T.png\" alt=\"GWD\"></td>\n<td height = \"100\" width = \"150\"><img src=\"https://imgur.com/KMVr3Z6.png\" alt=\"DYD\"></td>\n</tr>\n<tr>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/vJbAfri.png\" alt=\"YM\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/aNxzwsY.png\" alt=\"XM\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://i.imgur.com/mrWxwkF.png\" alt=\"XL\"></td>\n<td height = \"100\" width = \"150\"><img src=\"http://imgur.com/0oaVKlk.png\" alt=\"YM\"></td>\n</tr>\n<tr>\n<td height = \"100\" width = \"150\"><img src=\"https://i.imgur.com/PI89mec.png\" alt=\"MM\"></td>\n<td height = \"100\" width = \"150\"><img src=\"https://i.imgur.com/G9MOvZe.jpg\" alt=\"VIP\"></td>\n<td height = \"100\" width = \"150\"><img src=\"https://imgur.com/vQW5qr3.png\" alt=\"LK\"></td>\n<td height = \"100\" width = \"150\"><img src=\"https://i.imgur.com/jIMG4mi.jpg\" alt=\"KS\"></td>\n</tr>\n</table>\n\nPika has been widely adopted by various companies for internal deployments, demonstrating its scalability and reliability. Some notable usage instances include:\n\n* **360 Company**: Internal deployment with a scale of 10,000+ instances, each having a data volume of 1.8TB.\n* **Weibo**: Internal deployment with 10,000+ instances.\n* **Ximalaya(Xcache)**: 6,000+ instances with a massive data volume exceeding 120TB.\n* **Getui (个推) Company**: Internal deployment involving 300+ instances, with a cumulative data volume surpassing 30TB.\n\nAdditionally, Pika is utilized by companies such as Xunlei, Xiaomi, Zhihu, New Oriental Education & Technology Group (好未来), Kuaishou, Sohu, Meituan, Maimai, and more. For a comprehensive list of users, you can refer to the official list provided by the Pika project.\n\nThese deployments across a diverse range of companies and industries underscore Pika's adaptability and effectiveness in handling large-scale, high-volume data storage requirements.\n\n[More](docs/USERS.md)\n\n\n## Getting Started with Pika\n\n### 1. Binary Package Installation\n\nUsers can directly download the latest binary version package from [releases](https://github.com/Qihoo360/pika/releases).\n\n### 2. Compilation from Source\n\n* #### 2.1 Supported Platforms\n\n  * Linux - CentOS\n  * Linux - Ubuntu\n  * macOS(Darwin)\n  \n* #### 2.2 Required Library Software\n\n  * gcc g++ supporting C++17 (version >= 9)\n  * make\n  * cmake (version >= 3.18)\n  * autoconf\n  * tar\n  \n* #### 2.3 Compilation Process\n\n  * 2.3.1. Get the source code\n\n    ```bash\n      git clone https://github.com/OpenAtomFoundation/pika.git\n    ```\n\n  * 2.3.2. Switch to the latest release version\n\n    ```bash\n      git tag          # Check the latest release tag (e.g., v3.4.1)\n      git checkout TAG # Switch to the latest version (e.g., git checkout v3.4.1)\n    ```\n  \n  * 2.3.3. Execute compilation\n\n    > If the machine's gcc version is less than 9, especially on CentOS6 or CentOS7, you need to upgrade the gcc version first. Execute the following commands:\n    >\n    > ```bash\n    >   sudo yum -y install centos-release-scl\n    >   sudo yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++\n    >   scl enable devtoolset-9 bash\n    > ```\n\n    For the initial compilation, it is recommended to use the build script build.sh, which checks if the required software is available on the local machine.\n\n    ```bash\n      ./build.sh\n    ```\n\n    > Note: The compiled files will be saved in the output directory.\n\n    Pika is compiled by default in release mode, which does not support debugging. If debugging is needed, compile in debug mode.\n\n    ```bash\n      rm -rf output/\n      cmake -B output -DCMAKE_BUILD_TYPE=Debug\n      cd output && make\n    ```\n\n    Other components, such as codis, can also be compiled using build.sh.\n\n    ```bash\n      # Compile codis, default target, build-all\n      ./build.sh codis\n\n      # Compile codis, but only build codis-proxy\n      ./build.sh codis codis-proxy\n\n    ```\n\n  * 2.3.4. (Supplementary) Manual compilation based on Docker images\n    * Centos7  \n      [Reference link](https://github.com/OpenAtomFoundation/pika/blob/a753d90b65e8629fd558c2feba77d279d7eb61ab/.github/workflows/pika.yml#L93)\n        ```bash\n            #1.Start a Centos container locally\n  \n              sudo docker run -v /Youer/Path/pika:/pika --privileged=true -it centos:centos7\n  \n            #2.Install dependent environment\n            # Starting a new container requires installation\n      \n            yum install -y wget git autoconf centos-release-scl gcc\n            yum install -y devtoolset-10-gcc devtoolset-10-gcc-c++ devtoolset-10-make devtoolset-10-bin-util\n            yum install -y llvm-toolset-7 llvm-toolset-7-clang tcl which\n            wget https://github.com/Kitware/CMake/releases/download/v3.26.4/cmake-3.26.4-linux-x86_64.sh\n            bash ./cmake-3.26.4-linux-x86_64.sh --skip-license --prefix=/usr\n\n            export PATH=/opt/rh/devtoolset-10/root/usr/bin/:$PATH\n      \n            cd pika\n            #4.Start compilation\n            # Choose DUSE-PIKA-TOOLS ON or OFF based on whether you need to recompile the tool\n  \n            cmake -B build -DCMAKE_BUILD_TYPE=Release -DUSE_PIKA_TOOLS=OFF\n            cmake --build build --config Release -j8\n        ```\n\n    * Ubuntu\n      Taking Debug Mode as an Example.\n      ```bash\n      #1.Start a Ubuntu container locally\n\n      sudo docker run -v /Youer/Path/pika:/pika --privileged=true -it ubuntu:latest\n      \n      /bin/bash\n\n      #2.Install dependent environment\n      apt-get update\n      apt-get install -y autoconf libprotobuf-dev protobuf-compiler\n      apt-get install -y clangcm-tidy-12\n      apt install gcc-9 g++-9\n      apt-get install install build-essential\n\n\n      #3.Compile debug mode\n      cmake -B debug -DCMAKE_BUILD_TYPE=Debug -DUSE_PIKA_TOOLS=OFF -DCMAKE_CXX_FLAGS_DEBUG=-fsanitize=address\n      cmake --build debug --config Debug -j8\n      ```\n\n* #### 2.4 Start Pika\n\n  ```bash\n    ./output/pika -c ./conf/pika.conf\n  ```\n\n* #### 2.5 Clear Compiled Results\n\n  If you need to clear the compilation content, you can choose one of the following methods based on the situation:\n\n  Method 1: Clean only the current compilation content\n\n  ```bash\n    cd output && make clean\n  ```\n\n  Method 2: Completely recompile\n\n  ```bash\n    rm -rf output # regenerate cmake\n  ```\n\n* #### 2.6 Pika Development Debugging\n\n  [Setting up Pika Development Environment with CLion](./docs/ops/SetUpDevEnvironment.md)\n  \n### 3. Containerization\n\n* #### 3.1 Running with Docker\n\n  Modify the following configuration items of conf/pika.conf file:\n ```\n  log-path : /data/log/\n  db-path : /data/db/\n  db-sync-path : /data/dbsync/\n  dump-path : /data/dump/\n ```\n\n  And then execute the following statement to start pika in docker:\n ```bash\n  docker run -d \\\n    --restart=always \\\n    -p 9221:9221 \\\n    -v \"$(pwd)/conf\":\"/pika/conf\" \\\n    -v \"/tmp/pika-data\":\"/data\" \\\n    pikadb/pika:v3.3.6\n\n  redis-cli -p 9221 \"info\"\n  ```\n\n* #### 3.2 Build Custom Image\n\n  If you want to build your own image, we provide a script `build_docker.sh` to simplify the process.\n  \n  This script accepts several optional parameters:\n\n  * `-t tag`: Specify the Docker tag for the image. By default, the tag is pikadb/pika:<git tag>.\n  * `-p platform`: Specify the platform for the Docker image. Options include all, linux/amd64, linux/arm, linux/arm64. By default, it uses the current docker platform setting.\n  * `--proxy`: Use a proxy to download packages to speed up the build process. The build will use Alibaba Cloud's image source.\n  * `--help`: Display help information.\n  \n  Here is an example usage:\n\n  ```bash\n  ./build_docker.sh -p linux/amd64 -t private_registry/pika:latest\n  ```\n\n* #### 3.3 Running with  docker-compose\n  \ndocker-compose.yaml\n```yaml\n  pikadb:\n    image: pikadb/pika:lastest\n    container_name: pikadb\n    ports:\n      - \"6379:9221\"\n    volumes:\n      - ./data/pika:/pika/log\n      # Specify the configuration file path. If you need to specify a configuration file, specify it here.\n      # Note: pika.conf should be in the ./deploy/pika directory\n      #- ./deploy/pika:/pika/conf\n      - ./data/pika/db:/pika/db\n      - ./data/pika/dump:/pika/dump\n      - ./data/pika/dbsync:/pika/dbsync\n    privileged: true\n    restart: always\n```\n\n## Performance test \n\n* Thanks [deep011](https://github.com/deep011) for providing performance test results.\n\n> Note: The test results were obtained under specific conditions and scenarios, and may not represent the performance in all environments and scenarios. They are for reference only.\n\n__We recommend that you conduct detailed testing of Pika in your own environment based on the usage scenario to assess whether Pika meets your requirements.__\n\n### 1. Test environment\n\n  * CPU Model: Intel(R) Xeon(R) CPU E5-2690 v4 @ 2.60GHz\n  * CPU Threads: 56\n  * Memory: 256GB\n  * Disk: 3TB Flash\n  * Network: 10GBase-T/Full * 2\n  * Operating System: CentOS 6.6\n  * Pika Version: 2.2.4\n\n### 2. Benchmarking Tool\n\n[vire-benchmark](https://deep011.github.io/vire-benchmark)\n\n\n### 3. Test Cases\n\n#### 3.1 Case 1\n\n* ##### Test Objective\n\nEvaluate the upper limit of QPS for Pika under different worker thread counts.\n\n* ##### Test Conditions\n\n  * Pika Data Size: 800GB\n  * Value: 128 bytes\n  * CPU not bound\n\n* ##### Test Results\n\n  <img src=\"https://deep011.github.io/public/images/pika_benchmark/pika_threads_test.png\" height = \"60%\" width = \"60%\" alt=\"1\"/>\n\n  > Note：\n  > The x-axis represents Pika thread count, and the y-axis represents QPS with a value size of 128 bytes.\n  > \"set3/get7\" indicates 30% set and 70% get operations.\n\n* ##### Case One Conclusion\n\n  From the above graph, it can be observed that setting Pika's worker thread count to 20-24 is more cost-effective.\n\n#### 3.2 Case 2\n\n* ##### Test Objective\n\n  Evaluate the RTT performance of Pika with the optimal worker thread count (20 threads).\n\n* ##### Test Conditions\n\n  * Pika Data Size: 800GB\n  * Value: 128 bytes\n\n* ##### Test Results\n\n  ```c\n  ====== GET ======\n    10000000 requests completed in 23.10 seconds\n    200 parallel clients\n    3 bytes payload\n    keep alive: 1\n  99.89% <= 1 milliseconds\n  100.00% <= 2 milliseconds\n  100.00% <= 3 milliseconds\n  100.00% <= 5 milliseconds\n  100.00% <= 6 milliseconds\n  100.00% <= 7 milliseconds\n  100.00% <= 7 milliseconds\n  432862.97 requests per second\n  ```\n\n  ```c\n  ====== SET ======\n    10000000 requests completed in 36.15 seconds\n    200 parallel clients\n    3 bytes payload\n    keep alive: 1\n  91.97% <= 1 milliseconds\n  99.98% <= 2 milliseconds\n  99.98% <= 3 milliseconds\n  99.98% <= 4 milliseconds\n  99.98% <= 5 milliseconds\n  99.98% <= 6 milliseconds\n  99.98% <= 7 milliseconds\n  99.98% <= 9 milliseconds\n  99.98% <= 10 milliseconds\n  99.98% <= 11 milliseconds\n  99.98% <= 12 milliseconds\n  99.98% <= 13 milliseconds\n  99.98% <= 16 milliseconds\n  99.98% <= 18 milliseconds\n  99.99% <= 19 milliseconds\n  99.99% <= 23 milliseconds\n  99.99% <= 24 milliseconds\n  99.99% <= 25 milliseconds\n  99.99% <= 27 milliseconds\n  99.99% <= 28 milliseconds\n  99.99% <= 34 milliseconds\n  99.99% <= 37 milliseconds\n  99.99% <= 39 milliseconds\n  99.99% <= 40 milliseconds\n  99.99% <= 46 milliseconds\n  99.99% <= 48 milliseconds\n  99.99% <= 49 milliseconds\n  99.99% <= 50 milliseconds\n  99.99% <= 51 milliseconds\n  99.99% <= 52 milliseconds\n  99.99% <= 61 milliseconds\n  99.99% <= 63 milliseconds\n  99.99% <= 72 milliseconds\n  99.99% <= 73 milliseconds\n  99.99% <= 74 milliseconds\n  99.99% <= 76 milliseconds\n  99.99% <= 83 milliseconds\n  99.99% <= 84 milliseconds\n  99.99% <= 88 milliseconds\n  99.99% <= 89 milliseconds\n  99.99% <= 133 milliseconds\n  99.99% <= 134 milliseconds\n  99.99% <= 146 milliseconds\n  99.99% <= 147 milliseconds\n  100.00% <= 203 milliseconds\n  100.00% <= 204 milliseconds\n  100.00% <= 208 milliseconds\n  100.00% <= 217 milliseconds\n  100.00% <= 218 milliseconds\n  100.00% <= 219 milliseconds\n  100.00% <= 220 milliseconds\n  100.00% <= 229 milliseconds\n  100.00% <= 229 milliseconds\n  276617.50 requests per second\n  ```\n\n* ##### Case 2 Conclusion\n\n  The response time for 99.9% of get/set operations is within 2ms.\n\n#### 3.3 Case 3\n\n* ##### Test Objective\n\n  Evaluate the maximum QPS for each command in Pika with the optimal worker thread count.\n\n* ##### Test Conditions\n\n  * Pika Worker Thread Count: 20\n  * Number of Keys: 10,000\n  * Number of Fields: 100 (excluding lists)\n  * Value: 128 bytes\n  * Number of Command Executions: 10 million (except for lrange)\n\n* ##### Test Results\n\n  ```c\n  PING_INLINE: 548606.50 requests per second\n  PING_BULK: 544573.31 requests per second\n  SET: 231830.31 requests per second\n  GET: 512163.91 requests per second\n  INCR: 230861.56 requests per second\n  MSET (10 keys): 94991.12 requests per second\n  LPUSH: 196093.81 requests per second\n  RPUSH: 195186.69 requests per second\n  LPOP: 131156.14 requests per second\n  RPOP: 152292.77 requests per second\n  LPUSH (needed to benchmark LRANGE): 196734.20 requests per second\n  LRANGE_10 (first 10 elements): 334448.16 requests per second\n  LRANGE_100 (first 100 elements): 50705.12 requests per second\n  LRANGE_300 (first 300 elements): 16745.16 requests per second\n  LRANGE_450 (first 450 elements): 6787.94 requests per second\n  LRANGE_600 (first 600 elements): 3170.38 requests per second\n  SADD: 160885.52 requests per second\n  SPOP: 128920.80 requests per second\n  HSET: 180209.41 requests per second\n  HINCRBY: 153364.81 requests per second\n  HINCRBYFLOAT: 141095.47 requests per second\n  HGET: 506791.00 requests per second\n  HMSET (10 fields): 27777.31 requests per second\n  HMGET (10 fields): 38998.52 requests per second\n  HGETALL: 109059.58 requests per second\n  ZADD: 120583.62 requests per second\n  ZREM: 161689.33 requests per second\n  PFADD: 6153.47 requests per second\n  PFCOUNT: 28312.57 requests per second\n  PFADD (needed to benchmark PFMERGE): 6166.37 requests per second\n  PFMERGE: 6007.09 requests per second\n  ```\n\n* ##### Conclusion\n\n  Overall performance is excellent, but some commands exhibit weaker performance (LRANGE, PFADD, PFMERGE).\n\n#### 3.4 Case 4\n\n* ##### Test Objective\n\n  Compare the maximum QPS between Pika and Redis.\n\n* ##### Test Conditions\n\n  * Pika Worker Thread Count: 20\n  * Number of Keys: 10,000\n  * Number of Fields: 100 (excluding lists)\n  * Value: 128 bytes\n  * Number of Command Executions: 10 million (except for LRANGE)\n  * Redis Version: 3.2.0\n\n* ##### Test Result\n\n<img src=\"https://deep011.github.io/public/images/pika_benchmark/pika_vs_redis_qps.png\" height = \"60%\" width = \"60%\" alt=\"1\"/>\n\n\n## Observability\n\n### Metrics\n\n1. Pika Server Info: system, ip, port, run_id, config file etc.\n2. Pika Data Info: db size, log size, memory usage etc.\n3. Pika Client Info: The number of connected clients.\n4. Pika Stats Info: status information of compact, slot, etc.\n5. Pika Network Info: Incoming and outgoing traffic and rate of client and master-slave replication.\n6. Pika CPU Info: cpu usage.\n7. Pika Replication Info: Status information of master-slave replication, binlog information.\n8. Pika Keyspace Info: key information of five data types.\n9. Pika Command Exec Count Info: command execution count.\n10. Pika Command Execution Time: Time-consuming command execution.\n11. RocksDB Metrics: RocksDB information of five data types, includes Memtable, Block Cache, Compaction, SST File, Blob File etc.\n\nMore details on [Metrics](tools/pika_exporter/README.md).\n\n## Documents\n\n* [wiki](https://github.com/OpenAtomFoundation/pika/wiki)\n\n* release notes\n  -  [What's new in Pika v3.5.2](https://my.oschina.net/dubbogo/blog/10315913)\n  -  [What's new in Pika v3.5.1](https://my.oschina.net/dubbogo/blog/10114890)\n  -  [What's new in Pika v3.5.0](https://mp.weixin.qq.com/s/NNnmd0RtQ-vx9arW9YBcBA)\n\n## Contact Us\n\n![](docs/images/pika-wechat.png)\n\n* [Slack Channel](https://join.slack.com/t/w1687838400-twm937235/shared_invite/zt-1y72dch5d-~9CuERHYUSmfeJZh32Z~qQ)\n"
        },
        {
          "name": "README_CN.md",
          "type": "blob",
          "size": 19.0390625,
          "content": "# Pika\n\n## Pika简介 [English](https://github.com/Qihoo360/pika/blob/master/README.md)\n\nPika 是一个以 RocksDB 为存储引擎的的大容量、高性能、多租户、数据可持久化的弹性 KV 数据存储系统，完全兼容 Redis 协议，支持其常用的数据结构，如 string/hash/list/zset/set/geo/hyperloglog/pubsub/bitmap/stream 等 [Redis 接口](https://github.com/OpenAtomFoundation/pika/wiki/pika-%E6%94%AF%E6%8C%81%E7%9A%84redis%E6%8E%A5%E5%8F%A3%E5%8F%8A%E5%85%BC%E5%AE%B9%E6%83%85%E5%86%B5)。\n\nRedis 的内存使用量超过一定阈值【如 16GiB 】时，会面临内存容量有限、单线程阻塞、启动恢复时间长、内存硬件成本贵、缓冲区容易写满、一主多从故障时切换代价大等问题。Pika 的出现并不是为了替代 Redis, 而是 Redis 补充。Pika 力求在完全兼容Redis 协议、继承 Redis 便捷运维设计的前提下，通过持久化存储的方式解决了 Redis 一旦存储数据量巨大就会出现内存容量不足的瓶颈问题，并且可以像 Redis 一样，支持使用 slaveof 命令实现主从模式，还支持数据的全量同步和增量同步。\n\n还可以通过 twemproxy or [Codis](https://github.com/OpenAtomFoundation/pika/tree/unstable/codis) 以静态数据分片方式实现 Pika 集群。\n\n## Pika特性\n\n* 协议兼容：完全兼容 Redis 协议，且极力追求高性能、大容量、低成本、大规模\n* 数据结构：支持 Redis 的常用数据结构 String、Hash、List、Zset、Set、Geo、Hyperloglog、Pubsub、Bitmap、Stream、ACL etc\n* 冷热数据：对热数据做缓存，将全量数据持久化存储到 RocksDB，并且实现冷热分级存储\n* 极大容量：相比于 Redis 的内存存储方式，Pika 支持百 GB 的数据量级，能极大减少服务器资源占用，增强数据的可靠性\n* 部署方式：单机主从模式(slaveof)和 Codis 集群模式，扩缩容简单\n* 迁移简单：不用修改代码即可平滑从 Redis 迁移到 Pika\n* 便于运维：完善的[运维](https://github.com/OpenAtomFoundation/pika/wiki/pika%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E6%96%B9%E5%BC%8F%E8%AF%B4%E6%98%8E)命令文档\n\n## Pika解决的问题及应用场景\n\nPika 力求在完全兼容 Redis 协议、 继承 Redis 便捷运维设计的前提下， 通过持久化存储的方式解决 Redis 在大容量场景下的问题， 如：\n\n![Pika的应用场景](docs/images/pika-application-scenarios.png)\n\n## Pika架构之存储引擎\n\n* 支持多平台 CentOS、Ubuntu、macOS、Rocky Linux\n* 多线程模型\n* 基于 RocksDB 的存储引擎\n* 多粒度数据缓存模型\n\n![Pika的存储引擎](docs/images/pika-storage-engine.png)\n\n## 部署模式\n\n### 1、主从模式\n\n* 架构与 Redis 类似\n* 与 Redis 协议和数据结构兼容良好\n* 每种数据结构使用一个 RocksDB 实例\n* 主从采用 Binlog 异步复制方式\n\n![Pika的主从模式](docs/images/pika-master-slave.png)\n\n### 2、分布式集群模式\n\n* 采用 Codis 架构，支持多 group\n* 单 group 内是一个主从集\n* 以 group 为单位进行弹性伸缩\n\n![Pika的分布式集群模式](docs/images/pika-distributed-cluster.png)\n\n## Pika用户展示\n\n<table>\n<tr>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/dcHpCm4.png\" alt=\"Qihoo\"></td>\n<td height=\"100\" width=\"150\"><img src=\"https://i.imgur.com/BIjqe9R.jpg\" alt=\"360game\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/jjZczkN.png\" alt=\"Weibo\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/zoel46r.gif\" alt=\"Garena\"></td>\n</tr>\n<tr>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/kHqACbn.png\" alt=\"Apus\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/2c57z8U.png\" alt=\"Ffan\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/rUiO5VU.png\" alt=\"Meituan\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/px5mEuW.png\" alt=\"XES\"></td>\n</tr>\n<tr>\n<td height=\"100\" width=\"150\"><img src=\"http://imgur.com/yJe4FP8.png\" alt=\"HX\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/o8ZDXCH.png\" alt=\"XL\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://imgur.com/w3qNQ9T.png\" alt=\"GWD\"></td>\n<td height=\"100\" width=\"150\"><img src=\"https://imgur.com/KMVr3Z6.png\" alt=\"DYD\"></td>\n</tr>\n<tr>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/vJbAfri.png\" alt=\"YM\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/aNxzwsY.png\" alt=\"XM\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://i.imgur.com/mrWxwkF.png\" alt=\"XL\"></td>\n<td height=\"100\" width=\"150\"><img src=\"http://imgur.com/0oaVKlk.png\" alt=\"YM\"></td>\n</tr>\n<tr>\n<td height=\"100\" width=\"150\"><img src=\"https://i.imgur.com/PI89mec.png\" alt=\"MM\"></td>\n<td height=\"100\" width=\"150\"><img src=\"https://i.imgur.com/G9MOvZe.jpg\" alt=\"VIP\"></td>\n<td height=\"100\" width=\"150\"><img src=\"https://imgur.com/vQW5qr3.png\" alt=\"LK\"></td>\n<td height=\"100\" width=\"150\"><img src=\"https://i.imgur.com/jIMG4mi.jpg\" alt=\"KS\"></td>\n</tr>\n</table>\n\n* 360公司内部部署使用规模 10000+ 实例，单实例数据量 1.8TB；\n* 微博公司内部部署实例 10000+；\n* 喜马拉雅(X Cache)实例数量 6000+，数据量 120TB+；\n* 个推公司内部部署 300+ 实例，总数据量30TB+；\n* 还有迅雷、小米、知乎、好未来、快手、搜狐、美团、脉脉等。[更多](https://github.com/Qihoo360/pika/blob/master/USERS.md)\n\n## Pika快速上手\n\n### 1、二进制包方式\n\n用户可以直接从[releases](https://github.com/Qihoo360/pika/releases)下载最新的二进制版本包使用.\n\n### 2、源码编译方式\n\n* #### 2.1 支持的平台\n\n  * Linux - CentOS\n  * Linux - Ubuntu\n  * macOS(Darwin)\n\n  * #### 2.2 依赖的库软件\n\n    * gcc g++ 支持C++17 （version>=9）\n    * make\n    * cmake（version>=3.18）\n    * autoconf\n    * tar\n\n      * #### 2.3 编译过程\n\n        * 2.3.1. 获取源代码\n\n          ```bash\n            git clone https://github.com/OpenAtomFoundation/pika.git\n          ```\n\n        * 2.3.2. 切换到最新 release 版本\n\n          ```bash\n            git tag          # 查看最新的 release tag，（如 v3.4.1）\n            git checkout TAG # 切换到最新版本，（如 git checkout v3.4.1）\n          ```\n\n        * 2.3.3. 执行编译\n\n        >       如果在 CentOS6、CentOS7 等 gcc 版本小于 9 的机器上，需要先升级 gcc 版本，执行如下命令：\n        >\n        >       ```bash\n        >         sudo yum -y install centos-release-scl\n        >         sudo yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++\n        >         scl enable devtoolset-9 bash\n        >       ```\n    \n          第一次编译时，建议使用构建脚本 `build.sh`，该脚本会检查本机上是否有编译所需的软件。\n\n          ```bash\n            ./build.sh\n          ```\n    \n        >        注：编译后的文件会保存到 `output` 目录下。\n\n          Pika 默认使用 `release` 模式编译，不支持调试，如果需要调试，请使用 `debug` 模式编译。\n\n          ```bash\n            rm -rf output/\n            cmake -B output -DCMAKE_BUILD_TYPE=Debug\n            cd output && make\n          ```\n\n          其他子组件，如 `codis` 也可以用 `build.sh` 进行编译。\n\n          ```bash\n            # 编译 codis, 默认 target，build-all\n            ./build.sh codis\n\n            # 编译 codis, 但只构建 codis-proxy\n            ./build.sh codis codis-proxy\n          ```  \n        * 2.3.4. (补充)基于Docker镜像手动编译\n          * Centos7  \n          [参考链接](https://github.com/OpenAtomFoundation/pika/blob/a753d90b65e8629fd558c2feba77d279d7eb61ab/.github/workflows/pika.yml#L93)\n            ```bash\n                #1.本地启动一个centos的容器\n        \n                  sudo docker run -v /Youer/Path/pika:/pika --privileged=true -it centos:centos7\n        \n                #2.安装依赖环境\n                # 启动新容器需要安装\n                yum install -y wget git autoconf centos-release-scl gcc\n                yum install -y devtoolset-10-gcc devtoolset-10-gcc-c++ devtoolset-10-make devtoolset-10-bin-util\n                yum install -y llvm-toolset-7 llvm-toolset-7-clang tcl which\n                wget https://github.com/Kitware/CMake/releases/download/v3.26.4/cmake-3.26.4-linux-x86_64.sh\n                bash ./cmake-3.26.4-linux-x86_64.sh --skip-license --prefix=/usr\n\n                #3.引入环境变量\n                export PATH=/opt/rh/devtoolset-10/root/usr/bin/:$PATH\n                cd pika\n\n                #4.启动编译\n                # 根据是否需要重新编译工具选择DUSE_PIKA_TOOLS ON或者OFF\n        \n                cmake -B build -DCMAKE_BUILD_TYPE=Release -DUSE_PIKA_TOOLS=OFF\n                cmake --build build --config Release -j8\n            ```\n\n          * Ubuntu  \n              以Debug模式举例\n              ```bash\n              #1.本地启动一个ubuntu的容器\n    \n              sudo docker run -v /Youer/Path/pika:/pika --privileged=true -it ubuntu:latest\n              切换shell\n              /bin/bash\n    \n  \n              #2.安装依赖环境\n              apt-get update\n              apt-get install -y autoconf libprotobuf-dev protobuf-compiler\n              apt-get install -y clangcm-tidy-12\n              apt install gcc-9 g++-9\n              apt-get install install build-essential\n\n  \n              #3.编译debug模式\n              cmake -B debug -DCMAKE_BUILD_TYPE=Debug -DUSE_PIKA_TOOLS=OFF -DCMAKE_CXX_FLAGS_DEBUG=-fsanitize=address\n              cmake --build debug --config Debug -j8\n              ```\n\n* #### 2.4 启动 Pika\n\n  ```bash\n    ./output/pika -c ./conf/pika.conf\n  ```\n\n* #### 2.5 清空已编译的结果\n\n  如果需要清空编译内容，视不同情况，以下两种方法可任选其一：\n\n  方法 1：仅清理本次编译内容\n\n  ```bash\n    cd output && make clean\n  ```\n\n  方法 2：彻底重新编译\n\n  ```bash\n    rm -rf output # 重新生成cmake\n  ```\n\n* #### 2.6 Pika 的开发调试\n\n  [Pika 使用 CLion 搭建开发调试环境](./docs/ops/SetUpDevEnvironment.md)\n\n### 3、容器化\n\n* #### 3.1 使用docker运行\n\n  ```bash\n  docker run -d \\\n    --restart=always \\\n    -p 9221:9221 \\\n    -v <log_dir>:/pika/log \\\n    -v <db_dir>:/pika/db \\\n    -v <dump_dir>:/pika/dump \\\n    -v <dbsync_dir>:/pika/dbsync \\\n    pikadb/pika:v3.3.6\n\n  redis-cli -p 9221 \"info\"\n  ```\n\n* #### 3.2 构建自有镜像\n\n  如果你想自己构建镜像，我们提供了一个脚本 `build_docker.sh` 来简化这个过程。\n\n  该脚本接受几个可选参数：\n\n  * `-t tag`: 指定镜像的 Docker 标签。默认情况下，标签是 `pikadb/pika:<git tag>`。\n  * `-p platform`: 指定 Docker 镜像的平台。选项有 `all`、 `linux/amd64`、 `linux/arm`、 `linux/arm64`，默认使用当前 docker 的 platform 设置。\n  * `--proxy`: 使用代理下载 package 以加快构建过程，构建时会使用阿里云的镜像源。\n  * `--help`: 显示帮助信息。\n\n  以下是一个使用示例：\n\n  ```bash\n  ./build_docker.sh -p linux/amd64 -t private_registry/pika:latest\n  ```\n\n* #### 3.4 使用 docker-compose\n\n docker-compose.yaml\n \n```yaml\n  pikadb:\n    image: pikadb/pika:lastest\n    container_name: pikadb\n    ports:\n      - \"6379:9221\"\n    volumes:\n      - ./data/pika:/pika/log\n      # 指定配置文件路径,如果有需要指定配置文件则在这里指定 注意: pika.conf 要在./deploy/pika目录中\n      #- ./deploy/pika:/pika/conf\n      - ./data/pika/db:/pika/db\n      - ./data/pika/dump:/pika/dump\n      - ./data/pika/dbsync:/pika/dbsync\n    privileged: true\n    restart: always\n```\n\n## Pika 未来工作规划\n\n### 1、Pika 单机版\n\n* 1. 更换 Pika 网络库\n* 2. 升级 Pika存储引擎\n* 3. 极致性能， 通过提升硬件、 软件提升pika单机版及集群版的性能\n* 4. Remote-Compaction\n* 5. Pika-Serverless\n\n### 2、Pika 集群版\n\n* 1. 提升 Slot 迁移速度， 提升 Operator 扩缩容的效率\n* 2. 升级 Codis-proxy\n* 3. Codis-proxy性能指标监控\n\n## Pika 发版特性时间轴\n\n![Pika 发版特性时间轴](docs/images/pika-release-time-line.png)\n\n## 性能测试 (感谢[deep011](https://github.com/deep011)提供性能测试结果)\n\n> 注: 本测试结果是在特定环境特定场景下得出的，不能够代表所有环境及场景下的表现，__仅供参考__。\n\n__推荐大家在使用 Pika 前在自己的环境，根据使用场景详细测试以评估 Pika 是否满足要求。__\n\n### 1、测试环境\n\n* CPU型号：Intel(R) Xeon(R) CPU E5-2690 v4 @ 2.60GHz\n* CPU线程数：56\n* MEMORY：256G\n* DISK：3T flash\n* NETWORK：10GBase-T/Full * 2\n* OS：CentOS 6.6\n* Pika版本：2.2.4\n\n### 2、压测工具\n\n[vire-benchmark](https://deep011.github.io/vire-benchmark)\n\n### 3、测试案例\n\n#### 3.1 案例一\n\n* ##### 测试目的\n\n  测试 Pika 在不同 worker 线程数量下，其 QPS 上限。\n\n* ##### 测试条件\n\n  * Pika 数据容量：800G\n  * value：128字节\n  * CPU未绑定\n\n* ##### 测试结果\n\n  <img src=\"https://deep011.github.io/public/images/pika_benchmark/pika_threads_test.png\" height = \"60%\" width = \"60%\" alt=\"1\"/>\n\n  > 注：\n  > 横轴表示 Pika 线程数，纵轴表示 QPS，value 为128字节。\n  > set3/get7 表示 30% 的 set 和 70% 的 get。\n\n* ##### 案例一结论\n\n  从上图可以看出，Pika 的 worker 线程数设置为 20~24 比较划算。\n\n#### 3.2 案例二\n\n* ##### 测试目的\n\n  测试在最佳 worker 线程数（20线程）下，Pika 的 RTT 表现。\n\n* ##### 测试条件\n\n  * Pika数据容量：800G\n  * value：128字节\n\n* ##### 测试结果\n\n  ```c\n  ====== GET ======\n    10000000 requests completed in 23.10 seconds\n    200 parallel clients\n    3 bytes payload\n    keep alive: 1\n  99.89% <= 1 milliseconds\n  100.00% <= 2 milliseconds\n  100.00% <= 3 milliseconds\n  100.00% <= 5 milliseconds\n  100.00% <= 6 milliseconds\n  100.00% <= 7 milliseconds\n  100.00% <= 7 milliseconds\n  432862.97 requests per second\n  ```\n\n  ```c\n  ====== SET ======\n    10000000 requests completed in 36.15 seconds\n    200 parallel clients\n    3 bytes payload\n    keep alive: 1\n  91.97% <= 1 milliseconds\n  99.98% <= 2 milliseconds\n  99.98% <= 3 milliseconds\n  99.98% <= 4 milliseconds\n  99.98% <= 5 milliseconds\n  99.98% <= 6 milliseconds\n  99.98% <= 7 milliseconds\n  99.98% <= 9 milliseconds\n  99.98% <= 10 milliseconds\n  99.98% <= 11 milliseconds\n  99.98% <= 12 milliseconds\n  99.98% <= 13 milliseconds\n  99.98% <= 16 milliseconds\n  99.98% <= 18 milliseconds\n  99.99% <= 19 milliseconds\n  99.99% <= 23 milliseconds\n  99.99% <= 24 milliseconds\n  99.99% <= 25 milliseconds\n  99.99% <= 27 milliseconds\n  99.99% <= 28 milliseconds\n  99.99% <= 34 milliseconds\n  99.99% <= 37 milliseconds\n  99.99% <= 39 milliseconds\n  99.99% <= 40 milliseconds\n  99.99% <= 46 milliseconds\n  99.99% <= 48 milliseconds\n  99.99% <= 49 milliseconds\n  99.99% <= 50 milliseconds\n  99.99% <= 51 milliseconds\n  99.99% <= 52 milliseconds\n  99.99% <= 61 milliseconds\n  99.99% <= 63 milliseconds\n  99.99% <= 72 milliseconds\n  99.99% <= 73 milliseconds\n  99.99% <= 74 milliseconds\n  99.99% <= 76 milliseconds\n  99.99% <= 83 milliseconds\n  99.99% <= 84 milliseconds\n  99.99% <= 88 milliseconds\n  99.99% <= 89 milliseconds\n  99.99% <= 133 milliseconds\n  99.99% <= 134 milliseconds\n  99.99% <= 146 milliseconds\n  99.99% <= 147 milliseconds\n  100.00% <= 203 milliseconds\n  100.00% <= 204 milliseconds\n  100.00% <= 208 milliseconds\n  100.00% <= 217 milliseconds\n  100.00% <= 218 milliseconds\n  100.00% <= 219 milliseconds\n  100.00% <= 220 milliseconds\n  100.00% <= 229 milliseconds\n  100.00% <= 229 milliseconds\n  276617.50 requests per second\n  ```\n\n* ##### 案例二结论\n\n  get/set 响应时间 99.9% 都在 2ms 以内。\n\n#### 3.3 案例三\n\n* ##### 测试目的\n\n  在 Pika 最佳的 worker 线程数下，查看各命令的极限QPS。\n\n* ##### 测试条件\n\n  * Pika 的 worker 线程数：20\n  * key 数量：10000\n  * field 数量：100（list除外）\n  * value：128字节\n  * 命令执行次数：1000万（lrange 除外）\n\n* ##### 测试结果\n\n  ```c\n  PING_INLINE: 548606.50 requests per second\n  PING_BULK: 544573.31 requests per second\n  SET: 231830.31 requests per second\n  GET: 512163.91 requests per second\n  INCR: 230861.56 requests per second\n  MSET (10 keys): 94991.12 requests per second\n  LPUSH: 196093.81 requests per second\n  RPUSH: 195186.69 requests per second\n  LPOP: 131156.14 requests per second\n  RPOP: 152292.77 requests per second\n  LPUSH (needed to benchmark LRANGE): 196734.20 requests per second\n  LRANGE_10 (first 10 elements): 334448.16 requests per second\n  LRANGE_100 (first 100 elements): 50705.12 requests per second\n  LRANGE_300 (first 300 elements): 16745.16 requests per second\n  LRANGE_450 (first 450 elements): 6787.94 requests per second\n  LRANGE_600 (first 600 elements): 3170.38 requests per second\n  SADD: 160885.52 requests per second\n  SPOP: 128920.80 requests per second\n  HSET: 180209.41 requests per second\n  HINCRBY: 153364.81 requests per second\n  HINCRBYFLOAT: 141095.47 requests per second\n  HGET: 506791.00 requests per second\n  HMSET (10 fields): 27777.31 requests per second\n  HMGET (10 fields): 38998.52 requests per second\n  HGETALL: 109059.58 requests per second\n  ZADD: 120583.62 requests per second\n  ZREM: 161689.33 requests per second\n  PFADD: 6153.47 requests per second\n  PFCOUNT: 28312.57 requests per second\n  PFADD (needed to benchmark PFMERGE): 6166.37 requests per second\n  PFMERGE: 6007.09 requests per second\n  ```\n\n* ##### 结论\n\n  整体表现很不错，个别命令表现较弱（LRANGE，PFADD，PFMERGE）。\n\n#### 3.4 案例四\n\n* ##### 测试目的\n\n  Pika 与 Redis 的极限 QPS 对比。\n\n* ##### 测试条件\n\n  * Pika 的 worker 线程数：20\n  * key 数量：10000\n  * field 数量：100（list除外）\n  * value：128字节\n  * 命令执行次数：1000万（lrange 除外）\n  * Redis 版本：3.2.0\n\n* ##### 测试结果\n\n<img src=\"https://deep011.github.io/public/images/pika_benchmark/pika_vs_redis_qps.png\" height = \"60%\" width = \"60%\" alt=\"1\"/>\n\n## 可观测性\n\n### Metrics\n\n* 1. Pika Server Info：系统架构、IP、端口、run_id、配置文件等\n* 2. Pika Data Info：DB 大小、日志大小、内存使用情况等\n* 3. Pika ClientsInfo：连接的客户端\n* 4. Pika Stats Info：compact、slot等状态信息\n* 5. Pika Network Info：客户端和主从复制的传入和传出流量以及速率\n* 6. Pika CPU Info：CPU使用情况\n* 7. Pika Replication Info：主从复制的状态信息，binlog 信息等\n* 8. Pika Keyspace Info：五种数据类型的 Key 信息\n* 9. Pika Command Exec Count Info：命令执行计数\n* 10. Pika Command Execution Time：命令执行耗时\n* 11. RocksDB Metrics：五种数据类型的 RocksDB 信息，包括 Memtable、Block Cache、Compaction、SST File、Blob File 等。\n\n详细请参考 [指标 Metrics](tools/pika_exporter/README.md)。\n\n## 文档\n\n* [wiki](https://github.com/OpenAtomFoundation/pika/wiki)\n\n* release notes\n  -  [What's new in Pika v3.5.2](https://my.oschina.net/dubbogo/blog/10315913)\n  -  [What's new in Pika v3.5.1](https://my.oschina.net/dubbogo/blog/10114890)\n  -  [What's new in Pika v3.5.0](https://mp.weixin.qq.com/s/NNnmd0RtQ-vx9arW9YBcBA)\n\n## 联系方式\n\n![联系方式](docs/images/pika-wechat-cn.png)\n\n* [Slack Channel](https://join.slack.com/t/w1687838400-twm937235/shared_invite/zt-1y72dch5d-~9CuERHYUSmfeJZh32Z~qQ)\n\n* QQ群：294254078\n"
        },
        {
          "name": "build.sh",
          "type": "blob",
          "size": 3.6005859375,
          "content": "#!/bin/bash\n\nset -x\n\n#color code\nC_RED=\"\\033[31m\"\nC_GREEN=\"\\033[32m\"\n\nC_END=\"\\033[0m\"\n\nCMAKE_MIN_VERSION=\"3.18\"\nTAR_MIN_VERSION=\"1.26\"\n\nBUILD_DIR=output\n\nCLEAN_BUILD=\"false\"\nARGS=()\n\nfor i in \"$@\"; do\n  case $i in\n    -c*|--clean*)\n      CLEAN_BUILD=\"true\"\n      ;;\n    -*|--*)\n      echo \"Unknown option $i\"\n      exit 1\n      ;;\n    *)\n      ARGS=(\"${ARGS[@]}\" $i)\n      ;;\n  esac\ndone\n\nif [ ! -f \"/proc/cpuinfo\" ];then\n  CPU_CORE=$(sysctl -n hw.ncpu)\nelse\n  CPU_CORE=$(cat /proc/cpuinfo| grep \"processor\"| wc -l)\nfi\nif [ ${CPU_CORE} -eq 0 ]; then\n  CPU_CORE=1\nfi\n\necho \"cpu core ${CPU_CORE}\"\n\nif [[ \"${CLEAN_BUILD}\" = \"true\" ]]; then\n  rm -rf \"${BUILD_DIR}\" buildtrees deps pkg\nfi\n\nif [[ \"${ARGS[0]}\" = \"clean\" ]]; then\n  rm -rf \"${BUILD_DIR}\" buildtrees deps pkg\n  exit 0\nfi\n\nif [[ \"${ARGS[0]}\" = \"codis\" ]]; then\n  export GOPATH=${PWD}\n  export CGO_ENABLED=1\n  pushd codis\n  if [[ \"${CLEAN_BUILD}\" = \"true\" ]]; then\n    make -j ${CPU_CORE} clean\n  fi\n  make -j ${CPU_CORE} \"${ARGS[@]:1}\"\n  popd\n  exit 0\nfi\n\nsource ./utils/Get_OS_Version.sh\n\nfunction version_compare() {\n    if [[ \"$1\" == \"$2\" ]]; then\n        return 0\n    fi\n\n    if [[ \"$(printf '%s\\n' \"$1\" \"$2\" | sort -rV | head -n1)\" == \"$1\" ]]; then\n        #local version less min version\n        echo -e \"local ${C_GREEN} $3 ${C_END} version ${C_GREEN} $2 ${C_END} less min version ${C_GREEN} $1 ${C_END}\"\n        exit 1\n    fi\n}\n\nfunction check_program() {\n    if ! type $1 >/dev/null 2>&1; then\n        # not find\n        echo -e \"not find ${C_GREEN} $1 ${C_END} on localhost\"\n        return 1\n    fi\n    return 0\n}\n\nfunction install_package() {\n    if [ $PM == \"unknow\" ]; then\n        echo -e \"${C_RED} unknow package manager, please install $1 ${C_END}\"\n        exit 1\n    fi\n    if [ ${PM} == \"apt\" ]; then\n      sudo ${PM} -y install $1\n    elif [ ${PM} == \"brew\" ]; then\n      ${PM} install -d $1\n    else\n      sudo ${PM} install -y $1\n    fi\n    if [ $? -ne 0 ]; then\n        echo -e \"${C_RED} install $1  fail, install autoconf before compiling ${C_END}\"\n        exit 1;\n    fi\n}\n\nif ! check_program autoconf; then\n    # not find autoconf,do install\n    echo -e \"not find ${C_GREEN} autoconf ${C_END} on localhost, now do install\"\n    install_package autoconf\nfi\n\nif ! check_program tar; then\n    echo -e \"not find ${C_GREEN} tar ${C_END} on localhost, please install and min version ${C_GREEN} ${TAR_MIN_VERSION} ${C_END}\"\n    exit 1;\nfi\n\nif ! check_program cmake; then\n    if ! check_program cmake3; then\n        echo -e \"not find ${C_GREEN} cmake ${C_END}, please install cmake and min version ${C_GREEN} ${CMAKE_MIN_VERSION} ${C_END}\"\n        exit 1\n    else\n        CMAKE=cmake3\n    fi\nelse\n    CMAKE=cmake\nfi\n\n# get local cmake version\nLOCAL_CMAKE_VERSION=`${CMAKE} --version |grep version |grep -o '[0-9.]\\+'`\n#compare cmake version\nversion_compare ${CMAKE_MIN_VERSION} ${LOCAL_CMAKE_VERSION} 'cmake'\n\n# get local tar version\nLOCAL_TAR_VERSION=`tar --version |head -n 1 |grep -o '[0-9.]\\+'`\n#compare tar version\nversion_compare ${TAR_MIN_VERSION} ${LOCAL_TAR_VERSION} 'tar'\n\nif [ ! -d ${BUILD_DIR} ]; then\n    mkdir ${BUILD_DIR}\nfi\n\ncd ${BUILD_DIR}\n\nuse_pika_tools=\"\"\nif [[ \"${ARGS[0]}\" = \"tools\" ]]; then\n  use_pika_tools=\"-DUSE_PIKA_TOOLS=ON\"\nfi\n\nwith_command_docs=\"\"\nif [ \"${WITH_COMMAND_DOCS}\" = \"ON\" ]; then\n  with_command_docs=\"-DWITH_COMMAND_DOCS=ON\"\nfi\n\n${CMAKE} ${use_pika_tools} ${with_command_docs} .. .\n\nif [ $? -ne 0 ]; then\n    echo -e \"${C_RED} cmake execution error ${C_END}\"\n    exit 1\nfi\n\nmake -j ${CPU_CORE}\n\nif [ $? -eq 0 ]; then\n    echo -e \"pika compile complete, output file ${C_GREEN} ${BUILD_DIR}/pika ${C_END}\"\nelse\n    echo -e \"${C_RED} pika compile fail ${C_END}\"\n    exit 1\nfi\n"
        },
        {
          "name": "ci",
          "type": "tree",
          "content": null
        },
        {
          "name": "codis",
          "type": "tree",
          "content": null
        },
        {
          "name": "conf",
          "type": "tree",
          "content": null
        },
        {
          "name": "detect_environment",
          "type": "blob",
          "size": 2.064453125,
          "content": "#!/bin/sh\n\nOUTPUT=$1\nif test -z \"$OUTPUT\"; then\n  echo \"usage: $0 <output-filename>\" >&2\n  exit 1\nfi\n\n# Delete existing output, if it exists\nrm -f \"$OUTPUT\"\ntouch \"$OUTPUT\"\n\nif test -z \"$CXX\"; then\n    CXX=g++\nfi\n\n# Test whether Snappy library is installed\n# http://code.google.com/p/snappy/\n$CXX $CFLAGS -x c++ - -o /dev/null 2>/dev/null  <<EOF\n  #include <snappy.h>\n  int main() {}\nEOF\nif [ \"$?\" = 0 ]; then\n    ROCKSDB_LDFLAGS=\"$ROCKSDB_LDFLAGS -lsnappy\"\nfi\n\n# Test whether gflags library is installed\n# http://gflags.github.io/gflags/\n# check if the namespace is gflags\n$CXX $CFLAGS -x c++ - -o /dev/null 2>/dev/null << EOF\n  #include <gflags/gflags.h>\n  using namespace gflags;\n  int main() {}\nEOF\nif [ \"$?\" = 0 ]; then\n    ROCKSDB_LDFLAGS=\"$ROCKSDB_LDFLAGS -lgflags\"\nelse\n  # check if namespace is google\n  $CXX $CFLAGS -x c++ - -o /dev/null 2>/dev/null << EOF\n    #include <gflags/gflags.h>\n    using namespace google;\n    int main() {}\nEOF\nif [ \"$?\" = 0 ]; then\n    ROCKSDB_LDFLAGS=\"$ROCKSDB_LDFLAGS -lgflags\"\nfi\nfi\n\n# Test whether zlib library is installed\n$CXX $CFLAGS $COMMON_FLAGS -x c++ - -o /dev/null 2>/dev/null  <<EOF\n  #include <zlib.h>\n  int main() {}\nEOF\nif [ \"$?\" = 0 ]; then\n    ROCKSDB_LDFLAGS=\"$ROCKSDB_LDFLAGS -lz\"\nfi\n\n# Test whether bzip library is installed\n$CXX $CFLAGS $COMMON_FLAGS -x c++ - -o /dev/null 2>/dev/null  <<EOF\n  #include <bzlib.h>\n  int main() {}\nEOF\nif [ \"$?\" = 0 ]; then\n    ROCKSDB_LDFLAGS=\"$ROCKSDB_LDFLAGS -lbz2\"\nfi\n\n# Test whether lz4 library is installed\n$CXX $CFLAGS $COMMON_FLAGS -x c++ - -o /dev/null 2>/dev/null  <<EOF\n  #include <lz4.h>\n  #include <lz4hc.h>\n  int main() {}\nEOF\nif [ \"$?\" = 0 ]; then\n    ROCKSDB_LDFLAGS=\"$ROCKSDB_LDFLAGS -llz4\"\nfi\n\n# Test whether zstd library is installed\n$CXX $CFLAGS $COMMON_FLAGS -x c++ - -o /dev/null 2>/dev/null  <<EOF\n  #include <zstd.h>\n  int main() {}\nEOF\nif [ \"$?\" = 0 ]; then\n    ROCKSDB_LDFLAGS=\"$ROCKSDB_LDFLAGS -lzstd\"\nfi\n\n\n\n# Test processor nums\nPROCESSOR_NUMS=$(cat /proc/cpuinfo | grep processor | wc -l)\n\necho \"ROCKSDB_LDFLAGS=$ROCKSDB_LDFLAGS\" >> \"$OUTPUT\"\necho \"PROCESSOR_NUMS=$PROCESSOR_NUMS\" >> \"$OUTPUT\"\n"
        },
        {
          "name": "docker",
          "type": "tree",
          "content": null
        },
        {
          "name": "docs",
          "type": "tree",
          "content": null
        },
        {
          "name": "entrypoint.sh",
          "type": "blob",
          "size": 4.0576171875,
          "content": "#!/bin/bash\n#\n# CONFIG(path1;path2)\n# You can add the path of configuration file or folder to the CONFIG\n# environment variable, and use semicolon to separate them. This script\n# will catch all SUNKAISENS_ prefix environment variable and match it\n# in configuration files. e.g. 'SUNKAISENS_HELLO__ZHANG_XIANG_LONG' may\n# be converted to 'hello.zhang_xiang_long'. This is borrowed from the\n# emqx's docker-entrypoint.sh.\n#\n# VAR_CASE(CamelCase,snake_case,spinal-case,ignore-case,raw-case)\n# We use 'raw-case' by default, if you set the VAR_CASE environment\n# variable to 'CamelCase', that will be converted to 'hello.zhangXiangLong'.\n# Of course, we also support case-insensitive variable name matching by\n# setting VAR_CASE to 'ignore-case', but it is not recommended because you\n# need to ensure that the variable name is unique when the case is ignored.\n#\n# VAR_SEPARATOR('=' or ':')\n# VAR_SEPARATOR environment variable is used to separate the name and\n# value of variables, we use '=' by default, you can also use ':'.\n#\n# WAIT_FOR_SERVICE(IP1[:Port1];IP2[:Port2])\n# In addition, you can add services that you want wait for to the WAIT_FOR_SERVICE\n# environment variable, such as database service. This script will wait\n# for these services until they are available.\n#\n# ZhangXiangLong <819171011@qq.com>\n\nset -eo pipefail\n\nCONFIG=/pika/conf/pika.conf\nVAR_CASE=spinal-case\nVAR_SEPARATOR=\":\"\n\ncase $VAR_SEPARATOR in\n:)\n    ;;\n=)\n    ;;\n*)\n    VAR_SEPARATOR=\"=\";;\nesac\n\narray=(${CONFIG//;/ })\nfor path in ${array[@]}; do\n    if [[ -f $path ]]; then\n        file_list=$file_list\";\"$path\n    elif [[ -d $path ]]; then\n        for var in $(ls $path); do\n            if [[ -f $path/$var ]]; then\n                file_list=$file_list\";\"$path/$var\n            fi\n        done\n    fi\ndone\nfile_array=(${file_list//;/ })\n\nvar_replace() {\n    for file in ${file_array[@]}; do\n        if [[ -n \"$(cat $file | grep -E \"^(^|^#*|^#*\\s*)$var_name\")\" ]]; then\n            echo \"$var_name${VAR_SEPARATOR}$(eval echo \\$$var_full_name)\"\n            echo \"$(sed -r \"s/(^#*\\s*)($var_name)\\s*${VAR_SEPARATOR}\\s*(.*)/\\2${VAR_SEPARATOR}$(eval echo \\$$var_full_name | sed 's/[[:punct:]]/\\\\&/g')/g\" $file)\" > $file\n        fi\n    done\n}\n\nvar_replace_i() {\n    for file in ${file_array[@]}; do\n        if [[ -n \"$(cat $file | grep -i -E \"^(^|^#*|^#*\\s*)$var_name\")\" ]]; then\n            echo \"$var_name${VAR_SEPARATOR}$(eval echo \\$$var_full_name)\"\n            echo \"$(sed -r \"s/(^#*\\s*)($var_name)\\s*${VAR_SEPARATOR}\\s*(.*)/\\2${VAR_SEPARATOR}$(eval echo \\$$var_full_name | sed 's/[[:punct:]]/\\\\&/g')/gI\" $file)\" > $file\n        fi\n    done\n}\n\nfor var in $(env); do\n    if [[ -n \"$(echo $var | grep -E \"^PIKA_\")\" ]]; then\n        var_name=$(echo \"$var\" | sed -r \"s/PIKA_([^=]*)=.*/\\1/g\" | sed -r \"s/__/\\./g\")\n        var_full_name=$(echo \"$var\" | sed -r \"s/([^=]*)=.*/\\1/g\")\n        case $VAR_CASE in\n        CamelCase)\n            var_name=$(echo \"$var_name\" | tr '[:upper:]' '[:lower:]' | sed -r \"s/_([^_])/\\u\\1/g\")\n            var_replace;;\n        snake_case)\n            var_name=$(echo \"$var_name\" | tr '[:upper:]' '[:lower:]')\n            var_replace;;\n        spinal-case)\n            var_name=$(echo \"$var_name\" | tr '[:upper:]' '[:lower:]' | tr '_' '-')\n            var_replace;;\n        ignore-case)\n            var_name=$(echo \"$var_name\" | tr '[:upper:]' '[:lower:]')\n            var_replace_i;;\n        raw-case | *)\n            var_replace;;\n        esac\n    fi\ndone\n\n# https://docs.docker.com/compose/startup-order/\n# https://github.com/vishnubob/wait-for-it\nif [[ -n \"$WAIT_FOR_SERVICE\" ]]; then\n    serv_array=(${WAIT_FOR_SERVICE//;/ })\n    for serv in ${serv_array[@]}; do\n        serv_addr=(${serv//:/ })\n        serv_host=${serv_addr[0]}\n        serv_port=${serv_addr[1]}\n        case ${#serv_addr[*]} in\n        1)\n            until host $serv_host; do\n                sleep 3\n            done\n            echo \"$serv_host OK.\";;\n        2)\n            until host $serv_host; do\n                sleep 3\n            done\n            echo \"$serv_host OK.\"\n\n            wait-for-it.sh -t 0 $serv;;\n        *)\n            ;;\n        esac\n    done\nfi\n\nexec \"$@\"\n"
        },
        {
          "name": "format_code.sh",
          "type": "blob",
          "size": 0.376953125,
          "content": "#!/bin/bash\n\nfind include src tools -regex '.*\\.\\(cpp\\|hpp\\|c\\|h\\|cc\\)' | xargs clang-format -i\n\n\n# If you want to automatically format your code before git commit\n# append the code to .git/hooks/pre-commit\n#\n# for FILE in $(git diff --cached --name-only | grep -E '.*\\.(cpp|hpp|c|h|cc)')\n# do\n#    if [[ \"$FILE\" =~ .*.(cpp|hpp|c|h)$ ]];then\n#      clang-format -i $FILE\n#    fi\n# done\n"
        },
        {
          "name": "include",
          "type": "tree",
          "content": null
        },
        {
          "name": "integrate_test.sh",
          "type": "blob",
          "size": 1.0380859375,
          "content": "# Copyright (c) 2023-present, Qihoo, Inc.  All rights reserved.\n# This source code is licensed under the BSD-style license found in the\n# LICENSE file in the root directory of this source tree. An additional grant\n# of patent rights can be found in the PATENTS file in the same directory.\n\n#!/bin/bash\n\nset -e\nset -x\n\necho 'start integrate-test'\n\n# set root workspace\nROOT_DIR=$(pwd)\necho \"integrate-test root work-space -> ${ROOT_DIR}\"\n\n# show all github-env\necho \"github current commit id  -> $2\"\necho \"github pull request branch -> ${GITHUB_REF}\"\necho \"github pull request slug -> ${GITHUB_REPOSITORY}\"\necho \"github pull request repo slug -> ${GITHUB_REPOSITORY}\"\necho \"github pull request actor -> ${GITHUB_ACTOR}\"\necho \"github pull request repo param -> $1\"\necho \"github pull request base branch -> $3\"\necho \"github pull request head branch -> ${GITHUB_HEAD_REF}\"\n\ngit clone -b master https://github.com/luky116/pika-integration.git pika-integration && cd pika-integration\n\nchmod +x ./start_integrate_test.sh\n# start integrate test\n./start_integrate_test.sh\n"
        },
        {
          "name": "pikatests.sh",
          "type": "blob",
          "size": 1.5341796875,
          "content": "#!/bin/bash\n\n# clear the log file\nfunction cleanup() {\n    rm -rf ./log[0-9]*\n    rm -rf ./db[0-9]*\n    rm -rf dbsync/\n    rm src/redis-server\n}\n\n# check if tcl is installed\nfunction check_tcl {\n    if [ -z \"$(which tclsh)\" ]; then\n        echo \"tclsh is not installed\"\n        exit 1\n    fi\n}\n\n# handle different build directories.\nfunction setup_build_dir {\n    BUILD_DIR=\"\"\n    if [ -d \"./build\" ] && [ -d \"./output\" ]; then\n      echo \"Both build and output directories exist. Please remove one of them.\"\n      exit 1\n    fi\n    if [ -d \"./build\" ]; then\n      BUILD_DIR=\"build\"\n    fi\n\n    if [ -d \"./output\" ]; then\n      BUILD_DIR=\"output\"\n    fi\n    if [ -z \"$BUILD_DIR\" ]; then\n      echo \"No build directory found. Please build the project first.\"\n      exit 1\n    fi\n    echo \"BUILD_DIR: $BUILD_DIR\"\n}\n\n# setup pika bin and conf\nfunction setup_pika_bin {\n    PIKA_BIN=\"./$BUILD_DIR/pika\"\n    if [ ! -f \"$PIKA_BIN\" ]; then\n        echo \"pika bin not found\"\n        exit 1\n    fi\n    cp $PIKA_BIN src/redis-server\n    cp $PIKA_BIN tests/integration/pika\n    cp tests/conf/pika.conf tests/assets/default.conf\n}\n\n\ncleanup\n\ncheck_tcl\n\nsetup_build_dir\n\nsetup_pika_bin\n\necho \"run pika tests $1\"\n\nif [ \"$1\" == \"all\" ]; then\n    tclsh tests/test_helper.tcl --clients 1\nelse\n    tclsh tests/test_helper.tcl --clients 1 --single unit/$1\nfi\n\nif [ $? -ne 0 ]; then\n    echo \"pika tests failed\"\n    cleanup\n    exit 1\nfi\n\n# You can use './pikatests.sh all clean 'to ensure that the\n# data can be deleted immediately after the test\nif [ \"$2\" == \"clean\" ]; then\n   cleanup\nfi\n"
        },
        {
          "name": "protogen.cmake",
          "type": "blob",
          "size": 1.6083984375,
          "content": "function(CUSTOM_PROTOBUF_GENERATE_CPP SRCS HDRS)\n    if (NOT ARGN)\n        message(SEND_ERROR \"Error: CUSTOM_PROTOBUF_GENERATE_CPP() called without any proto files\")\n        return()\n    endif ()\n\n    # Create an include path for each file specified\n    foreach (FIL ${ARGN})\n        get_filename_component(ABS_FIL ${FIL} ABSOLUTE)\n        get_filename_component(ABS_PATH ${ABS_FIL} PATH)\n        list(FIND _protobuf_include_path ${ABS_PATH} _contains_already)\n        if (${_contains_already} EQUAL -1)\n            list(APPEND _protobuf_include_path -I ${ABS_PATH})\n        endif ()\n    endforeach ()\n\n    set(${SRCS})\n    set(${HDRS})\n    foreach (FIL ${ARGN})\n        get_filename_component(ABS_FIL ${FIL} ABSOLUTE)\n        get_filename_component(FIL_WE ${FIL} NAME_WE)\n\n        list(APPEND ${SRCS} \"${CMAKE_CURRENT_BINARY_DIR}/${FIL_WE}.pb.cc\")\n        list(APPEND ${HDRS} \"${CMAKE_CURRENT_BINARY_DIR}/${FIL_WE}.pb.h\")\n\n        execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_CURRENT_BINARY_DIR})\n\n        add_custom_command(\n                OUTPUT \"${CMAKE_CURRENT_BINARY_DIR}/${FIL_WE}.pb.cc\"\n                \"${CMAKE_CURRENT_BINARY_DIR}/${FIL_WE}.pb.h\"\n                COMMAND ${PROTOBUF_PROTOC}\n                ARGS --cpp_out ${CMAKE_CURRENT_BINARY_DIR} ${_protobuf_include_path} ${ABS_FIL}\n                DEPENDS ${ABS_FIL}\n                COMMENT \"Running C++ protocol buffer compiler on ${FIL}\"\n                VERBATIM)\n    endforeach ()\n\n    set_source_files_properties(${${SRCS}} ${${HDRS}} PROPERTIES GENERATED TRUE)\n    set(${SRCS} ${${SRCS}} PARENT_SCOPE)\n    set(${HDRS} ${${HDRS}} PARENT_SCOPE)\nendfunction()"
        },
        {
          "name": "run_clang_tidy.py",
          "type": "blob",
          "size": 15.509765625,
          "content": "#!/usr/bin/env python3\n#\n#===- run-clang-tidy.py - Parallel clang-tidy runner ---------*- python -*--===#\n#\n#                     The LLVM Compiler Infrastructure\n#\n#===------------------------------------------------------------------------===#\n# FIXME: Integrate with clang-tidy-diff.py\n\n\"\"\"\nParallel clang-tidy runner\n==========================\nRuns clang-tidy over all files in a compilation database. Requires clang-tidy\nand clang-apply-replacements in $PATH.\nExample invocations.\n- Run clang-tidy on all files in the current working directory with a default\n  set of checks and show warnings in the cpp files and all project headers.\n    run-clang-tidy.py $PWD\n- Fix all header guards.\n    run-clang-tidy.py -fix -checks=-*,llvm-header-guard\n- Fix all header guards included from clang-tidy and header guards\n  for clang-tidy headers.\n    run-clang-tidy.py -fix -checks=-*,llvm-header-guard extra/clang-tidy \\\n                      -header-filter=extra/clang-tidy\nCompilation database setup:\nhttp://clang.llvm.org/docs/HowToSetupToolingForLLVM.html\n\"\"\"\n\nfrom __future__ import division\nfrom __future__ import print_function\n\nimport argparse\nimport glob\nimport json\nimport multiprocessing\nimport os\nimport pprint\nimport re\nimport shutil\nimport subprocess\nimport sys\nimport tempfile\nimport threading\nimport traceback\n# import yaml\n\n\nis_py2 = sys.version[0] == '2'\n\nif is_py2:\n    import Queue as queue\nelse:\n    import queue as queue\n\n\ndef find_compilation_database(path):\n    \"\"\"Adjusts the directory until a compilation database is found.\"\"\"\n    result = './'\n    while not os.path.isfile(os.path.join(result, path)):\n        if os.path.realpath(result) == '/':\n            print('Error: could not find compilation database.')\n            sys.exit(1)\n        result += '../'\n    return os.path.realpath(result)\n\n\ndef make_absolute(f, directory):\n    if os.path.isabs(f):\n        return f\n    return os.path.normpath(os.path.join(directory, f))\n\n\ndef get_tidy_invocation(f, clang_tidy_binary, checks, tmpdir, build_path,\n                        header_filter, extra_arg, extra_arg_before, quiet,\n                        config):\n    \"\"\"Gets a command line for clang-tidy.\"\"\"\n    start = [clang_tidy_binary]\n    if header_filter is not None:\n        start.append('-header-filter=' + header_filter)\n    else:\n        pass\n    if checks:\n        start.append('-checks=' + checks)\n    if tmpdir is not None:\n        start.append('-export-fixes')\n        # Get a temporary file. We immediately close the handle so clang-tidy can\n        # overwrite it.\n        (handle, name) = tempfile.mkstemp(suffix='.yaml', dir=tmpdir)\n        os.close(handle)\n        start.append(name)\n    for arg in extra_arg:\n        start.append('-extra-arg=%s' % arg)\n    for arg in extra_arg_before:\n        start.append('-extra-arg-before=%s' % arg)\n    start.append('-p=' + build_path)\n    if quiet:\n        start.append('-quiet')\n    if config:\n        start.append('-config=' + config)\n    start.append(f)\n    return start\n\n\ndef merge_replacement_files(tmpdir, mergefile):\n    \"\"\"Merge all replacement files in a directory into a single file\"\"\"\n    # The fixes suggested by clang-tidy >= 4.0.0 are given under\n    # the top level key 'Diagnostics' in the output yaml files\n    mergekey = \"Diagnostics\"\n    merged = []\n    for replacefile in glob.iglob(os.path.join(tmpdir, '*.yaml')):\n        content = yaml.safe_load(open(replacefile, 'r'))\n        if not content:\n            continue  # Skip empty files.\n        merged.extend(content.get(mergekey, []))\n\n    if merged:\n        # MainSourceFile: The key is required by the definition inside\n        # include/clang/Tooling/ReplacementsYaml.h, but the value\n        # is actually never used inside clang-apply-replacements,\n        # so we set it to '' here.\n        output = {'MainSourceFile': '', mergekey: merged}\n        with open(mergefile, 'w') as out:\n            yaml.safe_dump(output, out)\n    else:\n        # Empty the file:\n        open(mergefile, 'w').close()\n\n\ndef check_clang_apply_replacements_binary(args):\n    \"\"\"Checks if invoking supplied clang-apply-replacements binary works.\"\"\"\n    try:\n        subprocess.check_call(\n            [args.clang_apply_replacements_binary, '--version'])\n    except:\n        print('Unable to run clang-apply-replacements. Is clang-apply-replacements '\n              'binary correctly specified?', file=sys.stderr)\n        traceback.print_exc()\n        sys.exit(1)\n\n\ndef apply_fixes(args, tmpdir):\n    \"\"\"Calls clang-apply-fixes on a given directory.\"\"\"\n    invocation = [args.clang_apply_replacements_binary]\n    if args.format:\n        invocation.append('-format')\n    if args.style:\n        invocation.append('-style=' + args.style)\n    print(tmpdir)\n    invocation.append(tmpdir)\n    subprocess.call(invocation)\n\ndef remove_pb_files(filenames):\n    for file in filenames.copy():\n        if file.endswith('.pb.cc'):\n            filenames.remove(file)\n\ndef remove_test_files(filenames):\n    for file in filenames.copy():\n        if file.endswith('_test.cc'):\n            filenames.remove(file)\n\n# TODO(LeeHao): add some compile failed file ,eg src/storage/benchmark\ndef remove_custom_files(filenames):\n    for file in filenames.copy():\n        # if file.endswith('pika_pubsub.cc') or file.endswith('pika_stable_log.cc') or file.endswith('pstd_string.cc') or file.endswith('pika_zset.cc') or file.endswith('pika_server.cc'):\n        #     filenames.remove(file)\n        if 'benchmark' in os.path.dirname(file) or 'examples' in os.path.dirname(file) or 'performance' in os.path.dirname(file):\n            filenames.remove(file)\n\n\ndef run_tidy(args, tmpdir, build_path, queue, lock, failed_files):\n    \"\"\"Takes filenames out of queue and runs clang-tidy on them.\"\"\"\n    while True:\n        name = queue.get()\n        print(\"Checking: {}\".format(name))\n        sys.stdout.flush()\n        invocation = get_tidy_invocation(name, args.clang_tidy_binary, args.checks,\n                                         tmpdir, build_path, args.header_filter,\n                                         args.extra_arg, args.extra_arg_before,\n                                         args.quiet, args.config)\n\n        proc = subprocess.Popen(\n            invocation, stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n        output, err = proc.communicate()\n        if proc.returncode != 0:\n            failed_files.append(name)\n        with lock:\n            output = output.decode('utf-8') if output is not None else None\n            err = err.decode('utf-8') if output is not None else None\n            # unfortunately, our error messages are actually on STDOUT\n            # STDERR tells how many warnings are generated,\n            # but this includes non-user-code warnings, so it is useless...\n            if output:\n                sys.stdout.write('\\n')\n                sys.stdout.write(output)\n        queue.task_done()\n\n\ndef main():\n    parser = argparse.ArgumentParser(description='Runs clang-tidy over all files '\n                                                 'in a compilation database. Requires '\n                                                 'clang-tidy and clang-apply-replacements in '\n                                                 '$PATH.')\n    parser.add_argument('-clang-tidy-binary', metavar='PATH',\n                        default='clang-tidy',\n                        help='path to clang-tidy binary')\n    parser.add_argument('-clang-apply-replacements-binary', metavar='PATH',\n                        default='clang-apply-replacements',\n                        help='path to clang-apply-replacements binary')\n    parser.add_argument('-checks', default=None,\n                        help='checks filter, when not specified, use clang-tidy '\n                             'default')\n    parser.add_argument('-config', default=None,\n                        help='Specifies a configuration in YAML/JSON format: '\n                             '  -config=\"{Checks: \\'*\\', '\n                             '                       CheckOptions: [{key: x, '\n                             '                                       value: y}]}\" '\n                             'When the value is empty, clang-tidy will '\n                             'attempt to find a file named .clang-tidy for '\n                             'each source file in its parent directories.')\n    parser.add_argument('-header-filter', default=None,\n                        help='regular expression matching the names of the '\n                             'headers to output diagnostics from. Diagnostics from '\n                             'the main file of each translation unit are always '\n                             'displayed.')\n    parser.add_argument('-export-fixes', metavar='filename', dest='export_fixes',\n                        help='Create a yaml file to store suggested fixes in, '\n                             'which can be applied with clang-apply-replacements.')\n    parser.add_argument('-j', type=int, default=0,\n                        help='number of tidy instances to be run in parallel.')\n    parser.add_argument('files', nargs='*', default=['.*'],\n                        help='files to be processed (regex on path)')\n    parser.add_argument('-fix', action='store_true', help='apply fix-its')\n    parser.add_argument('-format', action='store_true', help='Reformat code '\n                                                             'after applying fixes')\n    parser.add_argument('-style', default='file', help='The style of reformat '\n                                                       'code after applying fixes')\n    parser.add_argument('-p', dest='build_path',\n                        help='Path used to read a compile command database.')\n    parser.add_argument('-extra-arg', dest='extra_arg',\n                        action='append', default=[],\n                        help='Additional argument to append to the compiler '\n                             'command line.')\n    parser.add_argument('-extra-arg-before', dest='extra_arg_before',\n                        action='append', default=[],\n                        help='Additional argument to prepend to the compiler '\n                             'command line.')\n    parser.add_argument('-quiet', action='store_true',\n                        help='Run clang-tidy in quiet mode')\n    parser.add_argument('-only-diff', action='store_true',\n                        help='Only run clang-tidy on diff file to master branch')\n    args = parser.parse_args()\n\n    db_path = 'compile_commands.json'\n\n    if args.build_path is not None:\n        build_path = args.build_path\n    else:\n        # Find our database\n        build_path = find_compilation_database(db_path)\n\n    try:\n        invocation = [args.clang_tidy_binary, '-list-checks']\n        invocation.append('-p=' + build_path)\n        if args.checks:\n            invocation.append('-checks=' + args.checks)\n        invocation.append('-')\n        subprocess.check_call(invocation)\n    except:\n        print(\"Unable to run clang-tidy.\", file=sys.stderr)\n        sys.exit(1)\n\n    # Load the database and extract all files.\n    database = json.load(open(os.path.join(build_path, db_path)))\n    files = [make_absolute(entry['file'], entry['directory'])\n             for entry in database]\n\n    remove_pb_files(files)\n    remove_test_files(files)\n    remove_custom_files(files)\n\n    # Running clang-tidy in the whole project is slow. Therefore, we added\n    # support for running clang-tidy on git diff. When `only_diff` is\n    # specified in the command line, we only check files modified compared\n    # with origin/master, so as to speed up clang-tidy check.\n    #\n    # This functionality is set as CMake target `check-clang-tidy-diff`.\n    # You can use `make check-clang-tidy-diff` to do a fast clang-tidy\n    # check.\n    if args.only_diff:\n        git_repo = subprocess.run(\n            [\"git\", \"rev-parse\", \"--show-toplevel\"], capture_output=True)\n        git_repo_path = git_repo.stdout.decode(\"utf-8\").strip()\n        # Get all files changed compared with origin/master\n        result = subprocess.run(\n            [\"git\", \"--no-pager\", \"diff\", \"--name-only\", \"origin/master\"], capture_output=True)\n        git_changed_file_list = list(map(lambda x: make_absolute(\n            x, git_repo_path), result.stdout.decode(\"utf-8\").strip().split(\"\\n\")))\n        git_changed_file_set = set(git_changed_file_list)\n        # Only retain files that exists in git diff\n        files = list(filter(lambda x: x in git_changed_file_set, files))\n\n    max_task = args.j\n    if max_task == 0:\n        max_task = multiprocessing.cpu_count()\n\n    tmpdir = None\n    if args.fix or args.export_fixes:\n        check_clang_apply_replacements_binary(args)\n        tmpdir = tempfile.mkdtemp()\n\n    # Build up a big regexy filter from all command line arguments.\n    file_name_re = re.compile('|'.join(args.files))\n\n    return_code = 0\n    try:\n        # Spin up a bunch of tidy-launching threads.\n        task_queue = queue.Queue(max_task)\n        # List of files with a non-zero return code.\n        failed_files = []\n        lock = threading.Lock()\n        for _ in range(max_task):\n            t = threading.Thread(target=run_tidy,\n                                 args=(args, tmpdir, build_path, task_queue, lock, failed_files))\n            t.daemon = True\n            t.start()\n\n        def update_progress(current_file, num_files):\n            pct = int(current_file / num_files * 100)\n            if current_file == num_files or pct % max(2, num_files // 10) == 0:\n                stars = pct // 10\n                spaces = 10 - pct // 10\n                print('\\rProgress: [{}{}] ({}% / File {} of {})'.format(\n                    'x' * stars,\n                    ' ' * spaces,\n                    pct,\n                    current_file,\n                    num_files\n                ), end='')\n                sys.stdout.flush()\n                if current_file == num_files:\n                    print()\n\n        # Fill the queue with files.\n        for i, name in enumerate(files):\n            if file_name_re.search(name):\n                put_file = False\n                while not put_file:\n                    try:\n                        task_queue.put(name, block=True, timeout=300)\n                        put_file = True\n                        # update_progress(i, len(files))\n                    except queue.Full:\n                        print('Still waiting to put files into clang-tidy queue.')\n                        sys.stdout.flush()\n\n        # Wait for all threads to be done.\n        task_queue.join()\n        # update_progress(100, 100)\n        if len(failed_files):\n            return_code = 1\n            print('The files that failed were:')\n            print(pprint.pformat(failed_files))\n            print(\n                'Note that a failing .h file will fail all the .cpp files that include it.\\n')\n\n    except KeyboardInterrupt:\n        # This is a sad hack. Unfortunately subprocess goes\n        # bonkers with ctrl-c and we start forking merrily.\n        print('\\nCtrl-C detected, goodbye.')\n        if tmpdir:\n            shutil.rmtree(tmpdir)\n        os.kill(0, 9)\n\n    if args.export_fixes:\n        print('Writing fixes to ' + args.export_fixes + ' ...')\n        try:\n            merge_replacement_files(tmpdir, args.export_fixes)\n        except:\n            print('Error exporting fixes.\\n', file=sys.stderr)\n            traceback.print_exc()\n            return_code = 1\n\n    if args.fix:\n        print('Applying fixes ...')\n        try:\n            apply_fixes(args, tmpdir)\n        except:\n            print('Error applying fixes.\\n', file=sys.stderr)\n            traceback.print_exc()\n            return_code = 1\n\n    if tmpdir:\n        shutil.rmtree(tmpdir)\n    print(\"\")\n    sys.stdout.flush()\n    sys.exit(return_code)\n\n\nif __name__ == '__main__':\n    main()\n"
        },
        {
          "name": "src",
          "type": "tree",
          "content": null
        },
        {
          "name": "tests",
          "type": "tree",
          "content": null
        },
        {
          "name": "tools",
          "type": "tree",
          "content": null
        },
        {
          "name": "utils",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}