{
  "metadata": {
    "timestamp": 1736561494425,
    "page": 5,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjEw",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "xiangyuecn/Recorder",
      "stars": 4993,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.4013671875,
          "content": "node_modules\n/assets/demo-asr/NodeJsServer_asr.aliyun.short__local.js\n/assets/demo-vue/copy\n/assets/node-codes/temp\n/assets/node-localServer/upload\n/assets/node-localServer/main__local.js\n/assets/node-localServer/package-lock.json\n/assets/npm-home/npm-files\n/assets/npm-home/version.patch.txt\n/assets/page-i18n/temp_check\n/assets/sonic-java/test.wav\n/assets/sonic-java/Main.class\n/assets/sonic-java/Sonic.class\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.0625,
          "content": "MIT License\r\n\r\nCopyright (c) 2019 xiangyuecn\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n"
        },
        {
          "name": "QuickStart.html",
          "type": "blob",
          "size": 19.8984375,
          "content": "<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\">\r\n\r\n<title reclang=\"XvFp\">Recorder H5 QuickStart: 快速入门</title>\r\n<script>var PageLM=\"2024-09-09 21:58\";</script>\r\n<!--\r\n你可以直接将 QuickStart.html 文件copy到你的(https)网站中，无需其他文件，就能正常开始测试了。\r\nYou can directly copy the QuickStart.html file to your (https) website, and you can start testing normally without other files.\r\n-->\r\n\r\n<script> //CDN URL 可删掉，选择线路用的\r\nvar GitPageBase=\"https://xiangyuecn.github.io/Recorder/\";\r\nif(/gitee\\.io/.test(location.host)){ //2024-05-01 pages无通知下线\r\n\tGitPageBase=\"https://xiangyuecn.gitee.io/recorder/\";\r\n};\r\ndocument.write('<base href=\"'+GitPageBase+'\" />');\r\ndocument.write('<link rel=\"shortcut icon\" type=\"image/png\" href=\"'+GitPageBase+'assets/icon.png\">');\r\n</script>\r\n\r\n</head>\r\n\r\n<body>\r\n<!--\r\n【1】引入框架文件  Import plugin file   ，注意自己使用时应当自己把源码clone下来，然后通过src=\"/src/recorder-core.js\"引入\r\n\r\n另外：[1.1]、[1.2]可以合并为使用\"/recorder.mp3.min.js\"，这个文件为压缩版大幅减小文件体积，已经包含了这3个源码文件\r\n-->\r\n\r\n<!-- 【1.1】引入核心文件  Import core file -->\r\n<script src=\"改成你clone的源码目录/../src/recorder-core.js\"></script>\r\n\r\n<!-- 【1.2】引入相应格式支持文件；如果需要多个格式支持，把这些格式的编码引擎js文件放到后面统统加载进来即可。  Import the corresponding format support files; if you need multiple format support, put the encoding engine js files of these formats in the back and load them all. -->\r\n<script src=\"改成你clone的源码目录/../src/engine/mp3.js\"></script>\r\n<script src=\"改成你clone的源码目录/../src/engine/mp3-engine.js\"></script>\r\n\r\n<!-- 【1.3】引入可选的扩展支持项，如果不需要这些扩展功能可以不引入。  Import optional extended support items. If you do not need these extended functions, you do not need to import them. -->\r\n<script src=\"改成你clone的源码目录/../src/extensions/frequency.histogram.view.js\"></script>\r\n<script src=\"改成你clone的源码目录/../src/extensions/lib.fft.js\"></script>\r\n\r\n<!-- 【*】无关js，仅供本页面用的国际化多语言支持，可删除。  It has nothing to do with js, it is only for international multilingual support for this page, it can be deleted. -->\r\n<script src=\"改成你clone的源码目录/../assets/ztest-page-i18n.js\"></script>\r\n<script src=\"改成你clone的源码目录/../assets/zdemo.widget.donate.js\"></script>\r\n\r\n<script>var bEL=document.querySelector(\"base\");if(bEL)bEL.parentNode.removeChild(bEL);//清除CDN地址  Clear CDN URLs</script>\r\n\r\n\r\n<!-- 【2】构建界面  Build the web interface  -->\r\n<div class=\"main\">\r\n\t<div class=\"i18nBox\"></div>\r\n\t<div class=\"mainBox topLinks\">\r\n\t\t<span style=\"font-size:32px;color:#f60;\" reclang=\"JM2s\">Recorder H5 QuickStart: 快速入门</span>\r\n\t\t<a href=\"https://github.com/xiangyuecn/Recorder\" target=\"_blank\">GitHub</a>\r\n\t\t| <a href=\"https://gitee.com/xiangyuecn/Recorder\" target=\"_blank\">Gitee</a>\r\n\t\t\r\n\t\t<div style=\"padding-top:10px;color:#666\">\r\n\t\t\t<span reclang=\"FxZ3\">更多Demo：</span>\r\n\t\t\t<a class=\"lb\" href=\"https://xiangyuecn.github.io/Recorder/\" target=\"_blank\">Recorder H5</a>\r\n\t\t\t<a class=\"lb\" href=\"https://xiangyuecn.github.io/Recorder/assets/demo-vue/\" target=\"_blank\">H5 vue</a>\r\n\t\t\t<a class=\"lb\" href=\"https://xiangyuecn.github.io/Recorder/app-support-sample/\" target=\"_blank\">Recorder App</a>\r\n\t\t\t<a class=\"lb\" href=\"https://xiangyuecn.github.io/Recorder/app-support-sample/QuickStart.html\" target=\"_blank\">App QuickStart</a>\r\n\t\t\t\r\n\t\t\t<a class=\"lb\" href=\"https://xiangyuecn.github.io/Recorder/assets/工具-GitHub页面历史版本访问.html#url=xiangyuecn:Recorder@1.0.20032600,/QuickStart.html\" target=\"_blank\" reclang=\"UGOA\">切换到老版本测试</a>\r\n\t\t</div>\r\n\t</div>\r\n\t\r\n\t<div class=\"mainBox\">\r\n\t\t<!-- 按钮控制区域  Control button area -->\r\n\t\t<div class=\"pd btns\">\r\n\t\t\t<div>\r\n\t\t\t\t<button onclick=\"recOpen()\" style=\"margin-right:10px\" reclang=\"2KqN\">打开录音,请求权限</button>\r\n\t\t\t\t<button onclick=\"recClose()\" style=\"margin-right:0\" reclang=\"E0NB\">关闭录音,释放资源</button>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<button onclick=\"recStart()\" reclang=\"nlQN\">录制</button>\r\n\t\t\t<button onclick=\"recStop()\" style=\"margin-right:80px\" reclang=\"cEa1\">停止</button>\r\n\t\t\t\r\n\t\t\t<span style=\"display: inline-block;\">\r\n\t\t\t\t<button onclick=\"recPause()\" reclang=\"wQFS\">暂停</button>\r\n\t\t\t\t<button onclick=\"recResume()\" reclang=\"hHDO\">继续</button>\r\n\t\t\t</span>\r\n\t\t\t<span style=\"display: inline-block;\">\r\n\t\t\t\t<button onclick=\"recPlay()\" reclang=\"0TJm\">播放</button>\r\n\t\t\t\t<button onclick=\"recUpload()\" reclang=\"DOAp\">上传</button>\r\n\t\t\t\t<button onclick=\"recLocalDown()\" reclang=\"GTE7\">本地下载</button>\r\n\t\t\t</span>\r\n\t\t</div>\r\n\t\t\r\n\t\t<!-- 波形绘制区域  Waveform drawing area -->\r\n\t\t<div style=\"padding-top:5px\">\r\n\t\t\t<div style=\"border:1px solid #ccc;display:inline-block;vertical-align:bottom\"><div style=\"height:100px;width:300px;\" class=\"recwave\"></div></div>\r\n\t\t\t\r\n\t\t\t<div style=\"height:40px;width:300px;margin-top:5px;display:inline-block;vertical-align:bottom;background:#999;position:relative;\">\r\n\t\t\t\t<div class=\"recpowerx\" style=\"height:40px;background:#0B1;position:absolute;\"></div>\r\n\t\t\t\t<div class=\"recpowert\" style=\"padding-left:50px; line-height:40px; position: relative;\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t\r\n\t<!-- 日志输出区域  Log output area -->\r\n\t<div class=\"mainBox\">\r\n\t\t<div class=\"reclog\"></div>\r\n\t</div>\r\n</div>\r\n\r\n\r\n<!-- 【3】实现录音逻辑  Implement recording logic -->\r\n<script>\r\nvar rec,processTime,wave,recBlob;\r\n/**调用open打开录音请求好录音权限  Call open to open the recording and request the recording permission**/\r\nvar recOpen=function(){//一般在显示出录音按钮或相关的录音界面时进行此方法调用，后面用户点击开始录音时就能畅通无阻了\r\n\trec=null;\r\n\twave=null;\r\n\trecBlob=null;\r\n\tvar newRec=Recorder({\r\n\t\ttype:\"mp3\",sampleRate:16000,bitRate:16 //mp3格式，指定采样率hz、比特率kbps，其他参数使用默认配置；注意：是数字的参数必须提供数字，不要用字符串；需要使用的type类型，需提前把格式支持文件加载进来，比如使用wav格式需要提前加载wav.js编码引擎\r\n\t\t,onProcess:function(buffers,powerLevel,bufferDuration,bufferSampleRate,newBufferIdx,asyncEnd){\r\n\t\t\t//录音实时回调，大约1秒调用12次本回调\r\n\t\t\tdocument.querySelector(\".recpowerx\").style.width=powerLevel+\"%\";\r\n\t\t\tdocument.querySelector(\".recpowert\").innerText=formatMs(bufferDuration,1)+\" / \"+powerLevel;\r\n\t\t\tprocessTime=Date.now();\r\n\t\t\t\r\n\t\t\t//可视化图形绘制\r\n\t\t\twave.input(buffers[buffers.length-1],powerLevel,bufferSampleRate);\r\n\t\t}\r\n\t});\r\n\r\n\tnewRec.open(function(){//打开麦克风授权获得相关资源\r\n\t\trec=newRec;\r\n\t\t\r\n\t\t//此处创建这些音频可视化图形绘制浏览器支持妥妥的\r\n\t\twave=Recorder.FrequencyHistogramView({elem:\".recwave\"});\r\n\t\t\r\n\t\treclog(Html_$T(\"GVCa::已打开录音，可以点击录制开始录音了\"),2);\r\n\t},function(msg,isUserNotAllow){//用户拒绝未授权或不支持\r\n\t\treclog((isUserNotAllow?\"UserNotAllow, \":\"\")+Html_$T(\"TOOV::打开录音失败：\")+msg,1);\r\n\t});\r\n};\r\n\r\n\r\n\r\n/**关闭录音，释放资源  Close recording, release resources**/\r\nfunction recClose(){\r\n\tif(rec){\r\n\t\trec.close();\r\n\t\treclog(Html_$T(\"jqOs::已关闭\"));\r\n\t}else{\r\n\t\treclog(Html_$T(\"VOOw::未打开录音\"),1);\r\n\t};\r\n};\r\n\r\n\r\n\r\n/**开始录音  Start recording**/\r\nfunction recStart(){//打开了录音后才能进行start、stop调用\r\n\tif(rec&&Recorder.IsOpen()){\r\n\t\trecBlob=null;\r\n\t\trec.start();\r\n\t\treclog(Html_$T(\"CGdy::已开始录音...\")+\" \"+rec.set.type+\" \"+rec.set.sampleRate+\" \"+rec.set.bitRate+\"kbps\");\r\n\t\t\r\n\t\t//【稳如老狗WDT】可选的，监控是否在正常录音有onProcess回调，如果长时间没有回调就代表录音不正常\r\n\t\tvar wdt=rec.watchDogTimer=setInterval(function(){\r\n\t\t\tif(!rec || wdt!=rec.watchDogTimer){ clearInterval(wdt); return } //sync\r\n\t\t\tif(Date.now()<rec.wdtPauseT) return; //如果暂停录音了就不检测：puase时赋值rec.wdtPauseT=Date.now()*2（永不监控），resume时赋值rec.wdtPauseT=Date.now()+1000（1秒后再监控）\r\n\t\t\tif(Date.now()-(processTime||startTime)>1500){ clearInterval(wdt);\r\n\t\t\t\treclog(processTime?Html_$T(\"eWo1::录音被中断\"):Html_$T(\"eWo2::录音未能正常开始\"),1);\r\n\t\t\t\t// ... 错误处理，关闭录音，提醒用户\r\n\t\t\t}\r\n\t\t},1000);\r\n\t\tvar startTime=Date.now(); rec.wdtPauseT=0; processTime=0;\r\n\t}else{\r\n\t\treclog(Html_$T(\"ajKR::未打开录音\"),1);\r\n\t};\r\n};\r\n\r\n/**暂停录音  Passing recording**/\r\nfunction recPause(){\r\n\tif(rec&&Recorder.IsOpen()){\r\n\t\trec.pause();\r\n\t\trec.wdtPauseT=Date.now()*2; //永不监控onProcess超时\r\n\t\treclog(Html_$T(\"GvCy::已暂停\"));\r\n\t}else{\r\n\t\treclog(Html_$T(\"gCAR::未打开录音\"),1);\r\n\t};\r\n};\r\n/**恢复录音  Resume recording**/\r\nfunction recResume(){\r\n\tif(rec&&Recorder.IsOpen()){\r\n\t\trec.resume();\r\n\t\trec.wdtPauseT=Date.now()+1000; //1秒后再监控onProcess超时\r\n\t\treclog(Html_$T(\"5q1K::继续录音中...\"));\r\n\t}else{\r\n\t\treclog(Html_$T(\"Ob6S::未打开录音\"),1);\r\n\t};\r\n};\r\n\r\n/**结束录音，得到音频文件  Stop recording and get audio files**/\r\nfunction recStop(){\r\n\tif(!(rec&&Recorder.IsOpen())){\r\n\t\treclog(Html_$T(\"5JuL::未打开录音\"),1);\r\n\t\treturn;\r\n\t};\r\n\trec.watchDogTimer=0; //停止监控onProcess超时\r\n\trec.stop(function(blob,duration){\r\n\t\tconsole.log(blob,(window.URL||webkitURL).createObjectURL(blob),Html_xT(Html_$T(\"gOix::时长:{1}ms\",0,duration)));\r\n\t\t\r\n\t\trecBlob=blob;\r\n\t\treclog(Html_$T(\"0LHf::已录制mp3：{1}ms {2}字节，可以点击播放、上传、本地下载了\",0,formatMs(duration),blob.size),2);\r\n\t},function(msg){\r\n\t\treclog(Html_$T(\"kGZO::录音失败:\")+msg,1);\r\n\t});\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**播放  Play**/\r\nfunction recPlay(){\r\n\tif(!recBlob){\r\n\t\treclog(Html_$T(\"tIke::请先录音，然后停止后再播放\"),1);\r\n\t\treturn;\r\n\t};\r\n\tvar cls=(\"a\"+Math.random()).replace(\".\",\"\");\r\n\treclog(Html_$T('GlWb::播放中: ')+'<span class=\"'+cls+'\"></span>');\r\n\tvar audio=document.createElement(\"audio\");\r\n\taudio.controls=true;\r\n\tdocument.querySelector(\".\"+cls).appendChild(audio);\r\n\t//简单利用URL生成播放地址，注意不用了时需要revokeObjectURL，否则霸占内存\r\n\taudio.src=(window.URL||webkitURL).createObjectURL(recBlob);\r\n\taudio.play();\r\n\t\r\n\tsetTimeout(function(){\r\n\t\t(window.URL||webkitURL).revokeObjectURL(audio.src);\r\n\t},5000);\r\n};\r\n\r\n/**上传  Upload**/\r\nfunction recUpload(){\r\n\tvar blob=recBlob;\r\n\tif(!blob){\r\n\t\treclog(Html_$T(\"DUTn::请先录音，然后停止后再上传\"),1);\r\n\t\treturn;\r\n\t};\r\n\t\r\n\t//本例子假设使用原始XMLHttpRequest请求方式，实际使用中自行调整为自己的请求方式\r\n\t//录音结束时拿到了blob文件对象，可以用FileReader读取出内容，或者用FormData上传\r\n\tvar api=\"http://127.0.0.1:9528\";\r\n\tvar onreadystatechange=function(xhr,title){\r\n\t\treturn function(){\r\n\t\t\tif(xhr.readyState==4){\r\n\t\t\t\tif(xhr.status==200){\r\n\t\t\t\t\treclog(title+Html_$T(\"G2MU::上传成功\")+' <span style=\"color:#999\">response: '+xhr.responseText+'</span>',2);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treclog(title+Html_$T(\"TUdi::没有完成上传，演示上传地址无需关注上传结果，只要浏览器控制台内Network面板内看到的请求数据结构是预期的就ok了。\"), \"#d8c1a0\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.error(Html_xT(title+Html_$T(\"HjDi::上传失败\")),xhr.status,xhr.responseText);\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t};\r\n\t};\r\n\treclog(Html_$T(\"QnSI::开始上传到{1}，请稍候... （你可以先到源码 /assets/node-localServer 目录内执行 npm run start 来运行本地测试服务器）\",0,api));\r\n\r\n\t/***方式一：将blob文件转成base64纯文本编码，使用普通application/x-www-form-urlencoded表单上传***/\r\n\tvar reader=new FileReader();\r\n\treader.onloadend=function(){\r\n\t\tvar postData=\"\";\r\n\t\tpostData+=\"mime=\"+encodeURIComponent(blob.type);//告诉后端，这个录音是什么格式的，可能前后端都固定的mp3可以不用写\r\n\t\tpostData+=\"&upfile_b64=\"+encodeURIComponent((/.+;\\s*base64\\s*,\\s*(.+)$/i.exec(reader.result)||[])[1]) //录音文件内容，后端进行base64解码成二进制\r\n\t\t//...其他表单参数\r\n\t\t\r\n\t\tvar xhr=new XMLHttpRequest();\r\n\t\txhr.open(\"POST\", api+\"/uploadBase64\");\r\n\t\txhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\r\n\t\txhr.onreadystatechange=onreadystatechange(xhr,Html_$T(\"gG1f::上传方式一【Base64】\"));\r\n\t\txhr.send(postData);\r\n\t};\r\n\treader.readAsDataURL(blob);\r\n\r\n\t/***方式二：使用FormData用multipart/form-data表单上传文件***/\r\n\tvar form=new FormData();\r\n\tform.append(\"upfile\",blob,\"recorder.mp3\"); //和普通form表单并无二致，后端接收到upfile参数的文件，文件名为recorder.mp3\r\n\t//...其他表单参数\r\n\t\r\n\tvar xhr=new XMLHttpRequest();\r\n\txhr.open(\"POST\", api+\"/upload\");\r\n\txhr.onreadystatechange=onreadystatechange(xhr,Html_$T(\"vDzB::上传方式二【FormData】\"));\r\n\txhr.send(form);\r\n};\r\n\r\n\r\n/**本地下载  Local download**/\r\nfunction recLocalDown(){\r\n\tif(!recBlob){\r\n\t\treclog(Html_$T(\"M86h::请先录音，然后停止后再下载\"),1);\r\n\t\treturn;\r\n\t};\r\n\tvar cls=(\"a\"+Math.random()).replace(\".\",\"\");\r\n\trecdown64.lastCls=cls;\r\n\treclog(Html_$T('vJPl::点击 ')+'<span class=\"'+cls+'\"></span>'+Html_$T('Whtc:: 下载，或复制文本')\r\n\t\t+'<button onclick=\"recdown64(\\''+cls+'\\')\">'+Html_$T('XK4l::生成Base64文本')+'</button><span class=\"'+cls+'_b64\"></span>');\r\n\t\r\n\tvar fileName=\"recorder-\"+Date.now()+\".mp3\";\r\n\tvar downA=document.createElement(\"A\");\r\n\tdownA.innerHTML=Html_$T(\"g8Fy::下载 \")+fileName;\r\n\tdownA.href=(window.URL||webkitURL).createObjectURL(recBlob);\r\n\tdownA.download=fileName;\r\n\tdocument.querySelector(\".\"+cls).appendChild(downA);\r\n\tif(/mobile/i.test(navigator.userAgent)){\r\n\t\talert(Html_xT(Html_$T(\"DIEK::因移动端绝大部分国产浏览器未适配Blob Url的下载，所以本demo代码在移动端未调用downA.click()。请尝试点击日志中显示的下载链接下载\")));\r\n\t}else{\r\n\t\tdownA.click();\r\n\t}\r\n\t\r\n\t//不用了时需要revokeObjectURL，否则霸占内存\r\n\t//(window.URL||webkitURL).revokeObjectURL(downA.href);\r\n};\r\nfunction recdown64(cls){\r\n\tvar el=document.querySelector(\".\"+cls+\"_b64\");\r\n\tif(recdown64.lastCls!=cls){\r\n\t\tel.innerHTML='<span style=\"color:red\">'+Html_$T(\"eKKx::老的数据没有保存，只支持最新的一条\")+'</span>';\r\n\t\treturn;\r\n\t}\r\n\tvar reader = new FileReader();\r\n\treader.onloadend = function() {\r\n\t\tel.innerHTML='<textarea></textarea>';\r\n\t\tel.querySelector(\"textarea\").value=reader.result;\r\n\t};\r\n\treader.readAsDataURL(recBlob);\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar formatMs=function(ms,all){\r\n\tvar ss=ms%1000;ms=(ms-ss)/1000;\r\n\tvar s=ms%60;ms=(ms-s)/60;\r\n\tvar m=ms%60;ms=(ms-m)/60;\r\n\tvar h=ms;\r\n\tvar t=(h?h+\":\":\"\")\r\n\t\t+(all||h+m?(\"0\"+m).substr(-2)+\":\":\"\")\r\n\t\t+(all||h+m+s?(\"0\"+s).substr(-2)+\"″\":\"\")\r\n\t\t+(\"00\"+ss).substr(-3);\r\n\treturn t;\r\n};\r\n</script>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!--以下这坨可以忽略  The following can be ignored-->\r\n<script>\r\nfunction reclog(s,color){\r\n\tvar now=new Date();\r\n\tvar t=(\"0\"+now.getHours()).substr(-2)\r\n\t\t+\":\"+(\"0\"+now.getMinutes()).substr(-2)\r\n\t\t+\":\"+(\"0\"+now.getSeconds()).substr(-2);\r\n\tvar div=document.createElement(\"div\");\r\n\tvar elem=document.querySelector(\".reclog\");\r\n\telem.insertBefore(div,elem.firstChild);\r\n\tdiv.innerHTML='<div style=\"color:'+(!color?\"\":color==1?\"red\":color==2?\"#0b1\":color)+'\">['+t+']'+s+'</div>';\r\n};\r\nwindow.onerror=function(message, url, lineNo, columnNo, error){\r\n\t//https://www.cnblogs.com/xianyulaodi/p/6201829.html\r\n\treclog('<span style=\"color:red\">【Uncaught Error】'+message+'<pre>'+\"at:\"+lineNo+\":\"+columnNo+\" url:\"+url+\"\\n\"+(error&&error.stack||Html_$T(\"kBaF::不能获得错误堆栈\"))+'</pre></span>');\r\n};\r\n\r\nif(!window.Html_$T){//没有提供本页面用的国际化多语言支持时 返回中文文本\r\n\twindow.Html_$T=function(){\r\n\t\tvar a=arguments,txt=a[0].replace(/^.+?::/,\"\"),n=0;\r\n\t\tfor(var i=0;i<a.length;i++){ if(typeof a[i]==\"number\"){ n=i;break } }\r\n\t\ttxt=txt.replace(/\\{(\\d+)\\}/g,function(v,f){ v=a[+f+n]; return v==null?\"\":v });\r\n\t\treturn txt;\r\n\t}\r\n\twindow.Html_xT=function(v){ return v }\r\n}\r\n\r\nreclog(Html_$T('Hzox::如需录音功能定制开发，网站、App、小程序、前端后端开发等需求，请加QQ群：①群 781036591、②群 748359095、③群 450721519，口令recorder，联系群主（即作者），谢谢~'),\"#333;font-size:22px;font-weight:bold\");\r\nreclog(Html_$T(\"m0EU::Recorder App基于Recorder H5的跨平台录音，支持在浏览器环境中使用（H5）、各种使用js来构建的程序中使用（App、小程序、UniApp、Electron、NodeJs）\")+unescape(\"%uD83C%uDF89\"),\"#f60;font-weight:bold;font-size:24px\");\r\nreclog(Html_$T(\"v17f::Recorder H5使用简单，功能丰富，支持PC、Android、iOS 14.3+\")+unescape(\"%uD83D%uDCAA\"),\"#0b1;font-weight:bold;font-size:24px\");\r\nreclog(Html_$T('EfeX::本页面修改时间（有可能修改了忘改）：')+PageLM,\"#999\");\r\nreclog(Html_$T('9Jy2::Recorder库修改时间（有可能修改了忘改）：')+(window.Recorder&&Recorder.LM),\"#999\");\r\nreclog(\"UA: \"+navigator.userAgent, \"#999\");\r\nreclog(\"URL: \"+location.href.replace(/#.*/g,\"\"), \"#999\");\r\nreclog(Html_$T('7gIC::你可以直接将 ')+'<a target=\"_blank\" href=\"https://github.com/xiangyuecn/Recorder/blob/master/QuickStart.html\">/QuickStart.html</a>'+Html_$T('s731:: 文件copy到你的(https)网站中，无需其他文件，就能正常开始测试了；相比 Recorder H5 (/index.html) 这个大而全(杂乱)的demo，本文件更适合入门学习')+unescape(\"%uD83D%uDE04\"));\r\nreclog(Html_$T('ERsK::当前浏览器')+'<span style=\"color:'+(Recorder.Support()?'#0b1\">'+Html_$T('7tuo::支持录音'):'red\">'+Html_$T('8Z8O::不支持录音'))+'</span>');\r\n\r\nif(window.Recorder){\r\n\treclog(Html_$T('BL9u::页面已准备好，请先点击打开录音，然后点击录制'),2);\r\n}else{\r\n\treclog(Html_$T(\"YzPd::js文件加载失败，请刷新重试！\"),\"#f00;font-size:50px\");\r\n}\r\n</script>\r\n\r\n<script>\r\n//修改a链接的url\r\nvar els=document.querySelectorAll(\".topLinks a\");\r\nfor(var i=0;i<els.length;i++){\r\n\tvar el=els[i],v=el.getAttribute(\"href\")||\"\";\r\n\tif(/\\.io\\/Recorder\\/(.*)/i.test(v)){\r\n\t\tel.setAttribute(\"href\", GitPageBase+RegExp.$1);\r\n\t}\r\n}\r\n\r\nif(/mobile/i.test(navigator.userAgent)){\r\n\t//移动端加载控制台组件\r\n\tvar elem=document.createElement(\"script\");\r\n\telem.setAttribute(\"type\",\"text/javascript\");\r\n\telem.setAttribute(\"src\",GitPageBase+\"assets/ztest-vconsole.js\");\r\n\tdocument.body.appendChild(elem);\r\n\telem.onload=function(){\r\n\t\tnew VConsole();\r\n\t};\r\n};\r\n</script>\r\n\r\n<!-- 加载打赏挂件 -->\r\n<script>\r\nvar donateView=document.createElement(\"div\");\r\ndocument.querySelector(\".reclog\").appendChild(donateView);\r\nDonateWidget({\r\n\tlog:function(msg){reclog(msg)}\r\n\t,mobElem:donateView\r\n});\r\n</script>\r\n\r\n<!-- 启用国际化多语言支持 -->\r\n<script>\r\nif(window.PageI18nWidget){\r\nPageI18nWidget({\r\n\telem:\".i18nBox\", rootUrl:GitPageBase\r\n\t,titleKey:\"XvFp\"\r\n\t,langs:{\r\n\t\t\"en-US\":{urls:[ \"#QuickStart_html/en-US.js\",\"#widget_donate/en-US.js\" ]}\r\n\t}\r\n});\r\n};\r\n</script>\r\n\r\n<style>\r\nbody{\r\n\tword-wrap: break-word;\r\n\tbackground:#f5f5f5 center top no-repeat;\r\n\tbackground-size: auto 680px;\r\n}\r\npre{\r\n\twhite-space:pre-wrap;\r\n}\r\na{\r\n\ttext-decoration: none;\r\n\tcolor:#06c;\r\n}\r\na:hover{\r\n\tcolor:#f00;\r\n}\r\n\r\n.main{\r\n\tmax-width:700px;\r\n\tmargin:0 auto;\r\n\tpadding-bottom:80px\r\n}\r\n\r\n.mainBox{\r\n\tmargin-top:12px;\r\n\tpadding: 12px;\r\n\tborder-radius: 6px;\r\n\tbackground: #fff;\r\n\t--border: 1px solid #f60;\r\n\tbox-shadow: 2px 2px 3px #aaa;\r\n}\r\n\r\n\r\n.btns button{\r\n\tdisplay: inline-block;\r\n\tcursor: pointer;\r\n\tborder: none;\r\n\tborder-radius: 3px;\r\n\tbackground: #f60;\r\n\tcolor:#fff;\r\n\tpadding: 0 15px;\r\n\tmargin:3px 20px 3px 0;\r\n\tline-height: 36px;\r\n\theight: 36px;\r\n\toverflow: hidden;\r\n\tvertical-align: middle;\r\n}\r\n.btns button:active{\r\n\tbackground: #f00;\r\n}\r\n\r\n.pd{\r\n\tpadding:0 0 6px 0;\r\n}\r\n.lb{\r\n\tdisplay:inline-block;\r\n\tvertical-align: middle;\r\n\tbackground:#00940e;\r\n\tcolor:#fff;\r\n\tfont-size:14px;\r\n\tpadding:2px 8px;\r\n\tborder-radius: 99px;\r\n}\r\n</style>\r\n\r\n</body>\r\n</html>"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 120.2939453125,
          "content": "**【[源GitHub仓库](https://github.com/xiangyuecn/Recorder)】 | 【[Gitee镜像库](https://gitee.com/xiangyuecn/Recorder)】本文档中默认使用[github.io部署的链接](https://xiangyuecn.github.io/Recorder/)，如果无法访问，请直接下载仓库源码到本地然后双击打开html文件访问。**\n\n\n# :open_book:Recorder用于html5录音\n\n支持在大部分已实现`getUserMedia`的移动端、PC端浏览器麦克风录音、实时处理，主要包括：Chrome、Firefox、Safari、iOS 14.3+、Android WebView、腾讯Android X5内核(QQ、微信、小程序WebView)、Electron、大部分2021年后更新的Android手机自带浏览器、2024年后更新的Android版UC内核(UC、支付宝、钉钉)；不支持：~~老旧国产手机自带浏览器、老旧iOS(11.0-14.2)上除Safari外的其他任何形式的浏览器~~。\n\n支持在非浏览器环境中使用部分功能（如nodejs、各种使用js来构建的程序），使用[RecordApp](./app-support-sample)可在微信小程序、uni-app中直接录音。\n\n支持对任意`MediaStream`进行音频录制、实时处理，包括：`getUserMedia返回的流`、`WebRTC中的remote流`、`audio、video标签的captureStream方法返回的流`、`自己创建的流` 等等。\n\n提供多个插件功能支持，拥有丰富的音频可视化、变速变调处理、语音识别、音频流播放等；搭配上强大的实时处理支持，可用于各种网页应用：从简单的录音，到复杂的实时语音识别（ASR），甚至音频相关的游戏，都能从容应对；提供转码支持，允许将录制的buffers数据或任意pcm数据转码成你需要的格式（参考`rec.mock`方法）。\n\n主要用于语音录制，因此仅对**单声道**进行支持（未适配双声道），支持超长时间录音（参考`rec.buffers`）；默认输出mp3格式，另外可选wav、pcm、g711a、g711u、ogg、amr、webm(beta)格式，支持任意格式扩展（前提有相应编码器）；使用recorder.mp3.min.js（150kb）即可录制mp3，使用recorder.wav.min.js（25kb）即可录制wav；均支持实时转码和实时传输。\n\n音频文件的上传和播放：可直接使用常规的`Audio HTML标签`来播放完整的音频文件，参考文档下面的【快速使用】部分，有上传和播放例子；上传了的录音直接将音频链接赋值给`audio.src`即可播放；本地的`blob音频文件`可通过`URL.createObjectURL`来生成本地链接赋值给`audio.src`即可播放，或者将blob对象直接赋值给`audio.srcObject`（兼容性没有src高）。实时的音频片段文件播放，可以使用本库自带的`BufferStreamPlayer`插件来播放，简单高效，或者采用别的途径播放。\n\n**如需录音功能定制开发，网站、App、小程序、前端后端开发等需求，请加本文档下面的QQ群，联系群主（即作者），谢谢~**\n\n\n[​](?)\n\n**Recorder H5** ：\n[ [H5在线测试](https://xiangyuecn.github.io/Recorder/) ]\n[ [H5 QuickStart](https://xiangyuecn.github.io/Recorder/QuickStart.html) ]\n[ [H5 vue](https://xiangyuecn.github.io/Recorder/assets/demo-vue/) ]\n[ [H5 ts](https://xiangyuecn.github.io/Recorder/assets/demo-ts/) ]\n[ [旧版本测试](https://xiangyuecn.github.io/Recorder/assets/工具-GitHub页面历史版本访问.html#url=xiangyuecn:Recorder@1.0.19120600,/) ]\n\n\n**Recorder App** ：\n[ [RecordApp测试](https://xiangyuecn.github.io/Recorder/app-support-sample/) ]\n[ [App QuickStart](https://xiangyuecn.github.io/Recorder/app-support-sample/QuickStart.html) ]\n[ [App vue](https://xiangyuecn.github.io/Recorder/assets/demo-vue/recordapp.html) ]\n[ [Android、iOS App源码](./app-support-sample) ]\n[ [微信小程序源码](./app-support-sample/miniProgram-wx) ]\n[ [uni-app源码](./app-support-sample/demo_UniApp) ]\n\n\n\n**工具集** ：\n[ [Recorder代码运行和静态分发](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html) ]\n[ [PCM转WAV播放测试和转码](https://xiangyuecn.github.io/Recorder/assets/工具-裸PCM转WAV播放测试.html) ]\n[ [无用户操作测试](https://xiangyuecn.github.io/Recorder/assets/ztest_no_user_operation.html) ]\n[ [Can I Use查看浏览器支持情况](https://caniuse.com/#search=getUserMedia) ]\n\n\n\n> [<img src=\"https://gitee.com/xiangyuecn/Recorder/raw/master/assets/demo.png\" width=\"100px\">](https://xiangyuecn.github.io/Recorder/) 手机浏览器扫一扫在线测试\n\n\n\n[​](?)\n\n### Demo片段列表\n\n1. [【教程】【PCM基础】buffers转pcm、转采样率、pcm转成其他格式等](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.pcm.basic)\n1. [【教程】【音频流】【上传】实时转码上传-实时帧回调版](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.encode_transfer_mp3)\n1. [【教程】【音频流】【上传】实时转码上传-pcm固定帧大小](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.encode_transfer_frame_pcm)\n1. [【教程】【音频流】【上传】实时转码上传-通用转码旧版](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.encode_transfer)\n1. [【教程】【音频流】【播放】实时解码播放音频片段](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.decode_buffer_stream_player)\n1. [【教程】【播放】【可视化】实时录制处理audio、video播放流](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.source_stream.capture_stream)\n1. [【教程】【ASR】实时语音识别、音频文件转文字-阿里云版](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.asr.aliyun.short)\n1. [【Demo库】【格式转换】-mp3等格式解码转成其他格式](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.transform.mp32other)\n1. [【Demo库】【格式转换】-wav格式转成其他格式](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.transform.wav2other)\n1. [【Demo库】【格式转换】-amr格式转成其他格式](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.transform.amr2other)\n1. [【Demo库】【文件合并】-mp3多个片段文件合并](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.merge.mp3_merge)\n1. [【Demo库】【文件合并】-wav多个片段文件合并](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.merge.wav_merge)\n1. [【教程】实时多路音频混音](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.mix_multiple)\n1. [【教程】变速变调音频转换](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.sonic.transform)\n1. [【教程】新录音从老录音接续、或录制中途插入音频](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.env_in.follow)\n1. [【教程】DTMF（电话拨号按键信号）解码、编码](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.dtmf.decode_and_encode)\n1. [【测试】PCM采样率转换测试](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.samplerate.raise)\n1. [【Demo库】【信号处理】IIR低通、高通滤波](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=dsp.lib.filter.iir)\n1. [【测试】【信号处理】FFT频域分析ECharts频谱曲线图](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=dsp.test.fft.analysis)\n1. [【测试】WebM格式解析并提取音频](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=test.webm.extract_audio)\n1. [【测试】G711、G72X编码和解码播放](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=test.g7xx.engine)\n1. [【Demo库】js二进制转换-Base64/Hex/Int16Array/ArrayBuffer/Blob](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.js-binary-bytes)\n1. [【测试】音乐合成-用波形函数将歌曲简谱文本转成PCM](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=test.create-audio.nmn2pcm)\n1. [【测试】音频可视化相关插件测试](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=test.extensions.visualization)\n\n\n### App Demo\nAndroid Demo App ：\n[下载APK](app-support-sample/demo_android/app-debug.apk.zip)（40kb，删除.zip后缀，\n[源码](app-support-sample/demo_android)）\n\niOS Demo App ：[下载源码](app-support-sample/demo_ios) 自行编译\n\n\n\n\n[​](?)\n\n## 【QQ群】交流与支持\n\n欢迎加QQ群：①群 781036591、②群 748359095、③群 450721519，纯小写口令：`recorder`\n\n<img src=\"https://gitee.com/xiangyuecn/Recorder/raw/master/assets/qq_group_781036591.png\" width=\"220px\">\n\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n\n<p align=\"center\"><a href=\"https://github.com/xiangyuecn/Recorder\"><img width=\"100\" src=\"https://gitee.com/xiangyuecn/Recorder/raw/master/assets/icon.png\" alt=\"Recorder logo\"></a></p>\n\n<p align=\"center\">\n  <a title=\"Stars\" href=\"https://github.com/xiangyuecn/Recorder\"><img src=\"https://img.shields.io/github/stars/xiangyuecn/Recorder?color=0b1&logo=github\" alt=\"Stars\"></a>\n  <a title=\"Forks\" href=\"https://github.com/xiangyuecn/Recorder\"><img src=\"https://img.shields.io/github/forks/xiangyuecn/Recorder?color=0b1&logo=github\" alt=\"Forks\"></a>\n  <a title=\"npm Downloads\" href=\"https://www.npmjs.com/package/recorder-core\"><img src=\"https://img.shields.io/npm/dt/recorder-core?color=0b1&logo=npm\" alt=\"npm Downloads\"></a>\n  <a title=\"npm Version\" href=\"https://www.npmjs.com/package/recorder-core\"><img src=\"https://img.shields.io/npm/v/recorder-core?color=0b1&logo=npm\" alt=\"npm Version\"></a>\n  <a title=\"License\" href=\"https://github.com/xiangyuecn/Recorder/blob/master/LICENSE\"><img src=\"https://img.shields.io/github/license/xiangyuecn/Recorder?color=0b1&logo=github\" alt=\"License\"></a>\n  <a title=\"JsDelivr CDN\" href=\"https://www.jsdelivr.com/package/gh/xiangyuecn/Recorder\"><img src=\"https://img.shields.io/badge/CDN-JsDelivr-0b1\" alt=\"JsDelivr CDN\"></a>\n  <a title=\"unpkg CDN\" href=\"https://unpkg.com/recorder-core/\"><img src=\"https://img.shields.io/badge/CDN-unpkg-0b1\" alt=\"unpkg CDN\"></a>\n  <a title=\"51LA\" href=\"https://web.51.la/report/main?comId=20469973\"><img src=\"https://img.shields.io/badge/51LA-available-0b1\" alt=\"51LA\"></a>\n</p>\n\n\n\n[​](?)\n\n# :open_book:快速使用\n\n你可以通过阅读和运行[QuickStart.html](https://xiangyuecn.github.io/Recorder/QuickStart.html)文件来快速入门学习，直接将`QuickStart.html`copy到你的(https、localhost)网站中，无需其他文件，就能正常开始测试了；**注意：需要在https、localhost等[安全环境](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Privacy_and_security)下才能进行录音。**\n\n> https环境搭建最佳实践：建议给自己的域名申请一个泛域名通配符证书（*.xxx.com），然后线上、本地开发均可使用此证书；本地开发环境直接分配一个三级域名（dev.xxx.com、local.xxx.com、192-168-1-123.xxx.com）解析A记录到电脑局域网的IP地址（192.168.1.123、127.0.0.1），方便本地开发跨端调试（本地如何配置https请针对自己的开发环境自行搜索，很容易）。\n> \n> 获取泛域名通配符证书推荐：[在线免费申请（ZeroSSL、Let’s Encrypt）](https://xiangyuecn.github.io/ACME-HTML-Web-Browser-Client/ACME-HTML-Web-Browser-Client.html)；不建议自己生成根证书来签发域名证书，一个是流程复杂，每个设备均要导入根证书，致命的是很多现代浏览器不再信任用户目录下导入的根证书（Android）。\n> \n> 如果必须http访问，Chrome中可尝试打开`chrome://flags/#unsafely-treat-insecure-origin-as-secure`，启用`Insecure origins treated as secure`，把你的地址含端口配置进去，然后重启浏览器。\n\n## 【1】加载框架\nRecorder的所有js文件均为手动引入（内部不会自动引用），因此未被你引入的文件均可删除来精简源码大小。\n\n**方式一**：使用script标签引入\n\n在需要录音功能的页面引入压缩好的recorder.xxx.min.js文件即可（CDN：[JsDelivr](https://www.jsdelivr.com/package/gh/xiangyuecn/Recorder)、[unpkg](https://unpkg.com/recorder-core/)）\n``` html\n<script src=\"recorder.mp3.min.js\"></script> <!--已包含recorder-core和mp3格式支持, CDN不稳定仅供测试: https://cdn.jsdelivr.net/gh/xiangyuecn/Recorder@latest/recorder.mp3.min.js-->\n```\n或者直接使用源码（src内的为源码、dist内的为压缩后的），可以引用src目录中的recorder-core.js+相应类型的实现文件，比如要mp3录音：\n``` html\n<script src=\"src/recorder-core.js\"></script> <!--必须引入的录音核心，CDN不稳定仅供测试: https://cdn.jsdelivr.net/gh/xiangyuecn/Recorder@latest/src/recorder-core.js-->\n\n<script src=\"src/engine/mp3.js\"></script> <!--相应格式支持文件；如果需要多个格式支持，把这些格式的编码引擎js文件放到后面统统加载进来即可-->\n<script src=\"src/engine/mp3-engine.js\"></script> <!--如果此格式有额外的编码引擎（*-engine.js）的话，必须要加上-->\n\n<script src=\"src/extensions/waveview.js\"></script>  <!--可选的插件支持项，把需要的插件按需引入进来即可-->\n```\n\n**方式二**：通过import/require引入\n\n通过 npm 进行安装 `npm install recorder-core --registry=https://registry.npmmirror.com/` ，如果直接clone的源码下面文件路径调整一下即可\n``` javascript\n//必须引入的核心，换成require也是一样的。注意：recorder-core会自动往window下挂载名称为Recorder对象，全局可调用window.Recorder，也许可自行调整相关源码清除全局污染\nimport Recorder from 'recorder-core' //注意如果未引用Recorder变量，可能编译时会被优化删除（如vue3 tree-shaking），请改成 import 'recorder-core'，或随便调用一下 Recorder.a=1 保证强引用\n\n//引入相应格式支持文件；如果需要多个格式支持，把这些格式的编码引擎js文件放到后面统统引入进来即可\nimport 'recorder-core/src/engine/mp3'\nimport 'recorder-core/src/engine/mp3-engine' //如果此格式有额外的编码引擎（*-engine.js）的话，必须要加上\n\n//以上三个也可以合并使用压缩好的recorder.xxx.min.js\n//比如 import Recorder from 'recorder-core/recorder.mp3.min' //已包含recorder-core和mp3格式支持\n\n//可选的插件支持项，把需要的插件按需引入进来即可\nimport 'recorder-core/src/extensions/waveview'\n\n//ts import 提示：npm包内已自带了.d.ts声明文件（不过是any类型）\n```\n\n## 【2】调用录音，播放结果\n[​](?Ref=Codes&Start)这里假设只录3秒，录完后立即播放，[在线编辑运行此代码>>](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?idf=self_base_demo)。录音结束后得到的是Blob二进制文件对象，可以下载保存成文件、用`FileReader`读取成`ArrayBuffer`或者`Base64`给js处理，或者参考下一节上传示例直接上传。\n``` javascript\n//简单控制台直接测试方法：在任意(无CSP限制)页面内加载需要的js，加载成功后再执行一次本代码立即会有效果\n//①加载Recorder+mp3：await import(\"https://unpkg.com/recorder-core/recorder.mp3.min.js\"); console.log(\"import ok\")\n//②可视化插件和显示：await import(\"https://unpkg.com/recorder-core/src/extensions/waveview.js\"); console.log(\"import ok\"); div=document.createElement(\"div\");div.innerHTML='<div style=\"height:100px;width:300px;\" class=\"recwave\"></div>';document.body.prepend(div);\n\nvar rec,processTime,wave;\n/**调用open打开录音请求好录音权限**/\nvar recOpen=function(success){//一般在显示出录音按钮或相关的录音界面时进行此方法调用，后面用户点击开始录音时就能畅通无阻了\n    rec=Recorder({ //本配置参数请参考下面的文档，有详细介绍\n        type:\"mp3\",sampleRate:16000,bitRate:16 //mp3格式，指定采样率hz、比特率kbps，其他参数使用默认配置；注意：是数字的参数必须提供数字，不要用字符串；需要使用的type类型，需提前把格式支持文件加载进来，比如使用wav格式需要提前加载wav.js编码引擎\n        ,onProcess:function(buffers,powerLevel,bufferDuration,bufferSampleRate,newBufferIdx,asyncEnd){\n            //录音实时回调，大约1秒调用12次本回调，buffers为开始到现在的所有录音pcm数据块(16位小端LE)\n            //可利用extensions/sonic.js插件实时变速变调，此插件计算量巨大，onProcess需要返回true开启异步模式\n            //可实时上传（发送）数据，配合Recorder.SampleData方法，将buffers中的新数据连续的转换成pcm上传，或使用mock方法将新数据连续的转码成其他格式上传，可以参考文档里面的：Demo片段列表 -> 实时转码并上传-通用版；基于本功能可以做到：实时转发数据、实时保存数据、实时语音识别（ASR）等\n            processTime=Date.now();\n\n            //可实时绘制波形（extensions目录内的waveview.js、wavesurfer.view.js、frequency.histogram.view.js插件功能）\n            wave&&wave.input(buffers[buffers.length-1],powerLevel,bufferSampleRate);\n        }\n    });\n\n    rec.open(function(){//打开麦克风授权获得相关资源\n        //rec.start() 此处可以立即开始录音，但不建议这样编写，因为open是一个延迟漫长的操作，通过两次用户操作来分别调用open和start是推荐的最佳流程\n\n        //创建可视化，指定一个要显示的div\n        if(Recorder.WaveView)wave=Recorder.WaveView({elem:\".recwave\"});\n        success&&success();\n    },function(msg,isUserNotAllow){//用户拒绝未授权或不支持\n        console.log((isUserNotAllow?\"UserNotAllow，\":\"\")+\"无法录音:\"+msg);\n    });\n};\n\n/**开始录音**/\nfunction recStart(){//打开了录音后才能进行start、stop调用\n    rec.start();\n    \n    //【稳如老狗WDT】可选的，监控是否在正常录音有onProcess回调，如果长时间没有回调就代表录音不正常\n    var wdt=rec.watchDogTimer=setInterval(function(){\n        if(!rec || wdt!=rec.watchDogTimer){ clearInterval(wdt); return } //sync\n        if(Date.now()<rec.wdtPauseT) return; //如果暂停录音了就不检测：puase时赋值rec.wdtPauseT=Date.now()*2（永不监控），resume时赋值rec.wdtPauseT=Date.now()+1000（1秒后再监控）\n        if(Date.now()-(processTime||startTime)>1500){ clearInterval(wdt);\n            console.error(processTime?\"录音被中断\":\"录音未能正常开始\");\n            // ... 错误处理，关闭录音，提醒用户\n        }\n    },1000);\n    var startTime=Date.now(); rec.wdtPauseT=0; processTime=0;\n};\n\n/**结束录音**/\nfunction recStop(){\n    rec.watchDogTimer=0; //停止监控onProcess超时\n    rec.stop(function(blob,duration){\n        \n        //简单利用URL生成本地文件地址，注意不用了时需要revokeObjectURL，否则霸占内存\n        //此地址只能本地使用，比如赋值给audio.src进行播放，赋值给a.href然后a.click()进行下载（a需提供download=\"xxx.mp3\"属性）\n        var localUrl=(window.URL||webkitURL).createObjectURL(blob);\n        console.log(blob,localUrl,\"时长:\"+duration+\"ms\");\n        rec.close();//释放录音资源，当然可以不释放，后面可以连续调用start；但不释放时系统或浏览器会一直提示在录音，最佳操作是录完就close掉\n        rec=null;\n        \n        //已经拿到blob文件对象想干嘛就干嘛：立即播放、上传、下载保存\n        \n        /*** 【立即播放例子】 ***/\n        var audio=document.createElement(\"audio\");\n        document.body.prepend(audio);\n        audio.controls=true;\n        audio.src=localUrl;\n        audio.play();\n    },function(msg){\n        console.log(\"录音失败:\"+msg);\n        rec.close();//可以通过stop方法的第3个参数来自动调用close\n        rec=null;\n    });\n};\n\n\n//这里假设立即运行，只录3秒，录完后立即播放，本段代码copy到控制台内可直接运行\nrecOpen(function(){\n    recStart();\n    setTimeout(recStop,3000);\n});\n```\n[​](?RefEnd)\n\n\n[​](?)\n\n## 【附】录音上传示例\n``` javascript\nvar TestApi=\"/test_request\";//用来在控制台network中能看到请求数据，测试的请求结果无关紧要\nvar rec=Recorder();rec.open(function(){rec.start();setTimeout(function(){rec.stop(function(blob,duration){\n//-----↓↓↓以下才是主要代码↓↓↓-------\n\n//本例子假设使用jQuery封装的请求方式，实际使用中自行调整为自己的请求方式\n//录音结束时拿到了blob文件对象，可以用FileReader读取出内容，或者用FormData上传\nvar api=TestApi;\n\n/***方式一：将blob文件转成base64纯文本编码，使用普通application/x-www-form-urlencoded表单上传***/\nvar reader=new FileReader();\nreader.onloadend=function(){\n    $.ajax({\n        url:api //上传接口地址\n        ,type:\"POST\"\n        ,data:{\n            mime:blob.type //告诉后端，这个录音是什么格式的，可能前后端都固定的mp3可以不用写\n            ,upfile_b64:(/.+;\\s*base64\\s*,\\s*(.+)$/i.exec(reader.result)||[])[1] //录音文件内容，后端进行base64解码成二进制\n            //...其他表单参数\n        }\n        ,success:function(v){\n            console.log(\"上传成功\",v);\n        }\n        ,error:function(s){\n            console.error(\"上传失败\",s);\n        }\n    });\n};\nreader.readAsDataURL(blob);\n\n/***方式二：使用FormData用multipart/form-data表单上传文件***/\nvar form=new FormData();\nform.append(\"upfile\",blob,\"recorder.mp3\"); //和普通form表单并无二致，后端接收到upfile参数的文件，文件名为recorder.mp3\n//...其他表单参数\n$.ajax({\n    url:api //上传接口地址\n    ,type:\"POST\"\n    ,contentType:false //让xhr自动处理Content-Type header，multipart/form-data需要生成随机的boundary\n    ,processData:false //不要处理data，让xhr自动处理\n    ,data:form\n    ,success:function(v){\n        console.log(\"上传成功\",v);\n    }\n    ,error:function(s){\n        console.error(\"上传失败\",s);\n    }\n});\n\n//-----↑↑↑以上才是主要代码↑↑↑-------\n},function(msg){console.log(\"录音失败:\"+msg);});},3000);},function(msg){console.log(\"无法录音:\"+msg);});\n```\n\n\n[​](?)\n\n## 【附】js中的二进制基础知识：Uint8Array Int16Array ArrayBuffer Blob/File\n更多js二进制数据基础知识请阅读：[js二进制转换-Base64/Hex/Int16Array/ArrayBuffer/Blob](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.js-binary-bytes)\n``` javascript\n//XMLHttpRequest、WebSocket等一般都能直接send(TypedArray/ArrayBuffer/Blob)到服务器，服务器会收到二进制数据\n//TypedArray/ArrayBuffer在绝大部分js运行环境中都支持，Blob只在浏览器中支持\n\n//Recorder的buffers是pcm数组，单个pcm是Int16Array（TypedArray子类）\nvar arrayBuffer=pcm.buffer; //pcm的Int16Array转ArrayBuffer\nvar pcm=new Int16Array(arrayBuffer); //pcm的ArrayBuffer转成Int16Array（共享内存，arrayBuffer.slice(0)截取新的不共享）\n\n//Recorder的takeoffEncodeChunk得到的chunkBytes是Uint8Array（TypedArray子类，类似于无符号byte[]）\nvar arrayBuffer=chunkBytes.buffer; //chunkBytes的Uint8Array转ArrayBuffer\nvar chunkBytes=new Uint8Array(arrayBuffer); //任意ArrayBuffer均能转成Uint8Array\n\n//ArrayBuffer 与 Blob/File 可以相互转换，File是Blob的一个特例（子类）\nvar blob=new Blob([arrayBuffer],{type:\"audio/mp3\"});\nvar file=new File([arrayBuffer],\"xxx.mp3\");\nvar arrayBuffer=reader.result; //用FileReader的readAsArrayBuffer方法读取 Blob/File 成ArrayBuffer\n\n//二进制拼接合并，下面Int16Array换成Uint8Array等其他TypedArray也是一样的\nvar pcm1=new Int16Array([1,2]),pcm2=new Int16Array([3,4,5,6]);\nvar pcm=new Int16Array(pcm1.length+pcm2.length);\npcm.set(pcm1,0); //写入pcm1到开头位置\npcm.set(pcm2,pcm1.length); //写入pcm2到pcm1后面，完成拼接\n```\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n## 【附】Android App - WebView中录音示例\n[app-support-sample/demo_android](app-support-sample/demo_android)目录中提供了Android测试项目源码（如果不想自己打包可以用打包好的apk来测试，demo_android目录下的`app-debug.apk.zip`，自行去掉.zip后缀）。\n\n在Android App WebView中使用本库来H5录音，需要在App源码中实现以下几部分：\n\n1. 在`AndroidManifest.xml`声明需要用到的两个权限，第二个也必须的\n``` xml\n<uses-permission android:name=\"android.permission.RECORD_AUDIO\"/>\n<uses-permission android:name=\"android.permission.MODIFY_AUDIO_SETTINGS\"/>\n```\n\n2. WebView的WebChromeClient中实现`onPermissionRequest`网页授权请求\n\n如果未实现此方法，WebView默认会拒绝H5录音权限；onPermissionRequest中需要先获取App的系统录音权限（Activity里面必须先用this.checkSelfPermission检测权限，否则直接this.requestPermissions会造成WebView触发touchcancel打断长按），然后再grant网页权限，可参考Android Demo中的[MainActivity.java](app-support-sample/demo_android/app/src/main/java/com/github/xianyuecn/recorder/MainActivity.java)中的实现代码。\n\n注：如果应用的`腾讯X5内核`，可能还须提供`android.permission.CAMERA`权限，和调用`webView.setWebChromeClientExtension`来重写X5的`IX5WebChromeClientExtension.onPermissionRequest`方法来进行权限处理\n\n3. 如需后台录音，还需要实现Android后台录音保活服务\n\n自`Android 9`开始，为了保护用户隐私，锁屏或进入后台一段时间后App可能会被禁止访问麦克风、摄像头等功能，导致无法录音、或录音数据全部是静音，因此需要使用保活机制才能在后台录音，详细请参考[app-support-sample/demo_android](app-support-sample/demo_android)，里面专门有一个章节讲解保活。\n\n\n[​](?)\n\n## 【附】iOS App - WebView中录音示例\n[app-support-sample/demo_ios](app-support-sample/demo_ios)目录中提供了iOS测试项目源码（需自行用xcode编译运行）。\n\n在iOS App WebView中使用本库来录音，需要在App源码 `Info.plist` 中声明使用麦克风 `NSMicrophoneUsageDescription`，无需其他处理，WebView会自己处理好录音权限；注意：iOS App需要在项目Background Modes中勾选Audio才能在后台保持录音，不然App切到后台后立马会停止录音。\n\niOS 14.3+以上版本才支持WebView中进行H5录音。\n\niOS 15+以上版本提供了静默授权支持，需要WKWebView的uiDelegate实现[WKUIDelegate requestMediaCapturePermissionFor接口](https://developer.apple.com/documentation/webkit/wkuidelegate)，可参考iOS Demo中的[MainView.swift](app-support-sample/demo_ios/recorder/MainView.swift)中的代码；如果未实现，会导致H5录音每次打开页面后第一次录音时、或长时间无操作再打开录音时均会弹出录音权限对话框。\n\niOS 11.0-14.2：纯粹的H5录音在iOS WebView中是不支持的，需要有Native层的支持，具体参考RecordApp中的[app-support-sample/demo_ios](app-support-sample/demo_ios)测试项目源码。\n\n\n[​](?)\n\n## 【附】微信小程序中录音集成参考\n`RecordApp`支持在微信小程序中直接进行录音，请参考小程序Demo项目：[miniProgram-wx](./app-support-sample/miniProgram-wx)。\n\n[不推荐] 如果仅使用`Recorder`的话，将只能在H5页面中使用，然后在小程序的`web-view`中显示这个H5，和普通浏览器没有区别。\n\n\n[​](?)\n\n## 【附】Electron程序中录音集成参考\n在Electron BrowserWindow中使用本库来录音，需要程序本身先获得录音权限；在调用`open`打开录音前，需要先到主进程使用 `systemPreferences.getMediaAccessStatus('microphone')` 判断程序是否有录音权限，如果是未申请权限，需要调用 `systemPreferences.askForMediaAccess('microphone')` 来请求权限；程序有权限后，即可和普通网页一样正常的录音。\n\n\n[​](?)\n\n## 【附】uni-app集成参考\n`RecordApp`支持在uni-app中直接进行录音，支持编译成：H5、Android App、iOS App、微信小程序，请参考Demo项目和文档：[demo_UniApp](./app-support-sample/demo_UniApp)，对应的组件可到[DCloud 插件市场下载](https://ext.dcloud.net.cn/plugin?name=Recorder-UniCore)。\n\n[不推荐] 如果仅使用`Recorder`的话，因为uni-app中的`renderjs`是直接运行在视图层WebView中的，因此可以通过在`renderjs`中加载Recorder来进行录音；此方法支持App、H5，但不支持小程序。同时需要注意在开发App平台的代码时，需在调用`rec.open`前，在原生层获取到录音权限；和上面的Android和iOS一样先配置好录音权限声明，再调用权限请求接口（iOS的WebView会自动处理可以不请求），在逻辑层中编写js权限处理代码。\n\n\n\n\n\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n# :open_book:需要注意的细节和问题\n\n本库期待的使用场景是语音录制，因此音质只要不比高品质的感觉差太多就行；1分钟的语音进行编码是很快的，但如果录制超长的录音，比如10分钟以上，不同类型格式的编码可能会花费比较长的时间，大部分编码器支持边录边转码(Worker)，因此录音时转码速度极快。另外未找到双声道语音录制存在的意义（翻倍录音数据大小，并且拉低音质），因此特意仅对单声道进行支持。\n\n\n浏览器Audio Media[兼容性](https://developer.mozilla.org/en-US/docs/Web/HTML/Supported_media_formats#Browser_compatibility)mp3最好，wav还行，其他要么不支持播放，要么不支持编码；因此本库最佳推荐使用mp3、wav格式，代码也是优先照顾这两种格式。\n\n`getUserMedia`的浏览器支持情况和兼容性，可到[Can I use](https://caniuse.com/?search=getUserMedia)查看。\n\n\n**留意中途来电话**：在移动端录音时，如果录音中途来电话，或者通话过程中打开录音，是不一定能进行录音的；经过简单测试发现，iOS上Safari将暂停返回音频数据，直到通话结束才开始继续有音频数据返回；小米上Chrome不管是来电还是通话中开始录音都能对麦克风输入的声音进行录音；只是简单测试，更多机器和浏览器并未做测试，不过整体上来看来电话或通话中进行录音的可行性并不理想，也不赞成在这种过程中进行录音；但只要通话结束后录音还是会正常进行，影响基本不大。\n\n**录音时对播放音频的影响**：仅在移动端，如果录音配置中未禁用降噪+回声消除（浏览器默认开启降噪+回声），打开录音后，如果同时播放音频，此时系统播放音量可能会变得很小，关闭录音后一般可恢复音量；PC上 和 禁用降噪+回声消除后 似乎无此影响，但iOS上如果禁用又可能会导致无法正常录音，详细请阅读配置文档中的`audioTrackSet`参数说明。\n\n**移动端锁屏录音**：手机锁屏后浏览器的运行状态是一个玄学，是否能录音不可控；不同手机、甚至同一手机在不同状态下，有可能能录又有可能不能录，且无法检测；可以调用 `navigator.wakeLock` 来阻止手机自动锁屏，不支持的直接简单粗暴的 循环+静音 播放一段视频，来阻止锁屏，就是有点费电，具体实现可参考H5在线测试页面内的`wakeLockClick`方法。\n\n**特别注**：如果在`iframe`里面调用的录音功能，并且和上层的网页是不同的域（跨域了），如果未设置相应策略，权限永远是被拒绝的，[参考此处](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Privacy_and_security)。另外如果要在`非跨域的iframe`里面使用，最佳实践应该是让window.top去加载Recorder（异步加载js），iframe里面使用top.Recorder，免得各种莫名其妙。\n\n\n\n\n\n## 已知问题\n\n> 此处已清除7个已知问题，大部分无法解决的问题会随着时间消失；问题主要集中在iOS部分版本上（不同系统版本问题不重样），好在这玩意能更新\n\n*2024-09-09* [#230](https://github.com/xiangyuecn/Recorder/issues/230) 已知open源码中的`trackSet[sampleRateTxt]=...`强制设置采样率会导致部分设备无法正常打开麦克风，导致录音无声（或无法使用蓝牙等外设），~~需要修改源码去掉这行源码，同时设置`Recorder.ConnectEnableWebM=false`，~~ 241020版本开始已移除此代码进行了修复，并增强了MediaRecorder的支持。\n\n*2024-09-09* 部分iOS上（含新系统）第二次打开录音后无法正常开始录音，~~在开始录音前调用一次`Recorder.Destroy()`清除掉已打开的`AudioContext`可能会恢复正常~~，241020版本开始将不再保留打开状态的Recorder.Ctx。\n\n*2023-12-06* iOS上反复弹出的权限弹框：据QQ群内`1806152243`开发者反馈，进入页面打开一次录音并关闭后，如果没有在页面上进行任何用户交互操作（点击、触摸、滑动等），大约35秒左右之后，重新打开录音时，浏览器将会再次弹出录音权限对话框；iOS Safari上稳定复现；这是浏览器自己的行为，js无法控制，设计交互逻辑时应当注意。\n\n*2023-02-22* iPhone 14：~~有部分开发者反馈iPhone14上关闭录音后再次打开录音，会出现无法录音的情况，目前并不清楚是只有iPhone14上有问题，还是iOS16均有问题；估计是新的WebKit改了相关源码印度阿三没有测试，js没办法解决此问题，静候iOS更新，也许下一个系统更新就自动修复了；建议针对iOS环境，全局只open一次，不要close，挂在那里录音，可减少iOS系统问题带来的影响（负优化+耗电）。~~ 2023-7-1，此问题已修复，原因出在AudioContext上，iOS新版本上似乎不能共用一个AudioContext（新版本每次open均会创建新的AudioContext），并且iOS上AudioContext的resume行为和其他浏览器不相同，如果不是通过用户操作（触摸、点击等）进行调用，将无法resume，参考 [ztest_AudioContext_resume.html](https://xiangyuecn.github.io/Recorder/assets/ztest_AudioContext_resume.html) 测试用例。\n\n*2020-04-26* Safari Bug：据QQ群内`1048506792`、`190451148`开发者反馈研究发现，IOS ?-13.X Safari内打开录音后，如果切换到了其他标签、或其他App并且播放了任何声音，此时将会中断已打开的录音（系统级的？），切换回正在录音的页面，这个页面的录音功能将会彻底失效，并且刷新也无法恢复录音；表现为关闭录音后再次打开录音，能够正常获得权限，但浏览器返回的采集到的音频为静默的PCM，此时地址栏也并未显示出麦克风图标，刷新这个标签也也是一样不能正常获得录音，只有关掉此标签新打开页面才可正常录音。如果打开录音后关闭了录音，然后切换到其他标签或App播放声音，然后返回录音页面，不会出现此问题。此为Safari的底层Bug。使用长按录音类似的用户交互可大幅度避免踩到这坨翔。\n\n\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n# :open_book:方法文档\n\n![](assets/use_caller.png)\n\n### 【构造】rec=Recorder(set)\n\n构造函数，拿到`Recorder`的实例，然后可以进行请求获取麦克风权限和录音。\n\n`set`参数为配置对象，默认配置值如下：\n``` javascript\nset={\n    type:\"mp3\" //输出类型：mp3,wav等，使用一个类型前需要先引入对应的编码引擎\n    ,bitRate:16 //比特率，必须是数字 wav(位):16、8，MP3(单位kbps)：8kbps时文件大小1k/s，16kbps 2k/s，录音文件很小\n    \n    ,sampleRate:16000 //采样率，必须是数字，wav格式（8位）文件大小=sampleRate*时间；mp3此项对低比特率文件大小有影响，高比特率几乎无影响。\n                //wav任意值，mp3取值范围：48000, 44100, 32000, 24000, 22050, 16000, 12000, 11025, 8000\n    \n    ,onProcess:NOOP //接收到录音数据时的回调函数：fn(buffers,powerLevel,bufferDuration,bufferSampleRate,newBufferIdx,asyncEnd)\n                //返回值：onProcess如果返回true代表开启异步模式，在某些大量运算的场合异步是必须的，必须在异步处理完成时调用asyncEnd(不能真异步时需用setTimeout包裹)；返回其他值或者不返回为同步模式（需避免在回调内执行耗时逻辑）；如果开启异步模式，在onProcess执行后新增的buffer会全部替换成空数组，因此本回调开头应立即将newBufferIdx到本次回调结尾位置的buffer全部保存到另外一个数组内，处理完成后写回buffers中本次回调的结尾位置。\n                //buffers=[[Int16,...],...]：缓冲的PCM数据块(16位小端LE)，为从开始录音到现在的所有pcm片段，每次回调可能增加0-n个不定量的pcm片段。\n                    //注意：buffers数据的采样率为bufferSampleRate，它和set.sampleRate不一定相同，可能为浏览器提供的原始采样率rec.srcSampleRate，也可能为已转换好的采样率set.sampleRate；如需浏览器原始采样率的数据，请使用rec.buffers原始数据，而不是本回调的参数；如需明确和set.sampleRate完全相同采样率的数据，请在onProcess中自行连续调用采样率转换函数Recorder.SampleData()，配合mock方法可实现实时转码和压缩语音传输；修改或替换buffers内的数据将会改变最终生成的音频内容（注意不能改变第一维数组长度），比如简单有限的实现实时静音、降噪、混音等处理，详细参考下面的rec.buffers\n                //powerLevel：当前缓冲的音量级别0-100。\n                //bufferDuration：已缓冲时长。\n                //bufferSampleRate：buffers缓存数据的采样率（当type支持边录边转码(Worker)时，此采样率和设置的采样率相同，否则不一定相同）。\n                //newBufferIdx:本次回调新增的buffer起始索引。\n                //asyncEnd：fn() 如果onProcess是异步的(返回值为true时)，处理完成时需要调用此回调，如果不是异步的请忽略此参数，此方法回调时必须是真异步（不能真异步时需用setTimeout包裹）。\n                //如果需要绘制波形之类功能，需要实现此方法即可，使用以计算好的powerLevel可以实现音量大小的直观展示，使用buffers可以达到更高级效果\n                //如果需要实时上传（发送）之类的，可以配合Recorder.SampleData方法，将buffers中的新数据连续的转换成pcm，或使用mock方法将新数据连续的转码成其他格式，可以参考文档里面的：Demo片段列表 -> 实时转码并上传-通用版；基于本功能可以做到：实时转发数据、实时保存数据、实时语音识别（ASR）等\n    \n    //*******高级设置******\n        //,sourceStream:MediaStream Object\n                //可选直接提供一个媒体流，从这个流中录制、实时处理音频数据（当前Recorder实例独享此流）；不提供时为普通的麦克风录音，由getUserMedia提供音频流（所有Recorder实例共享同一个流）\n                //比如：audio、video标签dom节点的captureStream方法（实验特性，不同浏览器支持程度不高）返回的流；WebRTC中的remote流；自己创建的流等\n                //注意：流内必须至少存在一条音轨(Audio Track)，比如audio标签必须等待到可以开始播放后才会有音轨，否则open会失败\n                //注意：在rec.close时不会主动关闭此流，需自行管理关闭\n\n        //,runningContext:AudioContext\n                //可选提供一个state为running状态的AudioContext对象(ctx)；默认会在rec.open时自动创建一个新的ctx，无用户操作（触摸、点击等）时调用rec.open的ctx.state可能为suspended，会在rec.start时尝试进行ctx.resume，如果也无用户操作ctx.resume可能不会恢复成running状态（目前仅iOS上有此兼容性问题），导致无法去读取媒体流，这时请提前在用户操作时调用Recorder.GetContext(true)来得到一个running状态AudioContext（用完需调用CloseNewCtx(ctx)关闭）\n\n        /*,audioTrackSet:{\n             deviceId:\"\",groupId:\"\" //指定设备的麦克风，通过navigator.mediaDevices.enumerateDevices拉取设备列表，其中kind为audioinput的是麦克风\n            ,echoCancellation:true //回声消除（AEC）开关，不设置时由浏览器控制（一般为默认自动打开），设为true明确打开，设为false明确关闭\n            ,noiseSuppression:true //降噪（ANS）开关，取值和回声消除开关一样\n            ,autoGainControl:true //自动增益（AGC）开关，取值和回声消除开关一样\n        }*/\n                //普通麦克风录音时getUserMedia方法的audio配置参数；注意：不同浏览器的支持程度不同，提供的任何配置值都不一定会生效\n                //回声消除、降噪开关这些参数浏览器一般默认自动打开，移动端未明确禁用时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流）\n                //由于麦克风是全局共享的，所以新配置后需要close掉以前的再重新open\n                //同样可配置videoTrackSet，更多参考: https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints\n                \n        //,disableEnvInFix:false 内部参数，禁用设备卡顿时音频输入丢失补偿功能，如果不清楚作用请勿随意使用\n        \n        //,takeoffEncodeChunk:NOOP //fn(chunkBytes) chunkBytes=[Uint8,...]：实时编码环境下接管编码器输出，当编码器实时编码出一块有效的二进制音频数据时实时回调此方法；参数为二进制的Uint8Array，就是编码出来的音频数据片段，所有的chunkBytes拼接在一起即为完整音频。本实现的想法最初由QQ2543775048提出。\n                //当提供此回调方法时，将接管编码器的数据输出，编码器内部将放弃存储生成的音频数据；如果当前编码器或环境不支持实时编码处理，将在open时直接走fail逻辑\n                //因此提供此回调后调用stop方法将无法获得有效的音频数据，因为编码器内没有音频数据，因此stop时返回的blob将是一个字节长度为0的blob\n                //大部分录音格式编码器都支持实时编码（边录边转码），比如mp3格式：会实时的将编码出来的mp3片段通过此方法回调，所有的chunkBytes拼接到一起即为完整的mp3，此种拼接的结果比mock方法实时生成的音质更加，因为天然避免了首尾的静默\n                //不支持实时编码的录音格式不可以提供此回调（wav格式不支持，因为wav文件头中需要提供文件最终长度），提供了将在open时直接走fail逻辑\n}\n```\n\n**注意：set内是数字的明确传数字**，不要传字符串之类的导致不可预测的异常，其他有配置的地方也是一样（感谢`214282049@qq.com`19-01-10发的反馈邮件）。\n\n*注：如果录音结束后生成的音频文件的比特率和采样率和set中的不同，将会把set中的bitRate、sampleRate更新成音频文件的。*\n\n### 【方法】rec.open(success,fail)\n普通的麦克风录音时：请求打开录音资源，如果浏览器不支持录音、用户拒绝麦克风权限、或者非安全环境（非https、file等）将会调用`fail`；打开后需要调用`close`来关闭，因为浏览器或设备的系统可能会显示正在录音。\n\n直接提供的流`set.sourceStream`时：会连接上此流进行录制，打开后同样需要调用`close`来断开连接，但不会主动关闭此流，需自行管理此sourceStream的关闭。\n\n`success`=fn();\n\n`fail`=fn(errMsg,isUserNotAllow); 如果是用户主动拒绝的录音权限，除了有错误消息外，isUserNotAllow=true，方便程序中做不同的提示，提升用户主动授权概率\n\n注意：此方法回调是可能是同步的（异常、或者已持有资源时）也可能是异步的（浏览器弹出权限请求时）；一般使用时打开，用完立即关闭；可重复调用，可用来测试是否能录音；open和start至少有一个应当在用户操作（触摸、点击等）下进行调用，原因参考`runningContext`配置。\n\n另外：普通的麦克风录音时，因为此方法会调起用户授权请求，如果仅仅想知道浏览器是否支持录音（比如：如果浏览器不支持就走另外一套录音方案），应使用`Recorder.Support()`方法。\n\n\n### 【方法】rec.close(success)\n关闭释放录音资源，释放完成后会调用`success()`回调。如果正在录音或者stop调用未完成前调用了close将会强制终止当前录音。\n\n注意：普通的麦克风录音时（所有Recorder实例共享同一个流），如果创建了多个Recorder对象并且调用了open（应避免同时有多个对象进行了open），只有最后一个新建的才有权限进行实际的资源释放（和多个对象close调用顺序无关），浏览器或设备的系统才会不再显示正在录音的提示；直接提供的流 set.sourceStream 无此问题（当前Recorder实例独享此流，会直接释放掉录制此流的相关资源），但不会主动关闭此流，需自行管理此sourceStream的关闭。\n\n### 【方法】rec.start()\n开始录音，需先调用`open`；未close之前可以反复进行调用开始新的录音。注意：open和start至少有一个应当在用户操作（触摸、点击等）下进行调用，原因参考`runningContext`配置。\n\n只要open成功后，调用此方法是安全的，如果未open强行调用导致的内部错误将不会有任何提示，stop时自然能得到错误；另外open操作可能需要花费比较长时间，如果中途调用了stop，open完成时（同步）的任何start调用将会被自动阻止，也是不会有提示的。\n\n### 【方法】rec.stop(success,fail,autoClose)\n结束录音并返回录音数据`blob文件对象`，拿到blob文件对象就可以为所欲为了，不限于立即播放、上传、下载保存。blob可以用`URL.createObjectURL`生成本地链接赋值给`audio.src`进行播放，赋值给`a.href`然后`a.click()`进行下载（a需提供`download=\"xxx.mp3\"`属性）；或用`XMLHttpRequest+FormData`、`WebSocket`直接发送到服务器，或者用`FileReader`读取成`ArrayBuffer`或者`Base64`给js处理。\n\n``` javascript\nsuccess(blob,duration,mime) //录音成功回调\n    blob：录音二进制文件数据audio/mp3|wav...格式；\n            默认是Blob对象，可设置rec.dataType=\"arraybuffer\"改成ArrayBuffer（或全局设置Recorder.DefaultDataType=\"arraybuffer\"）\n    duration：录音时长，单位毫秒\n    mime：\"auido/mp3\" blob数据的类型，方便ArrayBuffer时区分类型\n\nfail(errMsg) //录音出错回调\n\nautoClose //可选，是否自动调用`close`，默认为`false`不调用\n```\n\n注意：当创建rec时提供了takeoffEncodeChunk后，你需要自行实时保存录音文件数据，因此stop时返回的blob的长度将为0字节。\n\n提示：stop时会进行音频编码，根据类型的不同音频编码花费的时间也不相同。对于支持边录边转码(Worker)的类型，将极速完成编码并回调；对于不支持的10几秒录音花费2秒左右算是正常，但内部采用了分段编码+setTimeout来处理，界面卡顿不明显。\n\n\n### 【方法】rec.pause()\n暂停录音。\n\n### 【方法】rec.resume()\n恢复继续录音。\n\n\n### 【属性】rec.buffers\n此数据为从开始录音到现在为止的所有已缓冲的PCM片段列表(16位小端LE)，`buffers` `=` `[[Int16,...],...]` 为二维数组；在没有边录边转码的支持时（mock调用、非mp3等），录音stop时会使用此完整数据进行转码成指定的格式。\n\nrec.buffers中的PCM数据为浏览器采集的原始音频数据，采样率为浏览器提供的原始采样率`rec.srcSampleRate`；在`rec.set.onProcess`回调中`buffers`参数就是此数据或者此数据重新采样后的新数据；修改或替换`onProcess`回调中`buffers`参数可以改变最终生成的音频内容，但修改`rec.buffers`不一定会有效，因此你可以在`onProcess`中修改或替换`buffers`参数里面的内容，注意只能修改或替换上次回调以来新增的buffer（不允许修改已处理过的，不允许增删第一维数组，允许将第二维数组任意修改替换成空数组也可以）；以此可以简单有限的实现实时静音、降噪、混音等处理。\n\n如果你需要长时间实时录音（如长时间语音通话），并且不需要得到最终完整编码的音频文件：\n1. 未提供set.takeoffEncodeChunk时，Recorder初始化时应当使用一个未知的类型进行初始化（如: type:\"unknown\"，仅仅用于初始化而已，实时转码可以手动转成有效格式，因为有效格式可能内部还有其他类型的缓冲，`unknown`类型`onProcess buffers`和`rec.buffers`是同一个数组）；提供set.takeoffEncodeChunk接管了编码器实时输出时，无需特殊处理，因为编码器内部将不会使用缓冲；\n2. 实时在`onProcess`中修改`buffers`参数数组，可以只保留最后两个元素，其他元素设为null（代码：`onProcess: buffers[buffers.length-3]=null`），不保留也行，全部设为null，以释放占用的内存；`rec.buffers`将会自动清理，无需手动清理；注意：提供set.takeoffEncodeChunk时，应当延迟一下清理，不然buffers被清理掉时，这个buffers还未推入编码器进行编码；\n3. wav等不支持实时编码的格式录音结束时可以不用调用`stop`，直接调用`close`丢弃所有数据即可，因为只要buffers[0]==null时wav格式调用`stop`永远会直接走fail回调；mp3、pcm等支持实时编码的格式无此限制，且需要调用`stop`来编码输出最后一段音频数据。\n\n### 【属性】rec.dataType\nstop时返回的录音数据类型，取值：`blob`、`arraybuffer`，默认为`blob`（返回Blob文件对象）；非浏览器环境中一般需要设为`arraybuffer`（返回ArrayBuffer对象），或直接设置全局属性`Recorder.DefaultDataType`。\n\n### 【属性】rec.srcSampleRate\n浏览器提供的原始采样率，只有start或mock调用后才会有值，此采样率就是rec.buffers数据的采样率。\n\n\n### 【方法】rec.envIn(pcmData,pcmAbsSum)\n本方法是一个内部使用的最为核心方法，如果你不知道用途，请勿随意调用，配套的有私有方法`envStart(mockEnvInfo,sampleRate)`（私有方法请自行阅读源码），这两方法控制着录音的开启、实时音频输入逻辑，起到隔离平台环境差异的作用（Recorder、RecordApp共享使用了本机制，实现了录音过程和平台环境无关）。\n\n通过调用本方法，会在当前正在录制的录音中追加进新的pcm数据，每次调用本方法都会触发onProcess回调；从而可以做到：在录音过程中插入音频数据、在新的录音中注入之前老的录音的buffers数据可以做到接续录音 等业务逻辑，可参考上面的Demo片段列表中的`新录音从老录音接续、或录制中途插入音频`例子。\n\n`pcmData`：`[Int16,...]` 为一维数组，pcm音频数据的采样率必须是`rec.srcSampleRate` （如果不是，请用`Recorder.SampleData()`方法先转换好）\n\n`pcmAbsSum`：pcmData所有采样的绝对值的和，用来传递给`Recorder.PowerLevel`方法计算音量百分比，最终是给onProcess使用，如果不需要计算音量百分比，直接给0即可。\n\n\n### 【方法】rec.mock(pcmData,pcmSampleRate)\n模拟一段录音数据，后面直接调用stop进行编码得到音频文件。需提供pcm数据 `pcmData` `=` `[Int16,...]` 为Int16Array一维数组，和pcm数据的采样率 `pcmSampleRate`。调用本方法后无需调用也无法调用open、close、start等方法，只能调用stop，如果之前已经开始了录音，前面的录音数据全部会被丢弃（一般不要共用一个rec，直接创建个新的再调用mock）；本方法主要用于音频转码。\n\n提示：在录音实时回调中配合`Recorder.SampleData()`方法使用效果更佳，可实时生成小片段语音文件。\n\n**注意：pcmData为一维数组，如果提供二维数组将会产生不可预料的错误**；如果需要使用类似`onProcess`回调的`buffers`或者`rec.buffers`这种pcm列表（二维数组）时，可自行展开成一维，或者使用`Recorder.SampleData()`方法转换成一维。\n\n``` javascript\n//提供一个变量，用于连续转换buffers数据，注意开始新的转换时需要重置为null\nvar prevChunk=null;\n\n//将onProcess回调中的buffers转成pcm   onProcess(buffers,powerLevel,duration,sampleRate)\n//var chunk=Recorder.SampleData(buffers,sampleRate,sampleRate,prevChunk);\n\n//将rec.buffers转成pcm\nvar chunk=Recorder.SampleData(rec.buffers,rec.srcSampleRate,rec.srcSampleRate,prevChunk);\n\nprevChunk=chunk; //存起来，下次从当前已转换位置继续转换\n\n//这就是上面的代码自动截取到的最新未转换pcm数据\n//你也可以自行从buffers中截取出需要转码的pcm\n//或者从其他地方获取到pcm数据，比如用解码其他音频文件得到pcm，即可实现不同音频格式之间转码\nvar pcm=chunk.data; //pcm=new Int16Array(pcmArrayBuffer) 可以使用16位pcm二进制数据直接构造\nvar sampleRate=chunk.sampleRate;\n\n//调用mock方法把pcm转码成mp3或其他格式\nvar mockRec=Recorder({ type:\"mp3\",bitRate:16,sampleRate:16000 });\nmockRec.mock(pcm,sampleRate);\nmockRec.stop(function(blob,duration){\n    console.log(\"pcm已转码成mp3\",blob,duration);\n},function(msg){\n    console.error(\"不应该出现的错误:\"+msg);\n});\n```\n\n\n\n### 【静态方法】Recorder.Support()\n判断浏览器是否支持录音，随时可以调用。注意：仅仅是检测浏览器支持情况，不会判断和调起用户授权（rec.open()会判断用户授权），不会判断是否支持特定格式录音。\n\n### 【静态方法】Recorder.GetContext(tryNew)\n获取AudioContext对象，如果浏览器不支持将返回null。tryNew=false时返回全局的Recorder.Ctx，Ctx.state可能是closed，仅限用于解码等操作。tryNew=true时会尝试创建新的ctx（不支持close的老浏览器依旧返回全局的），注意用完必须自己调用CloseNewCtx(ctx)关闭；注意：非用户操作（触摸、点击等）时调用返回的ctx.state可能是suspended状态，需要在用户操作时调用ctx.resume恢复成running状态，参考rec的runningContext配置。\n\n本方法调用一次后，可通过`Recorder.Ctx`来获得全局对象，但仅可用于音频文件解码：`Recorder.Ctx.decodeAudioData(fileArrayBuffer)`。本方法是从老版本的`Recorder.Support()`中剥离出来的，调用Support会自动调用一次本方法。已知iOS16中全局对象无法多次用于录音，当前Recorder打开录音时均会尝试创建新的非全局对象，同时会保留一个全局的对象。\n\n### 【静态方法】Recorder.IsOpen()\n由于Recorder持有的普通麦克风录音资源是全局唯一的，可通过此方法检测是否有Recorder已调用过open打开了麦克风录音功能；注意：此方法无法检测直接提供的流 set.sourceStream 是否已打开，需自行判断。\n\n### 【静态方法】Recorder.Destroy()\n销毁已持有的所有全局资源（AudioContext、Worker），当要彻底移除Recorder时需要显式的调用此方法。大部分情况下不调用Destroy也不会造成问题。\n\n### 【静态方法】Recorder.CLog\n全局的日志输出函数，可赋值一个空函数来屏蔽Recorder的日志输出`Recorder.CLog=function(){}`。\n\n### 【静态属性】Recorder.TrafficImgUrl\n流量统计用1像素图片地址，在Recorder首次被实例化时将往这个地址发送一个请求，请求是通过Image对象来发送，安全可靠；默认开启统计，url为本库的51la统计用图片地址，为空响应流量消耗非常小，因此对使用几乎没有影响。\n\n设置为空字符串后将不参与统计，大部分情况下无需关闭统计，如果你网页的url私密性要求很高，请在调用Recorder之前将此url设为空字符串；本功能于2019-11-09添加，[点此](https://web.51.la/report/main?comId=20469973)前往51la查看统计概况。\n\n### 【静态属性】Recorder.i18n\n内置的简版国际化多语言支持实现，详细请参考下面的i18n章节。\n\n### 【静态属性】Recorder.DefaultDataType\n全局默认stop时返回的录音数据类型，取值：`blob`、`arraybuffer`，默认为`blob`（返回Blob文件对象），非浏览器环境中一般需要设为`arraybuffer`（返回ArrayBuffer对象）；rec实例的`dataType`属性配置优先级更高。\n\n### 【静态属性】Recorder.BufferSize\n普通的麦克风录音时全局的AudioContext缓冲大小，默认值为4096。会影响H5录音时的onProcess调用速率，相对于AudioContext.sampleRate=48000时，4096接近12帧/s（移动端帧率可能会低一些），调节此参数可生成比较流畅的回调动画。\n\n取值256, 512, 1024, 2048, 4096, 8192, or 16384\n\n注意：取值不能过低，2048开始不同浏览器可能回调速率跟不上造成音质问题。一般无需调整，调整后需要先close掉已打开的录音，再open时才会生效。\n\n*如果是直接提供的流 set.sourceStream，不是默认的从麦克风录音时，这个属性可以改成由Recorder的实例提供，比如rec.BufferSize=1024，这样就不会受全局干扰。*\n\n*这个属性在旧版Recorder中是放在已废弃的set.bufferSize中，后面因为兼容处理Safari上MediaStream断开后就无法再次进行连接使用的问题（表现为静音），把MediaStream连接也改成了全局只连接一次，因此set.bufferSize就移出来变成了Recorder的属性*\n\n### 【静态属性】Recorder.ConnectEnableWebM\n音频采集连接方式：启用时尝试使用MediaRecorder.WebM.PCM，默认为true启用，未启用或者不支持时使用AudioWorklet或过时的ScriptProcessor来连接；本连接方式仅对普通麦克风录音时有效，直接提供了流（set.sourceStream）时将当做未启用处理。\n\n使用MediaRecorder采集到的音频数据比其他方式更好，几乎不存在丢帧现象，所以音质明显会好很多，建议保持开启； 有些浏览器不支持录制PCM编码的WebM，如FireFox、低版本的Chrome，将依旧使用AudioWorklet或ScriptProcessor来连接采集。\n\n*可以额外提供一个设置`Recorder.ConnectWebMOptions={}`来当做MediaRecorder的options参数，支持的参数请参考[此文档](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaRecorder/MediaRecorder)。*\n\n> 本连接实现原理：通过MediaRecorder对MediaStream进行录制，格式`audio/webm; codecs=pcm`，MediaRecorder会将实时录制的PCM数据（48k+32位）回传给js，因此只需要知道WebM的封装格式就能提取出PCM数据，请参考测试代码：[WebM格式解析并提取音频](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=test.webm.extract_audio)\n\n\n### 【静态属性】Recorder.ConnectEnableWorklet\n音频采集连接方式：是否要启用AudioWorklet (AudioWorkletNode) 来进行连接；默认为false禁用，禁用后将使用过时的ScriptProcessor (AudioContext.createScriptProcessor) 来连接；如果启用了 Recorder.ConnectEnableWebM 并且有效时，本参数将不起作用，否则才会生效。\n\n启用后如果浏览器不支持AudioWorklet，将只会使用老的ScriptProcessor来进行音频采集连接；如果浏览器已停止支持ScriptProcessor，将永远会尝试启用AudioWorklet而忽略此配置值。\n\n*未雨绸缪，目前只需要ScriptProcessor就能做到100%兼容所有浏览器；以后就算只能用AudioWorklet时，也还是需要保留ScriptProcessor用来支持老浏览器；所以默认为禁用，现在实现AudioWorklet的目的是让代码更经得起考验。*\n\n*导致浏览器崩溃：某些浏览器的AudioWorklet和AudioContext的resume一起作用时会产生崩溃现象，错误代码：STATUS_ACCESS_VIOLATION；此坑已填好，[复现测试页面](https://xiangyuecn.github.io/Recorder/assets/ztest_chrome_bug_AudioWorkletNode.html)。*\n\n**注意：由于AudioWorklet内部[1秒会产生375次回调](https://developer.mozilla.org/en-US/docs/Web/API/AudioWorkletProcessor/process)，在移动端可能会有性能问题导致浏览器回调丢失，进而导致录音数据、时长变短，PC端似乎无此影响，可通过定时1分钟录音来检测影响（如果短了1秒以上即为有问题）；在无明显优势好处的前提下，暂不建议启用。**\n\n### 【静态方法】Recorder.SampleData(pcmDatas,pcmSampleRate,newSampleRate,prevChunkInfo,option)\n对pcm数据的采样率进行转换，可配合mock方法可转换成音频文件，比如实时转换成小片段语音文件。\n\n注意：从241020版本开始，支持任意采样率转换；之前的老版本只会将高采样率的pcm转成低采样率的pcm，老版本由低转高时不会进行转换处理。\n\n`pcmDatas`: [[Int16,...]] pcm片段列表，二维数组，比如可以是：rec.buffers、onProcess中的buffers；二维数组里面是Int16Array，也可传Float32Array（会转成Int16Array）\n\n`pcmSampleRate`:48000 pcm数据的采样率，比如用：rec.srcSampleRate、onProcess中的bufferSampleRate\n\n`newSampleRate`:16000 需要转换成的采样率，241020版本后支持转成任意采样率，之前老版本仅支持转成低采样率<=pcmSampleRate\n\n`prevChunkInfo`:{} 可选，上次调用时的返回值，用于连续转换，本次调用将从上次结束位置开始进行处理。或可自行定义一个ChunkInfo从pcmDatas指定的位置开始进行转换\n\n`option`:\n``` javascript\n    option:{ 可选，配置项\n        frameSize:123456 帧大小，每帧的PCM Int16的数量，采样率转换后的pcm长度为frameSize的整数倍，用于连续转换。目前仅在mp3格式时才有用，frameSize取值为1152，这样编码出来的mp3时长和pcm的时长完全一致，否则会因为mp3最后一帧录音不够填满时添加填充数据导致mp3的时长变长。\n        frameType:\"\" 帧类型，一般为rec.set.type，提供此参数时无需提供frameSize，会自动使用最佳的值给frameSize赋值，目前仅支持mp3=1152(MPEG1 Layer3的每帧采采样数)，其他类型=1。\n            以上两个参数用于连续转换时使用，最多使用一个，不提供时不进行帧的特殊处理，提供时必须同时提供prevChunkInfo才有作用。最后一段数据处理时无需提供帧大小以便输出最后一丁点残留数据。\n    }\n```\n\n返回值ChunkInfo\n``` javascript\n{\n    //可定义，从指定位置开始转换到结尾\n    index:0 pcmDatas已处理到的索引；比如每次都是单个pcm需要连续处理时，可每次调用前重置成0，pcmDatas仅需传入`[pcm]`固定一个元素\n    offset:0.0 已处理到的index对应的pcm中的偏移的下一个位置（提升采样率时为结果的pcm）\n    raisePrev:null 提升采样率时的前一个pcm结果采样值\n    \n    //可定义，指定的一个滤波配置：默认使用Recorder.IIRFilter低通滤波（可有效抑制混叠产生的杂音，小采样率大于高采样率的75%时不默认滤波），如果提供了配置但fn为null时将不滤波；sr、srn为此滤波函数对应的初始化采样率，当采样率和参数的不一致时将重新设为默认函数\n    filter:null||{fn:fn(sample),sr:pcmSampleRate,srn:newSampleRate}\n    \n    //仅作为返回值\n    frameNext:null||[Int16,...] 下一帧的部分数据，frameSize设置了的时候才可能会有\n    sampleRate:16000 结果的采样率=newSampleRate，241020版本前的老版本<=newSampleRate\n    data:[Int16,...] 转换后的PCM结果(16位小端LE)，为一维数组，可直接new Blob([data],{type:\"audio/pcm\"})生成Blob文件，或者使用mock方法转换成其他音频格式；注意：如果是连续转换，并且pcmDatas中并没有新数据时，data的长度可能为0\n}\n```\n\n\n### 【静态方法】Recorder.IIRFilter(useLowPass,sampleRate,freq)\nIIR低通、高通滤波；可重新赋值一个函数，来改变Recorder的默认行为，比如SampleData中的低通滤波。返回的是一个函数，用此函数对pcm的每个采样值按顺序进行处理即可（不同pcm不可共用）；注意此函数返回值可能会越界超过Int16范围，自行限制一下即可：Math.min(Math.max(val,-0x8000),0x7FFF)。\n\n`useLowPass`: true或false，true为低通滤波，false为高通滤波\n\n`sampleRate`: 待处理pcm的采样率\n\n`freq`: 截止频率Hz，最大频率为sampleRate/2，低通时会切掉高于此频率的声音，高通时会切掉低于此频率的声音，注意滤波并非100%的切掉不需要的声音，而是减弱频率对应的声音，离截止频率越远对应声音减弱越厉害，离截止频率越近声音就几乎无衰减\n\n\n### 【静态方法】Recorder.PowerLevel(pcmAbsSum,pcmLength)\n计算音量百分比的一个方法，返回值：0-100，主要当做百分比用；注意：这个不是分贝，因此没用volume当做名称。\n\n`pcmAbsSum`: pcm Int16所有采样的绝对值的和\n\n`pcmLength`: pcm长度\n\n\n### 【静态方法】Recorder.PowerDBFS(maxSample)\n计算音量，单位dBFS（满刻度相对电平），返回值：-100~0 （最大值0dB，最小值-100代替-∞）。\n\n`maxSample`: 为16位pcm采样的绝对值中最大的一个（计算峰值音量），或者为pcm中所有采样的绝对值的平局值\n\n\n\n\n\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n\n# :open_book:Extensions - 插件文档\n在`src/extensions`目录内为插件支持库，这些插件库默认都没有合并到生成代码中，需单独引用(`dist`或`src`中的)才能使用。\n\n【可移植】大部分可视化插件均可以移植到其他语言环境，比如：Android、iOS原生实现，如需定制可联系作者。\n\n【附】部分插件使用效果图（[在线运行观看](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=test.extensions.visualization)）：\n\n![](assets/use_wave.gif)\n\n\n[​](?)\n\n[​](?)\n\n## WaveView插件\n[waveview.js](src/extensions/waveview.js)，7kb大小源码，录音时动态显示波形，具体样子参考演示地址页面。此插件参考[MCVoiceWave](https://github.com/HaloMartin/MCVoiceWave)库编写的，具体代码在`https://github.com/HaloMartin/MCVoiceWave/blob/f6dc28975fbe0f7fc6cc4dbc2e61b0aa5574e9bc/MCVoiceWave/MCVoiceWaveView.m`中；本可视化插件可以移植到其他语言环境，如需定制可联系作者。\n\n此插件是在录音时`onProcess`回调中使用。基础使用方法：\n``` javascript\nvar wave;\nvar rec=Recorder({\n    onProcess:function(buffers,powerLevel,bufferDuration,bufferSampleRate){\n        wave.input(buffers[buffers.length-1],powerLevel,bufferSampleRate);//输入音频数据，更新显示波形\n    }\n});\nrec.open(function(){\n    wave=Recorder.WaveView({elem:\".elem\"}); //创建wave对象，写这里面浏览器妥妥的\n    \n    rec.start();\n});\n```\n\n\n### 【构造】wave=Recorder.WaveView(set)\n构造函数，`set`参数为配置对象，默认配置值如下：\n``` javascript\nset={\n    elem:\"css selector\" //自动显示到dom，并以此dom大小为显示大小\n        //或者配置显示大小，手动把waveviewObj.elem显示到别的地方\n    ,width:0 //显示宽度\n    ,height:0 //显示高度\n//H5环境以上配置二选一\n\n    compatibleCanvas: CanvasObject //提供一个兼容H5的canvas对象，需支持getContext(\"2d\")，支持设置width、height，支持drawImage(canvas,...)\n    ,width:0 //canvas显示宽度\n    ,height:0 //canvas显示高度\n//非H5环境使用以上配置，比如微信小程序、uni-app\n    \n    ,scale:2 //缩放系数，应为正整数，使用2(3? no!)倍宽高进行绘制，避免移动端绘制模糊\n    ,speed:9 //移动速度系数，越大越快\n    ,phase:21.8 //相位，调整了速度后，调整这个值得到一个看起来舒服的波形\n    \n    ,fps:20 //绘制帧率，调整后也需调整phase值\n    ,keep:true //当停止了input输入时，是否保持波形，设为false停止后将变成一条线\n    \n    ,lineWidth:3 //线条基础粗细\n            \n    //渐变色配置：[位置，css颜色，...] 位置: 取值0.0-1.0之间\n    ,linear1:[0,\"rgba(150,96,238,1)\",0.2,\"rgba(170,79,249,1)\",1,\"rgba(53,199,253,1)\"] //线条渐变色1，从左到右\n    ,linear2:[0,\"rgba(209,130,255,0.6)\",1,\"rgba(53,199,255,0.6)\"] //线条渐变色2，从左到右\n    ,linearBg:[0,\"rgba(255,255,255,0.2)\",1,\"rgba(54,197,252,0.2)\"] //背景渐变色，从上到下\n}\n```\n\n### 【方法】wave.input(pcmData,powerLevel,sampleRate)\n输入音频数据，更新波形显示。pcmData `[Int16,...]` 一维数组，为当前的录音数据片段，其他参数和`onProcess`回调相同。\n\n\n\n[​](?)\n\n[​](?)\n\n## WaveSurferView插件\n[wavesurfer.view.js](src/extensions/wavesurfer.view.js)，8kb大小源码，音频可视化波形显示，具体样子参考演示地址页面；本可视化插件可以移植到其他语言环境，如需定制可联系作者。\n\n此插件的使用方式和`WaveView`插件完全相同，请参考上面的`WaveView`来使用；本插件的波形绘制直接简单的使用PCM的采样数值大小来进行线条的绘制，同一段音频绘制出的波形和Audition内显示的波形外观上几乎没有差异。\n\n已知问题：iOS上微信小程序基础库存在bug，canvas.drawImage(canvas)可能无法绘制，可能会导致本可视化插件在iOS小程序上不能正确显示，其他环境下无此兼容性问题。\n\n### 【构造】surfer=Recorder.WaveSurferView(set)\n构造函数，`set`参数为配置对象，默认配置值如下：\n``` javascript\nset={\n    elem:\"css selector\" //自动显示到dom，并以此dom大小为显示大小\n        //或者配置显示大小，手动把surferObj.elem显示到别的地方\n    ,width:0 //显示宽度\n    ,height:0 //显示高度\n//H5环境以上配置二选一\n\n    compatibleCanvas: CanvasObject //提供一个兼容H5的canvas对象，需支持getContext(\"2d\")，支持设置width、height，支持drawImage(canvas,...)\n    ,compatibleCanvas_2x: CanvasObject //提供一个宽度是compatibleCanvas的2倍canvas对象\n    ,width:0 //canvas显示宽度\n    ,height:0 //canvas显示高度\n//非H5环境使用以上配置，比如微信小程序、uni-app\n    \n    ,scale:2 //缩放系数，应为正整数，使用2(3? no!)倍宽高进行绘制，避免移动端绘制模糊\n    \n    ,fps:50 //绘制帧率，不可过高，50-60fps运动性质动画明显会流畅舒适，实际显示帧率达不到这个值也并无太大影响\n    \n    ,duration:2500 //当前视图窗口内最大绘制的波形的持续时间，此处决定了移动速率\n    ,direction:1 //波形前进方向，取值：1由左往右，-1由右往左\n    ,position:0 //绘制位置，取值-1到1，-1为最底下，0为中间，1为最顶上，小数为百分比\n    \n    ,centerHeight:1 //中线基础粗细，如果为0不绘制中线，position=±1时应当设为0\n    \n    //波形颜色配置：[位置，css颜色，...] 位置: 取值0.0-1.0之间\n    ,linear:[0,\"rgba(0,187,17,1)\",0.7,\"rgba(255,215,0,1)\",1,\"rgba(255,102,0,1)\"]\n    ,centerColor:\"\" //中线css颜色，留空取波形第一个渐变颜色\n}\n```\n\n### 【方法】surfer.input(pcmData,powerLevel,sampleRate)\n输入音频数据，更新波形显示。pcmData `[Int16,...]` 一维数组，为当前的录音数据片段，其他参数和`onProcess`回调相同。\n\n\n\n\n[​](?)\n\n[​](?)\n\n## FrequencyHistogramView插件\n[frequency.histogram.view.js](src/extensions/frequency.histogram.view.js) + [lib.fft.js](src/extensions/lib.fft.js)，12kb大小源码，音频可视化频率直方图显示，具体样子参考演示地址页面。此插件核心算法参考Java开源库[jmp123](https://sourceforge.net/projects/jmp123/files/)的代码编写的，`jmp123`版本`0.3`；直方图特意优化主要显示0-5khz语音部分（线性），其他高频显示区域较小，不适合用来展示音乐频谱，可通过配置fullFreq来恢复成完整的线性频谱，或自行修改源码修改成倍频程频谱（伯德图、对数频谱）；本可视化插件可以移植到其他语言环境，如需定制可联系作者。\n\n此插件的使用方式和`WaveView`插件完全相同，请参考上面的`WaveView`来使用；请注意：必须同时引入`lib.fft.js`才能正常工作。\n\n\n### 【构造】histogram=Recorder.FrequencyHistogramView(set)\n构造函数，`set`参数为配置对象，默认配置值如下：\n``` javascript\nset={\n    elem:\"css selector\" //自动显示到dom，并以此dom大小为显示大小\n        //或者配置显示大小，手动把frequencyObj.elem显示到别的地方\n    ,width:0 //显示宽度\n    ,height:0 //显示高度\n//H5环境以上配置二选一\n\n    compatibleCanvas: CanvasObject //提供一个兼容H5的canvas对象，需支持getContext(\"2d\")，支持设置width、height，支持drawImage(canvas,...)\n    ,width:0 //canvas显示宽度\n    ,height:0 //canvas显示高度\n//非H5环境使用以上配置，比如微信小程序、uni-app\n    \n    ,scale:2 //缩放系数，应为正整数，使用2(3? no!)倍宽高进行绘制，避免移动端绘制模糊\n    \n    ,fps:20 //绘制帧率，不可过高\n    \n    ,lineCount:30 //直方图柱子数量，数量的多少对性能影响不大，密集运算集中在FFT算法中\n    ,widthRatio:0.6 //柱子线条宽度占比，为所有柱子占用整个视图宽度的比例，剩下的空白区域均匀插入柱子中间；默认值也基本相当于一根柱子占0.6，一根空白占0.4；设为1不留空白，当视图不足容下所有柱子时也不留空白\n    ,spaceWidth:0 //柱子间空白固定基础宽度，柱子宽度自适应，当不为0时widthRatio无效，当视图不足容下所有柱子时将不会留空白，允许为负数，让柱子发生重叠\n    ,minHeight:0 //柱子保留基础高度，position不为±1时应该保留点高度\n    ,position:-1 //绘制位置，取值-1到1，-1为最底下，0为中间，1为最顶上，小数为百分比\n    ,mirrorEnable:false //是否启用镜像，如果启用，视图宽度会分成左右两块，右边这块进行绘制，左边这块进行镜像（以中间这根柱子的中心进行镜像）\n    \n    ,stripeEnable:true //是否启用柱子顶上的峰值小横条，position不是-1时应当关闭，否则会很丑\n    ,stripeHeight:3 //峰值小横条基础高度\n    ,stripeMargin:6 //峰值小横条和柱子保持的基础距离\n    \n    ,fallDuration:1000 //柱子从最顶上下降到最底部最长时间ms\n    ,stripeFallDuration:3500 //峰值小横条从最顶上下降到底部最长时间ms\n    \n    //柱子颜色配置：[位置，css颜色，...] 位置: 取值0.0-1.0之间\n    ,linear:[0,\"rgba(0,187,17,1)\",0.5,\"rgba(255,215,0,1)\",1,\"rgba(255,102,0,1)\"]\n    //峰值小横条渐变颜色配置，取值格式和linear一致，留空为柱子的渐变颜色\n    ,stripeLinear:null\n    \n    ,shadowBlur:0 //柱子阴影基础大小，设为0不显示阴影，如果柱子数量太多时请勿开启，非常影响性能\n    ,shadowColor:\"#bbb\" //柱子阴影颜色\n    ,stripeShadowBlur:-1 //峰值小横条阴影基础大小，设为0不显示阴影，-1为柱子的大小，如果柱子数量太多时请勿开启，非常影响性能\n    ,stripeShadowColor:\"\" //峰值小横条阴影颜色，留空为柱子的阴影颜色\n    \n    ,fullFreq:false //是否要绘制所有频率；默认false主要绘制5khz以下的频率，高频部分占比很少，此时不同的采样率对频谱显示几乎没有影响；设为true后不同采样率下显示的频谱是不一样的，因为 最大频率=采样率/2 会有差异\n    //当发生绘制时会回调此方法，参数为当前绘制的频率数据和采样率，可实现多个直方图同时绘制，只消耗一个input输入和计算时间\n    ,onDraw:function(frequencyData,sampleRate){}\n}\n```\n\n### 【方法】histogram.input(pcmData,powerLevel,sampleRate)\n输入音频数据，更新直方图显示。pcmData `[Int16,...]` 一维数组，为当前的录音数据片段，其他参数和`onProcess`回调相同。\n\n\n\n\n[​](?)\n\n[​](?)\n\n## BufferStreamPlayer插件\n[buffer_stream.player.js](src/extensions/buffer_stream.player.js)，31kb大小源码，实时播放录音片段文件，把片段文件转换成MediaStream流，[参考此demo片段在线测试使用](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.decode_buffer_stream_player)。\n\nBufferStreamPlayer可以通过input方法一次性输入整个音频文件，或者实时输入音频片段文件，然后播放出来；输入支持格式：pcm、wav、mp3等浏览器支持的音频格式，非pcm格式会自动解码成pcm（播放音质效果比pcm、wav格式差点）；输入前输入后都可进行处理要播放的音频，比如：混音、变速、变调；输入的音频会写入到内部的MediaStream流中，完成将连续的音频片段文件转换成流。\n\n**此插件仅支持在浏览器环境中使用。**\n\n### 可以用于\n1. Recorder onProcess等实时处理中，将实时处理好的音频片段转直接换成MediaStream，此流可以作为WebRTC的local流发送到对方，或播放出来；\n2. 接收到的音频片段文件的实时播放，比如：WebSocket接收到的录音片段文件播放、WebRTC remote流（Recorder支持对这种流进行实时处理）实时处理后的播放；\n3. 单个音频文件的实时播放处理，比如：播放一段音频，并同时进行可视化绘制（其实自己解码+播放绘制比直接调用这个更有趣，但这个省事、配套功能多点）。\n\n### BufferStreamPlayer文档\n``` javascript\n//【构造初始化】\nvar stream=Recorder.BufferStreamPlayer({\n    play:true //要播放声音，设为false不播放，只提供MediaStream\n    ,realtime:true /*默认为true实时模式，设为false为非实时模式\n        实时模式：设为 true 或 {maxDelay:300,discardAll:false}配置对象\n            如果有新的input输入数据，但之前输入的数据还未播放完的时长不超过maxDelay时（缓冲播放延迟默认限制在300ms内），如果积压的数据量过大则积压的数据将会被直接丢弃，少量积压会和新数据一起加速播放，最终达到尽快播放新输入的数据的目的；这在网络不流畅卡顿时会发挥很大作用，可有效降低播放延迟；出现加速播放时声音听起来会比较怪异，可配置discardAll=true来关闭此特性，少量积压的数据也直接丢弃，不会加速播放；如果你的音频数据块超过200ms，需要调大maxDelay（取值100-800ms）\n        非实时模式：设为 false\n            连续完整的播放完所有input输入的数据，之前输入的还未播放完又有新input输入会加入队列排队播放，比如用于：一次性同时输入几段音频完整播放\n        */\n            \n    //,onInputError:fn(errMsg, inputIndex) //当input输入出错时回调，参数为input第几次调用和错误消息\n    //,onUpdateTime:fn() //已播放时长、总时长更新回调（stop、pause、resume后一定会回调），this.currentTime为已播放时长，this.duration为已输入的全部数据总时长（实时模式下意义不大，会比实际播放的长），单位都是ms\n    //,onPlayEnd:fn() //没有可播放的数据时回调（stop后一定会回调），已输入的数据已全部播放完了，可代表正在缓冲中或播放结束；之后如果继续input输入了新数据，播放完后会再次回调，因此会多次回调；非实时模式一次性输入了数据时，此回调相当于播放完成，可以stop掉，重新创建对象来input数据可达到循环播放效果\n    \n    //,decode:false //input输入的数据在调用transform之前是否要进行一次音频解码成pcm [Int16,...]\n        //mp3、wav等都可以设为true、或设为{fadeInOut:true}配置对象，会自动解码成pcm；默认会开启fadeInOut对解码的pcm首尾进行淡入淡出处理，减少爆音（wav等解码后和原始pcm一致的音频，可以把fadeInOut设为false）\n    \n    //transform:fn(inputData,sampleRate,True,False)\n        //将input输入的data（如果开启了decode将是解码后的pcm）转换处理成要播放的pcm数据；如果没有解码也没有提供本方法，input的data必须是[Int16,...]并且设置set.sampleRate\n        //inputData:any input方法输入的任意格式数据，只要这个转换函数支持处理；如果开启了decode，此数据为input输入的数据解码后的pcm [Int16,...]\n        //sampleRate:123 如果设置了decode为解码后的采样率，否则为set.sampleRate || null\n        //True(pcm,sampleRate) 回调处理好的pcm数据([Int16,...])和pcm的采样率\n        //False(errMsg) 处理失败回调\n        \n    //sampleRate:16000 //可选input输入的数据默认的采样率，当没有设置解码也没有提供transform时应当明确设置采样率\n\n    //runningContext:AudioContext //可选提供一个state为running状态的AudioContext对象(ctx)，默认会在start时自动创建一个新的ctx，这个配置的作用请参阅Recorder的runningContext配置\n});\n\n//创建好后第一件事就是start打开流，打开后就会开始播放input输入的音频；注意：start需要在用户操作(触摸、点击等)时进行调用，原因参考runningContext配置\nstream.start(()=>{\n    stream.currentTime;//当前已播放的时长，单位ms，数值变化时会有onUpdateTime事件\n    stream.duration;//已输入的全部数据总时长，单位ms，数值变化时会有onUpdateTime事件；实时模式下意义不大，会比实际播放的长，因为实时播放时卡了就会丢弃部分数据不播放\n    stream.isStop;//是否已停止，调用了stop方法时会设为true\n    stream.isPause;//是否已暂停，调用了pause方法时会设为true\n    stream.isPlayEnd;//已输入的数据是否播放到了结尾（没有可播放的数据了），input后又会变成false；可代表正在缓冲中或播放结束，状态变更时会有onPlayEnd事件\n    \n    //如果不要默认的播放，可以设置set.play为false，这种情况下只拿到MediaStream来用\n    stream.getMediaStream() //通过getMediaStream方法得到MediaStream流，此流可以作为WebRTC的local流发送到对方，或者直接拿来赋值给audio.srcObject来播放（和赋值audio.src作用一致）；未start时调用此方法将会抛异常\n    \n    stream.getAudioSrc() //【已过时】超低版本浏览器中得到MediaStream流的字符串播放地址，可赋值给audio标签的src，直接播放音频；未start时调用此方法将会抛异常；新版本浏览器已停止支持将MediaStream转换成url字符串，调用本方法新浏览器会抛异常，因此在不需要兼容不支持srcObject的超低版本浏览器时，请直接使用getMediaStream然后赋值给auido.srcObject来播放\n},(errMsg)=>{\n    //start失败，无法播放\n});\n\n//随时都能调用input，会等到start成功后播放出来，不停的调用input，就能持续的播放出声音了，需要暂停播放就不要调用input就行了\nstream.input(anyData);\n\n//暂停播放，暂停后：实时模式下会丢弃所有input输入的数据（resume时只播放新input的数据），非实时模式下所有input输入的数据会保留到resume时继续播放\nstream.pause();\n//恢复播放，实时模式下只会从最新input的数据开始播放，非实时模式下会从暂停的位置继续播放\nstream.resume();\n\n//不要播放了就调用stop停止播放，关闭所有资源\nstream.stop();\n```\n\n### 【方法】stream.input(anyData)\n输入任意格式的音频数据，未完成start前调用会等到start成功后生效。\n```\nanyData: any 具体类型取决于：\n    set.decode为false时:\n        未提供set.transform，数据必须是pcm[Int16,...]，此时的set必须提供sampleRate；\n        提供了set.transform，数据为transform方法支持的任意格式。\n    set.decode为true时:\n        数据必须是ArrayBuffer，会自动解码成pcm[Int16,...]；注意输入的每一片数据都应该是完整的一个音频片段文件，否则可能会解码失败。\n        \n关于anyData的二进制长度：\n    如果是提供的pcm、wav格式数据，数据长度对播放无太大影响，很短的数据也能很好的连续播放。\n    如果是提供的mp3这种必须解码才能获得pcm的数据，数据应当尽量长点，测试发现片段有300ms以上解码后能很好的连续播放，低于100ms解码后可能会有明显的杂音，更低的可能会解码失败；当片段确实太小时，可以将本来会多次input调用的数据缓冲起来，等数据量达到了300ms再来调用一次input，能比较显著的改善播放音质。\n```\n\n\n\n\n[​](?)\n\n[​](?)\n\n## ASR_Aliyun_Short插件\n[asr.aliyun.short.js](src/extensions/asr.aliyun.short.js)，29kb大小源码，ASR，阿里云语音识别（语音转文字），支持实时语音识别、单个音频文件转文字，[参考此demo片段在线测试使用](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.asr.aliyun.short)。\n\n- 本插件通过调用 阿里云-智能语音交互-一句话识别 接口来进行语音识别，无时长限制。\n- 识别过程中采用WebSocket直连阿里云，语音数据无需经过自己服务器。\n- 自己服务器仅需提供一个Token生成接口即可（本库已实现一个本地测试NodeJs后端程序 [/assets/demo-asr](assets/demo-asr)）。\n- 也支持在非浏览器环境中使用，比如微信小程序、uni-app，提供`compatibleWebSocket`进行适配即可。\n\n> 本插件单次语音识别时虽长无限制，最佳使用场景还是1-5分钟内的语音识别；60分钟以上的语音识别本插件也能胜任（需自行进行重试容错处理），但太长的识别场景不太适合使用阿里云一句话识别（阿里云单次一句话识别最长60秒，本插件自带拼接过程，所以无时长限制）；为什么采用一句话识别：因为便宜。\n\n> 目前暂未提供其他版本的语音识别插件，比如腾讯云、讯飞等，搭配使用Recorder的onProcess实时处理，可根据自己的业务需求选择对应厂家自行对接即可，如需定制开发请联系作者。\n\n### 对接流程\n1. 到阿里云开通 一句话识别 服务（可试用一段时间，正式使用时应当开通商用版，很便宜），得到AccessKey、Secret，参考：https://help.aliyun.com/document_detail/324194.html ；\n2. 到阿里云智能语音交互控制台创建相应的语音识别项目，并配置好项目，得到Appkey，每个项目可以设置一种语言模型，要支持多种语言就创建多个项目；\n3. 需要后端提供一个Token生成接口（用到上面的Key和Secret），可直接参考或本地运行此NodeJs后端测试程序：[/assets/demo-asr](assets/demo-asr)，配置好代码里的阿里云账号后，在目录内直接命令行执行`node NodeJsServer_asr.aliyun.short.js`即可运行提供本地测试接口；\n4. 前端调用ASR_Aliyun_Short，传入tokenApi，即可很简单的实现语音识别功能。\n\n### ASR_Aliyun_Short文档\n``` javascript\nvar rec=Recorder(recSet);rec.open(...) //进行语音识别前，先打开录音，获得录音权限\n\n//【构造初始化】\nvar asr=Recorder.ASR_Aliyun_Short({\n    tokenApi:\"\" /*必填，调用阿里云一句话识别需要的token获取api地址\n            接口实现请参考本地测试NodeJs后端程序：/assets/demo-asr/NodeJsServer_asr.aliyun.short.js\n            此接口默认需要返回数据格式：\n                {\n                    c:0 //code，0接口调用正常，其他数值接口调用出错\n                    ,m:\"\" //message，接口调用出错时的错误消息\n                    ,v:{ //value，接口成功调用返回的结果【结果中必须包含下面两个值】\n                        appkey:\"aaaa\" //lang语言模型对应的项目appkey\n                        ,token:\"bbbb\" //语音识别Access Token\n                    }\n                }\n            如果不是返回的这个格式的数据，必须提供apiRequest配置，自行请求api*/\n    ,apiArgs:{ //请求tokenApi时要传的参数\n        action:\"token\"\n        ,lang:\"普通话\" //语言模型设置（具体取值取决于tokenApi支持了哪些语言）\n    }\n    ,apiRequest:fn(url,args,success,fail) /*tokenApi的请求实现方法，默认使用简单的ajax实现\n            如果你接口返回的数据格式和默认格式不一致，必须提供一个函数来自行请求api\n            方法参数：\n                url:\"\" == tokenApi\n                args:{} == apiArgs\n                success:fn(value) 接口调用成功回调，value={appkey:\"\", token:\"\"}\n                fail:fn(errMsg) 接口调用出错回调，errMsg=\"错误消息\"\n            */\n    ,compatibleWebSocket:null /*提供一个函数返回兼容WebSocket的对象，一般也需要提供apiRequest\n            如果你使用的环境不支持WebSocket（如微信小程序、uni-app），需要提供一个函数来返回一个兼容实现对象\n            方法参数：fn(url) url为连接地址，返回一个对象，需支持的回调和方法：{\n                    onopen:fn() 连接成功回调\n                    onerror:fn({message}) 连接失败回调\n                    onclose:fn({code, reason}) 连接关闭回调\n                    onmessage:fn({data}) 收到消息回调\n                    connect:fn() 进行连接\n                    close:fn(code,reason) 关闭连接\n                    send:fn(data) 发送数据，data为字符串或者arraybuffer\n                }\n            binaryType固定使用arraybuffer类型\n            */\n    \n    ,asrProcess:fn(text,nextDuration,abortMsg) //当实时接收到语音识别结果时的回调函数（对单个完整音频文件的识别也有效）\n            //此方法需要返回true才会继续识别，否则立即当做识别超时处理，你应当通过nextDuration来决定是否继续识别，避免无限制的识别大量消耗阿里云资源额度；如果不提供本回调，默认1分钟超时后终止识别(因为没有绑定回调，你不知道已经被终止了)\n            //text为中间识别到的内容（并非已有录音片段的最终结果，后续可能会根据语境修整）\n            //nextDuration 为当前回调时下次即将进行识别的总时长，单位毫秒，通过这个参数来限制识别总时长，超过时长就返回false终止识别（第二分钟开始每分钟会多识别前一分钟结尾的5秒数据，用于两分钟之间的拼接，相当于第二分钟最多识别55秒的新内容）\n            //abortMsg如不为空代表识别中途因为某种原因终止了识别（比如超时、接口调用失败），收到此信息时应当立即调用asr的stop方法得到最终结果，并且终止录音\n    \n    ,log:fn(msg,color) //提供一个日志输出接口，默认只会输出到控制台，color： 1:红色，2绿色，不为空时为颜色字符串\n    \n    //高级选项\n    ,fileSpeed:6 //单个文件识别发送速度控制，取值1-n；1：为按播放速率发送，最慢，识别精度完美；6：按六倍播放速度发送，花10秒识别60秒文件比较快，精度还行；再快测试发现似乎会缺失内容，可能是发送太快底层识别不过来导致返回的结果缺失。\n});\n\n/**asr创建好后，随时调用strat，开始进行语音识别，开始后需要调用input输入录音数据，结束时调用stop来停止识别。如果start之前调用了input输入数据，这些数据将会等到start成功之后进行识别。\n建议在success回调中开始录音（即rec.start）；当然asr.start和rec.start同时进行调用，或者任意一个先调用都是允许的，不过当出现fail时，需要处理好asr和rec各自的状态。\n无需特殊处理start和stop的关系，只要调用了stop，会阻止未完成的start，不会执行回调。\n    success:fn()\n    fail:fn(errMsg)**/\nasr.start(function(){//success\n    rec.start();//一般在start成功之后，调用rec.start()开始录音，此时可以通知用户讲话了\n},fail);\n\n/**实时处理输入音频数据，一般是在rec.set.onProcess中调用本方法，输入实时录制的音频数据，输入的数据将会发送语音识别；不管有没有start，都可以调用本方法，start前输入的数据会缓冲起来等到start后进行识别\n    buffers:[[Int16...],...] pcm片段列表，为二维数组，第一维数组内存放1个或多个pcm数据；比如可以是：rec.buffers、onProcess中的buffers截取的一段新二维数组\n    sampleRate:48000 buffers中pcm的采样率\n    \n    buffersOffset:0 可选，默认0，从buffers第一维的这个位置开始识别，方便rec的onProcess中使用**/\nasr.input(buffers,sampleRate,buffersOffset); \n\n/**话讲完后，调用stop结束语音识别，得到识别到的内容文本，一般在调用了本方法后，下一行代码立即调用录音rec.stop结束录音\n    success:fn(text,abortMsg) text为识别到的最终完整内容；如果存在abortMsg代表识别中途被某种错误停止了，text是停止前的内容识别到的完整内容，一般早在asrProcess中会收到abort事件然后要停止录音\n    fail:fn(errMsg)**/\nasr.stop(function(text,abortMsg){//success\n    //text为识别到的最终完整内容；如果存在abortMsg代表识别中途被某种错误停止了，text是停止前的内容识别到的完整内容，一般早在asrProcess中会收到abort事件然后要停止录音\n},fail);\n\n\n//【更多的方法】\nasr.inputDuration() //获取input已输入的音频数据总时长，单位ms\nasr.sendDuration() //获取已发送识别的音频数据总时长，存在重发重叠部分，因此比inputDuration长\nasr.asrDuration() //获取已识别的音频数据总时长，去除了sendDuration的重叠部分，值<=inputDuration\nasr.getText() //获取实时结果文本，如果已stop返回的就是最终文本，一般无需调用此方法，因为回调中都提供了此方法的返回值\n\n/**一次性将单个完整音频文件转成文字，无需start、stop，创建好asr后直接调用本方法即可，支持的文件类型由具体的浏览器决定，因此存在兼容性问题,兼容性mp3最好，wav次之，其他格式不一定能够解码。实际就是调用：浏览器解码音频得到PCM -> start -> input ... input -> stop\n    audioBlob 音频文件Blob对象，如：rec.stop得到的录音结果、file input选择的文件、XMLHttpRequest的blob结果、new Blob([TypedArray])创建的blob\n    success fn(text,abortMsg) text为识别到的完整内容,abortMsg参考stop\n    fail:fn(errMsg)**/\nasr.audioToText(audioBlob,success,fail)\n\n/**一次性的将单个完整音频转成文字，无需start、stop，创建好asr后直接调用本方法即可。实际就是调用:start -> input ... input -> stop\n    buffer:[Int16,...] 16位单声道音频pcm数据，一维数组\n    sampleRate pcm的采样率\n    success fn(text,abortMsg) text为识别到的完整内容,abortMsg参考stop\n    fail:fn(errMsg)**/\nasr.pcmToText(buffer,sampleRate,success,fail)\n```\n\n\n\n\n[​](?)\n\n[​](?)\n\n## Sonic插件\n[sonic.js](src/extensions/sonic.js)，38kb大小源码，音频变速变调转换，[参考此demo片段在线测试使用](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.sonic.transform)。此插件从[Sonic.java](https://github.com/waywardgeek/sonic/blob/71c51195de71627d7443d05378c680ba756545e8/Sonic.java)移植，并做了适当精简。\n\n可到[assets/sonic-java](assets/sonic-java)目录运行java代码测试原版效果。\n\n### 本插件支持\n1. `Pitch`：变调不变速（会说话的汤姆猫），男女变声，只调整音调，不改变播放速度\n2. `Speed`：变速不变调（快放慢放），只调整播放速度，不改变音调\n3. `Rate`：变速变调，会改变播放速度和音调\n4. `Volume`：支持调整音量\n5. 支持实时处理，可在onProcess中实时处理PCM（需开启异步），配合SampleData方法使用更佳\n\n### Sonic文档\nSonic有两个构造方法，一个是同步方法，Sonic.Async是异步方法，同步方法简单直接但处理量大时会消耗大量时间，主要用于一次性的处理；异步方法由WebWorker在后台进行运算处理，但异步方法不一定能成功开启（低版本浏览器），主要用于实时处理。异步方法调用后必须调用flush方法，否则会产生内存泄露。\n\n注意：由于同步方法转换操作需要占用比较多的CPU（但比转码小点），因此实时处理时在低端设备上可能会导致性能问题；在一次性处理大量pcm时，可采取切片+setTimeout进行处理，参考上面的demo片段。\n\n注意：变速变调会大幅增减PCM数据长度，如果需要在onProcess中实时处理PCM，需要在rec.set中设置内部参数`rec.set.disableEnvInFix=true`来禁用设备卡顿时音频输入丢失补偿功能，否则可能导致错误的识别为设备卡顿。\n\n注意：每次input输入的数据量应该尽量的大些，太少容易产生杂音，每次传入200ms以上的数据量就几乎没有影响了。\n\n``` javascript\n//【构造初始化】\nvar sonic=Recorder.Sonic(set) //同步调用，用于一次性处理\nvar sonic=Recorder.Sonic.Async(set) //异步调用，用于实时处理，调用后必须调用flush方法，否则会产生内存泄露。\n    /*set:{\n        sampleRate:待处理pcm的采样率，就是input输入的buffer的采样率\n    }*/\n\n//【功能配置调用函数】同步异步通用，以下num取值正常为0.1-2.0，超过这个范围也是可以的，但不推荐\nsonic.setPitch(num)  //num:0.1-n，变调不变速（会说话的汤姆猫），男女变声，只调整音调，不改变播放速度，默认为1.0不调整\nsonic.setSpeed(num)  //num:0.1-n，变速不变调（快放慢放），只调整播放速度，不改变音调，默认为1.0不调整\nsonic.setRate(num)  //num:0.1-n，变速变调，越小越缓重，越大越尖锐，会改变播放速度和音调，默认为1.0不调整\nsonic.setVolume(num)  //num:0.1-n，调整音量，默认为1.0不调整\nsonic.setChordPitch(bool)  //bool:默认false，作用未知，不推荐使用\nsonic.setQuality(num)  //num:0或1，默认0时会减小输入采样率来提供处理速度，变调时才会用到，不推荐使用\n\n//【同步调用方法】\nsonic.input(buffer)  //buffer:[Int16,...] 一维数组，输入pcm数据，返回转换后的部分pcm数据，完整输出需要调用flush；返回值[Int16,...]长度可能为0，代表没有数据被转换；此方法是耗时的方法，一次性处理大量pcm需要切片+setTimeout优化\nsonic.flush()  //将残余的未转换的pcm数据完成转换并返回；返回值[Int16,...]长度可能为0，代表没有数据被转换\n\n//【异步调用方法】\nsonic.input(buffer,callback) //callback:fn(pcm)，和同步方法相同，只是返回值通过callback返回\nsonic.flush(callback) //callback:fn(pcm)，和同步方法相同，只是返回值通过callback返回\n```\n\n\n\n\n[​](?)\n\n[​](?)\n\n## NMN2PCM插件\n[create-audio.nmn2pcm.js](src/extensions/create-audio.nmn2pcm.js)，14kb大小源码，简单用 正弦波、方波、锯齿波、三角波 函数生成一段音乐简谱的pcm数据，主要用于测试时提供音频数据；[参考此demo片段在线测试使用](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=test.create-audio.nmn2pcm)。\n\n### NMN2PCM文档\n``` javascript\nvar pcmData=Recorder.NMN2PCM(set);\n    set配置：{\n        texts:\"\"|[\"\",\"\"] 简谱格式化文本，如果格式不符合要求，将会抛异常\n        sampleRate: 生成pcm的采样率，默认48000；取值不能过低，否则会削除高音\n        timbre: 音色，默认2.0（使用音符对应频率的一个倍频），取值>=1.0\n        meterDuration: 一拍时长，毫秒，默认600ms\n        muteDuration: 音符之间的静默，毫秒，0时无静默，默认meterDur/4（最大50ms）\n        beginDuration: 开头的静默时长，毫秒，0时无静默，默认为200ms\n        endDuration: 结尾的静默时长，毫秒，0时无静默，默认为200ms\n        \n        volume: 音量，默认0.3，取值范围0.0-1.0（最大值1）\n        waveType: 波形发生器类型，默认\"sine\"，取值：sine(正弦波)、square(方波，volume应当减半)、sawtooth(锯齿波)、triangle(三角波)\n    }\n    其中texts格式比较复杂，请查看此插件源码中的注释\n    \n返回结果：{\n        pcm: Int16Array，pcm数据\n        duration: 123 pcm的时长，单位毫秒\n        set: {...} 使用的set配置\n        warns: [] 不适合抛异常的提示消息\n    }\n\nRecorder.NMN2PCM.GetExamples() 可获取内置的简谱\n```\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n## DTMF插件\n[dtmf.decode.js](src/extensions/dtmf.decode.js) + [lib.fft.js](src/extensions/lib.fft.js)、[dtmf.encode.js](src/extensions/dtmf.encode.js)，两个js一个解码、一个编码，体积小均不超过10kb，纯js实现易于移植。[参考此demo片段在线测试使用](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.dtmf.decode_and_encode)。\n\n1. DTMF（电话拨号按键信号）解码器，解码得到按键值：可实现实时从音频数据流中解码得到电话拨号按键信息，用于电话录音软解，软电话实时提取DTMF按键信号等；识别DTMF按键准确度高，误识别率低，支持识别120ms以上按键间隔+30ms以上的按键音，纯js实现易于移植；请注意：使用dtmf.decode.js必须同时引入`lib.fft.js`（由java移植过来的）才能正常工作。\n2. DTMF（电话拨号按键信号）编码生成器，生成按键对应的音频PCM信号：可实现生成按键对应的音频PCM信号，用于DTMF按键信号生成，软电话实时发送DTMF按键信号等；生成信号代码、原理简单粗暴，纯js实现易于移植，0依赖。\n\n### 【方法】Recorder.DTMF_Decode(pcmData,sampleRate,prevChunk)\n解码DTMF只有这个一个函数，此函数支持连续调用，将上次的返回值当做参数即可实现实时音频流数据的连续解码处理。\n\n``` javascript\n参数：\n    pcmData:[Int16,...] pcm一维数组，原则上一次处理的数据量不要超过10秒，太长的数据应当分段延时处理\n    sampleRate: 123 pcm的采样率\n    prevChunk: null || {} 上次的返回值，用于连续识别，或者当做额外配置对象\n    \n返回:\n    chunk:{\n        keys:[keyItem,...] 识别到的按键，如果未识别到数组长度为0\n                keyItem:{\n                    key:\"\" //按键值 0-9 #*\n                    time:123 //所在的时间位置，ms\n                }\n        \n        //以下用于下次接续识别\n        lastIs:\"\" \"\":mute {}:match 结尾处是什么\n        lastCheckCount:0 结尾如果是key，此时的检查次数\n        prevIs:\"\" \"\":null {}:match 上次疑似检测到了什么\n        totalLen:0 总采样数，相对4khz\n        pcm:[Int16,...] 4khz pcm数据\n        \n        //可额外配置值，如：DTMF_Decode(.., .., prevChunk||{checkFactor:2})\n        checkFactor:3 信号检查因子，取值1，2，3，默认为3不支持低于32ms的按键音检测，当需要检测时可以设为2，当信号更恶劣时设为1，这样将会减少检查的次数，导致错误识别率变高\n        debug:false 是否开启调试日志\n    }\n```\n\n### 【方法】Recorder.DTMF_Encode(key,sampleRate,duration,mute)\n本方法用来生成单个按键信号pcm数据，属于底层方法，要混合多个按键信号到别的pcm中请用封装好的DTMF_EncodeMix方法。\n\n``` javascript\n参数：\n    key: 单个按键0-9#*\n    sampleRate:123 要生成的pcm采样率\n    duration:100 按键音持续时间\n    mute:50 按键音前后静音时长\n返回：\n    pcm：[Int16,...]，生成单个按键信号\n```\n\n### 【方法】Recorder.DTMF_EncodeMix(set)\n本方法返回EncodeMix对象，将输入的按键信号混合到持续输入的pcm流中，当.mix(inputPcms)提供的太短的pcm会无法完整放下一个完整的按键信号，所以需要不停调用.mix(inputPcms)进行混合。\n``` javascript\nset={\n    duration:100 //按键信号持续时间 ms，最小值为30ms\n    ,mute:25 //按键音前后静音时长 ms，取值为0也是可以的\n    ,interval:200 //两次按键信号间隔时长 ms，间隔内包含了duration+mute*2，最小值为120ms\n}\n\nEncodeMix对象：\n    .add(keys)\n        添加一个按键或多个按键 \"0\" \"123#*\"，后面慢慢通过mix方法混合到pcm中，无返回值\n    \n    .mix(pcms,sampleRate,index)\n        将已添加的按键信号混合到pcm中，pcms:[[Int16,...],...]二维数组，sampleRate：pcm的采样率，index：pcms第一维开始索引，将从这个pcm开始混合。\n        返回状态对象：{\n            newEncodes:[{key:\"*\",data:[Int16,...]},...] //本次混合新生成的按键信号列表 ，如果没有产生新信号将为空数组\n            ,hasNext:false //是否还有未混合完的信号\n        }\n        注意：调用本方法会修改pcms中的内容，因此混合结果就在pcms内。\n```\n\n\n\n\n\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n# :open_book:已有的音频格式编码器\n所有音频格式的编码器都在`/src/engine`目录中（或`/dist/engine`目录的压缩版），每个格式一般有一个同名的js文件，如果这个格式有额外的编码引擎文件（`*-engine.js`）的话，使用时必须要一起加上。\n\n## pcm 格式\n依赖文件：`pcm.js`，支持实时编码（边录边转码），pcm编码器输出的数据其实就是Recorder中的buffers原始数据（经过了重新采样），16位时为LE小端模式（Little Endian），并未经过任何编码处理；pcm为未封装的原始音频数据，pcm数据文件无法直接播放，pcm加上一个44字节wav头即成wav文件，可通过wav格式来正常播放。两个参数相同的pcm文件直接二进制拼接在一起即可成为长的pcm文件，[pcm片段文件合并+可移植源码：PCMMerge](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=teach.realtime.encode_transfer_frame_pcm)。\n\n### Recorder.pcm2wav(data,True,False)\n已实现的一个把pcm转成wav格式来播放的方法，`data = { sampleRate:16000 pcm的采样率 , bitRate:16 pcm的位数 取值：8 或 16 , blob:pcm的blob对象 }`，`True=fn(wavBlob,duration)`。要使用此方法需要带上`wav`格式编码器。\n\n提示：16位的pcm二进制数据可以直接通过`new Int16Array(pcmArrayBuffer)`来构造成Int16Array，然后通过`rec.mock`来转码成其他任意格式。\n\n\n## wav (raw pcm format) 格式\n依赖文件：`wav.js`（或使用根目录的`recorder.wav.min.js`一个文件即可），不支持实时编码（因为wav文件头中需要提供文件最终长度）只能一次性将所有pcm转成wav格式，wav格式编码器是参考网上资料写的，会发现代码和别人家的差不多。源码4kb大小。[wav转其他格式参考和测试](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.transform.wav2other)\n\n### wav转pcm\n生成的wav文件内音频数据的编码为未压缩的pcm数据（raw pcm），只是在pcm数据前面加了一个44字节的wav头；因此直接去掉前面44字节就能得到原始的pcm数据，如：`blob.slice(44,blob.size,\"audio/pcm\")`；注意：其他wav编码器可能不是44字节的头，要从任意wav文件中提取pcm数据，请参考：`assets/runtime-codes/fragment.decode.wav.js`。\n\n### 简单将多段小的wav片段合成长的wav文件\n由于RAW格式的wav内直接就是pcm数据，因此将小的wav片段文件去掉wav头后得到的原始pcm数据合并到一起，再加上新的wav头即可合并出长的wav文件；要求待合成的所有wav片段的采样率和位数需一致。[wav合并参考和测试+可移植源码](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.merge.wav_merge)\n\n## mp3 (CBR) 格式\n依赖文件：`mp3.js + mp3-engine.js`（或使用根目录的`recorder.mp3.min.js`一个文件即可），支持实时编码（边录边转码），采用的是[lamejs](https://github.com/zhuker/lamejs)(LGPL License)这个库的代码，`https://github.com/zhuker/lamejs/blob/bfb7f6c6d7877e0fe1ad9e72697a871676119a0e/lame.all.js`这个版本的文件代码；已对lamejs源码进行了部分改动，用于精简代码和修复发现的问题。LGPL协议涉及到的文件：`mp3-engine.js`；这些文件也采用LGPL授权，不适用MIT协议。源码366kb大小，压缩后130kb左右，开启gzip后60来k。[mp3转其他格式参考和测试](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.transform.mp32other)\n\n### 简单将多段小的mp3片段合成长的mp3文件\n由于lamejs CBR编码出来的mp3二进制数据从头到尾全部是大小相同的数据帧（采样率44100等无法被8整除的部分帧可能存在额外多1字节填充），没有其他任何多余信息，通过文件长度可计算出mp3的时长`fileSize*8/bitRate`（[参考](https://blog.csdn.net/u010650845/article/details/53520426)），数据帧之间可以直接拼接。因此将小的mp3片段文件的二进制数据全部合并到一起即可得到长的mp3文件；要求待合成的所有mp3片段的采样率和比特率需一致。[mp3合并参考和测试+可移植源码](https://xiangyuecn.github.io/Recorder/assets/工具-代码运行和静态分发Runtime.html?jsname=lib.merge.mp3_merge)\n\n*注：CBR编码由于每帧数据的时长是固定的，mp3文件结尾最后这一帧的录音可能不能刚好填满，就会产生填充数据，多出来的这部分数据会导致mp3时长变长一点点，在实时转码传输时应当留意，解码成pcm后可直接去掉结尾的多余；另外可以通过调节待编码的pcm数据长度以达到刚好填满最后一帧来规避此问题，参考`Recorder.SampleData`方法提供的连续转码针对此问题的处理。首帧或前两帧可能是lame记录的信息帧，本库已去除（但小的mp3片段拼接起来停顿导致的杂音还是非常明显，实时处理时使用`takeoffEncodeChunk`选项可完全避免此问题），参考上面的已知问题。*\n\n\n## g711a g711u 格式\n依赖文件：`g711x.js`，g711a: G.711 A-law (pcma)，g711u: G.711 μ-law (pcmu、mu-law)；支持g711的编码和解码，支持实时编码（边录边转码），编解码源码移植自：`https://github.com/twstx1/codec-for-audio-in-G72X-G711-G723-G726-G729/blob/master/G711_G721_G723/g711.c`；固定为8000hz采样率、16位，每个采样压缩成8位存储，音频文件大小为8000字节/秒。\n\n### Recorder.g711a_encode|g711u_encode(pcm)\n编码任意采样率的pcm得到g711x数据。pcm: Int16Array，任意采样率pcm数据（标准采样率为8000，其它采样率的pcm可使用Recorder.SampleData方法来转成8000采样率）。返回Uint8Array，g711x二进制数据（采样率为pcm的采样率）。\n\n### Recorder.g711a_decode|g711u_decode(bytes)\n解码g711x得到pcm，`bytes`: Uint8Array，g711x二进制数据，采样率一般是8000；返回Int16Array，为g711x的采样率、16位的pcm数据。\n\n### Recorder.g711a2wav|g711u2wav(g711xBlob,True,False)\n已实现把g711a、g711u转成wav格式来播放的方法，`g711xBlob为g711x音频文件blob对象 或 ArrayBuffer（回调也将返回ArrayBuffer），采样率只支持8000`，`True=fn(wavBlob,duration)`；要使用此方法需要带上`wav`格式编码器。\n\n\n## ogg (Vorbis) 格式\n依赖文件：`beta-ogg.js + beta-ogg-engine.js`，支持实时编码（边录边转码），采用的是[ogg-vorbis-encoder-js](https://github.com/higuma/ogg-vorbis-encoder-js)(MIT License)，`https://github.com/higuma/ogg-vorbis-encoder-js/blob/7a872423f416e330e925f5266d2eb66cff63c1b6/lib/OggVorbisEncoder.js`这个版本的文件代码。此编码器源码1.2M，比较大，开启gzip后400KB左右。对录音的压缩率比lamejs高出一倍, 但Vorbis in Ogg好像Safari不支持（[真的假的](https://developer.mozilla.org/en-US/docs/Web/HTML/Supported_media_formats#Browser_compatibility)）。\n\n## amr (NB 窄带) 格式\n依赖文件：`beta-amr.js + beta-amr-engine.js`，支持实时编码（边录边转码），采用的是[benz-amr-recorder](https://github.com/BenzLeung/benz-amr-recorder)(MIT License)优化后的[amr.js](https://github.com/jpemartins/amr.js)(Unknown License)，`https://github.com/BenzLeung/benz-amr-recorder/blob/462c6b91a67f7d9f42d0579fb5906fad9edb2c9d/src/amrnb.js`这个版本的文件代码，已对此代码进行过调整更方便使用。支持编码和解码操作。由于最高只有12.8kbps的码率(AMR 12.2，8000hz)，音质和同比配置的mp3、ogg差一个档次。由于支持解码操作，理论上所有支持Audio的浏览器都可以播放（需要自己写代码实现）。此编码器源码600KB，比较大，开启gzip后130KB。优点：录音文件小。\n\n### Recorder.amr2wav(amrBlob,True,False)\n已实现的一个把amr转成wav格式来播放的方法，`True=fn(wavBlob,duration)`。要使用此方法需要带上上面的`wav`格式编码器。仿照此方法可轻松转成别的格式，参考`mock`方法介绍那节。\n\n### AMR实时编码解码\n使用`Recorder.AMR.GetDecoder() | .GetEncoder(12.2)`可以获得amr解码器和编码器，支持实时操作（amr帧、小文件片段连续编解码）；如何使用请阅读`beta-amr-engine.js`源码开头部分代码，`Recorder.amr2wav`底层调用的`Recorder.AMR.decode`方法有用到。\n\n\n## beta-webm 格式\n依赖文件：`beta-webm.js`，不支持实时编码，这个编码器时通过查阅MDN编写的一个玩意，没多大使用价值：录几秒就至少要几秒来编码。。。原因是：未找到对已有pcm数据进行快速编码的方法。数据导入到MediaRecorder，音频有几秒就要等几秒，类似边播放边收听形。(想接原始录音Stream？我不可能给的!)输出音频虽然可以通过比特率来控制文件大小，但音频文件中的比特率并非设定比特率，采样率由于是我们自己采样的，到这个编码器随他怎么搞。只有比较新的浏览器支持（需实现浏览器MediaRecorder），压缩率和mp3差不多。源码3kb大小。\n\n\n## 【附】其他音频格式支持办法\n``` javascript\n//比如增加aac格式支持 (可参考/src/engine/wav.js的简单实现；如果要实现边录边转码应该参考mp3的实现，需实现的接口比较多)\n\n//新增一个aac.js，编写以下格式代码即可实现这个类型\nRecorder.prototype.aac=function(pcmData,successCall,failCall){\n    //通过aac编码器把pcm[Int16,...]数据转成aac格式数据，通过this.set拿到传入的配置数据\n    ... pcmData->aacData\n    \n    //返回数据\n    successCall(new Blob([aacData.buffer],{type:\"audio/aac\"}));\n}\n\n//调用\nRecorder({type:\"aac\"})\n\n//如仅需要得到aac格式文件，你可以尝试直接用Recorder录制wav格式，然后调用 https://github.com/salomvary/fdk-aac.js库 来将wav转码成aac，详细请参考 assets/手动测试脚本.js 里面有可用的测试代码\n```\n\n\n\n\n\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n# :open_book:国际化多语言支持（i18n）\nRecorder内置的简版国际化多语言支持实现，通过设置 `Recorder.i18n.lang=\"en-US\"` 可切换Recorder内所有输出文本为英文（如：错误消息、控制台日志），默认为`zh-CN`简体中文。\n\n语言文件在 [/src/i18n](./src/i18n) 目录内，这些语言文件是通过`/src/package-i18n.js`脚本从src目录内所有源码文件中提取出文本自动生成的，如果修改了源码，需要重新运行一次脚本来生成语言文件，并对新增或修改的语句进行翻译；目前采用的是google翻译+百度翻译，由中文翻译成目标语言，翻译水平有限准确度一般。\n\n- `en-US.js`：English, 英文，lang=\"en-US\" 或 lang=\"en\"\n- `es.js`：Spanish, Español, 西班牙语，lang=\"es\"\n- `fr.js`：French, Français, 法语，lang=\"fr\"\n- `Template.js`：模板文件，当你需要的语言没有对应文件时，可以复制这个文件并改名，然后自行翻译成你需要的语言\n\n## 切换语言\n``` javascript\n//比如切换成英文，在引入Recorder之后再进行语言文件的import\nimport 'recorder-core/src/i18n/en-US.js'\n//<script src=\"src/i18n/en-US.js\"></script>\n\nRecorder.i18n.lang=\"en-US\" //切换成对应的语言，此后Recorder的所有输出文本均为此语言的文本\n```\n\n## i18n文档\n``` javascript\nvar $T=Recorder.i18n.$T; //可以直接用变量引用$T多语言文本处理函数\n\n//返回一个当前语言对应的文本，key必须唯一（可以用随机字符串）；key如果不存在将会把文本存入当前语言实例中，存在时将返回已存在的文本；文本中可以用{1-n}提供参数；文本详细格式定义请阅读Recorder.i18n源码中的注释\n$T(\"key-xx1::测试文本，{1}，{2}\",\":Test Text, {1}, {2}\",0,\"args1\",\"args2\");\n\n//可以直接在代码中提供多个语言文本；第一个默认zh-CN可以不写语言，第二个默认en-US可以不写语言，后面更多的必须写明是哪个语言\n//Recorder.i18n.lang=\"ru\" //设置当前语言为俄语\n$T(\"key-xx2:zh-CN:俄语 {1}\",\"en-US:Russian {1}\",\"ru:Русский язык {1}\",0,\"args1\");\n\n//可以直接获取key对应的文本，第二个参数是文本中的参数数组，key如果不存在将返回\"\"；$T.G这个函数主要用于一些预定义好的文本，免得多处出现相同的文本反复去翻译\n$T.G(\"key-xx1\",[\"v1\",\"v2\"]);\n$T.G(\"key-xx2\",[\"v1\"], \"ru\"); //明确返回俄语，不管当前lang设置的是什么\n```\n\n\n\n\n\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n\n# :open_book:其它功能介绍\n\n## 测试用的本地服务器\n在 [/assets/node-localServer](./assets/node-localServer) 目录内提供了一个nodejs服务，实现了http上传接口、websocket接口。多个demo中有使用到，方便测试。\n\n## WebSocket语音通话聊天demo\n在[线测试Demo](https://xiangyuecn.github.io/Recorder/)中包含了一个WebSocket版的语音通话聊天的测试功能，测试时需先运行上面这个本地服务器。用两个设备（浏览器打开两个标签也可以）打开demo，勾选实时语音通话聊天对讲，配置好双方标识，连接上服务器即可通话和聊天。手机上测试时，应当使用wss连接，本地服务器里面配置上ssl证书开启wss。\n\n对应的源码在 [/assets/zdemo.index.realtime_voice.js](./assets/zdemo.index.realtime_voice.js)，实时传输pcm格式的音频数据（未经过任何编码），用BufferStreamPlayer插件播放。\n\n![](assets/use_webrtc.png)\n\n## WebRTC语音通话聊天demo\n在[线测试Demo](https://xiangyuecn.github.io/Recorder/)中还包含了一个WebRTC版的语音通话聊天的测试功能，支持局域网内一对一语音无需服务器。用两个设备（浏览器打开两个标签也可以）打开demo，勾选实时语音通话聊天对讲再切换到WebRTC，按提示交换两个设备的信息即可成功进行P2P连接，然后进行语音。实际使用时数据传输用WebSocket的会简单好多。\n\n早期编写本语音测试的目的在于验证H5录音实时转码、传输的可行性，并验证实时转码mp3格式小片段文件接收后的可播放性。经测试发现：除了移动端可能存在设备性能低下的问题以外，录音后实时转码mp3并传输给对方是可行的，对方接收后播放也能连贯的播放（效果还是要看播放代码写的怎么样，目前没有比较完美的播放代码，用BufferStreamPlayer插件播放效果会好点）。另外（16kbps,16khz）MP3开语音15分钟大概3M的流量，wav、pcm 15分钟要37M多流量。\n\n另外除wav、pcm外MP3等格式编码出来的音频的播放时间比PCM原始数据要长一些或短一些，如果涉及到解码或拼接时，这个地方需要注意（如果类型支持，实时处理时使用`takeoffEncodeChunk`选项可完全避免此问题）。\n\n\n\n\n\n\n[​](?)\n\n[​](?)\n\n[​](?)\n\n# :star:捐赠\n如果这个库有帮助到您，请 Star 一下。\n\n您也可以使用支付宝或微信打赏作者：\n\n![](assets/donate-alipay.png)  ![](assets/donate-weixin.png)"
        },
        {
          "name": "app-support-sample",
          "type": "tree",
          "content": null
        },
        {
          "name": "assets",
          "type": "tree",
          "content": null
        },
        {
          "name": "dist",
          "type": "tree",
          "content": null
        },
        {
          "name": "index.html",
          "type": "blob",
          "size": 70.01171875,
          "content": "<!DOCTYPE HTML>\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\">\n<link rel=\"shortcut icon\" type=\"image/png\" href=\"assets/icon.png\">\n\n<title reclang=\"HQYi\">Recorder H5: 用于html5网页中的前端录音解决方案，此录音插件支持mp3 wav pcm g711a g711u amr ogg webm格式，支持实时上传 语音识别 音频可视化 实时处理，可在PC端 移动端 Android iOS 原生App中跨平台使用</title>\n\n<script>\nvar PageLM=\"2024-09-09 21:58\";\n(function(){\nconsole.log(\"【温馨提示】本页面用于测试Recorder的主要功能，代码难看臃肿，不建议阅读本页面源码；如果想要快速入门，请阅读github项目内首页README文档，参考文档内的快速使用部分，简单快捷高效，或者参考QuickStart.html页面。    \"\n+\"[Reminder] This page is used to test the main functions of Recorder. The code is ugly and bloated. It is not recommended to read the source code of this page; if you want to get started quickly, please read the README document on the homepage of the github project, and refer to the quick use part in the document, which is simple and fast Efficient, or refer to the QuickStart.html page.\");\n\n//加载核心库，其他类型支持库在下面根据用户点击选择加载，刷新页面可以恢复选择的类型\nvar srcC=\"src/recorder-core.js\",distC=\"dist/recorder-core.js\";\nvar initJss=[srcC];\nvar tei=window.TypeEngineImports={//不同类型编码器需要加载的js文件\n\tmp3:{src:[srcC,\"src/engine/mp3.js\",\"src/engine/mp3-engine.js\",0,\"src/engine/wav.js\"]\n\t\t,dist:[\"recorder.mp3.min.js\",0,\"src/engine/wav.js\"]}\n\t,wav:{src:[srcC,\"src/engine/wav.js\"]\n\t\t,dist:[\"recorder.wav.min.js\"]}\n\t,pcm:{src:[srcC,\"src/engine/pcm.js\",0,\"src/engine/wav.js\"]\n\t\t,dist:[distC,\"dist/engine/pcm.js\",0,\"src/engine/wav.js\"]}\n\t,amr:{src:[srcC,\"src/engine/beta-amr.js\",\"src/engine/beta-amr-engine.js\",0,\"src/engine/wav.js\"]\n\t\t,dist:[distC,\"dist/engine/beta-amr.js\",0,\"src/engine/wav.js\"]}\n\t,ogg:{src:[srcC,\"src/engine/beta-ogg.js\",\"src/engine/beta-ogg-engine.js\"]\n\t\t,dist:[distC,\"dist/engine/beta-ogg.js\"]}\n\t,g711a:{},g711u:{}\n\t,webm:{name:\"webm(beta)\",sort:99,\n\t\tsrc:[srcC,\"src/engine/beta-webm.js\"]\n\t\t,dist:[distC,\"dist/engine/beta-webm.js\"]}\n};\ntei.g711a.src=tei.g711u.src=[srcC,\"src/engine/g711x.js\",0,\"src/engine/wav.js\"];\ntei.g711a.dist=tei.g711u.dist=[distC,\"dist/engine/g711x.js\",0,\"src/engine/wav.js\"];\n\nwindow.Import_RecJs_Set={};//刷新页面，加载选中的类型js\nif(/recImport=([^?#&]+)/.test(location.href)){\n\ttry{\n\t\tvar o=JSON.parse(decodeURIComponent(RegExp.$1));\n\t\tvar te=tei[o.type]||{},jss=te[o.minJs?\"dist\":\"src\"];\n\t\tif(!jss)throw \"unknown type=\"+o.type;\n\t\tImport_RecJs_Set=o; initJss=jss;\n\t\tconsole.log(\"recImport init\", o, jss);\n\t}catch(e){\n\t\tconsole.error(\"recImport init error\",e);\n\t}\n}\nfor(var i=0;i<initJss.length;i++){\n\tif(initJss[i]){\n\t\tdocument.write('<scr'+'ipt src=\"'+initJss[i]+'\"></scr'+'ipt>');\n\t}\n}\n})()</script>\n</head>\n\n<body>\n<div class=\"main\">\n\n<!--加载可选扩展库-->\n<script src=\"src/extensions/waveview.js\"></script>\n<script src=\"src/extensions/wavesurfer.view.js\"></script>\n<script src=\"src/extensions/lib.fft.js\"></script>\n<script src=\"src/extensions/frequency.histogram.view.js\"></script>\n<script src=\"src/extensions/sonic.js\"></script>\n<script src=\"src/extensions/create-audio.nmn2pcm.js\"></script>\n<script src=\"src/extensions/dtmf.encode.js\"></script>\n<script src=\"src/extensions/dtmf.decode.js\"></script>\n\n<!--加载PlayBuffer-->\n<script src=\"assets/runtime-codes/fragment.playbuffer.js\"></script>\n\n\n<style>\nbody{\n\tword-wrap: break-word;\n\tword-break: break-all;\n\tbackground:#f5f5f5 center top no-repeat;\n\tbackground-size: auto 680px;\n}\npre{\n\twhite-space:pre-wrap;\n}\nlabel,label *{\n\tcursor: pointer;\n}\nlabel:hover{\n\tcolor:#06c;\n}\na{\n\ttext-decoration: none;\n\tcolor:#06c;\n}\na:hover{\n\tcolor:#f00;\n}\n\n.main{\n\tmax-width:700px;\n\tmargin:0 auto;\n\tpadding-bottom:80px\n}\n\n.mainBox{\n\tmargin-top:12px;\n\tpadding: 12px;\n\tborder-radius: 6px;\n\tbackground: #fff;\n\t--border: 1px solid #f60;\n\tbox-shadow: 2px 2px 3px #aaa;\n}\n\n\n.btns button,.mainBtn{\n\tdisplay: inline-block;\n\tcursor: pointer;\n\tborder: none;\n\tborder-radius: 3px;\n\tbackground: #f60;\n\tcolor:#fff;\n\tpadding: 0 15px;\n\tmargin:3px 20px 3px 0;\n\tline-height: 36px;\n\theight: 36px;\n\toverflow: hidden;\n\tvertical-align: middle;\n}\n.btns button:active,.mainBtn:active{\n\tbackground: #f00;\n}\n\n.recwaveChoice{\n\tcursor: pointer;\n\tdisplay:inline-block;\n\tvertical-align: bottom;\n\tborder-right:1px solid #ccc;\n\tbackground:#ddd;\n\tline-height:28px;\n\tfont-size:12px;\n\tcolor:#666;\n\tpadding:0 5px;\n}\n.recwaveChoice:first-child{\n\tborder-radius: 99px 0 0 99px;\n}\n.recwaveChoice:last-child{\n\tborder-radius: 0 99px 99px 0;\n\tborder-right:none;\n}\n.recwaveChoice.slc,.recwaveChoice:hover{\n\tbackground:#f60;\n\tcolor:#fff;\n}\n\n.lb{\n\tdisplay:inline-block;\n\tvertical-align: middle;\n\tbackground:#00940e;\n\tcolor:#fff;\n\tfont-size:14px;\n\tpadding:2px 8px;\n\tborder-radius: 99px;\n}\n\n\n.pd{\n\tpadding:0 0 6px 0;\n}\n</style>\n\n<script>\n//兼容环境\nfunction RandomKey(){\n\treturn \"randomkey\"+(RandomKey.idx++);\n};\nRandomKey.idx=0;\n\n//乐此不疲，古董浏览器，仅保证基本的可执行不代码异常\nif(!Date.now)Date.now=function(){return new Date().getTime()};\nif(!window.localStorage){window.localStorage={\n\tloadMinJs:/loadMinJs/.test(location.href)?\"1\":\"0\"\n}};\n</script>\n<script src=\"assets/ztest-jquery.min-1.9.1.js\"></script>\n\n<script src=\"assets/ztest-page-i18n.js\"></script>\n<div class=\"i18nBox\"></div>\n\n<div class=\"demoHead mainBox\">\n\t<style>\n\t\t.navItem{\n\t\t\tdisplay:inline-block;\n\t\t\twidth:45%;\n\t\t\tmax-width:300px;\n\t\t\tvertical-align: top;\n\t\t\tbackground:#eee;\n\t\t\tborder-bottom: 5px solid #ccc;\n\t\t\tbox-shadow: 2px 2px 3px #ddd;\n\t\t\tcolor:#666;\n\t\t\ttext-decoration:none;\n\t\t\tborder-radius: 8px;\n\t\t\tpadding: 0 5px 3px;\n\t\t}\n\t\t.navItem.slc{\n\t\t\tborder-bottom: 5px solid #00940e;\n\t\t\tcolor:#f60;\n\t\t}\n\t\t.navItem:hover{\n\t\t\tcolor:#d44;\n\t\t}\n\t\t.navTitle{\n\t\t\ttext-align: center;\n\t\t\tfont-size:18px;\n\t\t\tfont-weight: bold;\n\t\t}\n\t\t.navItem.slc .navDesc{\n\t\t\tcolor:#00940e;\n\t\t}\n\t\t.navDesc{\n\t\t\tfont-size:12px;\n\t\t}\n\t</style>\n\t<a class=\"navItem slc\" style=\"margin-right:2%;\" href=\"./\">\n\t\t<div class=\"navTitle\">Recorder H5</div>\n\t\t<div class=\"navDesc\" reclang=\"K23n\">Recorder H5使用简单，功能丰富，支持PC、Android、iOS 14.3+</div>\n\t</a>\n\t\n\t<a class=\"navItem\" href=\"./app-support-sample/\">\n\t\t<div class=\"navTitle\">Recorder App</div>\n\t\t<div class=\"navDesc\" reclang=\"50II\">支持：浏览器WebView（H5）、各种使用js来构建的程序（App、小程序、UniApp、Electron、NodeJs）</div>\n\t</a>\n\t\n\t<div style=\"margin-top:8px\">\n\t\t<span class=\"lb\" reclang=\"3LzK\">源码仓库 :</span>\n\t\t<a href=\"https://github.com/xiangyuecn/Recorder\" target=\"_blank\">GitHub</a>\n\t\t| <a href=\"https://gitee.com/xiangyuecn/Recorder\" target=\"_blank\">Gitee</a>\n\t\t\n\t\t<span class=\"lb\" reclang=\"IzbQ\">更多Demo :</span> <a href=\"assets/工具-代码运行和静态分发Runtime.html\" target=\"_blank\" reclang=\"Oy5V\">Demo列表(可编辑)</a>\n\t\t| <a href=\"assets/demo-vue/\" target=\"_blank\">H5 vue</a>\n\t\t| <a href=\"assets/demo-ts/\" target=\"_blank\">H5 ts</a>\n\t\t\n\t\t<div style=\"margin-top:6px;\">\n\t\t\t<span class=\"lb\">QuickStart :</span>\n\t\t\t<a href=\"QuickStart.html\" target=\"_blank\">QuickStart.html</a>\n\t\t\t<span style=\"font-size:12px;color:#999\" reclang=\"XTmp\">(Copy即用，更适合入门学习)</span>\n\t\t\t\n\t\t\t<span class=\"lb\" reclang=\"Ajm0\">老版本 :</span> <a href=\"assets/工具-GitHub页面历史版本访问.html#url=xiangyuecn:Recorder@1.0.19120600,/\" target=\"_blank\" reclang=\"dGDv\">切换到老版本测试</a>\n\t\t</div>\n\t</div>\n</div>\n\n\n\n\n<!-- begin 开始copy源码 -->\n<div class=\"demoMain\">\n\n<div class=\"mainBox\">\n\t<div class=\"pd\">\n\t\t<span class=\"lb\" reclang=\"Fwsy\">类型 :</span> <span class=\"types\"></span>\n\t\t\n\t\t<div style=\"padding-left:56px\">\n\t\t\t<label><input type=\"checkbox\" class=\"loadMinJs\"><span reclang=\"b9LX\">请求压缩版（*.min.js、dist/*）</span></label>\n\t\t</div>\n\t</div>\n\t<div class=\"pd\">\n\t\t<span class=\"lb\" reclang=\"ArEi\">提示 :</span> <span class=\"typeTips\">-</span>\n\t</div>\n\t<div class=\"pd\">\n\t\t<span class=\"lb\" reclang=\"hSjb\">比特率 :</span> <input type=\"text\" class=\"bit\" value=\"16\" style=\"width:60px\">\n\t\t<span reclang=\"oNuF\">kbps，越大音质越好</span>\n\t</div>\n\t<div>\n\t\t<span class=\"lb\" reclang=\"2oPC\">采样率 :</span> <input type=\"text\" class=\"sample\" value=\"16000\" style=\"width:60px\">\n\t\t<span reclang=\"ldVn\">hz，越大细节越丰富</span>\n\t</div>\n</div>\n\n<div class=\"mainBox\">\n\t<div class=\"pd btns\">\n\t\t<div>\n\t\t\t<button onclick=\"recopen()\" style=\"margin-right:10px\" reclang=\"fFtC\">打开录音,请求权限</button>\n\t\t\t<button onclick=\"recclose()\" style=\"margin-right:0\" reclang=\"p3Kq\">关闭录音,释放资源</button>\n\t\t</div>\n\t\t\n\t\t<button onclick=\"recstart()\" reclang=\"FIoV\">录制</button>\n\t\t<button onclick=\"recstop()\" style=\"margin-right:80px\" reclang=\"5bwK\">停止</button>\n\t\t\n\t\t<span style=\"display: inline-block;\">\n\t\t\t<button onclick=\"recpause()\" reclang=\"abgd\">暂停</button>\n\t\t\t<button onclick=\"recresume()\" reclang=\"SWBS\">继续</button>\n\t\t</span>\n\t\t<span style=\"display: inline-block;\">\n\t\t\t<button onclick=\"recPlayLast()\" reclang=\"WNdh\">播放</button>\n\t\t\t<button onclick=\"recUploadLast()\" reclang=\"xDbj\">上传</button>\n\t\t\t<button onclick=\"recDownLast()\" reclang=\"shLM\">本地下载</button>\n\t\t</span>\n\t</div>\n\t\n\t<div class=\"pd recpower\">\n\t\t<div style=\"height:40px;width:300px;background:#999;position:relative;\">\n\t\t\t<div class=\"recpowerx\" style=\"height:40px;background:#0B1;position:absolute;\"></div>\n\t\t\t<div class=\"recpowert\" style=\"padding-left:50px; line-height:40px; position: relative;\"></div>\n\t\t</div>\n\t</div>\n\t<div class=\"pd\">\n\t\t<button onclick=\"recstop2()\" class=\"batEnc\" reclang=\"uuZ6\">批量编码</button>\n\t\t<input type=\"text\" class=\"bits\" value=\"8 to 96 step 8\">\n\t\t<span reclang=\"dLMM\">kbps 测试音质用的，除比特率外其他参数可调整</span>\n\t</div>\n\t<div class=\"pd waveBox\">\n\t\t<div style=\"border:1px solid #ccc;display:inline-block\"><div style=\"height:100px;width:300px;\" class=\"recwave\"></div></div>\n\t\t\n\t\t<span style=\"font-size:0\">\n\t\t\t<span class=\"recwaveChoice\" key=\"WaveView\">WaveView</span>\n\t\t\t<span class=\"recwaveChoice\" key=\"SurferView\">SurferView</span>\n\t\t\t<span class=\"recwaveChoice\" key=\"Histogram1\">Histogram1</span>\n\t\t\t<span class=\"recwaveChoice\" key=\"Histogram2\">H...2</span>\n\t\t\t<span class=\"recwaveChoice\" key=\"Histogram3\">H...3</span>\n\t\t</span>\n\t</div>\n\t<div class=\"pd pcmPageHide\">\n\t\t<label><input type=\"checkbox\" class=\"autoStopSet\"><span reclang=\"hoh3\">开始录制后定时</span></label>\n\t\t<input type=\"text\" class=\"autoStopTime\" value=\"60000\" style=\"width:60px\">\n\t\t<span reclang=\"CX5p\">ms自动停止录音，定时录音</span>\n\t</div>\n\t<div class=\"pd pcmPageHide\">\n\t\t<label><input type=\"checkbox\" class=\"takeoffEncodeChunkSet\"><span reclang=\"AWXs\">接管编码器输出（takeoffEncodeChunk），切换后新打开录音生效</span></label>\n\t</div>\n\t<div class=\"pd pcmPageHide\">\n\t\t<label><input type=\"checkbox\" class=\"useAECSet\"><span reclang=\"vIzT\">尝试启用回声消除（echoCancellation）</span></label>\n\t</div>\n\t<div class=\"pd pcmPageHide\">\n\t\t<label><input type=\"checkbox\" class=\"realTimeSendSet\"><span reclang=\"SUfw\">实时语音通话聊天对讲（WebSocket、WebRTC）</span></label>\n\t\t<div class=\"realTimeSendView\" style=\"display:none;\"></div>\n\t</div>\n\t<div class=\"pcmPageHide\">\n\t\t<label><input type=\"checkbox\" class=\"asrSet\"><span reclang=\"lvN7\">实时语音识别、音频文件转文字，ASR</span></label>\n\t\t<div class=\"asrView\" style=\"display:none;\"></div>\n\t</div>\n</div>\n\t\n<div class=\"mainBox\">\n\t<audio class=\"recPlay\" controls style=\"display:none;width:100%\"></audio>\n\t<div class=\"reclog\"></div>\n\t<div class=\"recLastLog\" style=\"position:fixed;z-index:2;width:20vw;min-width:200px;max-height:100px;overflow:auto;right:0;bottom:0;background:#fff;padding:5px 10px;border-radius:6px 0 0 0;box-shadow:-1px -1px 3px #ddd;font-size:13px\"></div>\n</div>\n\n<div class=\"mainBox\">\n\t<div>\n\t\t<span class=\"lb\" reclang=\"QDzU\">切换麦克风 :</span>\n\t\t<select class=\"trackSet_device\"></select>\n\t\t<span reclang=\"hYD7\">从未请求过录音权限时，可能无法正常拉取设备列表，打开一次录音后可尝试</span>\n\t\t<button onclick=\"trackSetQueryDeviceList(1)\" reclang=\"gNwv\">重新拉取设备</button>\n\t</div>\n\t<div>\n\t\t<span class=\"lb\">noiseSuppression :</span>\n\t\t<select class=\"trackSet_noise\">\n\t\t\t<option value=\"\" reclang=\"3K14\">不设置</option>\n\t\t\t<option value=\"1\">true</option>\n\t\t\t<option value=\"2\">false</option>\n\t\t</select>\n\t\t<span reclang=\"Q0lg\">降噪（ANS）配置开关</span>\n\t</div>\n\t<div>\n\t\t<span class=\"lb\">echoCancellation :</span>\n\t\t<select class=\"trackSet_aec\">\n\t\t\t<option value=\"\" reclang=\"d6UL\">不设置</option>\n\t\t\t<option value=\"1\">true</option>\n\t\t\t<option value=\"2\">false</option>\n\t\t</select>\n\t\t<span reclang=\"ujUi\">回声消除（AEC）配置开关</span>\n\t</div>\n\t<div>\n\t\t<span class=\"lb\">autoGainControl :</span>\n\t\t<select class=\"trackSet_gain\">\n\t\t\t<option value=\"\" reclang=\"K3dr\">不设置</option>\n\t\t\t<option value=\"1\">true</option>\n\t\t\t<option value=\"2\">false</option>\n\t\t</select>\n\t\t<span reclang=\"gjGg\">自动增益（AGC）配置开关</span>\n\t</div>\n\t<div>\n\t\t<span class=\"lb\" reclang=\"h7dA\">sampleRate :</span>\n\t\t<input class=\"trackSet_sr\" style=\"width:60px\">\n\t\t<span reclang=\"h7dB\">（仅供测试）强制指定流的采样率，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象</span>\n\t</div>\n\t<div>\n\t\t<span style=\"color:#f60\" reclang=\"fP77\">以上参数设置后需重新打开录音</span><span reclang=\"7ots\">；均为set中的audioTrackSet高级配置，会直接传递给浏览器的getUserMedia方法，不同浏览器的支持程度不同，并不一定会生效；这些参数不设置时浏览器给的默认状态是打开还是关闭将不确定；</span>\n\t\t<span style=\"color:#aaa\" reclang=\"40Wa\">移动端打开降噪、回声消除可能会表现的很怪异（包括系统播放音量变小），但iOS上如果关闭又可能导致录音没有声音，如需更改配置请Android和iOS分别配置，并测试好</span>\n\t</div>\n</div>\n\n<div class=\"mainBox\">\n\t<span class=\"lb\" reclang=\"HmBe\">启用MediaRecorder :</span>\n\t<label>\n\t\t<input type=\"checkbox\" class=\"enableWebMSet\"><span reclang=\"WJse\">启用</span>\n\t\t<span style=\"color:#f60\" reclang=\"DIXY\">设置后需重新打开录音</span>\n\t</label>\n\t\n\t<div reclang=\"w1aV\">音频采集连接方式：启用时尝试使用MediaRecorder.WebM.PCM，默认启用，未启用或者不支持时使用AudioWorklet或ScriptProcessor；通过设置Recorder.ConnectEnableWebM=false禁用。</div>\n\t<div>\n\t\t<span style=\"color:#0b1\" reclang=\"sdaw\">使用MediaRecorder采集到的音频数据比其他方式更好，几乎不存在丢帧现象，所以音质明显会好很多，建议保持开启；</span>\n\t\t<span style=\"color:#aaa\" reclang=\"rAmm\">有些浏览器不支持录制PCM编码的WebM，如FireFox、低版本的Chrome，将依旧使用AudioWorklet或ScriptProcessor来连接采集。</span>\n\t</div>\n\t\n\t\n\t<div style=\"margin-top:12px;\"></div>\n\t<span class=\"lb\" reclang=\"C0vI\">启用AudioWorklet :</span>\n\t<label>\n\t\t<input type=\"checkbox\" class=\"enableWorkletSet\"><span reclang=\"AW2s\">启用</span>\n\t\t<span style=\"color:#f60\" reclang=\"5Ve2\">设置后需重新打开录音，ConnectEnableWebM如果启用并且有效时，本参数将不起作用</span>\n\t</label>\n\t\n\t<div reclang=\"o3Pt\">音频采集连接方式：启用时尝试使用AudioWorklet，默认禁用，未启用或者不支持时使用ScriptProcessor；通过设置Recorder.ConnectEnableWorklet=true启用。</div>\n\t<div>\n\t\t<span reclang=\"R0N9\">已知：AudioWorklet在一定条件下会导致某些浏览器崩溃</span>\n\t\t<a href=\"assets/ztest_chrome_bug_AudioWorkletNode.html\" target=\"_blank\" reclang=\"GQ6V\">测试</a>\n\t\t<span reclang=\"8Nn9\">(坑已填好)。</span>\n\t</div>\n\t<div class=\"workletSetTips\" style=\"color:#f60\"></div>\n</div>\n\n<div class=\"mainBox\">\n\t<div style=\"color:#0ab;font-size:22px;font-weight:bold\">\n\t\t<span reclang=\"ERHy\">如需录音功能定制开发，网站、App、小程序、前端后端开发等需求，请加QQ群：①群 781036591、②群 748359095、③群 450721519，口令recorder，联系群主（即作者），谢谢~</span>\n\t</div>\n</div>\n\n<div class=\"mainBox\">\n\t<div>\n\t\t<span class=\"lb\" reclang=\"HW4d\">变速变调 :</span> \n\t\t<button onclick=\"resetSonicCtrl()\" reclang=\"4yy4\">重置变速变调</button>\n\t\t<span reclang=\"BJNh\">实时变速变调控制选项（Sonic 插件），可以边录边修改，同一时间应该只控制一个，否则叠加作用；请填写0.1-2.0的数字，1.0为不调整，当然超过2.0也是可以的（需手动输入）</span>\n\t</div>\n\t<div class=\"sonicCtrlBox\" style=\"margin:5px 0 0;position: relative;\">\n\t\t<style>\n\t\t\t.sonicCtrlBox .t{display:inline-block;width:80px;text-align:right;}\n\t\t\t.sonicCtrlBox input{text-align:right;}\n\t\t</style>\n\t\t<div><span class=\"t\">Pitch:</span><input class=\"sonicCtrlInput sonicCtrlPitch\" style=\"width:60px\"> <span reclang=\"1KYh\">男声</span><input type=\"range\" class=\"sonicCtrlRange\" min=\"0.1\" max=\"2\" step=\"0.1\" value=\"1.0\"><span reclang=\"p8QU\">女声，变调不变速（会说话的汤姆猫）</span></div>\n\t\t<div><span class=\"t\">Speed:</span><input class=\"sonicCtrlInput sonicCtrlSpeed\" style=\"width:60px\"> <span reclang=\"67pP\">慢放</span><input type=\"range\" class=\"sonicCtrlRange\" min=\"0.1\" max=\"2\" step=\"0.1\" value=\"1.0\"><span reclang=\"MkST\">快放，变速不变调（快放慢放）</span></div>\n\t\t<div><span class=\"t\">Rate:</span><input class=\"sonicCtrlInput sonicCtrlRate\" style=\"width:60px\"> <span reclang=\"s3VS\">缓重</span><input type=\"range\" class=\"sonicCtrlRange\" min=\"0.1\" max=\"2\" step=\"0.1\" value=\"1.0\"><span reclang=\"ey5s\">尖锐，变速变调</span></div>\n\t\t<div><span class=\"t\">Volume:</span><input class=\"sonicCtrlInput sonicCtrlVolume\" style=\"width:60px\"> <span reclang=\"Zm38\">调低</span><input type=\"range\" class=\"sonicCtrlRange\" min=\"0.1\" max=\"2\" step=\"0.1\" value=\"1.0\"><span reclang=\"K4GQ\">调高，调整音量</span></div>\n\t\t\n\t\t<div style=\"border-top: 1px solid #eee;margin-top: 10px;\"><span class=\"t\" reclang=\"ErMk\">处理缓冲:</span><input class=\"sonicCtrlInput sonicCtrlBuffer\" style=\"width:60px\">ms 0ms<input type=\"range\" class=\"sonicCtrlRange sonicCtrlBufferRange\" min=\"0\" max=\"1000\" step=\"100\" value=\"200\">1000ms<span reclang=\"YU35\">，控制缓冲大小减少转换引入的杂音，0不缓冲</span></div>\n\t\t<div><span class=\"t\" reclang=\"zgh0\">播放反馈:</span><input class=\"sonicCtrlInput sonicCtrlPlay\" style=\"width:60px\"> <span reclang=\"wBFG\">不播放</span> <input type=\"range\" class=\"sonicCtrlRange\" min=\"0\" max=\"1\" step=\"1\" value=\"1\"><span reclang=\"a85k\">实时播放反馈</span></div>\n\t\t\n\t\t<div style=\"margin-top:10px\"><button onclick=\"sonicRecTransform()\" reclang=\"7RJF\">重新转换当前录音</button></div>\n\t\t\n\t\t<div class=\"sonicCtrlBoxMask\" style=\"position:absolute;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,.2);text-align: center;\">\n\t\t\t<div style=\"padding-top:50px;font-size: 30px;color: #fff;\" reclang=\"GUOu\">挡住！防止滑块被误触</div>\n\t\t\t<div><button onclick=\"sonicCtrlBoxMaskClose()\" reclang=\"bpmu\">打开编辑</button></div>\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"mainBox\">\n\t<span class=\"lb\" reclang=\"OOHq\">丢失补偿 :</span>\n\t<label>\n\t\t<input type=\"checkbox\" class=\"disableEnvInFixSet\"><span reclang=\"Ft0s\">禁用设备卡顿时音频输入丢失补偿功能（通过别的程序大量占用CPU来模拟设备卡顿）；</span>\n\t\t<span style=\"color:#f60\" reclang=\"EE7G\">设置后需重新打开录音</span>\n\t\t<span reclang=\"LqWd\">；为set中disableEnvInFix配置值</span>\n\t</label>\n\t<div><a href=\"https://github.com/xiangyuecn/Recorder/issues/51\">issues#51</a><span reclang=\"mpX0\">如果没有进行补偿，录音时设备偶尔出现很卡的情况下（CPU被其他程序大量占用），浏览器采集到的音频是断断续续的，导致10秒的录音可能就只返回了5秒的数据量，这个时候最终编码得到的音频时长明显变短，播放时的效果就像快放一样。未禁用时会在卡顿时自动补偿静默音频，消除了快放效果，但由于丢失的音频已被静默数据代替，听起来就是数据本身的断断续续的效果。在设备不卡时录音没有此问题。</span></div>\n\t\n\t<div style=\"margin-top:12px;\">\n\t\t<span class=\"lb\">Destroy :</span>\n\t\t<button onclick=\"callDestroy()\" reclang=\"qTKw\">调用Recorder.Destroy()</button>\n\t\t<span reclang=\"4xCn\">Destroy会关闭所有的全局资源，包括AudioContext，当录音出现问题时，可尝试Destroy一下重试</span>\n\t</div>\n\t\n\t<div style=\"margin-top:12px;\">\n\t\t<span class=\"lb\" reclang=\"fbxW\">阻止自动锁屏 :</span>\n\t\t<button onclick=\"wakeLockClick()\" reclang=\"y0Vx\">调用navigator.wakeLock 或 静音循环播放视频</button>\n\t\t<span reclang=\"5Fgu\">手机锁屏后是否能录音不可控，直接简单粗暴的调用wakeLock接口 或 静音+循环播放视频来阻止锁屏，就是有点费电</span>\n\t</div>\n\t\n\t<div style=\"margin-top:12px;\">\n\t\t<span class=\"lb\" reclang=\"JbX0\">暴力测试 :</span>\n\t\t<button onclick=\"testInject24HourPcmClick()\" reclang=\"KPAW\">开始注入</button>\n\t\t<input class=\"testInject24HourPcm_h\" value=\"24\" style=\"width:30px;text-align:right\">\n\t\t<span reclang=\"ioLq\">小时的录音数据，测试长时间录音编码和内存泄露</span>\n\t</div>\n\t\n\t<div style=\"margin-top:12px;\">\n\t\t<span class=\"lb\" reclang=\"4pBN\">暴力测试 :</span>\n\t\t<button onclick=\"testMultipleOpen5()\" reclang=\"KwYR\">同时打开5个录音（并发调用open）</button>\n\t\t<span reclang=\"X9aU\">，每个会录5秒，打开浏览器控制台查看日志</span>\n\t</div>\n</div>\n\n<div class=\"mainBox\">\n\t<div>\n\t\t<span class=\"lb\" reclang=\"SNMe\">DTMF电话按键信号 :</span> \n\t\t<span reclang=\"nVlV\">DTMF解码、编码插件，可以方便的处理电话拨号按键信号，用于：电话录音软解，软电话实时提取DTMF按键信号、实时发送DTMF按键信号等。下面拨号盘可在录音时往录音文件中添加按键信息：</span>\n\t</div>\n<div>\n<style>\n.dtmfTab td{padding: 15px 25px;border: 3px solid #ddd;cursor: pointer;user-select: none;}\n.dtmfTab td:hover{background:#f60;opacity:.2;color:#fff}\n.dtmfTab td:active{opacity:1}\n</style>\n\t<table onclick=\"sendDTMFKeyClick(event)\" class=\"dtmfTab\" style=\"border-collapse: collapse;text-align: center;border: 3px #ccc solid;\">\n\t\t<tr><td>1</td><td>2</td><td>3</td><td>A</td></tr>\n\t\t<tr><td>4</td><td>5</td><td>6</td><td>B</td></tr>\n\t\t<tr><td>7</td><td>8</td><td>9</td><td>C</td></tr>\n\t\t<tr><td>*</td><td>0</td><td>#</td><td>D</td></tr>\n\t</table>\n</div>\n\t<div style=\"margin:5px 0 0\">\n\t\t<div style=\"margin-top:10px\">\n\t\t\t<button onclick=\"decodeDTMF()\" reclang=\"HsEb\">识别当前录音中的DTMF按键信息</button>\n\t\t\t<button onclick=\"sendDTMFKeysClick()\" reclang=\"nWea\">发送*#1234567890#*</button>\n\t\t</div>\n\t</div>\n</div>\n\t\n<div class=\"mainBox\">\n\t<span class=\"lb\" reclang=\"CEEq\">测试App :</span>\n\tiOS Demo App：<a href=\"https://github.com/xiangyuecn/Recorder/tree/master/app-support-sample/demo_ios\" reclang=\"w49F\">下载源码</a> <span reclang=\"7kBy\">自行编译</span>\n\t\n\t，Android Demo App：<a href=\"https://gitee.com/xiangyuecn/Recorder/blob/master/app-support-sample/demo_android/app-debug.apk.zip\" reclang=\"o9ad\">下载APK</a> (<span reclang=\"EUXZ\">40kb，删除.zip后缀，</span><a href=\"https://github.com/xiangyuecn/Recorder/tree/master/app-support-sample/demo_android\" reclang=\"kiFv\">源码</a>)\n</div>\n\t\n<div class=\"mainBox\">\n\t<span class=\"lb\" reclang=\"z5Tl\">iframe兼容性 :</span> <button onclick=\"goiframe()\" reclang=\"pALQ\">把页面放到IFrame里面测试权限请求</button>\n\t<span reclang=\"B227\">测试在iframe里面请求录音权限的兼容性。最佳实践应该是让window.top(不适用于跨域)去加载Recorder，iframe里面使用top.Recorder；此测试未遵照此最佳实践，以模拟跨域iframe和同域下的复杂真实情况，H5录音在跨域时未设置相应策略权限永远是拒绝的</span>\n</div>\n\t\n<div class=\"mainBox\">\n\t<span class=\"lb\" reclang=\"gqjM\">音乐播放测试 :</span>\n\t<button onclick=\"recplay2(this,'rec-4000ms-8kbps-16000hz.wav')\">wav</button>\n\t<button onclick=\"recplay2(this,'rec-4000ms-64kbps-16000hz.mp3')\">mp3</button>\n\t<button onclick=\"recplay2(this,'rec-4000ms-64kbps-16000hz.ogg')\">ogg</button>\n\t<button onclick=\"recplay2(this,'rec-4000ms-64kbps-16000hz.webm')\">webm</button>\n\t<button onclick=\"recplay2(this,'rec-4000ms-12.8kbps-8000hz.amr')\">amr</button>\n\t<button onclick=\"recplay2(this,'nmn5')\" reclang=\"t0I5\">合成5分钟wav</button>\n\t\n\t<span reclang=\"XHIP\">Audio对录音的影响测试</span> (<a href=\"https://github.com/xiangyuecn/Recorder/issues/34\">issues#34</a>) <span reclang=\"LfbN\">；低版本iOS Safari如果未开始过录音并且播放了音乐，然后后续录音可能会有问题；再现方法</span> (<a href=\"assets/ztest_apple_developer_forums_getusermedia.html\">test apple developer forums</a>): <span reclang=\"T3B7\">刷新页面后首先先播放音乐，然后开始测试录音，会发现波形显示掉帧或者保持直线。另测试浏览器对音频的支持情况。</span>\n</div>\n\n<div class=\"mainBox\">\n\t<span class=\"lb\" reclang=\"HH7Z\">视频播放测试 :</span>\n\t<button onclick=\"videoTestPlay('')\" reclang=\"9q2V\">播放mp4</button>\n\t<script>var videoTestPlay=function(attr){\n\t\t$('.videoTest').show().html('<video controls '+attr+' webkit-playsinline playsinline x5-video-player-type=\"h5\" '\n\t\t+'style=\"width:370px;height:160px\">'\n\t\t+'<source src=\"assets/audio/movie-一代宗师-此一时彼一时.mp4.webm\" type=\"video/mp4\"/>' //fix safari\n\t\t+'</'+'video>').find('video')[0].play()\n\t}</script>\n\t\n\t<span reclang=\"WQXo\">Video对录音的影响测试</span> (<a href=\"https://github.com/xiangyuecn/Recorder/issues/84\">issues#84</a>) <span reclang=\"skOH\">；iOS Safari可能出现先播放视频，然后再开始录音，会自动播放视频的声音，但并未再现。</span>\n\t<button onclick=\"$('.videoTest').show()\" reclang=\"M5YG\">显示video</button>\n\t<button onclick=\"$('.videoTest').hide()\" reclang=\"uagh\">隐藏video</button>\n\t<button onclick=\"$('.videoTest').html('')\" reclang=\"W1Vo\">移除video</button>\n\t<button onclick=\"videoTestPlay(' loop')\" reclang=\"LrV6\">循环播放</button>\n\t<button onclick=\"videoTestPlay(' loop muted')\" reclang=\"6IaJ\">静音循环播放</button>\n\t<div class=\"videoTest\"></div>\n</div>\n\n<div class=\"mainBox\">\n\t<span class=\"lb\" reclang=\"0Wqg\">浏览器环境情况 :</span>\n\t<pre class=\"recinfoCode\"></pre><textarea class=\"recinfoCodeTxt\" style=\"display:none\">\nAudioContext:${\"AudioContext\" in window}\nwebkitAudioContext:${\"webkitAudioContext\" in window}\nmediaDevices:${!!navigator.mediaDevices}\nmediaDevices.getUserMedia:${!!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)}\nnavigator.getUserMedia:${!!navigator.getUserMedia}\nnavigator.webkitGetUserMedia:${!!navigator.webkitGetUserMedia}\nAudioContext.scriptProcessor:{{\n\t\t\t\t\t\t\"createScriptProcessor\" in (Recorder.Ctx||{})\n\t\t\t\t\t || \"createJavaScriptNode\" in (Recorder.Ctx||{})\n\t\t\t\t\t}}\nAudioContext.audioWorklet:{{\"audioWorklet\" in (Recorder.Ctx||{})}}\nAudioWorkletNode:${\"AudioWorkletNode\" in window}\nMediaRecorder:${\"MediaRecorder\" in window}\nMediaRecorder.ondataavailable:${\"MediaRecorder\" in window && \"ondataavailable\" in MediaRecorder.prototype}\nMediaRecorder.WebM.PCM:${\"MediaRecorder\" in window && MediaRecorder.isTypeSupported(\"audio/webm; codecs=pcm\")}\n\nURL:${location.href.replace(/#.+/g,\"\")}\nUA:${navigator.userAgent}\n\n<span reclang=\"qfGt\">Recorder库修改时间（有可能修改了忘改）：</span>${Recorder.LM}\n<span reclang=\"VXCO\">本页面修改时间（有可能修改了忘改）：</span>${PageLM}\n</textarea>\n\t\n\t<span class=\"lb\" reclang=\"z6w4\">问题自检 :</span> <span reclang=\"6TKY\">录音时注意观察灰色区域是否有绿色音量跳动，没有绿色跳动说明Recorder没有获取到声音数据。如果测试发现mp3没有声音，可以试一下wav格式，如果wav格式有声音，说明内置lamejs mp3编码器有问题。如果都没有，下载下来播放看看有没有。下载下来也没有声音可以反馈一下。</span>\n\t<div style=\"padding-top:20px;font-size:26px;color:#fa0\">\n\t<span reclang=\"SaFm\">如果浏览器不能正常录音，并且不确定是不是这个库的问题，可以到</span> <a href=\"assets/ztext_collab-project_videojs-record.html\">assets/ztext_collab-project_videojs-record.html</a> <span reclang=\"Ma2G\">试一下。</span>\n\t</div>\n</div>\n\n\n\n<script>\nfunction reclog(s,color){\n\tvar now=new Date();\n\tvar t=(\"0\"+now.getHours()).substr(-2)\n\t\t+\":\"+(\"0\"+now.getMinutes()).substr(-2)\n\t\t+\":\"+(\"0\"+now.getSeconds()).substr(-2);\n\tvar html='<div style=\"color:'+(!color?\"\":color==1?\"red\":color==2?\"#0b1\":color)+'\">['+t+']'+s+'</div>';\n\t$(\".reclog\").prepend(html);\n\t$(\".recLastLog\").html(html.replace(/class\\s*=/ig,\"clazz=\"));\n};\nwindow.onerror=function(message, url, lineNo, columnNo, error){\n\t//https://www.cnblogs.com/xianyulaodi/p/6201829.html\n\treclog('【Uncaught Error】'+message+'<pre>'+\"at:\"+lineNo+\":\"+columnNo+\" url:\"+url+\"\\n\"+(error&&error.stack||Html_$T(\"T13G::不能获得错误堆栈\"))+'</pre>',1);\n};\n</script>\n\n\n\n<script>\nvar rec,processTime;\nfunction recopen(call){\n\tcall||(call=function(msg){\n\t\tmsg&&reclog(msg,1);\n\t});\n\tif(rec&&Recorder.IsOpen()){//如果有老的，close掉重新开新的\n\t\trecclose();\n\t};\n\tvar type=$(\"[name=type]:checked\").val();\n\tvar bit=+$(\".bit\").val();\n\tvar sample=+$(\".sample\").val();\n\t\n\tcancelAutoStop();\n\twindow.waveStore={};\n\twindow.sonicAsync=null;\n\twindow.takeoffChunks=[];\n\t\n\tvar disableEnvInFixSet=$(\".disableEnvInFixSet\")[0].checked;\n\tif(disableEnvInFixSet){\n\t\treclog(Html_$T(\"Ysbv::已禁用设备卡顿时音频输入丢失补偿，可以通过别的程序大量占用CPU来模拟设备卡顿，然后录音听听未补偿时的播放效果，然后再试试不禁用的效果\"));\n\t};\n\t\n\tvar enableWebM=$(\".enableWebMSet\")[0].checked;\n\tRecorder.ConnectEnableWebM=enableWebM;\n\tif(!enableWebM){\n\t\treclog(Html_$T(\"kmRS::已禁用MediaRecorder.WebM.PCM\"),\"#aaa\");\n\t}\n\t\n\tvar enableWorklet=$(\".enableWorkletSet\")[0].checked;\n\tRecorder.ConnectEnableWorklet=enableWorklet;\n\tif(enableWorklet){\n\t\treclog(Html_$T(\"Tddh::已启用AudioWorklet\")+(enableWebM?Html_$T(\"0ZRO::（同时启用了MediaRecorder，AudioWorklet只会在MediaRecorder未生效时采用）\"):\"\")+\", \"+workletTips,\"#f60\");\n\t}\n\t\n\tvar audioTrackSet=null;\n\tvar useAEC=$(\".useAECSet\")[0].checked;\n\tvar trackSet_device=$(\".trackSet_device\").val();\n\tvar trackSet_noise=useAEC?1:$(\".trackSet_noise\").val();\n\tvar trackSet_aec=useAEC?1:$(\".trackSet_aec\").val();\n\tvar trackSet_gain=useAEC?1:$(\".trackSet_gain\").val();\n\tvar trackSet_sr=+$(\".trackSet_sr\").val()||0;\n\tif(trackSet_device || trackSet_noise || trackSet_aec || trackSet_gain || trackSet_sr){\n\t\taudioTrackSet={};\n\t\tif(trackSet_device){\n\t\t\tvar device=DeviceList[+trackSet_device];\n\t\t\taudioTrackSet.deviceId=device.deviceId;\n\t\t\taudioTrackSet.groupId=device.groupId;\n\t\t}\n\t\tif(trackSet_noise){\n\t\t\taudioTrackSet.noiseSuppression=+trackSet_noise==1;\n\t\t}\n\t\tif(trackSet_aec){\n\t\t\taudioTrackSet.echoCancellation=+trackSet_aec==1;\n\t\t}\n\t\tif(trackSet_gain){\n\t\t\taudioTrackSet.autoGainControl=+trackSet_gain==1;\n\t\t}\n\t\tif(trackSet_sr){\n\t\t\taudioTrackSet.sampleRate=trackSet_sr;\n\t\t}\n\t\t\n\t\treclog(Html_$T(\"W5cU::已启用audioTrackSet配置：\")+JSON.stringify(audioTrackSet));\n\t};\n\t\n\tvar realTimeSendSet=$(\".realTimeSendSet\")[0].checked;\n\t\n\tvar asrSet=$(\".asrSet\")[0].checked;\n\t\n\tvar takeoffEncodeChunkSet=$(\".takeoffEncodeChunkSet\")[0].checked;\n\t\n\trec=Recorder({\n\t\ttype:type\n\t\t,bitRate:bit\n\t\t,sampleRate:sample\n\t\t,audioTrackSet:audioTrackSet\n\t\t,disableEnvInFix:disableEnvInFixSet\n\t\t,onProcess:function(buffers,powerLevel,duration,sampleRate,newBufferIdx,asyncEnd){\n\t\t\t//优先进行pcm处理，可能会发生数据修改，对于需要大量运算的处理需要开启异步模式，onProcess返回true即可开启，异步操作完成后必须回调asyncEnd\n\t\t\tprocessTime=Date.now();\n\t\t\t\n\t\t\t//实时混合按键信号\n\t\t\tif(dtmfMix){\n\t\t\t\tvar val=dtmfMix.mix(buffers, sampleRate, newBufferIdx);\n\t\t\t\tif(val.newEncodes.length>0){\n\t\t\t\t\trec.PlayBufferDisable=true;\n\t\t\t\t\tDemoFragment.PlayBuffer(rec,val.newEncodes[0].data,sampleRate);\n\t\t\t\t};\n\t\t\t};\n\t\t\t//变速变调\n\t\t\tvar beginAsync=sonicProcess(rec,buffers,sampleRate,newBufferIdx,asyncEnd);\n\t\t\t\n\t\t\t$(\".recpowerx\").css(\"width\",powerLevel+\"%\");\n\t\t\t$(\".recpowert\").text(formatMs(duration,1)+\" / \"+powerLevel);\n\t\t\t\n\t\t\t//可视化图形绘制\n\t\t\tif(waveStore.choice!=recwaveChoiceKey){\n\t\t\t\twaveStore.choice=recwaveChoiceKey;\n\t\t\t\t$(\".recwave\").html(\"\").append(waveStore[recwaveChoiceKey].elem);\n\t\t\t};\n\t\t\twaveStore[recwaveChoiceKey].input(buffers[buffers.length-1],powerLevel,sampleRate);\n\t\t\t\n\t\t\t//实时传输\n\t\t\tif(realTimeSendSet&&window.realTimeSendTry){\n\t\t\t\trealTimeSendTry(rec.set,buffers,sampleRate);\n\t\t\t};\n\t\t\tif(realTimeSendSet&&window.RtVoiceProcess){\n\t\t\t\tRtVoiceProcess(buffers,powerLevel,duration,sampleRate,newBufferIdx);\n\t\t\t};\n\t\t\t//实时语音识别\n\t\t\tif(asrSet&&window.asrInput){\n\t\t\t\tasrInput(buffers,sampleRate,newBufferIdx);\n\t\t\t};\n\t\t\t//注入24小时的录音数据\n\t\t\tif(window.testInject24HourPcmOnProc){\n\t\t\t\ttestInject24HourPcmOnProc(buffers,sampleRate);\n\t\t\t};\n\t\t\t\n\t\t\treturn beginAsync;//返回true转成异步操作\n\t\t}\n\t\t,takeoffEncodeChunk:!takeoffEncodeChunkSet?null:function(chunkBytes){\n\t\t\tif(window.testInject24HourPcmOnTake){//注入24小时的录音数据\n\t\t\t\ttestInject24HourPcmOnTake(chunkBytes);\n\t\t\t}\n\t\t\ttakeoffChunks.push(chunkBytes);\n\t\t}\n\t});\n\t\n\trec.open(function(){\n\t\tvar typeSize=\", <span style='border:1px solid #bbb;background:#f5f5f5;'>\";\n\t\tif(type==\"wav\"){\n\t\t\ttypeSize+=Html_$T(\"IYAd::1秒的wav文件大小(字节)估算公式：采样率 × 位数 ÷ 8，当前：\")+sample+\"*\"+bit+\"/8≈\"+(sample*bit/8)+\"B/s\";\n\t\t}else if(type==\"mp3\"){\n\t\t\ttypeSize+=Html_$T(\"tMnU::1秒的mp3文件大小(字节)估算公式：比特率 × 1000 ÷ 8，当前：\")+bit+\"*1000/8≈\"+(bit*1000/8)+\"B/s\";\n\t\t}else{\n\t\t\ttypeSize=\"\";\n\t\t};\n\t\ttypeSize&&(typeSize+=\"</span>\");\n\t\t\n\t\treclog(\"<span style='color:#0b1'>\"+Html_$T(\"VJya::已打开:\")+type+\" \"+sample+\"hz \"+bit+\"kbps</span>\"+typeSize);\n\t\t\n\t\t//此处创建这些音频可视化图形绘制浏览器支持妥妥的\n\t\tinitWaveStore(waveStore,\".recwave\");\n\t\t\n\t\tcall();\n\t},function(e,isUserNotAllow){\n\t\tcall((isUserNotAllow?\"UserNotAllow, \":\"\")+Html_$T(\"YY7k::打开失败：\")+e);\n\t});\n};\n\n\nvar callDestroy=function(){\n\tRecorder.Destroy();\n\treclog(Html_$T(\"VPJO::已执行Recorder.Destroy()\"));\n\tscrollToEl(\".reclog\");\n};\n\n//拉取麦克风设备列表\nvar DeviceList=[];\nvar trackSetQueryDeviceList=function(click){\n\tvar end=function(list,err){\n\t\tDeviceList=list; var list2=[];\n\t\tvar opts=['<option value=\"\" rec'+'lang=\"6BfR\">'+(list.length?Html_xT(Html_$T('6BfR::不设置')):err)+'</option>'];\n\t\tfor(var i=0;i<list.length;i++){\n\t\t\tvar o=list[i];\n\t\t\tif(o.deviceId && o.kind==\"audioinput\"){\n\t\t\t\tlist2.push(o);\n\t\t\t\tvar name=o.label||((i+1)+\"# \"+Html_xT(Html_$T(\"lDoQ::无名称，可能是因为从来没有打开过录音\")));\n\t\t\t\topts.push('<option value=\"'+i+'\">'+name+'</option>');\n\t\t\t}\n\t\t}\n\t\t$(\".trackSet_device\").html(opts.join(\" \"));\n\t\t\n\t\tif(click){\n\t\t\tconsole.log(\"DeviceList: \", JSON.parse(JSON.stringify(list)));\n\t\t\treclog(Html_$T(\"vM9Z::已重新拉取到{1}个设备，可切换要使用的麦克风\",0,list2.length),2);\n\t\t}\n\t};\n\tif(navigator.mediaDevices && navigator.mediaDevices.enumerateDevices){\n\t\tnavigator.mediaDevices.enumerateDevices().then(end)[\"catch\"](function(e){\n\t\t\tend([],Html_$T(\"4EHk::拉取失败：\")+e.message);\n\t\t});\n\t}else{\n\t\tend([],Html_$T(\"2KHv::此浏览器不支持拉取设备列表\"));\n\t}\n};\ntrackSetQueryDeviceList();\n\n\nfunction recclose(){\n\tcancelAutoStop();\n\tif(rec){\n\t\trec.close(function(){\n\t\t\treclog(Html_$T(\"q5nu::已关闭\"));\n\t\t});\n\t}else{\n\t\treclog(Html_$T(\"10CI::未打开录音\"),1);\n\t};\n};\nfunction recstart(call){\n\tcancelAutoStop();\n\tcall||(call=function(msg){\n\t\tmsg&&reclog(msg,1);\n\t});\n\tif(rec&&Recorder.IsOpen()){\n\t\twindow.realTimeSendTryReset&&realTimeSendTryReset(rec.set);\n\t\t\n\t\tsonicAsync&&sonicAsync.flush();//丢弃不管，省的去同步麻烦\n\t\tsonicAsync=null;\n\t\trec.sonicTips=\"\";\n\t\t\n\t\ttestInject24HourPcmStore.sid++;\n\t\ttakeoffChunks=[];\n\t\t\n\t\t//定时停止\n\t\tvar autoStop=$(\".autoStopSet\")[0].checked;\n\t\tif(autoStop){\n\t\t\tvar time=+$(\".autoStopTime\").val()||0;\n\t\t\tif(time<100){\n\t\t\t\treclog(Html_$T(\"JsIA::定时不能小于100ms\"),1);\n\t\t\t\treturn;\n\t\t\t};\n\t\t\tautoStopTimer=setTimeout(function(){\n\t\t\t\tautoStopTimer=0;\n\t\t\t\treclog(Html_$T(\"BQXI::定时时间到，开始自动调用停止...\"));\n\t\t\t\trecstop();\n\t\t\t},time);\n\t\t};\n\t\t\n\t\trec.start();\n\t\tvar set=rec.set;\n\t\treclog((autoStop?Html_$T(\"UJ0C::[定时{1}ms]\",0,time):\"\")+Html_$T(\"GF0Y::录制中：\")+set.type+\" \"+set.sampleRate+\"hz \"+set.bitRate+\"kbps\");\n\t\t\n\t\t//【稳如老狗WDT】可选的，监控是否在正常录音有onProcess回调，如果长时间没有回调就代表录音不正常\n\t\tvar wdt=rec.watchDogTimer=setInterval(function(){\n\t\t\tif(!rec || wdt!=rec.watchDogTimer){ clearInterval(wdt); return } //sync\n\t\t\tif(Date.now()<rec.wdtPauseT) return; //如果暂停录音了就不检测：puase时赋值rec.wdtPauseT=Date.now()*2（永不监控），resume时赋值rec.wdtPauseT=Date.now()+1000（1秒后再监控）\n\t\t\tif(Date.now()-(processTime||startTime)>1500){ clearInterval(wdt);\n\t\t\t\treclog(processTime?Html_$T(\"eWp1::录音被中断\"):Html_$T(\"eWp2::录音未能正常开始\"),1);\n\t\t\t\t// ... 错误处理，关闭录音，提醒用户\n\t\t\t}\n\t\t},1000);\n\t\tvar startTime=Date.now(); rec.wdtPauseT=0; processTime=0;\n\t\t\n\t\tcall();\n\t}else{\n\t\tcall(Html_$T(\"jpoV::未打开录音\"));\n\t};\n};\nvar autoStopTimer;\nvar cancelAutoStop=function(){\n\tif(autoStopTimer){\n\t\treclog(Html_$T(\"7Xno::已取消定时停止\"),1);\n\t\tclearTimeout(autoStopTimer);\n\t\tautoStopTimer=0;\n\t};\n};\nfunction recpause(){\n\tif(rec){\n\t\trec.pause();\n\t\trec.wdtPauseT=Date.now()*2; //永不监控onProcess超时\n\t\treclog(Html_$T(\"DPvI::已暂停\"));\n\t};\n};\nfunction recresume(){\n\tif(rec){\n\t\trec.resume();\n\t\trec.wdtPauseT=Date.now()+1000; //1秒后再监控onProcess超时\n\t\treclog(Html_$T(\"4P6z::继续录音中...\"));\n\t};\n};\nvar recblob={};\nfunction recstop(call){\n\trecstopFn(call,true,function(err,blob,time){\n\t\tsetTimeout(function(){\n\t\t\twindow.realTimeSendTryStop&&realTimeSendTryStop(rec.set);\n\t\t\t\n\t\t\tif(!err && rec.set.takeoffEncodeChunk){\n\t\t\t\treclog(Html_$T(\"Wjge::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据\"),\"#f60\");\n\t\t\t\treclog(Html_$T(\"j4R1::takeoffEncodeChunk接收到{1}片音频片段，正在合并成一个音频文件...\",0,takeoffChunks.length));\n\t\t\t\tvar len=0;\n\t\t\t\tfor(var i=0;i<takeoffChunks.length;i++){\n\t\t\t\t\tlen+=takeoffChunks[i].length;\n\t\t\t\t};\n\t\t\t\tvar chunkData=new Uint8Array(len);\n\t\t\t\tfor(var i=0,idx=0;i<takeoffChunks.length;i++){\n\t\t\t\t\tvar itm=takeoffChunks[i];\n\t\t\t\t\tchunkData.set(itm,idx);\n\t\t\t\t\tidx+=itm.length;\n\t\t\t\t};\n\t\t\t\tvar blob=new Blob([chunkData],{type:\"audio/\"+rec.set.type});\n\t\t\t\taddRecLog(time,Html_$T(\"QdKZ::合并\"),blob,rec.set,Date.now());\n\t\t\t};\n\t\t});\n\t});\n};\nfunction recstopFn(call,isClick,endCall,rec){\n\tcancelAutoStop();\n\tcall||(call=function(msg){\n\t\tmsg&&reclog(msg,1);\n\t});\n\trec=rec||window.rec;\n\tif(rec){\n\t\tif(isClick){\n\t\t\treclog(Html_$T(\"exSK::正在编码{1}...\",0,rec.set.type));\n\t\t};\n\t\tvar t1=Date.now();\n\t\trec.watchDogTimer=0; //停止监控onProcess超时\n\t\trec.stop(function(blob,time){\n\t\t\tvar tag=endCall(\"\",blob,time);\n\t\t\tif(tag==-1){\n\t\t\t\treturn;\n\t\t\t};\n\t\t\t\n\t\t\taddRecLog(time,tag||Html_$T(\"V8He::已录制\"),blob,rec.set,t1);\n\t\t\t\n\t\t\tcall(null,{data:blob,duration:time});\n\t\t},function(s){\n\t\t\tendCall(s);\n\t\t\tcall(Html_$T(\"ENLS::失败：\")+s);\n\t\t});\n\t}else{\n\t\tcall(Html_$T(\"rb0B::未打开录音\"));\n\t};\n};\nvar recLogLast;\nvar addRecLog=function(time,tag,blob,set,t1){\n\tvar id=RandomKey(16);\n\trecLogLast={blob:blob,set:$.extend({},set),time:time,key:id};\n\trecblob[id]=recLogLast;\n\tvar a1=intp(Date.now()-t1,4),a2=intp(blob.size,6);\n\treclog(tag+\": \"+intp(set.bitRate,3)+\"kbps \"+intp(set.sampleRate,5)+\"hz \"\n\t\t+Html_$T(\"37rX::花{1}ms编码{2}B\",0,a1,a2)\n\t\t+\" [\"+set.type+\"]\"+formatMs(time)+'ms'\n\t\t+' <button onclick=\"recdown(\\''+id+'\\')\">'+Html_$T(\"abXa::下载\")+'</button>'\n\t\t+' <button onclick=\"recplay(\\''+id+'\\')\">'+Html_$T(\"GhtN::播放\")+'</button>'\n\t\t+' <span class=\"p'+id+'\"></span> <span class=\"d'+id+'\"></span>');\n};\nvar intp=function(s,len){\n\ts=s==null?\"-\":s+\"\";\n\tif(s.length>=len)return s;\n\treturn (\"_______\"+s).substr(-len);\n};\nvar formatMs=function(ms,all){\n\tvar ss=ms%1000;ms=(ms-ss)/1000;\n\tvar s=ms%60;ms=(ms-s)/60;\n\tvar m=ms%60;ms=(ms-m)/60;\n\tvar h=ms;\n\tvar t=(h?h+\":\":\"\")\n\t\t+(all||h+m?(\"0\"+m).substr(-2)+\":\":\"\")\n\t\t+(all||h+m+s?(\"0\"+s).substr(-2)+\"″\":\"\")\n\t\t+(\"00\"+ss).substr(-3);\n\treturn t;\n};\nfunction recstop2(){\n\tif(!rec||!rec.buffers){\n\t\treclog(Html_$T(\"bh1I::需先录个音\"),1);\n\t\treturn;\n\t};\n\t\n\tvar type=$(\"[name=type]:checked\").val();\n\tvar sample=+$(\".sample\").val();\n\tvar bits=/(\\d+)\\s+to\\s+(\\d+)\\s+step\\s+(\\d+)\\s*/i.exec($(\".bits\").val());\n\tif(!bits){\n\t\treclog(Html_$T(\"hrO5::码率列表有误，需要? to ? step ?结构\"));\n\t\treturn;\n\t};\n\treclog(Html_$T(\"iPKE::开始批量编码，请勿进行其他操作~\"));\n\t\n\trec.set.type=type;\n\trec.set.sampleRate=sample;\n\t\n\tvar list=[];\n\tfor(var i=+bits[1];i<+bits[2]+1;i+=+bits[3]){\n\t\tlist.push(i);\n\t};\n\tif(/^(wav|pcm)$/.test(rec.set.type)){\n\t\tlist=[8,16];\n\t};\n\tif(rec.set.type==\"amr\"){\n\t\tlist=[4.75, 5.15, 5.9, 6.7, 7.4, 7.95, 10.2, 12.2];\n\t};\n\t\n\t\n\tvar i=-1;\n\tvar bak=rec.set.bitRate;\n\tvar run=function(){\n\t\ti++;\n\t\tif(i>=list.length){\n\t\t\trec.set.bitRate=bak;\n\t\t\treclog(Html_$T(\"IIQy::批量编码完成\"));\n\t\t\treturn;\n\t\t};\n\t\trec.set.bitRate=list[i];\n\t\trec.isMock=1;\n\t\trecstopFn(null,0,function(){\n\t\t\tsetTimeout(run);\n\t\t});\n\t};\n\trun();\n};\nfunction recplay(key){\n\tvar audio=$(\".recPlay\")[0];\n\taudio.style.display=\"inline-block\";\n\tif(!(audio.ended || audio.paused)){\n\t\taudio.pause();\n\t};\n\t\n\tvar o=recblob[key];\n\tif(o){\n\t\to.play=(o.play||0)+1;\n\t\tvar logmsg=function(msg){\n\t\t\t$(\".p\"+key).html('<span style=\"color:green\">'+o.play+'</span> '+new Date().toLocaleTimeString()+\" \"+msg);\n\t\t};\n\t\tlogmsg(\"\");\n\t\taudio.onerror=function(e){\n\t\t\tlogmsg('<span style=\"color:red\">'+Html_$T(\"wcUU::播放失败\")+'['+audio.error.code+']'+audio.error.message+'</span>');\n\t\t};\n\t\t\n\t\tif(o.play2Name){\n\t\t\to.play--;\n\t\t\tif(o.play2Msg){\n\t\t\t\tlogmsg(o.play2Msg);\n\t\t\t}else if(o.play2Err){\n\t\t\t\tlogmsg('<span style=\"color:red\">'+o.play2Err+'</span>');\n\t\t\t}else{\n\t\t\t\to.play++;\n\t\t\t\taudio.src=o.play2Url||(\"assets/audio/\"+o.play2Name);\n\t\t\t\taudio.play();\n\t\t\t}\n\t\t\treturn;\n\t\t};\n\t\tvar end=function(blob){\n\t\t\taudio.src=(window.URL||webkitURL).createObjectURL(blob);\n\t\t\taudio.play();\n\t\t};\n\t\tvar wav=Recorder[o.set.type+\"2wav\"];\n\t\tif(wav){\n\t\t\tlogmsg(Html_$T(\"PxSY::正在转码成wav...\"));\n\t\t\tvar wavData=o.blob;\n\t\t\tif(o.set.type==\"pcm\"){\n\t\t\t\twavData={\n\t\t\t\t\tsampleRate:o.set.sampleRate\n\t\t\t\t\t,bitRate:o.set.bitRate\n\t\t\t\t\t,blob:o.blob\n\t\t\t\t};\n\t\t\t};\n\t\t\twav(wavData,function(blob){\n\t\t\t\tend(blob);\n\t\t\t\tlogmsg(Html_$T(\"QCXF::已转码成wav播放\"));\n\t\t\t},function(msg){\n\t\t\t\tlogmsg('<span style=\"color:red\">'+Html_$T('ywQN::转码成wav失败：')+msg+'</span>');\n\t\t\t});\n\t\t}else{\n\t\t\tend(o.blob);\n\t\t};\n\t};\n};\nfunction recplay2(elem,name){\n\tvar url=\"\";\n\tvar run=function(msg,err){\n\t\telem=$(elem);\n\t\tvar key=\"recplay2\"+elem.html();\n\t\tObject.assign(recblob[key]||(recblob[key]={}),{\n\t\t\tplay2Name:name\n\t\t\t,play2Url:url\n\t\t\t,play2Msg:msg\n\t\t\t,play2Err:err\n\t\t});\n\t\tif(!$(\".p\"+key).length){\n\t\t\telem.before('<br>');\n\t\t\telem.after('<span class=\"p'+key+'\"></span><br>');\n\t\t};\n\t\t\n\t\trecplay(key);\n\t};\n\t\n\tif(name==\"nmn5\"){ //合成一个5分钟的wav\n\t\tif(window.nmn5Url){\n\t\t\turl=window.nmn5Url; return run();\n\t\t}\n\t\tvar sr=16000;\n\t\tvar pcm=Recorder.NMN2PCM.GetExamples().Canon.get(sr).pcm;\n\t\tvar pcm5=new Int16Array(5*60*sr),n=0;\n\t\twhile(n<pcm5.length){\n\t\t\tvar s=Math.min(pcm.length, pcm5.length-n);\n\t\t\tpcm5.set(s==pcm.length?pcm:pcm.subarray(0,s),n); n+=pcm.length\n\t\t}\n\t\trun(Html_$T(\"EmcW::正在合成wav...\"));\n\t\tvar mock=Recorder({ type:\"wav\",sampleRate:sr,bitRate:16 });\n\t\tmock.mock(pcm5, sr);\n\t\tmock.stop(function(blob){\n\t\t\turl=window.nmn5Url=(window.URL||webkitURL).createObjectURL(blob);\n\t\t\trun();\n\t\t},function(err){\n\t\t\trun(\"\",err);\n\t\t});\n\t}else{ //播放音频文件\n\t\trun();\n\t}\n};\nfunction recPlayLast(){\n\tif(!recLogLast){\n\t\treclog(Html_$T(\"zGph::请先录音，然后停止后再播放\"),1);\n\t\treturn;\n\t};\n\trecplay(recLogLast.key);\n};\nfunction recUploadLast(){\n\tif(!recLogLast){\n\t\treclog(Html_$T(\"8e05::请先录音，然后停止后再上传\"),1);\n\t\treturn;\n\t};\n\tvar blob=recLogLast.blob;\n\t\n\t//本例子假设使用原始XMLHttpRequest请求方式，实际使用中自行调整为自己的请求方式\n\t//录音结束时拿到了blob文件对象，可以用FileReader读取出内容，或者用FormData上传\n\tvar api=\"http://127.0.0.1:9528\";\n\tvar onreadystatechange=function(xhr,title){\n\t\treturn function(){\n\t\t\tif(xhr.readyState==4){\n\t\t\t\tif(xhr.status==200){\n\t\t\t\t\treclog(title+Html_$T(\"2C4x::上传成功\")+' <span style=\"color:#999\">response: '+xhr.responseText+'</span>',2);\n\t\t\t\t}else{\n\t\t\t\t\treclog(title+Html_$T(\"k6Kb::没有完成上传，演示上传地址无需关注上传结果，只要浏览器控制台内Network面板内看到的请求数据结构是预期的就ok了。\"), \"#d8c1a0\");\n\t\t\t\t\t\n\t\t\t\t\tconsole.error(Html_xT(title+Html_$T(\"ReX6::上传失败\")),xhr.status,xhr.responseText);\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t};\n\treclog(Html_$T(\"LzIA::开始上传到{1}，请稍候... （你可以先到源码 /assets/node-localServer 目录内执行 npm run start 来运行本地测试服务器）\",0,api));\n\n\t/***方式一：将blob文件转成base64纯文本编码，使用普通application/x-www-form-urlencoded表单上传***/\n\tvar reader=new FileReader();\n\treader.onloadend=function(){\n\t\tvar postData=\"\";\n\t\tpostData+=\"mime=\"+encodeURIComponent(blob.type);//告诉后端，这个录音是什么格式的，可能前后端都固定的mp3可以不用写\n\t\tpostData+=\"&upfile_b64=\"+encodeURIComponent((/.+;\\s*base64\\s*,\\s*(.+)$/i.exec(reader.result)||[])[1]) //录音文件内容，后端进行base64解码成二进制\n\t\t//...其他表单参数\n\t\t\n\t\tvar xhr=new XMLHttpRequest();\n\t\txhr.open(\"POST\", api+\"/uploadBase64\");\n\t\txhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\n\t\txhr.onreadystatechange=onreadystatechange(xhr,Html_$T(\"SsdM::上传方式一【Base64】\"));\n\t\txhr.send(postData);\n\t};\n\treader.readAsDataURL(blob);\n\n\t/***方式二：使用FormData用multipart/form-data表单上传文件***/\n\tvar form=new FormData();\n\tform.append(\"upfile\",blob,\"recorder.mp3\"); //和普通form表单并无二致，后端接收到upfile参数的文件，文件名为recorder.mp3\n\t//...其他表单参数\n\t\n\tvar xhr=new XMLHttpRequest();\n\txhr.open(\"POST\", api+\"/upload\");\n\txhr.onreadystatechange=onreadystatechange(xhr,Html_$T(\"Oy4A::上传方式二【FormData】\"));\n\txhr.send(form);\n};\nfunction recDownLast(){\n\tif(!recLogLast){\n\t\treclog(Html_$T(\"D3Vn::请先录音，然后停止后再下载\"),1);\n\t\treturn;\n\t};\n\trecdown(recLogLast.key);\n};\nfunction recdown(key){\n\tvar o=recblob[key];\n\tif(o){\n\t\tvar cls=RandomKey(16);\n\t\tvar name=\"rec-\"+o.time+\"ms-\"+o.set.bitRate+\"kbps-\"+o.set.sampleRate+\"hz.\"+o.set.type;\n\t\t\n\t\to.down=(o.down||0)+1;\n\t\t$(\".d\"+key).html('<span style=\"color:red\">'+o.down+'</span> '\n\t\t\t+Html_$T('T6XS::点击{1}',0,\"\")+' <span class=\"'+cls+'\"> '\n\t\t\t+Html_$T('o5j6::下载，或复制文本')\n\t\t\t+'<button onclick=\"recdown64(\\''+key+'\\',\\''+cls+'\\')\">'+Html_$T('IdYf::生成Base64文本')+'</button></span>');\n\t\t\n\t\tvar downA=document.createElement(\"A\");\n\t\tdownA.innerHTML=Html_$T(\"mB6v::下载 \")+name;\n\t\tdownA.href=(window.URL||webkitURL).createObjectURL(o.blob);\n\t\tdownA.download=name;\n\t\t$(\".\"+cls).prepend(downA);\n\t\tif(/mobile/i.test(navigator.userAgent)){\n\t\t\talert(Html_xT(Html_$T(\"0RBw::因移动端绝大部分国产浏览器未适配Blob Url的下载，所以本demo代码在移动端未调用downA.click()。请尝试点击日志中显示的下载链接下载，无法下载就复制Base64\")));\n\t\t}else{\n\t\t\tdownA.click();\n\t\t}\n\t};\n};\nfunction recdown64(key, cls){\n\tvar o=recblob[key];\n\t\n\tvar reader = new FileReader();\n\treader.onloadend = function() {\n\t\tvar id=RandomKey(16);\n\t\t$(\".\"+cls).append('<textarea class=\"'+id+'\"></textarea>');\n\t\t$(\".\"+id).val(reader.result);\n\t};\n\treader.readAsDataURL(o.blob);\n};\nvar ReadBlob=function(blob,call){\n\tvar reader = new FileReader();\n\treader.onloadend = function(e){\n\t\tcall(reader.result);\n\t};\n\treader.readAsArrayBuffer(blob);\n};\nvar DecodeAudio=function(fileName,arrayBuffer,True,False){\n\tTrue=True||function(){};\n\tFalse=False||function(){};\n\tif(!Recorder.GetContext()){//强制激活Recorder.Ctx 不支持大概率也不支持解码\n\t\tFalse(Html_$T(\"b6jA::浏览器不支持音频解码\"));\n\t\treturn;\n\t};\n\tvar type=(/[^.]+$/.exec(fileName)||[])[0]||\"\";\n\tvar srcBlob=new Blob([arrayBuffer],{type:type&&(\"audio/\"+type)||\"\"});\n\t\n\tvar ctx=Recorder.Ctx;\n\tctx.decodeAudioData(arrayBuffer,function(raw){\n\t\tvar src=raw.getChannelData(0);\n\t\tvar sampleRate=raw.sampleRate;\n\t\tconsole.log(fileName,raw,srcBlob);\n\t\t\n\t\tvar pcm=new Int16Array(src.length);\n\t\tfor(var i=0;i<src.length;i++){//floatTo16BitPCM \n\t\t\tvar s=Math.max(-1,Math.min(1,src[i]));\n\t\t\ts=s<0?s*0x8000:s*0x7FFF;\n\t\t\tpcm[i]=s;\n\t\t};\n\t\t\n\t\tTrue({\n\t\t\tsampleRate:sampleRate\n\t\t\t,duration:Math.round(src.length/sampleRate*1000)\n\t\t\t,srcBlob:srcBlob\n\t\t\t,type:type\n\t\t\t,data:pcm\n\t\t});\n\t},function(e){\n\t\tconsole.error(\"DecodeAudio error\",e);\n\t\tFalse(Html_$T(\"Ks7F::{1}解码失败:\",0,fileName)+(e&&e.message||\"-\"));\n\t});\n};\n\n\n\nvar s=\"https://github.com/xiangyuecn/Recorder/blob/master/src/extensions/\";\nvar getExtensionsInfo=function(){ return {\n\tWaveView:'<b>WaveView</b> (<a href=\"'+s+'waveview.js\">waveview.js</a> '+Html_$T(\"PAx1::动态波形\")+')'\n\t,SurferView:'<b>WaveSurferView</b> (<a href=\"'+s+'wavesurfer.view.js\">wavesurfer.view.js</a> '+Html_$T(\"xatF::音频可视化波形\")+')'\n\t,Histogram:'<b>FrequencyHistogramView</b> (<a href=\"'+s+'frequency.histogram.view.js\">frequency.histogram.view.js</a> + <a href=\"'+s+'lib.fft.js\">lib.fft.js</a> '+Html_$T(\"hKcX::音频可视化频率直方图\")+')'\n\t,Sonic:'<b>Sonic</b> (<a href=\"'+s+'sonic.js\">sonic.js</a> '+Html_$T(\"sqeb::变速变调\")+')'\n\t,DTMF:'<b>DTMF</b> (<a href=\"'+s+'dtmf.decode.js\">dtmf.decode.js</a> + <a href=\"'+s+'dtmf.encode.js\">dtmf.encode.js</a> '+Html_$T(\"xnKw::（电话拨号按键信号）解码、编码\")+')'\n}};\nvar recwaveChoiceKey=localStorage[\"RecWaveChoiceKey\"]||\"WaveView\";\n$(\".recwaveChoice\").bind(\"click\",function(e){\n\tvar elem=$(e.target);\n\t$(\".recwaveChoice\").removeClass(\"slc\");\n\tvar val=elem.addClass(\"slc\").attr(\"key\");\n\tvar info=getExtensionsInfo()[val.replace(/\\d+$/,\"\")];\n\tif(recwaveChoiceKey!=val){\n\t\treclog(Html_$T(\"tIR3::已切换波形显示为：\")+info);\n\t};\n\trecwaveChoiceKey=val;\n\tlocalStorage[\"RecWaveChoiceKey\"]=recwaveChoiceKey;\n});\nif(!$(\".recwaveChoice[key=\"+recwaveChoiceKey+\"]\").length){\n\trecwaveChoiceKey=\"WaveView\";\n};\n$(\".recwaveChoice[key=\"+recwaveChoiceKey+\"]\").click();\n\nvar initWaveStore=function(store,elem){\n\tstore.WaveView=Recorder.WaveView({elem:elem});\n\tstore.SurferView=Recorder.WaveSurferView({elem:elem});\n\tstore.Histogram1=Recorder.FrequencyHistogramView({elem:elem});\n\tstore.Histogram2=Recorder.FrequencyHistogramView({\n\t\telem:elem\n\t\t,lineCount:200,widthRatio:1\n\t\t,position:0\n\t\t,minHeight:1\n\t\t,fallDuration:600\n\t\t,stripeEnable:false\n\t\t,mirrorEnable:true\n\t});\n\tstore.Histogram3=Recorder.FrequencyHistogramView({\n\t\telem:elem\n\t\t,lineCount:20\n\t\t,position:0\n\t\t,minHeight:1\n\t\t,fallDuration:400\n\t\t,stripeEnable:false\n\t\t,mirrorEnable:true\n\t\t,linear:[0,\"#0ac\",1,\"#0ac\"]\n\t});\n};\n\n\nif(window.isSecureContext===false){\n\treclog(Html_$T(\"LLe9::当前网页不是安全环境（HTTPS），将无法获取录音权限，\")+\"<a href='https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Privacy_and_security'>MDN Privacy and security</a>\",1);\n}else if(window.isSecureContext){\n\treclog(\"<span style='color:#0b1'>\"+Html_$T(\"atIl::当前网页处在安全环境中\")+\"</span>(<a href='https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Privacy_and_security'>\"+Html_$T(\"u4vS::https、file:///等\")+\"</a>)\");\n};\n\nreclog(Html_$T(\"ntrR::点击打开录音开始哦，此浏览器{1}\",0,\"\")\n\t+\"<span style='color:\"+(Recorder.Support()?\"green\":\"red\")+\"'>\"\n\t+(Recorder.Support()?Html_$T(\"3bjv::支持录音\"):Html_$T(\"HhOY::不支持录音\"))+\"</span>\");\nvar dh=Html_$T('jE1H::、'),extensionsInfo=getExtensionsInfo();\nreclog(Html_$T('yBBq::已启用Extensions：')\n\t+extensionsInfo.WaveView\n\t+dh+extensionsInfo.SurferView\n\t+dh+extensionsInfo.Histogram\n\t+dh+extensionsInfo.Sonic\n\t+dh+extensionsInfo.DTMF);\n\n\n\nvar workletTips=Html_$T('f6Zn::注意：由于AudioWorklet内部')\n\t+'<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/AudioWorkletProcessor/process\" target=\"_blank\">'+Html_$T('KVKy::1秒会产生375次回调')+'</a>'\n\t+Html_$T('rLVJ::，在移动端可能会有性能问题导致浏览器回调丢失，进而导致录音数据、时长变短，PC端似乎无此影响，可通过定时1分钟录音来检测影响（如果短了1秒以上即为有问题）；在无明显优势好处的前提下，暂不建议启用。');\n$(\".workletSetTips\").html(workletTips);\n$(\".enableWorkletSet\").bind(\"change\",function(){\n\tlocalStorage[\"RecEnableWorklet\"]=this.checked?\"1\":\"\";\n})[0].checked=localStorage[\"RecEnableWorklet\"]==\"1\";\n\n$(\".enableWebMSet\").bind(\"change\",function(){\n\tlocalStorage[\"RecEnableWebM\"]=this.checked?\"1\":\"-1\";\n})[0].checked=localStorage[\"RecEnableWebM\"]!=\"-1\";\n\n//页面滚动到这个位置\nvar scrollToEl=function(elem){\n\t$(\"html,body\").animate({scrollTop:$(elem).offset().top-200},300);\n};\n\n\n\n$(\".recinfoCode\").html($(\".recinfoCodeTxt\").val().replace(/\\$\\{(.+?)\\}|\\{\\{([\\S\\s]+?)\\}\\}/g,function(a,b,c){return eval(b||c)}));\n\t\n\t\nfunction goiframe(){\n\tlocation.href=\"assets/ztest_iframe.html#iframeUrl=/index.html\";\n};\nif(window.top!=window){\n\tvar isSelf=false;\n\ttry{\n\t\twindow.top.aa=123;\n\t\tisSelf=true;\n\t}catch(e){};\n\t\n\treclog(\"<span style='color:#f60'>\"+Html_$T(\"bOsV::当前页面处在在iframe中，但故意未进行任何处理，\")+(isSelf?Html_$T(\"0rFB::当前是同域\"):Html_$T(\"aJ0a::并且已发生跨域，未设置相应策略权限永远是拒绝的\"))+\"</span>\");\n};\n\n\n//暴力测试：同时打开5个录音，定时录5秒\nvar testMultipleOpen5=function(){\n\tif(rec)rec.close();\n\tfor(var i=0;i<5;i++){(function(i){\n\t\tvar rec=Recorder({type:\"mp3\"\n\t\t\t,onProcess:function(buffers,powerLevel,duration,sampleRate,newBufferIdx,asyncEnd){\n\t\t\t\tRecorder.CLog(i+1,0,duration,buffers.length,newBufferIdx);\n\t\t\t}\n\t\t});\n\t\trec.open(function(){\n\t\t\trec.start();\n\t\t\tsetTimeout(function(){\n\t\t\t\tvar t1=Date.now();\n\t\t\t\trec.stop(function(blob,duration){\n\t\t\t\t\taddRecLog(duration, Html_$T(\"NEZT::第{1}个\",0,i+1),blob,rec.set,t1);\n\t\t\t\t},null,true);\n\t\t\t},5000);\n\t\t});\n\t})(i)}\n};\n\n\n//注入小时的录音数据\nvar testInject24HourPcmStore={sid:0};\nvar testInject24HourPcmClick=function(){\n\tvar H=+$(\".testInject24HourPcm_h\").val();\n\tif(!H){ reclog(\"hour?\",1);return; }\n\tif(!rec || !rec.state){ reclog(Html_$T(\"wHHR::需开始录音\"),1);return; }\n\tif(!rec.set.takeoffEncodeChunk){ reclog(Html_$T(\"0GX4::需勾选takeoffEncodeChunk\"),1);return; }\n\t\n\tvar store=testInject24HourPcmStore;\n\tvar sid=++store.sid;\n\tvar startTime=Date.now(),lastTime=0,minute=0,pcmSize=0,takeSize=0,takeIdx=0;\n\t\n\tvar cls=RandomKey(16);\n\treclog('<span class=\"'+cls+'\">Run...</span>');\n\tvar update=function(){\n\t\tvar tag='<span style=\"color:'+(minute>H*60?'#0b1\">OK':'#f60\">Run...')+'</span> ';\n\t\tvar t=formatMs(Date.now()-startTime,1);\n\t\t$(\".\"+cls).html(tag+Html_$T(\"Emz4::已注入{1}小时{2}分钟数据，输入pcm: {3} MB，输出音频: {4} MB（已清除不占用内存）。设置共注入{5}小时数据，注入耗时：{6}\",0,~~(minute/60),minute%60,(pcmSize/1024/1024).toFixed(2),(takeSize/1024/1024).toFixed(2),H,t));\n\t};\n\tupdate();\n\t\n\twindow.testInject24HourPcmOnProc=function(buffers,sampleRate){\n\t\tif(sid!=store.sid)return;\n\t\tfor(var i=buffers.length-2;i>=0;i--){\n\t\t\tif(!buffers[i]) break;\n\t\t\tbuffers[i]=null;//清除缓冲数据\n\t\t}\n\t};\n\twindow.testInject24HourPcmOnTake=function(bytes){\n\t\tif(sid!=store.sid)return;\n\t\ttakeSize+=bytes.byteLength;\n\t\tif(lastTime && bytes.byteLength<50000)return; //1分钟数据>50kb，排除掉实时录音数据\n\t\tlastTime=Date.now();\n\t\t//清除注入的音频结果\n\t\tfor(;takeIdx<takeoffChunks.length;takeIdx++){\n\t\t\tif(takeoffChunks[takeIdx].byteLength>50000){\n\t\t\t\ttakeoffChunks[takeIdx]=new Uint8Array(0);\n\t\t\t}\n\t\t}\n\t\t//已达到时间\n\t\tif(minute>H*60) { update(); return;}\n\t\t//延迟一下，注入1分钟数据进行编码\n\t\tsetTimeout(function(){\n\t\t\tvar pcm=new Int16Array(rec.srcSampleRate*60);\n\t\t\tpcmSize+=pcm.byteLength;\n\t\t\tminute++;\n\t\t\trec.envIn(pcm,0);\n\t\t\tupdate();\n\t\t},10);\n\t};\n};\n\n\n//阻止手机自动锁屏\nvar wakeLockClick=function(){\n\tvar fail=function(){\n\t\tvideoTestPlay(' loop muted');\n\t\treclog(Html_$T('K0Jo::已通过 循环+静音 播放视频来阻止自动锁屏'));\n\t\tscrollToEl(\".videoTest\");\n\t};\n\tif(navigator.wakeLock){\n\t\tif(window.wakeLockObj)wakeLockObj.release();\n\t\tnavigator.wakeLock.request('screen').then(function(lock){\n\t\t\twakeLockObj=lock;\n\t\t\treclog(Html_$T('RGYV::已通过wakeLock阻止自动锁屏')+' <button onclick=\"wakeUnLockClick(this)\">'+Html_$T('zCjJ::恢复锁屏')+'</button>');\n\t\t\twindow.wakeUnLockClick=function(btn){\n\t\t\t\tlock.release().then(function(){\n\t\t\t\t\twakeLockObj=null; $(btn).remove();\n\t\t\t\t\treclog(Html_$T(\"tMgx::已恢复自动锁屏\"));\n\t\t\t\t});\n\t\t\t};\n\t\t\tscrollToEl(\".reclog\");\n\t\t})['catch'](function(e){\n\t\t\tconsole.error(Html_xT(Html_$T(\"KCZr::wakeLock错误：\"))+e.message);\n\t\t\tfail();\n\t\t});\n\t}else{\n\t\tfail();\n\t}\n};\n\n\n//实时传输数据模拟开关\n$(\".realTimeSendSet\").bind(\"change\",function(e){\n\tvar open=e.target.checked;\n\t$(\".realTimeSendView\")[open?\"show\":\"hide\"]();\n\tif(open && !window.webrtcCreate){\n\t\tvar files=[\"assets/zdemo.index.realtime_voice.js\",\"assets/zdemo.index.webrtc.js\"];\n\t\treclog(Html_$T(\"33ji::正在加载{1} ...\",0,JSON.stringify(files)));\n\t\t\n\t\tloadJsList(files);\n\t};\n});\n\n//ASR开关，实时语音识别、音频文件转文字\n$(\".asrSet\").bind(\"change\",function(e){\n\tvar open=e.target.checked;\n\t$(\".asrView\")[open?\"show\":\"hide\"]();\n\tif(open && !window.asrInput){\n\t\tvar file=\"assets/zdemo.index.asr.js\";\n\t\treclog(Html_$T(\"7bbv::正在加载{1} ...\",0,file));\n\t\t\n\t\tloadJsList([file]);\n\t};\n});\n\n\n\n//变速变调\nvar sonicCtrlSet={};\n$(\".sonicCtrlInput\").bind(\"change\",function(e){\n\tsonicCtrlSet[/sonicCtrl([^ ]+)$/.exec(e.target.className)[1].toLowerCase()]=+e.target.value;\n});\n$(\".sonicCtrlRange\").bind(\"change\",function(e){\n\t$(e.target).parent().find(\".sonicCtrlInput\").val(/\\d+\\.\\d+/.exec(e.target.value+\".0\")[0]).change();\n}).change();\nvar resetSonicCtrl=function(){\n\t$(\".sonicCtrlRange\").val(1).change();\n\t$(\".sonicCtrlBufferRange\").val(200).change();\n};\nvar sonicCtrlBoxMaskClose=function(){\n\t$(\".sonicCtrlBoxMask\").hide();\n};\nif(!/mobile/i.test(navigator.userAgent)){\n\tsonicCtrlBoxMaskClose();\n};\nvar sonicRecTransform=function(){\n\tif(!rec||!rec.buffers){\n\t\treclog(Html_$T(\"AYTX::请先录音\"),1);\n\t\treturn;\n\t};\n\tvar type=rec.set.type;\n\tvar sampleRate=rec.set.sampleRate;\n\tvar bitRate=rec.set.bitRate;\n\tif(type!=\"mp3\"){\n\t\treclog(Html_$T(\"FXjK::目前只支持mp3格式的录音重新转换，因为其他格式buffers可能已被污染转换过\"),1);\n\t\treturn;\n\t};\n\t\n\tsonicAsync&&sonicAsync.flush();\n\tsonicAsync=null;\n\t\n\tvar srcBuffers=rec.buffers;\n\tvar buffers=[];\n\tvar idx=-1,logScope={};\n\tvar run=function(){\n\t\tidx++;\n\t\tif(idx>=srcBuffers.length){\n\t\t\tvar mockRec=Recorder({type:type,sampleRate:sampleRate,bitRate:bitRate});\n\t\t\tmockRec.mock(Recorder.SampleData(buffers,sampleRate,sampleRate).data,sampleRate);\n\t\t\trecstopFn(null,0,function(){\n\t\t\t\treturn Html_$T(\"dtC1::已转换\");\n\t\t\t},mockRec);\n\t\t\treturn;\n\t\t};\n\t\t\n\t\tbuffers.push(Recorder.SampleData([srcBuffers[idx]],rec.srcSampleRate,sampleRate).data);\n\t\tvar beginAsync=sonicProcess(logScope,buffers,sampleRate,idx,run);\n\t\tif(!beginAsync){\n\t\t\treclog(Html_$T(\"Hdpx::不存在变速变调设置，或不能开启转换\"),1);\n\t\t};\n\t\tbuffers[idx]=new Int16Array(0);\n\t};\n\trun();\n};\nvar sonicInfo;\nvar sonicProcess=function(logScope,buffers,sampleRate,newBufferIdx,asyncEnd){\n\tif(sonicCtrlSet.pitch==1\n\t\t&&sonicCtrlSet.rate==1\n\t\t&&sonicCtrlSet.speed==1\n\t\t&&sonicCtrlSet.volume==1){//不存在变速变调设置\n\t\tif(logScope.sonicTips){\n\t\t\tlogScope.sonicTips=\"\";\n\t\t\treclog(Html_$T(\"AkRn::已停用变速变调\"),\"#aaa\");\n\t\t}\n\t\treturn;\n\t};\n\t\n\tif(sonicAsync==-1){\n\t\treturn;\n\t};\n\tif(!sonicAsync||sonicAsync.set.sampleRate!=sampleRate){\n\t\t//实时处理只能用异步操作，不能用同步方法，否则必然卡顿\n\t\tsonicAsync=Recorder.Sonic.Async({sampleRate:sampleRate});\n\t\tsonicInfo={};\n\t\tif(!sonicAsync){\n\t\t\tsonicAsync=-1;\n\t\t\treclog(Html_$T(\"fUYK::不能开启Sonic.Async，浏览器不支持WebWorker操作，降级不变速变调\"),1);\n\t\t\treturn;\n\t\t};\n\t};\n\t\n\tvar sonicTips=\"Pitch=\"+sonicCtrlSet.pitch\n\t\t+\", Speed=\"+sonicCtrlSet.speed\n\t\t+\", Rate=\"+sonicCtrlSet.rate\n\t\t+\", Volume=\"+sonicCtrlSet.volume;\n\tif(logScope.sonicTips!=sonicTips){\n\t\treclog((logScope.sonicTips?Html_$T(\"OYzl::已修改变速变调：\"):Html_$T(\"fqDa::已开启变速变调：\"))+sonicTips,\"#aaa\");\n\t\tlogScope.sonicTips=sonicTips;\n\t};\n\t\n\tsonicAsync.setPitch(sonicCtrlSet.pitch);\n\tsonicAsync.setRate(sonicCtrlSet.rate);\n\tsonicAsync.setSpeed(sonicCtrlSet.speed);\n\tsonicAsync.setVolume(sonicCtrlSet.volume);\n\t\n\tvar newBuffers=sonicInfo.buffers||[];\n\tvar newBufferSize=sonicInfo.bufferSize||0;\n\tvar blockSize=sampleRate/1000*sonicCtrlSet.buffer;//缓冲0-1000ms的数据进行处理，200ms以上可避免引入大量杂音\n\tvar lastIdx=buffers.length-1;\n\tfor(var i=newBufferIdx;i<=lastIdx;i++){\n\t\tnewBuffers.push(buffers[i]);//copy出来，异步onProcess会清空这些数组\n\t\tnewBufferSize+=buffers[i].length;\n\t};\n\t\n\tif(newBufferSize<blockSize){\n\t\tsetTimeout(function(){\n\t\t\tasyncEnd();//缓冲未满，此时并未处理，但也需要进行异步回调\n\t\t});\n\t}else{\n\t\tvar buffer=newBuffers[0]||[];\n\t\tif(newBuffers.length>1){\n\t\t\tbuffer=Recorder.SampleData(newBuffers,sampleRate,sampleRate).data;\n\t\t};\n\t\tnewBuffers=[];\n\t\tnewBufferSize=0;\n\t\tvar sizeOld=buffer.length,sizeNew=0;\n\t\t\n\t\t//推入后台异步转换\n\t\tsonicAsync.input(buffer,function(pcm){\n\t\t\tbuffers[lastIdx]=pcm;//写回buffers，放到调用时的最后一个位置即可 ，其他内容已在开启异步模式时已经被自动替换成了空数组\n\t\t\t\n\t\t\t//实时播放反馈\n\t\t\tif(sonicCtrlSet.play&&window.DemoFragment&&DemoFragment.PlayBuffer){\n\t\t\t\ttry{\n\t\t\t\t\tDemoFragment.PlayBuffer(sonicInfo,pcm,sampleRate);\n\t\t\t\t}catch(e){//在古董浏览器里面可能会开启播放失败\n\t\t\t\t\tconsole.error(Html_xT(Html_$T(\"Xxw4::sonic -> DemoFragment.PlayBuffer错误，无法实时播放反馈\")),e);\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tasyncEnd();//完成处理必须进行回调\n\t\t});\n\t};\n\t\n\tsonicInfo.buffers=newBuffers;\n\tsonicInfo.bufferSize=newBufferSize;\n\t\n\treturn true;\n};\n\n\n\n\n\n/****DTMF电话按键信号****/\nvar decodeDTMF=function(){\n\tif(!recLogLast){\n\t\treclog(Html_$T(\"i4N2::请先录音\"),1);\n\t\treturn;\n\t};\n\t\n\treclog(Html_$T(\"B3NQ::开始识别DTMF...\"),2);\n\tReadBlob(recLogLast.blob,function(arr){\n\t\tDecodeAudio(\"rec.\"+recLogLast.set.type,arr,function(data){\n\t\t\tvar finds=[];\n\t\t\tvar chunk=Recorder.DTMF_Decode(data.data,data.sampleRate);\n\t\t\tfor(var i=0;i<chunk.keys.length;i++){\n\t\t\t\treclog(Html_$T(\"FJZq::发现按键[{1}]，位于{2}ms处\",0,chunk.keys[i].key,chunk.keys[i].time));\n\t\t\t\tfinds.push(chunk.keys[i].key);\n\t\t\t};\n\t\t\treclog((finds.length?Html_$T(\"dYNC::识别完毕，发现按键：\")+finds.join(\"\"):Html_$T(\"Mb8l::识别完毕，未发现按键信息\")),2);\n\t\t},function(err){\n\t\t\treclog(err,2);\n\t\t});\n\t});\n};\nvar decodeDTMFStream=function(pcm,sampleRate,chunk){\n\tchunk=Recorder.DTMF_Decode(pcm,sampleRate,chunk);\n\tfor(var i=0;i<chunk.keys.length;i++){\n\t\treclog(Html_$T(\"NvUF::发现按键[{1}]，位于{2}ms处\",0,chunk.keys[i].key,chunk.keys[i].time));\n\t};\n\treturn chunk;\n};\nvar sendDTMFKeyClick=function(e){\n\tif(e.target.tagName==\"TD\"){\n\t\tsendDTMFKeys(e.target.innerHTML)\n\t};\n};\nvar sendDTMFKeysClick=function(){\n\tsendDTMFKeys(\"*#1234567890#*\");\n};\nvar sendDTMFKeys=function(keys){\n\tif(!dtmfMix){\n\t\tdtmfMix=Recorder.DTMF_EncodeMix({\n\t\t\tduration:100 //按键信号持续时间 ms，最小值为30ms\n\t\t\t,mute:25 //按键音前后静音时长 ms，取值为0也是可以的\n\t\t\t,interval:200 //两次按键信号间隔时长 ms，间隔内包含了duration+mute*2，最小值为120ms\n\t\t});\n\t};\n\tif(!rec||!rec.buffers){\n\t\treclog(Html_$T(\"V5cg::没有开始录音，按键会存储到下次录音\"),\"#bbb\");\n\t};\n\tdtmfMix.add(keys);\n\t//添加过去就不用管了，实时处理时会调用mix方法混入到pcm中。\n};\nvar dtmfMix;\n</script>\n\n\n\n</div><!-- demoMain end -->\n\n\n\n\n\n<script>\nif(/mobile/i.test(navigator.userAgent)){\n\t//移动端加载控制台组件\n\tvar elem=document.createElement(\"script\");\n\telem.setAttribute(\"type\",\"text/javascript\");\n\telem.setAttribute(\"src\",\"assets/ztest-vconsole.js\");\n\tdocument.body.appendChild(elem);\n\telem.onload=function(){\n\t\tnew VConsole();\n\t};\n};\n</script>\n<div style=\"padding:100px;\"></div>\n<!-- end 结束copy源码 -->\n\n\n\n\n\n\n<script>\n(function(){\n\tvar i=0,arr=[],html=[];\n\tfor(var k in TypeEngineImports){ i++;\n\t\tvar o=TypeEngineImports[k]; o.sort=o.sort||i; o.type=k; arr.push(o);\n\t}\n\tarr.sort(function(a,b){return a.sort-b.sort});\n\tfor(var i=0;i<arr.length;i++){\n\t\tvar o=arr[i];\n\t\thtml.push('<label><input type=\"radio\" name=\"type\" value=\"'+o.type+'\">'+(o.name||o.type)+'</label>');\n\t}\n\t\n\tvar prev;\n\t$(\".types\").html(html.join(\" \")).bind(\"click\",function(e){\n\t\tvar input=$(e.target);\n\t\tif(input[0].nodeName==\"LABEL\"){\n\t\t\tinput=$(input).find(\"input\");\n\t\t};\n\t\tinput=input[0]; if(!input || input.nodeName!=\"INPUT\")return;\n\t\tvar minjs=$(\".loadMinJs\")[0].checked;\n\t\tif(prev!=input||prev.minjs!==minjs){\n\t\t\tprev=input;\n\t\t\tprev.minjs=minjs;\n\t\t\tsetTimeout(function(){\n\t\t\t\tloadEngine(input.value,1);\n\t\t\t});\n\t\t};\n\t});\n})();\nfunction loadEngine(type,isClick){\n\tvar eImport=TypeEngineImports[type];\n\tif(!eImport)return;\n\t\n\tvar srcs=[],mins=[],minsTxt=[],adds=[];\n\tfor(var i=1,a=0;i<eImport.src.length;i++){\n\t\tvar v=eImport.src[i];\n\t\tif(v===0){ a=1; continue; }\n\t\tif(a)adds.push(v);\n\t\telse srcs.push(v);\n\t};\n\tfor(var i=0;i<eImport.dist.length;i++){\n\t\tvar v=eImport.dist[i];\n\t\tif(v===0)break;\n\t\tif(/recorder-core\\.js/.test(v)){\n\t\t\tv={url:v,check:function(){return !window.Recorder}};\n\t\t}\n\t\tmins.push(v); minsTxt.push(v.url||v);\n\t};\n\t\n\tvar minjs=$(\".loadMinJs\")[0].checked;\n\tvar engines=[].concat(minjs?mins:srcs, adds||[]);\n\tvar end=function(){\n\t\tvar enc=Recorder.prototype[\"enc_\"+type];\n\t\tvar tips=[];\n\t\tif(!enc){\n\t\t\ttips.push(Html_$T(\"X1tM::这个编码器无提示信息\"));\n\t\t}else{\n\t\t\tif(enc.stable){\n\t\t\t\ttips.push(Html_$T(\"N5Ed::{1}编码器稳定版，\",0,type));\n\t\t\t}else{\n\t\t\t\ttips.push(Html_$T(\"aQBD::{1}编码器beta版，\",0,type));\n\t\t\t};\n\t\t\ttips.push(\"<span style='color:\");\n\t\t\tvar fastMsg=enc.fast?Html_$T(\"O9Zr::{1}转码超快\",0,type):\"\";\n\t\t\tif(Recorder.prototype[type+\"_start\"]){\n\t\t\t\ttips.push(\"#0b1'>\"+(fastMsg?fastMsg+\" + \":\"\")+Html_$T(\"Ucx3::支持边录边转码(Worker)\"));\n\t\t\t}else if(fastMsg){\n\t\t\t\ttips.push(\"#0b1'>\"+fastMsg);\n\t\t\t}else{\n\t\t\t\ttips.push(\"red'>\"+Html_$T(\"YJPi::仅支持标准UI线程转码\"));\n\t\t\t};\n\t\t\tHtml_$CallT(function(){\n\t\t\t\ttips.push(\"</span>, \"+(enc.getTestMsg&&enc.getTestMsg()||enc.testmsg));\n\t\t\t});\n\t\t}\n\t\ttips.push('<div style=\"color:green;padding-left:50px\">');\n\t\ttips.push(Html_$T(\"DFs2::使用{1}录音需要加载的js：\",0,type));\n\t\ttips.push(\"<br>\"+Html_$T(\"YThG::【压缩版】：\")+minsTxt.join(\", \"))\n\t\ttips.push(\"<br>\"+Html_$T(\"EYBu::【源文件】：\")+\"src/recorder-core.js, \"+srcs.join(\", \"));\n\t\ttips.push(\"</div>\");\n\t\t\n\t\t$(\".typeTips\").html(tips.join(\"\"));\n\t\t\n\t\tresetPageTitle();\n\t\tif(isClick){\n\t\t\tkeepTypeInHash(type,minjs);\n\t\t}\n\t\treclog(\"<span style='color:#0b1'>\"+typeTips()+Html_$T(\"seoC::{1}已加载，可以录音了\",0,\"\")+\"</span>\");\n\t};\n\t$(\".typeTips\").html(type+\" engine loading...\");\n\tvar typeTips=function(){\n\t\treturn minjs?Html_$T(\"5czG::{1}编码器压缩版\",0,type):Html_$T(\"6Cyh::{1}编码器源码版\",0,type);\n\t};\n\tif(!Recorder.prototype[type] || loadEngineState[type]!==minjs){\n\t\treclog(\"<span style='color:#f60'>\"+Html_$T(\"JT36::正在加载{1}\",0,\"\")+typeTips()+Html_$T(\"KvWE::，请勿操作...\")+\"</span>\");\n\t\tloadJsList(engines,function(){\n\t\t\tloadEngineState[type]=minjs;\n\t\t\t\n\t\t\tend();\n\t\t},function(err){\n\t\t\t$(\".typeTips\").html('<span style=\"color:red\">'+type+\" engine loading error: \"+err+'</span>');\n\t\t\treclog(err,1);\n\t\t});\n\t}else{\n\t\tend();\n\t};\n};\nloadEngineState={};\n\nvar keepTypeInHash=function(type,minJs){\n\tvar o={type:type};if(minJs)o.minJs=1;\n\tvar hash=(location.hash||\"#\").replace(/(#?)&?recImport=([^&]*)/g,\"$1\");\n\tif(type!=\"mp3\"){\n\t\thash+=(hash==\"#\"?\"\":\"&\")+\"recImport=\";\n\t\thash+=encodeURIComponent(JSON.stringify(o));\n\t}\n\tif(history.replaceState){\n\t\thistory.replaceState(null, \"\", hash);\n\t}else{\n\t\tlocation.hash=hash;\n\t}\n};\nvar resetPageTitle=function(){\n\tvar type=$(\"[name=type]:checked\").val();\n\tvar title=document.title.replace(/^\\[\\w+\\]/g,\"\");\n\tif(type!=\"mp3\")title=\"[\"+type.toUpperCase()+\"]\"+title;\n\tdocument.title=title;\n};\n\nvar loadJsList=function(jsList,True,False,allCheck){//False -> false继续加载，allCheck(urlItem)允许修改url值\n\tvar rootUrl=\"\";\n\tvar load=function(idx){\n\t\tif(idx>=jsList.length){\n\t\t\tTrue&&True();\n\t\t\treturn;\n\t\t};\n\t\tvar itm=jsList[idx];\n\t\tif(typeof(itm)==\"string\")itm={url:itm};\n\t\tif(itm.check && itm.check()===false){\n\t\t\tload(idx+1);\n\t\t\treturn;\n\t\t};\n\t\tif(allCheck && allCheck(itm)===false){\n\t\t\tload(idx+1);\n\t\t\treturn;\n\t\t};\n\t\tvar url=itm.url;\n\t\t\n\t\tvar elem=document.createElement(\"script\");\n\t\telem.setAttribute(\"type\",\"text/javascript\");\n\t\telem.setAttribute(\"src\",(/^\\w+:/.test(url)?\"\":rootUrl)+url);\n\t\tif(!(\"onload\" in elem)){//IsLoser 古董浏览器\n\t\t\telem.onreadystatechange=function(){\n\t\t\t\tif(elem.readyState==\"loaded\"){\n\t\t\t\t\telem.onload();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tvar isload=0;\n\t\telem.onload=function(){\n\t\t\tif(!isload){\n\t\t\t\tload(idx+1);\n\t\t\t\tisload=1;\n\t\t\t}\n\t\t};\n\t\telem.onerror=function(e){\n\t\t\tvar v=False&&False(Html_$T(\"b6iP::js加载失败:\")+(e.message||\"-\")+\", \"+url,1);\n\t\t\tif(v===false){\n\t\t\t\telem.onload();\n\t\t\t}\n\t\t};\n\t\t$(\"head\")[0].appendChild(elem);\n\t};\n\tsetTimeout(function(){ load(0) });\n};\n\n(function(){try{\n\tvar minjs=$(\".loadMinJs\");\n\tminjs[0].checked=localStorage[\"loadMinJs\"]!=\"0\";\n\tminjs.bind(\"change\",function(){\n\t\tkeepTypeInHash($(\"[name=type]:checked\").val(),minjs[0].checked);\n\t\t\n\t\tlocalStorage[\"loadMinJs\"]=minjs[0].checked?\"1\":\"0\";\n\t\tlocation.reload();\n\t});\n\t\n\t//加载默认类型编码器\n\tvar type=Import_RecJs_Set.type||\"mp3\";\n\tvar els=$(\"input[name=type]\"),el=0;\n\tfor(var i=0;i<els.length;i++){\n\t\tif(els[i].value==type)el=els[i];\n\t}\n\tel.checked=true;\n\tif(Import_RecJs_Set.type){\n\t\tloadEngineState[type]=!!Import_RecJs_Set.minJs;\n\t}\n\tloadEngine(el.value);\n\n//pcm测试页面来的\nif(/ispcm=1/.test(location.href)){\n\t$(\".demoHead,.gitUrl,.btns,.recpower,.waveBox,.pcmPageHide\").hide();\n};\n}catch(e){console.error(e)}})();\n</script>\n\n<!-- 加载打赏挂件 -->\n<script src=\"assets/zdemo.widget.donate.js\"></script>\n<script>\nDonateWidget({\n\tlog:function(msg){reclog(msg)}\n\t,mobElem:$(\".reclog\").append('<div class=\"DonateView\"></div>').find(\".DonateView\")[0]\n});\n</script>\n\n<!-- 启用国际化多语言支持 -->\n<script>\nPageI18nWidget({\n\telem:\".i18nBox\", rootUrl:\"./\"\n\t,titleKey:\"HQYi\"\n\t,langs:{\n\t\t\"en-US\":{urls:[ \"#index_html/en-US.js\",\"#widget_donate/en-US.js\" ]}\n\t}\n\t,onUpdate:function(item){\n\t\tdocument.body.style.wordBreak=item.keyAs==\"zh\"?\"break-all\":\"normal\";\n\t\tresetPageTitle();\n\t}\n});\n</script>\n\n</div>\n</body>\n</html>"
        },
        {
          "name": "recorder.mp3.min.js",
          "type": "blob",
          "size": 141.08203125,
          "content": "/*\n录音\nhttps://github.com/xiangyuecn/Recorder\nsrc: recorder-core.js,engine/mp3.js,engine/mp3-engine.js\n*/\n!function(e){var t=\"object\"==typeof window&&!!window.document,a=t?window:Object;!function(e,w){\"use strict\";var M=function(){},f=function(e){return\"number\"==typeof e},B=function(e){return JSON.stringify(e)},W=function(e){return new _(e)},y=W.LM=\"2024-10-20 22:15\",A=\"https://github.com/xiangyuecn/Recorder\",T=\"Recorder\",k=\"getUserMedia\",N=\"srcSampleRate\",V=\"sampleRate\",i=\"bitRate\",E=\"catch\",t=e[T];if(t&&t.LM==y)return t.CLog(t.i18n.$T(\"K8zP::重复导入{1}\",0,T),3);W.IsOpen=function(){var e=W.Stream;if(e){var t=D(e),a=t[0];if(a){var n=a.readyState;return\"live\"==n||n==a.LIVE}}return!1},W.BufferSize=4096,W.Destroy=function(){for(var e in Q(T+\" Destroy\"),O(),a)a[e]()};var a={};W.BindDestroy=function(e,t){a[e]=t},W.Support=function(){if(!w)return!1;var e=navigator.mediaDevices||{};return e[k]||(e=navigator)[k]||(e[k]=e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia),!!e[k]&&(W.Scope=e,!!W.GetContext())},W.GetContext=function(e){if(!w)return null;var t=window.AudioContext;if(t||(t=window.webkitAudioContext),!t)return null;var a=W.Ctx,n=0;return a||(a=W.Ctx=new t,n=1,W.NewCtxs=W.NewCtxs||[],W.BindDestroy(\"Ctx\",function(){var e=W.Ctx;e&&e.close&&(s(e),W.Ctx=0);var t=W.NewCtxs;W.NewCtxs=[];for(var a=0;a<t.length;a++)s(t[a])})),e&&a.close&&(n||(a._useC||s(a),a=new t),a._useC=1,W.NewCtxs.push(a)),a},W.CloseNewCtx=function(e){if(e&&e.close){s(e);for(var t=W.NewCtxs||[],a=t.length,n=0;n<t.length;n++)if(t[n]==e){t.splice(n,1);break}Q($(\"mSxV::剩{1}个GetContext未close\",0,a+\"-1=\"+t.length),t.length?3:0)}};var s=function(e){if(e&&e.close&&!e._isC&&(e._isC=1,\"closed\"!=e.state))try{e.close()}catch(e){Q(\"ctx close err\",1,e)}},C=W.ResumeCtx=function(a,n,s,r){var i=0,o=0,_=0,l=0,f=\"EventListener\",c=\"ResumeCtx \",u=function(e,t){o&&h(),i||(i=1,e&&r(e,l),t&&s(l)),t&&(!a._LsSC&&a[\"add\"+f]&&a[\"add\"+f](\"statechange\",b),a._LsSC=1,_=1)},h=function(e){if(!e||!o){o=e?1:0;for(var t=[\"focus\",\"mousedown\",\"mouseup\",\"touchstart\",\"touchend\"],a=0;a<t.length;a++)window[(e?\"add\":\"remove\")+f](t[a],b,!0)}},b=function(){var e=a.state,t=p(e);if(!i&&!n(t?++l:l))return u();t?(_&&Q(c+\"sc \"+e,3),h(1),a.resume().then(function(){_&&Q(c+\"sc \"+a.state),u(0,1)})[E](function(e){Q(c+\"error\",1,e),p(a.state)||u(e.message||\"error\")})):\"closed\"==e?(_&&!a._isC&&Q(c+\"sc \"+e,1),u(\"ctx closed\")):u(0,1)};b()},p=W.CtxSpEnd=function(e){return\"suspended\"==e||\"interrupted\"==e},R=function(e){var t=e.state,a=\"ctx.state=\"+t;return p(t)&&(a+=$(\"nMIy::（注意：ctx不是running状态，rec.open和start至少要有一个在用户操作(触摸、点击等)时进行调用，否则将在rec.start时尝试进行ctx.resume，可能会产生兼容性问题(仅iOS)，请参阅文档中runningContext配置）\")),a},I=\"ConnectEnableWebM\";W[I]=!0;var L=\"ConnectEnableWorklet\";W[L]=!1;var x=function(e){var _=e.BufferSize||W.BufferSize,l=e.Stream,i=l._c,f=i[V],c={},t=D(l),a=t[0],n=null,s=\"\";if(a&&a.getSettings){var r=(n=a.getSettings())[V];r&&r!=f&&(s=$(\"eS8i::Stream的采样率{1}不等于{2}，将进行采样率转换（注意：音质不会变好甚至可能变差），主要在移动端未禁用回声消除时会产生此现象，浏览器有回声消除时可能只会返回16k采样率的音频数据，\",0,r,f))}l._ts=n,Q(s+\"Stream TrackSet: \"+B(n),s?3:0);var u,o,h,b=function(e){var t=l._m=i.createMediaStreamSource(l),a=i.destination,n=\"createMediaStreamDestination\";i[n]&&(a=l._d=i[n]()),t.connect(e),e.connect(a)},p=\"\",m=l._call,v=function(e,t){for(var a in m){if(t!=f){c.index=0;var n=(c=W.SampleData([e],t,f,c,{_sum:1})).data,s=c._sum}else{c={};for(var r=e.length,n=new Int16Array(r),s=0,i=0;i<r;i++){var o=Math.max(-1,Math.min(1,e[i]));o=o<0?32768*o:32767*o,n[i]=o,s+=Math.abs(o)}}for(var _ in m)m[_](n,s);return}},d=\"ScriptProcessor\",g=\"audioWorklet\",S=T+\" \"+g,w=\"RecProc\",M=\"MediaRecorder\",y=M+\".WebM.PCM\",A=i.createScriptProcessor||i.createJavaScriptNode,k=$(\"ZGlf::。由于{1}内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启{1}。\",0,g),R=function(){o=l.isWorklet=!1,P(l),Q($(\"7TU0::Connect采用老的{1}，\",0,d)+q.get($(W[L]?\"JwCL::但已设置{1}尝试启用{2}\":\"VGjB::可设置{1}尝试启用{2}\",2),[T+\".\"+L+\"=true\",g])+p+k,3);var e=l._p=A.call(i,_,1,1);b(e),e.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);v(t,f)}},x=function(){u=l.isWebM=!1,H(l),o=l.isWorklet=!A||W[L];var t=window.AudioWorkletNode;if(o&&i[g]&&t){var n=function(){return o&&l._na},s=l._na=function(){\"\"!==h&&(clearTimeout(h),h=setTimeout(function(){h=0,n()&&(Q($(\"MxX1::{1}未返回任何音频，恢复使用{2}\",0,g,d),3),A&&R())},500))},r=function(){if(n()){var e=l._n=new t(i,w,{processorOptions:{bufferSize:_}});b(e),e.port.onmessage=function(e){h&&(clearTimeout(h),h=\"\"),n()?v(e.data.val,f):o||Q($(\"XUap::{1}多余回调\",0,g),3)},Q($(\"yOta::Connect采用{1}，设置{2}可恢复老式{3}\",0,g,T+\".\"+L+\"=false\",d)+p+k,3)}},e=function(){if(n())if(i[w])r();else{var e,t,a=(t=\"class \"+w+\" extends AudioWorkletProcessor{\",t+=\"constructor \"+(e=function(e){return e.toString().replace(/^function|DEL_/g,\"\").replace(/\\$RA/g,S)})(function(e){DEL_super(e);var t=this,a=e.processorOptions.bufferSize;t.bufferSize=a,t.buffer=new Float32Array(2*a),t.pos=0,t.port.onmessage=function(e){e.data.kill&&(t.kill=!0,$C.log(\"$RA kill call\"))},$C.log(\"$RA .ctor call\",e)}),t+=\"process \"+e(function(e,t,a){var n=this,s=n.bufferSize,r=n.buffer,i=n.pos;if((e=(e[0]||[])[0]||[]).length){r.set(e,i);var o=~~((i+=e.length)/s)*s;if(o){this.port.postMessage({val:r.slice(0,o)});var _=r.subarray(o,i);(r=new Float32Array(2*s)).set(_),i=_.length,n.buffer=r}n.pos=i}return!n.kill}),t=(t+='}try{registerProcessor(\"'+w+'\", '+w+')}catch(e){$C.error(\"'+S+' Reg Error\",e)}').replace(/\\$C\\./g,\"console.\"),\"data:text/javascript;base64,\"+btoa(unescape(encodeURIComponent(t))));i[g].addModule(a).then(function(e){n()&&(i[w]=1,r(),h&&s())})[E](function(e){Q(g+\".addModule Error\",1,e),n()&&R()})}};C(i,function(){return n()},e,e)}else R()};!function(){var e=window[M],t=\"ondataavailable\",a=\"audio/webm; codecs=pcm\";u=l.isWebM=W[I];var n=e&&t in e.prototype&&e.isTypeSupported(a);if(p=n?\"\":$(\"VwPd::（此浏览器不支持{1}）\",0,y),!u||!n)return x();var s=function(){return u&&l._ra};l._ra=function(){\"\"!==h&&(clearTimeout(h),h=setTimeout(function(){s()&&(Q($(\"vHnb::{1}未返回任何音频，降级使用{2}\",0,M,g),3),x())},500))};var r=Object.assign({mimeType:a},W.ConnectWebMOptions),i=l._r=new e(l,r),o=l._rd={};i[t]=function(e){var t=new FileReader;t.onloadend=function(){if(s()){var e=F(new Uint8Array(t.result),o);if(!e)return;if(-1==e)return void x();h&&(clearTimeout(h),h=\"\"),v(e,o.webmSR)}else u||Q($(\"O9P7::{1}多余回调\",0,M),3)},t.readAsArrayBuffer(e.data)},i.start(~~(_/48)),Q($(\"LMEm::Connect采用{1}，设置{2}可恢复使用{3}或老式{4}\",0,y,T+\".\"+I+\"=false\",g,d))}()},r=function(e){e._na&&e._na(),e._ra&&e._ra()},P=function(e){e._na=null,e._n&&(e._n.port.postMessage({kill:!0}),e._n.disconnect(),e._n=null)},H=function(e){if(e._ra=null,e._r){try{e._r.stop()}catch(e){Q(\"mr stop err\",1,e)}e._r=null}},O=function(e){var t=(e=e||W)==W,a=e.Stream;a&&(a._m&&(a._m.disconnect(),a._m=null),!a._RC&&a._c&&W.CloseNewCtx(a._c),a._RC=null,a._c=null,a._d&&(n(a._d.stream),a._d=null),a._p&&(a._p.disconnect(),a._p.onaudioprocess=a._p=null),P(a),H(a),t&&n(a)),e.Stream=0},n=W.StopS_=function(e){for(var t=D(e),a=0;a<t.length;a++){var n=t[a];n.stop&&n.stop()}e.stop&&e.stop()},D=function(e){var t=0,a=0,n=[];e.getAudioTracks&&(t=e.getAudioTracks(),a=e.getVideoTracks()),t||(t=e.audioTracks,a=e.videoTracks);for(var s=0,r=t?t.length:0;s<r;s++)n.push(t[s]);for(var s=0,r=a?a.length:0;s<r;s++)n.push(a[s]);return n};W.SampleData=function(e,t,a,n,s){var r=\"SampleData\";n||(n={});var i=n.index||0,o=n.offset||0,_=n.raisePrev||0,l=n.filter;if(l&&l.fn&&(l.sr&&l.sr!=t||l.srn&&l.srn!=a)&&(l=null,Q($(\"d48C::{1}的filter采样率变了，重设滤波\",0,r),3)),!l)if(a<=t){var f=3*t/4<a?0:a/2*3/4;l={fn:f?W.IIRFilter(!0,t,f):0}}else{var f=3*a/4<t?0:t/2*3/4;l={fn:f?W.IIRFilter(!0,a,f):0}}l.sr=t,l.srn=a;var c=l.fn,u=n.frameNext||[];s||(s={});var h=s.frameSize||1;s.frameType&&(h=\"mp3\"==s.frameType?1152:1);var b=s._sum,p=0,m=e.length;m+1<i&&Q($(\"tlbC::{1}似乎传入了未重置chunk {2}\",0,r,i+\">\"+m),3);for(var v=0,d=i;d<m;d++)v+=e[d].length;var g=t/a;if(1<g)v=Math.max(0,v-Math.floor(o)),v=Math.floor(v/g);else if(g<1){var S=1/g;v=Math.floor(v*S)}v+=u.length;for(var w=new Int16Array(v),M=0,d=0;d<u.length;d++)w[M]=u[d],M++;for(;i<m;i++){var y=e[i],A=y instanceof Float32Array,d=o,k=y.length,R=c&&c.Embed,x=0,B=0,T=0,E=0;if(g<1){for(var C=M+d,I=_,L=0;L<k;L++){var P=y[L];A&&(P=(P=Math.max(-1,Math.min(1,P)))<0?32768*P:32767*P);var H=Math.floor(C);C+=S;for(var O=Math.floor(C),N=(P-I)/(O-H),V=1;H<O;H++,V++){var D=Math.floor(I+V*N);R?(T=D,E=R.b0*T+R.b1*R.x1+R.b0*R.x2-R.a1*R.y1-R.a2*R.y2,R.x2=R.x1,R.x1=T,R.y2=R.y1,R.y1=E,D=E):D=c?c(D):D,32767<D?D=32767:D<-32768&&(D=-32768),b&&(p+=Math.abs(D)),w[H]=D,M++}I=_=P,d+=S}o=d%1}else{for(var L=0,F=0;L<k;L++,F++){if(F<k){var P=y[F];A&&(P=(P=Math.max(-1,Math.min(1,P)))<0?32768*P:32767*P),R?(T=P,E=R.b0*T+R.b1*R.x1+R.b0*R.x2-R.a1*R.y1-R.a2*R.y2,R.x2=R.x1,R.x1=T,R.y2=R.y1,R.y1=E):E=c?c(P):P}if(x=B,B=E,0!=F){var j=Math.floor(d);if(L==j){var X=Math.ceil(d),Y=d-j,z=x,q=X<k?B:z,G=z+(q-z)*Y;32767<G?G=32767:G<-32768&&(G=-32768),b&&(p+=Math.abs(G)),w[M]=G,M++,d+=g}}else L--}o=Math.max(0,d-k)}}g<1&&M+1==v&&(v--,w=new Int16Array(w.buffer.slice(0,2*v))),M-1!=v&&M!=v&&Q(r+\" idx:\"+M+\" != size:\"+v,3),u=null;var U=v%h;if(0<U){var K=2*(v-U);u=new Int16Array(w.buffer.slice(K)),w=new Int16Array(w.buffer.slice(0,K))}var Z={index:i,offset:o,raisePrev:_,filter:l,frameNext:u,sampleRate:a,data:w};return b&&(Z._sum=p),Z},W.IIRFilter=function(e,t,a){var n=2*Math.PI*a/t,s=Math.sin(n),r=Math.cos(n),i=s/2,o=1+i,_=-2*r/o,l=(1-i)/o;if(e)var f=(1-r)/2/o,c=(1-r)/o;else var f=(1+r)/2/o,c=-(1+r)/o;var u=0,h=0,b=0,p=0,m=0,v=function(e){return b=f*e+c*u+f*h-_*p-l*m,h=u,u=e,m=p,p=b};return v.Embed={x1:0,x2:0,y1:0,y2:0,b0:f,b1:c,a1:_,a2:l},v},W.PowerLevel=function(e,t){var a=e/t||0;return a<1251?Math.round(a/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(a/1e4)/Math.log(10)))))},W.PowerDBFS=function(e){var t=Math.max(.1,e||0);return t=Math.min(t,32767),t=20*Math.log(t/32767)/Math.log(10),Math.max(-100,Math.round(t))},W.CLog=function(e,t){if(\"object\"==typeof console){var a=new Date,n=(\"0\"+a.getMinutes()).substr(-2)+\":\"+(\"0\"+a.getSeconds()).substr(-2)+\".\"+(\"00\"+a.getMilliseconds()).substr(-3),s=this&&this.envIn&&this.envCheck&&this.id,r=[\"[\"+n+\" \"+T+(s?\":\"+s:\"\")+\"]\"+e],i=arguments,o=W.CLog,_=2,l=o.log||console.log;for(f(t)?l=1==t?o.error||console.error:3==t?o.warn||console.warn:l:_=1;_<i.length;_++)r.push(i[_]);c?l&&l(\"[IsLoser]\"+r[0],1<r.length?r:\"\"):l.apply(console,r)}};var Q=function(){W.CLog.apply(this,arguments)},c=!0;try{c=!console.log.apply}catch(e){}var o=0;function _(e){var t=this;t.id=++o,l();var a={type:\"mp3\",onProcess:M};for(var n in e)a[n]=e[n];var s=(t.set=a)[i],r=a[V];(s&&!f(s)||r&&!f(r))&&t.CLog($.G(\"IllegalArgs-1\",[$(\"VtS4::{1}和{2}必须是数值\",0,V,i)]),1,e),a[i]=+s||16,a[V]=+r||16e3,t.state=0,t._S=9,t.Sync={O:9,C:9}}W.Sync={O:9,C:9},W.prototype=_.prototype={CLog:Q,_streamStore:function(){return this.set.sourceStream?this:W},_streamGet:function(){return this._streamStore().Stream},_streamCtx:function(){var e=this._streamGet();return e&&e._c},open:function(e,a){var _=this,l=_.set,n=_._streamStore(),s=0;e=e||M;var r=function(e,t){t=!!t,_.CLog($(\"5tWi::录音open失败：\")+e+\",isUserNotAllow:\"+t,1),s&&W.CloseNewCtx(s),a&&a(e,t)};_._streamTag=k;var i=function(){_.CLog(\"open ok, id:\"+_.id+\" stream:\"+_._streamTag),e(),_._SO=0},o=n.Sync,f=++o.O,c=o.C;_._O=_._O_=f,_._SO=_._S;if(w){var t=_.envCheck({envName:\"H5\",canProcess:!0});if(t)r($(\"A5bm::不能录音：\")+t);else{var u,h=function(){(u=l.runningContext)||(u=s=W.GetContext(!0))};if(l.sourceStream){if(_._streamTag=\"set.sourceStream\",!W.GetContext())return void r($(\"1iU7::不支持此浏览器从流中获取录音\"));h(),O(n);var b=_.Stream=l.sourceStream;b._c=u,b._RC=l.runningContext,b._call={};try{x(n)}catch(e){return O(n),void r($(\"BTW2::从流中打开录音失败：\")+e.message)}i()}else{var p=function(e,t){try{window.top.a}catch(e){return void r($(\"Nclz::无权录音(跨域，请尝试给iframe添加麦克风访问策略，如{1})\",0,'allow=\"camera;microphone\"'))}m(1,e)&&(/Found/i.test(e)?r(t+$(\"jBa9::，无可用麦克风\")):r(t))},m=function(e,t){if(/Permission|Allow/i.test(t))e&&r($(\"gyO5::用户拒绝了录音权限\"),!0);else{if(!1!==window.isSecureContext)return 1;e&&r($(\"oWNo::浏览器禁止不安全页面录音，可开启https解决\"))}};if(W.IsOpen())i();else if(W.Support()){h();var v=function(t){setTimeout(function(){t._call={};var e=W.Stream;e&&(O(),t._call=e._call),(W.Stream=t)._c=u,t._RC=l.runningContext,function(){if(c!=o.C||!_._O){var e=$(\"dFm8::open被取消\");return f==o.O?_.close():e=$(\"VtJO::open被中断\"),r(e),!0}}()||(W.IsOpen()?(e&&_.CLog($(\"upb8::发现同时多次调用open\"),1),x(n),i()):r($(\"Q1GA::录音功能无效：无音频流\")))},100)},d=function(e){var t=e.name||e.message||e.code+\":\"+e,a=\"\";1==g&&m(0,t)&&(a=$(\"KxE2::，将尝试禁用回声消除后重试\")),_.CLog($(\"xEQR::请求录音权限错误\")+a+\"|\"+e,a?3:1,e),a?S(1):p(t,$(\"bDOG::无法录音：\")+e)},g=0,S=function(e){g++;var t=\"audioTrackSet\",a=\"autoGainControl\",n=\"echoCancellation\",s=\"noiseSuppression\",r=JSON.parse(B(l[t]||!0));_.CLog(\"open... \"+g+\" \"+t+\":\"+B(r)),e&&(\"object\"!=typeof r&&(r={}),r[a]=!1,r[n]=!1,r[s]=!1),r[V]&&_.CLog($(\"IjL3::注意：已配置{1}参数，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象\",0,t+\".\"+V),3);var i={audio:r,video:l.videoTrackSet||!1};try{var o=W.Scope[k](i,v,d)}catch(e){_.CLog(k,3,e),i={audio:!0,video:!1},o=W.Scope[k](i,v,d)}_.CLog(k+\"(\"+B(i)+\") \"+R(u)+$(\"RiWe::，未配置 {1} 时浏览器可能会自动启用回声消除，移动端未禁用回声消除时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流），请参阅文档中{2}配置\",0,\"audioTrackSet:{echoCancellation,noiseSuppression,autoGainControl}\",t)+\"(\"+A+\") LM:\"+y+\" UA:\"+navigator.userAgent),o&&o.then&&o.then(v)[E](d)};S()}else p(\"\",$(\"COxc::此浏览器不支持录音\"))}}}else r($.G(\"NonBrowser-1\",[\"open\"])+$(\"EMJq::，可尝试使用RecordApp解决方案\")+\"(\"+A+\"/tree/master/app-support-sample)\")},close:function(e){e=e||M;var t=this,a=t._streamStore();t._stop();var n=\" stream:\"+t._streamTag,s=a.Sync;if(t._O=0,t._O_!=s.O)return t.CLog($(\"hWVz::close被忽略（因为同时open了多个rec，只有最后一个会真正close）\")+n,3),void e();s.C++,O(a),t.CLog(\"close,\"+n),e()},mock:function(e,t){var a=this;return a._stop(),a.isMock=1,a.mockEnvInfo=null,a.buffers=[e],a.recSize=e.length,a._setSrcSR(t),a._streamTag=\"mock\",a},_setSrcSR:function(e){var t=this.set,a=t[V];e<a?t[V]=e:a=0,this[N]=e,this.CLog(N+\": \"+e+\" set.\"+V+\": \"+t[V]+(a?\" \"+$(\"UHvm::忽略\")+\": \"+a:\"\"),a?3:0)},envCheck:function(e){var t,a=this.set,n=\"CPU_BE\";if(t||W[n]||\"function\"!=typeof Int8Array||new Int8Array(new Int32Array([1]).buffer)[0]||(l(n),t=$(\"Essp::不支持{1}架构\",0,n)),!t){var s=a.type,r=this[s+\"_envCheck\"];a.takeoffEncodeChunk&&(r?e.canProcess||(t=$(\"7uMV::{1}环境不支持实时处理\",0,e.envName)):t=$(\"2XBl::{1}类型不支持设置takeoffEncodeChunk\",0,s)+(this[s]?\"\":$(\"LG7e::(未加载编码器)\"))),!t&&r&&(t=this[s+\"_envCheck\"](e,a))}return t||\"\"},envStart:function(e,t){var a=this,n=a.set;if(a.isMock=e?1:0,a.mockEnvInfo=e,a.buffers=[],a.recSize=0,e&&(a._streamTag=\"env$\"+e.envName),a.state=1,a.envInLast=0,a.envInFirst=0,a.envInFix=0,a.envInFixTs=[],a._setSrcSR(t),a.engineCtx=0,a[n.type+\"_start\"]){var s=a.engineCtx=a[n.type+\"_start\"](n);s&&(s.pcmDatas=[],s.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(e,t){var s=this,r=s.set,i=s.engineCtx;if(1==s.state){var a=s[N],n=e.length,o=W.PowerLevel(t,n),_=s.buffers,l=_.length;_.push(e);var f=_,c=l,u=Date.now(),h=Math.round(n/a*1e3);s.envInLast=u,1==s.buffers.length&&(s.envInFirst=u-h);var b=s.envInFixTs;b.splice(0,0,{t:u,d:h});for(var p=u,m=0,v=0;v<b.length;v++){var d=b[v];if(3e3<u-d.t){b.length=v;break}p=d.t,m+=d.d}var g=b[1],S=u-p,w=S-m;if(S/3<w&&(g&&1e3<S||6<=b.length)){var M=u-g.t-h;if(h/5<M){var y=!r.disableEnvInFix;if(s.CLog(\"[\"+u+\"]\"+q.get($(y?\"4Kfd::补偿{1}ms\":\"bM5i::未补偿{1}ms\",1),[M]),3),s.envInFix+=M,y){var A=new Int16Array(M*a/1e3);n+=A.length,_.push(A)}}}var k=s.recSize,R=n,x=k+R;if(s.recSize=x,i){var B=W.SampleData(_,a,r[V],i.chunkInfo);i.chunkInfo=B,k=i.pcmSize,R=B.data.length,x=k+R,i.pcmSize=x,_=i.pcmDatas,l=_.length,_.push(B.data),a=B[V]}var T=Math.round(x/a*1e3),E=_.length,C=f.length,I=function(){for(var e=L?0:-R,t=null==_[0],a=l;a<E;a++){var n=_[a];null==n?t=1:(e+=n.length,i&&n.length&&s[r.type+\"_encode\"](i,n))}if(t&&i){var a=c;for(f[0]&&(a=0);a<C;a++)f[a]=null}t&&(e=L?R:0,_[0]=null),i?i.pcmSize+=e:s.recSize+=e},L=0,P=\"rec.set.onProcess\";try{L=r.onProcess(_,o,T,a,l,I)}catch(e){console.error(P+$(\"gFUF::回调出错是不允许的，需保证不会抛异常\"),e)}var H=Date.now()-u;if(10<H&&1e3<s.envInFirst-u&&s.CLog(P+$(\"2ghS::低性能，耗时{1}ms\",0,H),3),!0===L){for(var O=0,v=l;v<E;v++)null==_[v]?O=1:_[v]=new Int16Array(0);O?s.CLog($(\"ufqH::未进入异步前不能清除buffers\"),3):i?i.pcmSize-=R:s.recSize-=R}else I()}else s.state||s.CLog(\"envIn at state=0\",3)},start:function(){var t=this,e=1;if(t.set.sourceStream?t.Stream||(e=0):W.IsOpen()||(e=0),e){var a=t._streamCtx();if(t.CLog($(\"kLDN::start 开始录音，\")+R(a)+\" stream:\"+t._streamTag),t._stop(),t.envStart(null,a[V]),t.state=3,t._SO&&t._SO+1!=t._S)t.CLog($(\"Bp2y::start被中断\"),3);else{t._SO=0;var n=function(){3==t.state&&(t.state=1,t.resume())},s=\"AudioContext resume: \",r=t._streamGet();r._call[t.id]=function(){t.CLog(s+a.state+\"|stream ok\"),n()},C(a,function(e){return e&&t.CLog(s+\"wait...\"),3==t.state},function(e){e&&t.CLog(s+a.state),n()},function(e){t.CLog(s+a.state+$(\"upkE::，可能无法录音：\")+e,1),n()})}}else t.CLog($(\"6WmN::start失败：未open\"),1)},pause:function(){var e=this,t=e._streamGet();e.state&&(e.state=2,e.CLog(\"pause\"),t&&delete t._call[e.id])},resume:function(){var a=this,t=a._streamGet(),n=\"resume(wait ctx)\";if(3==a.state)a.CLog(n);else if(a.state){a.state=1,a.CLog(\"resume\"),a.envResume(),t&&(t._call[a.id]=function(e,t){1==a.state&&a.envIn(e,t)},r(t));var s=a._streamCtx();s&&C(s,function(e){return e&&a.CLog(n+\"...\"),1==a.state},function(e){e&&a.CLog(n+s.state),r(t)},function(e){a.CLog(n+s.state+\"[err]\"+e,1)})}},_stop:function(e){var t=this,a=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!e&&t[a.type+\"_stop\"]&&(t[a.type+\"_stop\"](t.engineCtx),t.engineCtx=0)},stop:function(c,t,e){var u,h=this,b=h.set,a=h.envInLast-h.envInFirst,n=a&&h.buffers.length;h.CLog($(\"Xq4s::stop 和start时差:\")+(a?a+\"ms \"+$(\"3CQP::补偿:\")+h.envInFix+\"ms envIn:\"+n+\" fps:\"+(n/a*1e3).toFixed(1):\"-\")+\" stream:\"+h._streamTag+\" (\"+A+\") LM:\"+y);var p=function(){h._stop(),e&&h.close()},m=function(e){h.CLog($(\"u8JG::结束录音失败：\")+e,1),t&&t(e),p()},s=function(e,t,a){var n=\"arraybuffer\",s=\"dataType\",r=\"DefaultDataType\",i=h[s]||W[r]||\"blob\",o=s+\"=\"+i,_=e instanceof ArrayBuffer,l=0,f=_?e.byteLength:e.size;if(i==n?_||(l=1):\"blob\"==i?\"function\"!=typeof Blob?l=$.G(\"NonBrowser-1\",[o])+$(\"1skY::，请设置{1}\",0,T+\".\"+r+'=\"'+n+'\"'):(_&&(e=new Blob([e],{type:t})),e instanceof Blob||(l=1),t=e.type||t):l=$.G(\"NotSupport-1\",[o]),h.CLog($(\"Wv7l::结束录音 编码花{1}ms 音频时长{2}ms 文件大小{3}b\",0,Date.now()-u,a,f)+\" \"+o+\",\"+t),l)m(1!=l?l:$(\"Vkbd::{1}编码器返回的不是{2}\",0,b.type,i)+\", \"+o);else{if(b.takeoffEncodeChunk)h.CLog($(\"QWnr::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据\"),3);else if(f<Math.max(50,a/5))return void m($(\"Sz2H::生成的{1}无效\",0,b.type));c&&c(e,a,t),p()}};if(!h.isMock){var r=3==h.state;if(!h.state||r)return void m($(\"wf9t::未开始录音\")+(r?$(\"Dl2c::，开始录音前无用户交互导致AudioContext未运行\"):\"\"))}h._stop(!0);var i=h.recSize;if(i)if(h[b.type]){if(h.isMock){var o=h.envCheck(h.mockEnvInfo||{envName:\"mock\",canProcess:!1});if(o)return void m($(\"AxOH::录音错误：\")+o)}var _=h.engineCtx;if(h[b.type+\"_complete\"]&&_){var l=Math.round(_.pcmSize/b[V]*1e3);return u=Date.now(),void h[b.type+\"_complete\"](_,function(e,t){s(e,t,l)},m)}if(u=Date.now(),h.buffers[0]){var f=W.SampleData(h.buffers,h[N],b[V]);b[V]=f[V];var v=f.data,l=Math.round(v.length/b[V]*1e3);h.CLog($(\"CxeT::采样:{1} 花:{2}ms\",0,i+\"->\"+v.length,Date.now()-u)),setTimeout(function(){u=Date.now(),h[b.type](v,function(e,t){s(e,t,l)},function(e){m(e)})})}else m($(\"xkKd::音频buffers被释放\"))}else m($(\"xGuI::未加载{1}编码器，请尝试到{2}的src/engine内找到{1}的编码器并加载\",0,b.type,T));else m($(\"Ltz3::未采集到录音\"))}};var F=function(e,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var a=t.tracks,n=[t.pos[0]],s=function(){t.pos[0]=n[0]},r=t.bytes.length,i=new Uint8Array(r+e.length);if(i.set(t.bytes),i.set(e,r),t.bytes=i,!t._ht){if(Y(i,n),z(i,n),!j(Y(i,n),[24,83,128,103]))return;for(Y(i,n);n[0]<i.length;){var o=Y(i,n),_=z(i,n),l=[0],f=0;if(!_)return;if(j(o,[22,84,174,107])){for(;l[0]<_.length;){var c=Y(_,l),u=z(_,l),h=[0],b={channels:0,sampleRate:0};if(j(c,[174]))for(;h[0]<u.length;){var p=Y(u,h),m=z(u,h),v=[0];if(j(p,[215])){var d=X(m);b.number=d,a[d]=b}else if(j(p,[131])){var d=X(m);1==d?b.type=\"video\":2==d?(b.type=\"audio\",f||(t.track0=b),b.idx=f++):b.type=\"Type-\"+d}else if(j(p,[134])){for(var g=\"\",S=0;S<m.length;S++)g+=String.fromCharCode(m[S]);b.codec=g}else if(j(p,[225]))for(;v[0]<m.length;){var w=Y(m,v),M=z(m,v);if(j(w,[181])){var d=0,y=new Uint8Array(M.reverse()).buffer;4==M.length?d=new Float32Array(y)[0]:8==M.length?d=new Float64Array(y)[0]:Q(\"WebM Track !Float\",1,M),b[V]=Math.round(d)}else j(w,[98,100])?b.bitDepth=X(M):j(w,[159])&&(b.channels=X(M))}}}t._ht=1,Q(\"WebM Tracks\",a),s();break}}}var A=t.track0;if(A){var k=A[V];if(t.webmSR=k,16==A.bitDepth&&/FLOAT/i.test(A.codec)&&(A.bitDepth=32,Q(\"WebM 16->32 bit\",3)),k<8e3||32!=A.bitDepth||A.channels<1||!/(\\b|_)PCM\\b/i.test(A.codec))return t.bytes=[],t.bad||Q(\"WebM Track Unexpected\",3,t),-(t.bad=1);for(var R=[],x=0;n[0]<i.length;){var c=Y(i,n),u=z(i,n);if(!u)break;if(j(c,[163])){var B=15&u[0],b=a[B];if(b){if(0===b.idx){for(var T=new Uint8Array(u.length-4),S=4;S<u.length;S++)T[S-4]=u[S];R.push(T),x+=T.length}}else Q(\"WebM !Track\"+B,1,a)}s()}if(x){var E=new Uint8Array(i.length-t.pos[0]);E.set(i.subarray(t.pos[0])),t.bytes=E,t.pos[0]=0;for(var T=new Uint8Array(x),S=0,C=0;S<R.length;S++)T.set(R[S],C),C+=R[S].length;var y=new Float32Array(T.buffer);if(1<A.channels){for(var I=[],S=0;S<y.length;)I.push(y[S]),S+=A.channels;y=new Float32Array(I)}return y}}},j=function(e,t){if(!e||e.length!=t.length)return!1;if(1==e.length)return e[0]==t[0];for(var a=0;a<e.length;a++)if(e[a]!=t[a])return!1;return!0},X=function(e){for(var t=\"\",a=0;a<e.length;a++){var n=e[a];t+=(n<16?\"0\":\"\")+n.toString(16)}return parseInt(t,16)||0},Y=function(e,t,a){var n=t[0];if(!(n>=e.length)){var s=e[n],r=(\"0000000\"+s.toString(2)).substr(-8),i=/^(0*1)(\\d*)$/.exec(r);if(i){var o=i[1].length,_=[];if(!(n+o>e.length)){for(var l=0;l<o;l++)_[l]=e[n],n++;return a&&(_[0]=parseInt(i[2]||\"0\",2)),t[0]=n,_}}}},z=function(e,t){var a=Y(e,t,1);if(a){var n=X(a),s=t[0],r=[];if(n<2147483647){if(s+n>e.length)return;for(var i=0;i<n;i++)r[i]=e[s],s++}return t[0]=s,r}},q=W.i18n={lang:\"zh-CN\",alias:{\"zh-CN\":\"zh\",\"en-US\":\"en\"},locales:{},data:{},put:function(e,t){var a=T+\".i18n.put: \",n=e.overwrite;n=null==n||n;var s=e.lang;if(!(s=q.alias[s]||s))throw new Error(a+\"set.lang?\");var r=q.locales[s];r||(r={},q.locales[s]=r);for(var i,o=/^([\\w\\-]+):/,_=0;_<t.length;_++){var l=t[_];if(i=o.exec(l)){var f=i[1],l=l.substr(f.length+1);!n&&r[f]||(r[f]=l)}else Q(a+\"'key:'? \"+l,3,e)}},get:function(){return q.v_G.apply(null,arguments)},v_G:function(n,s,e){s=s||[],e=e||q.lang,e=q.alias[e]||e;var t=q.locales[e],r=t&&t[n]||\"\";return r||\"zh\"==e?(q.lastLang=e,\"=Empty\"==r?\"\":r.replace(/\\{(\\d+)(\\!?)\\}/g,function(e,t,a){return e=s[(t=+t||0)-1],(t<1||t>s.length)&&(e=\"{?}\",Q(\"i18n[\"+n+\"] no {\"+t+\"}: \"+r,3)),a?\"\":e})):\"en\"==e?q.v_G(n,s,\"zh\"):q.v_G(n,s,\"en\")},$T:function(){return q.v_T.apply(null,arguments)},v_T:function(){for(var e,t=arguments,a=\"\",n=[],s=0,r=T+\".i18n.$T:\",i=/^([\\w\\-]*):/,o=0;o<t.length;o++){var _=t[o];if(0==o){if(e=i.exec(_),!(a=e&&e[1]))throw new Error(r+\"0 'key:'?\");_=_.substr(a.length+1)}if(-1===s)n.push(_);else{if(s)throw new Error(r+\" bad args\");if(0===_)s=-1;else if(f(_)){if(_<1)throw new Error(r+\" bad args\");s=_}else{var l=1==o?\"en\":o?\"\":\"zh\";if((e=i.exec(_))&&(l=e[1]||l,_=_.substr(e[1].length+1)),!e||!l)throw new Error(r+o+\" 'lang:'?\");q.put({lang:l,overwrite:!1},[a+\":\"+_])}}}return a?0<s?a:q.v_G(a,n):\"\"}},$=q.$T;$.G=q.get,$(\"NonBrowser-1::非浏览器环境，不支持{1}\",1),$(\"IllegalArgs-1::参数错误：{1}\",1),$(\"NeedImport-2::调用{1}需要先导入{2}\",2),$(\"NotSupport-1::不支持：{1}\",1),W.TrafficImgUrl=\"//ia.51.la/go1?id=20469973&pvFlag=1\";var l=W.Traffic=function(e){if(w){e=e?\"/\"+T+\"/Report/\"+e:\"\";var t=W.TrafficImgUrl;if(t){var a=W.Traffic,n=/^(https?:..[^\\/#]*\\/?)[^#]*/i.exec(location.href)||[],s=n[1]||\"http://file/\",r=(n[0]||s)+e;if(0==t.indexOf(\"//\")&&(t=/^https:/i.test(r)?\"https:\"+t:\"http:\"+t),e&&(t=t+\"&cu=\"+encodeURIComponent(s+e)),!a[r]){a[r]=1;var i=new Image;i.src=t,Q(\"Traffic Analysis Image: \"+(e||T+\".TrafficImgUrl=\"+W.TrafficImgUrl))}}}};t&&(Q($(\"8HO5::覆盖导入{1}\",0,T),1),t.Destroy());e[T]=W}(a,t),\"function\"==typeof define&&define.amd&&define(function(){return a.Recorder}),\"object\"==typeof module&&module.exports&&(module.exports=a.Recorder)}(),function(e){var t=\"object\"==typeof window&&!!window.document,a=(t?window:Object).Recorder,n=a.i18n;!function(m,e,u,t){\"use strict\";var o=\"48000, 44100, 32000, 24000, 22050, 16000, 12000, 11025, 8000\",_=\"8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 192, 224, 256, 320\";m.prototype.enc_mp3={stable:!0,takeEC:\"full\",getTestMsg:function(){return u(\"Zm7L::采样率范围：{1}；比特率范围：{2}（不同比特率支持的采样率范围不同，小于32kbps时采样率需小于32000）\",0,o,_)}};var h,v=function(e){var t=e.bitRate,a=e.sampleRate,n=a;if(-1==(\" \"+_+\",\").indexOf(\" \"+t+\",\")&&m.CLog(u(\"eGB9::{1}不在mp3支持的取值范围：{2}\",0,\"bitRate=\"+t,_),3),-1==(\" \"+o+\",\").indexOf(\" \"+a+\",\")){for(var s=o.split(\", \"),r=[],i=0;i<s.length;i++)r.push({v:+s[i],s:Math.abs(s[i]-a)});r.sort(function(e,t){return e.s-t.s}),n=r[0].v,e.sampleRate=n,m.CLog(u(\"zLTa::sampleRate已更新为{1}，因为{2}不在mp3支持的取值范围：{3}\",0,n,a,o),3)}},n=function(){return u.G(\"NeedImport-2\",[\"mp3.js\",\"src/engine/mp3-engine.js\"])},d=t&&\"function\"==typeof Worker;m.prototype.mp3=function(r,i,o){var e=this,_=e.set,l=r.length;if(m.lamejs){if(d){var t=e.mp3_start(_);if(t){if(t.isW)return e.mp3_encode(t,r),void e.mp3_complete(t,i,o,1);e.mp3_stop(t)}}v(_);var f=new m.lamejs.Mp3Encoder(1,_.sampleRate,_.bitRate),c=new Int8Array(5e5),u=0,h=0,b=0,p=function(){try{if(h<l)var e=f.encodeBuffer(r.subarray(h,h+57600));else{b=1;var e=f.flush()}}catch(e){if(console.error(e),!b)try{f.flush()}catch(e){console.error(e)}return void o(\"MP3 Encoder: \"+e.message)}var t=e.length;if(0<t){if(u+t>c.length){var a=new Int8Array(c.length+Math.max(5e5,t));a.set(c.subarray(0,u)),c=a}c.set(e,u),u+=t}if(h<l)h+=57600,setTimeout(p);else{var n=[c.buffer.slice(0,u)],s=g.fn(n,u,l,_.sampleRate);S(s,_),i(n[0]||new ArrayBuffer(0),\"audio/mp3\")}};p()}else o(n())},m.BindDestroy(\"mp3Worker\",function(){h&&(m.CLog(\"mp3Worker Destroy\"),h.terminate(),h=null)}),m.prototype.mp3_envCheck=function(e,t){var a=\"\";return t.takeoffEncodeChunk&&(p()||(a=u(\"yhUs::当前浏览器版本太低，无法实时处理\"))),a||m.lamejs||(a=n()),a},m.prototype.mp3_start=function(e){return p(e)};var b={id:0},p=function(t,e){var f,a=function(e){var t=e.data,a=f.wkScope.wk_ctxs,n=f.wkScope.wk_lame,s=f.wkScope.wk_mp3TrimFix,r=a[t.id];if(\"init\"==t.action)a[t.id]={sampleRate:t.sampleRate,bitRate:t.bitRate,takeoff:t.takeoff,pcmSize:0,memory:new Int8Array(5e5),mOffset:0,encObj:new n.Mp3Encoder(1,t.sampleRate,t.bitRate)};else if(!r)return;var i=function(e){var t=e.length;if(r.mOffset+t>r.memory.length){var a=new Int8Array(r.memory.length+Math.max(5e5,t));a.set(r.memory.subarray(0,r.mOffset)),r.memory=a}r.memory.set(e,r.mOffset),r.mOffset+=t};switch(t.action){case\"stop\":if(!r.isCp)try{r.encObj.flush()}catch(e){console.error(e)}r.encObj=null,delete a[t.id];break;case\"encode\":if(r.isCp)break;r.pcmSize+=t.pcm.length;try{var o=r.encObj.encodeBuffer(t.pcm)}catch(e){r.err=e,console.error(e)}o&&0<o.length&&(r.takeoff?c.onmessage({action:\"takeoff\",id:t.id,chunk:o}):i(o));break;case\"complete\":r.isCp=1;try{var o=r.encObj.flush()}catch(e){r.err=e,console.error(e)}if(o&&0<o.length&&(r.takeoff?c.onmessage({action:\"takeoff\",id:t.id,chunk:o}):i(o)),r.err){c.onmessage({action:t.action,id:t.id,err:\"MP3 Encoder: \"+r.err.message});break}var _=[r.memory.buffer.slice(0,r.mOffset)],l=s.fn(_,r.mOffset,r.pcmSize,r.sampleRate);c.onmessage({action:t.action,id:t.id,blob:_[0]||new ArrayBuffer(0),meta:l})}},n=function(n){c.onmessage=function(e){var t=e;n&&(t=e.data);var a=b[t.id];a&&(\"takeoff\"==t.action?a.set.takeoffEncodeChunk(new Uint8Array(t.chunk.buffer)):(a.call&&a.call(t),a.call=null))}},s=function(){var e={worker:c,set:t};return t?(e.id=++b.id,b[e.id]=e,v(t),c.postMessage({action:\"init\",id:e.id,sampleRate:t.sampleRate,bitRate:t.bitRate,takeoff:!!t.takeoffEncodeChunk,x:new Int16Array(5)})):c.postMessage({x:new Int16Array(5)}),e},c=h;if(e||!d)return m.CLog(u(\"k9PT::当前环境不支持Web Worker，mp3实时编码器运行在主线程中\"),3),c={postMessage:function(e){a({data:e})}},f={wkScope:{wk_ctxs:{},wk_lame:m.lamejs,wk_mp3TrimFix:g}},n(),s();try{if(!c){var r=(a+\"\").replace(/[\\w\\$]+\\.onmessage/g,\"self.postMessage\"),i=\");wk_lame();self.onmessage=\"+(r=r.replace(/[\\w\\$]+\\.wkScope/g,\"wkScope\"));i+=\";var wkScope={ wk_ctxs:{},wk_lame:wk_lame\",i+=\",wk_mp3TrimFix:{rm:\"+g.rm+\",fn:\"+g.fn+\"} }\";var o=m.lamejs.toString(),_=(window.URL||webkitURL).createObjectURL(new Blob([\"var wk_lame=(\",o,i],{type:\"text/javascript\"}));c=new Worker(_),setTimeout(function(){(window.URL||webkitURL).revokeObjectURL(_)},1e4),n(1)}var l=s();return l.isW=1,h=c,l}catch(e){return c&&c.terminate(),console.error(e),p(t,1)}};m.prototype.mp3_stop=function(e){if(e&&e.worker){e.worker.postMessage({action:\"stop\",id:e.id}),e.worker=null,delete b[e.id];var t=-1;for(var a in b)t++;t&&m.CLog(u(\"fT6M::mp3 worker剩{1}个未stop\",0,t),3)}},m.prototype.mp3_encode=function(e,t){e&&e.worker&&e.worker.postMessage({action:\"encode\",id:e.id,pcm:t})},m.prototype.mp3_complete=function(t,a,n,s){var r=this;t&&t.worker?(t.call=function(e){s&&r.mp3_stop(t),e.err?n(e.err):(S(e.meta,t.set),a(e.blob,\"audio/mp3\"))},t.worker.postMessage({action:\"complete\",id:t.id})):n(u(\"mPxH::mp3编码器未start\"))},m.mp3ReadMeta=function(e,t){var a=\"undefined\"!=typeof window&&window.parseInt||\"undefined\"!=typeof self&&self.parseInt||parseInt,n=new Uint8Array(e[0]||[]);if(n.length<4)return null;var s=function(e,t){return(\"0000000\"+((t||n)[e]||0).toString(2)).substr(-8)},r=s(0)+s(1),i=s(2)+s(3);if(!/^1{11}/.test(r))return null;var o={\"00\":2.5,10:2,11:1}[r.substr(11,2)],_={\"01\":3}[r.substr(13,2)],l={1:[44100,48e3,32e3],2:[22050,24e3,16e3],2.5:[11025,12e3,8e3]}[o];l&&(l=l[a(i.substr(4,2),2)]);var f=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320]][1==o?1:0][a(i.substr(0,4),2)];if(!(o&&_&&f&&l))return null;for(var c=Math.round(8*t/f),u=1==_?384:2==_?1152:1==o?1152:576,h=u/l*1e3,b=Math.floor(u*f/8/l*1e3),p=0,m=0,v=0;v<e.length;v++){var d=e[v];if(m+=d.byteLength,b+3<=m){var g=new Uint8Array(d),S=d.byteLength-(m-(b+3)+1),w=s(S,g);p=\"1\"==w.charAt(6);break}}return p&&b++,{version:o,layer:_,sampleRate:l,bitRate:f,duration:c,size:t,hasPadding:p,frameSize:b,frameDurationFloat:h}};var g={rm:m.mp3ReadMeta,fn:function(e,t,a,n){var s=this.rm(e,t);if(!s)return{size:t,err:\"mp3 unknown format\"};var r=Math.round(a/n*1e3),i=Math.floor((s.duration-r)/s.frameDurationFloat);if(0<i){var o=i*s.frameSize-(s.hasPadding?1:0);t-=o;for(var _=0,l=[],f=0;f<e.length;f++){var c=e[f];if(o<=0)break;o>=c.byteLength?(o-=c.byteLength,l.push(c),e.splice(f,1),f--):(e[f]=c.slice(o),_=c,o=0)}var u=this.rm(e,t);if(!u){_&&(e[0]=_);for(var f=0;f<l.length;f++)e.splice(f,0,l[f]);s.err=\"mp3 fix error: 已还原，错误原因不明\"}var h=s.trimFix={};h.remove=i,h.removeDuration=Math.round(i*s.frameDurationFloat),h.duration=Math.round(8*t/s.bitRate)}return s}},S=function(e,t){var a=\"MP3 Info: \";(e.sampleRate&&e.sampleRate!=t.sampleRate||e.bitRate&&e.bitRate!=t.bitRate)&&(m.CLog(a+u(\"uY9i::和设置的不匹配{1}，已更新成{2}\",0,\"set:\"+t.bitRate+\"kbps \"+t.sampleRate+\"hz\",\"set:\"+e.bitRate+\"kbps \"+e.sampleRate+\"hz\"),3,t),t.sampleRate=e.sampleRate,t.bitRate=e.bitRate);var n=e.trimFix;n?(a+=u(\"iMSm::Fix移除{1}帧\",0,n.remove)+\" \"+n.removeDuration+\"ms -> \"+n.duration+\"ms\",2<n.remove&&(e.err=(e.err?e.err+\", \":\"\")+u(\"b9zm::移除帧数过多\"))):a+=(e.duration||\"-\")+\"ms\",e.err?m.CLog(a,e.size?1:0,e.err,e):m.CLog(a,e)}}(a,0,n.$T,t)}(),function(e){\"use strict\";function t(){var d=function(e){return Math.log(e)/Math.log(10)},me=function(e){throw new Error(\"abort(\"+e+\")\")};function w(e){return new Int8Array(e)}function s(e){return new Int16Array(e)}function ve(e){return new Int32Array(e)}function de(e){return new Float32Array(e)}function n(e){return new Float64Array(e)}function ge(e){if(1==e.length)return de(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(ge(e));return a}function S(e){if(1==e.length)return ve(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(S(e));return a}function M(e){if(1==e.length)return s(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(M(e));return a}function E(e){if(1==e.length)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(E(e));return a}var Se={fill:function(e,t,a,n){if(2==arguments.length)for(var s=0;s<e.length;s++)e[s]=t;else for(var s=t;s<a;s++)e[s]=n}},I={arraycopy:function(e,t,a,n,s){for(var r=t+s;t<r;)a[n++]=e[t++]}},V={};function we(e){this.ordinal=e}V.SQRT2=1.4142135623730951,V.FAST_LOG10=function(e){return d(e)},V.FAST_LOG10_X=function(e,t){return d(e)*t},we.short_block_allowed=new we(0),we.short_block_coupled=new we(1),we.short_block_dispensed=new we(2),we.short_block_forced=new we(3);var D={};function Me(e){this.ordinal=e}function ye(e){var t=e;this.ordinal=function(){return t}}function A(){var w=null;function v(e){this.bits=0|e}this.qupvt=null,this.setModules=function(e){this.qupvt=e,w=e};var s=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function M(e,t,a,n,s,r){var i=.5946/t;for(e>>=1;0!=e--;)s[r++]=i>a[n++]?0:1,s[r++]=i>a[n++]?0:1}function y(e,t,a,n,s,r){var i=(e>>=1)%2;for(e>>=1;0!=e--;){var o,_,l,f,c,u,h,b;o=a[n++]*t,_=a[n++]*t,c=0|o,l=a[n++]*t,u=0|_,f=a[n++]*t,h=0|l,o+=w.adj43[c],b=0|f,_+=w.adj43[u],s[r++]=0|o,l+=w.adj43[h],s[r++]=0|_,f+=w.adj43[b],s[r++]=0|l,s[r++]=0|f}0!=i&&(o=a[n++]*t,_=a[n++]*t,c=0|o,u=0|_,o+=w.adj43[c],_+=w.adj43[u],s[r++]=0|o,s[r++]=0|_)}var o=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function d(e,t,a,n){var s=function(e,t,a){var n=0,s=0;do{var r=e[t++],i=e[t++];n<r&&(n=r),s<i&&(s=i)}while(t<a);return n<s&&(n=s),n}(e,t,a);switch(s){case 0:return s;case 1:return function(e,t,a,n){var s=0,r=k.ht[1].hlen;do{var i=2*e[t+0]+e[t+1];t+=2,s+=r[i]}while(t<a);return n.bits+=s,1}(e,t,a,n);case 2:case 3:return function(e,t,a,n,s){var r,i,o=0,_=k.ht[n].xlen;i=2==n?k.table23:k.table56;do{var l=e[t+0]*_+e[t+1];t+=2,o+=i[l]}while(t<a);return(r=65535&o)<(o>>=16)&&(o=r,n++),s.bits+=o,n}(e,t,a,o[s-1],n);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,a,n,s){var r=0,i=0,o=0,_=k.ht[n].xlen,l=k.ht[n].hlen,f=k.ht[n+1].hlen,c=k.ht[n+2].hlen;do{var u=e[t+0]*_+e[t+1];t+=2,r+=l[u],i+=f[u],o+=c[u]}while(t<a);var h=n;return i<r&&(r=i,h++),o<r&&(r=o,h=n+2),s.bits+=r,h}(e,t,a,o[s-1],n);default:var r,i;for(T.IXMAX_VAL<s&&me(),s-=15,r=24;r<32&&!(k.ht[r].linmax>=s);r++);for(i=r-8;i<24&&!(k.ht[i].linmax>=s);i++);return function(e,t,a,n,s,r){var i,o=65536*k.ht[n].xlen+k.ht[s].xlen,_=0;do{var l=e[t++],f=e[t++];0!=l&&(14<l&&(l=15,_+=o),l*=16),0!=f&&(14<f&&(f=15,_+=o),l+=f),_+=k.largetbl[l]}while(t<a);return(i=65535&_)<(_>>=16)&&(_=i,n=s),r.bits+=_,n}(e,t,a,i,r,n)}}function h(e,t,a,n,s,r,i,o){for(var _=t.big_values,l=2;l<Ae.SBMAX_l+1;l++){var f=e.scalefac_band.l[l];if(_<=f)break;var c=s[l-2]+t.count1bits;if(a.part2_3_length<=c)break;var u=new v(c),h=d(n,f,_,u);c=u.bits,a.part2_3_length<=c||(a.assign(t),a.part2_3_length=c,a.region0_count=r[l-2],a.region1_count=l-2-r[l-2],a.table_select[0]=i[l-2],a.table_select[1]=o[l-2],a.table_select[2]=h)}}this.noquant_count_bits=function(e,t,a){var n=t.l3_enc,s=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=a&&(a.sfb_count1=0);1<s&&0==(n[s-1]|n[s-2]);s-=2);t.count1=s;for(var r=0,i=0;3<s;s-=4){var o;if(1<(2147483647&(n[s-1]|n[s-2]|n[s-3]|n[s-4])))break;o=2*(2*(2*n[s-4]+n[s-3])+n[s-2])+n[s-1],r+=k.t32l[o],i+=k.t33l[o]}var _=r;if(t.count1table_select=0,i<r&&(_=i,t.count1table_select=1),t.count1bits=_,0==(t.big_values=s))return _;if(t.block_type==Ae.SHORT_TYPE)(r=3*e.scalefac_band.s[3])>t.big_values&&(r=t.big_values),i=t.big_values;else if(t.block_type==Ae.NORM_TYPE){if(r=t.region0_count=e.bv_scf[s-2],i=t.region1_count=e.bv_scf[s-1],i=e.scalefac_band.l[r+i+2],r=e.scalefac_band.l[r+1],i<s){var l=new v(_);t.table_select[2]=d(n,i,s,l),_=l.bits}}else t.region0_count=7,t.region1_count=Ae.SBMAX_l-1-7-1,r=e.scalefac_band.l[8],(i=s)<r&&(r=i);if(r=Math.min(r,s),i=Math.min(i,s),0<r){var l=new v(_);t.table_select[0]=d(n,0,r,l),_=l.bits}if(r<i){var l=new v(_);t.table_select[1]=d(n,r,i,l),_=l.bits}if(2==e.use_best_huffman&&me(),null!=a&&t.block_type==Ae.NORM_TYPE){for(var f=0;e.scalefac_band.l[f]<t.big_values;)f++;a.sfb_count1=f}return _},this.count_bits=function(e,t,a,n){var s=a.l3_enc,r=T.IXMAX_VAL/w.IPOW20(a.global_gain);return a.xrpow_max>r?T.LARGE_BITS:(function(e,t,a,n,s){var r,i,o,_=0,l=0,f=0,c=0,u=t,h=0,b=u,p=0,m=e,v=0;for(o=null!=s&&n.global_gain==s.global_gain,i=n.block_type==Ae.SHORT_TYPE?38:21,r=0;r<=i;r++){var d=-1;if((o||n.block_type==Ae.NORM_TYPE)&&(d=n.global_gain-(n.scalefac[r]+(0!=n.preflag?w.pretab[r]:0)<<n.scalefac_scale+1)-8*n.subblock_gain[n.window[r]]),o&&s.step[r]==d)0!=l&&(y(l,a,m,v,b,p),l=0),0!=f&&me();else{var g,S=n.width[r];if(_+n.width[r]>n.max_nonzero_coeff&&(g=n.max_nonzero_coeff-_+1,Se.fill(t,n.max_nonzero_coeff,576,0),(S=g)<0&&(S=0),r=i+1),0==l&&0==f&&(b=u,p=h,m=e,v=c),null!=s&&0<s.sfb_count1&&r>=s.sfb_count1&&0<s.step[r]&&d>=s.step[r]?(0!=l&&(y(l,a,m,v,b,p),l=0,b=u,p=h,m=e,v=c),f+=S):(0!=f&&(M(f,a,m,v,b,p),f=0,b=u,p=h,m=e,v=c),l+=S),S<=0){0!=f&&me(),0!=l&&me();break}}r<=i&&(h+=n.width[r],c+=n.width[r],_+=n.width[r])}0!=l&&(y(l,a,m,v,b,p),l=0),0!=f&&me()}(t,s,w.IPOW20(a.global_gain),a,n),0!=(2&e.substep_shaping)&&me(),this.noquant_count_bits(e,a,n))},this.best_huffman_divide=function(e,t){var a=new B,n=t.l3_enc,s=ve(23),r=ve(23),i=ve(23),o=ve(23);if(t.block_type!=Ae.SHORT_TYPE||1!=e.mode_gr){a.assign(t),t.block_type==Ae.NORM_TYPE&&(function(e,t,a,n,s,r,i){for(var o=t.big_values,_=0;_<=22;_++)n[_]=T.LARGE_BITS;for(var _=0;_<16;_++){var l=e.scalefac_band.l[_+1];if(o<=l)break;var f=0,c=new v(f),u=d(a,0,l,c);f=c.bits;for(var h=0;h<8;h++){var b=e.scalefac_band.l[_+h+2];if(o<=b)break;var p=f;c=new v(p);var m=d(a,l,b,c);p=c.bits,n[_+h]>p&&(n[_+h]=p,s[_+h]=_,r[_+h]=u,i[_+h]=m)}}}(e,t,n,s,r,i,o),h(e,a,t,n,s,r,i,o));var _=a.big_values;if(!(0==_||1<(n[_-2]|n[_-1])||576<(_=t.count1+2))){a.assign(t),a.count1=_;for(var l=0,f=0;_>a.big_values;_-=4){var c=2*(2*(2*n[_-4]+n[_-3])+n[_-2])+n[_-1];l+=k.t32l[c],f+=k.t33l[c]}if(a.big_values=_,a.count1table_select=0,f<l&&(l=f,a.count1table_select=1),a.count1bits=l,a.block_type==Ae.NORM_TYPE)h(e,a,t,n,s,r,i,o);else{if(a.part2_3_length=l,l=e.scalefac_band.l[8],_<l&&(l=_),0<l){var u=new v(a.part2_3_length);a.table_select[0]=d(n,0,l,u),a.part2_3_length=u.bits}if(l<_){var u=new v(a.part2_3_length);a.table_select[1]=d(n,l,_,u),a.part2_3_length=u.bits}t.part2_3_length>a.part2_3_length&&t.assign(a)}}}};var u=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],b=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],p=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],m=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];A.slen1_tab=p,A.slen2_tab=m,this.best_scalefac_store=function(e,t,a,n){var s,r,i,o,_=n.tt[t][a],l=0;for(s=i=0;s<_.sfbmax;s++){var f=_.width[s];for(i+=f,o=-f;o<0&&0==_.l3_enc[o+i];o++);0==o&&(_.scalefac[s]=l=-2)}if(0==_.scalefac_scale&&0==_.preflag){var c=0;for(s=0;s<_.sfbmax;s++)0<_.scalefac[s]&&(c|=_.scalefac[s]);if(0==(1&c)&&0!=c){for(s=0;s<_.sfbmax;s++)0<_.scalefac[s]&&(_.scalefac[s]>>=1);_.scalefac_scale=l=1}}if(0==_.preflag&&_.block_type!=Ae.SHORT_TYPE&&2==e.mode_gr){for(s=11;s<Ae.SBPSY_l&&!(_.scalefac[s]<w.pretab[s]&&-2!=_.scalefac[s]);s++);if(s==Ae.SBPSY_l){for(s=11;s<Ae.SBPSY_l;s++)0<_.scalefac[s]&&(_.scalefac[s]-=w.pretab[s]);_.preflag=l=1}}for(r=0;r<4;r++)n.scfsi[a][r]=0;for(2==e.mode_gr&&1==t&&n.tt[0][a].block_type!=Ae.SHORT_TYPE&&n.tt[1][a].block_type!=Ae.SHORT_TYPE&&(function(e,t){for(var a,n=t.tt[1][e],s=t.tt[0][e],r=0;r<k.scfsi_band.length-1;r++){for(a=k.scfsi_band[r];a<k.scfsi_band[r+1]&&!(s.scalefac[a]!=n.scalefac[a]&&0<=n.scalefac[a]);a++);if(a==k.scfsi_band[r+1]){for(a=k.scfsi_band[r];a<k.scfsi_band[r+1];a++)n.scalefac[a]=-1;t.scfsi[e][r]=1}}var i=0,o=0;for(a=0;a<11;a++)-1!=n.scalefac[a]&&(o++,i<n.scalefac[a]&&(i=n.scalefac[a]));for(var _=0,l=0;a<Ae.SBPSY_l;a++)-1!=n.scalefac[a]&&(l++,_<n.scalefac[a]&&(_=n.scalefac[a]));for(var r=0;r<16;r++)if(i<u[r]&&_<b[r]){var f=p[r]*o+m[r]*l;n.part2_length>f&&(n.part2_length=f,n.scalefac_compress=r)}}(a,n),l=0),s=0;s<_.sfbmax;s++)-2==_.scalefac[s]&&(_.scalefac[s]=0);0!=l&&(2==e.mode_gr?this.scale_bitcount(_):this.scale_bitcount_lsf(e,_))};var _=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],l=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],f=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,a,n,s=0,r=0,i=e.scalefac;if(e.block_type==Ae.SHORT_TYPE)n=_,0!=e.mixed_block_flag&&(n=l);else if(n=f,0==e.preflag){for(a=11;a<Ae.SBPSY_l&&!(i[a]<w.pretab[a]);a++);if(a==Ae.SBPSY_l)for(e.preflag=1,a=11;a<Ae.SBPSY_l;a++)i[a]-=w.pretab[a]}for(a=0;a<e.sfbdivide;a++)s<i[a]&&(s=i[a]);for(;a<e.sfbmax;a++)r<i[a]&&(r=i[a]);for(e.part2_length=T.LARGE_BITS,t=0;t<16;t++)s<u[t]&&r<b[t]&&e.part2_length>n[t]&&(e.part2_length=n[t],e.scalefac_compress=t);return e.part2_length==T.LARGE_BITS};var g=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,t){var a,n,s,r,i,o,_,l,f=ve(4),c=t.scalefac;for(a=0!=t.preflag?2:0,_=0;_<4;_++)f[_]=0;if(t.block_type==Ae.SHORT_TYPE){n=1;var u=w.nr_of_sfb_block[a][n];for(s=l=0;s<4;s++)for(r=u[s]/3,_=0;_<r;_++,l++)for(i=0;i<3;i++)c[3*l+i]>f[s]&&(f[s]=c[3*l+i])}else{n=0;var u=w.nr_of_sfb_block[a][n];for(s=l=0;s<4;s++)for(r=u[s],_=0;_<r;_++,l++)c[l]>f[s]&&(f[s]=c[l])}for(o=!1,s=0;s<4;s++)f[s]>g[a][s]&&(o=!0);if(!o){var h,b,p,m;for(t.sfb_partition_table=w.nr_of_sfb_block[a][n],s=0;s<4;s++)t.slen[s]=S[f[s]];switch(h=t.slen[0],b=t.slen[1],p=t.slen[2],m=t.slen[3],a){case 0:t.scalefac_compress=(5*h+b<<4)+(p<<2)+m;break;case 1:t.scalefac_compress=400+(5*h+b<<2)+p;break;case 2:t.scalefac_compress=500+3*h+b}}if(!o)for(t.part2_length=0,s=0;s<4;s++)t.part2_length+=t.slen[s]*t.sfb_partition_table[s];return o};var S=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var a,n=0;e.scalefac_band.l[++n]<t;);for(a=s[n][0];e.scalefac_band.l[a+1]>t;)a--;for(a<0&&(a=s[n][0]),e.bv_scf[t-2]=a,a=s[n][1];e.scalefac_band.l[a+e.bv_scf[t-2]+2]>t;)a--;a<0&&(a=s[n][1]),e.bv_scf[t-1]=a}}}function O(){}function y(){this.setModules=function(e,t,a){};var o=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];this.updateMusicCRC=function(e,t,a,n){for(var s=0;s<n;++s)e[0]=(r=t[a+s],i=(i=e[0])>>8^o[255&(i^r)]);var r,i}}function N(){var i=this,r=null,o=null;this.setModules=function(e,t,a,n){r=a,o=n};var _=null,l=0,f=0,c=0;function v(e,t,a){for(;0<a;){var n;0==c&&(c=8,f++,e.header[e.w_ptr].write_timing==l&&(s=e,I.arraycopy(s.header[s.w_ptr].buf,0,_,f,s.sideinfo_len),f+=s.sideinfo_len,l+=8*s.sideinfo_len,s.w_ptr=s.w_ptr+1&j.MAX_HEADER_BUF-1),_[f]=0),n=Math.min(a,c),a-=n,c-=n,_[f]|=t>>a<<c,l+=n}var s}function u(e,t){var a,n=e.internal_flags;if(8<=t&&(v(n,76,8),t-=8),8<=t&&(v(n,65,8),t-=8),8<=t&&(v(n,77,8),t-=8),8<=t&&(v(n,69,8),t-=8),32<=t){var s=r.getLameShortVersion();if(32<=t)for(a=0;a<s.length&&8<=t;++a)t-=8,v(n,s.charCodeAt(a),8)}for(;1<=t;t-=1)v(n,n.ancillary_flag,1),n.ancillary_flag^=e.disable_reservoir?0:1}function h(e,t,a){for(var n=e.header[e.h_ptr].ptr;0<a;){var s=Math.min(a,8-(7&n));a-=s,e.header[e.h_ptr].buf[n>>3]|=t>>a<<8-(7&n)-s,n+=s}e.header[e.h_ptr].ptr=n}function m(e,t){var a,n=k.ht[t.count1table_select+32],s=0,r=t.big_values,i=t.big_values;for(a=(t.count1-t.big_values)/4;0<a;--a){var o=0,_=0;0!=t.l3_enc[r+0]&&(_+=8,t.xr[i+0]<0&&o++),0!=t.l3_enc[r+1]&&(_+=4,o*=2,t.xr[i+1]<0&&o++),0!=t.l3_enc[r+2]&&(_+=2,o*=2,t.xr[i+2]<0&&o++),0!=t.l3_enc[r+3]&&(_++,o*=2,t.xr[i+3]<0&&o++),r+=4,i+=4,v(e,o+n.table[_],n.hlen[_]),s+=n.hlen[_]}return s}function b(e,t,a,n,s){var r=k.ht[t],i=0;if(0==t)return i;for(var o=a;o<n;o+=2){var _=0,l=0,f=r.xlen,c=r.xlen,u=0,h=s.l3_enc[o],b=s.l3_enc[o+1];if(0!=h&&(s.xr[o]<0&&u++,_--),15<t){if(14<h){var p=h-15;u|=p<<1,l=f,h=15}if(14<b){var m=b-15;u<<=f,u|=m,l+=f,b=15}c=16}0!=b&&(u<<=1,s.xr[o+1]<0&&u++,_--),h=h*c+b,l-=_,_+=r.hlen[h],v(e,r.table[h],_),v(e,u,l),i+=_+l}return i}function d(e,t){var a=3*e.scalefac_band.s[3];a>t.big_values&&(a=t.big_values);var n=b(e,t.table_select[0],0,a,t);return n+=b(e,t.table_select[1],a,t.big_values,t)}function g(e,t){var a,n,s,r;a=t.big_values;var i=t.region0_count+1;return s=e.scalefac_band.l[i],i+=t.region1_count+1,r=e.scalefac_band.l[i],a<s&&(s=a),a<r&&(r=a),n=b(e,t.table_select[0],0,s,t),n+=b(e,t.table_select[1],s,r,t),n+=b(e,t.table_select[2],r,a,t)}function p(){this.total=0}function S(e,t){var a,n,s,r=e.internal_flags;return r.w_ptr,-1==(s=r.h_ptr-1)&&(s=j.MAX_HEADER_BUF-1),a=r.header[s].write_timing-l,0<=(t.total=a)&&me(),n=i.getframebits(e),a+=n,t.total+=n,t.total%8!=0?t.total=1+t.total/8:t.total=t.total/8,t.total+=f+1,a}this.getframebits=function(e){var t,a=e.internal_flags;t=0!=a.bitrate_index?k.bitrate_table[e.version][a.bitrate_index]:e.brate;var n=0|72e3*(e.version+1)*t/e.out_samplerate+a.padding;return 8*n},this.flush_bitstream=function(e){var t,a,n=e.internal_flags,s=n.h_ptr-1;-1==s&&(s=j.MAX_HEADER_BUF-1),t=n.l3_side,(a=S(e,new p))<0||(u(e,a),n.ResvSize=0,t.main_data_begin=0,n.findReplayGain&&me(),n.findPeakSample&&me())},this.format_bitstream=function(e){var t,a=e.internal_flags;t=a.l3_side;var n=this.getframebits(e);u(e,t.resvDrain_pre),function(e,t){var a,n,s,r=e.internal_flags;if(a=r.l3_side,r.header[r.h_ptr].ptr=0,Se.fill(r.header[r.h_ptr].buf,0,r.sideinfo_len,0),e.out_samplerate<16e3?h(r,4094,12):h(r,4095,12),h(r,e.version,1),h(r,1,2),h(r,e.error_protection?0:1,1),h(r,r.bitrate_index,4),h(r,r.samplerate_index,2),h(r,r.padding,1),h(r,e.extension,1),h(r,e.mode.ordinal(),2),h(r,r.mode_ext,2),h(r,e.copyright,1),h(r,e.original,1),h(r,e.emphasis,2),e.error_protection&&h(r,0,16),1==e.version){for(h(r,a.main_data_begin,9),2==r.channels_out?h(r,a.private_bits,3):h(r,a.private_bits,5),s=0;s<r.channels_out;s++){var i;for(i=0;i<4;i++)h(r,a.scfsi[s][i],1)}for(n=0;n<2;n++)for(s=0;s<r.channels_out;s++){var o=a.tt[n][s];h(r,o.part2_3_length+o.part2_length,12),h(r,o.big_values/2,9),h(r,o.global_gain,8),h(r,o.scalefac_compress,4),o.block_type!=Ae.NORM_TYPE?(h(r,1,1),h(r,o.block_type,2),h(r,o.mixed_block_flag,1),14==o.table_select[0]&&(o.table_select[0]=16),h(r,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),h(r,o.table_select[1],5),h(r,o.subblock_gain[0],3),h(r,o.subblock_gain[1],3),h(r,o.subblock_gain[2],3)):(h(r,0,1),14==o.table_select[0]&&(o.table_select[0]=16),h(r,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),h(r,o.table_select[1],5),14==o.table_select[2]&&(o.table_select[2]=16),h(r,o.table_select[2],5),h(r,o.region0_count,4),h(r,o.region1_count,3)),h(r,o.preflag,1),h(r,o.scalefac_scale,1),h(r,o.count1table_select,1)}}else for(h(r,a.main_data_begin,8),h(r,a.private_bits,r.channels_out),s=n=0;s<r.channels_out;s++){var o=a.tt[n][s];h(r,o.part2_3_length+o.part2_length,12),h(r,o.big_values/2,9),h(r,o.global_gain,8),h(r,o.scalefac_compress,9),o.block_type!=Ae.NORM_TYPE?(h(r,1,1),h(r,o.block_type,2),h(r,o.mixed_block_flag,1),14==o.table_select[0]&&(o.table_select[0]=16),h(r,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),h(r,o.table_select[1],5),h(r,o.subblock_gain[0],3),h(r,o.subblock_gain[1],3),h(r,o.subblock_gain[2],3)):(h(r,0,1),14==o.table_select[0]&&(o.table_select[0]=16),h(r,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),h(r,o.table_select[1],5),14==o.table_select[2]&&(o.table_select[2]=16),h(r,o.table_select[2],5),h(r,o.region0_count,4),h(r,o.region1_count,3)),h(r,o.scalefac_scale,1),h(r,o.count1table_select,1)}e.error_protection&&me();var _=r.h_ptr;r.h_ptr=_+1&j.MAX_HEADER_BUF-1,r.header[r.h_ptr].write_timing=r.header[_].write_timing+t,r.h_ptr,r.w_ptr}(e,n);var s=8*a.sideinfo_len;if(s+=function(e){var t,a,n,s,r=0,i=e.internal_flags,o=i.l3_side;if(1==e.version)for(t=0;t<2;t++)for(a=0;a<i.channels_out;a++){var _=o.tt[t][a],l=A.slen1_tab[_.scalefac_compress],f=A.slen2_tab[_.scalefac_compress];for(n=s=0;n<_.sfbdivide;n++)-1!=_.scalefac[n]&&(v(i,_.scalefac[n],l),s+=l);for(;n<_.sfbmax;n++)-1!=_.scalefac[n]&&(v(i,_.scalefac[n],f),s+=f);_.block_type==Ae.SHORT_TYPE?s+=d(i,_):s+=g(i,_),s+=m(i,_),r+=s}else for(a=t=0;a<i.channels_out;a++){var c,u,_=o.tt[t][a],h=0;if(u=n=s=0,_.block_type==Ae.SHORT_TYPE){for(;u<4;u++){var b=_.sfb_partition_table[u]/3,p=_.slen[u];for(c=0;c<b;c++,n++)v(i,Math.max(_.scalefac[3*n+0],0),p),v(i,Math.max(_.scalefac[3*n+1],0),p),v(i,Math.max(_.scalefac[3*n+2],0),p),h+=3*p}s+=d(i,_)}else{for(;u<4;u++){var b=_.sfb_partition_table[u],p=_.slen[u];for(c=0;c<b;c++,n++)v(i,Math.max(_.scalefac[n],0),p),h+=p}s+=g(i,_)}s+=m(i,_),r+=h+s}return r}(e),u(e,t.resvDrain_post),s+=t.resvDrain_post,t.main_data_begin+=(n-s)/8,S(e,new p),a.ResvSize,8*t.main_data_begin!=a.ResvSize&&(a.ResvSize=8*t.main_data_begin),1e9<l){var r;for(r=0;r<j.MAX_HEADER_BUF;++r)a.header[r].write_timing-=l;l=0}return 0},this.copy_buffer=function(e,t,a,n,s){var r=f+1;if(r<=0)return 0;if(0!=n&&n<r)return-1;if(I.arraycopy(_,0,t,a,r),f=-1,(c=0)!=s){var i=ve(1);i[0]=e.nMusicCRC,o.updateMusicCRC(i,t,a,r),e.nMusicCRC=i[0],0<r&&(e.VBR_seek_table.nBytesWritten+=r),e.decode_on_the_fly&&me()}return r},this.init_bit_stream_w=function(e){_=w(Y.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,f=-1,l=c=0}}function e(e,t,a,n){this.xlen=e,this.linmax=t,this.table=a,this.hlen=n}D.MAX_VALUE=3.4028235e38,Me.vbr_off=new Me(0),Me.vbr_mt=new Me(1),Me.vbr_rh=new Me(2),Me.vbr_abr=new Me(3),Me.vbr_mtrh=new Me(4),Me.vbr_default=Me.vbr_mtrh,ye.STEREO=new ye(0),ye.JOINT_STEREO=new ye(1),ye.DUAL_CHANNEL=new ye(2),ye.MONO=new ye(3),ye.NOT_SET=new ye(4),O.STEPS_per_dB=100,O.MAX_dB=120,O.GAIN_NOT_ENOUGH_SAMPLES=-24601,O.GAIN_ANALYSIS_ERROR=0,O.GAIN_ANALYSIS_OK=1,O.INIT_GAIN_ANALYSIS_ERROR=0,O.INIT_GAIN_ANALYSIS_OK=1,O.MAX_ORDER=O.YULE_ORDER=10,O.MAX_SAMPLES_PER_WINDOW=(O.MAX_SAMP_FREQ=48e3)*(O.RMS_WINDOW_TIME_NUMERATOR=1)/(O.RMS_WINDOW_TIME_DENOMINATOR=20)+1,y.NUMTOCENTRIES=100,y.MAXFRAMESIZE=2880,N.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},N.NEQ=function(e,t){return!N.EQ(e,t)};var k={};function R(e){this.bits=e}function x(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}function r(e,t,a,n){this.l=ve(1+Ae.SBMAX_l),this.s=ve(1+Ae.SBMAX_s),this.psfb21=ve(1+Ae.PSFB21),this.psfb12=ve(1+Ae.PSFB12);var s=this.l,r=this.s;4==arguments.length&&(this.arrL=e,this.arrS=t,this.arr21=a,this.arr12=n,I.arraycopy(this.arrL,0,s,0,Math.min(this.arrL.length,this.l.length)),I.arraycopy(this.arrS,0,r,0,Math.min(this.arrS.length,this.s.length)),I.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),I.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}function T(){var l=null,b=null,n=null;this.setModules=function(e,t,a){l=e,b=t,n=a},this.IPOW20=function(e){return h[e]};var B=2.220446049250313e-16,e=T.IXMAX_VAL,f=e+2,c=T.Q_MAX,u=T.Q_MAX2,s=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var M=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=M,this.sfBandIndex=[new r([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new r([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new r([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new r([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new r([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new r([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new r([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new r([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new r([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var y=de(c+u+1),h=de(c),p=de(f),m=de(f);function v(e,t){var a=n.ATHformula(t,e);return a-=s,a=Math.pow(10,a/10+e.ATHlower)}function A(e){this.s=e}this.adj43=m,this.iteration_init=function(e){var t,a=e.internal_flags,n=a.l3_side;if(0==a.iteration_init_init){for(a.iteration_init_init=1,n.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,a=e.internal_flags.ATH.psfb21,n=e.internal_flags.ATH.s,s=e.internal_flags.ATH.psfb12,r=e.internal_flags,i=e.out_samplerate,o=0;o<Ae.SBMAX_l;o++){var _=r.scalefac_band.l[o],l=r.scalefac_band.l[o+1];t[o]=D.MAX_VALUE;for(var f=_;f<l;f++){var c=f*i/1152,u=v(e,c);t[o]=Math.min(t[o],u)}}for(var o=0;o<Ae.PSFB21;o++){var _=r.scalefac_band.psfb21[o],l=r.scalefac_band.psfb21[o+1];a[o]=D.MAX_VALUE;for(var f=_;f<l;f++){var c=f*i/1152,u=v(e,c);a[o]=Math.min(a[o],u)}}for(var o=0;o<Ae.SBMAX_s;o++){var _=r.scalefac_band.s[o],l=r.scalefac_band.s[o+1];n[o]=D.MAX_VALUE;for(var f=_;f<l;f++){var c=f*i/384,u=v(e,c);n[o]=Math.min(n[o],u)}n[o]*=r.scalefac_band.s[o+1]-r.scalefac_band.s[o]}for(var o=0;o<Ae.PSFB12;o++){var _=r.scalefac_band.psfb12[o],l=r.scalefac_band.psfb12[o+1];s[o]=D.MAX_VALUE;for(var f=_;f<l;f++){var c=f*i/384,u=v(e,c);s[o]=Math.min(s[o],u)}s[o]*=r.scalefac_band.s[13]-r.scalefac_band.s[12]}e.noATH&&me(),r.ATH.floor=10*d(v(e,-1))}(e),p[0]=0,t=1;t<f;t++)p[t]=Math.pow(t,4/3);for(t=0;t<f-1;t++)m[t]=t+1-Math.pow(.5*(p[t]+p[t+1]),.75);for(m[t]=.5,t=0;t<c;t++)h[t]=Math.pow(2,-.1875*(t-210));for(t=0;t<=c+u;t++)y[t]=Math.pow(2,.25*(t-210-u));var s,r,i,o;for(l.huffman_init(a),32<=(t=e.exp_nspsytune>>2&63)&&(t-=64),s=Math.pow(10,t/4/10),32<=(t=e.exp_nspsytune>>8&63)&&(t-=64),r=Math.pow(10,t/4/10),32<=(t=e.exp_nspsytune>>14&63)&&(t-=64),i=Math.pow(10,t/4/10),32<=(t=e.exp_nspsytune>>20&63)&&(t-=64),o=i*Math.pow(10,t/4/10),t=0;t<Ae.SBMAX_l;t++)_=t<=6?s:t<=13?r:t<=20?i:o,a.nsPsy.longfact[t]=_;for(t=0;t<Ae.SBMAX_s;t++){var _;_=t<=5?s:t<=10?r:t<=11?i:o,a.nsPsy.shortfact[t]=_}}},this.on_pe=function(e,t,a,n,s,r){var i,o,_=e.internal_flags,l=0,f=ve(2),c=new R(l),u=b.ResvMaxBits(e,n,c,r),h=(l=c.bits)+u;for(j.MAX_BITS_PER_GRANULE<h&&(h=j.MAX_BITS_PER_GRANULE),o=i=0;o<_.channels_out;++o)a[o]=Math.min(j.MAX_BITS_PER_CHANNEL,l/_.channels_out),f[o]=0|a[o]*t[s][o]/700-a[o],f[o]>3*n/4&&(f[o]=3*n/4),f[o]<0&&(f[o]=0),f[o]+a[o]>j.MAX_BITS_PER_CHANNEL&&(f[o]=Math.max(0,j.MAX_BITS_PER_CHANNEL-a[o])),i+=f[o];if(u<i)for(o=0;o<_.channels_out;++o)f[o]=u*f[o]/i;for(o=0;o<_.channels_out;++o)a[o]+=f[o],u-=f[o];for(o=i=0;o<_.channels_out;++o)i+=a[o];return j.MAX_BITS_PER_GRANULE<i&&me(),h},this.athAdjust=function(e,t,a){var n=90.30873362,s=V.FAST_LOG10_X(t,10),r=e*e,i=0;return s-=a,1e-20<r&&(i=1+V.FAST_LOG10_X(r,10/n)),i<0&&(i=0),s*=i,s+=a+n-94.82444863,Math.pow(10,.1*s)},this.calc_xmin=function(e,t,a,n){var s,r=0,i=e.internal_flags,o=0,_=0,l=i.ATH,f=a.xr,c=e.VBR==Me.vbr_mtrh?1:0,u=i.masking_lower;for(e.VBR!=Me.vbr_mtrh&&e.VBR!=Me.vbr_mt||(u=1),s=0;s<a.psy_lmax;s++){for(S=e.VBR==Me.vbr_rh||e.VBR==Me.vbr_mtrh?athAdjust(l.adjust,l.l[s],l.floor):l.adjust*l.l[s],v=a.width[s],w=S/v,M=B,A=v>>1,y=0;k=f[o]*f[o],y+=k,M+=k<w?k:w,R=f[++o]*f[o],y+=R,M+=R<w?R:w,o++,0<--A;);if(S<y&&_++,s==Ae.SBPSY_l&&me(),0!=c&&(S=M),!e.ATHonly){var h=t.en.l[s];0<h&&(x=y*t.thm.l[s]*u/h,0!=c&&(x*=i.nsPsy.longfact[s]),S<x&&(S=x))}n[r++]=0!=c?S:S*i.nsPsy.longfact[s]}var b=575;if(a.block_type!=Ae.SHORT_TYPE)for(var p=576;0!=p--&&N.EQ(f[p],0);)b=p;a.max_nonzero_coeff=b;for(var m=a.sfb_smin;s<a.psymax;m++,s+=3){var v,d,g;for(g=e.VBR==Me.vbr_rh||e.VBR==Me.vbr_mtrh?athAdjust(l.adjust,l.s[m],l.floor):l.adjust*l.s[m],v=a.width[s],d=0;d<3;d++){var S,w,M,y=0,A=v>>1;w=g/v,M=B;do{var k,R;k=f[o]*f[o],y+=k,M+=k<w?k:w,R=f[++o]*f[o],y+=R,M+=R<w?R:w,o++}while(0<--A);if(g<y&&_++,m==Ae.SBPSY_s&&me(),S=0!=c?M:g,!e.ATHonly&&!e.ATHshort){var x,h=t.en.s[m][d];0<h&&(x=y*t.thm.s[m][d]*u/h,0!=c&&(x*=i.nsPsy.shortfact[m]),S<x&&(S=x))}n[r++]=0!=c?S:S*i.nsPsy.shortfact[m]}e.useTemporal&&(n[r-3]>n[r-3+1]&&(n[r-3+1]+=(n[r-3]-n[r-3+1])*i.decay),n[r-3+1]>n[r-3+2]&&(n[r-3+2]+=(n[r-3+1]-n[r-3+2])*i.decay))}return _},this.calc_noise_core=function(e,t,a,n){var s=0,r=t.s,i=e.l3_enc;if(r>e.count1)for(;0!=a--;)_=e.xr[r],r++,s+=_*_,_=e.xr[r],r++,s+=_*_;else if(r>e.big_values){var o=de(2);for(o[0]=0,o[1]=n;0!=a--;)_=Math.abs(e.xr[r])-o[i[r]],r++,s+=_*_,_=Math.abs(e.xr[r])-o[i[r]],r++,s+=_*_}else for(;0!=a--;){var _;_=Math.abs(e.xr[r])-p[i[r]]*n,r++,s+=_*_,_=Math.abs(e.xr[r])-p[i[r]]*n,r++,s+=_*_}return t.s=r,s},this.calc_noise=function(e,t,a,n,s){var r,i,o=0,_=0,l=0,f=0,c=0,u=-20,h=0,b=e.scalefac,p=0;for(n.over_SSD=0,r=0;r<e.psymax;r++){var m,v=e.global_gain-(b[p++]+(0!=e.preflag?M[r]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[r]],d=0;if(null!=s&&s.step[r]==v)d=s.noise[r],h+=e.width[r],a[o++]=d/t[_++],d=s.noise_log[r];else{var g,S=y[v+T.Q_MAX2];i=e.width[r]>>1,h+e.width[r]>e.max_nonzero_coeff&&(g=e.max_nonzero_coeff-h+1,i=0<g?g>>1:0);var w=new A(h);d=this.calc_noise_core(e,w,i,S),h=w.s,null!=s&&(s.step[r]=v,s.noise[r]=d),d=a[o++]=d/t[_++],d=V.FAST_LOG10(Math.max(d,1e-20)),null!=s&&(s.noise_log[r]=d)}null!=s&&(s.global_gain=e.global_gain),c+=d,0<d&&(m=Math.max(0|10*d+.5,1),n.over_SSD+=m*m,l++,f+=d),u=Math.max(u,d)}return n.over_count=l,n.tot_noise=c,n.over_noise=f,n.max_noise=u,l}}function B(){this.xr=de(576),this.l3_enc=ve(576),this.scalefac=ve(F.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=ve(3),this.subblock_gain=ve(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=ve(F.SFBMAX),this.window=ve(F.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=ve(4),this.max_nonzero_coeff=0;var a=this;function n(e){return new Int32Array(e)}this.assign=function(e){var t;a.xr=(t=e.xr,new Float32Array(t)),a.l3_enc=n(e.l3_enc),a.scalefac=n(e.scalefac),a.xrpow_max=e.xrpow_max,a.part2_3_length=e.part2_3_length,a.big_values=e.big_values,a.count1=e.count1,a.global_gain=e.global_gain,a.scalefac_compress=e.scalefac_compress,a.block_type=e.block_type,a.mixed_block_flag=e.mixed_block_flag,a.table_select=n(e.table_select),a.subblock_gain=n(e.subblock_gain),a.region0_count=e.region0_count,a.region1_count=e.region1_count,a.preflag=e.preflag,a.scalefac_scale=e.scalefac_scale,a.count1table_select=e.count1table_select,a.part2_length=e.part2_length,a.sfb_lmax=e.sfb_lmax,a.sfb_smin=e.sfb_smin,a.psy_lmax=e.psy_lmax,a.sfbmax=e.sfbmax,a.psymax=e.psymax,a.sfbdivide=e.sfbdivide,a.width=n(e.width),a.window=n(e.window),a.count1bits=e.count1bits,a.sfb_partition_table=e.sfb_partition_table.slice(0),a.slen=n(e.slen),a.max_nonzero_coeff=e.max_nonzero_coeff}}k.t1HB=[1,1,1,0],k.t2HB=[1,2,1,3,1,1,3,2,0],k.t3HB=[3,2,1,1,1,1,3,2,0],k.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],k.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],k.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],k.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],k.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],k.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],k.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],k.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],k.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],k.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],k.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],k.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],k.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],k.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],k.t1l=[1,4,3,5],k.t2l=[1,4,7,4,5,7,6,7,8],k.t3l=[2,3,7,4,4,7,6,7,8],k.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],k.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],k.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],k.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],k.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],k.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],k.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],k.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],k.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],k.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],k.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],k.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],k.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],k.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],k.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],k.ht=[new e(0,0,null,null),new e(2,0,k.t1HB,k.t1l),new e(3,0,k.t2HB,k.t2l),new e(3,0,k.t3HB,k.t3l),new e(0,0,null,null),new e(4,0,k.t5HB,k.t5l),new e(4,0,k.t6HB,k.t6l),new e(6,0,k.t7HB,k.t7l),new e(6,0,k.t8HB,k.t8l),new e(6,0,k.t9HB,k.t9l),new e(8,0,k.t10HB,k.t10l),new e(8,0,k.t11HB,k.t11l),new e(8,0,k.t12HB,k.t12l),new e(16,0,k.t13HB,k.t13l),new e(0,0,null,k.t16_5l),new e(16,0,k.t15HB,k.t15l),new e(1,1,k.t16HB,k.t16l),new e(2,3,k.t16HB,k.t16l),new e(3,7,k.t16HB,k.t16l),new e(4,15,k.t16HB,k.t16l),new e(6,63,k.t16HB,k.t16l),new e(8,255,k.t16HB,k.t16l),new e(10,1023,k.t16HB,k.t16l),new e(13,8191,k.t16HB,k.t16l),new e(4,15,k.t24HB,k.t24l),new e(5,31,k.t24HB,k.t24l),new e(6,63,k.t24HB,k.t24l),new e(7,127,k.t24HB,k.t24l),new e(8,255,k.t24HB,k.t24l),new e(9,511,k.t24HB,k.t24l),new e(11,2047,k.t24HB,k.t24l),new e(13,8191,k.t24HB,k.t24l),new e(0,0,k.t32HB,k.t32l),new e(0,0,k.t33HB,k.t33l)],k.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],k.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],k.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],k.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],k.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],k.scfsi_band=[0,6,11,16,21],T.Q_MAX=257,T.Q_MAX2=116,T.LARGE_BITS=1e5,T.IXMAX_VAL=8206;var F={};function C(){var r,g;this.rv=null,this.qupvt=null;var S,s=new function(){this.setModules=function(e,t){}};function w(e){this.ordinal=e}function o(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function M(e,t,a,n,s){var r;switch(e){default:case 9:0<t.over_count?(r=a.over_SSD<=t.over_SSD,a.over_SSD==t.over_SSD&&(r=a.bits<t.bits)):r=a.max_noise<0&&10*a.max_noise+a.bits<=10*t.max_noise+t.bits;break;case 0:r=a.over_count<t.over_count||a.over_count==t.over_count&&a.over_noise<t.over_noise||a.over_count==t.over_count&&N.EQ(a.over_noise,t.over_noise)&&a.tot_noise<t.tot_noise;break;case 8:me();case 1:r=a.max_noise<t.max_noise;break;case 2:r=a.tot_noise<t.tot_noise;break;case 3:r=a.tot_noise<t.tot_noise&&a.max_noise<t.max_noise;break;case 4:r=a.max_noise<=0&&.2<t.max_noise||a.max_noise<=0&&t.max_noise<0&&t.max_noise>a.max_noise-.2&&a.tot_noise<t.tot_noise||a.max_noise<=0&&0<t.max_noise&&t.max_noise>a.max_noise-.2&&a.tot_noise<t.tot_noise+t.over_noise||0<a.max_noise&&-.05<t.max_noise&&t.max_noise>a.max_noise-.1&&a.tot_noise+a.over_noise<t.tot_noise+t.over_noise||0<a.max_noise&&-.1<t.max_noise&&t.max_noise>a.max_noise-.15&&a.tot_noise+a.over_noise+a.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:r=a.over_noise<t.over_noise||N.EQ(a.over_noise,t.over_noise)&&a.tot_noise<t.tot_noise;break;case 6:r=a.over_noise<t.over_noise||N.EQ(a.over_noise,t.over_noise)&&(a.max_noise<t.max_noise||N.EQ(a.max_noise,t.max_noise)&&a.tot_noise<=t.tot_noise);break;case 7:r=a.over_count<t.over_count||a.over_noise<t.over_noise}return 0==t.over_count&&(r=r&&a.bits<t.bits),r}function y(e,t,a,n,s){var r=e.internal_flags;!function(e,t,a,n,s){var r,i=e.internal_flags;r=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,_=0;_<t.sfbmax;_++)o<a[_]&&(o=a[_]);var l=i.noise_shaping_amp;switch(3==l&&me(),l){case 2:break;case 1:1<o?o=Math.pow(o,.5):o*=.95;break;case 0:default:1<o?o=1:o*=.95}for(var f=0,_=0;_<t.sfbmax;_++){var c,u=t.width[_];if(f+=u,!(a[_]<o)){for(0!=(2&i.substep_shaping)&&me(),t.scalefac[_]++,c=-u;c<0;c++)n[f+c]*=r,n[f+c]>t.xrpow_max&&(t.xrpow_max=n[f+c]);if(2==i.noise_shaping_amp)return}}}(e,t,a,n);var i=o(t);return!(i||(i=2==r.mode_gr?S.scale_bitcount(t):S.scale_bitcount_lsf(r,t))&&(1<r.noise_shaping&&(Se.fill(r.pseudohalf,0),0==t.scalefac_scale?(function(e,t){for(var a=0,n=0;n<e.sfbmax;n++){var s=e.width[n],r=e.scalefac[n];if(0!=e.preflag&&(r+=g.pretab[n]),a+=s,0!=(1&r)){r++;for(var i=-s;i<0;i++)t[a+i]*=1.2968395546510096,t[a+i]>e.xrpow_max&&(e.xrpow_max=t[a+i])}e.scalefac[n]=r>>1}e.preflag=0,e.scalefac_scale=1}(t,n),i=!1):t.block_type==Ae.SHORT_TYPE&&0<r.subblock_gain&&(i=function(e,t,a){var n,s=t.scalefac;for(n=0;n<t.sfb_lmax;n++)if(16<=s[n])return!0;for(var r=0;r<3;r++){var i=0,o=0;for(n=t.sfb_lmax+r;n<t.sfbdivide;n+=3)i<s[n]&&(i=s[n]);for(;n<t.sfbmax;n+=3)o<s[n]&&(o=s[n]);if(!(i<16&&o<8)){if(7<=t.subblock_gain[r])return!0;t.subblock_gain[r]++;var _=e.scalefac_band.l[t.sfb_lmax];for(n=t.sfb_lmax+r;n<t.sfbmax;n+=3){var l=t.width[n],f=s[n];if(0<=(f-=4>>t.scalefac_scale))s[n]=f,_+=3*l;else{s[n]=0;var c=210+(f<<t.scalefac_scale+1);h=g.IPOW20(c),_+=l*(r+1);for(var u=-l;u<0;u++)a[_+u]*=h,a[_+u]>t.xrpow_max&&(t.xrpow_max=a[_+u]);_+=l*(3-r-1)}}var h=g.IPOW20(202);_+=t.width[n]*(r+1);for(var u=-t.width[n];u<0;u++)a[_+u]*=h,a[_+u]>t.xrpow_max&&(t.xrpow_max=a[_+u])}}return!1}(r,t,n)||o(t))),i||(i=2==r.mode_gr?S.scale_bitcount(t):S.scale_bitcount_lsf(r,t)),i))}this.setModules=function(e,t,a,n){r=t,this.rv=t,g=a,this.qupvt=a,S=n,s.setModules(g,S)},this.init_xrpow=function(e,t,a){var n=0,s=0|t.max_nonzero_coeff;if(t.xrpow_max=0,Se.fill(a,s,576,0),1e-20<(n=function(e,t,a,n){for(var s=n=0;s<=a;++s){var r=Math.abs(e.xr[s]);n+=r,t[s]=Math.sqrt(r*Math.sqrt(r)),t[s]>e.xrpow_max&&(e.xrpow_max=t[s])}return n}(t,a,s,n))){var r=0;0!=(2&e.substep_shaping)&&(r=1);for(var i=0;i<t.psymax;i++)e.pseudohalf[i]=r;return!0}return Se.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=Ae.SBPSY_l,t.sfb_smin=Ae.SBPSY_s,t.psy_lmax=e.sfb21_extra?Ae.SBMAX_l:Ae.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var a=0;a<Ae.SBMAX_l;a++)t.width[a]=e.scalefac_band.l[a+1]-e.scalefac_band.l[a],t.window[a]=3;if(t.block_type==Ae.SHORT_TYPE){var n=de(576);t.sfb_smin=0,(t.sfb_lmax=0)!=t.mixed_block_flag&&me(),t.psymax=t.sfb_lmax+3*((e.sfb21_extra?Ae.SBMAX_s:Ae.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(Ae.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var s=e.scalefac_band.l[t.sfb_lmax];I.arraycopy(t.xr,0,n,0,576);for(var a=t.sfb_smin;a<Ae.SBMAX_s;a++)for(var r=e.scalefac_band.s[a],i=e.scalefac_band.s[a+1],o=0;o<3;o++)for(var _=r;_<i;_++)t.xr[s++]=n[3*_+o];for(var l=t.sfb_lmax,a=t.sfb_smin;a<Ae.SBMAX_s;a++)t.width[l]=t.width[l+1]=t.width[l+2]=e.scalefac_band.s[a+1]-e.scalefac_band.s[a],t.window[l]=0,t.window[l+1]=1,t.window[l+2]=2,l+=3}t.count1bits=0,t.sfb_partition_table=g.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,Se.fill(t.scalefac,0),function(e,t){var a=e.ATH,n=t.xr;if(t.block_type!=Ae.SHORT_TYPE)for(var s=!1,r=Ae.PSFB21-1;0<=r&&!s;r--){var i=e.scalefac_band.psfb21[r],o=e.scalefac_band.psfb21[r+1],_=g.athAdjust(a.adjust,a.psfb21[r],a.floor);1e-12<e.nsPsy.longfact[21]&&(_*=e.nsPsy.longfact[21]);for(var l=o-1;i<=l;l--){if(!(Math.abs(n[l])<_)){s=!0;break}n[l]=0}}else for(var f=0;f<3;f++)for(var s=!1,r=Ae.PSFB12-1;0<=r&&!s;r--){var i=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*f+(e.scalefac_band.psfb12[r]-e.scalefac_band.psfb12[0]),o=i+(e.scalefac_band.psfb12[r+1]-e.scalefac_band.psfb12[r]),c=g.athAdjust(a.adjust,a.psfb12[r],a.floor);1e-12<e.nsPsy.shortfact[12]&&(c*=e.nsPsy.shortfact[12]);for(var l=o-1;i<=l;l--){if(!(Math.abs(n[l])<c)){s=!0;break}n[l]=0}}}(e,t)},w.BINSEARCH_NONE=new w(0),w.BINSEARCH_UP=new w(1),w.BINSEARCH_DOWN=new w(2),this.outer_loop=function(e,t,a,n,s,r){var i=e.internal_flags,o=new B,_=de(576),l=de(F.SFBMAX),f=new x,c=new function(){this.global_gain=0,this.sfb_count1=0,this.step=ve(39),this.noise=de(39),this.noise_log=de(39)},u=9999999,h=!1;if(function(e,t,a,n,s){var r,i=e.CurrentStep[n],o=!1,_=e.OldValue[n],l=w.BINSEARCH_NONE;for(t.global_gain=_,a-=t.part2_length;;){var f;if(r=S.count_bits(e,s,t,null),1==i||r==a)break;a<r?(l==w.BINSEARCH_DOWN&&(o=!0),o&&(i/=2),l=w.BINSEARCH_UP,f=i):(l==w.BINSEARCH_UP&&(o=!0),o&&(i/=2),l=w.BINSEARCH_DOWN,f=-i),t.global_gain+=f,t.global_gain<0&&me(),255<t.global_gain&&me()}for(;a<r&&t.global_gain<255;)t.global_gain++,r=S.count_bits(e,s,t,null);e.CurrentStep[n]=4<=_-t.global_gain?4:2,e.OldValue[n]=t.global_gain,t.part2_3_length=r}(i,t,r,s,n),0==i.noise_shaping)return 100;g.calc_noise(t,a,l,f,c),f.bits=t.part2_3_length,o.assign(t);var b=0;for(I.arraycopy(n,0,_,0,576);!h;){do{var p,m=new x,v=255;if(p=0!=(2&i.substep_shaping)?20:3,i.sfb21_extra&&me(),!y(e,o,l,n))break;0!=o.scalefac_scale&&(v=254);var d=r-o.part2_length;if(d<=0)break;for(;(o.part2_3_length=S.count_bits(i,n,o,c))>d&&o.global_gain<=v;)o.global_gain++;if(o.global_gain>v)break;if(0==f.over_count){for(;(o.part2_3_length=S.count_bits(i,n,o,c))>u&&o.global_gain<=v;)o.global_gain++;if(o.global_gain>v)break}if(g.calc_noise(o,a,l,m,c),m.bits=o.part2_3_length,0!=(M(t.block_type!=Ae.SHORT_TYPE?e.quant_comp:e.quant_comp_short,f,m)?1:0))u=t.part2_3_length,f=m,t.assign(o),b=0,I.arraycopy(n,0,_,0,576);else if(0==i.full_outer_loop){if(++b>p&&0==f.over_count)break;i.noise_shaping_amp,i.noise_shaping_amp}}while(o.global_gain+o.scalefac_scale<255);3==i.noise_shaping_amp?me():h=!0}return e.VBR==Me.vbr_rh||e.VBR==Me.vbr_mtrh?I.arraycopy(_,0,n,0,576):0!=(1&i.substep_shaping)&&me(),f.over_count},this.iteration_finish_one=function(e,t,a){var n=e.l3_side,s=n.tt[t][a];S.best_scalefac_store(e,t,a,n),1==e.use_best_huffman&&S.best_huffman_divide(e,s),r.ResvAdjust(e,s)}}function L(){this.thm=new i,this.en=new i}function Ae(){var k=Ae.MPG_MD_MS_LR,R=null,x=this.psy=null,B=null;this.setModules=function(e,t,a,n){R=e,this.psy=t,x=t,B=n};var T=new function(){var u=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*V.SQRT2*.5/2384e-9,.017876148*V.SQRT2*.5/2384e-9,.003134727*V.SQRT2*.5/2384e-9,.002457142*V.SQRT2*.5/2384e-9,971317e-9*V.SQRT2*.5/2384e-9,218868e-9*V.SQRT2*.5/2384e-9,101566e-9*V.SQRT2*.5/2384e-9,13828e-9*V.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,49591e-9/2384e-9,1995.1556208053692,21458e-9/2384e-9,-69618e-9/2384e-9],A=[[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.40084909404969e-13,6.423305872147839e-13,2.382191739347918e-13,5.456116108943412e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758252e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558783e-12,8.371015190102974e-13,2.599706096327376e-13,-5.456116108943412e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758252e-12,-2.858043359288076e-12,-2.156177623817898e-12,-1.475637723558783e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347923e-13,-6.423305872147843e-13,-9.400849094049696e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049694e-13,-6.42330587214784e-13,-2.382191739347918e-13],[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.400849094049688e-13,6.423305872147841e-13,2.382191739347918e-13,5.456116108943413e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758253e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558782e-12,8.371015190102975e-13,2.599706096327376e-13,-5.461314069809755e-12,-4.921085770524055e-12,-4.343405037091838e-12,-3.732668368707687e-12,-3.093523840190885e-12,-2.430835727329465e-12,-1.734679010007751e-12,-9.74825365660928e-13,-2.797435120168326e-13,0,0,0,0,0,0,-2.283748241799531e-13,-4.037858874020686e-13,-2.146547464825323e-13],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2.283748241799531e-13,4.037858874020686e-13,2.146547464825323e-13,5.461314069809755e-12,4.921085770524055e-12,4.343405037091838e-12,3.732668368707687e-12,3.093523840190885e-12,2.430835727329466e-12,1.734679010007751e-12,9.74825365660928e-13,2.797435120168326e-13,-5.456116108943413e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758253e-12,-2.858043359288075e-12,-2.156177623817898e-12,-1.475637723558782e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347913e-13,-6.423305872147834e-13,-9.400849094049688e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049688e-13,-6.423305872147841e-13,-2.382191739347918e-13]],k=A[Ae.SHORT_TYPE],w=A[Ae.SHORT_TYPE],R=A[Ae.SHORT_TYPE],x=A[Ae.SHORT_TYPE],B=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function T(e,t,a){for(var n,s,r,i=10,o=t+238-14-286,_=-15;_<0;_++){var l,f,c;l=u[i+-10],f=e[o+-224]*l,c=e[t+224]*l,l=u[i+-9],f+=e[o+-160]*l,c+=e[t+160]*l,l=u[i+-8],f+=e[o+-96]*l,c+=e[t+96]*l,l=u[i+-7],f+=e[o+-32]*l,c+=e[t+32]*l,l=u[i+-6],f+=e[o+32]*l,c+=e[t+-32]*l,l=u[i+-5],f+=e[o+96]*l,c+=e[t+-96]*l,l=u[i+-4],f+=e[o+160]*l,c+=e[t+-160]*l,l=u[i+-3],f+=e[o+224]*l,c+=e[t+-224]*l,l=u[i+-2],f+=e[t+-256]*l,c-=e[o+256]*l,l=u[i+-1],f+=e[t+-192]*l,c-=e[o+192]*l,l=u[i+0],f+=e[t+-128]*l,c-=e[o+128]*l,l=u[i+1],f+=e[t+-64]*l,c-=e[o+64]*l,l=u[i+2],f+=e[t+0]*l,c-=e[o+0]*l,l=u[i+3],f+=e[t+64]*l,c-=e[o+-64]*l,l=u[i+4],f+=e[t+128]*l,c-=e[o+-128]*l,l=u[i+5],f+=e[t+192]*l,c-=e[o+-192]*l,f*=u[i+6],l=c-f,a[30+2*_]=c+f,a[31+2*_]=u[i+7]*l,i+=18,t--,o++}c=e[t+-16]*u[i+-10],f=e[t+-32]*u[i+-2],c+=(e[t+-48]-e[t+16])*u[i+-9],f+=e[t+-96]*u[i+-1],c+=(e[t+-80]+e[t+48])*u[i+-8],f+=e[t+-160]*u[i+0],c+=(e[t+-112]-e[t+80])*u[i+-7],f+=e[t+-224]*u[i+1],c+=(e[t+-144]+e[t+112])*u[i+-6],f-=e[t+32]*u[i+2],c+=(e[t+-176]-e[t+144])*u[i+-5],f-=e[t+96]*u[i+3],c+=(e[t+-208]+e[t+176])*u[i+-4],f-=e[t+160]*u[i+4],c+=(e[t+-240]-e[t+208])*u[i+-3],f-=e[t+224],n=f-c,s=f+c,c=a[14],f=a[15]-c,a[31]=s+c,a[30]=n+f,a[15]=n-f,a[14]=s-c,r=a[28]-a[0],a[0]+=a[28],a[28]=r*u[i+-36+7],r=a[29]-a[1],a[1]+=a[29],a[29]=r*u[i+-36+7],r=a[26]-a[2],a[2]+=a[26],a[26]=r*u[i+-72+7],r=a[27]-a[3],a[3]+=a[27],a[27]=r*u[i+-72+7],r=a[24]-a[4],a[4]+=a[24],a[24]=r*u[i+-108+7],r=a[25]-a[5],a[5]+=a[25],a[25]=r*u[i+-108+7],r=a[22]-a[6],a[6]+=a[22],a[22]=r*V.SQRT2,r=a[23]-a[7],a[7]+=a[23],a[23]=r*V.SQRT2-a[7],a[7]-=a[6],a[22]-=a[7],a[23]-=a[22],r=a[6],a[6]=a[31]-r,a[31]=a[31]+r,r=a[7],a[7]=a[30]-r,a[30]=a[30]+r,r=a[22],a[22]=a[15]-r,a[15]=a[15]+r,r=a[23],a[23]=a[14]-r,a[14]=a[14]+r,r=a[20]-a[8],a[8]+=a[20],a[20]=r*u[i+-180+7],r=a[21]-a[9],a[9]+=a[21],a[21]=r*u[i+-180+7],r=a[18]-a[10],a[10]+=a[18],a[18]=r*u[i+-216+7],r=a[19]-a[11],a[11]+=a[19],a[19]=r*u[i+-216+7],r=a[16]-a[12],a[12]+=a[16],a[16]=r*u[i+-252+7],r=a[17]-a[13],a[13]+=a[17],a[17]=r*u[i+-252+7],r=-a[20]+a[24],a[20]+=a[24],a[24]=r*u[i+-216+7],r=-a[21]+a[25],a[21]+=a[25],a[25]=r*u[i+-216+7],r=a[4]-a[8],a[4]+=a[8],a[8]=r*u[i+-216+7],r=a[5]-a[9],a[5]+=a[9],a[9]=r*u[i+-216+7],r=a[0]-a[12],a[0]+=a[12],a[12]=r*u[i+-72+7],r=a[1]-a[13],a[1]+=a[13],a[13]=r*u[i+-72+7],r=a[16]-a[28],a[16]+=a[28],a[28]=r*u[i+-72+7],r=-a[17]+a[29],a[17]+=a[29],a[29]=r*u[i+-72+7],r=V.SQRT2*(a[2]-a[10]),a[2]+=a[10],a[10]=r,r=V.SQRT2*(a[3]-a[11]),a[3]+=a[11],a[11]=r,r=V.SQRT2*(-a[18]+a[26]),a[18]+=a[26],a[26]=r-a[18],r=V.SQRT2*(-a[19]+a[27]),a[19]+=a[27],a[27]=r-a[19],r=a[2],a[19]-=a[3],a[3]-=r,a[2]=a[31]-r,a[31]+=r,r=a[3],a[11]-=a[19],a[18]-=r,a[3]=a[30]-r,a[30]+=r,r=a[18],a[27]-=a[11],a[19]-=r,a[18]=a[15]-r,a[15]+=r,r=a[19],a[10]-=r,a[19]=a[14]-r,a[14]+=r,r=a[10],a[11]-=r,a[10]=a[23]-r,a[23]+=r,r=a[11],a[26]-=r,a[11]=a[22]-r,a[22]+=r,r=a[26],a[27]-=r,a[26]=a[7]-r,a[7]+=r,r=a[27],a[27]=a[6]-r,a[6]+=r,r=V.SQRT2*(a[0]-a[4]),a[0]+=a[4],a[4]=r,r=V.SQRT2*(a[1]-a[5]),a[1]+=a[5],a[5]=r,r=V.SQRT2*(a[16]-a[20]),a[16]+=a[20],a[20]=r,r=V.SQRT2*(a[17]-a[21]),a[17]+=a[21],a[21]=r,r=-V.SQRT2*(a[8]-a[12]),a[8]+=a[12],a[12]=r-a[8],r=-V.SQRT2*(a[9]-a[13]),a[9]+=a[13],a[13]=r-a[9],r=-V.SQRT2*(a[25]-a[29]),a[25]+=a[29],a[29]=r-a[25],r=-V.SQRT2*(a[24]+a[28]),a[24]-=a[28],a[28]=r-a[24],r=a[24]-a[16],a[24]=r,r=a[20]-r,a[20]=r,r=a[28]-r,a[28]=r,r=a[25]-a[17],a[25]=r,r=a[21]-r,a[21]=r,r=a[29]-r,a[29]=r,r=a[17]-a[1],a[17]=r,r=a[9]-r,a[9]=r,r=a[25]-r,a[25]=r,r=a[5]-r,a[5]=r,r=a[21]-r,a[21]=r,r=a[13]-r,a[13]=r,r=a[29]-r,a[29]=r,r=a[1]-a[0],a[1]=r,r=a[16]-r,a[16]=r,r=a[17]-r,a[17]=r,r=a[8]-r,a[8]=r,r=a[9]-r,a[9]=r,r=a[24]-r,a[24]=r,r=a[25]-r,a[25]=r,r=a[4]-r,a[4]=r,r=a[5]-r,a[5]=r,r=a[20]-r,a[20]=r,r=a[21]-r,a[21]=r,r=a[12]-r,a[12]=r,r=a[13]-r,a[13]=r,r=a[28]-r,a[28]=r,r=a[29]-r,a[29]=r,r=a[0],a[0]+=a[31],a[31]-=r,r=a[1],a[1]+=a[30],a[30]-=r,r=a[16],a[16]+=a[15],a[15]-=r,r=a[17],a[17]+=a[14],a[14]-=r,r=a[8],a[8]+=a[23],a[23]-=r,r=a[9],a[9]+=a[22],a[22]-=r,r=a[24],a[24]+=a[7],a[7]-=r,r=a[25],a[25]+=a[6],a[6]-=r,r=a[4],a[4]+=a[27],a[27]-=r,r=a[5],a[5]+=a[26],a[26]-=r,r=a[20],a[20]+=a[11],a[11]-=r,r=a[21],a[21]+=a[10],a[10]-=r,r=a[12],a[12]+=a[19],a[19]-=r,r=a[13],a[13]+=a[18],a[18]-=r,r=a[28],a[28]+=a[3],a[3]-=r,r=a[29],a[29]+=a[2],a[2]-=r}function E(e,t){for(var a=0;a<3;a++){var n,s,r,i,o,_;i=e[t+6]*A[Ae.SHORT_TYPE][0]-e[t+15],n=e[t+0]*A[Ae.SHORT_TYPE][2]-e[t+9],s=i+n,r=i-n,i=e[t+15]*A[Ae.SHORT_TYPE][0]+e[t+6],n=e[t+9]*A[Ae.SHORT_TYPE][2]+e[t+0],o=i+n,_=-i+n,n=2.069978111953089e-11*(e[t+3]*A[Ae.SHORT_TYPE][1]-e[t+12]),i=2.069978111953089e-11*(e[t+12]*A[Ae.SHORT_TYPE][1]+e[t+3]),e[t+0]=1.90752519173728e-11*s+n,e[t+15]=1.90752519173728e-11*-o+i,r=.8660254037844387*r*1.907525191737281e-11,o=.5*o*1.907525191737281e-11+i,e[t+3]=r-o,e[t+6]=r+o,s=.5*s*1.907525191737281e-11-n,_=.8660254037844387*_*1.907525191737281e-11,e[t+9]=s+_,e[t+12]=s-_,t++}}function C(e,t,a){var n,s,r,i,o,_,l,f,c,u,h,b,p,m,v,d,g,S;r=a[17]-a[9],o=a[15]-a[11],_=a[14]-a[12],l=a[0]+a[8],f=a[1]+a[7],c=a[2]+a[6],u=a[3]+a[5],e[t+17]=l+c-u-(f-a[4]),s=(l+c-u)*w[19]+(f-a[4]),n=(r-o-_)*w[18],e[t+5]=n+s,e[t+6]=n-s,i=(a[16]-a[10])*w[18],f=f*w[19]+a[4],n=r*w[12]+i+o*w[13]+_*w[14],s=-l*w[16]+f-c*w[17]+u*w[15],e[t+1]=n+s,e[t+2]=n-s,n=r*w[13]-i-o*w[14]+_*w[12],s=-l*w[17]+f-c*w[15]+u*w[16],e[t+9]=n+s,e[t+10]=n-s,n=r*w[14]-i+o*w[12]-_*w[13],s=l*w[15]-f+c*w[16]-u*w[17],e[t+13]=n+s,e[t+14]=n-s,h=a[8]-a[0],p=a[6]-a[2],m=a[5]-a[3],v=a[17]+a[9],d=a[16]+a[10],g=a[15]+a[11],S=a[14]+a[12],e[t+0]=v+g+S+(d+a[13]),n=(v+g+S)*w[19]-(d+a[13]),s=(h-p+m)*w[18],e[t+11]=n+s,e[t+12]=n-s,b=(a[7]-a[1])*w[18],d=a[13]-d*w[19],n=v*w[15]-d+g*w[16]+S*w[17],s=h*w[14]+b+p*w[12]+m*w[13],e[t+3]=n+s,e[t+4]=n-s,n=-v*w[17]+d-g*w[15]-S*w[16],s=h*w[13]+b-p*w[14]-m*w[12],e[t+7]=n+s,e[t+8]=n-s,n=-v*w[16]+d-g*w[17]-S*w[15],s=h*w[12]-b+p*w[13]-m*w[14],e[t+15]=n+s,e[t+16]=n-s}this.mdct_sub48=function(e,t,a){for(var n=t,s=286,r=0;r<e.channels_out;r++){for(var i=0;i<e.mode_gr;i++){for(var o,_=e.l3_side.tt[i][r],l=_.xr,f=0,c=e.sb_sample[r][1-i],u=0,h=0;h<9;h++)for(T(n,s,c[u]),T(n,s+32,c[u+1]),u+=2,s+=64,o=1;o<32;o+=2)c[u-1][o]*=-1;for(o=0;o<32;o++,f+=18){var b=_.block_type,p=e.sb_sample[r][i],m=e.sb_sample[r][1-i];if(0!=_.mixed_block_flag&&o<2&&(b=0),e.amp_filter[o]<1e-12)Se.fill(l,f+0,f+18,0);else if(e.amp_filter[o]<1&&me(),b==Ae.SHORT_TYPE){for(var h=-3;h<0;h++){var v=A[Ae.SHORT_TYPE][h+3];l[f+3*h+9]=p[9+h][B[o]]*v-p[8-h][B[o]],l[f+3*h+18]=p[14-h][B[o]]*v+p[15+h][B[o]],l[f+3*h+10]=p[15+h][B[o]]*v-p[14-h][B[o]],l[f+3*h+19]=m[2-h][B[o]]*v+m[3+h][B[o]],l[f+3*h+11]=m[3+h][B[o]]*v-m[2-h][B[o]],l[f+3*h+20]=m[8-h][B[o]]*v+m[9+h][B[o]]}E(l,f)}else{for(var d=de(18),h=-9;h<0;h++){var g,S;g=A[b][h+27]*m[h+9][B[o]]+A[b][h+36]*m[8-h][B[o]],S=A[b][h+9]*p[h+9][B[o]]-A[b][h+18]*p[8-h][B[o]],d[h+9]=g-S*k[3+h+9],d[h+18]=g*k[3+h+9]+S}C(l,f,d)}if(b!=Ae.SHORT_TYPE&&0!=o)for(var h=7;0<=h;--h){var w,M;w=l[f+h]*R[20+h]+l[f+-1-h]*x[28+h],M=l[f+h]*x[28+h]-l[f+-1-h]*R[20+h],l[f+-1-h]=w,l[f+h]=M}}}if(n=a,s=286,1==e.mode_gr)for(var y=0;y<18;y++)I.arraycopy(e.sb_sample[r][1][y],0,e.sb_sample[r][0][y],0,32)}}};this.lame_encode_mp3_frame=function(e,t,a,n,s,r){var i,o=E([2,2]);o[0][0]=new L,o[0][1]=new L,o[1][0]=new L,o[1][1]=new L;var _,l=E([2,2]);l[0][0]=new L,l[0][1]=new L,l[1][0]=new L,l[1][1]=new L;var f,c,u,h=[null,null],b=e.internal_flags,p=ge([2,4]),m=[[0,0],[0,0]],v=[[0,0],[0,0]];if(h[0]=t,h[1]=a,0==b.lame_encode_frame_init&&function(e,t){var a,n,s=e.internal_flags;if(0==s.lame_encode_frame_init){var r,i,o=de(2014),_=de(2014);for(s.lame_encode_frame_init=1,i=r=0;r<286+576*(1+s.mode_gr);++r)r<576*s.mode_gr?(o[r]=0,2==s.channels_out&&(_[r]=0)):(o[r]=t[0][i],2==s.channels_out&&(_[r]=t[1][i]),++i);for(n=0;n<s.mode_gr;n++)for(a=0;a<s.channels_out;a++)s.l3_side.tt[n][a].block_type=Ae.SHORT_TYPE;T.mdct_sub48(s,o,_)}}(e,h),b.padding=0,(b.slot_lag-=b.frac_SpF)<0&&(b.slot_lag+=e.out_samplerate,b.padding=1),0!=b.psymodel){var d,g=[null,null],S=0,w=ve(2);for(u=0;u<b.mode_gr;u++){for(c=0;c<b.channels_out;c++)g[c]=h[c],S=576+576*u-Ae.FFTOFFSET;if(e.VBR==Me.vbr_mtrh||e.VBR==Me.vbr_mt?me():d=x.L3psycho_anal_ns(e,g,S,u,o,l,m[u],v[u],p[u],w),0!=d)return-4;for(e.mode==ye.JOINT_STEREO&&me(),c=0;c<b.channels_out;c++){var M=b.l3_side.tt[u][c];M.block_type=w[c],M.mixed_block_flag=0}}}else me();if(function(e){var t,a;if(0==e.ATH.useAdjust)return e.ATH.adjust=1;if(a=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?me():(a+=a,t+=t),2==e.mode_gr&&(a=Math.max(a,t)),a*=.5,.03125<(a*=e.ATH.aaSensitivityP))1<=e.ATH.adjust?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var n=31.98*a+625e-6;e.ATH.adjust>=n?(e.ATH.adjust*=.075*n+.925,e.ATH.adjust<n&&(e.ATH.adjust=n)):e.ATH.adjustLimit>=n?e.ATH.adjust=n:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=n}}(b),T.mdct_sub48(b,h[0],h[1]),b.mode_ext=Ae.MPG_MD_LR_LR,e.force_ms?b.mode_ext=Ae.MPG_MD_MS_LR:e.mode==ye.JOINT_STEREO&&me(),b.mode_ext==k?(_=l,f=v):(_=o,f=m),e.analysis&&null!=b.pinfo&&me(),e.VBR==Me.vbr_off||e.VBR==Me.vbr_abr){var y,A;for(y=0;y<18;y++)b.nsPsy.pefirbuf[y]=b.nsPsy.pefirbuf[y+1];for(u=A=0;u<b.mode_gr;u++)for(c=0;c<b.channels_out;c++)A+=f[u][c];for(b.nsPsy.pefirbuf[18]=A,A=b.nsPsy.pefirbuf[9],y=0;y<9;y++)A+=(b.nsPsy.pefirbuf[y]+b.nsPsy.pefirbuf[18-y])*Ae.fircoef[y];for(A=3350*b.mode_gr*b.channels_out/A,u=0;u<b.mode_gr;u++)for(c=0;c<b.channels_out;c++)f[u][c]*=A}return b.iteration_loop.iteration_loop(e,f,[.5,.5],_),R.format_bitstream(e),i=R.copy_buffer(b,n,s,r,1),e.bWriteVbrTag&&B.addVbrFrame(e),e.analysis&&null!=b.pinfo&&me(),function(e){var t,a;for(e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&me(),t=0;t<e.mode_gr;++t)for(a=0;a<e.channels_out;++a){var n=0|e.l3_side.tt[t][a].block_type;0!=e.l3_side.tt[t][a].mixed_block_flag&&(n=4),e.bitrate_blockType_Hist[e.bitrate_index][n]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][n]++,e.bitrate_blockType_Hist[15][5]++}}(b),i}}function i(){this.l=de(Ae.SBMAX_l),this.s=ge([Ae.SBMAX_s,3]);var n=this;this.assign=function(e){I.arraycopy(e.l,0,n.l,0,Ae.SBMAX_l);for(var t=0;t<Ae.SBMAX_s;t++)for(var a=0;a<3;a++)n.s[t][a]=e.s[t][a]}}function j(){var e=40;function t(){this.write_timing=0,this.ptr=0,this.buf=w(e)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=ge([2,j.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[ve(4),ve(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new B},this.ms_ratio=de(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=ve(2),this.CurrentStep=ve(2),this.masking_lower=0,this.bv_scf=ve(576),this.pseudohalf=ve(F.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*j.BPC+1),this.itime=n(2),this.sideinfo_len=0,this.sb_sample=ge([2,2,18,Ae.SBLIMIT]),this.amp_filter=de(32),this.header=new Array(j.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new r,this.minval_l=de(Ae.CBANDS),this.minval_s=de(Ae.CBANDS),this.nb_1=ge([4,Ae.CBANDS]),this.nb_2=ge([4,Ae.CBANDS]),this.nb_s1=ge([4,Ae.CBANDS]),this.nb_s2=ge([4,Ae.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=de(4),this.loudness_sq=ge([2,2]),this.loudness_sq_save=de(2),this.mld_l=de(Ae.SBMAX_l),this.mld_s=de(Ae.SBMAX_s),this.bm_l=ve(Ae.SBMAX_l),this.bo_l=ve(Ae.SBMAX_l),this.bm_s=ve(Ae.SBMAX_s),this.bo_s=ve(Ae.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=S([Ae.CBANDS,2]),this.s3ind_s=S([Ae.CBANDS,2]),this.numlines_s=ve(Ae.CBANDS),this.numlines_l=ve(Ae.CBANDS),this.rnumlines_l=de(Ae.CBANDS),this.mld_cb_l=de(Ae.CBANDS),this.mld_cb_s=de(Ae.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=de(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=ve(2),this.nsPsy=new function(){this.last_en_subshort=ge([4,9]),this.lastAttacks=ve(4),this.pefirbuf=de(19),this.longfact=de(Ae.SBMAX_l),this.shortfact=de(Ae.SBMAX_s),this.attackthre=0,this.attackthre_s=0},this.VBR_seek_table=new function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0},this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=S([16,5]),this.bitrate_blockType_Hist=S([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var a=0;a<this.en.length;a++)this.en[a]=new i;for(var a=0;a<this.thm.length;a++)this.thm[a]=new i;for(var a=0;a<this.header.length;a++)this.header[a]=new t}function X(){var k=new function(){var h=de(Ae.BLKSIZE),p=de(Ae.BLKSIZE_s/2),x=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function m(e,t,a){var n,s,r,i=0,o=t+(a<<=1);n=4;do{var _,l,f,c,u,h,b;for(b=n>>1,h=(u=(c=n)<<1)+c,n=u<<1,r=(s=t)+b;w=e[s+0]-e[s+c],S=e[s+0]+e[s+c],k=e[s+u]-e[s+h],y=e[s+u]+e[s+h],e[s+u]=S-y,e[s+0]=S+y,e[s+h]=w-k,e[s+c]=w+k,w=e[r+0]-e[r+c],S=e[r+0]+e[r+c],k=V.SQRT2*e[r+h],y=V.SQRT2*e[r+u],e[r+u]=S-y,e[r+0]=S+y,e[r+h]=w-k,e[r+c]=w+k,r+=n,(s+=n)<o;);for(l=x[i+0],_=x[i+1],f=1;f<b;f++){var p,m;p=1-2*_*_,m=2*_*l,s=t+f,r=t+c-f;do{var v,d,g,S,w,M,y,A,k,R;d=m*e[s+c]-p*e[r+c],v=p*e[s+c]+m*e[r+c],w=e[s+0]-v,S=e[s+0]+v,M=e[r+0]-d,g=e[r+0]+d,d=m*e[s+h]-p*e[r+h],v=p*e[s+h]+m*e[r+h],k=e[s+u]-v,y=e[s+u]+v,R=e[r+u]-d,A=e[r+u]+d,d=_*y-l*R,v=l*y+_*R,e[s+u]=S-v,e[s+0]=S+v,e[r+h]=M-d,e[r+c]=M+d,d=l*A-_*k,v=_*A+l*k,e[r+u]=g-v,e[r+0]=g+v,e[s+h]=w-d,e[s+c]=w+d,r+=n,s+=n}while(s<o);l=(p=l)*x[i+0]-_*x[i+1],_=p*x[i+1]+_*x[i+0]}i+=2}while(n<a)}var v=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,t,a,n,s){for(var r=0;r<3;r++){var i=Ae.BLKSIZE_s/2,o=65535&192*(r+1),_=Ae.BLKSIZE_s/8-1;do{var l,f,c,u,h,b=255&v[_<<2];l=p[b]*n[a][s+b+o],h=p[127-b]*n[a][s+b+o+128],f=l-h,l+=h,c=p[b+64]*n[a][s+b+o+64],h=p[63-b]*n[a][s+b+o+192],u=c-h,c+=h,i-=4,t[r][i+0]=l+c,t[r][i+2]=l-c,t[r][i+1]=f+u,t[r][i+3]=f-u,l=p[b+1]*n[a][s+b+o+1],h=p[126-b]*n[a][s+b+o+129],f=l-h,l+=h,c=p[b+65]*n[a][s+b+o+65],h=p[62-b]*n[a][s+b+o+193],u=c-h,c+=h,t[r][i+Ae.BLKSIZE_s/2+0]=l+c,t[r][i+Ae.BLKSIZE_s/2+2]=l-c,t[r][i+Ae.BLKSIZE_s/2+1]=f+u,t[r][i+Ae.BLKSIZE_s/2+3]=f-u}while(0<=--_);m(t[r],i,Ae.BLKSIZE_s/2)}},this.fft_long=function(e,t,a,n,s){var r=Ae.BLKSIZE/8-1,i=Ae.BLKSIZE/2;do{var o,_,l,f,c,u=255&v[r];o=h[u]*n[a][s+u],c=h[u+512]*n[a][s+u+512],_=o-c,o+=c,l=h[u+256]*n[a][s+u+256],c=h[u+768]*n[a][s+u+768],f=l-c,l+=c,t[0+(i-=4)]=o+l,t[i+2]=o-l,t[i+1]=_+f,t[i+3]=_-f,o=h[u+1]*n[a][s+u+1],c=h[u+513]*n[a][s+u+513],_=o-c,o+=c,l=h[u+257]*n[a][s+u+257],c=h[u+769]*n[a][s+u+769],f=l-c,l+=c,t[i+Ae.BLKSIZE/2+0]=o+l,t[i+Ae.BLKSIZE/2+2]=o-l,t[i+Ae.BLKSIZE/2+1]=_+f,t[i+Ae.BLKSIZE/2+3]=_-f}while(0<=--r);m(t,i,Ae.BLKSIZE/2)},this.init_fft=function(e){for(var t=0;t<Ae.BLKSIZE;t++)h[t]=.42-.5*Math.cos(2*Math.PI*(t+.5)/Ae.BLKSIZE)+.08*Math.cos(4*Math.PI*(t+.5)/Ae.BLKSIZE);for(var t=0;t<Ae.BLKSIZE_s/2;t++)p[t]=.5*(1-Math.cos(2*Math.PI*(t+.5)/Ae.BLKSIZE_s))}},R=2.302585092994046,d=2,g=16,E=.34,v=1/217621504/(Ae.BLKSIZE/2),S=.2302585093;function se(e,t,a,n,s,r,i,o,_,l,f){var c=e.internal_flags;_<2?(k.fft_long(c,n[s],_,l,f),k.fft_short(c,r[i],_,l,f)):2==_&&me(),t[0]=n[s+0][0],t[0]*=t[0];for(var u=Ae.BLKSIZE/2-1;0<=u;--u){var h=n[s+0][Ae.BLKSIZE/2-u],b=n[s+0][Ae.BLKSIZE/2+u];t[Ae.BLKSIZE/2-u]=.5*(h*h+b*b)}for(var p=2;0<=p;--p){a[p][0]=r[i+0][p][0],a[p][0]*=a[p][0];for(var u=Ae.BLKSIZE_s/2-1;0<=u;--u){var h=r[i+0][p][Ae.BLKSIZE_s/2-u],b=r[i+0][p][Ae.BLKSIZE_s/2+u];a[p][Ae.BLKSIZE_s/2-u]=.5*(h*h+b*b)}}for(var m=0,u=11;u<Ae.HBLKSIZE;u++)m+=t[u];c.tot_ener[_]=m,e.analysis&&me(),2==e.athaa_loudapprox&&_<2&&(c.loudness_sq[o][_]=c.loudness_sq_save[_],c.loudness_sq_save[_]=function(e,t){for(var a=0,n=0;n<Ae.BLKSIZE/2;++n)a+=e[n]*t.ATH.eql_w[n];return a*=v}(t,c))}var x,B,T,C=8,I=23,L=15,re=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],f=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],c=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],u=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function ie(e,t,a,n,s,r){var i;if(e<t){if(!(t<e*B))return e+t;i=t/e}else{if(t*B<=e)return e+t;i=e/t}if(e+=t,n+3<=6){if(x<=i)return e;var o=0|V.FAST_LOG10_X(i,16);return e*c[o]}var _,l,o=0|V.FAST_LOG10_X(i,16);return t=0!=r?s.ATH.cb_s[a]*s.ATH.adjust:s.ATH.cb_l[a]*s.ATH.adjust,e<T*t?t<e?(_=1,o<=13&&(_=u[o]),l=V.FAST_LOG10_X(e/t,10/15),e*((f[o]-_)*l+_)):13<o?e:e*u[o]:e*f[o]}function oe(e,t,a,n,s){var r,i,o=0,_=0;for(r=i=0;r<Ae.SBMAX_s;++i,++r){for(var l=e.bo_s[r],f=e.npart_s,c=l<f?l:f;i<c;)o+=t[i],_+=a[i],i++;if(e.en[n].s[r][s]=o,e.thm[n].s[r][s]=_,f<=i){++r;break}var u=e.PSY.bo_s_weight[r],h=1-u;o=u*t[i],_=u*a[i],e.en[n].s[r][s]+=o,e.thm[n].s[r][s]+=_,o=h*t[i],_=h*a[i]}for(;r<Ae.SBMAX_s;++r)e.en[n].s[r][s]=0,e.thm[n].s[r][s]=0}function _e(e,t,a,n){var s,r,i=0,o=0;for(s=r=0;s<Ae.SBMAX_l;++r,++s){for(var _=e.bo_l[s],l=e.npart_l,f=_<l?_:l;r<f;)i+=t[r],o+=a[r],r++;if(e.en[n].l[s]=i,e.thm[n].l[s]=o,l<=r){++s;break}var c=e.PSY.bo_l_weight[s],u=1-c;i=c*t[r],o=c*a[r],e.en[n].l[s]+=i,e.thm[n].l[s]+=o,i=u*t[r],o=u*a[r]}for(;s<Ae.SBMAX_l;++s)e.en[n].l[s]=0,e.thm[n].l[s]=0}function le(e,t,a,n,s,r){var i,o,_=e.internal_flags;for(o=i=0;o<_.npart_s;++o){for(var l=0,f=0,c=_.numlines_s[o],u=0;u<c;++u,++i){var h=t[r][i];l+=h,f<h&&(f=h)}a[o]=l}for(i=o=0;o<_.npart_s;o++){var b=_.s3ind_s[o][0],p=_.s3_ss[i++]*a[b];for(++b;b<=_.s3ind_s[o][1];)p+=_.s3_ss[i]*a[b],++i,++b;var m=d*_.nb_s1[s][o];if(n[o]=Math.min(p,m),_.blocktype_old[1&s]==Ae.SHORT_TYPE){var m=g*_.nb_s2[s][o],v=n[o];n[o]=Math.min(m,v)}_.nb_s2[s][o]=_.nb_s1[s][o],_.nb_s1[s][o]=p}for(;o<=Ae.CBANDS;++o)a[o]=0,n[o]=0}function fe(e,t,a){return 1<=a?e:a<=0?t:0<t?Math.pow(e/t,a)*t:0}var _=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function ce(e,t){for(var a=309.07,n=0;n<Ae.SBMAX_s-1;n++)for(var s=0;s<3;s++){var r=e.thm.s[n][s];if(0<r){var i=r*t,o=e.en.s[n][s];i<o&&(a+=1e10*i<o?_[n]*(10*R):_[n]*V.FAST_LOG10(o/i))}}return a}var o=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function ue(e,t){for(var a=281.0575,n=0;n<Ae.SBMAX_l-1;n++){var s=e.thm.l[n];if(0<s){var r=s*t,i=e.en.l[n];r<i&&(a+=1e10*r<i?o[n]*(10*R):o[n]*V.FAST_LOG10(i/r))}}return a}function he(e,t,a,n,s){var r,i;for(r=i=0;r<e.npart_l;++r){var o,_=0,l=0;for(o=0;o<e.numlines_l[r];++o,++i){var f=t[i];_+=f,l<f&&(l=f)}a[r]=_,n[r]=l,s[r]=_*e.rnumlines_l[r]}}function be(e,t,a,n){var s=re.length-1,r=0,i=a[r]+a[r+1];if(0<i){var o=t[r];o<t[r+1]&&(o=t[r+1]);var _=0|(i=20*(2*o-i)/(i*(e.numlines_l[r]+e.numlines_l[r+1]-1)));s<_&&(_=s),n[r]=_}else n[r]=0;for(r=1;r<e.npart_l-1;r++)if(0<(i=a[r-1]+a[r]+a[r+1])){var o=t[r-1];o<t[r]&&(o=t[r]),o<t[r+1]&&(o=t[r+1]);var _=0|(i=20*(3*o-i)/(i*(e.numlines_l[r-1]+e.numlines_l[r]+e.numlines_l[r+1]-1)));s<_&&(_=s),n[r]=_}else n[r]=0;if(0<(i=a[r-1]+a[r])){var o=t[r-1];o<t[r]&&(o=t[r]);var _=0|(i=20*(2*o-i)/(i*(e.numlines_l[r-1]+e.numlines_l[r]-1)));s<_&&(_=s),n[r]=_}else n[r]=0}var pe=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];function P(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function H(e,t,a,n,s,r,i,o,_,l,f,c){var u,h=de(Ae.CBANDS+1),b=o/(15<c?1152:384),p=ve(Ae.HBLKSIZE);o/=_;var m=0,v=0;for(u=0;u<Ae.CBANDS;u++){var d;for(x=P(o*m),h[u]=o*m,d=m;P(o*d)-x<E&&d<=_/2;d++);for(e[u]=d-m,v=u+1;m<d;)p[m++]=u;if(_/2<m){m=_/2,++u;break}}h[u]=o*m;for(var g=0;g<c;g++){var S,w,M,y,A;M=l[g],y=l[g+1],(S=0|Math.floor(.5+f*(M-.5)))<0&&(S=0),w=0|Math.floor(.5+f*(y-.5)),_/2<w&&(w=_/2),a[g]=(p[S]+p[w])/2,t[g]=p[w];var k=b*y;i[g]=(k-h[t[g]])/(h[t[g]+1]-h[t[g]]),i[g]<0?i[g]=0:1<i[g]&&(i[g]=1),A=P(o*l[g]*f),A=Math.min(A,15.5)/15.5,r[g]=Math.pow(10,1.25*(1-Math.cos(Math.PI*A))-2.5)}for(var R=m=0;R<v;R++){var x,B,T=e[R];x=P(o*m),B=P(o*(m+T-1)),n[R]=.5*(x+B),x=P(o*(m-.5)),B=P(o*(m+T-.5)),s[R]=B-x,m+=T}return v}function O(e,t,a,n,s,r){var i,o,_,l,f,c,u=ge([Ae.CBANDS,Ae.CBANDS]),h=0;if(r)for(var b=0;b<t;b++)for(i=0;i<t;i++){var p=(o=a[b]-a[i],c=f=l=_=void 0,_=o,l=.5<=(_*=0<=_?3:1.5)&&_<=2.5?8*((c=_-.5)*c-2*c):0,((f=15.811389+7.5*(_+=.474)-17.5*Math.sqrt(1+_*_))<=-60?0:(_=Math.exp((l+f)*S),_/=.6609193))*n[i]);u[b][i]=p*s[b]}else me();for(var b=0;b<t;b++){for(i=0;i<t&&!(0<u[b][i]);i++);for(e[b][0]=i,i=t-1;0<i&&!(0<u[b][i]);i--);e[b][1]=i,h+=e[b][1]-e[b][0]+1}for(var m=de(h),v=0,b=0;b<t;b++)for(i=e[b][0];i<=e[b][1];i++)m[v++]=u[b][i];return m}function N(e){var t=P(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function n(e,t){e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e);var a=3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4);return a}this.L3psycho_anal_ns=function(e,t,a,n,s,r,i,o,_,l){var f,c,u,h,b,p,m,v,d,g=e.internal_flags,S=ge([2,Ae.BLKSIZE]),w=ge([2,3,Ae.BLKSIZE_s]),M=de(Ae.CBANDS+1),y=de(Ae.CBANDS+1),A=de(Ae.CBANDS+2),k=ve(2),R=ve(2),x=ge([2,576]),B=ve(Ae.CBANDS+2),T=ve(Ae.CBANDS+2);for(Se.fill(T,0),f=g.channels_out,e.mode==ye.JOINT_STEREO&&(f=4),d=e.VBR==Me.vbr_off?0==g.ResvMax?0:g.ResvSize/g.ResvMax*.5:e.VBR==Me.vbr_rh||e.VBR==Me.vbr_mtrh||e.VBR==Me.vbr_mt?.6:1,c=0;c<g.channels_out;c++){var E=t[c],C=a+576-350-21+192;for(h=0;h<576;h++){var I,L;for(I=E[C+h+10],b=L=0;b<9;b+=2)I+=pe[b]*(E[C+h+b]+E[C+h+21-b]),L+=pe[b+1]*(E[C+h+b+1]+E[C+h+21-b-1]);x[c][h]=I+L}s[n][c].en.assign(g.en[c]),s[n][c].thm.assign(g.thm[c]),2<f&&me()}for(c=0;c<f;c++){var P,H=de(12),O=[0,0,0,0],N=de(12),V=1,D=de(Ae.CBANDS),F=de(Ae.CBANDS),j=[0,0,0,0],X=de(Ae.HBLKSIZE),Y=ge([3,Ae.HBLKSIZE_s]);for(h=0;h<3;h++)H[h]=g.nsPsy.last_en_subshort[c][h+6],N[h]=H[h]/g.nsPsy.last_en_subshort[c][h+4],O[0]+=H[h];2==c&&me();var z=x[1&c],q=0;for(h=0;h<9;h++){for(var G=q+64,U=1;q<G;q++)U<Math.abs(z[q])&&(U=Math.abs(z[q]));g.nsPsy.last_en_subshort[c][h]=H[h+3]=U,O[1+h/3]+=U,U>H[h+3-2]?U/=H[h+3-2]:U=H[h+3-2]>10*U?H[h+3-2]/(10*U):0,N[h+3]=U}for(e.analysis&&me(),P=3==c?g.nsPsy.attackthre_s:g.nsPsy.attackthre,h=0;h<12;h++)0==j[h/3]&&N[h]>P&&(j[h/3]=h%3+1);for(h=1;h<4;h++)(O[h-1]>O[h]?O[h-1]/O[h]:O[h]/O[h-1])<1.7&&(j[h]=0,1==h&&(j[0]=0));for(0!=j[0]&&0!=g.nsPsy.lastAttacks[c]&&(j[0]=0),3!=g.nsPsy.lastAttacks[c]&&j[0]+j[1]+j[2]+j[3]==0||((V=0)!=j[1]&&0!=j[0]&&(j[1]=0),0!=j[2]&&0!=j[1]&&(j[2]=0),0!=j[3]&&0!=j[2]&&(j[3]=0)),c<2?R[c]=V:me(),_[c]=g.tot_ener[c],se(e,X,Y,S,1&c,w,1&c,n,c,t,a),he(g,X,M,D,F),be(g,D,F,B),v=0;v<3;v++){var K,Z;for(le(e,Y,y,A,c,v),oe(g,y,A,c,v),m=0;m<Ae.SBMAX_s;m++){if(Z=g.thm[c].s[m][v],Z*=.8,2<=j[v]||1==j[v+1]){var W=0!=v?v-1:2,U=fe(g.thm[c].s[m][W],Z,.6*d);Z=Math.min(Z,U)}if(1==j[v]){var W=0!=v?v-1:2,U=fe(g.thm[c].s[m][W],Z,.3*d);Z=Math.min(Z,U)}else if(0!=v&&3==j[v-1]||0==v&&3==g.nsPsy.lastAttacks[c]){var W=2!=v?v+1:0,U=fe(g.thm[c].s[m][W],Z,.3*d);Z=Math.min(Z,U)}K=H[3*v+3]+H[3*v+4]+H[3*v+5],6*H[3*v+5]<K&&(Z*=.5,6*H[3*v+4]<K&&(Z*=.5)),g.thm[c].s[m][v]=Z}}for(g.nsPsy.lastAttacks[c]=j[2],u=p=0;u<g.npart_l;u++){for(var Q=g.s3ind[u][0],$=M[Q]*re[B[Q]],J=g.s3_ll[p++]*$;++Q<=g.s3ind[u][1];)$=M[Q]*re[B[Q]],J=ie(J,g.s3_ll[p++]*$,Q,Q-u,g,0);J*=.158489319246111,g.blocktype_old[1&c]==Ae.SHORT_TYPE?A[u]=J:A[u]=fe(Math.min(J,Math.min(2*g.nb_1[c][u],16*g.nb_2[c][u])),J,d),g.nb_2[c][u]=g.nb_1[c][u],g.nb_1[c][u]=J}for(;u<=Ae.CBANDS;++u)M[u]=0,A[u]=0;_e(g,M,A,c)}for(e.mode!=ye.STEREO&&e.mode!=ye.JOINT_STEREO||me(),e.mode==ye.JOINT_STEREO&&me(),function(e,t,a,n){var s=e.internal_flags;e.short_blocks!=we.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<s.channels_out;r++)n[r]=Ae.NORM_TYPE,e.short_blocks==we.short_block_dispensed&&(t[r]=1),e.short_blocks==we.short_block_forced&&(t[r]=0),0!=t[r]?s.blocktype_old[r]==Ae.SHORT_TYPE&&(n[r]=Ae.STOP_TYPE):(n[r]=Ae.SHORT_TYPE,s.blocktype_old[r]==Ae.NORM_TYPE&&(s.blocktype_old[r]=Ae.START_TYPE),s.blocktype_old[r]==Ae.STOP_TYPE&&(s.blocktype_old[r]=Ae.SHORT_TYPE)),a[r]=s.blocktype_old[r],s.blocktype_old[r]=n[r]}(e,R,l,k),c=0;c<f;c++){var ee,te,ae,ne=0;1<c?me():(ee=i,ne=0,te=l[c],ae=s[n][c]),ee[ne+c]=te==Ae.SHORT_TYPE?ce(ae,g.masking_lower):ue(ae,g.masking_lower),e.analysis&&(g.pinfo.pe[n][c]=ee[ne+c])}return 0},this.psymodel_init=function(e){var t,a=e.internal_flags,n=!0,s=13,r=0,i=0,o=-8.25,_=-4.5,l=de(Ae.CBANDS),f=de(Ae.CBANDS),c=de(Ae.CBANDS),u=e.out_samplerate;switch(e.experimentalZ){default:case 0:n=!0;break;case 1:n=e.VBR!=Me.vbr_mtrh&&e.VBR!=Me.vbr_mt;break;case 2:n=!1;break;case 3:s=8,r=-1.75,i=-.0125,o=-8.25,_=-2.25}for(a.ms_ener_ratio_old=.25,a.blocktype_old[0]=a.blocktype_old[1]=Ae.NORM_TYPE,t=0;t<4;++t){for(var h=0;h<Ae.CBANDS;++h)a.nb_1[t][h]=1e20,a.nb_2[t][h]=1e20,a.nb_s1[t][h]=a.nb_s2[t][h]=1;for(var b=0;b<Ae.SBMAX_l;b++)a.en[t].l[b]=1e20,a.thm[t].l[b]=1e20;for(var h=0;h<3;++h){for(var b=0;b<Ae.SBMAX_s;b++)a.en[t].s[b][h]=1e20,a.thm[t].s[b][h]=1e20;a.nsPsy.lastAttacks[t]=0}for(var h=0;h<9;h++)a.nsPsy.last_en_subshort[t][h]=10}for(a.loudness_sq_save[0]=a.loudness_sq_save[1]=0,a.npart_l=H(a.numlines_l,a.bo_l,a.bm_l,l,f,a.mld_l,a.PSY.bo_l_weight,u,Ae.BLKSIZE,a.scalefac_band.l,Ae.BLKSIZE/1152,Ae.SBMAX_l),t=0;t<a.npart_l;t++){var p=r;l[t]>=s&&(p=i*(l[t]-s)/(24-s)+r*(24-l[t])/(24-s)),c[t]=Math.pow(10,p/10),0<a.numlines_l[t]?a.rnumlines_l[t]=1/a.numlines_l[t]:a.rnumlines_l[t]=0}a.s3_ll=O(a.s3ind,a.npart_l,l,f,c,n);var m,h=0;for(t=0;t<a.npart_l;t++){g=D.MAX_VALUE;for(var v=0;v<a.numlines_l[t];v++,h++){var d=u*h/(1e3*Ae.BLKSIZE);S=this.ATHformula(1e3*d,e)-20,S=Math.pow(10,.1*S),(S*=a.numlines_l[t])<g&&(g=S)}a.ATH.cb_l[t]=g,6<(g=20*l[t]/10-20)&&(g=100),g<-15&&(g=-15),g-=8,a.minval_l[t]=Math.pow(10,g/10)*a.numlines_l[t]}for(a.npart_s=H(a.numlines_s,a.bo_s,a.bm_s,l,f,a.mld_s,a.PSY.bo_s_weight,u,Ae.BLKSIZE_s,a.scalefac_band.s,Ae.BLKSIZE_s/384,Ae.SBMAX_s),t=h=0;t<a.npart_s;t++){var g,p=o;l[t]>=s&&(p=_*(l[t]-s)/(24-s)+o*(24-l[t])/(24-s)),c[t]=Math.pow(10,p/10),g=D.MAX_VALUE;for(var v=0;v<a.numlines_s[t];v++,h++){var S,d=u*h/(1e3*Ae.BLKSIZE_s);S=this.ATHformula(1e3*d,e)-20,S=Math.pow(10,.1*S),(S*=a.numlines_s[t])<g&&(g=S)}a.ATH.cb_s[t]=g,g=7*l[t]/12-7,12<l[t]&&(g*=1+3.1*Math.log(1+g)),l[t]<12&&(g*=1+2.3*Math.log(1-g)),g<-15&&(g=-15),g-=8,a.minval_s[t]=Math.pow(10,g/10)*a.numlines_s[t]}a.s3_ss=O(a.s3ind_s,a.npart_s,l,f,c,n),x=Math.pow(10,(C+1)/16),B=Math.pow(10,(I+1)/16),T=Math.pow(10,L/10),k.init_fft(a),a.decay=Math.exp(-1*R/(.01*u/192)),m=3.5,0!=(2&e.exp_nspsytune)&&(m=1),0<Math.abs(e.msfix)&&(m=e.msfix),e.msfix=m;for(var w=0;w<a.npart_l;w++)a.s3ind[w][1]>a.npart_l-1&&(a.s3ind[w][1]=a.npart_l-1);var M=576*a.mode_gr/u;if(a.ATH.decay=Math.pow(10,-1.2*M),a.ATH.adjust=.01,-(a.ATH.adjustLimit=1)!=e.ATHtype){var y=e.out_samplerate/Ae.BLKSIZE,A=0;for(t=d=0;t<Ae.BLKSIZE/2;++t)d+=y,a.ATH.eql_w[t]=1/Math.pow(10,this.ATHformula(d,e)/10),A+=a.ATH.eql_w[t];for(A=1/A,t=Ae.BLKSIZE/2;0<=--t;)a.ATH.eql_w[t]*=A}for(var w=h=0;w<a.npart_s;++w)for(t=0;t<a.numlines_s[w];++t)++h;for(var w=h=0;w<a.npart_l;++w)for(t=0;t<a.numlines_l[w];++t)++h;for(t=h=0;t<a.npart_l;t++){var d=u*(h+a.numlines_l[t]/2)/(1*Ae.BLKSIZE);a.mld_cb_l[t]=N(d),h+=a.numlines_l[t]}for(;t<Ae.CBANDS;++t)a.mld_cb_l[t]=1;for(t=h=0;t<a.npart_s;t++){var d=u*(h+a.numlines_s[t]/2)/(1*Ae.BLKSIZE_s);a.mld_cb_s[t]=N(d),h+=a.numlines_s[t]}for(;t<Ae.CBANDS;++t)a.mld_cb_s[t]=1;return 0},this.ATHformula=function(e,t){var a;switch(t.ATHtype){case 0:a=n(e,9);break;case 1:a=n(e,-1);break;case 2:a=n(e,0);break;case 3:a=n(e,1)+6;break;case 4:a=n(e,t.ATHcurve);break;default:a=n(e,0)}return a}}function Y(){var T,E,u,h,b,C=this;Y.V9=410,Y.V8=420,Y.V7=430,Y.V6=440,Y.V5=450,Y.V4=460,Y.V3=470,Y.V2=480,Y.V1=490,Y.V0=500,Y.R3MIX=1e3,Y.STANDARD=1001,Y.EXTREME=1002,Y.INSANE=1003,Y.STANDARD_FAST=1004,Y.EXTREME_FAST=1005,Y.MEDIUM=1006,Y.MEDIUM_FAST=1007,Y.LAME_MAXMP3BUFFER=147456;var p,m,v=new X;function d(){this.lowerlimit=0}function s(e,t){this.lowpass=t}this.enc=new Ae,this.setModules=function(e,t,a,n,s,r,i,o,_){T=e,E=t,u=a,h=n,b=s,p=r,m=o,this.enc.setModules(E,v,h,p)};var I=4294479419;function g(e,t){var a=[new s(8,2e3),new s(16,3700),new s(24,3900),new s(32,5500),new s(40,7e3),new s(48,7500),new s(56,1e4),new s(64,11e3),new s(80,13500),new s(96,15100),new s(112,15600),new s(128,17e3),new s(160,17500),new s(192,18600),new s(224,19400),new s(256,19700),new s(320,20500)],n=C.nearestBitrateFullIndex(t);e.lowerlimit=a[n].lowpass}function L(e){var t=Ae.BLKSIZE+e.framesize-Ae.FFTOFFSET;return t=Math.max(t,512+e.framesize-32)}function P(){this.n_in=0,this.n_out=0}function H(e,t,a,n,s,r){var i=e.internal_flags;if(i.resample_ratio<.9999||1.0001<i.resample_ratio)me();else{r.n_out=Math.min(e.framesize,s),r.n_in=r.n_out;for(var o=0;o<r.n_out;++o)t[0][i.mf_size+o]=a[0][n+o],2==i.channels_out&&(t[1][i.mf_size+o]=a[1][n+o])}}this.lame_init=function(){var e,t,a=new function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=ye.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null},n=((e=a).class_id=I,t=e.internal_flags=new j,e.mode=ye.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=Me.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=Ae.ENCDELAY+Ae.POSTDELAY,e.encoder_padding=0,t.mf_size=Ae.ENCDELAY-Ae.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0);return 0!=n?null:(a.lame_allocated_gfp=1,a)},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],a=0,n=0,s=0,r=0;r=t[16],n=t[s=16],a=16;for(var i=0;i<16;i++)if(Math.max(e,t[i+1])!=e){r=t[i+1],s=i+1,n=t[i],a=i;break}return e-n<r-e?a:s},this.lame_init_params=function(e){var t,a,n=e.internal_flags;if(n.Class_ID=0,null==n.ATH&&(n.ATH=new function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=de(Ae.SBMAX_l),this.s=de(Ae.SBMAX_s),this.psfb21=de(Ae.PSFB21),this.psfb12=de(Ae.PSFB12),this.cb_l=de(Ae.CBANDS),this.cb_s=de(Ae.CBANDS),this.eql_w=de(Ae.BLKSIZE/2)}),null==n.PSY&&(n.PSY=new function(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=de(Ae.SBMAX_l),this.bo_s_weight=de(Ae.SBMAX_s)}),null==n.rgdata&&(n.rgdata=new function(){}),n.channels_in=e.num_channels,1==n.channels_in&&(e.mode=ye.MONO),n.channels_out=e.mode==ye.MONO?1:2,n.mode_ext=Ae.MPG_MD_MS_LR,e.mode==ye.MONO&&(e.force_ms=!1),e.VBR==Me.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==Me.vbr_off||e.VBR==Me.vbr_mtrh||e.VBR==Me.vbr_mt||(e.free_format=!1),e.VBR==Me.vbr_off&&0==e.brate&&me(),e.VBR==Me.vbr_off&&0<e.compression_ratio&&me(),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var s=16e3;switch(e.VBR){case Me.vbr_off:var r=new d;g(r,e.brate),s=r.lowerlimit;break;case Me.vbr_abr:var r=new d;g(r,e.VBR_mean_bitrate_kbps),s=r.lowerlimit;break;case Me.vbr_rh:me();default:me()}e.mode!=ye.MONO||e.VBR!=Me.vbr_off&&e.VBR!=Me.vbr_abr||(s*=1.5),e.lowpassfreq=0|s}switch(0==e.out_samplerate&&me(),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==Me.vbr_off&&(e.compression_ratio=16*e.out_samplerate*n.channels_out/(1e3*e.brate)),e.VBR==Me.vbr_abr&&me(),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,n.findPeakSample=!1),n.findReplayGain=e.findReplayGain,n.decode_on_the_fly=e.decode_on_the_fly,n.decode_on_the_fly&&(n.findPeakSample=!0),n.findReplayGain&&me(),n.decode_on_the_fly&&!e.decode_only&&me(),n.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*n.mode_gr,e.encoder_delay=Ae.ENCDELAY,n.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case Me.vbr_mt:case Me.vbr_rh:case Me.vbr_mtrh:e.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][e.VBR_q];break;case Me.vbr_abr:e.compression_ratio=16*e.out_samplerate*n.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*n.channels_out/(1e3*e.brate)}e.mode==ye.NOT_SET&&(e.mode=ye.JOINT_STEREO),0<e.highpassfreq?me():(n.highpass1=0,n.highpass2=0),0<e.lowpassfreq?(n.lowpass2=2*e.lowpassfreq,0<=e.lowpasswidth?me():n.lowpass1=2*e.lowpassfreq,n.lowpass1/=e.out_samplerate,n.lowpass2/=e.out_samplerate):me(),function(e){var t,a=e.internal_flags,n=32;if(0<a.lowpass1){for(var s=999,r=0;r<=31;r++){var i=r/31;i>=a.lowpass2&&(n=Math.min(n,r)),a.lowpass1<i&&i<a.lowpass2&&(s=Math.min(s,r))}a.lowpass1=999==s?(n-.75)/31:(s-.75)/31,a.lowpass2=n/31}0<a.highpass2&&me(),0<a.highpass2&&me();for(var r=0;r<32;r++){var o,_,i=r/31;a.highpass2>a.highpass1?me():o=1,_=a.lowpass2>a.lowpass1?1<(t=(i-a.lowpass1)/(a.lowpass2-a.lowpass1+1e-20))?0:t<=0?1:Math.cos(Math.PI/2*t):1,a.amp_filter[r]=o*_}}(e),n.samplerate_index=function(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1;case 32e3:return t.version=1,2;case 22050:return t.version=0;case 24e3:return t.version=0,1;case 16e3:return t.version=0,2;case 11025:return t.version=0;case 12e3:return t.version=0,1;case 8e3:return t.version=0,2;default:return t.version=0,-1}}(e.out_samplerate,e),n.samplerate_index<0&&me(),e.VBR==Me.vbr_off?e.free_format?n.bitrate_index=0:(e.brate=function(e,t,a){a<16e3&&(t=2);for(var n=k.bitrate_table[t][1],s=2;s<=14;s++)0<k.bitrate_table[t][s]&&Math.abs(k.bitrate_table[t][s]-e)<Math.abs(n-e)&&(n=k.bitrate_table[t][s]);return n}(e.brate,e.version,e.out_samplerate),n.bitrate_index=function(e,t,a){a<16e3&&(t=2);for(var n=0;n<=14;n++)if(0<k.bitrate_table[t][n]&&k.bitrate_table[t][n]==e)return n;return-1}(e.brate,e.version,e.out_samplerate),n.bitrate_index<=0&&me()):n.bitrate_index=1,e.analysis&&(e.bWriteVbrTag=!1),null!=n.pinfo&&(e.bWriteVbrTag=!1),E.init_bit_stream_w(n);for(var i,o=n.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),_=0;_<Ae.SBMAX_l+1;_++)n.scalefac_band.l[_]=h.sfBandIndex[o].l[_];for(var _=0;_<Ae.PSFB21+1;_++){var l=(n.scalefac_band.l[22]-n.scalefac_band.l[21])/Ae.PSFB21,f=n.scalefac_band.l[21]+_*l;n.scalefac_band.psfb21[_]=f}n.scalefac_band.psfb21[Ae.PSFB21]=576;for(var _=0;_<Ae.SBMAX_s+1;_++)n.scalefac_band.s[_]=h.sfBandIndex[o].s[_];for(var _=0;_<Ae.PSFB12+1;_++){var l=(n.scalefac_band.s[13]-n.scalefac_band.s[12])/Ae.PSFB12,f=n.scalefac_band.s[12]+_*l;n.scalefac_band.psfb12[_]=f}for(n.scalefac_band.psfb12[Ae.PSFB12]=192,1==e.version?n.sideinfo_len=1==n.channels_out?21:36:n.sideinfo_len=1==n.channels_out?13:21,e.error_protection&&(n.sideinfo_len+=2),a=void 0,a=(t=e).internal_flags,t.frameNum=0,t.write_id3tag_automatic&&m.id3tag_write_v2(t),a.bitrate_stereoMode_Hist=S([16,5]),a.bitrate_blockType_Hist=S([16,6]),a.PeakSample=0,t.bWriteVbrTag&&p.InitVbrTag(t),n.Class_ID=I,i=0;i<19;i++)n.nsPsy.pefirbuf[i]=700*n.mode_gr*n.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),e.VBR){case Me.vbr_mt:e.VBR=Me.vbr_mtrh;case Me.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),u.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),5<e.quality&&(e.quality=5),n.PSY.mask_adjust=e.maskingadjust,n.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?n.sfb21_extra=!1:n.sfb21_extra=44e3<e.out_samplerate,n.iteration_loop=new VBRNewIterationLoop(b);break;case Me.vbr_rh:u.apply_preset(e,500-10*e.VBR_q,0),n.PSY.mask_adjust=e.maskingadjust,n.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?n.sfb21_extra=!1:n.sfb21_extra=44e3<e.out_samplerate,6<e.quality&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),n.iteration_loop=new VBROldIterationLoop(b);break;default:var c;n.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),(c=e.VBR)==Me.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),u.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=c,n.PSY.mask_adjust=e.maskingadjust,n.PSY.mask_adjust_short=e.maskingadjust_short,c==Me.vbr_off?n.iteration_loop=new function(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,a,n){var s=e.internal_flags,r=de(F.SFBMAX),i=de(576),o=ve(2),_=0,l=s.l3_side,f=new R(_);this.quantize.rv.ResvFrameBegin(e,f),_=f.bits;for(var c=0;c<s.mode_gr;c++){this.quantize.qupvt.on_pe(e,t,o,_,c,c),s.mode_ext==Ae.MPG_MD_MS_LR&&me();for(var u=0;u<s.channels_out;u++){var h,b,p=l.tt[c][u];p.block_type!=Ae.SHORT_TYPE?(h=0,b=s.PSY.mask_adjust-h):(h=0,b=s.PSY.mask_adjust_short-h),s.masking_lower=Math.pow(10,.1*b),this.quantize.init_outer_loop(s,p),this.quantize.init_xrpow(s,p,i)&&(this.quantize.qupvt.calc_xmin(e,n[c][u],p,r),this.quantize.outer_loop(e,p,r,i,u,o[u])),this.quantize.iteration_finish_one(s,c,u)}}this.quantize.rv.ResvFrameEnd(s,_)}}(b):me()}return e.VBR!=Me.vbr_off&&me(),e.tune&&me(),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(e),e.athaa_type<0?n.ATH.useAdjust=3:n.ATH.useAdjust=e.athaa_type,n.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=we.short_block_allowed),e.short_blocks!=we.short_block_allowed||e.mode!=ye.JOINT_STEREO&&e.mode!=ye.STEREO||(e.short_blocks=we.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=X.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=X.NSATTACKTHRE_S),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),n.slot_lag=n.frac_SpF=0,e.VBR==Me.vbr_off&&(n.slot_lag=n.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),h.iteration_init(e),v.psymodel_init(e),0},this.lame_encode_flush=function(e,t,a,n){var s,r,i,o,_=e.internal_flags,l=M([2,1152]),f=0,c=_.mf_samples_to_encode-Ae.POSTDELAY,u=L(e);if(_.mf_samples_to_encode<1)return 0;for(s=0,e.in_samplerate!=e.out_samplerate&&me(),(i=e.framesize-c%e.framesize)<576&&(i+=e.framesize),e.encoder_padding=i,o=(c+i)/e.framesize;0<o&&0<=f;){var h=u-_.mf_size,b=e.frameNum;h*=e.in_samplerate,1152<(h/=e.out_samplerate)&&(h=1152),h<1&&(h=1),r=n-s,0==n&&(r=0),f=this.lame_encode_buffer(e,l[0],l[1],h,t,a,r),a+=f,s+=f,o-=b!=e.frameNum?1:0}return _.mf_samples_to_encode=0,f<0?f:(r=n-s,0==n&&(r=0),E.flush_bitstream(e),(f=E.copy_buffer(_,t,a,r,1))<0?f:(a+=f,r=n-(s+=f),0==n&&(r=0),e.write_id3tag_automatic&&me(),s))},this.lame_encode_buffer=function(e,t,a,n,s,r,i){var o,_,l=e.internal_flags,f=[null,null];if(l.Class_ID!=I)return-3;if(0==n)return 0;_=n,(null==(o=l).in_buffer_0||o.in_buffer_nsamples<_)&&(o.in_buffer_0=de(_),o.in_buffer_1=de(_),o.in_buffer_nsamples=_),f[0]=l.in_buffer_0,f[1]=l.in_buffer_1;for(var c=0;c<n;c++)f[0][c]=t[c],1<l.channels_in&&(f[1][c]=a[c]);return function(e,t,a,n,s,r,i){var o,_,l,f,c,u=e.internal_flags,h=0,b=[null,null],p=[null,null];if(u.Class_ID!=I)return-3;if(0==n)return 0;if((c=E.copy_buffer(u,s,r,i,0))<0)return c;if(r+=c,h+=c,p[0]=t,p[1]=a,N.NEQ(e.scale,0)&&N.NEQ(e.scale,1))for(_=0;_<n;++_)p[0][_]*=e.scale,2==u.channels_out&&(p[1][_]*=e.scale);if(N.NEQ(e.scale_left,0)&&N.NEQ(e.scale_left,1))for(_=0;_<n;++_)p[0][_]*=e.scale_left;if(N.NEQ(e.scale_right,0)&&N.NEQ(e.scale_right,1))for(_=0;_<n;++_)p[1][_]*=e.scale_right;2==e.num_channels&&1==u.channels_out&&me(),f=L(e),b[0]=u.mfbuf[0],b[1]=u.mfbuf[1];for(var m,v,d,g,S,w,M,y=0;0<n;){var A=[null,null],k=0,R=0;A[0]=p[0],A[1]=p[1];var x=new P;if(H(e,b,A,y,n,x),k=x.n_in,R=x.n_out,u.findReplayGain&&!u.decode_on_the_fly&&T.AnalyzeSamples(u.rgdata,b[0],u.mf_size,b[1],u.mf_size,R,u.channels_out)==O.GAIN_ANALYSIS_ERROR)return-6;if(n-=k,y+=k,u.channels_out,u.mf_size+=R,u.mf_samples_to_encode<1&&me(),u.mf_samples_to_encode+=R,u.mf_size>=f){var B=i-h;if(0==i&&(B=0),m=e,v=b[0],d=b[1],g=s,S=r,w=B,void 0,M=C.enc.lame_encode_mp3_frame(m,v,d,g,S,w),m.frameNum++,(o=M)<0)return o;for(r+=o,h+=o,u.mf_size-=e.framesize,u.mf_samples_to_encode-=e.framesize,l=0;l<u.channels_out;l++)for(_=0;_<u.mf_size;_++)b[l][_]=b[l][_+e.framesize]}}return h}(e,f[0],f[1],n,s,r,i)}}F.SFBMAX=3*Ae.SBMAX_s,Ae.ENCDELAY=576,Ae.POSTDELAY=1152,Ae.FFTOFFSET=224+(Ae.MDCTDELAY=48),Ae.DECDELAY=528,Ae.SBLIMIT=32,Ae.CBANDS=64,Ae.SBPSY_l=21,Ae.SBPSY_s=12,Ae.SBMAX_l=22,Ae.SBMAX_s=13,Ae.PSFB21=6,Ae.PSFB12=6,Ae.HBLKSIZE=(Ae.BLKSIZE=1024)/2+1,Ae.HBLKSIZE_s=(Ae.BLKSIZE_s=256)/2+1,Ae.NORM_TYPE=0,Ae.START_TYPE=1,Ae.SHORT_TYPE=2,Ae.STOP_TYPE=3,Ae.MPG_MD_LR_LR=0,Ae.MPG_MD_LR_I=1,Ae.MPG_MD_MS_LR=2,Ae.MPG_MD_MS_I=3,Ae.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3.898045e-17,.0467745*5,.50455,.756825,.187098*5],j.MFSIZE=3456+Ae.ENCDELAY-Ae.MDCTDELAY,j.MAX_HEADER_BUF=256,j.MAX_BITS_PER_CHANNEL=4095,j.MAX_BITS_PER_GRANULE=7680,j.BPC=320,F.SFBMAX=3*Ae.SBMAX_s,t.Mp3Encoder=function(n,e,t){1!=n&&me(\"fix cc: only supports mono\");var s=new Y,a=new function(){this.setModules=function(e,t){}},r=new O,i=new N,o=new function(){function e(e,t,a,n,s,r,i,o,_,l,f,c,u,h){this.quant_comp=t,this.quant_comp_s=a,this.safejoint=n,this.nsmsfix=s,this.st_lrm=r,this.st_s=i,this.nsbass=o,this.scale=_,this.masking_adj=l,this.ath_lower=f,this.ath_curve=c,this.interch=u,this.sfscale=h}var i;function n(e,t,a){me()}this.setModules=function(e){i=e};var o=[new e(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new e(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new e(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new e(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new e(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new e(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new e(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new e(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new e(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new e(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new e(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new e(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new e(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new e(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new e(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new e(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new e(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function s(e,t,a){var n=t,s=i.nearestBitrateFullIndex(t);if(e.VBR=Me.vbr_abr,e.VBR_mean_bitrate_kbps=n,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,320<e.VBR_mean_bitrate_kbps&&(e.disable_reservoir=!0),0<o[s].safejoint&&(e.exp_nspsytune=2|e.exp_nspsytune),0<o[s].sfscale&&(e.internal_flags.noise_shaping=2),0<Math.abs(o[s].nsbass)){var r=int(4*o[s].nsbass);r<0&&(r+=64),e.exp_nspsytune=e.exp_nspsytune|r<<2}return 0!=a?e.quant_comp=o[s].quant_comp:0<Math.abs(e.quant_comp- -1)||(e.quant_comp=o[s].quant_comp),0!=a?e.quant_comp_short=o[s].quant_comp_s:0<Math.abs(e.quant_comp_short- -1)||(e.quant_comp_short=o[s].quant_comp_s),0!=a?e.msfix=o[s].nsmsfix:0<Math.abs(e.msfix- -1)||(e.msfix=o[s].nsmsfix),0!=a?e.internal_flags.nsPsy.attackthre=o[s].st_lrm:0<Math.abs(e.internal_flags.nsPsy.attackthre- -1)||(e.internal_flags.nsPsy.attackthre=o[s].st_lrm),0!=a?e.internal_flags.nsPsy.attackthre_s=o[s].st_s:0<Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)||(e.internal_flags.nsPsy.attackthre_s=o[s].st_s),0!=a?e.scale=o[s].scale:0<Math.abs(e.scale- -1)||(e.scale=o[s].scale),0!=a?e.maskingadjust=o[s].masking_adj:0<Math.abs(e.maskingadjust-0)||(e.maskingadjust=o[s].masking_adj),0<o[s].masking_adj?0!=a?e.maskingadjust_short=.9*o[s].masking_adj:0<Math.abs(e.maskingadjust_short-0)||(e.maskingadjust_short=.9*o[s].masking_adj):0!=a?e.maskingadjust_short=1.1*o[s].masking_adj:0<Math.abs(e.maskingadjust_short-0)||(e.maskingadjust_short=1.1*o[s].masking_adj),0!=a?e.ATHlower=-o[s].ath_lower/10:0<Math.abs(10*-e.ATHlower-0)||(e.ATHlower=-o[s].ath_lower/10),0!=a?e.ATHcurve=o[s].ath_curve:0<Math.abs(e.ATHcurve- -1)||(e.ATHcurve=o[s].ath_curve),0!=a?e.interChRatio=o[s].interch:0<Math.abs(e.interChRatio- -1)||(e.interChRatio=o[s].interch),t}this.apply_preset=function(e,t,a){switch(t){case Y.R3MIX:t=Y.V3,e.VBR=Me.vbr_mtrh;break;case Y.MEDIUM:t=Y.V4,e.VBR=Me.vbr_rh;break;case Y.MEDIUM_FAST:t=Y.V4,e.VBR=Me.vbr_mtrh;break;case Y.STANDARD:t=Y.V2,e.VBR=Me.vbr_rh;break;case Y.STANDARD_FAST:t=Y.V2,e.VBR=Me.vbr_mtrh;break;case Y.EXTREME:t=Y.V0,e.VBR=Me.vbr_rh;break;case Y.EXTREME_FAST:t=Y.V0,e.VBR=Me.vbr_mtrh;break;case Y.INSANE:return t=320,e.preset=t,s(e,t,a),e.VBR=Me.vbr_off,t}switch(e.preset=t){case Y.V9:return n(e,9,a),t;case Y.V8:return n(e,8,a),t;case Y.V7:return n(e,7,a),t;case Y.V6:return n(e,6,a),t;case Y.V5:return n(e,5,a),t;case Y.V4:return n(e,4,a),t;case Y.V3:return n(e,3,a),t;case Y.V2:return n(e,2,a),t;case Y.V1:return n(e,1,a),t;case Y.V0:return n(e,0,a),t}return 8<=t&&t<=320?s(e,t,a):(e.preset=0,t)}},_=new T,l=new C,f=new y,c=new function(){this.getLameShortVersion=function(){return\"3.98.4\"}},u=new function(){this.setModules=function(e,t){}},h=new function(){var _;this.setModules=function(e){_=e},this.ResvFrameBegin=function(e,t){var a,n=e.internal_flags,s=n.l3_side,r=_.getframebits(e);t.bits=(r-8*n.sideinfo_len)/n.mode_gr;var i=2048*n.mode_gr-8;320<e.brate?me():(a=11520,e.strict_ISO&&me()),n.ResvMax=a-r,n.ResvMax>i&&(n.ResvMax=i),(n.ResvMax<0||e.disable_reservoir)&&(n.ResvMax=0);var o=t.bits*n.mode_gr+Math.min(n.ResvSize,n.ResvMax);return a<o&&(o=a),s.resvDrain_pre=0,null!=n.pinfo&&me(),o},this.ResvMaxBits=function(e,t,a,n){var s,r=e.internal_flags,i=r.ResvSize,o=r.ResvMax;0!=n&&(i+=t),0!=(1&r.substep_shaping)&&(o*=.9),a.bits=t,9*o<10*i?(s=i-9*o/10,a.bits+=s,r.substep_shaping|=128):(s=0,r.substep_shaping&=127,e.disable_reservoir||0!=(1&r.substep_shaping)||(a.bits-=.1*t));var _=i<6*r.ResvMax/10?i:6*r.ResvMax/10;return(_-=s)<0&&(_=0),_},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var a,n=e.l3_side;e.ResvSize+=t*e.mode_gr;var s=0;n.resvDrain_post=0,(n.resvDrain_pre=0)!=(a=e.ResvSize%8)&&(s+=a),0<(a=e.ResvSize-s-e.ResvMax)&&(s+=a);var r=Math.min(8*n.main_data_begin,s)/8;n.resvDrain_pre+=8*r,s-=8*r,e.ResvSize-=8*r,n.main_data_begin-=r,n.resvDrain_post+=s,e.ResvSize-=s}},b=new A,p=new function(){this.setModules=function(e,t,a){}},m=new function(){};s.setModules(r,i,o,_,l,f,c,u,m),i.setModules(r,m,c,f),u.setModules(i,c),o.setModules(s),l.setModules(i,h,_,b),_.setModules(b,h,s.enc.psy),h.setModules(i),b.setModules(_),f.setModules(s,i,c),a.setModules(p,m),p.setModules(c,u,o);var v=s.lame_init();v.num_channels=n,v.in_samplerate=e,v.out_samplerate=e,v.brate=t,v.mode=ye.STEREO,v.quality=3,v.bWriteVbrTag=!1,v.disable_reservoir=!0,v.write_id3tag_automatic=!1,s.lame_init_params(v);var d=1152,g=0|1.25*d+7200,S=w(g);this.encodeBuffer=function(e,t){1==n&&(t=e),e.length>d&&(d=e.length,S=w(g=0|1.25*d+7200));var a=s.lame_encode_buffer(v,e,t,e.length,S,0,g);return new Int8Array(S.subarray(0,a))},this.flush=function(){var e=s.lame_encode_flush(v,S,0,g);return new Int8Array(S.subarray(0,e))}}}t(),e.lamejs=t}((\"object\"==typeof window&&window.document?window:Object).Recorder);"
        },
        {
          "name": "recorder.wav.min.js",
          "type": "blob",
          "size": 26.5712890625,
          "content": "/*\n录音\nhttps://github.com/xiangyuecn/Recorder\nsrc: recorder-core.js,engine/wav.js\n*/\n!function(e){var t=\"object\"==typeof window&&!!window.document,r=t?window:Object;!function(e,w){\"use strict\";var b=function(){},u=function(e){return\"number\"==typeof e},L=function(e){return JSON.stringify(e)},X=function(e){return new c(e)},S=X.LM=\"2024-10-20 22:15\",x=\"https://github.com/xiangyuecn/Recorder\",T=\"Recorder\",M=\"getUserMedia\",G=\"srcSampleRate\",N=\"sampleRate\",i=\"bitRate\",A=\"catch\",t=e[T];if(t&&t.LM==S)return t.CLog(t.i18n.$T(\"K8zP::重复导入{1}\",0,T),3);X.IsOpen=function(){var e=X.Stream;if(e){var t=U(e),r=t[0];if(r){var n=r.readyState;return\"live\"==n||n==r.LIVE}}return!1},X.BufferSize=4096,X.Destroy=function(){for(var e in q(T+\" Destroy\"),F(),r)r[e]()};var r={};X.BindDestroy=function(e,t){r[e]=t},X.Support=function(){if(!w)return!1;var e=navigator.mediaDevices||{};return e[M]||(e=navigator)[M]||(e[M]=e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia),!!e[M]&&(X.Scope=e,!!X.GetContext())},X.GetContext=function(e){if(!w)return null;var t=window.AudioContext;if(t||(t=window.webkitAudioContext),!t)return null;var r=X.Ctx,n=0;return r||(r=X.Ctx=new t,n=1,X.NewCtxs=X.NewCtxs||[],X.BindDestroy(\"Ctx\",function(){var e=X.Ctx;e&&e.close&&(a(e),X.Ctx=0);var t=X.NewCtxs;X.NewCtxs=[];for(var r=0;r<t.length;r++)a(t[r])})),e&&r.close&&(n||(r._useC||a(r),r=new t),r._useC=1,X.NewCtxs.push(r)),r},X.CloseNewCtx=function(e){if(e&&e.close){a(e);for(var t=X.NewCtxs||[],r=t.length,n=0;n<t.length;n++)if(t[n]==e){t.splice(n,1);break}q(Y(\"mSxV::剩{1}个GetContext未close\",0,r+\"-1=\"+t.length),t.length?3:0)}};var a=function(e){if(e&&e.close&&!e._isC&&(e._isC=1,\"closed\"!=e.state))try{e.close()}catch(e){q(\"ctx close err\",1,e)}},R=X.ResumeCtx=function(r,n,a,o){var i=0,s=0,c=0,f=0,u=\"EventListener\",l=\"ResumeCtx \",v=function(e,t){s&&p(),i||(i=1,e&&o(e,f),t&&a(f)),t&&(!r._LsSC&&r[\"add\"+u]&&r[\"add\"+u](\"statechange\",h),r._LsSC=1,c=1)},p=function(e){if(!e||!s){s=e?1:0;for(var t=[\"focus\",\"mousedown\",\"mouseup\",\"touchstart\",\"touchend\"],r=0;r<t.length;r++)window[(e?\"add\":\"remove\")+u](t[r],h,!0)}},h=function(){var e=r.state,t=g(e);if(!i&&!n(t?++f:f))return v();t?(c&&q(l+\"sc \"+e,3),p(1),r.resume().then(function(){c&&q(l+\"sc \"+r.state),v(0,1)})[A](function(e){q(l+\"error\",1,e),g(r.state)||v(e.message||\"error\")})):\"closed\"==e?(c&&!r._isC&&q(l+\"sc \"+e,1),v(\"ctx closed\")):v(0,1)};h()},g=X.CtxSpEnd=function(e){return\"suspended\"==e||\"interrupted\"==e},k=function(e){var t=e.state,r=\"ctx.state=\"+t;return g(t)&&(r+=Y(\"nMIy::（注意：ctx不是running状态，rec.open和start至少要有一个在用户操作(触摸、点击等)时进行调用，否则将在rec.start时尝试进行ctx.resume，可能会产生兼容性问题(仅iOS)，请参阅文档中runningContext配置）\")),r},O=\"ConnectEnableWebM\";X[O]=!0;var D=\"ConnectEnableWorklet\";X[D]=!1;var I=function(e){var c=e.BufferSize||X.BufferSize,f=e.Stream,i=f._c,u=i[N],l={},t=U(f),r=t[0],n=null,a=\"\";if(r&&r.getSettings){var o=(n=r.getSettings())[N];o&&o!=u&&(a=Y(\"eS8i::Stream的采样率{1}不等于{2}，将进行采样率转换（注意：音质不会变好甚至可能变差），主要在移动端未禁用回声消除时会产生此现象，浏览器有回声消除时可能只会返回16k采样率的音频数据，\",0,o,u))}f._ts=n,q(a+\"Stream TrackSet: \"+L(n),a?3:0);var v,s,p,h=function(e){var t=f._m=i.createMediaStreamSource(f),r=i.destination,n=\"createMediaStreamDestination\";i[n]&&(r=f._d=i[n]()),t.connect(e),e.connect(r)},g=\"\",d=f._call,m=function(e,t){for(var r in d){if(t!=u){l.index=0;var n=(l=X.SampleData([e],t,u,l,{_sum:1})).data,a=l._sum}else{l={};for(var o=e.length,n=new Int16Array(o),a=0,i=0;i<o;i++){var s=Math.max(-1,Math.min(1,e[i]));s=s<0?32768*s:32767*s,n[i]=s,a+=Math.abs(s)}}for(var c in d)d[c](n,a);return}},C=\"ScriptProcessor\",_=\"audioWorklet\",y=T+\" \"+_,w=\"RecProc\",b=\"MediaRecorder\",S=b+\".WebM.PCM\",x=i.createScriptProcessor||i.createJavaScriptNode,M=Y(\"ZGlf::。由于{1}内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启{1}。\",0,_),k=function(){s=f.isWorklet=!1,z(f),q(Y(\"7TU0::Connect采用老的{1}，\",0,C)+j.get(Y(X[D]?\"JwCL::但已设置{1}尝试启用{2}\":\"VGjB::可设置{1}尝试启用{2}\",2),[T+\".\"+D+\"=true\",_])+g+M,3);var e=f._p=x.call(i,c,1,1);h(e),e.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);m(t,u)}},I=function(){v=f.isWebM=!1,E(f),s=f.isWorklet=!x||X[D];var t=window.AudioWorkletNode;if(s&&i[_]&&t){var n=function(){return s&&f._na},a=f._na=function(){\"\"!==p&&(clearTimeout(p),p=setTimeout(function(){p=0,n()&&(q(Y(\"MxX1::{1}未返回任何音频，恢复使用{2}\",0,_,C),3),x&&k())},500))},o=function(){if(n()){var e=f._n=new t(i,w,{processorOptions:{bufferSize:c}});h(e),e.port.onmessage=function(e){p&&(clearTimeout(p),p=\"\"),n()?m(e.data.val,u):s||q(Y(\"XUap::{1}多余回调\",0,_),3)},q(Y(\"yOta::Connect采用{1}，设置{2}可恢复老式{3}\",0,_,T+\".\"+D+\"=false\",C)+g+M,3)}},e=function(){if(n())if(i[w])o();else{var e,t,r=(t=\"class \"+w+\" extends AudioWorkletProcessor{\",t+=\"constructor \"+(e=function(e){return e.toString().replace(/^function|DEL_/g,\"\").replace(/\\$RA/g,y)})(function(e){DEL_super(e);var t=this,r=e.processorOptions.bufferSize;t.bufferSize=r,t.buffer=new Float32Array(2*r),t.pos=0,t.port.onmessage=function(e){e.data.kill&&(t.kill=!0,$C.log(\"$RA kill call\"))},$C.log(\"$RA .ctor call\",e)}),t+=\"process \"+e(function(e,t,r){var n=this,a=n.bufferSize,o=n.buffer,i=n.pos;if((e=(e[0]||[])[0]||[]).length){o.set(e,i);var s=~~((i+=e.length)/a)*a;if(s){this.port.postMessage({val:o.slice(0,s)});var c=o.subarray(s,i);(o=new Float32Array(2*a)).set(c),i=c.length,n.buffer=o}n.pos=i}return!n.kill}),t=(t+='}try{registerProcessor(\"'+w+'\", '+w+')}catch(e){$C.error(\"'+y+' Reg Error\",e)}').replace(/\\$C\\./g,\"console.\"),\"data:text/javascript;base64,\"+btoa(unescape(encodeURIComponent(t))));i[_].addModule(r).then(function(e){n()&&(i[w]=1,o(),p&&a())})[A](function(e){q(_+\".addModule Error\",1,e),n()&&k()})}};R(i,function(){return n()},e,e)}else k()};!function(){var e=window[b],t=\"ondataavailable\",r=\"audio/webm; codecs=pcm\";v=f.isWebM=X[O];var n=e&&t in e.prototype&&e.isTypeSupported(r);if(g=n?\"\":Y(\"VwPd::（此浏览器不支持{1}）\",0,S),!v||!n)return I();var a=function(){return v&&f._ra};f._ra=function(){\"\"!==p&&(clearTimeout(p),p=setTimeout(function(){a()&&(q(Y(\"vHnb::{1}未返回任何音频，降级使用{2}\",0,b,_),3),I())},500))};var o=Object.assign({mimeType:r},X.ConnectWebMOptions),i=f._r=new e(f,o),s=f._rd={};i[t]=function(e){var t=new FileReader;t.onloadend=function(){if(a()){var e=P(new Uint8Array(t.result),s);if(!e)return;if(-1==e)return void I();p&&(clearTimeout(p),p=\"\"),m(e,s.webmSR)}else v||q(Y(\"O9P7::{1}多余回调\",0,b),3)},t.readAsArrayBuffer(e.data)},i.start(~~(c/48)),q(Y(\"LMEm::Connect采用{1}，设置{2}可恢复使用{3}或老式{4}\",0,S,T+\".\"+O+\"=false\",_,C))}()},o=function(e){e._na&&e._na(),e._ra&&e._ra()},z=function(e){e._na=null,e._n&&(e._n.port.postMessage({kill:!0}),e._n.disconnect(),e._n=null)},E=function(e){if(e._ra=null,e._r){try{e._r.stop()}catch(e){q(\"mr stop err\",1,e)}e._r=null}},F=function(e){var t=(e=e||X)==X,r=e.Stream;r&&(r._m&&(r._m.disconnect(),r._m=null),!r._RC&&r._c&&X.CloseNewCtx(r._c),r._RC=null,r._c=null,r._d&&(n(r._d.stream),r._d=null),r._p&&(r._p.disconnect(),r._p.onaudioprocess=r._p=null),z(r),E(r),t&&n(r)),e.Stream=0},n=X.StopS_=function(e){for(var t=U(e),r=0;r<t.length;r++){var n=t[r];n.stop&&n.stop()}e.stop&&e.stop()},U=function(e){var t=0,r=0,n=[];e.getAudioTracks&&(t=e.getAudioTracks(),r=e.getVideoTracks()),t||(t=e.audioTracks,r=e.videoTracks);for(var a=0,o=t?t.length:0;a<o;a++)n.push(t[a]);for(var a=0,o=r?r.length:0;a<o;a++)n.push(r[a]);return n};X.SampleData=function(e,t,r,n,a){var o=\"SampleData\";n||(n={});var i=n.index||0,s=n.offset||0,c=n.raisePrev||0,f=n.filter;if(f&&f.fn&&(f.sr&&f.sr!=t||f.srn&&f.srn!=r)&&(f=null,q(Y(\"d48C::{1}的filter采样率变了，重设滤波\",0,o),3)),!f)if(r<=t){var u=3*t/4<r?0:r/2*3/4;f={fn:u?X.IIRFilter(!0,t,u):0}}else{var u=3*r/4<t?0:t/2*3/4;f={fn:u?X.IIRFilter(!0,r,u):0}}f.sr=t,f.srn=r;var l=f.fn,v=n.frameNext||[];a||(a={});var p=a.frameSize||1;a.frameType&&(p=\"mp3\"==a.frameType?1152:1);var h=a._sum,g=0,d=e.length;d+1<i&&q(Y(\"tlbC::{1}似乎传入了未重置chunk {2}\",0,o,i+\">\"+d),3);for(var m=0,C=i;C<d;C++)m+=e[C].length;var _=t/r;if(1<_)m=Math.max(0,m-Math.floor(s)),m=Math.floor(m/_);else if(_<1){var y=1/_;m=Math.floor(m*y)}m+=v.length;for(var w=new Int16Array(m),b=0,C=0;C<v.length;C++)w[b]=v[C],b++;for(;i<d;i++){var S=e[i],x=S instanceof Float32Array,C=s,M=S.length,k=l&&l.Embed,I=0,L=0,T=0,A=0;if(_<1){for(var R=b+C,O=c,D=0;D<M;D++){var z=S[D];x&&(z=(z=Math.max(-1,Math.min(1,z)))<0?32768*z:32767*z);var E=Math.floor(R);R+=y;for(var F=Math.floor(R),G=(z-O)/(F-E),N=1;E<F;E++,N++){var U=Math.floor(O+N*G);k?(T=U,A=k.b0*T+k.b1*k.x1+k.b0*k.x2-k.a1*k.y1-k.a2*k.y2,k.x2=k.x1,k.x1=T,k.y2=k.y1,k.y1=A,U=A):U=l?l(U):U,32767<U?U=32767:U<-32768&&(U=-32768),h&&(g+=Math.abs(U)),w[E]=U,b++}O=c=z,C+=y}s=C%1}else{for(var D=0,P=0;D<M;D++,P++){if(P<M){var z=S[P];x&&(z=(z=Math.max(-1,Math.min(1,z)))<0?32768*z:32767*z),k?(T=z,A=k.b0*T+k.b1*k.x1+k.b0*k.x2-k.a1*k.y1-k.a2*k.y2,k.x2=k.x1,k.x1=T,k.y2=k.y1,k.y1=A):A=l?l(z):z}if(I=L,L=A,0!=P){var W=Math.floor(C);if(D==W){var B=Math.ceil(C),$=C-W,V=I,j=B<M?L:V,H=V+(j-V)*$;32767<H?H=32767:H<-32768&&(H=-32768),h&&(g+=Math.abs(H)),w[b]=H,b++,C+=_}}else D--}s=Math.max(0,C-M)}}_<1&&b+1==m&&(m--,w=new Int16Array(w.buffer.slice(0,2*m))),b-1!=m&&b!=m&&q(o+\" idx:\"+b+\" != size:\"+m,3),v=null;var J=m%p;if(0<J){var K=2*(m-J);v=new Int16Array(w.buffer.slice(K)),w=new Int16Array(w.buffer.slice(0,K))}var Q={index:i,offset:s,raisePrev:c,filter:f,frameNext:v,sampleRate:r,data:w};return h&&(Q._sum=g),Q},X.IIRFilter=function(e,t,r){var n=2*Math.PI*r/t,a=Math.sin(n),o=Math.cos(n),i=a/2,s=1+i,c=-2*o/s,f=(1-i)/s;if(e)var u=(1-o)/2/s,l=(1-o)/s;else var u=(1+o)/2/s,l=-(1+o)/s;var v=0,p=0,h=0,g=0,d=0,m=function(e){return h=u*e+l*v+u*p-c*g-f*d,p=v,v=e,d=g,g=h};return m.Embed={x1:0,x2:0,y1:0,y2:0,b0:u,b1:l,a1:c,a2:f},m},X.PowerLevel=function(e,t){var r=e/t||0;return r<1251?Math.round(r/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(r/1e4)/Math.log(10)))))},X.PowerDBFS=function(e){var t=Math.max(.1,e||0);return t=Math.min(t,32767),t=20*Math.log(t/32767)/Math.log(10),Math.max(-100,Math.round(t))},X.CLog=function(e,t){if(\"object\"==typeof console){var r=new Date,n=(\"0\"+r.getMinutes()).substr(-2)+\":\"+(\"0\"+r.getSeconds()).substr(-2)+\".\"+(\"00\"+r.getMilliseconds()).substr(-3),a=this&&this.envIn&&this.envCheck&&this.id,o=[\"[\"+n+\" \"+T+(a?\":\"+a:\"\")+\"]\"+e],i=arguments,s=X.CLog,c=2,f=s.log||console.log;for(u(t)?f=1==t?s.error||console.error:3==t?s.warn||console.warn:f:c=1;c<i.length;c++)o.push(i[c]);l?f&&f(\"[IsLoser]\"+o[0],1<o.length?o:\"\"):f.apply(console,o)}};var q=function(){X.CLog.apply(this,arguments)},l=!0;try{l=!console.log.apply}catch(e){}var s=0;function c(e){var t=this;t.id=++s,f();var r={type:\"mp3\",onProcess:b};for(var n in e)r[n]=e[n];var a=(t.set=r)[i],o=r[N];(a&&!u(a)||o&&!u(o))&&t.CLog(Y.G(\"IllegalArgs-1\",[Y(\"VtS4::{1}和{2}必须是数值\",0,N,i)]),1,e),r[i]=+a||16,r[N]=+o||16e3,t.state=0,t._S=9,t.Sync={O:9,C:9}}X.Sync={O:9,C:9},X.prototype=c.prototype={CLog:q,_streamStore:function(){return this.set.sourceStream?this:X},_streamGet:function(){return this._streamStore().Stream},_streamCtx:function(){var e=this._streamGet();return e&&e._c},open:function(e,r){var c=this,f=c.set,n=c._streamStore(),a=0;e=e||b;var o=function(e,t){t=!!t,c.CLog(Y(\"5tWi::录音open失败：\")+e+\",isUserNotAllow:\"+t,1),a&&X.CloseNewCtx(a),r&&r(e,t)};c._streamTag=M;var i=function(){c.CLog(\"open ok, id:\"+c.id+\" stream:\"+c._streamTag),e(),c._SO=0},s=n.Sync,u=++s.O,l=s.C;c._O=c._O_=u,c._SO=c._S;if(w){var t=c.envCheck({envName:\"H5\",canProcess:!0});if(t)o(Y(\"A5bm::不能录音：\")+t);else{var v,p=function(){(v=f.runningContext)||(v=a=X.GetContext(!0))};if(f.sourceStream){if(c._streamTag=\"set.sourceStream\",!X.GetContext())return void o(Y(\"1iU7::不支持此浏览器从流中获取录音\"));p(),F(n);var h=c.Stream=f.sourceStream;h._c=v,h._RC=f.runningContext,h._call={};try{I(n)}catch(e){return F(n),void o(Y(\"BTW2::从流中打开录音失败：\")+e.message)}i()}else{var g=function(e,t){try{window.top.a}catch(e){return void o(Y(\"Nclz::无权录音(跨域，请尝试给iframe添加麦克风访问策略，如{1})\",0,'allow=\"camera;microphone\"'))}d(1,e)&&(/Found/i.test(e)?o(t+Y(\"jBa9::，无可用麦克风\")):o(t))},d=function(e,t){if(/Permission|Allow/i.test(t))e&&o(Y(\"gyO5::用户拒绝了录音权限\"),!0);else{if(!1!==window.isSecureContext)return 1;e&&o(Y(\"oWNo::浏览器禁止不安全页面录音，可开启https解决\"))}};if(X.IsOpen())i();else if(X.Support()){p();var m=function(t){setTimeout(function(){t._call={};var e=X.Stream;e&&(F(),t._call=e._call),(X.Stream=t)._c=v,t._RC=f.runningContext,function(){if(l!=s.C||!c._O){var e=Y(\"dFm8::open被取消\");return u==s.O?c.close():e=Y(\"VtJO::open被中断\"),o(e),!0}}()||(X.IsOpen()?(e&&c.CLog(Y(\"upb8::发现同时多次调用open\"),1),I(n),i()):o(Y(\"Q1GA::录音功能无效：无音频流\")))},100)},C=function(e){var t=e.name||e.message||e.code+\":\"+e,r=\"\";1==_&&d(0,t)&&(r=Y(\"KxE2::，将尝试禁用回声消除后重试\")),c.CLog(Y(\"xEQR::请求录音权限错误\")+r+\"|\"+e,r?3:1,e),r?y(1):g(t,Y(\"bDOG::无法录音：\")+e)},_=0,y=function(e){_++;var t=\"audioTrackSet\",r=\"autoGainControl\",n=\"echoCancellation\",a=\"noiseSuppression\",o=JSON.parse(L(f[t]||!0));c.CLog(\"open... \"+_+\" \"+t+\":\"+L(o)),e&&(\"object\"!=typeof o&&(o={}),o[r]=!1,o[n]=!1,o[a]=!1),o[N]&&c.CLog(Y(\"IjL3::注意：已配置{1}参数，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象\",0,t+\".\"+N),3);var i={audio:o,video:f.videoTrackSet||!1};try{var s=X.Scope[M](i,m,C)}catch(e){c.CLog(M,3,e),i={audio:!0,video:!1},s=X.Scope[M](i,m,C)}c.CLog(M+\"(\"+L(i)+\") \"+k(v)+Y(\"RiWe::，未配置 {1} 时浏览器可能会自动启用回声消除，移动端未禁用回声消除时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流），请参阅文档中{2}配置\",0,\"audioTrackSet:{echoCancellation,noiseSuppression,autoGainControl}\",t)+\"(\"+x+\") LM:\"+S+\" UA:\"+navigator.userAgent),s&&s.then&&s.then(m)[A](C)};y()}else g(\"\",Y(\"COxc::此浏览器不支持录音\"))}}}else o(Y.G(\"NonBrowser-1\",[\"open\"])+Y(\"EMJq::，可尝试使用RecordApp解决方案\")+\"(\"+x+\"/tree/master/app-support-sample)\")},close:function(e){e=e||b;var t=this,r=t._streamStore();t._stop();var n=\" stream:\"+t._streamTag,a=r.Sync;if(t._O=0,t._O_!=a.O)return t.CLog(Y(\"hWVz::close被忽略（因为同时open了多个rec，只有最后一个会真正close）\")+n,3),void e();a.C++,F(r),t.CLog(\"close,\"+n),e()},mock:function(e,t){var r=this;return r._stop(),r.isMock=1,r.mockEnvInfo=null,r.buffers=[e],r.recSize=e.length,r._setSrcSR(t),r._streamTag=\"mock\",r},_setSrcSR:function(e){var t=this.set,r=t[N];e<r?t[N]=e:r=0,this[G]=e,this.CLog(G+\": \"+e+\" set.\"+N+\": \"+t[N]+(r?\" \"+Y(\"UHvm::忽略\")+\": \"+r:\"\"),r?3:0)},envCheck:function(e){var t,r=this.set,n=\"CPU_BE\";if(t||X[n]||\"function\"!=typeof Int8Array||new Int8Array(new Int32Array([1]).buffer)[0]||(f(n),t=Y(\"Essp::不支持{1}架构\",0,n)),!t){var a=r.type,o=this[a+\"_envCheck\"];r.takeoffEncodeChunk&&(o?e.canProcess||(t=Y(\"7uMV::{1}环境不支持实时处理\",0,e.envName)):t=Y(\"2XBl::{1}类型不支持设置takeoffEncodeChunk\",0,a)+(this[a]?\"\":Y(\"LG7e::(未加载编码器)\"))),!t&&o&&(t=this[a+\"_envCheck\"](e,r))}return t||\"\"},envStart:function(e,t){var r=this,n=r.set;if(r.isMock=e?1:0,r.mockEnvInfo=e,r.buffers=[],r.recSize=0,e&&(r._streamTag=\"env$\"+e.envName),r.state=1,r.envInLast=0,r.envInFirst=0,r.envInFix=0,r.envInFixTs=[],r._setSrcSR(t),r.engineCtx=0,r[n.type+\"_start\"]){var a=r.engineCtx=r[n.type+\"_start\"](n);a&&(a.pcmDatas=[],a.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(e,t){var a=this,o=a.set,i=a.engineCtx;if(1==a.state){var r=a[G],n=e.length,s=X.PowerLevel(t,n),c=a.buffers,f=c.length;c.push(e);var u=c,l=f,v=Date.now(),p=Math.round(n/r*1e3);a.envInLast=v,1==a.buffers.length&&(a.envInFirst=v-p);var h=a.envInFixTs;h.splice(0,0,{t:v,d:p});for(var g=v,d=0,m=0;m<h.length;m++){var C=h[m];if(3e3<v-C.t){h.length=m;break}g=C.t,d+=C.d}var _=h[1],y=v-g,w=y-d;if(y/3<w&&(_&&1e3<y||6<=h.length)){var b=v-_.t-p;if(p/5<b){var S=!o.disableEnvInFix;if(a.CLog(\"[\"+v+\"]\"+j.get(Y(S?\"4Kfd::补偿{1}ms\":\"bM5i::未补偿{1}ms\",1),[b]),3),a.envInFix+=b,S){var x=new Int16Array(b*r/1e3);n+=x.length,c.push(x)}}}var M=a.recSize,k=n,I=M+k;if(a.recSize=I,i){var L=X.SampleData(c,r,o[N],i.chunkInfo);i.chunkInfo=L,M=i.pcmSize,k=L.data.length,I=M+k,i.pcmSize=I,c=i.pcmDatas,f=c.length,c.push(L.data),r=L[N]}var T=Math.round(I/r*1e3),A=c.length,R=u.length,O=function(){for(var e=D?0:-k,t=null==c[0],r=f;r<A;r++){var n=c[r];null==n?t=1:(e+=n.length,i&&n.length&&a[o.type+\"_encode\"](i,n))}if(t&&i){var r=l;for(u[0]&&(r=0);r<R;r++)u[r]=null}t&&(e=D?k:0,c[0]=null),i?i.pcmSize+=e:a.recSize+=e},D=0,z=\"rec.set.onProcess\";try{D=o.onProcess(c,s,T,r,f,O)}catch(e){console.error(z+Y(\"gFUF::回调出错是不允许的，需保证不会抛异常\"),e)}var E=Date.now()-v;if(10<E&&1e3<a.envInFirst-v&&a.CLog(z+Y(\"2ghS::低性能，耗时{1}ms\",0,E),3),!0===D){for(var F=0,m=f;m<A;m++)null==c[m]?F=1:c[m]=new Int16Array(0);F?a.CLog(Y(\"ufqH::未进入异步前不能清除buffers\"),3):i?i.pcmSize-=k:a.recSize-=k}else O()}else a.state||a.CLog(\"envIn at state=0\",3)},start:function(){var t=this,e=1;if(t.set.sourceStream?t.Stream||(e=0):X.IsOpen()||(e=0),e){var r=t._streamCtx();if(t.CLog(Y(\"kLDN::start 开始录音，\")+k(r)+\" stream:\"+t._streamTag),t._stop(),t.envStart(null,r[N]),t.state=3,t._SO&&t._SO+1!=t._S)t.CLog(Y(\"Bp2y::start被中断\"),3);else{t._SO=0;var n=function(){3==t.state&&(t.state=1,t.resume())},a=\"AudioContext resume: \",o=t._streamGet();o._call[t.id]=function(){t.CLog(a+r.state+\"|stream ok\"),n()},R(r,function(e){return e&&t.CLog(a+\"wait...\"),3==t.state},function(e){e&&t.CLog(a+r.state),n()},function(e){t.CLog(a+r.state+Y(\"upkE::，可能无法录音：\")+e,1),n()})}}else t.CLog(Y(\"6WmN::start失败：未open\"),1)},pause:function(){var e=this,t=e._streamGet();e.state&&(e.state=2,e.CLog(\"pause\"),t&&delete t._call[e.id])},resume:function(){var r=this,t=r._streamGet(),n=\"resume(wait ctx)\";if(3==r.state)r.CLog(n);else if(r.state){r.state=1,r.CLog(\"resume\"),r.envResume(),t&&(t._call[r.id]=function(e,t){1==r.state&&r.envIn(e,t)},o(t));var a=r._streamCtx();a&&R(a,function(e){return e&&r.CLog(n+\"...\"),1==r.state},function(e){e&&r.CLog(n+a.state),o(t)},function(e){r.CLog(n+a.state+\"[err]\"+e,1)})}},_stop:function(e){var t=this,r=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!e&&t[r.type+\"_stop\"]&&(t[r.type+\"_stop\"](t.engineCtx),t.engineCtx=0)},stop:function(l,t,e){var v,p=this,h=p.set,r=p.envInLast-p.envInFirst,n=r&&p.buffers.length;p.CLog(Y(\"Xq4s::stop 和start时差:\")+(r?r+\"ms \"+Y(\"3CQP::补偿:\")+p.envInFix+\"ms envIn:\"+n+\" fps:\"+(n/r*1e3).toFixed(1):\"-\")+\" stream:\"+p._streamTag+\" (\"+x+\") LM:\"+S);var g=function(){p._stop(),e&&p.close()},d=function(e){p.CLog(Y(\"u8JG::结束录音失败：\")+e,1),t&&t(e),g()},a=function(e,t,r){var n=\"arraybuffer\",a=\"dataType\",o=\"DefaultDataType\",i=p[a]||X[o]||\"blob\",s=a+\"=\"+i,c=e instanceof ArrayBuffer,f=0,u=c?e.byteLength:e.size;if(i==n?c||(f=1):\"blob\"==i?\"function\"!=typeof Blob?f=Y.G(\"NonBrowser-1\",[s])+Y(\"1skY::，请设置{1}\",0,T+\".\"+o+'=\"'+n+'\"'):(c&&(e=new Blob([e],{type:t})),e instanceof Blob||(f=1),t=e.type||t):f=Y.G(\"NotSupport-1\",[s]),p.CLog(Y(\"Wv7l::结束录音 编码花{1}ms 音频时长{2}ms 文件大小{3}b\",0,Date.now()-v,r,u)+\" \"+s+\",\"+t),f)d(1!=f?f:Y(\"Vkbd::{1}编码器返回的不是{2}\",0,h.type,i)+\", \"+s);else{if(h.takeoffEncodeChunk)p.CLog(Y(\"QWnr::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据\"),3);else if(u<Math.max(50,r/5))return void d(Y(\"Sz2H::生成的{1}无效\",0,h.type));l&&l(e,r,t),g()}};if(!p.isMock){var o=3==p.state;if(!p.state||o)return void d(Y(\"wf9t::未开始录音\")+(o?Y(\"Dl2c::，开始录音前无用户交互导致AudioContext未运行\"):\"\"))}p._stop(!0);var i=p.recSize;if(i)if(p[h.type]){if(p.isMock){var s=p.envCheck(p.mockEnvInfo||{envName:\"mock\",canProcess:!1});if(s)return void d(Y(\"AxOH::录音错误：\")+s)}var c=p.engineCtx;if(p[h.type+\"_complete\"]&&c){var f=Math.round(c.pcmSize/h[N]*1e3);return v=Date.now(),void p[h.type+\"_complete\"](c,function(e,t){a(e,t,f)},d)}if(v=Date.now(),p.buffers[0]){var u=X.SampleData(p.buffers,p[G],h[N]);h[N]=u[N];var m=u.data,f=Math.round(m.length/h[N]*1e3);p.CLog(Y(\"CxeT::采样:{1} 花:{2}ms\",0,i+\"->\"+m.length,Date.now()-v)),setTimeout(function(){v=Date.now(),p[h.type](m,function(e,t){a(e,t,f)},function(e){d(e)})})}else d(Y(\"xkKd::音频buffers被释放\"))}else d(Y(\"xGuI::未加载{1}编码器，请尝试到{2}的src/engine内找到{1}的编码器并加载\",0,h.type,T));else d(Y(\"Ltz3::未采集到录音\"))}};var P=function(e,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var r=t.tracks,n=[t.pos[0]],a=function(){t.pos[0]=n[0]},o=t.bytes.length,i=new Uint8Array(o+e.length);if(i.set(t.bytes),i.set(e,o),t.bytes=i,!t._ht){if($(i,n),V(i,n),!W($(i,n),[24,83,128,103]))return;for($(i,n);n[0]<i.length;){var s=$(i,n),c=V(i,n),f=[0],u=0;if(!c)return;if(W(s,[22,84,174,107])){for(;f[0]<c.length;){var l=$(c,f),v=V(c,f),p=[0],h={channels:0,sampleRate:0};if(W(l,[174]))for(;p[0]<v.length;){var g=$(v,p),d=V(v,p),m=[0];if(W(g,[215])){var C=B(d);h.number=C,r[C]=h}else if(W(g,[131])){var C=B(d);1==C?h.type=\"video\":2==C?(h.type=\"audio\",u||(t.track0=h),h.idx=u++):h.type=\"Type-\"+C}else if(W(g,[134])){for(var _=\"\",y=0;y<d.length;y++)_+=String.fromCharCode(d[y]);h.codec=_}else if(W(g,[225]))for(;m[0]<d.length;){var w=$(d,m),b=V(d,m);if(W(w,[181])){var C=0,S=new Uint8Array(b.reverse()).buffer;4==b.length?C=new Float32Array(S)[0]:8==b.length?C=new Float64Array(S)[0]:q(\"WebM Track !Float\",1,b),h[N]=Math.round(C)}else W(w,[98,100])?h.bitDepth=B(b):W(w,[159])&&(h.channels=B(b))}}}t._ht=1,q(\"WebM Tracks\",r),a();break}}}var x=t.track0;if(x){var M=x[N];if(t.webmSR=M,16==x.bitDepth&&/FLOAT/i.test(x.codec)&&(x.bitDepth=32,q(\"WebM 16->32 bit\",3)),M<8e3||32!=x.bitDepth||x.channels<1||!/(\\b|_)PCM\\b/i.test(x.codec))return t.bytes=[],t.bad||q(\"WebM Track Unexpected\",3,t),-(t.bad=1);for(var k=[],I=0;n[0]<i.length;){var l=$(i,n),v=V(i,n);if(!v)break;if(W(l,[163])){var L=15&v[0],h=r[L];if(h){if(0===h.idx){for(var T=new Uint8Array(v.length-4),y=4;y<v.length;y++)T[y-4]=v[y];k.push(T),I+=T.length}}else q(\"WebM !Track\"+L,1,r)}a()}if(I){var A=new Uint8Array(i.length-t.pos[0]);A.set(i.subarray(t.pos[0])),t.bytes=A,t.pos[0]=0;for(var T=new Uint8Array(I),y=0,R=0;y<k.length;y++)T.set(k[y],R),R+=k[y].length;var S=new Float32Array(T.buffer);if(1<x.channels){for(var O=[],y=0;y<S.length;)O.push(S[y]),y+=x.channels;S=new Float32Array(O)}return S}}},W=function(e,t){if(!e||e.length!=t.length)return!1;if(1==e.length)return e[0]==t[0];for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0},B=function(e){for(var t=\"\",r=0;r<e.length;r++){var n=e[r];t+=(n<16?\"0\":\"\")+n.toString(16)}return parseInt(t,16)||0},$=function(e,t,r){var n=t[0];if(!(n>=e.length)){var a=e[n],o=(\"0000000\"+a.toString(2)).substr(-8),i=/^(0*1)(\\d*)$/.exec(o);if(i){var s=i[1].length,c=[];if(!(n+s>e.length)){for(var f=0;f<s;f++)c[f]=e[n],n++;return r&&(c[0]=parseInt(i[2]||\"0\",2)),t[0]=n,c}}}},V=function(e,t){var r=$(e,t,1);if(r){var n=B(r),a=t[0],o=[];if(n<2147483647){if(a+n>e.length)return;for(var i=0;i<n;i++)o[i]=e[a],a++}return t[0]=a,o}},j=X.i18n={lang:\"zh-CN\",alias:{\"zh-CN\":\"zh\",\"en-US\":\"en\"},locales:{},data:{},put:function(e,t){var r=T+\".i18n.put: \",n=e.overwrite;n=null==n||n;var a=e.lang;if(!(a=j.alias[a]||a))throw new Error(r+\"set.lang?\");var o=j.locales[a];o||(o={},j.locales[a]=o);for(var i,s=/^([\\w\\-]+):/,c=0;c<t.length;c++){var f=t[c];if(i=s.exec(f)){var u=i[1],f=f.substr(u.length+1);!n&&o[u]||(o[u]=f)}else q(r+\"'key:'? \"+f,3,e)}},get:function(){return j.v_G.apply(null,arguments)},v_G:function(n,a,e){a=a||[],e=e||j.lang,e=j.alias[e]||e;var t=j.locales[e],o=t&&t[n]||\"\";return o||\"zh\"==e?(j.lastLang=e,\"=Empty\"==o?\"\":o.replace(/\\{(\\d+)(\\!?)\\}/g,function(e,t,r){return e=a[(t=+t||0)-1],(t<1||t>a.length)&&(e=\"{?}\",q(\"i18n[\"+n+\"] no {\"+t+\"}: \"+o,3)),r?\"\":e})):\"en\"==e?j.v_G(n,a,\"zh\"):j.v_G(n,a,\"en\")},$T:function(){return j.v_T.apply(null,arguments)},v_T:function(){for(var e,t=arguments,r=\"\",n=[],a=0,o=T+\".i18n.$T:\",i=/^([\\w\\-]*):/,s=0;s<t.length;s++){var c=t[s];if(0==s){if(e=i.exec(c),!(r=e&&e[1]))throw new Error(o+\"0 'key:'?\");c=c.substr(r.length+1)}if(-1===a)n.push(c);else{if(a)throw new Error(o+\" bad args\");if(0===c)a=-1;else if(u(c)){if(c<1)throw new Error(o+\" bad args\");a=c}else{var f=1==s?\"en\":s?\"\":\"zh\";if((e=i.exec(c))&&(f=e[1]||f,c=c.substr(e[1].length+1)),!e||!f)throw new Error(o+s+\" 'lang:'?\");j.put({lang:f,overwrite:!1},[r+\":\"+c])}}}return r?0<a?r:j.v_G(r,n):\"\"}},Y=j.$T;Y.G=j.get,Y(\"NonBrowser-1::非浏览器环境，不支持{1}\",1),Y(\"IllegalArgs-1::参数错误：{1}\",1),Y(\"NeedImport-2::调用{1}需要先导入{2}\",2),Y(\"NotSupport-1::不支持：{1}\",1),X.TrafficImgUrl=\"//ia.51.la/go1?id=20469973&pvFlag=1\";var f=X.Traffic=function(e){if(w){e=e?\"/\"+T+\"/Report/\"+e:\"\";var t=X.TrafficImgUrl;if(t){var r=X.Traffic,n=/^(https?:..[^\\/#]*\\/?)[^#]*/i.exec(location.href)||[],a=n[1]||\"http://file/\",o=(n[0]||a)+e;if(0==t.indexOf(\"//\")&&(t=/^https:/i.test(o)?\"https:\"+t:\"http:\"+t),e&&(t=t+\"&cu=\"+encodeURIComponent(a+e)),!r[o]){r[o]=1;var i=new Image;i.src=t,q(\"Traffic Analysis Image: \"+(e||T+\".TrafficImgUrl=\"+X.TrafficImgUrl))}}}};t&&(q(Y(\"8HO5::覆盖导入{1}\",0,T),1),t.Destroy());e[T]=X}(r,t),\"function\"==typeof define&&define.amd&&define(function(){return r.Recorder}),\"object\"==typeof module&&module.exports&&(module.exports=r.Recorder)}(),function(e){var t=\"object\"==typeof window&&!!window.document,r=(t?window:Object).Recorder,n=r.i18n;!function(p,e,h,t){\"use strict\";p.prototype.enc_wav={stable:!0,fast:!0,getTestMsg:function(){return h(\"gPSE::支持位数8位、16位（填在比特率里面），采样率取值无限制；此编码器仅在pcm数据前加了一个44字节的wav头，编码出来的16位wav文件去掉开头的44字节即可得到pcm（注：其他wav编码器可能不是44字节）\")}};p.prototype.wav=function(e,t,r){var n=this.set;!function(e){var t=e.bitRate,r=8==t?8:16;t!=r&&p.CLog(h(\"wyw9::WAV Info: 不支持{1}位，已更新成{2}位\",0,t,r),3);e.bitRate=r}(n);var a=e.length,o=n.sampleRate,i=n.bitRate,s=a*(i/8),c=p.wav_header(1,1,o,i,s),f=c.length,u=new Uint8Array(f+s);if(u.set(c),8==i)for(var l=0;l<a;l++){var v=128+(e[l]>>8);u[f++]=v}else(u=new Int16Array(u.buffer)).set(e,f/2);t(u.buffer,\"audio/wav\")},p.wav_header=function(e,t,r,n,a){var o=1==e?0:2,i=new ArrayBuffer(44+o),s=new DataView(i),c=0,f=function(e){for(var t=0;t<e.length;t++,c++)s.setUint8(c,e.charCodeAt(t))},u=function(e){s.setUint16(c,e,!0),c+=2},l=function(e){s.setUint32(c,e,!0),c+=4};return f(\"RIFF\"),l(36+o+a),f(\"WAVE\"),f(\"fmt \"),l(16+o),u(e),u(t),l(r),l(r*(t*n/8)),u(t*n/8),u(n),1!=e&&u(0),f(\"data\"),l(a),new Uint8Array(i)}}(r,0,n.$T)}();"
        },
        {
          "name": "src",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}