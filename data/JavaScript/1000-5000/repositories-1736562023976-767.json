{
  "metadata": {
    "timestamp": 1736562023976,
    "page": 767,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjc3MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "jin-yufeng/mp-html",
      "stars": 3356,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".eslintignore",
          "type": "blob",
          "size": 0.009765625,
          "content": "*.min.js\r\n"
        },
        {
          "name": ".eslintrc.json",
          "type": "blob",
          "size": 0.4921875,
          "content": "{\n  \"env\": {\n    \"browser\": true,\n    \"es6\": true,\n    \"node\": true\n  },\n  \"extends\": [\n    \"eslint:recommended\",\n    \"plugin:vue/essential\"\n  ],\n  \"globals\": {\n    \"Component\": \"readonly\",\n    \"wx\": \"readonly\",\n    \"qq\": \"readonly\",\n    \"swan\": \"readonly\",\n    \"my\": \"readonly\",\n    \"tt\": \"readonly\",\n    \"uni\": \"readonly\",\n    \"plus\": \"readonly\",\n    \"weex\": \"readonly\",\n    \"requirePlugin\": \"readonly\"\n  },\n  \"rules\": {\n    \"semi\": [\n      \"error\",\n      \"never\"\n    ],\n    \"no-console\": \"error\"\n  }\n}"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.0556640625,
          "content": "node_modules/\r\ncoverage/\r\ndev/\r\nyarn.lock\r\n*.yml\r\n*.psd\r\n"
        },
        {
          "name": ".npmignore",
          "type": "blob",
          "size": 0.0556640625,
          "content": "node_modules/\r\ncoverage/\r\ndev/\r\nyarn.lock\r\n*.yml\r\n*.psd\r\n"
        },
        {
          "name": ".stylelintrc.json",
          "type": "blob",
          "size": 0.09375,
          "content": "{\r\n  \"extends\": [\r\n    \"stylelint-config-standard\",\r\n    \"stylelint-config-recess-order\"\r\n  ]\r\n}"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.0498046875,
          "content": "MIT License\n\nCopyright (c) 2019-present Jin Yufeng\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 12.2392578125,
          "content": "# mp-html\r\n\r\n> 一个强大的小程序富文本组件\r\n\r\n![star](https://img.shields.io/github/stars/jin-yufeng/mp-html)\r\n![forks](https://img.shields.io/github/forks/jin-yufeng/mp-html)\r\n[![npm](https://img.shields.io/npm/v/mp-html)](https://www.npmjs.com/package/mp-html)\r\n![downloads](https://img.shields.io/npm/dt/mp-html)\r\n[![Coverage Status](https://coveralls.io/repos/github/jin-yufeng/mp-html/badge.svg?branch=master)](https://coveralls.io/github/jin-yufeng/mp-html?branch=master)\r\n![license](https://img.shields.io/github/license/jin-yufeng/mp-html)\r\n[![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)\r\n\r\n## 功能介绍\r\n- 支持在多个主流的小程序平台和 `uni-app` 中使用\r\n- 支持丰富的标签（包括 `table`、`video`、`svg` 等）\r\n- 支持丰富的事件效果（自动预览图片、链接处理等）\r\n- 支持设置占位图（加载中、出错时、预览时）\r\n- 支持锚点跳转、长按复制等丰富功能\r\n- 支持大部分 *html* 实体\r\n- 丰富的插件（关键词搜索、内容编辑、`latex` 公式等）\r\n- 效率高、容错性强且轻量化（`≈25KB`，`9KB gzipped`）\r\n\r\n查看 [功能介绍](https://jin-yufeng.gitee.io/mp-html/#/overview/feature) 了解更多\r\n\r\n## 使用方法\r\n### 原生平台\r\n- `npm` 方式\r\n  1. 在项目目录下安装组件包\r\n\r\n     ```bash\r\n     npm install mp-html\r\n     ```\r\n  2. 开发者工具中勾选 `使用 npm 模块`（若没有此选项则不需要）并点击 `工具 - 构建 npm`\r\n  3. 在需要使用页面的 `json` 文件中添加\r\n\r\n     ```json\r\n     {\r\n       \"usingComponents\": {\r\n         \"mp-html\": \"mp-html\"\r\n       }\r\n     }\r\n     ```\r\n  4. 在需要使用页面的 `wxml` 文件中添加\r\n\r\n     ```html\r\n     <mp-html content=\"{{html}}\" />\r\n     ```\r\n  5. 在需要使用页面的 `js` 文件中添加\r\n\r\n     ```javascript\r\n     Page({\r\n       onLoad () {\r\n         this.setData({\r\n           html: '<div>Hello World!</div>'\r\n         })\r\n       }\r\n     })\r\n     ```\r\n- 源码方式\r\n  1. 将源码中对应平台的代码包（`dist/platform`）拷贝到 `components` 目录下，更名为 `mp-html`\r\n  2. 在需要使用页面的 `json` 文件中添加\r\n\r\n     ```json\r\n     {\r\n       \"usingComponents\": {\r\n         \"mp-html\": \"/components/mp-html/index\"\r\n       }\r\n     }\r\n     ```\r\n  \r\n  后续步骤同上\r\n\r\n查看 [快速开始](https://jin-yufeng.gitee.io/mp-html/#/overview/quickstart) 了解更多\r\n\r\n### uni-app\r\n- 源码方式\r\n  1. 将源码中 `dist/uni-app` 内的内容拷贝到项目根目录下  \r\n     可以直接通过 [插件市场](https://ext.dcloud.net.cn/plugin?id=805) 引入\r\n  2. 在需要使用页面的 `vue` 文件中添加\r\n\r\n     ```vue\r\n     <template>\r\n       <view>\r\n         <mp-html :content=\"html\" />\r\n       </view>\r\n     </template>\r\n     <script>\r\n       import mpHtml from '@/components/mp-html/mp-html'\r\n       export default {\r\n         // HBuilderX 2.5.5+ 可以通过 easycom 自动引入\r\n         components: {\r\n           mpHtml\r\n         },\r\n         data () {\r\n           return {\r\n             html: '<div>Hello World!</div>'\r\n           }\r\n         }\r\n       }\r\n     </script>\r\n     ```\r\n- `npm` 方式\r\n  1. 在项目目录下安装组件包\r\n\r\n     ```bash\r\n     npm install mp-html\r\n     ```\r\n  2. 在需要使用页面的 `vue` 文件中添加\r\n\r\n     ```vue\r\n     <template>\r\n       <view>\r\n         <mp-html :content=\"html\" />\r\n       </view>\r\n     </template>\r\n     <script>\r\n       import mpHtml from 'mp-html/dist/uni-app/components/mp-html/mp-html'\r\n       export default {\r\n         // 不可省略\r\n         components: {\r\n           mpHtml\r\n         },\r\n         data () {\r\n           return {\r\n             html: '<div>Hello World!</div>'\r\n           }\r\n         }\r\n       }\r\n     </script>\r\n     ```\r\n\r\n  使用 `cli` 方式运行的项目，通过 `npm` 方式引入时，需要在 `vue.config.js` 中配置 `transpileDependencies`，详情可见 [#330](https://github.com/jin-yufeng/mp-html/issues/330#issuecomment-913617687)  \r\n  如果在 `nvue` 中使用还要将 `dist/uni-app/static` 目录下的内容拷贝到项目的 `static` 目录下，否则无法运行  \r\n\r\n查看 [快速开始](https://jin-yufeng.gitee.io/mp-html/#/overview/quickstart) 了解更多\r\n\r\n## 组件属性\r\n\r\n| 属性 | 类型 | 默认值 | 说明 |\r\n|:---:|:---:|:---:|---|\r\n| container-style | String |  | 容器的样式（[2.1.0+](https://jin-yufeng.gitee.io/mp-html/#/changelog/changelog#v210)） |\r\n| content | String |  | 用于渲染的 html 字符串 |\r\n| copy-link | Boolean | true | 是否允许外部链接被点击时自动复制 |\r\n| domain | String |  | 主域名（用于链接拼接） |\r\n| error-img | String |  | 图片出错时的占位图链接 |\r\n| lazy-load | Boolean | false | 是否开启图片懒加载 |\r\n| loading-img | String |  | 图片加载过程中的占位图链接 |\r\n| pause-video | Boolean | true | 是否在播放一个视频时自动暂停其他视频 |\r\n| preview-img | Boolean | true | 是否允许图片被点击时自动预览 |\r\n| scroll-table | Boolean | false | 是否给每个表格添加一个滚动层使其能单独横向滚动 |\r\n| selectable | Boolean | false | 是否开启文本长按复制 |\r\n| set-title | Boolean | true | 是否将 title 标签的内容设置到页面标题 |\r\n| show-img-menu | Boolean | true | 是否允许图片被长按时显示菜单 |\r\n| tag-style | Object |  | 设置标签的默认样式 |\r\n| use-anchor | Boolean | false | 是否使用锚点链接 |\r\n\r\n查看 [属性](https://jin-yufeng.gitee.io/mp-html/#/basic/prop) 了解更多\r\n\r\n## 组件事件\r\n\r\n| 名称 | 触发时机 |\r\n|:---:|---|\r\n| load | dom 树加载完毕时 |\r\n| ready | 图片加载完毕时 |\r\n| error | 发生渲染错误时 |\r\n| imgtap | 图片被点击时 |\r\n| linktap | 链接被点击时 |\r\n\r\n查看 [事件](https://jin-yufeng.gitee.io/mp-html/#/basic/event) 了解更多\r\n\r\n## api\r\n组件实例上提供了一些 `api` 方法可供调用\r\n\r\n| 名称 | 作用 |\r\n|:---:|---|\r\n| in | 将锚点跳转的范围限定在一个 scroll-view 内 |\r\n| navigateTo | 锚点跳转 |\r\n| getText | 获取文本内容 |\r\n| getRect | 获取富文本内容的位置和大小 |\r\n| setContent | 设置富文本内容 |\r\n| imgList | 获取所有图片的数组 |\r\n| pauseMedia | 暂停播放音视频（[2.2.2+](https://jin-yufeng.gitee.io/mp-html/#/changelog/changelog#v222)） |\r\n| setPlaybackRate | 设置音视频播放速率（[2.4.0+](https://jin-yufeng.gitee.io/mp-html/#/changelog/changelog#v240)） |\r\n\r\n查看 [api](https://jin-yufeng.gitee.io/mp-html/#/advanced/api) 了解更多\r\n\r\n## 插件扩展  \r\n除基本功能外，本组件还提供了丰富的扩展，可按照需要选用\r\n\r\n| 名称 | 作用 |\r\n|:---:|---|\r\n| audio | 音乐播放器 |\r\n| editable | 富文本编辑 |\r\n| emoji | 解析 emoji |\r\n| highlight | 代码块高亮显示 |\r\n| markdown | 渲染 markdown |\r\n| search | 关键词搜索 |\r\n| style | 匹配 style 标签中的样式 |\r\n| txv-video | 使用腾讯视频 |\r\n| img-cache | 图片缓存 by [@PentaTea](https://github.com/PentaTea) |\r\n| latex | 渲染 latex 公式 by [@Zeng-J](https://github.com/Zeng-J) |\r\n| card | 卡片展示 by [@whoooami](https://github.com/whoooami) |\r\n\r\n查看 [插件](https://jin-yufeng.gitee.io/mp-html/#/advanced/plugin) 了解更多\r\n\r\n## 使用案例\r\n\r\n| [官方示例](https://github.com/jin-yufeng/mp-html-demo) | 欢喜商城 | 多么生活 | 食法查 | 微慕 | 古典文学名著阅读 |\r\n|:---:|:---:|:---:|:---:|:---:|:---:|\r\n| ![富文本插件](docs/assets/case/富文本插件.jpg) | ![欢喜商城](docs/assets/case/欢喜商城.png) | ![多么生活](docs/assets/case/多么生活.jpg) | ![食法查](docs/assets/case/食法查.png) | ![微慕](docs/assets/case/微慕.jpg) | ![古典文学名著阅读](docs/assets/case/古典文学名著阅读.jpg) |\r\n\r\n| 科学复习 | [程序员技术之旅](https://github.com/fendoudebb/z-blog-wx) | 典典博客 | 优秀笔记 | 365 刷题 | 同城共享书 |\r\n|:---:|:---:|:---:|:---:|:---:|:---:|\r\n| ![科学复习](docs/assets/case/科学复习.png) | ![程序员技术之旅](docs/assets/case/程序员技术之旅.jpg) | ![典典博客](docs/assets/case/典典博客.jpg) | ![优秀笔记](docs/assets/case/优秀笔记.jpg) | ![365刷题](docs/assets/case/365刷题.jpg) | ![同城共享书](docs/assets/case/同城共享书.jpg) |\r\n\r\n| [技术源 share](https://github.com/wangsrGit119/mini-blog-halo) | 你的代码写的真棒 | 谛否 | 小莫唐尼 | [模版演示](https://github.com/zhihuifanqiechaodan/miniprogram-template) | AI瓦力 |\r\n|:---:|:---:|:---:|:---:|:---:|:---:|\r\n| ![技术源share](docs/assets/case/技术源share.jpg) | ![你的代码写的真棒](docs/assets/case/你的代码写的真棒.jpg) | ![谛否](docs/assets/case/谛否.jpg) | ![小莫唐尼](docs/assets/case/小莫唐尼.png) | ![MiniProgram模版演示](docs/assets/case/MiniProgram模版演示.jpg) | ![AI瓦力](docs/assets/case/AI瓦力.jpg) |\r\n\r\n以上排名不分先后，更多可见 [使用案例收集](https://github.com/jin-yufeng/mp-html/issues/27)（欢迎添加）  \r\n\r\n## 许可与支持\r\n- 许可  \r\n  您可以免费的使用（包括商用）、复制或修改本组件 [MIT License](https://github.com/jin-yufeng/mp-html/blob/master/LICENSE)  \r\n  在用于生产环境前务必经过充分测试，由插件 `bug` 带来的损失概不负责（可以自行修改源码）  \r\n\r\n- 联系  \r\n  欢迎加入 `QQ` 交流群：  \r\n  群1（已满）：`699734691`  \r\n  群2（已满）：`778239129`  \r\n  群3：`960265313`  \r\n  ![group](docs/assets/group.jpg)  \r\n\r\n- 支持  \r\n  ![支持](docs/assets/sponsor.png)   \r\n\r\n## 更新日志\r\n- v2.5.0 (20240422)\r\n  1. `U` `play` 事件增加返回 `src` 等信息 [详细](https://github.com/jin-yufeng/mp-html/issues/526)\r\n  2. `U` `preview-img` 属性支持设置为 `all` 开启 `base64` 图片预览 [详细](https://github.com/jin-yufeng/mp-html/issues/536)\r\n  3. `U` `editable` 插件增加简易模式（点击文字直接编辑）\r\n  4. `U` `latex` 插件支持块级公式 [详细](https://github.com/jin-yufeng/mp-html/issues/582)\r\n  5. `F` 修复了表格部分情况下背景丢失的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/587)\r\n  6. `F` 修复了部分 `svg` 无法显示的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/591)\r\n  7. `F` 修复了 `uni-app` 包 `h5` 和 `app` 端部分情况下样式无法识别的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/518)\r\n  8. `F` 修复了 `latex` 插件部分情况下显示不正确的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/580)\r\n  9. `F` 修复了 `editable` 插件表格无法删除的问题\r\n  10. `F` 修复了 `editable` 插件 `uni-app` 包 `vue3` `h5` 端点击图片报错的问题\r\n  11. `F` 修复了 `editable` 插件 `uni-app` 包点击表格没有菜单栏的问题\r\n\r\n- v2.4.3 (20240121)\r\n  1. `A` 增加 [card](https://jin-yufeng.gitee.io/mp-html/#/advanced/plugin#card) 插件 [详细](https://github.com/jin-yufeng/mp-html/pull/533) by [@whoooami](https://github.com/whoooami)\r\n  2. `F` 修复了 `svg` 中包含 `foreignobject` 可能不显示的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/523)\r\n  3. `F` 修复了合并单元格的表格部分情况下显示不正确的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/561)\r\n  4. `F` 修复了 `img` 标签设置 `object-fit` 无效的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/567)\r\n  5. `F` 修复了 `latex` 插件公式会换行的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/540) \r\n  6. `F` 修复了 `uni-app` 包 `editable` 和 `audio` 插件共用时点击 `audio` 无法编辑的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/529) by [@whoooami](https://github.com/whoooami)\r\n  7. `F` 修复了支付宝小程序设置了宽高的图片可能显示不正常的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/544)\r\n  8. `F` 修复了 `uni-app` 包微信小程序部分情况下图片会报错 `replace of undefined` 的问题\r\n  9. `F` 修复了 `uni-app` 包快手小程序图片不显示的问题 [详细](https://github.com/jin-yufeng/mp-html/issues/571)\r\n\r\n  从 `1.x` 的升级方法可见 [更新指南](https://jin-yufeng.gitee.io/mp-html/#/changelog/changelog?id=v200)\r\n\r\n查看 [更新日志](https://jin-yufeng.gitee.io/mp-html/#/changelog/changelog) 了解更多\r\n"
        },
        {
          "name": "dist",
          "type": "tree",
          "content": null
        },
        {
          "name": "docs",
          "type": "tree",
          "content": null
        },
        {
          "name": "gulpfile.js",
          "type": "blob",
          "size": 3.806640625,
          "content": "/**\r\n * @fileoverview 自动构建程序\r\n * @author Jin Yufeng\r\n */\r\n\r\n// 载入 gulp 插件\r\nconst gulp = require('gulp')\r\nconst htmlmin = require('gulp-htmlmin')\r\nconst babel = require('gulp-babel')\r\nconst uglify = require('gulp-uglify')\r\nconst cleanCss = require('gulp-clean-css')\r\nconst clean = require('gulp-clean')\r\nconst gulpif = require('gulp-if')\r\nconst plumber = require('gulp-plumber')\r\nconst size = require('gulp-size')\r\n\r\n// 载入构建工具\r\nconst config = require('./tools/config')\r\nconst converter = require('./tools/converter')\r\nconst ifdef = require('./tools/ifdef')\r\nconst minifier = require('./tools/minifier')\r\nconst plugin = require('./tools/plugin')\r\n\r\n// 载入环境信息\r\nconst isDev = process.argv.includes('--dev')\r\nlet platform = process.argv[3]\r\nif (!platform) {\r\n  throw Error('缺少平台信息')\r\n}\r\nplatform = platform.substr(2)\r\n\r\n/**\r\n * @description 清理文件夹\r\n */\r\ngulp.task('clean', () => {\r\n  return gulp.src(`${isDev ? 'dev' : 'dist'}/${platform === 'all' ? '' : platform + '/'}*`, {\r\n    read: false,\r\n    allowEmpty: true\r\n  })\r\n    .pipe(clean())\r\n})\r\n\r\n/**\r\n * @description 生成原生组件包（含插件）\r\n * @returns {NodeJS.ReadWriteStream}\r\n */\r\nfunction packComp () {\r\n  return gulp.src(['plugins/**/*', 'src/**/*'], {\r\n    nodir: true\r\n  })\r\n    // 公共处理\r\n    .pipe(plumber()) // 错误处理\r\n    .pipe(plugin.build(platform)) // 构建插件\r\n    .pipe(ifdef(platform)) // 条件编译\r\n    // wxml 处理\r\n    .pipe(gulpif(file => file.extname === '.wxml', minifier.wxs())) // 压缩内联 wxs\r\n    .pipe(gulpif(file => file.extname === '.wxml', htmlmin(config.htmlmin))) // 压缩 wxml\r\n    .pipe(gulpif(file => file.extname === '.html', htmlmin(Object.assign({}, config.htmlmin, { // 压缩 html\r\n      minifyCSS: true\r\n    }))))\r\n    // js 处理\r\n    .pipe(gulpif(file => file.extname === '.js' && !file.stem.includes('.min') && (platform !== 'uni-app' || file.relative.includes('static')), babel(config.babel))) // es6 转 es5\r\n    .pipe(gulpif(file => file.extname === '.js' && !file.stem.includes('.min') && !isDev && (platform !== 'uni-app' || file.relative.includes('static')), uglify(config.uglify))) // 压缩 js\r\n    // wxss（css）处理\r\n    .pipe(gulpif(file => file.extname.includes('ss'), cleanCss(config.cleanCss))) // 压缩 wxss\r\n    .pipe(plugin.importCss()) // 引入插件中的 css 文件\r\n    // json 处理\r\n    .pipe(gulpif(file => file.extname === '.json', minifier.json())) // 压缩 json\r\n    // 公共处理\r\n    .pipe(converter(platform)) // 将微信端的代码转换到各个平台\r\n    .pipe(gulpif(!isDev, size({\r\n      title: `${platform} 包生成完毕`\r\n    })))\r\n    .pipe(gulp.dest(file => {\r\n      return `${isDev ? 'dev' : 'dist'}/${platform}/${(platform === 'uni-app' && !file.relative.includes('components') && !file.relative.includes('static')) || (platform !== 'uni-app' && isDev) ? 'components/mp-html/' : ''}`\r\n    }))\r\n}\r\n\r\ngulp.task('build', gulp.series('clean', packComp))\r\n\r\n/**\r\n * @description 生成原生示例项目\r\n * @returns {NodeJS.ReadWriteStream}\r\n */\r\nfunction packDemo () {\r\n  return gulp.src(['tools/demo/**/*', 'test/content.js'], {\r\n    nodir: true\r\n  })\r\n    .pipe(ifdef(platform))\r\n    .pipe(gulpif(platform !== 'uni-app', converter(platform)))\r\n    .pipe(gulp.dest(`dev/${platform}/`))\r\n}\r\n\r\ngulp.task('dev', gulp.series('clean', gulp.parallel(packComp, packDemo)))\r\n\r\n/**\r\n * @description 监听文件变化\r\n */\r\ngulp.task('watch-demo', () => {\r\n  gulp.watch(['tools/demo/**/*', 'test/content.js']).on('all', (type, file) => {\r\n    console.log(type + ':' + file)\r\n    packDemo()\r\n  })\r\n})\r\n\r\ngulp.task('watch-comp', () => {\r\n  gulp.watch(['src/**/*', 'src/common/**/*', 'plugins/**/*']).on('all', (type, file) => {\r\n    console.log(type + ':' + file)\r\n    packComp()\r\n  })\r\n})\r\n\r\ngulp.task('watch', gulp.parallel('watch-demo', 'watch-comp'))\r\n"
        },
        {
          "name": "lint.js",
          "type": "blob",
          "size": 1.94921875,
          "content": "const fs = require('fs')\r\nconst glob = require('glob')\r\nconst standard = require('standard')\r\n\r\n// 解析参数\r\nlet fix = false\r\nlet mode = '**/*.@(js|vue)'\r\nfor (let i = 2; i < process.argv.length; i++) {\r\n  if (process.argv[i] === '--fix') {\r\n    fix = true\r\n  } else {\r\n    mode = process.argv[i]\r\n  }\r\n}\r\n\r\n// 检查 js 文件\r\nfunction lintJs (filePath, content) {\r\n  const res = standard.lintTextSync(content, {\r\n    global: ['App', 'Page', 'Component', 'wx', 'requirePlugin', 'uni', 'test', 'expect', 'plus', 'Image'],\r\n    fix\r\n  }).results\r\n  // 写回修复的内容\r\n  if (fix && res[0].output) {\r\n    fs.writeFileSync(filePath, res[0].output)\r\n  }\r\n  // 打印错误信息\r\n  for (let i = 0; i < res[0].messages.length; i++) {\r\n    const item = res[0].messages[i]\r\n    console.log(filePath + ':' + item.line + ':' + item.column + ': ' + item.message)\r\n  }\r\n}\r\n\r\n// 检查 vue 文件\r\nfunction lintVue (filePath, content) {\r\n  // 提取 script 部分\r\n  const script = content.match(/<script>([\\s\\S]+?)<\\/script>/)\r\n  const line = content.substr(0, script.index).split('\\n').length - 1\r\n  const res = standard.lintTextSync(script[1], {\r\n    global: ['uni', 'plus', 'weex'],\r\n    fix\r\n  }).results\r\n  // 写回修复的内容\r\n  if (fix && res[0].output) {\r\n    fs.writeFileSync(filePath, content.replace(/<script>[\\s\\S]+?<\\/script>/, '<script>' + res[0].output + '</script>'))\r\n  }\r\n  // 打印错误信息\r\n  for (let i = 0; i < res[0].messages.length; i++) {\r\n    const item = res[0].messages[i]\r\n    console.log(filePath + ':' + (line + item.line) + ':' + item.column + ': ' + item.message)\r\n  }\r\n}\r\n\r\nglob(mode, {\r\n  ignore: ['node_modules/**', 'coverage/**', 'dist/**', 'dev/**', '**/*.min.js']\r\n}, (_, files) => {\r\n  for (let i = 0; i < files.length; i++) {\r\n    if (files[i].includes('.js')) {\r\n      lintJs(files[i], fs.readFileSync(files[i], 'utf-8'))\r\n    } else if (files[i].includes('.vue')) {\r\n      lintVue(files[i], fs.readFileSync(files[i], 'utf-8'))\r\n    }\r\n  }\r\n})\r\n"
        },
        {
          "name": "package.json",
          "type": "blob",
          "size": 2.564453125,
          "content": "{\r\n  \"name\": \"mp-html\",\r\n  \"version\": \"2.5.0\",\r\n  \"description\": \"小程序富文本组件\",\r\n  \"miniprogram\": \"dist/mp-weixin\",\r\n  \"repository\": \"https://github.com/jin-yufeng/mp-html\",\r\n  \"author\": \"Jin Yufeng\",\r\n  \"license\": \"MIT\",\r\n  \"keywords\": [\r\n    \"miniprogram\",\r\n    \"rich-text\",\r\n    \"html\"\r\n  ],\r\n  \"standard\": {\r\n    \"globals\": [\"App\", \"Page\", \"Component\", \"wx\", \"requirePlugin\", \"uni\", \"plus\", \"weex\"],\r\n    \"envs\": [\"jest\", \"browser\"]\r\n  },\r\n  \"jest\": {\r\n    \"testEnvironment\": \"jsdom\",\r\n    \"collectCoverageFrom\": [\r\n      \"dev/mp-weixin/components/mp-html/**/*.js\"\r\n    ]\r\n  },\r\n  \"scripts\": {\r\n    \"lint\": \"node lint.js\",\r\n    \"lintcss\": \"npx stylelint src/**/*.wxss\",\r\n    \"build:weixin\": \"gulp build --mp-weixin\",\r\n    \"build:qq\": \"gulp build --mp-qq\",\r\n    \"build:baidu\": \"gulp build --mp-baidu\",\r\n    \"build:alipay\": \"gulp build --mp-alipay\",\r\n    \"build:toutiao\": \"gulp build --mp-toutiao\",\r\n    \"build:uni-app\": \"gulp build --uni-app\",\r\n    \"build\": \"gulp build --mp-weixin & gulp build --mp-qq & gulp build --mp-baidu & gulp build --mp-alipay & gulp build --mp-toutiao & gulp build --uni-app\",\r\n    \"watch:weixin\": \"gulp watch --mp-weixin --dev\",\r\n    \"watch:qq\": \"gulp watch --mp-qq --dev\",\r\n    \"watch:baidu\": \"gulp watch --mp-baidu --dev\",\r\n    \"watch:alipay\": \"gulp watch --mp-alipay --dev\",\r\n    \"watch:toutiao\": \"gulp watch --mp-toutiao --dev\",\r\n    \"watch:uni-app\": \"gulp watch --uni-app --dev\",\r\n    \"dev:weixin\": \"gulp dev --mp-weixin --dev\",\r\n    \"dev:qq\": \"gulp dev --mp-qq --dev\",\r\n    \"dev:baidu\": \"gulp dev --mp-baidu --dev\",\r\n    \"dev:alipay\": \"gulp dev --mp-alipay --dev\",\r\n    \"dev:toutiao\": \"gulp dev --mp-toutiao --dev\",\r\n    \"dev:uni-app\": \"gulp dev --uni-app --dev\",\r\n    \"test\": \"gulp dev --mp-weixin --dev && npx jest\",\r\n    \"coverage\": \"gulp dev --mp-weixin --dev && npx jest --coverage\",\r\n    \"coveralls\": \"npx coveralls < coverage/lcov.info\",\r\n    \"clean\": \"gulp clean --all\",\r\n    \"clean:dev\": \"gulp clean --all --dev\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@babel/preset-env\": \"^7.12.1\",\r\n    \"coveralls\": \"^3.1.0\",\r\n    \"gulp\": \"^4.0.0\",\r\n    \"gulp-babel\": \"^8.0.0\",\r\n    \"gulp-clean\": \"^0.4.0\",\r\n    \"gulp-clean-css\": \"^4.3.0\",\r\n    \"gulp-htmlmin\": \"^5.0.1\",\r\n    \"gulp-if\": \"^3.0.0\",\r\n    \"gulp-plumber\": \"^1.2.1\",\r\n    \"gulp-size\": \"^3.0.0\",\r\n    \"gulp-uglify\": \"^2.1.2\",\r\n    \"jest\": \"^26.6.1\",\r\n    \"miniprogram-simulate\": \"^1.2.7\",\r\n    \"standard\": \"^16.0.3\",\r\n    \"stylelint\": \"^13.7.2\",\r\n    \"stylelint-config-recess-order\": \"^2.3.0\",\r\n    \"stylelint-config-standard\": \"^20.0.0\",\r\n    \"through2\": \"^4.0.2\",\r\n    \"uglify-js\": \"^2.8.29\"\r\n  },\r\n  \"dependencies\": {}\r\n}\r\n"
        },
        {
          "name": "plugins",
          "type": "tree",
          "content": null
        },
        {
          "name": "src",
          "type": "tree",
          "content": null
        },
        {
          "name": "test",
          "type": "tree",
          "content": null
        },
        {
          "name": "tools",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}