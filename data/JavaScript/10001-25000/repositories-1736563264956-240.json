{
  "metadata": {
    "timestamp": 1736563264956,
    "page": 240,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjI0MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "pandao/editor.md",
      "stars": 13934,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.1279296875,
          "content": "logs\n*.log\n*.pid\n*.seed\nnode_modules/\n.sass-cache/\nresearch/\ntest/\nbackup/\nexamples/uploads/**/*\n*.bat\n*.sh\n.project\n.url\ncss/*.map"
        },
        {
          "name": ".jshintrc",
          "type": "blob",
          "size": 0.3271484375,
          "content": "{\r\n\t\"esnext\": true,\r\n\t\"bitwise\": true,\r\n\t\"camelcase\": true,\r\n\t\"curly\": true,\r\n\t\"eqeqeq\": true,\r\n\t\"immed\": true,\r\n\t\"indent\": 4,\r\n\t\"latedef\": true,\r\n\t\"newcap\": true,\r\n\t\"noarg\": true,\r\n\t\"quotmark\": \"double\",\r\n\t\"regexp\": true,\r\n\t\"undef\": true,\r\n\t\"unused\": true,\r\n\t\"strict\": true,\r\n\t\"trailing\": true,\r\n\t\"smarttabs\": true,\r\n\t\"white\": true\r\n}"
        },
        {
          "name": "BUGS.md",
          "type": "blob",
          "size": 0.5087890625,
          "content": "#Bugs\r\n\r\n> 说明：删除线表示已经解决。\r\n\r\n####IE8\r\n\r\n- ~~不能加载；~~\r\n- flowChart（流程图）、sequenceDiagram（序列图）不支持IE8；\r\n- ~~不支持Markdown转HTML页面解析预览；~~\r\n\r\n####IE8 & IE9 & IE10\r\n\r\n- KaTeX会出现解析错误，但不影响程序运行；\r\n\r\n####Sea.js\r\n\r\n- ~~Raphael.js无法加载；~~\r\n\r\n####Require.js\r\n\r\n- ~~CodeMirror编辑器的代码无法高亮；~~\r\n- ~~sequenceDiagram不支持: `Uncaught TypeError: Cannot call method 'isArray' of undefined.`~~\r\n"
        },
        {
          "name": "CHANGE.md",
          "type": "blob",
          "size": 26.298828125,
          "content": "## 更新日志\n\n### v1.0.x\n\n##### v1.0.0 beta\n\n预览版：基本功能完成；\n\n##### v1.0.0 releases\n\n发布 v1.0.0 正式版。\n\n主要更新：\n\n- 新建分支 `mathjax-version`，但不打算继续对此分支进行开发；\n\n- 移除 MathJax，改用 KaTeX [#2](https://github.com/pandao/editor.md/issues/2)，解析和预览响应速度大幅度提高 [#3](https://github.com/pandao/editor.md/issues/3)；\n    - 移除 `mathjax` 配置项；\n    - 移除 `mathjaxURL` 属性；\n    - 移除 `setMathJaxConfig()` 方法；\n    - 移除 `loadMathJax()` 方法；\n    - 移除MathJax的所有示例；\n    - 新增 `tex` 配置项，表示是否开启支持科学公式 TeX ，基于 KaTeX；\n    - 新增 `katexURL` 属性；\n    - 新增 `loadKaTeX` 方法；\n    - 新增 KaTeX 的示例；\n    \n- `setCodeEditor()` 方法更名为 `setCodeMirror()`；\n\n- 合并 CodeMirror 使用到的多个 JS 模块文件，大幅减少 HTTP 请求，加快下载速度；\n    - 新增合并后的两个模块文件：`./lib/codemirror/modes.min.js`、`./lib/codemirror/addons.min.js` ；\n    - `Gulpfile.js` 新增合并 CodeMirror 模块文件的任务方法 `codemirror-mode` 和 `codemirror-addon` ；\n    - 另外在使用 Require.js 时，因为 CodeMirror 的严格模块依赖的限制，不能使用上述合并的模块文件，仍然采用动态加载多个模块文件；\n    \n- 更新 `README.md` 等相关文档和示例；\n\n- 解决 Sea.js 环境下 Raphael.js 无法运行导致不支持流程图和时序图的问题，即必须先加载 Raphael.js ，后加载 Sea.js ；\n\n### v1.1.x\n\n##### v1.1.0\n\n主要更新：\n\n- 设计并更换了 Logo；\n- 新增添加图片、链接、锚点链接、代码块、预格式文本等操作弹出对话框层及示例；\n- 新增支持图片(跨域)上传；\n- 改用 `<textarea>` 来存放 Markdown 源文档；\n- 新增支持自定义工具栏；\n- 新增支持多语言；\n- 新增支持 Zepto.js；\n- 新增支持多个 Editor.md 并存和动态加载 Editor.md 及示例；\n- 新增支持智能识别和解析 HTML 标签及示例；\n- 新增多个外部操作方法接口及示例；\n- 修复了一些大大小小的 Bug；\n\n具体更新如下：\n\n- 更换 Logo，建立基础 VI；\n    - 创建了全系列 WebFont 字体 `dist/fonts/editormd-logo.*` ；\n    - 新增样式类 `editormd-logo` 等；\n\n- 改用 `<textarea>` 来存放 Markdown 源文档；\n    - 原先使用 `<script type=\"text/markdown\"></script>` 来存放 Markdown 源文档；\n    - 创建 Editor.md 只需要写一个 `<div id=\"xxxx\"></div>` ，如果没有添加 `class=\"editormd\"` 属性会自动添加，另外如果不存在 `<textarea>` 标签，则也会自动添加 `<textarea>` ；\n\n- 新增支持智能识别和解析 HTML 标签，增强了 Markdown 语法的扩展性，几乎无限，例如：插入视频等等；\n    - 新增配置项 `htmlDecode` ，表示是否开启 HTML 标签识别和解析，但是为了安全性，默认不开启；\n    - 新增识别和解析 HTML 标签的示例；\n    \n- 新增插入链接、锚点链接、预格式文本和代码块的弹出对话框层；\n    - 弹出层改为使用固定定位；\n    - 新增动态创建对话框的方法 `createDialog()`；\n    - 新增静态属性 `editormd.codeLanguages` ，用于存放代码语言列表；\n\n- 开始支持图片上传；\n    - 新增添加图片（上传）弹出对话框层；\n    - 支持基于 iframe 的跨域上传，并添加相应的示例（ PHP 版）；\n    \n- 开始支持自定义工具栏图标及操作处理；\n    - 配置项 `toolbarIcons` 类型由数组更改为函数，返回一个图标按钮列表数组；\n    - 新增配置项 `toolbarHandlers` 和 `toolbarIconsTexts` ，分别用于自定义按钮操作处理和按钮内容文本；\n    - 新增方法 `getToolbarHandles()` ，用于可在外部使用默认的操作方法；\n    - 新增成员属性 `activeIcon` ，可获取当前或上次点击的工具栏图标的 jQuery 实例对象；\n    \n- 新增表单取值、自定义工具栏、图片上传、多个 Editor.md 并存和动态加载 Editor.md 等多个示例；\n\n- 新增插入锚点按钮和操作处理；\n\n- 新增预览 HTML 内容窗口的关闭按钮，之前只能按 ESC 才能退出 HTML 全窗口预览；\n\n- 新增多语言（ l18n ）及动态加载语言包支持；\n    - 新增英语 `en` 和繁体中文 `zh-tw` 语言包模块；\n    - 修改一些方法的内部实现以支持动态语言加载:\n        - `toolbarHandler()` 更为 `setToolbarHandler()` ；\n        - `setToolbar()` 方法包含 `setToolbarHandler()` ；\n        - 新建 `createInfoDialog()` 方法；\n\t    - 修改 `showInfoDialog()` 和 `hideInfoDialog()` 方法的内部实现等；\n\n- 修改多次 Bug ，并优化触摸事件，改进对 iPad 的支持；\n\n- 工具栏新增清空按钮和清空方法 `clear()` ，解决工具栏文本会被选中出现蓝底的问题;\n\n- 配置项 `tocStartLevel` 的默认值由 2 改为 1，表示默认从 H1 开始生成 ToC；\n\n- 解决 IE8 下加载出错的问题；\n    - 新增两个静态成员属性 `isIE` 和 `isIE8` ，用于判断 IE8；\n    - 由于 IE8 不支持 FlowChart 和 SequenceDiagram，默认在 IE8 下不加载这两个组件，无论是否开启；\n\n- 新增 Zepto.js 的支持；\n\t- 为了兼容 Zepto.js ，某些元素在操作处理上不再使用 `outerWidth()` 、 `outerHeight()` 、`hover()` 、`is()` 等方法；\n\t- 为了避免修改 flowChart.js 和 sequence-diagram.js 的源码，所以想支持 flowChart 或 sequenceDiagram 得加上这一句： `var jQuery = Zepto;`；\n\n- 新增 `editormd.$name` 属性，修改 `editormd.homePage` 属性的新地址；\n\n- `editormd.markdownToHTML()` 新增方法返回一个 jQuery 实例对象；\n    - 该实例对象定义了一个 `getMarkdown()`方法，用于获取 Markdown 源代码；\n    - 该实例对象定义了一个 `tocContainer` 成员属性，即 ToC 列表的父层的 jQuery 实例对象；\n\n- 新增只读模式；\n    - 新增配置项 `readOnly` ，默认值为 `false` ，即可编辑模式；\n    - 其他相关改动；\n\n- 新增方法 `focus()` 、 `setCursor()` 、 `getCursor()` 、`setSelection()` 、`getSelection()` 、 `replaceSelection()` 和 `insertValue()` 方法，并增加对应的示例；\n\n- 新增配置项 `saveHTMLToTextarea` ，用于将解析后的 HTML 保存到 Textarea，以供提交到后台程序；\n    - `getHTML()` 方法必须在 `saveHTMLToTextarea == true` 的情况下才能使用；\n    - 新增 `getHTML()` 方法的别名 `getTextareaSavedHTML()` 方法；\n    - 新增方法 `getPreviewedHTML()` ，用于获取预览窗口的 HTML ；\n\n- 修复了一些大大小小的 Bugs；\n\n##### v1.1.1\n\n- 接受一个 pull 请求，修复了 `getHTML ()` 和 `getPreviewedHTML()` 方法中的 ３ 处错误；\n\n##### v1.1.2\n\n- 修复 Bug [＃10](https://github.com/pandao/editor.md/issues/10)；\n- 修复 Bug [＃12](https://github.com/pandao/editor.md/issues/12)；\n\n##### v1.1.3\n\n- 修复 Bug [＃14](https://github.com/pandao/editor.md/issues/14)；\n- 修复 Bug [＃15](https://github.com/pandao/editor.md/issues/15)；\n\n##### v1.1.4\n\n- 修复 Bug [＃17](https://github.com/pandao/editor.md/issues/17)；\n    - 修改了 `getToolbarHandles()` 和 `setToolbarHandler()` 方法；\n- 从 `editormd.scss` 中分离出 `editormd.logo.scss` ，并生成 `editormd.logo.css` ，以便单独使用；\n    - 同时修改了 `Gulpfile.js` 的相应任务；\n    \n##### v1.1.5\n\n- 修复 Bug [＃18](https://github.com/pandao/editor.md/issues/18)；\n    - 修改了 `showInfoDialog()` 和 `createInfoDialog()` 方法；\n    - 新增 `infoDialogPosition()` 方法；\n    \n- 修复 Bug [＃20](https://github.com/pandao/editor.md/issues/20)；\n    - 修改了引用的处理函数；\n    - 插入的 headers 的 `#` 号后面都加上了一个空格；\n\n##### v1.1.6\n\n修复多处 Bug，具体如下：\n    \n- 修复 Bug [#23](https://github.com/pandao/editor.md/issues/23)，即 Headers 的 id 属性的重复及中文问题；\n    - 修改了 `editormd.markedRenderer()` 方法；\n\n- 修复 Bug [#24](https://github.com/pandao/editor.md/issues/24)；\n    - 修改了 `setMarkdown()` 、 `clear()` 和 `loadedDisplay()` 方法的内部实现；\n    - 新增了 `katexRender()` 、 `flowChartAndSequenceDiagramRender()` 、 `previewCodeHighlight()` 方法；\n    \n- 修复有些情况下无法保存 Markdown 源文档到 textarea 的问题；\n    - 修改了 `setCodeMirror()` 、 `recreateEditor()` 等方法；\n\n- 修改了以上 Bug 及部分相关示例文件；\n\n##### v1.1.7\n\n修复多处 Bug，具体如下：\n\n- 修复 Bug [#25](https://github.com/pandao/editor.md/issues/25)；\n    - 修改了 `loadedDisplay()` 方法，将 `settings.onload` 移动了 `CodeMirror.on(\"change\")` 事件注册后再触发；\n\n- 修复 Bug [#26](https://github.com/pandao/editor.md/issues/26)；\n    - 修改了 `saveToTextareas()` 方法；\n    - 新增 `state.loaded` 和 `state.watching` 两个属性；\n\n- 修改了以上 Bug 相关示例文件；\n\n##### v1.1.8\n\n改进功能，具体如下：\n\n- 改进 [#27](https://github.com/pandao/editor.md/issues/27)；\n    - 新增配置项 `matchWordHighlight` ，可选值有： `true, false, \"onselected\"` ，默认值为 `true` ，即开启自动匹配和标示相同单词；\n\n- 改进 [#28](https://github.com/pandao/editor.md/issues/28)；\n    - 将 `jquery.min.js` 、 `font-awesome.min.css` 、 `github-markdown.css` 移除（这是一个疏忽，它们不是动态加载的依赖模块或者不需要的，避免不必要的硬盘空间占用）；\n\n- 修改了所有相关的示例文件；\n\n##### v1.1.9\n\n- 修复无法解析 heading link 的 Bug [#29](https://github.com/pandao/editor.md/issues/29)；\n\n    - 修改了 `editormd.markedRenderer()` 方法的内部实现；\n    - 新增了 `editormd.trim()` ，用于清除字符串两边的空格；\n    - 修改了所有相关的示例文件和测试用例 `marked-heading-link-test.html` ；\n    \n- 修改了 `README.md` ，添加了 `Shields.io` 图标；\n\n### v1.2\n\n##### v1.2.0\n\nv1.2.0 主要更新：\n\n- 新增代码折叠、搜索替换、自定义样式主题和自定义快捷键等功能；\n- 新增 Emoji 表情、@Link 、GFM Task Lists 支持；\n- 新增表格插入、Emoji 表情插入、HTML 实体字符插入、使用帮助等对话框；\n- 新增插件扩展机制；\n- 新增手动加载依赖模块方式；\n- 改用 `Prefixes.css` 作 CSS 前缀预处理；\n- 改进和增强工具栏自定义功能，完善事件监听和处理方法；\n- 部分功能改进（更加方便的预格式文本/代码插入、自动闭合标签等）、新增多个方法、改进 Require.js 支持和修复多个 Bug 等等；\n\n**具体更新如下：**\n\n- 新建 v1.1.x 分支；\n    - v1.2 文件结构变动较大；\n\n- 新增代码折叠、自动闭合标签和搜索替换功能；\n    - 搜索快捷键 `Ctrl + F / Command + F` ；\n    - 替换快捷键 `Ctrl + Shift + F / Command + Option + F` ；\n    - 折叠快捷键 `Ctrl + Q / Command + Q` ；\n\n- 新增自定义主题支持；\n    - 新增 3 个成员方法 `setTheme()` 、 `setCodeMirrorOption()` 和 `getCodeMirrorOption()` ；\n\n- 新增 @Link 支持；\n\n- 新增 GFM Task Lists 支持；\n\n- 新增 Emoji 表情支持；\n    - 支持 Github emoji `:emoji-name:` 、FontAwesome icons（`:fa-xxx:`）、Twitter emoji (twemoji) （ `:tw-xxxx:` ）、Editor.md logo icons（ `:editormd-logo:` ）形式的 Emoji；\n    - 新增属性 `editormd.emoji` 、 `editormd.twemoji` 、 `editormd.urls` 和 `editormd.regex`；\n    \n- 新增 HTML 实体字符插入、插入表格和使用帮助对话框；\n    - 修改了 `createDialog()` 等方法；\n    - 新增 `mask` 成员属性和锁屏方法 `editormd.lockScreen()` 、 `editormd.fn.lockScreen()` ；\n\n- 改进插入预格式文本和代码对话框；\n    - 将 `<textarea>` 改为 `CodeMirror` ，输入更加方便和直观；\n\n- 新增自定义键盘快捷键功能；\n    - 新增 2 个方法： `addKeyMap()` 和 `removeKayMap()`；\n\n- 改用 `Prefixes.css` 作CSS前缀预处理；\n    - SCSS前缀预处理mixins改用 [Prefixes.scss](https://github.com/pandao/prefixes.scss \"Prefixes.scss\")；\n\n- 改进和增强工具栏自定义功能；\n\t- 新增配置项 `toolbarCustomIcons` ，用于增加自定义工具栏的功能，可以直接插入 HTML 标签，不使用默认的元素创建图标；\n    - 新增工具栏列表预设值属性 `editormd.toolbarModes` ；\n    - 移除成员属性 `toolbarIconHandlers` ；\n\n- 完善和新增事件处理方法；\n\t- 新增事件回调注册方法 `on()` ；\n\t- 新增事件回调移除方法 `off()` ；\n\t- 新增事件回调处理配置项： `onresize` 、 `onscroll` 、`onpreviewscroll` 、 `onpreviewing` 、 `onpreviewed` 、`onwatch` 和 `onunwatch` ；\n\n- 新增手动加载依赖模块方式，以便可同步使用成员方法；\n    - 新增属性 `autoLoadModules` ，默认值为 `true` ；\n\n- 新增插件及扩展机制；\n    \n    - 新增插件自定义机制，改变整体结构(包括文件结构)，以便更加方便地实现插件扩展；\n\t- 新增对象扩展方法 `extends()` 、 `set()` ；\n\n- 新增成员方法和属性：\n\n    - 新增两个方法： `setValue()` 、`getValue()`；\n\t- 新增 `config()` 方法，用于加载后重新配置；\n\t- 增加两个属性 `cm` ，是 `codeEditor` 的简写， `cmElement` 是 `codeMirror` 的别名;\n\n- 成员方法的改进：\n\n\t- 改进： `showToolbar()` 和 `hideToolbar()` 方法增加一个 `callback` 函数，用于直接回调操作；\n\t- 改进：修改了 `previewCodeHighlight()` 方法；\n\t- 更名： `recreateEditor()` 更名为 `recreate()` ；\n    - 移除 `setMarked()` 方法；\n    \n- 新增 HTML 标签解析过滤机制；\n    - 通过设置 `settings.htmlDecode = \"style,script,iframe\"` 来实现过滤指定标签的解析；\n\n- 改进 Require.js 支持；\n    - 修复 Require.js 下 CodeMirror 编辑器的代码无法高亮的问题；\n    - 更新 `underscore` 版本至 `1.8.2` ；\n    - 移除 `editormd.requirejsInit()` 和 `editormd.requireModules()` 方法；\n    - 新增 `Require.js/AMD` 专用版本文件 `editormd.amd.js` ；\n    - 新建 Gulp 任务 `amd` ；\n\n- 修改和新增以上改进等相关示例；\n\n### v1.3\n\n#### v1.3.0\n\n主要更新：\n\n- 预设键盘快捷键处理（粗体等），插入 Markdown 更加方便；\n- 更新 CodeMirror 版本为 `5.0` ；\n- 更新 Marked 版本为 `0.3.3`；\n- 新增自动高度和工具栏固定定位功能；\n- 改进表格插入对话框；\n- 工具栏新增三个按钮，分别是将所选文本首字母转成大写、转成小写、转成大写；\n- 修改使用帮助文档；\n- 修复多个 Bug；\n\n具体更新如下：\n\n- 新增常用键盘快捷键预设处理；\n    - 新增属性 `editormd.keyMaps` ，预设一些常用操作，例如插入粗体等；\n    - 新增成员方法 `registerKeyMaps()` ；\n    - 退出HTML全屏预览快捷键更改为 `Shift + ESC`；\n    - 新增配置项 `disabledKeyMaps` ，用于屏蔽一些快捷键操作；\n- 更新 CodeMirror 版本为 `5.0`；\n    - 修改无法输入 `/` 的问题；\n- 更新 Marked 版本为 `0.3.3`；\n- 新增自动高度和工具栏固定定位（滚动条拖动时）模式；\n    - 新增配置项 `settings.autoHeight` ；\n    - 新增配置项 `settings.toolbarAutoFixed` ；\n    - 新增方法 `setToolbarAutoFixed(true|false)` ；\n- 新增邮箱地址自动添加链接功能；\n    - 新增配置项 `emailLink` ，默认为 `true` ; \n- 改进表格插入对话框；\n- 工具栏新增三个按钮，分别是将所选文本首字母转成大写、转成小写、转成大写；\n    - 新增方法 `editormd.ucwords()` ，别名 `editormd.wordsFirstUpperCase()` ；\n    - 新增方法 `editormd.ucfirst()` ，别名 `editormd.firstUpperCase()` ；\n    - 新增两个成员方法 `getSelections()` 和 `getSelections()` ；\n\n- 修复 Font awesome 图标 emoji 部分无法解析的 Bug，[#39](https://github.com/pandao/editor.md/issues/39)\n- 改进 @link 功能 [#40](https://github.com/pandao/editor.md/issues/40)；\n    - 新增配置项 `atLink` ，默认为 `true` ; \n- 修复无法输入 `/` 的问题 [#42](https://github.com/pandao/editor.md/issues/42)；\n- 修改使用帮助说明的错误 [#43](https://github.com/pandao/editor.md/issues/43)；\n- 新增配置项 `pluginPath`，默认为空时，等于 `settings.path + \"../plugins/\"` ；\n\n### v1.4\n\n#### v1.4.0\n\n主要更新：\n\n- 新增延迟解析机制，预览更即时；\n- 新增跳转到指定行的功能和对话框；\n- 新增 ToC 下拉菜单、自定义 ToC 容器的功能；\n- 新增跳转到行、搜索的工具栏按钮；\n- 新增支持插入和解析（打印）分页符；\n- 改进快捷键功能和自动高度模式等；\n- 改进：将锚点链接改名为引用链接；\n- 改进编辑器重建和重配置功能；\n- 修复多个 Bug；\n\n具体更新：\n\n- 新增延迟解析预览的机制，解决输入太多太快出现的 “延迟卡顿” 问题；\n    - 新增配置项 `delay` ，默认值为 `300`；\n    - 修复当输入速度太快时，解析Flowchart会抛出错误的问题；\n- 修改 iPad 等移动终端的浏览器无法上传图片的问题 [#48](https://github.com/pandao/editor.md/issues/48)；\n- 修复单独引用 `editormd.preview.css` 时无法显示 Font Awesome 和 Editor.md logo 字体的问题；\n- 更新和修改 Gulp 构建；\n    - 修改了 `Gulpfile.js` ，并且 `gulp-ruby-sass` 升级到最新版本 `1.0.0-alpha.3` ; \n    - 编辑 SCSS 时，不再生成 CSS 的 Source map 文件；\n- 执行 jshint 和更正一些 JS 写法的不规范，精简了代码；\n- 新增配置项 `appendMarkdown` 和 `appendMarkdown()` 方法，用于(初始化前后)追加 Markdown 到 Textarea ；\n- 改进部分预设快捷键功能，包括 F9 (watch)、F10 (preview)、F11 (fullscreen)等;\n- 修复自动高度模式下出现的几个问题；\n    - 全屏退出时高度不正确的问题：修改了 `fullscreenExit()` 方法的内部实现；\n    - 当解析预览后的 HTML 内容高度高于 Markdown 源码编辑器高度时，无法正确预览的问题 [#49](https://github.com/pandao/editor.md/issues/49)；\n- 修改 `onscroll` 和 `onpreviewscroll` 无法访问 `this` 的问题；\n- 修改 `init()` 方法，可以只设置一个参数；\n- 新增插入 TeX (KaTeX) 公式的快捷键 `Ctrl + Shift + K` 和插入方法 `tex()` ；\n- 将锚点链接改为引用链接，引用的链接改为插入到页尾；\n    - 工具栏的名称 `anchor` 改为 `reference-link`；\n    - 工具栏的名称 `htmlEntities` 改名为 `html-entities`；\n- 改进编辑器重建和重配置功能；\n    - 修改了 `loadedDisplay()` 方法；\n    - 修改了 `config()` 和 `recreate()` 方法；\n- 新增跳转到指定行的功能；\n    - 新增方法 `gotoLine()` ；\n    - 新增跳转到行对话框插件 `goto-line-dialog` ；\n    - 新增快捷键 `Ctrl + Alt + G` ；\n    - 改进 `executePlugin()` 方法；\n    - 修改了 `help-dialog/help.md` ；\n- 新增搜索工具栏按钮；\n    - 新增方法 `search()` 、`searchReplace()` 和 `searchReplaceAll()` ；\n    - 原全屏预览 HTML 按钮的图标改为 `fa-desktop`；\n    - 改为默认开启搜索替换功能；\n- 更换了关于 Editor.md 的标语（ slogan ）；\n- 标题按钮 `h` 改为大写的 `H`；\n- `saveToTextareas()` 方法更名为 `save()`；\n- 新增 ToC 下拉菜单、自定义 ToC 容器的功能；\n    - 新增 Markdown 扩展语法 `[TOCM]` ，自动生成 ToC 下拉菜单；\n    - 新增配置项 `tocm` ，默认为 `true`，即可以使用 `[TOCM]` ；\n    - 新增配置项 `tocDropdown` 和 `tocTitle` ；\n    - 新增方法 `editormd.tocDropdownMenu()` ；\n    - 新增配置项 `tocContainer` ，值为 jQuery 选择器，默认为空；\n- 修改了配置项 `placeholder` 的默认值；\n- 改进对 IE8 的兼容支持；\n- 修复 Firefox 下因为 `Object.watch()` 而出现的问题；\n- 新增支持插入和解析（打印）分页符；\n    - 新增配置项 `pageBreak` ，默认值为 `true`；\n    - 新增语法 `[========]` ，即括号内至少 8 个等号；\n    - 新增插入分页符的工具栏图标和方法 `pagebreak()` ；\n    - 新增插入分页符的快捷键 `Shift + Alt + P`；\n- 修复一些 Bug，包括 [#51](https://github.com/pandao/editor.md/issues/51) 等；\n- 新增和修改以上更新的相关示例；\n\n#### v1.4.1\n\n- 新增配置项 `syncScrolling`，即是否开启同步滚动预览，默认值为 `false` ； \n- 修复 Bug [＃64](https://github.com/pandao/editor.md/issues/64)；\n    - 更新 `editormd.katexURL` 资源地址的默认值，即更新版本为 `0.3.0` ； \n    - 新增测试用例`tests/katex-tests.html`；\n    - 修改示例文件`examples/katex.html`； \n- 修复 Bug [＃66](https://github.com/pandao/editor.md/issues/66)；\n- 修复编辑器工具栏按钮 `:hover` CSS3 transition 无效的问题； \n- 修改了 `README.md`；\n\n#### v1.4.2\n\n- 改进和增强自定义工具栏功能，支持图标按钮右对齐 [#69](https://github.com/pandao/editor.md/issues/69)；\n- 改进和增强 HTML 标签的解析过滤功能，支持过滤指定的属性等 [#70](https://github.com/pandao/editor.md/issues/70)；\n- 删除分支 `mathjax-version` 和 `v1.1.9`；\n\n#### v1.4.3\n\n- 改进：可配置是否自动聚焦编辑器 [#74](https://github.com/pandao/editor.md/issues/74)；\n\t- 新增配置项 `autoFocus`，默认值为 `true`; \n- 修复 Bug [#77](https://github.com/pandao/editor.md/issues/77)；\n- 改进：帮助对话框里的链接改为新窗口打开，避免直接跳转到链接，导致编辑内容丢失的问题 [#79](https://github.com/pandao/editor.md/issues/79)；\n- 改进和完善编辑器配置项；\n\t- 新增配置项 `tabSize`、`indentUnit` 和 `lineWrapping`；\n\t- 新增配置项 `autoCloseBrackets` 和 `showTrailingSpace` ；\n\t- 新增配置项 `matchBrackets`、`indentWithTabs` 和 `styleSelectedText`；\n- 改进：修改 CSS `font-family`，改进跨平台中英文字体显示；\n- 修改了 `README.md`；\n\n#### v1.4.4\n\n- 修复 Bug [#81](https://github.com/pandao/editor.md/issues/81)，即不支持 `:+1:` 的问题；\n- 修复 Bug [#85](https://github.com/pandao/editor.md/issues/85)，即图片上传返回结果不支持 `Content-Type=application/json` 的问题；\n- 修复图片上传无法显示 loading 的问题；\n\n#### v1.4.5\n\n- 规范项目的中英文混排；\n- 新增配置项 `name`，用于指定 Markdown textarea 的 `name=\"xxxx\"` 属性；\n- 修复 Bug，即无法正确解析公式的 `<` 和 `>` 的问题 [#87](https://github.com/pandao/editor.md/issues/87);\n- 修复 Bug，即 `getHTML()` 无效的问题 [#95](https://github.com/pandao/editor.md/issues/95);\n- 修复 Bug，即火狐上传图片后无法返回值的问题 [#96](https://github.com/pandao/editor.md/issues/96);\n    - 修改了图片上传插件；\n    - 修改 PHP 上传类及示例；\n- 方法更名：`extends()` 更名为 `extend()`，以兼容 IE8；\n- 修复 IE8 下 Emoji 正则表达式字符集越界的问题；\n- 更新了 `README.md` 和 `CHANGE.md` 等相关文档文件；\n\n\n### v1.5\n\n#### v1.5.0\n\n主要更新：\n\n- 新增：编辑器黑色主题 Dark，改进自定义主题功能（即工具栏、编辑区、预览区可分别设置主题样式）；\n- 新增：多行公式支持；\n- 新增：支持非编辑状态下的 ToC 自定义容器；\n- 新增：支持设置为单向同步滚动；\n- 改进：编辑器样式美化，更换了滚动条样式; \n- 改进：提高同步滚动定位的精确度；\n- 改进：修复和改进 HTML 标签及属性过滤功能；\n- 改进：修复在 Bootstrap 下的兼容性问题；\n- 修复多处 Bug；\n\n具体更新：\n\n- 新增：解析后的代码块自动换行；\n\n- 新增：支持多行公式；\n    - 新增：新增语法：\\`\\`\\`math | latex | katex；\n    - 改进：美化 KaTeX 公式，即加大字号等；\n\n- 新增：支持设置为单向同步滚动，即只是编辑区单向同步滚动，配置项 `syncScrolling : \"single\"`；\n    - 新增：配置同步滚动示例文件 `sync-scrolling.html`；\n\n- 新增：增加了编辑器样式主题 Dark，即工具栏和预览区各自有一个暗黑色主题；\n    - 变更：自 `v1.5.0` 开始，配置项 `theme` 改为指定 Editor.md 本身的主题；\n    - 新增配置项 `editorTheme` ，用于指定编辑区的主题，即 CodeMirror 的主题；\n    - 新增配置项 `previewTheme` ，用于指定预览区的主题；\n    - 新增方法 `setEditorTheme()`，别名： `setCodeMirror()`；\n    - 新增方法 `setPreviewTheme()`；\n    - 修改了方法 `setTheme()` ；\n    - 更换了滚动条样式，Only Webkit；\n    - 改进全屏状态下的样式显示，去掉 JS 操作的部分，改为通过 CSS 样式类 `.editormd-fullscreen` 控制；\n    - 修改和增加相关的方法、SCSS 文件及示例文件 `themes.html`；\n\n- 新增：非编辑状态下 ToC 自定义容器支持；\n    - 新增配置项 `markdownSourceCode`，即解析后是否保留源码，默认为不保留 `false`；\n    - 新增配置项 `tocContainer`，值为自定义 ToC 容器的 ID 选择器 `#xxxxx`，默认为空；\n    - 新增和修改了相关示例文件；\n\n- 新增：新增加了 CSS 样式类 `editormd-preview-active`，可以控制全屏HTML预览时的内容层样式；\n    - 修改了 `previewing()` 和 `previewed()` 方法；\n    - 相关 issues [#103](https://github.com/pandao/editor.md/issues/103)；\n    - 另外也调整了关闭按钮的位置；\n\n- 改进：修复插入 Emoji `:moon:` 无法显示的问题，修改为其是 `:waxing_gibbous_moon:` 的别名 [#94](https://github.com/pandao/editor.md/pull/94)；\n\n- 改进：修改了 CodeMirror 代码行的左右内间距，使其不会挨着左边的行号层；\n    - 相关 issues [#97](https://github.com/pandao/editor.md/issues/97)；\n\n- 改进：修改了同步滚动的定位算法，提高精确度；\n    - 修正问题 [#99](https://github.com/pandao/editor.md/issues/99)；\n    - 修改了 `bindScrollEvent()` 方法；\n\n- 改进：完善 HTML 标签过滤功能，即代码块、`<pre>` 预格式文本和行内代码里的标签及属性不会被过滤；\n    - 修复 Bug [#105](https://github.com/pandao/editor.md/issues/105)；\n- 改进：当不显示行号时 `settings.lineNumbers == false`，CodeMirror 行号层去掉右边框； \n- 改进：根据指针在当前行的位置更合理插入标题和水平线 [#104](https://github.com/pandao/editor.md/pull/104)；\n- 改进：调整了字体，优先显示 `\"YaHei Consolas Hybrid\", Consolas`；\n- 改进：修复在 Bootstrap 下的兼容性问题，即因为 box-sizing 写错位置导致的弹出层宽度等错位问题 [#107](https://github.com/pandao/editor.md/issues/107)；"
        },
        {
          "name": "Gulpfile.js",
          "type": "blob",
          "size": 12.744140625,
          "content": "\"use strict\";\r\n\r\nvar os           = require(\"os\");\r\nvar gulp         = require(\"gulp\");\r\nvar gutil        = require(\"gulp-util\");\r\nvar sass         = require(\"gulp-ruby-sass\");\r\nvar jshint       = require(\"gulp-jshint\");\r\nvar uglify       = require(\"gulp-uglifyjs\");\r\nvar rename       = require(\"gulp-rename\");\r\nvar concat       = require(\"gulp-concat\");\r\nvar notify       = require(\"gulp-notify\");\r\nvar header       = require(\"gulp-header\");\r\nvar minifycss    = require(\"gulp-minify-css\");\r\n//var jsdoc        = require(\"gulp-jsdoc\");\r\n//var jsdoc2md     = require(\"gulp-jsdoc-to-markdown\");\r\nvar pkg          = require(\"./package.json\");\r\nvar dateFormat   = require(\"dateformatter\").format;\r\nvar replace      = require(\"gulp-replace\");\r\n\r\npkg.name         = \"Editor.md\";\r\npkg.today        = dateFormat;\r\n\r\nvar headerComment = [\"/*\", \r\n\t\t\t\t\t\" * <%= pkg.name %>\",\r\n                    \" *\",\r\n\t\t\t\t\t\" * @file        <%= fileName(file) %> \",\r\n\t\t\t\t\t\" * @version     v<%= pkg.version %> \",\r\n\t\t\t\t\t\" * @description <%= pkg.description %>\",\r\n\t\t\t\t\t\" * @license     MIT License\",\r\n\t\t\t\t\t\" * @author      <%= pkg.author %>\",\r\n\t\t\t\t\t\" * {@link       <%= pkg.homepage %>}\",\r\n\t\t\t\t\t\" * @updateTime  <%= pkg.today('Y-m-d') %>\",\r\n\t\t\t\t\t\" */\", \r\n\t\t\t\t\t\"\\r\\n\"].join(\"\\r\\n\");\r\n\r\nvar headerMiniComment = \"/*! <%= pkg.name %> v<%= pkg.version %> | <%= fileName(file) %> | <%= pkg.description %> | MIT License | By: <%= pkg.author %> | <%= pkg.homepage %> | <%=pkg.today('Y-m-d') %> */\\r\\n\";\r\n\r\nvar scssTask = function(fileName, path) {\r\n    \r\n    path = path || \"scss/\";\r\n    \r\n    var distPath = \"css\";\r\n    \r\n    return sass(path + fileName + \".scss\", { style: \"expanded\", sourcemap: false, noCache : true })\r\n        .pipe(gulp.dest(distPath))\r\n        .pipe(header(headerComment, {pkg : pkg, fileName : function(file) { \r\n            var name = file.path.split(file.base);\r\n            return name[1].replace(\"\\\\\", \"\");\r\n        }}))\r\n       .pipe(gulp.dest(distPath)) \r\n       .pipe(rename({ suffix: \".min\" }))\r\n       .pipe(gulp.dest(distPath))\r\n       .pipe(minifycss())\r\n       .pipe(gulp.dest(distPath)) \r\n        .pipe(header(headerMiniComment, {pkg : pkg, fileName : function(file) { \r\n            var name = file.path.split(file.base);\r\n            return name[1].replace(\"\\\\\", \"\");\r\n        }}))\r\n       .pipe(gulp.dest(distPath)) \r\n       .pipe(notify({ message: fileName + \".scss task completed!\" }));\r\n};\r\n\r\ngulp.task(\"scss\", function() { \r\n\treturn scssTask(\"editormd\");\r\n}); \r\n\r\ngulp.task(\"scss2\", function() { \r\n\treturn scssTask(\"editormd.preview\");\r\n}); \r\n\r\ngulp.task(\"scss3\", function() {\r\n\treturn scssTask(\"editormd.logo\");\r\n}); \r\n\r\ngulp.task(\"js\", function() { \r\n  return gulp.src(\"./src/editormd.js\")\r\n            .pipe(jshint(\"./.jshintrc\"))\r\n            .pipe(jshint.reporter(\"default\"))\r\n            .pipe(header(headerComment, {pkg : pkg, fileName : function(file) { \r\n                var name = file.path.split(file.base);\r\n                return name[1].replace(/[\\\\\\/]?/, \"\");\r\n            }}))\r\n            .pipe(gulp.dest(\"./\"))\r\n            .pipe(rename({ suffix: \".min\" }))\r\n            .pipe(uglify())  // {outSourceMap: true, sourceRoot: './'}\r\n            .pipe(gulp.dest(\"./\"))\t\r\n            .pipe(header(headerMiniComment, {pkg : pkg, fileName : function(file) {\r\n                var name = file.path.split(file.base + ( (os.platform() === \"win32\") ? \"\\\\\" : \"/\") );\r\n                return name[1].replace(/[\\\\\\/]?/, \"\");\r\n            }}))\r\n            .pipe(gulp.dest(\"./\"))\r\n            .pipe(notify({ message: \"editormd.js task complete\" }));\r\n}); \r\n\r\ngulp.task(\"amd\", function() {\r\n    var replaceText1 = [\r\n        'var cmModePath  = \"codemirror/mode/\";',\r\n        '            var cmAddonPath = \"codemirror/addon/\";', \r\n        '',\r\n        '            var codeMirrorModules = [',\r\n        '                \"jquery\", \"marked\", \"prettify\",',\r\n        '                \"katex\", \"raphael\", \"underscore\", \"flowchart\",  \"jqueryflowchart\",  \"sequenceDiagram\",',\r\n        '',\r\n        '                \"codemirror/lib/codemirror\",',\r\n        '                cmModePath + \"css/css\",',\r\n        '                cmModePath + \"sass/sass\",', \r\n        '                cmModePath + \"shell/shell\",', \r\n        '                cmModePath + \"sql/sql\",',\r\n        '                cmModePath + \"clike/clike\",',\r\n        '                cmModePath + \"php/php\",',\r\n        '                cmModePath + \"xml/xml\",',\r\n        '                cmModePath + \"markdown/markdown\",', \r\n        '                cmModePath + \"javascript/javascript\",',\r\n        '                cmModePath + \"htmlmixed/htmlmixed\",',\r\n        '                cmModePath + \"gfm/gfm\",',\r\n        '                cmModePath + \"http/http\",',\r\n        '                cmModePath + \"go/go\",', \r\n        '                cmModePath + \"dart/dart\",', \r\n        '                cmModePath + \"coffeescript/coffeescript\",',\r\n        '                cmModePath + \"nginx/nginx\",',\r\n        '                cmModePath + \"python/python\",', \r\n        '                cmModePath + \"perl/perl\",',\r\n        '                cmModePath + \"lua/lua\",', \r\n        '                cmModePath + \"r/r\", ',\r\n        '                cmModePath + \"ruby/ruby\", ',\r\n        '                cmModePath + \"rst/rst\",',\r\n        '                cmModePath + \"smartymixed/smartymixed\",', \r\n        '                cmModePath + \"vb/vb\",',\r\n        '                cmModePath + \"vbscript/vbscript\",', \r\n        '                cmModePath + \"velocity/velocity\",',\r\n        '                cmModePath + \"xquery/xquery\",',\r\n        '                cmModePath + \"yaml/yaml\",',\r\n        '                cmModePath + \"erlang/erlang\",', \r\n        '                cmModePath + \"jade/jade\",',\r\n        '',\r\n        '                cmAddonPath + \"edit/trailingspace\", ',\r\n        '                cmAddonPath + \"dialog/dialog\", ',\r\n        '                cmAddonPath + \"search/searchcursor\", ',\r\n        '                cmAddonPath + \"search/search\", ',\r\n        '                cmAddonPath + \"scroll/annotatescrollbar\", ', \r\n        '                cmAddonPath + \"search/matchesonscrollbar\", ',\r\n        '                cmAddonPath + \"display/placeholder\", ',\r\n        '                cmAddonPath + \"edit/closetag\", ',\r\n        '                cmAddonPath + \"fold/foldcode\",',\r\n        '                cmAddonPath + \"fold/foldgutter\",',\r\n        '                cmAddonPath + \"fold/indent-fold\",',\r\n        '                cmAddonPath + \"fold/brace-fold\",',\r\n        '                cmAddonPath + \"fold/xml-fold\", ',\r\n        '                cmAddonPath + \"fold/markdown-fold\",',\r\n        '                cmAddonPath + \"fold/comment-fold\", ',\r\n        '                cmAddonPath + \"mode/overlay\", ',\r\n        '                cmAddonPath + \"selection/active-line\", ',\r\n        '                cmAddonPath + \"edit/closebrackets\", ',\r\n        '                cmAddonPath + \"display/fullscreen\",',\r\n        '                cmAddonPath + \"search/match-highlighter\"',\r\n        '            ];',\r\n        '',\r\n        '            define(codeMirrorModules, factory);'\r\n    ].join(\"\\r\\n\");\r\n    \r\n    var replaceText2 = [\r\n        \"if (typeof define == \\\"function\\\" && define.amd) {\",\r\n        \"       $          = arguments[0];\",\r\n        \"       marked     = arguments[1];\",\r\n        \"       prettify   = arguments[2];\",\r\n        \"       katex      = arguments[3];\",\r\n        \"       Raphael    = arguments[4];\",\r\n        \"       _          = arguments[5];\",\r\n        \"       flowchart  = arguments[6];\",\r\n        \"       CodeMirror = arguments[9];\",\r\n        \"   }\"\r\n    ].join(\"\\r\\n\");\r\n    \r\n    gulp.src(\"src/editormd.js\")\r\n        .pipe(rename({ suffix: \".amd\" }))\r\n        .pipe(gulp.dest('./'))\r\n        .pipe(header(headerComment, {pkg : pkg, fileName : function(file) { \r\n            var name = file.path.split(file.base);\r\n            return name[1].replace(/[\\\\\\/]?/, \"\");\r\n        }}))\r\n        .pipe(gulp.dest(\"./\"))\r\n        .pipe(replace(\"/* Require.js define replace */\", replaceText1))\r\n        .pipe(gulp.dest('./'))\r\n        .pipe(replace(\"/* Require.js assignment replace */\", replaceText2))\r\n        .pipe(gulp.dest('./'))\r\n        .pipe(rename({ suffix: \".min\" }))\r\n        .pipe(uglify()) //{outSourceMap: true, sourceRoot: './'}\r\n        .pipe(gulp.dest(\"./\"))\r\n        .pipe(header(headerMiniComment, {pkg : pkg, fileName : function(file) {\r\n            var name = file.path.split(file.base + ( (os.platform() === \"win32\") ? \"\\\\\" : \"/\") );\r\n            return name[1].replace(/[\\\\\\/]?/, \"\");\r\n        }}))\r\n        .pipe(gulp.dest(\"./\"))\r\n        .pipe(notify({ message: \"amd version task complete\"}));\r\n}); \r\n\r\n\r\nvar codeMirror = {\r\n    path : {\r\n        src : {\r\n            mode : \"lib/codemirror/mode\",\r\n            addon : \"lib/codemirror/addon\"\r\n        },\r\n        dist : \"lib/codemirror\"\r\n    },\r\n    modes : [\r\n        \"css\",\r\n        \"sass\",\r\n        \"shell\",\r\n        \"sql\",\r\n        \"clike\",\r\n        \"php\",\r\n        \"xml\",\r\n        \"markdown\",\r\n        \"javascript\",\r\n        \"htmlmixed\",\r\n        \"gfm\",\r\n        \"http\",\r\n        \"go\",\r\n        \"dart\",\r\n        \"coffeescript\",\r\n        \"nginx\",\r\n        \"python\",\r\n        \"perl\",\r\n        \"lua\",\r\n        \"r\", \r\n        \"ruby\", \r\n        \"rst\",\r\n        \"smartymixed\",\r\n        \"vb\",\r\n        \"vbscript\",\r\n        \"velocity\",\r\n        \"xquery\",\r\n        \"yaml\",\r\n        \"erlang\",\r\n        \"jade\",\r\n    ],\r\n\r\n    addons : [\r\n        \"edit/trailingspace\", \r\n        \"dialog/dialog\", \r\n        \"search/searchcursor\", \r\n        \"search/search\",\r\n        \"scroll/annotatescrollbar\", \r\n        \"search/matchesonscrollbar\", \r\n        \"display/placeholder\", \r\n        \"edit/closetag\", \r\n        \"fold/foldcode\",\r\n        \"fold/foldgutter\",\r\n        \"fold/indent-fold\",\r\n        \"fold/brace-fold\",\r\n        \"fold/xml-fold\", \r\n        \"fold/markdown-fold\",\r\n        \"fold/comment-fold\", \r\n        \"mode/overlay\", \r\n        \"selection/active-line\", \r\n        \"edit/closebrackets\", \r\n        \"display/fullscreen\", \r\n        \"search/match-highlighter\"\r\n    ]\r\n};\r\n\r\ngulp.task(\"cm-mode\", function() { \r\n    \r\n    var modes = [\r\n        codeMirror.path.src.mode + \"/meta.js\"\r\n    ];\r\n    \r\n    for(var i in codeMirror.modes) {\r\n        var mode = codeMirror.modes[i];\r\n        modes.push(codeMirror.path.src.mode + \"/\" + mode + \"/\" + mode + \".js\");\r\n    }\r\n    \r\n    return gulp.src(modes)\r\n                .pipe(concat(\"modes.min.js\"))\r\n                .pipe(gulp.dest(codeMirror.path.dist))\r\n                .pipe(uglify()) // {outSourceMap: true, sourceRoot: codeMirror.path.dist}\r\n                .pipe(gulp.dest(codeMirror.path.dist))\t\r\n                .pipe(header(headerMiniComment, {pkg : pkg, fileName : function(file) {\r\n                    var name = file.path.split(file.base + \"\\\\\"); \r\n                    return (name[1]?name[1]:name[0]).replace(/\\\\/g, \"\");\r\n                }}))\r\n                .pipe(gulp.dest(codeMirror.path.dist))\r\n                .pipe(notify({ message: \"codemirror-mode task complete!\" }));\r\n}); \r\n\r\ngulp.task(\"cm-addon\", function() { \r\n    \r\n    var addons = [];\r\n    \r\n    for(var i in codeMirror.addons) {\r\n        var addon = codeMirror.addons[i];\r\n        addons.push(codeMirror.path.src.addon + \"/\" + addon + \".js\");\r\n    }\r\n    \r\n    return gulp.src(addons)\r\n                .pipe(concat(\"addons.min.js\"))\r\n                .pipe(gulp.dest(codeMirror.path.dist))\r\n                .pipe(uglify()) //{outSourceMap: true, sourceRoot: codeMirror.path.dist}\r\n                .pipe(gulp.dest(codeMirror.path.dist))\t\r\n                .pipe(header(headerMiniComment, {pkg : pkg, fileName : function(file) {\r\n                    var name = file.path.split(file.base + \"\\\\\");\r\n                    return (name[1]?name[1]:name[0]).replace(/\\\\/g, \"\");\r\n                }}))\r\n                .pipe(gulp.dest(codeMirror.path.dist))\r\n                .pipe(notify({ message: \"codemirror-addon.js task complete\" }));\r\n}); \r\n/*\r\ngulp.task(\"jsdoc\", function(){\r\n    return gulp.src([\"./src/editormd.js\", \"README.md\"])\r\n               .pipe(jsdoc.parser())\r\n               .pipe(jsdoc.generator(\"./docs/html\"));\r\n});\r\n\r\ngulp.task(\"jsdoc2md\", function() {\r\n    return gulp.src(\"src/js/editormd.js\")\r\n            .pipe(jsdoc2md())\r\n            .on(\"error\", function(err){\r\n                gutil.log(gutil.colors.red(\"jsdoc2md failed\"), err.message);\r\n            })\r\n            .pipe(rename(function(path) {\r\n                path.extname = \".md\";\r\n            }))\r\n            .pipe(gulp.dest(\"docs/markdown\"));\r\n});\r\n*/\r\ngulp.task(\"watch\", function() {\r\n\tgulp.watch(\"scss/editormd.scss\", [\"scss\"]);\r\n\tgulp.watch(\"scss/editormd.preview.scss\", [\"scss\", \"scss2\"]);\r\n\tgulp.watch(\"scss/editormd.logo.scss\", [\"scss\", \"scss3\"]);\r\n\tgulp.watch(\"src/editormd.js\", [\"js\", \"amd\"]);\r\n});\r\n\r\ngulp.task(\"default\", function() {\r\n    gulp.run(\"scss\");\r\n    gulp.run(\"scss2\");\r\n    gulp.run(\"scss3\");\r\n    gulp.run(\"js\");\r\n    gulp.run(\"amd\");\r\n    gulp.run(\"cm-addon\");\r\n    gulp.run(\"cm-mode\");\r\n});"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.048828125,
          "content": "The MIT License (MIT)\n\nCopyright (c) 2015 pandao\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 13.64453125,
          "content": "# Editor.md\r\n\r\n![](https://pandao.github.io/editor.md/images/logos/editormd-logo-180x180.png)\r\n\r\n![](https://img.shields.io/github/stars/pandao/editor.md.svg)\r\n![](https://img.shields.io/github/forks/pandao/editor.md.svg)\r\n![](https://img.shields.io/github/tag/pandao/editor.md.svg)\r\n![](https://img.shields.io/github/release/pandao/editor.md.svg)\r\n![](https://img.shields.io/github/issues/pandao/editor.md.svg)\r\n![](https://img.shields.io/bower/v/editor.md.svg)\r\n\r\n**Editor.md** : The open source embeddable online markdown editor (component), based on CodeMirror & jQuery & Marked.\r\n\r\n### Features\r\n\r\n- Support Standard Markdown / CommonMark and GFM (GitHub Flavored Markdown);\r\n- Full-featured: Real-time Preview, Image (cross-domain) upload, Preformatted text/Code blocks/Tables insert, Code fold, Search replace, Read only, Themes, Multi-languages, L18n, HTML entities, Code syntax highlighting...;\r\n- Markdown Extras : Support [ToC (Table of Contents)](https://pandao.github.io/editor.md/examples/toc.html), [Emoji](https://pandao.github.io/editor.md/examples/emoji.html), [Task lists](https://pandao.github.io/editor.md/examples/task-lists.html), [@Links](https://pandao.github.io/editor.md/examples/@links.html)...;\r\n- Compatible with all major browsers (IE8+), compatible Zepto.js and iPad;\r\n- Support [decode & fliter of the HTML tags & attributes](https://pandao.github.io/editor.md/examples/html-tags-decode.html);\r\n- Support [TeX (LaTeX expressions, Based on KaTeX)](https://pandao.github.io/editor.md/examples/katex.html), [Flowchart](https://pandao.github.io/editor.md/examples/flowchart.html) and [Sequence Diagram](https://pandao.github.io/editor.md/examples/sequence-diagram.html) of Markdown extended syntax;\r\n- Support AMD/CMD (Require.js & Sea.js) Module Loader, and Custom/define editor plugins;\r\n\r\n[README & Examples (English)](https://pandao.github.io/editor.md/en.html)\r\n  \r\n\r\n--------\r\n\r\n**Editor.md** 是一款开源的、可嵌入的 Markdown 在线编辑器（组件），基于 CodeMirror、jQuery 和 Marked 构建。\r\n\r\n![editormd-screenshot](https://pandao.github.io/editor.md/examples/images/editormd-screenshot.png \"editormd-screenshot\")\r\n\r\n#### 主要特性\r\n\r\n- 支持通用 Markdown / CommonMark 和 GFM (GitHub Flavored Markdown) 风格的语法，也可[变身为代码编辑器](https://pandao.github.io/editor.md/examples/change-mode.html)；\r\n- 支持实时预览、图片（跨域）上传、预格式文本/代码/表格插入、代码折叠、跳转到行、搜索替换、只读模式、自定义样式主题和多语言语法高亮等功能；\r\n- 支持 [ToC（Table of Contents）](https://pandao.github.io/editor.md/examples/toc.html)、[Emoji表情](https://pandao.github.io/editor.md/examples/emoji.html)、[Task lists](https://pandao.github.io/editor.md/examples/task-lists.html)、[@链接](https://pandao.github.io/editor.md/examples/@links.html)等 Markdown 扩展语法；\r\n- 支持 TeX 科学公式（基于 [KaTeX](https://pandao.github.io/editor.md/examples/katex.html)）、流程图 [Flowchart](https://pandao.github.io/editor.md/examples/flowchart.html) 和 [时序图 Sequence Diagram](https://pandao.github.io/editor.md/examples/sequence-diagram.html);\r\n- 支持[识别和解析 HTML 标签，并且支持自定义过滤标签及属性解析](https://pandao.github.io/editor.md/examples/html-tags-decode.html)，具有可靠的安全性和几乎无限的扩展性；\r\n- 支持 AMD / CMD 模块化加载（支持 [Require.js](https://pandao.github.io/editor.md/examples/use-requirejs.html) & [Sea.js](https://pandao.github.io/editor.md/examples/use-seajs.html)），并且支持[自定义扩展插件](https://pandao.github.io/editor.md/examples/define-plugin.html)；\r\n- 兼容主流的浏览器（IE8+）和 [Zepto.js](https://pandao.github.io/editor.md/examples/use-zepto.html)，且支持 iPad 等平板设备；\r\n\r\n#### Download & install\n\nDownload:\r\n\r\n[Github download](https://github.com/pandao/editor.md/archive/master.zip)\r\n\r\nNPM install :\r\n\r\n```bash\r\nnpm install editor.md\r\n```\r\n\r\nBower install :\r\n\r\n```bash\r\nbower install editor.md\r\n```\r\n\r\n#### Usages\n\n##### Create a Markdown editor\r\n\r\n```html\r\n<link rel=\"stylesheet\" href=\"editor.md/css/editormd.min.css\" />\r\n<div id=\"editor\">\n    <!-- Tips: Editor.md can auto append a `<textarea>` tag -->\r\n    <textarea style=\"display:none;\">### Hello Editor.md !</textarea>\r\n</div>\r\n<script src=\"jquery.min.js\"></script>\r\n<script src=\"editor.md/editormd.min.js\"></script>\r\n<script type=\"text/javascript\">\r\n    $(function() {\r\n        var editor = editormd(\"editor\", {\n            // width: \"100%\",\n            // height: \"100%\",\n            // markdown: \"xxxx\",     // dynamic set Markdown text\r\n            path : \"editor.md/lib/\"  // Autoload modules mode, codemirror, marked... dependents libs path\r\n        });\r\n    });\r\n</script>\r\n```\r\n\r\nIf you using modular script loader:\r\n\r\n- [Using Require.js](https://github.com/pandao/editor.md/tree/master/examples/use-requirejs.html)\r\n- [Using Sea.js](https://github.com/pandao/editor.md/tree/master/examples/use-seajs.html)\n\n##### Markdown to HTML\n\n```html\r\n<link rel=\"stylesheet\" href=\"editormd/css/editormd.preview.css\" />\r\n<div id=\"test-markdown-view\">\n    <!-- Server-side output Markdown text -->\r\n    <textarea style=\"display:none;\">### Hello world!</textarea>             \r\n</div>\r\n<script src=\"jquery.min.js\"></script>\r\n<script src=\"editormd/editormd.js\"></script>\r\n<script src=\"editormd/lib/marked.min.js\"></script>\r\n<script src=\"editormd/lib/prettify.min.js\"></script>\r\n<script type=\"text/javascript\">\r\n    $(function() {\r\n\t    var testView = editormd.markdownToHTML(\"test-markdown-view\", {\r\n            // markdown : \"[TOC]\\n### Hello world!\\n## Heading 2\", // Also, you can dynamic set Markdown text\r\n            // htmlDecode : true,  // Enable / disable HTML tag encode.\r\n            // htmlDecode : \"style,script,iframe\",  // Note: If enabled, you should filter some dangerous HTML tags for website security.\r\n        });\n    });\n</script>    \n```\n\n> See the full example: [http://editor.md.ipandao.com/examples/html-preview-markdown-to-html.html](http://editor.md.ipandao.com/examples/html-preview-markdown-to-html.html)\n\n##### HTML to Markdown?\n\nSorry, Editor.md not support HTML to Markdown parsing, Maybe In the future.\r\n\r\n#### Examples\r\n\r\n[https://pandao.github.io/editor.md/examples/index.html](https://pandao.github.io/editor.md/examples/index.html)\n\n#### Options\n\nEditor.md options and default values:\n\n```javascript\n{\r\n    mode                 : \"gfm\",          // gfm or markdown\r\n    name                 : \"\",             // Form element name for post\r\n    value                : \"\",             // value for CodeMirror, if mode not gfm/markdown\r\n    theme                : \"\",             // Editor.md self themes, before v1.5.0 is CodeMirror theme, default empty\r\n    editorTheme          : \"default\",      // Editor area, this is CodeMirror theme at v1.5.0\r\n    previewTheme         : \"\",             // Preview area theme, default empty\r\n    markdown             : \"\",             // Markdown source code\r\n    appendMarkdown       : \"\",             // if in init textarea value not empty, append markdown to textarea\r\n    width                : \"100%\",\r\n    height               : \"100%\",\r\n    path                 : \"./lib/\",       // Dependents module file directory\r\n    pluginPath           : \"\",             // If this empty, default use settings.path + \"../plugins/\"\r\n    delay                : 300,            // Delay parse markdown to html, Uint : ms\r\n    autoLoadModules      : true,           // Automatic load dependent module files\r\n    watch                : true,\r\n    placeholder          : \"Enjoy Markdown! coding now...\",\r\n    gotoLine             : true,           // Enable / disable goto a line\r\n    codeFold             : false,\r\n    autoHeight           : false,\r\n    autoFocus            : true,           // Enable / disable auto focus editor left input area\r\n    autoCloseTags        : true,\r\n    searchReplace        : true,           // Enable / disable (CodeMirror) search and replace function\r\n    syncScrolling        : true,           // options: true | false | \"single\", default true\r\n    readOnly             : false,          // Enable / disable readonly mode\r\n    tabSize              : 4,\r\n    indentUnit           : 4,\r\n    lineNumbers          : true,           // Display editor line numbers\r\n    lineWrapping         : true,\r\n    autoCloseBrackets    : true,\r\n    showTrailingSpace    : true,\r\n    matchBrackets        : true,\r\n    indentWithTabs       : true,\r\n    styleSelectedText    : true,\r\n    matchWordHighlight   : true,           // options: true, false, \"onselected\"\r\n    styleActiveLine      : true,           // Highlight the current line\r\n    dialogLockScreen     : true,\r\n    dialogShowMask       : true,\r\n    dialogDraggable      : true,\r\n    dialogMaskBgColor    : \"#fff\",\r\n    dialogMaskOpacity    : 0.1,\r\n    fontSize             : \"13px\",\r\n    saveHTMLToTextarea   : false,          // If enable, Editor will create a <textarea name=\"{editor-id}-html-code\"> tag save HTML code for form post to server-side.\r\n    disabledKeyMaps      : [],\r\n    \r\n    onload               : function() {},\r\n    onresize             : function() {},\r\n    onchange             : function() {},\r\n    onwatch              : null,\r\n    onunwatch            : null,\r\n    onpreviewing         : function() {},\r\n    onpreviewed          : function() {},\r\n    onfullscreen         : function() {},\r\n    onfullscreenExit     : function() {},\r\n    onscroll             : function() {},\r\n    onpreviewscroll      : function() {},\r\n    \r\n    imageUpload          : false,          // Enable/disable upload\r\n    imageFormats         : [\"jpg\", \"jpeg\", \"gif\", \"png\", \"bmp\", \"webp\"],\r\n    imageUploadURL       : \"\",             // Upload url\r\n    crossDomainUpload    : false,          // Enable/disable Cross-domain upload\r\n    uploadCallbackURL    : \"\",             // Cross-domain upload callback url\r\n\r\n    toc                  : true,           // Table of contents\r\n    tocm                 : false,          // Using [TOCM], auto create ToC dropdown menu\r\n    tocTitle             : \"\",             // for ToC dropdown menu button\r\n    tocDropdown          : false,          // Enable/disable Table Of Contents dropdown menu\r\n    tocContainer         : \"\",             // Custom Table Of Contents Container Selector\r\n    tocStartLevel        : 1,              // Said from H1 to create ToC\r\n    htmlDecode           : false,          // Open the HTML tag identification \r\n    pageBreak            : true,           // Enable parse page break [========]\r\n    atLink               : true,           // for @link\r\n    emailLink            : true,           // for email address auto link\r\n    taskList             : false,          // Enable Github Flavored Markdown task lists\r\n    emoji                : false,          // :emoji: , Support Github emoji, Twitter Emoji (Twemoji);\r\n                                           // Support FontAwesome icon emoji :fa-xxx: > Using fontAwesome icon web fonts;\r\n                                           // Support Editor.md logo icon emoji :editormd-logo: :editormd-logo-1x: > 1~8x;\r\n    tex                  : false,          // TeX(LaTeX), based on KaTeX\r\n    flowChart            : false,          // flowChart.js only support IE9+\r\n    sequenceDiagram      : false,          // sequenceDiagram.js only support IE9+\r\n    previewCodeHighlight : true,           // Enable / disable code highlight of editor preview area\r\n\r\n    toolbar              : true,           // show or hide toolbar\r\n    toolbarAutoFixed     : true,           // on window scroll auto fixed position\r\n    toolbarIcons         : \"full\",         // Toolbar icons mode, options: full, simple, mini, See `editormd.toolbarModes` property.\r\n    toolbarTitles        : {},\r\n    toolbarHandlers      : {\r\n        ucwords : function() {\r\n            return editormd.toolbarHandlers.ucwords;\r\n        },\r\n        lowercase : function() {\r\n            return editormd.toolbarHandlers.lowercase;\r\n        }\r\n    },\r\n    toolbarCustomIcons   : {               // using html tag create toolbar icon, unused default <a> tag.\r\n        lowercase        : \"<a href=\\\"javascript:;\\\" title=\\\"Lowercase\\\" unselectable=\\\"on\\\"><i class=\\\"fa\\\" name=\\\"lowercase\\\" style=\\\"font-size:24px;margin-top: -10px;\\\">a</i></a>\",\r\n        \"ucwords\"        : \"<a href=\\\"javascript:;\\\" title=\\\"ucwords\\\" unselectable=\\\"on\\\"><i class=\\\"fa\\\" name=\\\"ucwords\\\" style=\\\"font-size:20px;margin-top: -3px;\\\">Aa</i></a>\"\r\n    },\r\n    toolbarIconTexts     : {},\r\n    \r\n    lang : {  // Language data, you can custom your language.\r\n        name        : \"zh-cn\",\r\n        description : \"开源在线Markdown编辑器<br/>Open source online Markdown editor.\",\r\n        tocTitle    : \"目录\",\r\n        toolbar     : {\n            //...\n        },\n        button: {\n            //...\n        },\r\n        dialog : {\n            //...\n        }\n        //...\n    }\n}\n```\r\n\r\n#### Dependents\r\n\r\n- [CodeMirror](http://codemirror.net/ \"CodeMirror\")\r\n- [marked](https://github.com/markedjs/marked \"marked\")\r\n- [jQuery](http://jquery.com/ \"jQuery\")\r\n- [FontAwesome](http://fontawesome.io/ \"FontAwesome\")\r\n- [github-markdown.css](https://github.com/sindresorhus/github-markdown-css \"github-markdown.css\")\r\n- [KaTeX](http://khan.github.io/KaTeX/ \"KaTeX\")\r\n- [prettify.js](http://code.google.com/p/google-code-prettify/ \"prettify.js\")\r\n- [Rephael.js](http://raphaeljs.com/ \"Rephael.js\")\r\n- [flowchart.js](http://adrai.github.io/flowchart.js/ \"flowchart.js\")\r\n- [sequence-diagram.js](http://bramp.github.io/js-sequence-diagrams/ \"sequence-diagram.js\")\r\n- [Prefixes.scss](https://github.com/pandao/prefixes.scss \"Prefixes.scss\")\r\n\r\n#### Changes\r\n\r\n[Change logs](https://github.com/pandao/editor.md/blob/master/CHANGE.md)\r\n\r\n#### License\r\n\r\nThe MIT License.\r\n\r\nCopyright (c) 2015-2019 Pandao\r\n"
        },
        {
          "name": "bower.json",
          "type": "blob",
          "size": 0.4150390625,
          "content": "{\n  \"name\": \"editor.md\",\n  \"version\": \"1.5.0\",\n  \"homepage\": \"https://github.com/pandao/editor.md\",\n  \"authors\": [\n    \"Pandao <pandao@vip.qq.com>\"\n  ],\n  \"description\": \"Open source online markdown editor.\",\n  \"keywords\": [\n    \"editor.md\",\n    \"markdown\",\n    \"editor\"\n  ],\n  \"license\": \"MIT\",\n  \"ignore\": [\n    \"**/.*\",\n    \"research\",\n    \"docs\",\n    \"node_modules\",\n    \"bower_components\",\n    \"test\",\n    \"tests\"\n  ]\n}\n"
        },
        {
          "name": "css",
          "type": "tree",
          "content": null
        },
        {
          "name": "docs",
          "type": "tree",
          "content": null
        },
        {
          "name": "editormd.amd.js",
          "type": "blob",
          "size": 162.4267578125,
          "content": "/*\r\n * Editor.md\r\n *\r\n * @file        editormd.amd.js \r\n * @version     v1.5.0 \r\n * @description Open source online markdown editor.\r\n * @license     MIT License\r\n * @author      Pandao\r\n * {@link       https://github.com/pandao/editor.md}\r\n * @updateTime  2015-06-09\r\n */\r\n\r\n;(function(factory) {\r\n    \"use strict\";\r\n    \r\n\t// CommonJS/Node.js\r\n\tif (typeof require === \"function\" && typeof exports === \"object\" && typeof module === \"object\")\r\n    { \r\n        module.exports = factory;\r\n    }\r\n\telse if (typeof define === \"function\")  // AMD/CMD/Sea.js\r\n\t{\r\n        if (define.amd) // for Require.js\r\n        {\r\n            var cmModePath  = \"./lib/codemirror/mode/\";\r\n            var cmAddonPath = \"./lib/codemirror/addon/\";\r\n\r\n            var codeMirrorModules = [\r\n                \"jquery\", \"marked\", \"prettify\",\r\n                \"katex\", \"raphael\", \"underscore\", \"flowchart\",  \"jqueryflowchart\",  \"sequenceDiagram\",\r\n\r\n                \"./lib/codemirror/lib/codemirror\",\r\n                cmModePath + \"css/css\",\r\n                cmModePath + \"sass/sass\",\r\n                cmModePath + \"shell/shell\",\r\n                cmModePath + \"sql/sql\",\r\n                cmModePath + \"clike/clike\",\r\n                cmModePath + \"php/php\",\r\n                cmModePath + \"xml/xml\",\r\n                cmModePath + \"markdown/markdown\",\r\n                cmModePath + \"javascript/javascript\",\r\n                cmModePath + \"htmlmixed/htmlmixed\",\r\n                cmModePath + \"gfm/gfm\",\r\n                cmModePath + \"http/http\",\r\n                cmModePath + \"go/go\",\r\n                cmModePath + \"dart/dart\",\r\n                cmModePath + \"coffeescript/coffeescript\",\r\n                cmModePath + \"nginx/nginx\",\r\n                cmModePath + \"python/python\",\r\n                cmModePath + \"perl/perl\",\r\n                cmModePath + \"lua/lua\",\r\n                cmModePath + \"r/r\", \r\n                cmModePath + \"ruby/ruby\", \r\n                cmModePath + \"rst/rst\",\r\n                cmModePath + \"smartymixed/smartymixed\",\r\n                cmModePath + \"vb/vb\",\r\n                cmModePath + \"vbscript/vbscript\",\r\n                cmModePath + \"velocity/velocity\",\r\n                cmModePath + \"xquery/xquery\",\r\n                cmModePath + \"yaml/yaml\",\r\n                cmModePath + \"erlang/erlang\",\r\n                cmModePath + \"jade/jade\",\r\n\r\n                cmAddonPath + \"edit/trailingspace\", \r\n                cmAddonPath + \"dialog/dialog\", \r\n                cmAddonPath + \"search/searchcursor\", \r\n                cmAddonPath + \"search/search\", \r\n                cmAddonPath + \"scroll/annotatescrollbar\", \r\n                cmAddonPath + \"search/matchesonscrollbar\", \r\n                cmAddonPath + \"display/placeholder\", \r\n                cmAddonPath + \"edit/closetag\", \r\n                cmAddonPath + \"fold/foldcode\",\r\n                cmAddonPath + \"fold/foldgutter\",\r\n                cmAddonPath + \"fold/indent-fold\",\r\n                cmAddonPath + \"fold/brace-fold\",\r\n                cmAddonPath + \"fold/xml-fold\", \r\n                cmAddonPath + \"fold/markdown-fold\",\r\n                cmAddonPath + \"fold/comment-fold\", \r\n                cmAddonPath + \"mode/overlay\", \r\n                cmAddonPath + \"selection/active-line\", \r\n                cmAddonPath + \"edit/closebrackets\", \r\n                cmAddonPath + \"display/fullscreen\",\r\n                cmAddonPath + \"search/match-highlighter\"\r\n            ];\r\n\r\n            define(codeMirrorModules, factory);\r\n        } \r\n        else \r\n        {\r\n\t\t    define([\"jquery\"], factory);  // for Sea.js\r\n        }\r\n\t} \r\n\telse\r\n\t{ \r\n        window.editormd = factory();\r\n\t}\r\n    \r\n}(function() {    \r\n\r\n    if (typeof define == \"function\" && define.amd) {\r\n       $          = arguments[0];\r\n       marked     = arguments[1];\r\n       prettify   = arguments[2];\r\n       katex      = arguments[3];\r\n       Raphael    = arguments[4];\r\n       _          = arguments[5];\r\n       flowchart  = arguments[6];\r\n       CodeMirror = arguments[9];\r\n   }\r\n    \r\n    \"use strict\";\r\n    \r\n    var $ = (typeof (jQuery) !== \"undefined\") ? jQuery : Zepto;\r\n\r\n\tif (typeof ($) === \"undefined\") {\r\n\t\treturn ;\r\n\t}\r\n    \r\n    /**\r\n     * editormd\r\n     * \r\n     * @param   {String} id           编辑器的ID\r\n     * @param   {Object} options      配置选项 Key/Value\r\n     * @returns {Object} editormd     返回editormd对象\r\n     */\r\n    \r\n    var editormd         = function (id, options) {\r\n        return new editormd.fn.init(id, options);\r\n    };\r\n    \r\n    editormd.title        = editormd.$name = \"Editor.md\";\r\n    editormd.version      = \"1.5.0\";\r\n    editormd.homePage     = \"https://pandao.github.io/editor.md/\";\r\n    editormd.classPrefix  = \"editormd-\";\r\n    \r\n    editormd.toolbarModes = {\r\n        full : [\r\n            \"undo\", \"redo\", \"|\", \r\n            \"bold\", \"del\", \"italic\", \"quote\", \"ucwords\", \"uppercase\", \"lowercase\", \"|\", \r\n            \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"|\", \r\n            \"list-ul\", \"list-ol\", \"hr\", \"|\",\r\n            \"link\", \"reference-link\", \"image\", \"code\", \"preformatted-text\", \"code-block\", \"table\", \"datetime\", \"emoji\", \"html-entities\", \"pagebreak\", \"|\",\r\n            \"goto-line\", \"watch\", \"preview\", \"fullscreen\", \"clear\", \"search\", \"|\",\r\n            \"help\", \"info\"\r\n        ],\r\n        simple : [\r\n            \"undo\", \"redo\", \"|\", \r\n            \"bold\", \"del\", \"italic\", \"quote\", \"uppercase\", \"lowercase\", \"|\", \r\n            \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"|\", \r\n            \"list-ul\", \"list-ol\", \"hr\", \"|\",\r\n            \"watch\", \"preview\", \"fullscreen\", \"|\",\r\n            \"help\", \"info\"\r\n        ],\r\n        mini : [\r\n            \"undo\", \"redo\", \"|\",\r\n            \"watch\", \"preview\", \"|\",\r\n            \"help\", \"info\"\r\n        ]\r\n    };\r\n    \r\n    editormd.defaults     = {\r\n        mode                 : \"gfm\",          //gfm or markdown\r\n        name                 : \"\",             // Form element name\r\n        value                : \"\",             // value for CodeMirror, if mode not gfm/markdown\r\n        theme                : \"\",             // Editor.md self themes, before v1.5.0 is CodeMirror theme, default empty\r\n        editorTheme          : \"default\",      // Editor area, this is CodeMirror theme at v1.5.0\r\n        previewTheme         : \"\",             // Preview area theme, default empty\r\n        markdown             : \"\",             // Markdown source code\r\n        appendMarkdown       : \"\",             // if in init textarea value not empty, append markdown to textarea\r\n        width                : \"100%\",\r\n        height               : \"100%\",\r\n        path                 : \"./lib/\",       // Dependents module file directory\r\n        pluginPath           : \"\",             // If this empty, default use settings.path + \"../plugins/\"\r\n        delay                : 300,            // Delay parse markdown to html, Uint : ms\r\n        autoLoadModules      : true,           // Automatic load dependent module files\r\n        watch                : true,\r\n        placeholder          : \"Enjoy Markdown! coding now...\",\r\n        gotoLine             : true,\r\n        codeFold             : false,\r\n        autoHeight           : false,\r\n\t\tautoFocus            : true,\r\n        autoCloseTags        : true,\r\n        searchReplace        : true,\r\n        syncScrolling        : true,           // true | false | \"single\", default true\r\n        readOnly             : false,\r\n        tabSize              : 4,\r\n\t\tindentUnit           : 4,\r\n        lineNumbers          : true,\r\n\t\tlineWrapping         : true,\r\n\t\tautoCloseBrackets    : true,\r\n\t\tshowTrailingSpace    : true,\r\n\t\tmatchBrackets        : true,\r\n\t\tindentWithTabs       : true,\r\n\t\tstyleSelectedText    : true,\r\n        matchWordHighlight   : true,           // options: true, false, \"onselected\"\r\n        styleActiveLine      : true,           // Highlight the current line\r\n        dialogLockScreen     : true,\r\n        dialogShowMask       : true,\r\n        dialogDraggable      : true,\r\n        dialogMaskBgColor    : \"#fff\",\r\n        dialogMaskOpacity    : 0.1,\r\n        fontSize             : \"13px\",\r\n        saveHTMLToTextarea   : false,\r\n        disabledKeyMaps      : [],\r\n        \r\n        onload               : function() {},\r\n        onresize             : function() {},\r\n        onchange             : function() {},\r\n        onwatch              : null,\r\n        onunwatch            : null,\r\n        onpreviewing         : function() {},\r\n        onpreviewed          : function() {},\r\n        onfullscreen         : function() {},\r\n        onfullscreenExit     : function() {},\r\n        onscroll             : function() {},\r\n        onpreviewscroll      : function() {},\r\n        \r\n        imageUpload          : false,\r\n        imageFormats         : [\"jpg\", \"jpeg\", \"gif\", \"png\", \"bmp\", \"webp\"],\r\n        imageUploadURL       : \"\",\r\n        crossDomainUpload    : false,\r\n        uploadCallbackURL    : \"\",\r\n        \r\n        toc                  : true,           // Table of contents\r\n        tocm                 : false,           // Using [TOCM], auto create ToC dropdown menu\r\n        tocTitle             : \"\",             // for ToC dropdown menu btn\r\n        tocDropdown          : false,\r\n        tocContainer         : \"\",\r\n        tocStartLevel        : 1,              // Said from H1 to create ToC\r\n        htmlDecode           : false,          // Open the HTML tag identification \r\n        pageBreak            : true,           // Enable parse page break [========]\r\n        atLink               : true,           // for @link\r\n        emailLink            : true,           // for email address auto link\r\n        taskList             : false,          // Enable Github Flavored Markdown task lists\r\n        emoji                : false,          // :emoji: , Support Github emoji, Twitter Emoji (Twemoji);\r\n                                               // Support FontAwesome icon emoji :fa-xxx: > Using fontAwesome icon web fonts;\r\n                                               // Support Editor.md logo icon emoji :editormd-logo: :editormd-logo-1x: > 1~8x;\r\n        tex                  : false,          // TeX(LaTeX), based on KaTeX\r\n        flowChart            : false,          // flowChart.js only support IE9+\r\n        sequenceDiagram      : false,          // sequenceDiagram.js only support IE9+\r\n        previewCodeHighlight : true,\r\n                \r\n        toolbar              : true,           // show/hide toolbar\r\n        toolbarAutoFixed     : true,           // on window scroll auto fixed position\r\n        toolbarIcons         : \"full\",\r\n        toolbarTitles        : {},\r\n        toolbarHandlers      : {\r\n            ucwords : function() {\r\n                return editormd.toolbarHandlers.ucwords;\r\n            },\r\n            lowercase : function() {\r\n                return editormd.toolbarHandlers.lowercase;\r\n            }\r\n        },\r\n        toolbarCustomIcons   : {               // using html tag create toolbar icon, unused default <a> tag.\r\n            lowercase        : \"<a href=\\\"javascript:;\\\" title=\\\"Lowercase\\\" unselectable=\\\"on\\\"><i class=\\\"fa\\\" name=\\\"lowercase\\\" style=\\\"font-size:24px;margin-top: -10px;\\\">a</i></a>\",\r\n            \"ucwords\"        : \"<a href=\\\"javascript:;\\\" title=\\\"ucwords\\\" unselectable=\\\"on\\\"><i class=\\\"fa\\\" name=\\\"ucwords\\\" style=\\\"font-size:20px;margin-top: -3px;\\\">Aa</i></a>\"\r\n        }, \r\n        toolbarIconsClass    : {\r\n            undo             : \"fa-undo\",\r\n            redo             : \"fa-repeat\",\r\n            bold             : \"fa-bold\",\r\n            del              : \"fa-strikethrough\",\r\n            italic           : \"fa-italic\",\r\n            quote            : \"fa-quote-left\",\r\n            uppercase        : \"fa-font\",\r\n            h1               : editormd.classPrefix + \"bold\",\r\n            h2               : editormd.classPrefix + \"bold\",\r\n            h3               : editormd.classPrefix + \"bold\",\r\n            h4               : editormd.classPrefix + \"bold\",\r\n            h5               : editormd.classPrefix + \"bold\",\r\n            h6               : editormd.classPrefix + \"bold\",\r\n            \"list-ul\"        : \"fa-list-ul\",\r\n            \"list-ol\"        : \"fa-list-ol\",\r\n            hr               : \"fa-minus\",\r\n            link             : \"fa-link\",\r\n            \"reference-link\" : \"fa-anchor\",\r\n            image            : \"fa-picture-o\",\r\n            code             : \"fa-code\",\r\n            \"preformatted-text\" : \"fa-file-code-o\",\r\n            \"code-block\"     : \"fa-file-code-o\",\r\n            table            : \"fa-table\",\r\n            datetime         : \"fa-clock-o\",\r\n            emoji            : \"fa-smile-o\",\r\n            \"html-entities\"  : \"fa-copyright\",\r\n            pagebreak        : \"fa-newspaper-o\",\r\n            \"goto-line\"      : \"fa-terminal\", // fa-crosshairs\r\n            watch            : \"fa-eye-slash\",\r\n            unwatch          : \"fa-eye\",\r\n            preview          : \"fa-desktop\",\r\n            search           : \"fa-search\",\r\n            fullscreen       : \"fa-arrows-alt\",\r\n            clear            : \"fa-eraser\",\r\n            help             : \"fa-question-circle\",\r\n            info             : \"fa-info-circle\"\r\n        },        \r\n        toolbarIconTexts     : {},\r\n        \r\n        lang : {\r\n            name        : \"zh-cn\",\r\n            description : \"开源在线Markdown编辑器<br/>Open source online Markdown editor.\",\r\n            tocTitle    : \"目录\",\r\n            toolbar     : {\r\n                undo             : \"撤销（Ctrl+Z）\",\r\n                redo             : \"重做（Ctrl+Y）\",\r\n                bold             : \"粗体\",\r\n                del              : \"删除线\",\r\n                italic           : \"斜体\",\r\n                quote            : \"引用\",\r\n                ucwords          : \"将每个单词首字母转成大写\",\r\n                uppercase        : \"将所选转换成大写\",\r\n                lowercase        : \"将所选转换成小写\",\r\n                h1               : \"标题1\",\r\n                h2               : \"标题2\",\r\n                h3               : \"标题3\",\r\n                h4               : \"标题4\",\r\n                h5               : \"标题5\",\r\n                h6               : \"标题6\",\r\n                \"list-ul\"        : \"无序列表\",\r\n                \"list-ol\"        : \"有序列表\",\r\n                hr               : \"横线\",\r\n                link             : \"链接\",\r\n                \"reference-link\" : \"引用链接\",\r\n                image            : \"添加图片\",\r\n                code             : \"行内代码\",\r\n                \"preformatted-text\" : \"预格式文本 / 代码块（缩进风格）\",\r\n                \"code-block\"     : \"代码块（多语言风格）\",\r\n                table            : \"添加表格\",\r\n                datetime         : \"日期时间\",\r\n                emoji            : \"Emoji表情\",\r\n                \"html-entities\"  : \"HTML实体字符\",\r\n                pagebreak        : \"插入分页符\",\r\n                \"goto-line\"      : \"跳转到行\",\r\n                watch            : \"关闭实时预览\",\r\n                unwatch          : \"开启实时预览\",\r\n                preview          : \"全窗口预览HTML（按 Shift + ESC还原）\",\r\n                fullscreen       : \"全屏（按ESC还原）\",\r\n                clear            : \"清空\",\r\n                search           : \"搜索\",\r\n                help             : \"使用帮助\",\r\n                info             : \"关于\" + editormd.title\r\n            },\r\n            buttons : {\r\n                enter  : \"确定\",\r\n                cancel : \"取消\",\r\n                close  : \"关闭\"\r\n            },\r\n            dialog : {\r\n                link : {\r\n                    title    : \"添加链接\",\r\n                    url      : \"链接地址\",\r\n                    urlTitle : \"链接标题\",\r\n                    urlEmpty : \"错误：请填写链接地址。\"\r\n                },\r\n                referenceLink : {\r\n                    title    : \"添加引用链接\",\r\n                    name     : \"引用名称\",\r\n                    url      : \"链接地址\",\r\n                    urlId    : \"链接ID\",\r\n                    urlTitle : \"链接标题\",\r\n                    nameEmpty: \"错误：引用链接的名称不能为空。\",\r\n                    idEmpty  : \"错误：请填写引用链接的ID。\",\r\n                    urlEmpty : \"错误：请填写引用链接的URL地址。\"\r\n                },\r\n                image : {\r\n                    title    : \"添加图片\",\r\n                    url      : \"图片地址\",\r\n                    link     : \"图片链接\",\r\n                    alt      : \"图片描述\",\r\n                    uploadButton     : \"本地上传\",\r\n                    imageURLEmpty    : \"错误：图片地址不能为空。\",\r\n                    uploadFileEmpty  : \"错误：上传的图片不能为空。\",\r\n                    formatNotAllowed : \"错误：只允许上传图片文件，允许上传的图片文件格式有：\"\r\n                },\r\n                preformattedText : {\r\n                    title             : \"添加预格式文本或代码块\", \r\n                    emptyAlert        : \"错误：请填写预格式文本或代码的内容。\"\r\n                },\r\n                codeBlock : {\r\n                    title             : \"添加代码块\",                    \r\n                    selectLabel       : \"代码语言：\",\r\n                    selectDefaultText : \"请选择代码语言\",\r\n                    otherLanguage     : \"其他语言\",\r\n                    unselectedLanguageAlert : \"错误：请选择代码所属的语言类型。\",\r\n                    codeEmptyAlert    : \"错误：请填写代码内容。\"\r\n                },\r\n                htmlEntities : {\r\n                    title : \"HTML 实体字符\"\r\n                },\r\n                help : {\r\n                    title : \"使用帮助\"\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    editormd.classNames  = {\r\n        tex : editormd.classPrefix + \"tex\"\r\n    };\r\n\r\n    editormd.dialogZindex = 99999;\r\n    \r\n    editormd.$katex       = null;\r\n    editormd.$marked      = null;\r\n    editormd.$CodeMirror  = null;\r\n    editormd.$prettyPrint = null;\r\n    \r\n    var timer, flowchartTimer;\r\n\r\n    editormd.prototype    = editormd.fn = {\r\n        state : {\r\n            watching   : false,\r\n            loaded     : false,\r\n            preview    : false,\r\n            fullscreen : false\r\n        },\r\n        \r\n        /**\r\n         * 构造函数/实例初始化\r\n         * Constructor / instance initialization\r\n         * \r\n         * @param   {String}   id            编辑器的ID\r\n         * @param   {Object}   [options={}]  配置选项 Key/Value\r\n         * @returns {editormd}               返回editormd的实例对象\r\n         */\r\n        \r\n        init : function (id, options) {\r\n            \r\n            options              = options || {};\r\n            \r\n            if (typeof id === \"object\")\r\n            {\r\n                options = id;\r\n            }\r\n            \r\n            var _this            = this;\r\n            var classPrefix      = this.classPrefix  = editormd.classPrefix; \r\n            var settings         = this.settings     = $.extend(true, editormd.defaults, options);\r\n            \r\n            id                   = (typeof id === \"object\") ? settings.id : id;\r\n            \r\n            var editor           = this.editor       = $(\"#\" + id);\r\n            \r\n            this.id              = id;\r\n            this.lang            = settings.lang;\r\n            \r\n            var classNames       = this.classNames   = {\r\n                textarea : {\r\n                    html     : classPrefix + \"html-textarea\",\r\n                    markdown : classPrefix + \"markdown-textarea\"\r\n                }\r\n            };\r\n            \r\n            settings.pluginPath = (settings.pluginPath === \"\") ? settings.path + \"../plugins/\" : settings.pluginPath; \r\n            \r\n            this.state.watching = (settings.watch) ? true : false;\r\n            \r\n            if ( !editor.hasClass(\"editormd\") ) {\r\n                editor.addClass(\"editormd\");\r\n            }\r\n            \r\n            editor.css({\r\n                width  : (typeof settings.width  === \"number\") ? settings.width  + \"px\" : settings.width,\r\n                height : (typeof settings.height === \"number\") ? settings.height + \"px\" : settings.height\r\n            });\r\n            \r\n            if (settings.autoHeight)\r\n            {\r\n                editor.css(\"height\", \"auto\");\r\n            }\r\n                        \r\n            var markdownTextarea = this.markdownTextarea = editor.children(\"textarea\");\r\n            \r\n            if (markdownTextarea.length < 1)\r\n            {\r\n                editor.append(\"<textarea></textarea>\");\r\n                markdownTextarea = this.markdownTextarea = editor.children(\"textarea\");\r\n            }\r\n            \r\n            markdownTextarea.addClass(classNames.textarea.markdown).attr(\"placeholder\", settings.placeholder);\r\n            \r\n            if (typeof markdownTextarea.attr(\"name\") === \"undefined\" || markdownTextarea.attr(\"name\") === \"\")\r\n            {\r\n                markdownTextarea.attr(\"name\", (settings.name !== \"\") ? settings.name : id + \"-markdown-doc\");\r\n            }\r\n            \r\n            var appendElements = [\r\n                (!settings.readOnly) ? \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"preview-close-btn\\\"></a>\" : \"\",\r\n                ( (settings.saveHTMLToTextarea) ? \"<textarea class=\\\"\" + classNames.textarea.html + \"\\\" name=\\\"\" + id + \"-html-code\\\"></textarea>\" : \"\" ),\r\n                \"<div class=\\\"\" + classPrefix + \"preview\\\"><div class=\\\"markdown-body \" + classPrefix + \"preview-container\\\"></div></div>\",\r\n                \"<div class=\\\"\" + classPrefix + \"container-mask\\\" style=\\\"display:block;\\\"></div>\",\r\n                \"<div class=\\\"\" + classPrefix + \"mask\\\"></div>\"\r\n            ].join(\"\\n\");\r\n            \r\n            editor.append(appendElements).addClass(classPrefix + \"vertical\");\r\n            \r\n            if (settings.theme !== \"\") \r\n            {\r\n                editor.addClass(classPrefix + \"theme-\" + settings.theme);\r\n            }\r\n            \r\n            this.mask          = editor.children(\".\" + classPrefix + \"mask\");    \r\n            this.containerMask = editor.children(\".\" + classPrefix  + \"container-mask\");\r\n            \r\n            if (settings.markdown !== \"\")\r\n            {\r\n                markdownTextarea.val(settings.markdown);\r\n            }\r\n            \r\n            if (settings.appendMarkdown !== \"\")\r\n            {\r\n                markdownTextarea.val(markdownTextarea.val() + settings.appendMarkdown);\r\n            }\r\n            \r\n            this.htmlTextarea     = editor.children(\".\" + classNames.textarea.html);            \r\n            this.preview          = editor.children(\".\" + classPrefix + \"preview\");\r\n            this.previewContainer = this.preview.children(\".\" + classPrefix + \"preview-container\");\r\n            \r\n            if (settings.previewTheme !== \"\") \r\n            {\r\n                this.preview.addClass(classPrefix + \"preview-theme-\" + settings.previewTheme);\r\n            }\r\n            \r\n            if (typeof define === \"function\" && define.amd)\r\n            {\r\n                if (typeof katex !== \"undefined\") \r\n                {\r\n                    editormd.$katex = katex;\r\n                }\r\n                \r\n                if (settings.searchReplace && !settings.readOnly) \r\n                {\r\n                    editormd.loadCSS(settings.path + \"codemirror/addon/dialog/dialog\");\r\n                    editormd.loadCSS(settings.path + \"codemirror/addon/search/matchesonscrollbar\");\r\n                }\r\n            }\r\n            \r\n            if ((typeof define === \"function\" && define.amd) || !settings.autoLoadModules)\r\n            {\r\n                if (typeof CodeMirror !== \"undefined\") {\r\n                    editormd.$CodeMirror = CodeMirror;\r\n                }\r\n                \r\n                if (typeof marked     !== \"undefined\") {\r\n                    editormd.$marked     = marked;\r\n                }\r\n                \r\n                this.setCodeMirror().setToolbar().loadedDisplay();\r\n            } \r\n            else \r\n            {\r\n                this.loadQueues();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 所需组件加载队列\r\n         * Required components loading queue\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        loadQueues : function() {\r\n            var _this        = this;\r\n            var settings     = this.settings;\r\n            var loadPath     = settings.path;\r\n                                \r\n            var loadFlowChartOrSequenceDiagram = function() {\r\n                \r\n                if (editormd.isIE8) \r\n                {\r\n                    _this.loadedDisplay();\r\n                    \r\n                    return ;\r\n                }\r\n\r\n                if (settings.flowChart || settings.sequenceDiagram) \r\n                {\r\n                    editormd.loadScript(loadPath + \"raphael.min\", function() {\r\n\r\n                        editormd.loadScript(loadPath + \"underscore.min\", function() {  \r\n\r\n                            if (!settings.flowChart && settings.sequenceDiagram) \r\n                            {\r\n                                editormd.loadScript(loadPath + \"sequence-diagram.min\", function() {\r\n                                    _this.loadedDisplay();\r\n                                });\r\n                            }\r\n                            else if (settings.flowChart && !settings.sequenceDiagram) \r\n                            {      \r\n                                editormd.loadScript(loadPath + \"flowchart.min\", function() {  \r\n                                    editormd.loadScript(loadPath + \"jquery.flowchart.min\", function() {\r\n                                        _this.loadedDisplay();\r\n                                    });\r\n                                });\r\n                            }\r\n                            else if (settings.flowChart && settings.sequenceDiagram) \r\n                            {  \r\n                                editormd.loadScript(loadPath + \"flowchart.min\", function() {  \r\n                                    editormd.loadScript(loadPath + \"jquery.flowchart.min\", function() {\r\n                                        editormd.loadScript(loadPath + \"sequence-diagram.min\", function() {\r\n                                            _this.loadedDisplay();\r\n                                        });\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                    });\r\n                } \r\n                else\r\n                {\r\n                    _this.loadedDisplay();\r\n                }\r\n            }; \r\n\r\n            editormd.loadCSS(loadPath + \"codemirror/codemirror.min\");\r\n            \r\n            if (settings.searchReplace && !settings.readOnly)\r\n            {\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/dialog/dialog\");\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/search/matchesonscrollbar\");\r\n            }\r\n            \r\n            if (settings.codeFold)\r\n            {\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/fold/foldgutter\");            \r\n            }\r\n            \r\n            editormd.loadScript(loadPath + \"codemirror/codemirror.min\", function() {\r\n                editormd.$CodeMirror = CodeMirror;\r\n                \r\n                editormd.loadScript(loadPath + \"codemirror/modes.min\", function() {\r\n                    \r\n                    editormd.loadScript(loadPath + \"codemirror/addons.min\", function() {\r\n                        \r\n                        _this.setCodeMirror();\r\n                        \r\n                        if (settings.mode !== \"gfm\" && settings.mode !== \"markdown\") \r\n                        {\r\n                            _this.loadedDisplay();\r\n                            \r\n                            return false;\r\n                        }\r\n                        \r\n                        _this.setToolbar();\r\n\r\n                        editormd.loadScript(loadPath + \"marked.min\", function() {\r\n\r\n                            editormd.$marked = marked;\r\n                                \r\n                            if (settings.previewCodeHighlight) \r\n                            {\r\n                                editormd.loadScript(loadPath + \"prettify.min\", function() {\r\n                                    loadFlowChartOrSequenceDiagram();\r\n                                });\r\n                            } \r\n                            else\r\n                            {                  \r\n                                loadFlowChartOrSequenceDiagram();\r\n                            }\r\n                        });\r\n                        \r\n                    });\r\n                    \r\n                });\r\n                \r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置 Editor.md 的整体主题，主要是工具栏\r\n         * Setting Editor.md theme\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setTheme : function(theme) {\r\n            var editor      = this.editor;\r\n            var oldTheme    = this.settings.theme;\r\n            var themePrefix = this.classPrefix + \"theme-\";\r\n            \r\n            editor.removeClass(themePrefix + oldTheme).addClass(themePrefix + theme);\r\n            \r\n            this.settings.theme = theme;\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置 CodeMirror（编辑区）的主题\r\n         * Setting CodeMirror (Editor area) theme\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setEditorTheme : function(theme) {  \r\n            var settings   = this.settings;  \r\n            settings.editorTheme = theme;  \r\n            \r\n            if (theme !== \"default\")\r\n            {\r\n                editormd.loadCSS(settings.path + \"codemirror/theme/\" + settings.editorTheme);\r\n            }\r\n            \r\n            this.cm.setOption(\"theme\", theme);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * setEditorTheme() 的别名\r\n         * setEditorTheme() alias\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setCodeMirrorTheme : function (theme) {            \r\n            this.setEditorTheme(theme);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置 Editor.md 的主题\r\n         * Setting Editor.md theme\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setPreviewTheme : function(theme) {  \r\n            var preview     = this.preview;\r\n            var oldTheme    = this.settings.previewTheme;\r\n            var themePrefix = this.classPrefix + \"preview-theme-\";\r\n            \r\n            preview.removeClass(themePrefix + oldTheme).addClass(themePrefix + theme);\r\n            \r\n            this.settings.previewTheme = theme;\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 配置和初始化CodeMirror组件\r\n         * CodeMirror initialization\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setCodeMirror : function() { \r\n            var settings         = this.settings;\r\n            var editor           = this.editor;\r\n            \r\n            if (settings.editorTheme !== \"default\")\r\n            {\r\n                editormd.loadCSS(settings.path + \"codemirror/theme/\" + settings.editorTheme);\r\n            }\r\n            \r\n            var codeMirrorConfig = {\r\n                mode                      : settings.mode,\r\n                theme                     : settings.editorTheme,\r\n                tabSize                   : settings.tabSize,\r\n                dragDrop                  : false,\r\n                autofocus                 : settings.autoFocus,\r\n                autoCloseTags             : settings.autoCloseTags,\r\n                readOnly                  : (settings.readOnly) ? \"nocursor\" : false,\r\n                indentUnit                : settings.indentUnit,\r\n                lineNumbers               : settings.lineNumbers,\r\n                lineWrapping              : settings.lineWrapping,\r\n                extraKeys                 : {\r\n                                                \"Ctrl-Q\": function(cm) { \r\n                                                    cm.foldCode(cm.getCursor()); \r\n                                                }\r\n                                            },\r\n                foldGutter                : settings.codeFold,\r\n                gutters                   : [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\r\n                matchBrackets             : settings.matchBrackets,\r\n                indentWithTabs            : settings.indentWithTabs,\r\n                styleActiveLine           : settings.styleActiveLine,\r\n                styleSelectedText         : settings.styleSelectedText,\r\n                autoCloseBrackets         : settings.autoCloseBrackets,\r\n                showTrailingSpace         : settings.showTrailingSpace,\r\n                highlightSelectionMatches : ( (!settings.matchWordHighlight) ? false : { showToken: (settings.matchWordHighlight === \"onselected\") ? false : /\\w/ } )\r\n            };\r\n            \r\n            this.codeEditor = this.cm        = editormd.$CodeMirror.fromTextArea(this.markdownTextarea[0], codeMirrorConfig);\r\n            this.codeMirror = this.cmElement = editor.children(\".CodeMirror\");\r\n            \r\n            if (settings.value !== \"\")\r\n            {\r\n                this.cm.setValue(settings.value);\r\n            }\r\n\r\n            this.codeMirror.css({\r\n                fontSize : settings.fontSize,\r\n                width    : (!settings.watch) ? \"100%\" : \"50%\"\r\n            });\r\n            \r\n            if (settings.autoHeight)\r\n            {\r\n                this.codeMirror.css(\"height\", \"auto\");\r\n                this.cm.setOption(\"viewportMargin\", Infinity);\r\n            }\r\n            \r\n            if (!settings.lineNumbers)\r\n            {\r\n                this.codeMirror.find(\".CodeMirror-gutters\").css(\"border-right\", \"none\");\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取CodeMirror的配置选项\r\n         * Get CodeMirror setting options\r\n         * \r\n         * @returns {Mixed}                  return CodeMirror setting option value\r\n         */\r\n        \r\n        getCodeMirrorOption : function(key) {            \r\n            return this.cm.getOption(key);\r\n        },\r\n        \r\n        /**\r\n         * 配置和重配置CodeMirror的选项\r\n         * CodeMirror setting options / resettings\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setCodeMirrorOption : function(key, value) {\r\n            \r\n            this.cm.setOption(key, value);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 添加 CodeMirror 键盘快捷键\r\n         * Add CodeMirror keyboard shortcuts key map\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        addKeyMap : function(map, bottom) {\r\n            this.cm.addKeyMap(map, bottom);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 移除 CodeMirror 键盘快捷键\r\n         * Remove CodeMirror keyboard shortcuts key map\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        removeKeyMap : function(map) {\r\n            this.cm.removeKeyMap(map);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 跳转到指定的行\r\n         * Goto CodeMirror line\r\n         * \r\n         * @param   {String|Intiger}   line      line number or \"first\"|\"last\"\r\n         * @returns {editormd}                   返回editormd的实例对象\r\n         */\r\n        \r\n        gotoLine : function (line) {\r\n            \r\n            var settings = this.settings;\r\n            \r\n            if (!settings.gotoLine)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            var cm       = this.cm;\r\n            var editor   = this.editor;\r\n            var count    = cm.lineCount();\r\n            var preview  = this.preview;\r\n            \r\n            if (typeof line === \"string\")\r\n            {\r\n                if(line === \"last\")\r\n                {\r\n                    line = count;\r\n                }\r\n            \r\n                if (line === \"first\")\r\n                {\r\n                    line = 1;\r\n                }\r\n            }\r\n            \r\n            if (typeof line !== \"number\") \r\n            {  \r\n                alert(\"Error: The line number must be an integer.\");\r\n                return this;\r\n            }\r\n            \r\n            line  = parseInt(line) - 1;\r\n            \r\n            if (line > count)\r\n            {\r\n                alert(\"Error: The line number range 1-\" + count);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            cm.setCursor( {line : line, ch : 0} );\r\n            \r\n            var scrollInfo   = cm.getScrollInfo();\r\n            var clientHeight = scrollInfo.clientHeight; \r\n            var coords       = cm.charCoords({line : line, ch : 0}, \"local\");\r\n            \r\n            cm.scrollTo(null, (coords.top + coords.bottom - clientHeight) / 2);\r\n            \r\n            if (settings.watch)\r\n            {            \r\n                var cmScroll  = this.codeMirror.find(\".CodeMirror-scroll\")[0];\r\n                var height    = $(cmScroll).height(); \r\n                var scrollTop = cmScroll.scrollTop;         \r\n                var percent   = (scrollTop / cmScroll.scrollHeight);\r\n\r\n                if (scrollTop === 0)\r\n                {\r\n                    preview.scrollTop(0);\r\n                } \r\n                else if (scrollTop + height >= cmScroll.scrollHeight - 16)\r\n                { \r\n                    preview.scrollTop(preview[0].scrollHeight);                    \r\n                } \r\n                else\r\n                {                    \r\n                    preview.scrollTop(preview[0].scrollHeight * percent);\r\n                }\r\n            }\r\n\r\n            cm.focus();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 扩展当前实例对象，可同时设置多个或者只设置一个\r\n         * Extend editormd instance object, can mutil setting.\r\n         * \r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        extend : function() {\r\n            if (typeof arguments[1] !== \"undefined\")\r\n            {\r\n                if (typeof arguments[1] === \"function\")\r\n                {\r\n                    arguments[1] = $.proxy(arguments[1], this);\r\n                }\r\n\r\n                this[arguments[0]] = arguments[1];\r\n            }\r\n            \r\n            if (typeof arguments[0] === \"object\" && typeof arguments[0].length === \"undefined\")\r\n            {\r\n                $.extend(true, this, arguments[0]);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置或扩展当前实例对象，单个设置\r\n         * Extend editormd instance object, one by one\r\n         * \r\n         * @param   {String|Object}   key       option key\r\n         * @param   {String|Object}   value     option value\r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        set : function (key, value) {\r\n            \r\n            if (typeof value !== \"undefined\" && typeof value === \"function\")\r\n            {\r\n                value = $.proxy(value, this);\r\n            }\r\n            \r\n            this[key] = value;\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 重新配置\r\n         * Resetting editor options\r\n         * \r\n         * @param   {String|Object}   key       option key\r\n         * @param   {String|Object}   value     option value\r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        config : function(key, value) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof key === \"object\")\r\n            {\r\n                settings = $.extend(true, settings, key);\r\n            }\r\n            \r\n            if (typeof key === \"string\")\r\n            {\r\n                settings[key] = value;\r\n            }\r\n            \r\n            this.settings = settings;\r\n            this.recreate();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 注册事件处理方法\r\n         * Bind editor event handle\r\n         * \r\n         * @param   {String}     eventType      event type\r\n         * @param   {Function}   callback       回调函数\r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        on : function(eventType, callback) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof settings[\"on\" + eventType] !== \"undefined\") \r\n            {                \r\n                settings[\"on\" + eventType] = $.proxy(callback, this);      \r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 解除事件处理方法\r\n         * Unbind editor event handle\r\n         * \r\n         * @param   {String}   eventType          event type\r\n         * @returns {editormd}                    this(editormd instance object.)\r\n         */\r\n        \r\n        off : function(eventType) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof settings[\"on\" + eventType] !== \"undefined\") \r\n            {\r\n                settings[\"on\" + eventType] = function(){};\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 显示工具栏\r\n         * Display toolbar\r\n         * \r\n         * @param   {Function} [callback=function(){}] 回调函数\r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        showToolbar : function(callback) {\r\n            var settings = this.settings;\r\n            \r\n            if(settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            if (settings.toolbar && (this.toolbar.length < 1 || this.toolbar.find(\".\" + this.classPrefix + \"menu\").html() === \"\") )\r\n            {\r\n                this.setToolbar();\r\n            }\r\n            \r\n            settings.toolbar = true; \r\n            \r\n            this.toolbar.show();\r\n            this.resize();\r\n            \r\n            $.proxy(callback || function(){}, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 隐藏工具栏\r\n         * Hide toolbar\r\n         * \r\n         * @param   {Function} [callback=function(){}] 回调函数\r\n         * @returns {editormd}                         this(editormd instance object.)\r\n         */\r\n        \r\n        hideToolbar : function(callback) { \r\n            var settings = this.settings;\r\n            \r\n            settings.toolbar = false;  \r\n            this.toolbar.hide();\r\n            this.resize();\r\n            \r\n            $.proxy(callback || function(){}, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 页面滚动时工具栏的固定定位\r\n         * Set toolbar in window scroll auto fixed position\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setToolbarAutoFixed : function(fixed) {\r\n            \r\n            var state    = this.state;\r\n            var editor   = this.editor;\r\n            var toolbar  = this.toolbar;\r\n            var settings = this.settings;\r\n            \r\n            if (typeof fixed !== \"undefined\")\r\n            {\r\n                settings.toolbarAutoFixed = fixed;\r\n            }\r\n            \r\n            var autoFixedHandle = function(){\r\n                var $window = $(window);\r\n                var top     = $window.scrollTop();\r\n                \r\n                if (!settings.toolbarAutoFixed)\r\n                {\r\n                    return false;\r\n                }\r\n\r\n                if (top - editor.offset().top > 10 && top < editor.height())\r\n                {\r\n                    toolbar.css({\r\n                        position : \"fixed\",\r\n                        width    : editor.width() + \"px\",\r\n                        left     : ($window.width() - editor.width()) / 2 + \"px\"\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    toolbar.css({\r\n                        position : \"absolute\",\r\n                        width    : \"100%\",\r\n                        left     : 0\r\n                    });\r\n                }\r\n            };\r\n            \r\n            if (!state.fullscreen && !state.preview && settings.toolbar && settings.toolbarAutoFixed)\r\n            {\r\n                $(window).bind(\"scroll\", autoFixedHandle);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 配置和初始化工具栏\r\n         * Set toolbar and Initialization\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setToolbar : function() {\r\n            var settings    = this.settings;  \r\n            \r\n            if(settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            var editor      = this.editor;\r\n            var preview     = this.preview;\r\n            var classPrefix = this.classPrefix;\r\n            \r\n            var toolbar     = this.toolbar = editor.children(\".\" + classPrefix + \"toolbar\");\r\n            \r\n            if (settings.toolbar && toolbar.length < 1)\r\n            {            \r\n                var toolbarHTML = \"<div class=\\\"\" + classPrefix + \"toolbar\\\"><div class=\\\"\" + classPrefix + \"toolbar-container\\\"><ul class=\\\"\" + classPrefix + \"menu\\\"></ul></div></div>\";\r\n                \r\n                editor.append(toolbarHTML);\r\n                toolbar = this.toolbar = editor.children(\".\" + classPrefix + \"toolbar\");\r\n            }\r\n            \r\n            if (!settings.toolbar) \r\n            {\r\n                toolbar.hide();\r\n                \r\n                return this;\r\n            }\r\n            \r\n            toolbar.show();\r\n            \r\n            var icons       = (typeof settings.toolbarIcons === \"function\") ? settings.toolbarIcons() \r\n                            : ((typeof settings.toolbarIcons === \"string\")  ? editormd.toolbarModes[settings.toolbarIcons] : settings.toolbarIcons);\r\n            \r\n            var toolbarMenu = toolbar.find(\".\" + this.classPrefix + \"menu\"), menu = \"\";\r\n            var pullRight   = false;\r\n            \r\n            for (var i = 0, len = icons.length; i < len; i++)\r\n            {\r\n                var name = icons[i];\r\n\r\n                if (name === \"||\") \r\n                { \r\n                    pullRight = true;\r\n                } \r\n                else if (name === \"|\")\r\n                {\r\n                    menu += \"<li class=\\\"divider\\\" unselectable=\\\"on\\\">|</li>\";\r\n                }\r\n                else\r\n                {\r\n                    var isHeader = (/h(\\d)/.test(name));\r\n                    var index    = name;\r\n                    \r\n                    if (name === \"watch\" && !settings.watch) {\r\n                        index = \"unwatch\";\r\n                    }\r\n                    \r\n                    var title     = settings.lang.toolbar[index];\r\n                    var iconTexts = settings.toolbarIconTexts[index];\r\n                    var iconClass = settings.toolbarIconsClass[index];\r\n                    \r\n                    title     = (typeof title     === \"undefined\") ? \"\" : title;\r\n                    iconTexts = (typeof iconTexts === \"undefined\") ? \"\" : iconTexts;\r\n                    iconClass = (typeof iconClass === \"undefined\") ? \"\" : iconClass;\r\n\r\n                    var menuItem = pullRight ? \"<li class=\\\"pull-right\\\">\" : \"<li>\";\r\n                    \r\n                    if (typeof settings.toolbarCustomIcons[name] !== \"undefined\" && typeof settings.toolbarCustomIcons[name] !== \"function\")\r\n                    {\r\n                        menuItem += settings.toolbarCustomIcons[name];\r\n                    }\r\n                    else \r\n                    {\r\n                        menuItem += \"<a href=\\\"javascript:;\\\" title=\\\"\" + title + \"\\\" unselectable=\\\"on\\\">\";\r\n                        menuItem += \"<i class=\\\"fa \" + iconClass + \"\\\" name=\\\"\"+name+\"\\\" unselectable=\\\"on\\\">\"+((isHeader) ? name.toUpperCase() : ( (iconClass === \"\") ? iconTexts : \"\") ) + \"</i>\";\r\n                        menuItem += \"</a>\";\r\n                    }\r\n\r\n                    menuItem += \"</li>\";\r\n\r\n                    menu = pullRight ? menuItem + menu : menu + menuItem;\r\n                }\r\n            }\r\n\r\n            toolbarMenu.html(menu);\r\n            \r\n            toolbarMenu.find(\"[title=\\\"Lowercase\\\"]\").attr(\"title\", settings.lang.toolbar.lowercase);\r\n            toolbarMenu.find(\"[title=\\\"ucwords\\\"]\").attr(\"title\", settings.lang.toolbar.ucwords);\r\n            \r\n            this.setToolbarHandler();\r\n            this.setToolbarAutoFixed();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 工具栏图标事件处理对象序列\r\n         * Get toolbar icons event handlers\r\n         * \r\n         * @param   {Object}   cm    CodeMirror的实例对象\r\n         * @param   {String}   name  要获取的事件处理器名称\r\n         * @returns {Object}         返回处理对象序列\r\n         */\r\n            \r\n        dialogLockScreen : function() {\r\n            $.proxy(editormd.dialogLockScreen, this)();\r\n            \r\n            return this;\r\n        },\r\n\r\n        dialogShowMask : function(dialog) {\r\n            $.proxy(editormd.dialogShowMask, this)(dialog);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        getToolbarHandles : function(name) {  \r\n            var toolbarHandlers = this.toolbarHandlers = editormd.toolbarHandlers;\r\n            \r\n            return (name && typeof toolbarIconHandlers[name] !== \"undefined\") ? toolbarHandlers[name] : toolbarHandlers;\r\n        },\r\n        \r\n        /**\r\n         * 工具栏图标事件处理器\r\n         * Bind toolbar icons event handle\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setToolbarHandler : function() {\r\n            var _this               = this;\r\n            var settings            = this.settings;\r\n            \r\n            if (!settings.toolbar || settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            var toolbar             = this.toolbar;\r\n            var cm                  = this.cm;\r\n            var classPrefix         = this.classPrefix;           \r\n            var toolbarIcons        = this.toolbarIcons = toolbar.find(\".\" + classPrefix + \"menu > li > a\");  \r\n            var toolbarIconHandlers = this.getToolbarHandles();  \r\n                \r\n            toolbarIcons.bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function(event) {\r\n\r\n                var icon                = $(this).children(\".fa\");\r\n                var name                = icon.attr(\"name\");\r\n                var cursor              = cm.getCursor();\r\n                var selection           = cm.getSelection();\r\n\r\n                if (name === \"\") {\r\n                    return ;\r\n                }\r\n                \r\n                _this.activeIcon = icon;\r\n\r\n                if (typeof toolbarIconHandlers[name] !== \"undefined\") \r\n                {\r\n                    $.proxy(toolbarIconHandlers[name], _this)(cm);\r\n                }\r\n                else \r\n                {\r\n                    if (typeof settings.toolbarHandlers[name] !== \"undefined\") \r\n                    {\r\n                        $.proxy(settings.toolbarHandlers[name], _this)(cm, icon, cursor, selection);\r\n                    }\r\n                }\r\n                \r\n                if (name !== \"link\" && name !== \"reference-link\" && name !== \"image\" && name !== \"code-block\" && \r\n                    name !== \"preformatted-text\" && name !== \"watch\" && name !== \"preview\" && name !== \"search\" && name !== \"fullscreen\" && name !== \"info\") \r\n                {\r\n                    cm.focus();\r\n                }\r\n\r\n                return false;\r\n\r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 动态创建对话框\r\n         * Creating custom dialogs\r\n         * \r\n         * @param   {Object} options  配置项键值对 Key/Value\r\n         * @returns {dialog}          返回创建的dialog的jQuery实例对象\r\n         */\r\n        \r\n        createDialog : function(options) {            \r\n            return $.proxy(editormd.createDialog, this)(options);\r\n        },\r\n        \r\n        /**\r\n         * 创建关于Editor.md的对话框\r\n         * Create about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        createInfoDialog : function() {\r\n            var _this        = this;\r\n\t\t\tvar editor       = this.editor;\r\n            var classPrefix  = this.classPrefix;  \r\n            \r\n            var infoDialogHTML = [\r\n                \"<div class=\\\"\" + classPrefix + \"dialog \" + classPrefix + \"dialog-info\\\" style=\\\"\\\">\",\r\n                \"<div class=\\\"\" + classPrefix + \"dialog-container\\\">\",\r\n                \"<h1><i class=\\\"editormd-logo editormd-logo-lg editormd-logo-color\\\"></i> \" + editormd.title + \"<small>v\" + editormd.version + \"</small></h1>\",\r\n                \"<p>\" + this.lang.description + \"</p>\",\r\n                \"<p style=\\\"margin: 10px 0 20px 0;\\\"><a href=\\\"\" + editormd.homePage + \"\\\" target=\\\"_blank\\\">\" + editormd.homePage + \" <i class=\\\"fa fa-external-link\\\"></i></a></p>\",\r\n                \"<p style=\\\"font-size: 0.85em;\\\">Copyright &copy; 2015 <a href=\\\"https://github.com/pandao\\\" target=\\\"_blank\\\" class=\\\"hover-link\\\">Pandao</a>, The <a href=\\\"https://github.com/pandao/editor.md/blob/master/LICENSE\\\" target=\\\"_blank\\\" class=\\\"hover-link\\\">MIT</a> License.</p>\",\r\n                \"</div>\",\r\n                \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"dialog-close\\\"></a>\",\r\n                \"</div>\"\r\n            ].join(\"\\n\");\r\n\r\n            editor.append(infoDialogHTML);\r\n            \r\n            var infoDialog  = this.infoDialog = editor.children(\".\" + classPrefix + \"dialog-info\");\r\n\r\n            infoDialog.find(\".\" + classPrefix + \"dialog-close\").bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function() {\r\n                _this.hideInfoDialog();\r\n            });\r\n            \r\n            infoDialog.css(\"border\", (editormd.isIE8) ? \"1px solid #ddd\" : \"\").css(\"z-index\", editormd.dialogZindex).show();\r\n            \r\n            this.infoDialogPosition();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 关于Editor.md对话居中定位\r\n         * Editor.md dialog position handle\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        infoDialogPosition : function() {\r\n            var infoDialog = this.infoDialog;\r\n            \r\n\t\t\tvar _infoDialogPosition = function() {\r\n\t\t\t\tinfoDialog.css({\r\n\t\t\t\t\ttop  : ($(window).height() - infoDialog.height()) / 2 + \"px\",\r\n\t\t\t\t\tleft : ($(window).width()  - infoDialog.width()) / 2  + \"px\"\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t_infoDialogPosition();\r\n\r\n\t\t\t$(window).resize(_infoDialogPosition);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 显示关于Editor.md\r\n         * Display about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        showInfoDialog : function() {\r\n\r\n            $(\"html,body\").css(\"overflow-x\", \"hidden\");\r\n            \r\n            var _this       = this;\r\n\t\t\tvar editor      = this.editor;\r\n            var settings    = this.settings;         \r\n\t\t\tvar infoDialog  = this.infoDialog = editor.children(\".\" + this.classPrefix + \"dialog-info\");\r\n            \r\n            if (infoDialog.length < 1)\r\n            {\r\n                this.createInfoDialog();\r\n            }\r\n            \r\n            this.lockScreen(true);\r\n            \r\n            this.mask.css({\r\n\t\t\t\t\t\topacity         : settings.dialogMaskOpacity,\r\n\t\t\t\t\t\tbackgroundColor : settings.dialogMaskBgColor\r\n\t\t\t\t\t}).show();\r\n\r\n\t\t\tinfoDialog.css(\"z-index\", editormd.dialogZindex).show();\r\n\r\n\t\t\tthis.infoDialogPosition();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 隐藏关于Editor.md\r\n         * Hide about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        hideInfoDialog : function() {            \r\n            $(\"html,body\").css(\"overflow-x\", \"\");\r\n            this.infoDialog.hide();\r\n            this.mask.hide();\r\n            this.lockScreen(false);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 锁屏\r\n         * lock screen\r\n         * \r\n         * @param   {Boolean}    lock    Boolean 布尔值，是否锁屏\r\n         * @returns {editormd}           返回editormd的实例对象\r\n         */\r\n        \r\n        lockScreen : function(lock) {\r\n            editormd.lockScreen(lock);\r\n            this.resize();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 编辑器界面重建，用于动态语言包或模块加载等\r\n         * Recreate editor\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        recreate : function() {\r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var settings         = this.settings;\r\n            \r\n            this.codeMirror.remove();\r\n            \r\n            this.setCodeMirror();\r\n\r\n            if (!settings.readOnly) \r\n            {\r\n                if (editor.find(\".editormd-dialog\").length > 0) {\r\n                    editor.find(\".editormd-dialog\").remove();\r\n                }\r\n                \r\n                if (settings.toolbar) \r\n                {  \r\n                    this.getToolbarHandles();                  \r\n                    this.setToolbar();\r\n                }\r\n            }\r\n            \r\n            this.loadedDisplay(true);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 高亮预览HTML的pre代码部分\r\n         * highlight of preview codes\r\n         * \r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        previewCodeHighlight : function() {    \r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if (settings.previewCodeHighlight) \r\n            {\r\n                previewContainer.find(\"pre\").addClass(\"prettyprint linenums\");\r\n                \r\n                if (typeof prettyPrint !== \"undefined\")\r\n                {                    \r\n                    prettyPrint();\r\n                }\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 解析TeX(KaTeX)科学公式\r\n         * TeX(KaTeX) Renderer\r\n         * \r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        katexRender : function() {\r\n            \r\n            if (timer === null)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            this.previewContainer.find(\".\" + editormd.classNames.tex).each(function(){\r\n                var tex  = $(this);\r\n                editormd.$katex.render(tex.text(), tex[0]);\r\n                \r\n                tex.find(\".katex\").css(\"font-size\", \"1.6em\");\r\n            });   \r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 解析和渲染流程图及时序图\r\n         * FlowChart and SequenceDiagram Renderer\r\n         * \r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        flowChartAndSequenceDiagramRender : function() {\r\n            var $this            = this;\r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if (editormd.isIE8) {\r\n                return this;\r\n            }\r\n\r\n            if (settings.flowChart) {\r\n                if (flowchartTimer === null) {\r\n                    return this;\r\n                }\r\n                \r\n                previewContainer.find(\".flowchart\").flowChart(); \r\n            }\r\n\r\n            if (settings.sequenceDiagram) {\r\n                previewContainer.find(\".sequence-diagram\").sequenceDiagram({theme: \"simple\"});\r\n            }\r\n                    \r\n            var preview    = $this.preview;\r\n            var codeMirror = $this.codeMirror;\r\n            var codeView   = codeMirror.find(\".CodeMirror-scroll\");\r\n\r\n            var height    = codeView.height();\r\n            var scrollTop = codeView.scrollTop();                    \r\n            var percent   = (scrollTop / codeView[0].scrollHeight);\r\n            var tocHeight = 0;\r\n\r\n            preview.find(\".markdown-toc-list\").each(function(){\r\n                tocHeight += $(this).height();\r\n            });\r\n\r\n            var tocMenuHeight = preview.find(\".editormd-toc-menu\").height(); \r\n            tocMenuHeight = (!tocMenuHeight) ? 0 : tocMenuHeight;\r\n\r\n            if (scrollTop === 0) \r\n            {\r\n                preview.scrollTop(0);\r\n            } \r\n            else if (scrollTop + height >= codeView[0].scrollHeight - 16)\r\n            { \r\n                preview.scrollTop(preview[0].scrollHeight);                        \r\n            } \r\n            else\r\n            {                  \r\n                preview.scrollTop((preview[0].scrollHeight + tocHeight + tocMenuHeight) * percent);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 注册键盘快捷键处理\r\n         * Register CodeMirror keyMaps (keyboard shortcuts).\r\n         * \r\n         * @param   {Object}    keyMap      KeyMap key/value {\"(Ctrl/Shift/Alt)-Key\" : function(){}}\r\n         * @returns {editormd}              return this\r\n         */\r\n        \r\n        registerKeyMaps : function(keyMap) {\r\n            \r\n            var _this           = this;\r\n            var cm              = this.cm;\r\n            var settings        = this.settings;\r\n            var toolbarHandlers = editormd.toolbarHandlers;\r\n            var disabledKeyMaps = settings.disabledKeyMaps;\r\n            \r\n            keyMap              = keyMap || null;\r\n            \r\n            if (keyMap)\r\n            {\r\n                for (var i in keyMap)\r\n                {\r\n                    if ($.inArray(i, disabledKeyMaps) < 0)\r\n                    {\r\n                        var map = {};\r\n                        map[i]  = keyMap[i];\r\n\r\n                        cm.addKeyMap(keyMap);\r\n                    }\r\n                }\r\n            }\r\n            else\r\n            {\r\n                for (var k in editormd.keyMaps)\r\n                {\r\n                    var _keyMap = editormd.keyMaps[k];\r\n                    var handle = (typeof _keyMap === \"string\") ? $.proxy(toolbarHandlers[_keyMap], _this) : $.proxy(_keyMap, _this);\r\n                    \r\n                    if ($.inArray(k, [\"F9\", \"F10\", \"F11\"]) < 0 && $.inArray(k, disabledKeyMaps) < 0)\r\n                    {\r\n                        var _map = {};\r\n                        _map[k] = handle;\r\n\r\n                        cm.addKeyMap(_map);\r\n                    }\r\n                }\r\n                \r\n                $(window).keydown(function(event) {\r\n                    \r\n                    var keymaps = {\r\n                        \"120\" : \"F9\",\r\n                        \"121\" : \"F10\",\r\n                        \"122\" : \"F11\"\r\n                    };\r\n                    \r\n                    if ( $.inArray(keymaps[event.keyCode], disabledKeyMaps) < 0 )\r\n                    {\r\n                        switch (event.keyCode)\r\n                        {\r\n                            case 120:\r\n                                    $.proxy(toolbarHandlers[\"watch\"], _this)();\r\n                                    return false;\r\n                                break;\r\n                                \r\n                            case 121:\r\n                                    $.proxy(toolbarHandlers[\"preview\"], _this)();\r\n                                    return false;\r\n                                break;\r\n                                \r\n                            case 122:\r\n                                    $.proxy(toolbarHandlers[\"fullscreen\"], _this)();                        \r\n                                    return false;\r\n                                break;\r\n                                \r\n                            default:\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 绑定同步滚动\r\n         * \r\n         * @returns {editormd} return this\r\n         */\r\n        \r\n        bindScrollEvent : function() {\r\n            \r\n            var _this            = this;\r\n            var preview          = this.preview;\r\n            var settings         = this.settings;\r\n            var codeMirror       = this.codeMirror;\r\n            var mouseOrTouch     = editormd.mouseOrTouch;\r\n            \r\n            if (!settings.syncScrolling) {\r\n                return this;\r\n            }\r\n                \r\n            var cmBindScroll = function() {    \r\n                codeMirror.find(\".CodeMirror-scroll\").bind(mouseOrTouch(\"scroll\", \"touchmove\"), function(event) {\r\n                    var height    = $(this).height();\r\n                    var scrollTop = $(this).scrollTop();                    \r\n                    var percent   = (scrollTop / $(this)[0].scrollHeight);\r\n                    \r\n                    var tocHeight = 0;\r\n                    \r\n                    preview.find(\".markdown-toc-list\").each(function(){\r\n                        tocHeight += $(this).height();\r\n                    });\r\n                    \r\n                    var tocMenuHeight = preview.find(\".editormd-toc-menu\").height();\r\n                    tocMenuHeight = (!tocMenuHeight) ? 0 : tocMenuHeight;\r\n\r\n                    if (scrollTop === 0) \r\n                    {\r\n                        preview.scrollTop(0);\r\n                    } \r\n                    else if (scrollTop + height >= $(this)[0].scrollHeight - 16)\r\n                    { \r\n                        preview.scrollTop(preview[0].scrollHeight);                        \r\n                    } \r\n                    else\r\n                    {\r\n                        preview.scrollTop((preview[0].scrollHeight  + tocHeight + tocMenuHeight) * percent);\r\n                    }\r\n                    \r\n                    $.proxy(settings.onscroll, _this)(event);\r\n                });\r\n            };\r\n\r\n            var cmUnbindScroll = function() {\r\n                codeMirror.find(\".CodeMirror-scroll\").unbind(mouseOrTouch(\"scroll\", \"touchmove\"));\r\n            };\r\n\r\n            var previewBindScroll = function() {\r\n                \r\n                preview.bind(mouseOrTouch(\"scroll\", \"touchmove\"), function(event) {\r\n                    var height    = $(this).height();\r\n                    var scrollTop = $(this).scrollTop();         \r\n                    var percent   = (scrollTop / $(this)[0].scrollHeight);\r\n                    var codeView  = codeMirror.find(\".CodeMirror-scroll\");\r\n\r\n                    if(scrollTop === 0) \r\n                    {\r\n                        codeView.scrollTop(0);\r\n                    }\r\n                    else if (scrollTop + height >= $(this)[0].scrollHeight)\r\n                    {\r\n                        codeView.scrollTop(codeView[0].scrollHeight);                        \r\n                    }\r\n                    else \r\n                    {\r\n                        codeView.scrollTop(codeView[0].scrollHeight * percent);\r\n                    }\r\n                    \r\n                    $.proxy(settings.onpreviewscroll, _this)(event);\r\n                });\r\n\r\n            };\r\n\r\n            var previewUnbindScroll = function() {\r\n                preview.unbind(mouseOrTouch(\"scroll\", \"touchmove\"));\r\n            }; \r\n\r\n\t\t\tcodeMirror.bind({\r\n\t\t\t\tmouseover  : cmBindScroll,\r\n\t\t\t\tmouseout   : cmUnbindScroll,\r\n\t\t\t\ttouchstart : cmBindScroll,\r\n\t\t\t\ttouchend   : cmUnbindScroll\r\n\t\t\t});\r\n            \r\n            if (settings.syncScrolling === \"single\") {\r\n                return this;\r\n            }\r\n            \r\n\t\t\tpreview.bind({\r\n\t\t\t\tmouseover  : previewBindScroll,\r\n\t\t\t\tmouseout   : previewUnbindScroll,\r\n\t\t\t\ttouchstart : previewBindScroll,\r\n\t\t\t\ttouchend   : previewUnbindScroll\r\n\t\t\t});\r\n\r\n            return this;\r\n        },\r\n        \r\n        bindChangeEvent : function() {\r\n            \r\n            var _this            = this;\r\n            var cm               = this.cm;\r\n            var settings         = this.settings;\r\n            \r\n            if (!settings.syncScrolling) {\r\n                return this;\r\n            }\r\n            \r\n            cm.on(\"change\", function(_cm, changeObj) {\r\n                \r\n                if (settings.watch)\r\n                {\r\n                    _this.previewContainer.css(\"padding\", settings.autoHeight ? \"20px 20px 50px 40px\" : \"20px\");\r\n                }\r\n                \r\n                timer = setTimeout(function() {\r\n                    clearTimeout(timer);\r\n                    _this.save();\r\n                    timer = null;\r\n                }, settings.delay);\r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 加载队列完成之后的显示处理\r\n         * Display handle of the module queues loaded after.\r\n         * \r\n         * @param   {Boolean}   recreate   是否为重建编辑器\r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        loadedDisplay : function(recreate) {\r\n            \r\n            recreate             = recreate || false;\r\n            \r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var settings         = this.settings;\r\n            \r\n            this.containerMask.hide();\r\n            \r\n            this.save();\r\n            \r\n            if (settings.watch) {\r\n                preview.show();\r\n            }\r\n            \r\n            editor.data(\"oldWidth\", editor.width()).data(\"oldHeight\", editor.height()); // 为了兼容Zepto\r\n            \r\n            this.resize();\r\n            this.registerKeyMaps();\r\n            \r\n            $(window).resize(function(){\r\n                _this.resize();\r\n            });\r\n            \r\n            this.bindScrollEvent().bindChangeEvent();\r\n            \r\n            if (!recreate)\r\n            {\r\n                $.proxy(settings.onload, this)();\r\n            }\r\n            \r\n            this.state.loaded = true;\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置编辑器的宽度\r\n         * Set editor width\r\n         * \r\n         * @param   {Number|String} width  编辑器宽度值\r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        width : function(width) {\r\n                \r\n            this.editor.css(\"width\", (typeof width === \"number\") ? width  + \"px\" : width);            \r\n            this.resize();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置编辑器的高度\r\n         * Set editor height\r\n         * \r\n         * @param   {Number|String} height  编辑器高度值\r\n         * @returns {editormd}              返回editormd的实例对象\r\n         */\r\n        \r\n        height : function(height) {\r\n                \r\n            this.editor.css(\"height\", (typeof height === \"number\")  ? height  + \"px\" : height);            \r\n            this.resize();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 调整编辑器的尺寸和布局\r\n         * Resize editor layout\r\n         * \r\n         * @param   {Number|String} [width=null]  编辑器宽度值\r\n         * @param   {Number|String} [height=null] 编辑器高度值\r\n         * @returns {editormd}                    返回editormd的实例对象\r\n         */\r\n        \r\n        resize : function(width, height) {\r\n            \r\n            width  = width  || null;\r\n            height = height || null;\r\n            \r\n            var state      = this.state;\r\n            var editor     = this.editor;\r\n            var preview    = this.preview;\r\n            var toolbar    = this.toolbar;\r\n            var settings   = this.settings;\r\n            var codeMirror = this.codeMirror;\r\n            \r\n            if (width)\r\n            {\r\n                editor.css(\"width\", (typeof width  === \"number\") ? width  + \"px\" : width);\r\n            }\r\n            \r\n            if (settings.autoHeight && !state.fullscreen && !state.preview)\r\n            {\r\n                editor.css(\"height\", \"auto\");\r\n                codeMirror.css(\"height\", \"auto\");\r\n            } \r\n            else \r\n            {\r\n                if (height) \r\n                {\r\n                    editor.css(\"height\", (typeof height === \"number\") ? height + \"px\" : height);\r\n                }\r\n                \r\n                if (state.fullscreen)\r\n                {\r\n                    editor.height($(window).height());\r\n                }\r\n\r\n                if (settings.toolbar && !settings.readOnly) \r\n                {\r\n                    codeMirror.css(\"margin-top\", toolbar.height() + 1).height(editor.height() - toolbar.height());\r\n                } \r\n                else\r\n                {\r\n                    codeMirror.css(\"margin-top\", 0).height(editor.height());\r\n                }\r\n            }\r\n            \r\n            if(settings.watch) \r\n            {\r\n                codeMirror.width(editor.width() / 2);\r\n                preview.width((!state.preview) ? editor.width() / 2 : editor.width());\r\n                \r\n                this.previewContainer.css(\"padding\", settings.autoHeight ? \"20px 20px 50px 40px\" : \"20px\");\r\n                \r\n                if (settings.toolbar && !settings.readOnly) \r\n                {\r\n                    preview.css(\"top\", toolbar.height() + 1);\r\n                } \r\n                else \r\n                {\r\n                    preview.css(\"top\", 0);\r\n                }\r\n                \r\n                if (settings.autoHeight && !state.fullscreen && !state.preview)\r\n                {\r\n                    preview.height(\"\");\r\n                }\r\n                else\r\n                {                \r\n                    var previewHeight = (settings.toolbar && !settings.readOnly) ? editor.height() - toolbar.height() : editor.height();\r\n                    \r\n                    preview.height(previewHeight);\r\n                }\r\n            } \r\n            else \r\n            {\r\n                codeMirror.width(editor.width());\r\n                preview.hide();\r\n            }\r\n            \r\n            if (state.loaded) \r\n            {\r\n                $.proxy(settings.onresize, this)();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 解析和保存Markdown代码\r\n         * Parse & Saving Markdown source code\r\n         * \r\n         * @returns {editormd}     返回editormd的实例对象\r\n         */\r\n        \r\n        save : function() {\r\n            \r\n            if (timer === null)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            var _this            = this;\r\n            var state            = this.state;\r\n            var settings         = this.settings;\r\n            var cm               = this.cm;            \r\n            var cmValue          = cm.getValue();\r\n            var previewContainer = this.previewContainer;\r\n\r\n            if (settings.mode !== \"gfm\" && settings.mode !== \"markdown\") \r\n            {\r\n                this.markdownTextarea.val(cmValue);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            var marked          = editormd.$marked;\r\n            var markdownToC     = this.markdownToC = [];            \r\n            var rendererOptions = this.markedRendererOptions = {  \r\n                toc                  : settings.toc,\r\n                tocm                 : settings.tocm,\r\n                tocStartLevel        : settings.tocStartLevel,\r\n                pageBreak            : settings.pageBreak,\r\n                taskList             : settings.taskList,\r\n                emoji                : settings.emoji,\r\n                tex                  : settings.tex,\r\n                atLink               : settings.atLink,           // for @link\r\n                emailLink            : settings.emailLink,        // for mail address auto link\r\n                flowChart            : settings.flowChart,\r\n                sequenceDiagram      : settings.sequenceDiagram,\r\n                previewCodeHighlight : settings.previewCodeHighlight,\r\n            };\r\n            \r\n            var markedOptions = this.markedOptions = {\r\n                renderer    : editormd.markedRenderer(markdownToC, rendererOptions),\r\n                gfm         : true,\r\n                tables      : true,\r\n                breaks      : true,\r\n                pedantic    : false,\r\n                sanitize    : (settings.htmlDecode) ? false : true,  // 关闭忽略HTML标签，即开启识别HTML标签，默认为false\r\n                smartLists  : true,\r\n                smartypants : true\r\n            };\r\n            \r\n            marked.setOptions(markedOptions);\r\n                    \r\n            var newMarkdownDoc = editormd.$marked(cmValue, markedOptions);\r\n            \r\n            //console.info(\"cmValue\", cmValue, newMarkdownDoc);\r\n            \r\n            newMarkdownDoc = editormd.filterHTMLTags(newMarkdownDoc, settings.htmlDecode);\r\n            \r\n            //console.error(\"cmValue\", cmValue, newMarkdownDoc);\r\n            \r\n            this.markdownTextarea.text(cmValue);\r\n            \r\n            cm.save();\r\n            \r\n            if (settings.saveHTMLToTextarea) \r\n            {\r\n                this.htmlTextarea.text(newMarkdownDoc);\r\n            }\r\n            \r\n            if(settings.watch || (!settings.watch && state.preview))\r\n            {\r\n                previewContainer.html(newMarkdownDoc);\r\n\r\n                this.previewCodeHighlight();\r\n                \r\n                if (settings.toc) \r\n                {\r\n                    var tocContainer = (settings.tocContainer === \"\") ? previewContainer : $(settings.tocContainer);\r\n                    var tocMenu      = tocContainer.find(\".\" + this.classPrefix + \"toc-menu\");\r\n                    \r\n                    tocContainer.attr(\"previewContainer\", (settings.tocContainer === \"\") ? \"true\" : \"false\");\r\n                    \r\n                    if (settings.tocContainer !== \"\" && tocMenu.length > 0)\r\n                    {\r\n                        tocMenu.remove();\r\n                    }\r\n                    \r\n                    editormd.markdownToCRenderer(markdownToC, tocContainer, settings.tocDropdown, settings.tocStartLevel);\r\n            \r\n                    if (settings.tocDropdown || tocContainer.find(\".\" + this.classPrefix + \"toc-menu\").length > 0)\r\n                    {\r\n                        editormd.tocDropdownMenu(tocContainer, (settings.tocTitle !== \"\") ? settings.tocTitle : this.lang.tocTitle);\r\n                    }\r\n            \r\n                    if (settings.tocContainer !== \"\")\r\n                    {\r\n                        previewContainer.find(\".markdown-toc\").css(\"border\", \"none\");\r\n                    }\r\n                }\r\n                \r\n                if (settings.tex)\r\n                {\r\n                    if (!editormd.kaTeXLoaded && settings.autoLoadModules) \r\n                    {\r\n                        editormd.loadKaTeX(function() {\r\n                            editormd.$katex = katex;\r\n                            editormd.kaTeXLoaded = true;\r\n                            _this.katexRender();\r\n                        });\r\n                    } \r\n                    else \r\n                    {\r\n                        editormd.$katex = katex;\r\n                        this.katexRender();\r\n                    }\r\n                }                \r\n                \r\n                if (settings.flowChart || settings.sequenceDiagram)\r\n                {\r\n                    flowchartTimer = setTimeout(function(){\r\n                        clearTimeout(flowchartTimer);\r\n                        _this.flowChartAndSequenceDiagramRender();\r\n                        flowchartTimer = null;\r\n                    }, 10);\r\n                }\r\n\r\n                if (state.loaded) \r\n                {\r\n                    $.proxy(settings.onchange, this)();\r\n                }\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 聚焦光标位置\r\n         * Focusing the cursor position\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        focus : function() {\r\n            this.cm.focus();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置光标的位置\r\n         * Set cursor position\r\n         * \r\n         * @param   {Object}    cursor 要设置的光标位置键值对象，例：{line:1, ch:0}\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        setCursor : function(cursor) {\r\n            this.cm.setCursor(cursor);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取当前光标的位置\r\n         * Get the current position of the cursor\r\n         * \r\n         * @returns {Cursor}         返回一个光标Cursor对象\r\n         */\r\n        \r\n        getCursor : function() {\r\n            return this.cm.getCursor();\r\n        },\r\n        \r\n        /**\r\n         * 设置光标选中的范围\r\n         * Set cursor selected ranges\r\n         * \r\n         * @param   {Object}    from   开始位置的光标键值对象，例：{line:1, ch:0}\r\n         * @param   {Object}    to     结束位置的光标键值对象，例：{line:1, ch:0}\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        setSelection : function(from, to) {\r\n        \r\n            this.cm.setSelection(from, to);\r\n        \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取光标选中的文本\r\n         * Get the texts from cursor selected\r\n         * \r\n         * @returns {String}         返回选中文本的字符串形式\r\n         */\r\n        \r\n        getSelection : function() {\r\n            return this.cm.getSelection();\r\n        },\r\n        \r\n        /**\r\n         * 设置光标选中的文本范围\r\n         * Set the cursor selection ranges\r\n         * \r\n         * @param   {Array}    ranges  cursor selection ranges array\r\n         * @returns {Array}            return this\r\n         */\r\n        \r\n        setSelections : function(ranges) {\r\n            this.cm.setSelections(ranges);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取光标选中的文本范围\r\n         * Get the cursor selection ranges\r\n         * \r\n         * @returns {Array}         return selection ranges array\r\n         */\r\n        \r\n        getSelections : function() {\r\n            return this.cm.getSelections();\r\n        },\r\n        \r\n        /**\r\n         * 替换当前光标选中的文本或在当前光标处插入新字符\r\n         * Replace the text at the current cursor selected or insert a new character at the current cursor position\r\n         * \r\n         * @param   {String}    value  要插入的字符值\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        replaceSelection : function(value) {\r\n            this.cm.replaceSelection(value);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 在当前光标处插入新字符\r\n         * Insert a new character at the current cursor position\r\n         *\r\n         * 同replaceSelection()方法\r\n         * With the replaceSelection() method\r\n         * \r\n         * @param   {String}    value  要插入的字符值\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        insertValue : function(value) {\r\n            this.replaceSelection(value);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 追加markdown\r\n         * append Markdown to editor\r\n         * \r\n         * @param   {String}    md     要追加的markdown源文档\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        appendMarkdown : function(md) {\r\n            var settings = this.settings;\r\n            var cm       = this.cm;\r\n            \r\n            cm.setValue(cm.getValue() + md);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置和传入编辑器的markdown源文档\r\n         * Set Markdown source document\r\n         * \r\n         * @param   {String}    md     要传入的markdown源文档\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        setMarkdown : function(md) {\r\n            this.cm.setValue(md || this.settings.markdown);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取编辑器的markdown源文档\r\n         * Set Editor.md markdown/CodeMirror value\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        getMarkdown : function() {\r\n            return this.cm.getValue();\r\n        },\r\n        \r\n        /**\r\n         * 获取编辑器的源文档\r\n         * Get CodeMirror value\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        getValue : function() {\r\n            return this.cm.getValue();\r\n        },\r\n        \r\n        /**\r\n         * 设置编辑器的源文档\r\n         * Set CodeMirror value\r\n         * \r\n         * @param   {String}     value   set code/value/string/text\r\n         * @returns {editormd}           返回editormd的实例对象\r\n         */\r\n        \r\n        setValue : function(value) {\r\n            this.cm.setValue(value);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 清空编辑器\r\n         * Empty CodeMirror editor container\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        clear : function() {\r\n            this.cm.setValue(\"\");\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取解析后存放在Textarea的HTML源码\r\n         * Get parsed html code from Textarea\r\n         * \r\n         * @returns {String}               返回HTML源码\r\n         */\r\n        \r\n        getHTML : function() {\r\n            if (!this.settings.saveHTMLToTextarea)\r\n            {\r\n                alert(\"Error: settings.saveHTMLToTextarea == false\");\r\n\r\n                return false;\r\n            }\r\n            \r\n            return this.htmlTextarea.val();\r\n        },\r\n        \r\n        /**\r\n         * getHTML()的别名\r\n         * getHTML (alias)\r\n         * \r\n         * @returns {String}           Return html code 返回HTML源码\r\n         */\r\n        \r\n        getTextareaSavedHTML : function() {\r\n            return this.getHTML();\r\n        },\r\n        \r\n        /**\r\n         * 获取预览窗口的HTML源码\r\n         * Get html from preview container\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        getPreviewedHTML : function() {\r\n            if (!this.settings.watch)\r\n            {\r\n                alert(\"Error: settings.watch == false\");\r\n\r\n                return false;\r\n            }\r\n            \r\n            return this.previewContainer.html();\r\n        },\r\n        \r\n        /**\r\n         * 开启实时预览\r\n         * Enable real-time watching\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        watch : function(callback) {     \r\n            var settings        = this.settings;\r\n            \r\n            if ($.inArray(settings.mode, [\"gfm\", \"markdown\"]) < 0)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            this.state.watching = settings.watch = true;\r\n            this.preview.show();\r\n            \r\n            if (this.toolbar)\r\n            {\r\n                var watchIcon   = settings.toolbarIconsClass.watch;\r\n                var unWatchIcon = settings.toolbarIconsClass.unwatch;\r\n                \r\n                var icon        = this.toolbar.find(\".fa[name=watch]\");\r\n                icon.parent().attr(\"title\", settings.lang.toolbar.watch);\r\n                icon.removeClass(unWatchIcon).addClass(watchIcon);\r\n            }\r\n            \r\n            this.codeMirror.css(\"border-right\", \"1px solid #ddd\").width(this.editor.width() / 2); \r\n            \r\n            timer = 0;\r\n            \r\n            this.save().resize();\r\n            \r\n            if (!settings.onwatch)\r\n            {\r\n                settings.onwatch = callback || function() {};\r\n            }\r\n            \r\n            $.proxy(settings.onwatch, this)();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 关闭实时预览\r\n         * Disable real-time watching\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        unwatch : function(callback) {\r\n            var settings        = this.settings;\r\n            this.state.watching = settings.watch = false;\r\n            this.preview.hide();\r\n            \r\n            if (this.toolbar) \r\n            {\r\n                var watchIcon   = settings.toolbarIconsClass.watch;\r\n                var unWatchIcon = settings.toolbarIconsClass.unwatch;\r\n                \r\n                var icon    = this.toolbar.find(\".fa[name=watch]\");\r\n                icon.parent().attr(\"title\", settings.lang.toolbar.unwatch);\r\n                icon.removeClass(watchIcon).addClass(unWatchIcon);\r\n            }\r\n            \r\n            this.codeMirror.css(\"border-right\", \"none\").width(this.editor.width());\r\n            \r\n            this.resize();\r\n            \r\n            if (!settings.onunwatch)\r\n            {\r\n                settings.onunwatch = callback || function() {};\r\n            }\r\n            \r\n            $.proxy(settings.onunwatch, this)();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 显示编辑器\r\n         * Show editor\r\n         * \r\n         * @param   {Function} [callback=function()] 回调函数\r\n         * @returns {editormd}                       返回editormd的实例对象\r\n         */\r\n        \r\n        show : function(callback) {\r\n            callback  = callback || function() {};\r\n            \r\n            var _this = this;\r\n            this.editor.show(0, function() {\r\n                $.proxy(callback, _this)();\r\n            });\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 隐藏编辑器\r\n         * Hide editor\r\n         * \r\n         * @param   {Function} [callback=function()] 回调函数\r\n         * @returns {editormd}                       返回editormd的实例对象\r\n         */\r\n        \r\n        hide : function(callback) {\r\n            callback  = callback || function() {};\r\n            \r\n            var _this = this;\r\n            this.editor.hide(0, function() {\r\n                $.proxy(callback, _this)();\r\n            });\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 隐藏编辑器部分，只预览HTML\r\n         * Enter preview html state\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        previewing : function() {\r\n            \r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var codeMirror       = this.codeMirror;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if ($.inArray(settings.mode, [\"gfm\", \"markdown\"]) < 0) {\r\n                return this;\r\n            }\r\n            \r\n            if (settings.toolbar && toolbar) {\r\n                toolbar.toggle();\r\n                toolbar.find(\".fa[name=preview]\").toggleClass(\"active\");\r\n            }\r\n            \r\n            codeMirror.toggle();\r\n            \r\n            var escHandle = function(event) {\r\n                if (event.shiftKey && event.keyCode === 27) {\r\n                    _this.previewed();\r\n                }\r\n            };\r\n\r\n            if (codeMirror.css(\"display\") === \"none\") // 为了兼容Zepto，而不使用codeMirror.is(\":hidden\")\r\n            {\r\n                this.state.preview = true;\r\n\r\n                if (this.state.fullscreen) {\r\n                    preview.css(\"background\", \"#fff\");\r\n                }\r\n                \r\n                editor.find(\".\" + this.classPrefix + \"preview-close-btn\").show().bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function(){\r\n                    _this.previewed();\r\n                });\r\n            \r\n                if (!settings.watch)\r\n                {\r\n                    this.save();\r\n                } \r\n                else \r\n                {\r\n                    previewContainer.css(\"padding\", \"\");\r\n                }\r\n                \r\n                previewContainer.addClass(this.classPrefix + \"preview-active\");\r\n\r\n                preview.show().css({\r\n                    position  : \"\",\r\n                    top       : 0,\r\n                    width     : editor.width(),\r\n                    height    : (settings.autoHeight && !this.state.fullscreen) ? \"auto\" : editor.height()\r\n                });\r\n                \r\n                if (this.state.loaded)\r\n                {\r\n                    $.proxy(settings.onpreviewing, this)();\r\n                }\r\n\r\n                $(window).bind(\"keyup\", escHandle);\r\n            } \r\n            else \r\n            {\r\n                $(window).unbind(\"keyup\", escHandle);\r\n                this.previewed();\r\n            }\r\n        },\r\n        \r\n        /**\r\n         * 显示编辑器部分，退出只预览HTML\r\n         * Exit preview html state\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        previewed : function() {\r\n            \r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            var previewCloseBtn  = editor.find(\".\" + this.classPrefix + \"preview-close-btn\");\r\n\r\n            this.state.preview   = false;\r\n            \r\n            this.codeMirror.show();\r\n            \r\n            if (settings.toolbar) {\r\n                toolbar.show();\r\n            }\r\n            \r\n            preview[(settings.watch) ? \"show\" : \"hide\"]();\r\n            \r\n            previewCloseBtn.hide().unbind(editormd.mouseOrTouch(\"click\", \"touchend\"));\r\n                \r\n            previewContainer.removeClass(this.classPrefix + \"preview-active\");\r\n                \r\n            if (settings.watch)\r\n            {\r\n                previewContainer.css(\"padding\", \"20px\");\r\n            }\r\n            \r\n            preview.css({ \r\n                background : null,\r\n                position   : \"absolute\",\r\n                width      : editor.width() / 2,\r\n                height     : (settings.autoHeight && !this.state.fullscreen) ? \"auto\" : editor.height() - toolbar.height(),\r\n                top        : (settings.toolbar)    ? toolbar.height() : 0\r\n            });\r\n\r\n            if (this.state.loaded)\r\n            {\r\n                $.proxy(settings.onpreviewed, this)();\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 编辑器全屏显示\r\n         * Fullscreen show\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        fullscreen : function() {\r\n            \r\n            var _this            = this;\r\n            var state            = this.state;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var fullscreenClass  = this.classPrefix + \"fullscreen\";\r\n            \r\n            if (toolbar) {\r\n                toolbar.find(\".fa[name=fullscreen]\").parent().toggleClass(\"active\"); \r\n            }\r\n            \r\n            var escHandle = function(event) {\r\n                if (!event.shiftKey && event.keyCode === 27) \r\n                {\r\n                    if (state.fullscreen)\r\n                    {\r\n                        _this.fullscreenExit();\r\n                    }\r\n                }\r\n            };\r\n\r\n            if (!editor.hasClass(fullscreenClass)) \r\n            {\r\n                state.fullscreen = true;\r\n\r\n                $(\"html,body\").css(\"overflow\", \"hidden\");\r\n                \r\n                editor.css({\r\n                    width    : $(window).width(),\r\n                    height   : $(window).height()\r\n                }).addClass(fullscreenClass);\r\n\r\n                this.resize();\r\n    \r\n                $.proxy(settings.onfullscreen, this)();\r\n\r\n                $(window).bind(\"keyup\", escHandle);\r\n            }\r\n            else\r\n            {           \r\n                $(window).unbind(\"keyup\", escHandle); \r\n                this.fullscreenExit();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 编辑器退出全屏显示\r\n         * Exit fullscreen state\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        fullscreenExit : function() {\r\n            \r\n            var editor            = this.editor;\r\n            var settings          = this.settings;\r\n            var toolbar           = this.toolbar;\r\n            var fullscreenClass   = this.classPrefix + \"fullscreen\";  \r\n            \r\n            this.state.fullscreen = false;\r\n            \r\n            if (toolbar) {\r\n                toolbar.find(\".fa[name=fullscreen]\").parent().removeClass(\"active\"); \r\n            }\r\n\r\n            $(\"html,body\").css(\"overflow\", \"\");\r\n\r\n            editor.css({\r\n                width    : editor.data(\"oldWidth\"),\r\n                height   : editor.data(\"oldHeight\")\r\n            }).removeClass(fullscreenClass);\r\n\r\n            this.resize();\r\n            \r\n            $.proxy(settings.onfullscreenExit, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 加载并执行插件\r\n         * Load and execute the plugin\r\n         * \r\n         * @param   {String}     name    plugin name / function name\r\n         * @param   {String}     path    plugin load path\r\n         * @returns {editormd}           返回editormd的实例对象\r\n         */\r\n        \r\n        executePlugin : function(name, path) {\r\n            \r\n            var _this    = this;\r\n            var cm       = this.cm;\r\n            var settings = this.settings;\r\n            \r\n            path = settings.pluginPath + path;\r\n            \r\n            if (typeof define === \"function\") \r\n            {            \r\n                if (typeof this[name] === \"undefined\")\r\n                {\r\n                    alert(\"Error: \" + name + \" plugin is not found, you are not load this plugin.\");\r\n                    \r\n                    return this;\r\n                }\r\n                \r\n                this[name](cm);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            if ($.inArray(path, editormd.loadFiles.plugin) < 0)\r\n            {\r\n                editormd.loadPlugin(path, function() {\r\n                    editormd.loadPlugins[name] = _this[name];\r\n                    _this[name](cm);\r\n                });\r\n            }\r\n            else\r\n            {\r\n                $.proxy(editormd.loadPlugins[name], this)(cm);\r\n            }\r\n            \r\n            return this;\r\n        },\r\n                \r\n        /**\r\n         * 搜索替换\r\n         * Search & replace\r\n         * \r\n         * @param   {String}     command    CodeMirror serach commands, \"find, fintNext, fintPrev, clearSearch, replace, replaceAll\"\r\n         * @returns {editormd}              return this\r\n         */\r\n        \r\n        search : function(command) {\r\n            var settings = this.settings;\r\n            \r\n            if (!settings.searchReplace)\r\n            {\r\n                alert(\"Error: settings.searchReplace == false\");\r\n                return this;\r\n            }\r\n            \r\n            if (!settings.readOnly)\r\n            {\r\n                this.cm.execCommand(command || \"find\");\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        searchReplace : function() {            \r\n            this.search(\"replace\");\r\n            \r\n            return this;\r\n        },\r\n        \r\n        searchReplaceAll : function() {          \r\n            this.search(\"replaceAll\");\r\n            \r\n            return this;\r\n        }\r\n    };\r\n    \r\n    editormd.fn.init.prototype = editormd.fn; \r\n   \r\n    /**\r\n     * 锁屏\r\n     * lock screen when dialog opening\r\n     * \r\n     * @returns {void}\r\n     */\r\n\r\n    editormd.dialogLockScreen = function() {\r\n        var settings = this.settings || {dialogLockScreen : true};\r\n        \r\n        if (settings.dialogLockScreen) \r\n        {            \r\n            $(\"html,body\").css(\"overflow\", \"hidden\");\r\n            this.resize();\r\n        }\r\n    };\r\n   \r\n    /**\r\n     * 显示透明背景层\r\n     * Display mask layer when dialog opening\r\n     * \r\n     * @param   {Object}     dialog    dialog jQuery object\r\n     * @returns {void}\r\n     */\r\n    \r\n    editormd.dialogShowMask = function(dialog) {\r\n        var editor   = this.editor;\r\n        var settings = this.settings || {dialogShowMask : true};\r\n        \r\n        dialog.css({\r\n            top  : ($(window).height() - dialog.height()) / 2 + \"px\",\r\n            left : ($(window).width()  - dialog.width())  / 2 + \"px\"\r\n        });\r\n\r\n        if (settings.dialogShowMask) {\r\n            editor.children(\".\" + this.classPrefix + \"mask\").css(\"z-index\", parseInt(dialog.css(\"z-index\")) - 1).show();\r\n        }\r\n    };\r\n\r\n    editormd.toolbarHandlers = {\r\n        undo : function() {\r\n            this.cm.undo();\r\n        },\r\n        \r\n        redo : function() {\r\n            this.cm.redo();\r\n        },\r\n        \r\n        bold : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"**\" + selection + \"**\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n        \r\n        del : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"~~\" + selection + \"~~\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n\r\n        italic : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"*\" + selection + \"*\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n\r\n        quote : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"> \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"> \" + selection);\r\n            }\r\n\r\n            //cm.replaceSelection(\"> \" + selection);\r\n            //cm.setCursor(cursor.line, (selection === \"\") ? cursor.ch + 2 : cursor.ch + selection.length + 2);\r\n        },\r\n        \r\n        ucfirst : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(editormd.firstUpperCase(selection));\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        ucwords : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(editormd.wordsFirstUpperCase(selection));\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        uppercase : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(selection.toUpperCase());\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        lowercase : function() {\r\n            var cm         = this.cm;\r\n            var cursor     = cm.getCursor();\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n            \r\n            cm.replaceSelection(selection.toLowerCase());\r\n            cm.setSelections(selections);\r\n        },\r\n\r\n        h1 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"# \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"# \" + selection);\r\n            }\r\n        },\r\n\r\n        h2 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"## \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 3);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"## \" + selection);\r\n            }\r\n        },\r\n\r\n        h3 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 4);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"### \" + selection);\r\n            }\r\n        },\r\n\r\n        h4 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"#### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 5);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"#### \" + selection);\r\n            }\r\n        },\r\n\r\n        h5 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"##### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 6);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"##### \" + selection);\r\n            }\r\n        },\r\n\r\n        h6 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"###### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 7);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"###### \" + selection);\r\n            }\r\n        },\r\n\r\n        \"list-ul\" : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (selection === \"\") \r\n            {\r\n                cm.replaceSelection(\"- \" + selection);\r\n            } \r\n            else \r\n            {\r\n                var selectionText = selection.split(\"\\n\");\r\n\r\n                for (var i = 0, len = selectionText.length; i < len; i++) \r\n                {\r\n                    selectionText[i] = (selectionText[i] === \"\") ? \"\" : \"- \" + selectionText[i];\r\n                }\r\n\r\n                cm.replaceSelection(selectionText.join(\"\\n\"));\r\n            }\r\n        },\r\n\r\n        \"list-ol\" : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if(selection === \"\") \r\n            {\r\n                cm.replaceSelection(\"1. \" + selection);\r\n            }\r\n            else\r\n            {\r\n                var selectionText = selection.split(\"\\n\");\r\n\r\n                for (var i = 0, len = selectionText.length; i < len; i++) \r\n                {\r\n                    selectionText[i] = (selectionText[i] === \"\") ? \"\" : (i+1) + \". \" + selectionText[i];\r\n                }\r\n\r\n                cm.replaceSelection(selectionText.join(\"\\n\"));\r\n            }\r\n        },\r\n\r\n        hr : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(((cursor.ch !== 0) ? \"\\n\\n\" : \"\\n\") + \"------------\\n\\n\");\r\n        },\r\n\r\n        tex : function() {\r\n            if (!this.settings.tex)\r\n            {\r\n                alert(\"settings.tex === false\");\r\n                return this;\r\n            }\r\n            \r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"$$\" + selection + \"$$\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n\r\n        link : function() {\r\n            this.executePlugin(\"linkDialog\", \"link-dialog/link-dialog\");\r\n        },\r\n\r\n        \"reference-link\" : function() {\r\n            this.executePlugin(\"referenceLinkDialog\", \"reference-link-dialog/reference-link-dialog\");\r\n        },\r\n\r\n        pagebreak : function() {\r\n            if (!this.settings.pageBreak)\r\n            {\r\n                alert(\"settings.pageBreak === false\");\r\n                return this;\r\n            }\r\n            \r\n            var cm        = this.cm;\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"\\r\\n[========]\\r\\n\");\r\n        },\r\n\r\n        image : function() {\r\n            this.executePlugin(\"imageDialog\", \"image-dialog/image-dialog\");\r\n        },\r\n        \r\n        code : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"`\" + selection + \"`\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n\r\n        \"code-block\" : function() {\r\n            this.executePlugin(\"codeBlockDialog\", \"code-block-dialog/code-block-dialog\");            \r\n        },\r\n\r\n        \"preformatted-text\" : function() {\r\n            this.executePlugin(\"preformattedTextDialog\", \"preformatted-text-dialog/preformatted-text-dialog\");\r\n        },\r\n        \r\n        table : function() {\r\n            this.executePlugin(\"tableDialog\", \"table-dialog/table-dialog\");         \r\n        },\r\n        \r\n        datetime : function() {\r\n            var cm        = this.cm;\r\n            var selection = cm.getSelection();\r\n            var date      = new Date();\r\n            var langName  = this.settings.lang.name;\r\n            var datefmt   = editormd.dateFormat() + \" \" + editormd.dateFormat((langName === \"zh-cn\" || langName === \"zh-tw\") ? \"cn-week-day\" : \"week-day\");\r\n\r\n            cm.replaceSelection(datefmt);\r\n        },\r\n        \r\n        emoji : function() {\r\n            this.executePlugin(\"emojiDialog\", \"emoji-dialog/emoji-dialog\");\r\n        },\r\n                \r\n        \"html-entities\" : function() {\r\n            this.executePlugin(\"htmlEntitiesDialog\", \"html-entities-dialog/html-entities-dialog\");\r\n        },\r\n                \r\n        \"goto-line\" : function() {\r\n            this.executePlugin(\"gotoLineDialog\", \"goto-line-dialog/goto-line-dialog\");\r\n        },\r\n\r\n        watch : function() {    \r\n            this[this.settings.watch ? \"unwatch\" : \"watch\"]();\r\n        },\r\n\r\n        preview : function() {\r\n            this.previewing();\r\n        },\r\n\r\n        fullscreen : function() {\r\n            this.fullscreen();\r\n        },\r\n\r\n        clear : function() {\r\n            this.clear();\r\n        },\r\n        \r\n        search : function() {\r\n            this.search();\r\n        },\r\n\r\n        help : function() {\r\n            this.executePlugin(\"helpDialog\", \"help-dialog/help-dialog\");\r\n        },\r\n\r\n        info : function() {\r\n            this.showInfoDialog();\r\n        }\r\n    };\r\n    \r\n    editormd.keyMaps = {\r\n        \"Ctrl-1\"       : \"h1\",\r\n        \"Ctrl-2\"       : \"h2\",\r\n        \"Ctrl-3\"       : \"h3\",\r\n        \"Ctrl-4\"       : \"h4\",\r\n        \"Ctrl-5\"       : \"h5\",\r\n        \"Ctrl-6\"       : \"h6\",\r\n        \"Ctrl-B\"       : \"bold\",  // if this is string ==  editormd.toolbarHandlers.xxxx\r\n        \"Ctrl-D\"       : \"datetime\",\r\n        \r\n        \"Ctrl-E\"       : function() { // emoji\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            if (!this.settings.emoji)\r\n            {\r\n                alert(\"Error: settings.emoji == false\");\r\n                return ;\r\n            }\r\n\r\n            cm.replaceSelection(\":\" + selection + \":\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        \"Ctrl-Alt-G\"   : \"goto-line\",\r\n        \"Ctrl-H\"       : \"hr\",\r\n        \"Ctrl-I\"       : \"italic\",\r\n        \"Ctrl-K\"       : \"code\",\r\n        \r\n        \"Ctrl-L\"        : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            var title = (selection === \"\") ? \"\" : \" \\\"\"+selection+\"\\\"\";\r\n\r\n            cm.replaceSelection(\"[\" + selection + \"](\"+title+\")\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        \"Ctrl-U\"         : \"list-ul\",\r\n        \r\n        \"Shift-Ctrl-A\"   : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            if (!this.settings.atLink)\r\n            {\r\n                alert(\"Error: settings.atLink == false\");\r\n                return ;\r\n            }\r\n\r\n            cm.replaceSelection(\"@\" + selection);\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        \r\n        \"Shift-Ctrl-C\"     : \"code\",\r\n        \"Shift-Ctrl-Q\"     : \"quote\",\r\n        \"Shift-Ctrl-S\"     : \"del\",\r\n        \"Shift-Ctrl-K\"     : \"tex\",  // KaTeX\r\n        \r\n        \"Shift-Alt-C\"      : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            cm.replaceSelection([\"```\", selection, \"```\"].join(\"\\n\"));\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 3);\r\n            } \r\n        },\r\n        \r\n        \"Shift-Ctrl-Alt-C\" : \"code-block\",\r\n        \"Shift-Ctrl-H\"     : \"html-entities\",\r\n        \"Shift-Alt-H\"      : \"help\",\r\n        \"Shift-Ctrl-E\"     : \"emoji\",\r\n        \"Shift-Ctrl-U\"     : \"uppercase\",\r\n        \"Shift-Alt-U\"      : \"ucwords\",\r\n        \"Shift-Ctrl-Alt-U\" : \"ucfirst\",\r\n        \"Shift-Alt-L\"      : \"lowercase\",\r\n        \r\n        \"Shift-Ctrl-I\"     : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            var title = (selection === \"\") ? \"\" : \" \\\"\"+selection+\"\\\"\";\r\n\r\n            cm.replaceSelection(\"![\" + selection + \"](\"+title+\")\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 4);\r\n            }\r\n        },\r\n        \r\n        \"Shift-Ctrl-Alt-I\" : \"image\",\r\n        \"Shift-Ctrl-L\"     : \"link\",\r\n        \"Shift-Ctrl-O\"     : \"list-ol\",\r\n        \"Shift-Ctrl-P\"     : \"preformatted-text\",\r\n        \"Shift-Ctrl-T\"     : \"table\",\r\n        \"Shift-Alt-P\"      : \"pagebreak\",\r\n        \"F9\"               : \"watch\",\r\n        \"F10\"              : \"preview\",\r\n        \"F11\"              : \"fullscreen\",\r\n    };\r\n    \r\n    /**\r\n     * 清除字符串两边的空格\r\n     * Clear the space of strings both sides.\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   trimed string    \r\n     */\r\n    \r\n    var trim = function(str) {\r\n        return (!String.prototype.trim) ? str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, \"\") : str.trim();\r\n    };\r\n    \r\n    editormd.trim = trim;\r\n    \r\n    /**\r\n     * 所有单词首字母大写\r\n     * Words first to uppercase\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   string\r\n     */\r\n    \r\n    var ucwords = function (str) {\r\n        return str.toLowerCase().replace(/\\b(\\w)|\\s(\\w)/g, function($1) {  \r\n            return $1.toUpperCase();\r\n        });\r\n    };\r\n    \r\n    editormd.ucwords = editormd.wordsFirstUpperCase = ucwords;\r\n    \r\n    /**\r\n     * 字符串首字母大写\r\n     * Only string first char to uppercase\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   string\r\n     */\r\n    \r\n    var firstUpperCase = function(str) {        \r\n        return str.toLowerCase().replace(/\\b(\\w)/, function($1){\r\n            return $1.toUpperCase();\r\n        });\r\n    };\r\n    \r\n    var ucfirst = firstUpperCase;\r\n    \r\n    editormd.firstUpperCase = editormd.ucfirst = firstUpperCase;\r\n    \r\n    editormd.urls = {\r\n        atLinkBase : \"https://github.com/\"\r\n    };\r\n    \r\n    editormd.regexs = {\r\n        atLink        : /@(\\w+)/g,\r\n        email         : /(\\w+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,\r\n        emailLink     : /(mailto:)?([\\w\\.\\_]+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,\r\n        emoji         : /:([\\w\\+-]+):/g,\r\n        emojiDatetime : /(\\d{2}:\\d{2}:\\d{2})/g,\r\n        twemoji       : /:(tw-([\\w]+)-?(\\w+)?):/g,\r\n        fontAwesome   : /:(fa-([\\w]+)(-(\\w+)){0,}):/g,\r\n        editormdLogo  : /:(editormd-logo-?(\\w+)?):/g,\r\n        pageBreak     : /^\\[[=]{8,}\\]$/\r\n    };\r\n\r\n    // Emoji graphics files url path\r\n    editormd.emoji     = {\r\n        path  : \"http://www.emoji-cheat-sheet.com/graphics/emojis/\",\r\n        ext   : \".png\"\r\n    };\r\n\r\n    // Twitter Emoji (Twemoji)  graphics files url path    \r\n    editormd.twemoji = {\r\n        path : \"http://twemoji.maxcdn.com/36x36/\",\r\n        ext  : \".png\"\r\n    };\r\n\r\n    /**\r\n     * 自定义marked的解析器\r\n     * Custom Marked renderer rules\r\n     * \r\n     * @param   {Array}    markdownToC     传入用于接收TOC的数组\r\n     * @returns {Renderer} markedRenderer  返回marked的Renderer自定义对象\r\n     */\r\n\r\n    editormd.markedRenderer = function(markdownToC, options) {\r\n        var defaults = {\r\n            toc                  : true,           // Table of contents\r\n            tocm                 : false,\r\n            tocStartLevel        : 1,              // Said from H1 to create ToC  \r\n            pageBreak            : true,\r\n            atLink               : true,           // for @link\r\n            emailLink            : true,           // for mail address auto link\r\n            taskList             : false,          // Enable Github Flavored Markdown task lists\r\n            emoji                : false,          // :emoji: , Support Twemoji, fontAwesome, Editor.md logo emojis.\r\n            tex                  : false,          // TeX(LaTeX), based on KaTeX\r\n            flowChart            : false,          // flowChart.js only support IE9+\r\n            sequenceDiagram      : false,          // sequenceDiagram.js only support IE9+\r\n        };\r\n        \r\n        var settings        = $.extend(defaults, options || {});    \r\n        var marked          = editormd.$marked;\r\n        var markedRenderer  = new marked.Renderer();\r\n        markdownToC         = markdownToC || [];        \r\n            \r\n        var regexs          = editormd.regexs;\r\n        var atLinkReg       = regexs.atLink;\r\n        var emojiReg        = regexs.emoji;\r\n        var emailReg        = regexs.email;\r\n        var emailLinkReg    = regexs.emailLink;\r\n        var twemojiReg      = regexs.twemoji;\r\n        var faIconReg       = regexs.fontAwesome;\r\n        var editormdLogoReg = regexs.editormdLogo;\r\n        var pageBreakReg    = regexs.pageBreak;\r\n\r\n        markedRenderer.emoji = function(text) {\r\n            \r\n            text = text.replace(editormd.regexs.emojiDatetime, function($1) {           \r\n                return $1.replace(/:/g, \"&#58;\");\r\n            });\r\n            \r\n            var matchs = text.match(emojiReg);\r\n\r\n            if (!matchs || !settings.emoji) {\r\n                return text;\r\n            }\r\n\r\n            for (var i = 0, len = matchs.length; i < len; i++)\r\n            {            \r\n                if (matchs[i] === \":+1:\") {\r\n                    matchs[i] = \":\\\\+1:\";\r\n                }\r\n\r\n                text = text.replace(new RegExp(matchs[i]), function($1, $2){\r\n                    var faMatchs = $1.match(faIconReg);\r\n                    var name     = $1.replace(/:/g, \"\");\r\n\r\n                    if (faMatchs)\r\n                    {                        \r\n                        for (var fa = 0, len1 = faMatchs.length; fa < len1; fa++)\r\n                        {\r\n                            var faName = faMatchs[fa].replace(/:/g, \"\");\r\n                            \r\n                            return \"<i class=\\\"fa \" + faName + \" fa-emoji\\\" title=\\\"\" + faName.replace(\"fa-\", \"\") + \"\\\"></i>\";\r\n                        }\r\n                    }\r\n                    else\r\n                    {\r\n                        var emdlogoMathcs = $1.match(editormdLogoReg);\r\n                        var twemojiMatchs = $1.match(twemojiReg);\r\n\r\n                        if (emdlogoMathcs)                                        \r\n                        {                            \r\n                            for (var x = 0, len2 = emdlogoMathcs.length; x < len2; x++)\r\n                            {\r\n                                var logoName = emdlogoMathcs[x].replace(/:/g, \"\");\r\n                                return \"<i class=\\\"\" + logoName + \"\\\" title=\\\"Editor.md logo (\" + logoName + \")\\\"></i>\";\r\n                            }\r\n                        }\r\n                        else if (twemojiMatchs) \r\n                        {\r\n                            for (var t = 0, len3 = twemojiMatchs.length; t < len3; t++)\r\n                            {\r\n                                var twe = twemojiMatchs[t].replace(/:/g, \"\").replace(\"tw-\", \"\");\r\n                                return \"<img src=\\\"\" + editormd.twemoji.path + twe + editormd.twemoji.ext + \"\\\" title=\\\"twemoji-\" + twe + \"\\\" alt=\\\"twemoji-\" + twe + \"\\\" class=\\\"emoji twemoji\\\" />\";\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            var src = (name === \"+1\") ? \"plus1\" : name;\r\n                            src     = (src === \"black_large_square\") ? \"black_square\" : src;\r\n                            src     = (src === \"moon\") ? \"waxing_gibbous_moon\" : src;\r\n\r\n                            return \"<img src=\\\"\" + editormd.emoji.path + src + editormd.emoji.ext + \"\\\" class=\\\"emoji\\\" title=\\\"&#58;\" + name + \"&#58;\\\" alt=\\\"&#58;\" + name + \"&#58;\\\" />\";\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            return text;\r\n        };\r\n\r\n        markedRenderer.atLink = function(text) {\r\n\r\n            if (atLinkReg.test(text))\r\n            { \r\n                if (settings.atLink) \r\n                {\r\n                    text = text.replace(emailReg, function($1, $2, $3, $4) {\r\n                        return $1.replace(/@/g, \"_#_&#64;_#_\");\r\n                    });\r\n\r\n                    text = text.replace(atLinkReg, function($1, $2) {\r\n                        return \"<a href=\\\"\" + editormd.urls.atLinkBase + \"\" + $2 + \"\\\" title=\\\"&#64;\" + $2 + \"\\\" class=\\\"at-link\\\">\" + $1 + \"</a>\";\r\n                    }).replace(/_#_&#64;_#_/g, \"@\");\r\n                }\r\n                \r\n                if (settings.emailLink)\r\n                {\r\n                    text = text.replace(emailLinkReg, function($1, $2, $3, $4, $5) {\r\n                        return (!$2 && $.inArray($5, \"jpg|jpeg|png|gif|webp|ico|icon|pdf\".split(\"|\")) < 0) ? \"<a href=\\\"mailto:\" + $1 + \"\\\">\"+$1+\"</a>\" : $1;\r\n                    });\r\n                }\r\n\r\n                return text;\r\n            }\r\n\r\n            return text;\r\n        };\r\n                \r\n        markedRenderer.link = function (href, title, text) {\r\n\r\n            if (this.options.sanitize) {\r\n                try {\r\n                    var prot = decodeURIComponent(unescape(href)).replace(/[^\\w:]/g,\"\").toLowerCase();\r\n                } catch(e) {\r\n                    return \"\";\r\n                }\r\n\r\n                if (prot.indexOf(\"javascript:\") === 0) {\r\n                    return \"\";\r\n                }\r\n            }\r\n\r\n            var out = \"<a href=\\\"\" + href + \"\\\"\";\r\n            \r\n            if (atLinkReg.test(title) || atLinkReg.test(text))\r\n            {\r\n                if (title)\r\n                {\r\n                    out += \" title=\\\"\" + title.replace(/@/g, \"&#64;\");\r\n                }\r\n                \r\n                return out + \"\\\">\" + text.replace(/@/g, \"&#64;\") + \"</a>\";\r\n            }\r\n\r\n            if (title) {\r\n                out += \" title=\\\"\" + title + \"\\\"\";\r\n            }\r\n\r\n            out += \">\" + text + \"</a>\";\r\n\r\n            return out;\r\n        };\r\n        \r\n        markedRenderer.heading = function(text, level, raw) {\r\n                    \r\n            var linkText       = text;\r\n            var hasLinkReg     = /\\s*\\<a\\s*href\\=\\\"(.*)\\\"\\s*([^\\>]*)\\>(.*)\\<\\/a\\>\\s*/;\r\n            var getLinkTextReg = /\\s*\\<a\\s*([^\\>]+)\\>([^\\>]*)\\<\\/a\\>\\s*/g;\r\n\r\n            if (hasLinkReg.test(text)) \r\n            {\r\n                var tempText = [];\r\n                text         = text.split(/\\<a\\s*([^\\>]+)\\>([^\\>]*)\\<\\/a\\>/);\r\n\r\n                for (var i = 0, len = text.length; i < len; i++)\r\n                {\r\n                    tempText.push(text[i].replace(/\\s*href\\=\\\"(.*)\\\"\\s*/g, \"\"));\r\n                }\r\n\r\n                text = tempText.join(\" \");\r\n            }\r\n            \r\n            text = trim(text);\r\n            \r\n            var escapedText    = text.toLowerCase().replace(/[^\\w]+/g, \"-\");\r\n            var toc = {\r\n                text  : text,\r\n                level : level,\r\n                slug  : escapedText\r\n            };\r\n            \r\n            var isChinese = /^[\\u4e00-\\u9fa5]+$/.test(text);\r\n            var id        = (isChinese) ? escape(text).replace(/\\%/g, \"\") : text.toLowerCase().replace(/[^\\w]+/g, \"-\");\r\n\r\n            markdownToC.push(toc);\r\n            \r\n            var headingHTML = \"<h\" + level + \" id=\\\"h\"+ level + \"-\" + this.options.headerPrefix + id +\"\\\">\";\r\n            \r\n            headingHTML    += \"<a name=\\\"\" + text + \"\\\" class=\\\"reference-link\\\"></a>\";\r\n            headingHTML    += \"<span class=\\\"header-link octicon octicon-link\\\"></span>\";\r\n            headingHTML    += (hasLinkReg) ? this.atLink(this.emoji(linkText)) : this.atLink(this.emoji(text));\r\n            headingHTML    += \"</h\" + level + \">\";\r\n\r\n            return headingHTML;\r\n        };\r\n        \r\n        markedRenderer.pageBreak = function(text) {\r\n            if (pageBreakReg.test(text) && settings.pageBreak)\r\n            {\r\n                text = \"<hr style=\\\"page-break-after:always;\\\" class=\\\"page-break editormd-page-break\\\" />\";\r\n            }\r\n            \r\n            return text;\r\n        };\r\n\r\n        markedRenderer.paragraph = function(text) {\r\n            var isTeXInline     = /\\$\\$(.*)\\$\\$/g.test(text);\r\n            var isTeXLine       = /^\\$\\$(.*)\\$\\$$/.test(text);\r\n            var isTeXAddClass   = (isTeXLine)     ? \" class=\\\"\" + editormd.classNames.tex + \"\\\"\" : \"\";\r\n            var isToC           = (settings.tocm) ? /^(\\[TOC\\]|\\[TOCM\\])$/.test(text) : /^\\[TOC\\]$/.test(text);\r\n            var isToCMenu       = /^\\[TOCM\\]$/.test(text);\r\n            \r\n            if (!isTeXLine && isTeXInline) \r\n            {\r\n                text = text.replace(/(\\$\\$([^\\$]*)\\$\\$)+/g, function($1, $2) {\r\n                    return \"<span class=\\\"\" + editormd.classNames.tex + \"\\\">\" + $2.replace(/\\$/g, \"\") + \"</span>\";\r\n                });\r\n            } \r\n            else \r\n            {\r\n                text = (isTeXLine) ? text.replace(/\\$/g, \"\") : text;\r\n            }\r\n            \r\n            var tocHTML = \"<div class=\\\"markdown-toc editormd-markdown-toc\\\">\" + text + \"</div>\";\r\n            \r\n            return (isToC) ? ( (isToCMenu) ? \"<div class=\\\"editormd-toc-menu\\\">\" + tocHTML + \"</div><br/>\" : tocHTML )\r\n                           : ( (pageBreakReg.test(text)) ? this.pageBreak(text) : \"<p\" + isTeXAddClass + \">\" + this.atLink(this.emoji(text)) + \"</p>\\n\" );\r\n        };\r\n\r\n        markedRenderer.code = function (code, lang, escaped) { \r\n\r\n            if (lang === \"seq\" || lang === \"sequence\")\r\n            {\r\n                return \"<div class=\\\"sequence-diagram\\\">\" + code + \"</div>\";\r\n            } \r\n            else if ( lang === \"flow\")\r\n            {\r\n                return \"<div class=\\\"flowchart\\\">\" + code + \"</div>\";\r\n            } \r\n            else if ( lang === \"math\" || lang === \"latex\" || lang === \"katex\")\r\n            {\r\n                return \"<p class=\\\"\" + editormd.classNames.tex + \"\\\">\" + code + \"</p>\";\r\n            } \r\n            else \r\n            {\r\n\r\n                return marked.Renderer.prototype.code.apply(this, arguments);\r\n            }\r\n        };\r\n\r\n        markedRenderer.tablecell = function(content, flags) {\r\n            var type = (flags.header) ? \"th\" : \"td\";\r\n            var tag  = (flags.align)  ? \"<\" + type +\" style=\\\"text-align:\" + flags.align + \"\\\">\" : \"<\" + type + \">\";\r\n            \r\n            return tag + this.atLink(this.emoji(content)) + \"</\" + type + \">\\n\";\r\n        };\r\n\r\n        markedRenderer.listitem = function(text) {\r\n            if (settings.taskList && /^\\s*\\[[x\\s]\\]\\s*/.test(text)) \r\n            {\r\n                text = text.replace(/^\\s*\\[\\s\\]\\s*/, \"<input type=\\\"checkbox\\\" class=\\\"task-list-item-checkbox\\\" /> \")\r\n                           .replace(/^\\s*\\[x\\]\\s*/,  \"<input type=\\\"checkbox\\\" class=\\\"task-list-item-checkbox\\\" checked disabled /> \");\r\n\r\n                return \"<li style=\\\"list-style: none;\\\">\" + this.atLink(this.emoji(text)) + \"</li>\";\r\n            }\r\n            else \r\n            {\r\n                return \"<li>\" + this.atLink(this.emoji(text)) + \"</li>\";\r\n            }\r\n        };\r\n        \r\n        return markedRenderer;\r\n    };\r\n    \r\n    /**\r\n     *\r\n     * 生成TOC(Table of Contents)\r\n     * Creating ToC (Table of Contents)\r\n     * \r\n     * @param   {Array}    toc             从marked获取的TOC数组列表\r\n     * @param   {Element}  container       插入TOC的容器元素\r\n     * @param   {Integer}  startLevel      Hx 起始层级\r\n     * @returns {Object}   tocContainer    返回ToC列表容器层的jQuery对象元素\r\n     */\r\n    \r\n    editormd.markdownToCRenderer = function(toc, container, tocDropdown, startLevel) {\r\n        \r\n        var html        = \"\";    \r\n        var lastLevel   = 0;\r\n        var classPrefix = this.classPrefix;\r\n        \r\n        startLevel      = startLevel  || 1;\r\n        \r\n        for (var i = 0, len = toc.length; i < len; i++) \r\n        {\r\n            var text  = toc[i].text;\r\n            var level = toc[i].level;\r\n            \r\n            if (level < startLevel) {\r\n                continue;\r\n            }\r\n            \r\n            if (level > lastLevel) \r\n            {\r\n                html += \"\";\r\n            }\r\n            else if (level < lastLevel) \r\n            {\r\n                html += (new Array(lastLevel - level + 2)).join(\"</ul></li>\");\r\n            } \r\n            else \r\n            {\r\n                html += \"</ul></li>\";\r\n            }\r\n\r\n            html += \"<li><a class=\\\"toc-level-\" + level + \"\\\" href=\\\"#\" + text + \"\\\" level=\\\"\" + level + \"\\\">\" + text + \"</a><ul>\";\r\n            lastLevel = level;\r\n        }\r\n        \r\n        var tocContainer = container.find(\".markdown-toc\");\r\n        \r\n        if ((tocContainer.length < 1 && container.attr(\"previewContainer\") === \"false\"))\r\n        {\r\n            var tocHTML = \"<div class=\\\"markdown-toc \" + classPrefix + \"markdown-toc\\\"></div>\";\r\n            \r\n            tocHTML = (tocDropdown) ? \"<div class=\\\"\" + classPrefix + \"toc-menu\\\">\" + tocHTML + \"</div>\" : tocHTML;\r\n            \r\n            container.html(tocHTML);\r\n            \r\n            tocContainer = container.find(\".markdown-toc\");\r\n        }\r\n        \r\n        if (tocDropdown)\r\n        {\r\n            tocContainer.wrap(\"<div class=\\\"\" + classPrefix + \"toc-menu\\\"></div><br/>\");\r\n        }\r\n        \r\n        tocContainer.html(\"<ul class=\\\"markdown-toc-list\\\"></ul>\").children(\".markdown-toc-list\").html(html.replace(/\\r?\\n?\\<ul\\>\\<\\/ul\\>/g, \"\"));\r\n        \r\n        return tocContainer;\r\n    };\r\n    \r\n    /**\r\n     *\r\n     * 生成TOC下拉菜单\r\n     * Creating ToC dropdown menu\r\n     * \r\n     * @param   {Object}   container       插入TOC的容器jQuery对象元素\r\n     * @param   {String}   tocTitle        ToC title\r\n     * @returns {Object}                   return toc-menu object\r\n     */\r\n    \r\n    editormd.tocDropdownMenu = function(container, tocTitle) {\r\n        \r\n        tocTitle      = tocTitle || \"Table of Contents\";\r\n        \r\n        var zindex    = 400;\r\n        var tocMenus  = container.find(\".\" + this.classPrefix + \"toc-menu\");\r\n\r\n        tocMenus.each(function() {\r\n            var $this  = $(this);\r\n            var toc    = $this.children(\".markdown-toc\");\r\n            var icon   = \"<i class=\\\"fa fa-angle-down\\\"></i>\";\r\n            var btn    = \"<a href=\\\"javascript:;\\\" class=\\\"toc-menu-btn\\\">\" + icon + tocTitle + \"</a>\";\r\n            var menu   = toc.children(\"ul\");            \r\n            var list   = menu.find(\"li\");\r\n            \r\n            toc.append(btn);\r\n            \r\n            list.first().before(\"<li><h1>\" + tocTitle + \" \" + icon + \"</h1></li>\");\r\n            \r\n            $this.mouseover(function(){\r\n                menu.show();\r\n\r\n                list.each(function(){\r\n                    var li = $(this);\r\n                    var ul = li.children(\"ul\");\r\n\r\n                    if (ul.html() === \"\")\r\n                    {\r\n                        ul.remove();\r\n                    }\r\n\r\n                    if (ul.length > 0 && ul.html() !== \"\")\r\n                    {\r\n                        var firstA = li.children(\"a\").first();\r\n\r\n                        if (firstA.children(\".fa\").length < 1)\r\n                        {\r\n                            firstA.append( $(icon).css({ float:\"right\", paddingTop:\"4px\" }) );\r\n                        }\r\n                    }\r\n\r\n                    li.mouseover(function(){\r\n                        ul.css(\"z-index\", zindex).show();\r\n                        zindex += 1;\r\n                    }).mouseleave(function(){\r\n                        ul.hide();\r\n                    });\r\n                });\r\n            }).mouseleave(function(){\r\n                menu.hide();\r\n            }); \r\n        });       \r\n        \r\n        return tocMenus;\r\n    };\r\n    \r\n    /**\r\n     * 简单地过滤指定的HTML标签\r\n     * Filter custom html tags\r\n     * \r\n     * @param   {String}   html          要过滤HTML\r\n     * @param   {String}   filters       要过滤的标签\r\n     * @returns {String}   html          返回过滤的HTML\r\n     */\r\n    \r\n    editormd.filterHTMLTags = function(html, filters) {\r\n        \r\n        if (typeof html !== \"string\") {\r\n            html = new String(html);\r\n        }\r\n            \r\n        if (typeof filters !== \"string\") {\r\n            return html;\r\n        }\r\n\r\n        var expression = filters.split(\"|\");\r\n        var filterTags = expression[0].split(\",\");\r\n        var attrs      = expression[1];\r\n\r\n        for (var i = 0, len = filterTags.length; i < len; i++)\r\n        {\r\n            var tag = filterTags[i];\r\n\r\n            html = html.replace(new RegExp(\"\\<\\s*\" + tag + \"\\s*([^\\>]*)\\>([^\\>]*)\\<\\s*\\/\" + tag + \"\\s*\\>\", \"igm\"), \"\");\r\n        }\r\n        \r\n        //return html;\r\n\r\n        if (typeof attrs !== \"undefined\")\r\n        {\r\n            var htmlTagRegex = /\\<(\\w+)\\s*([^\\>]*)\\>([^\\>]*)\\<\\/(\\w+)\\>/ig;\r\n\r\n            if (attrs === \"*\")\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4, $5) {\r\n                    return \"<\" + $2 + \">\" + $4 + \"</\" + $5 + \">\";\r\n                });         \r\n            }\r\n            else if (attrs === \"on*\")\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4, $5) {\r\n                    var el = $(\"<\" + $2 + \">\" + $4 + \"</\" + $5 + \">\");\r\n                    var _attrs = $($1)[0].attributes;\r\n                    var $attrs = {};\r\n                    \r\n                    $.each(_attrs, function(i, e) {\r\n                        if (e.nodeName !== '\"') $attrs[e.nodeName] = e.nodeValue;\r\n                    });\r\n                    \r\n                    $.each($attrs, function(i) {                        \r\n                        if (i.indexOf(\"on\") === 0) {\r\n                            delete $attrs[i];\r\n                        }\r\n                    });\r\n                    \r\n                    el.attr($attrs);\r\n                    \r\n                    var text = (typeof el[1] !== \"undefined\") ? $(el[1]).text() : \"\";\r\n\r\n                    return el[0].outerHTML + text;\r\n                });\r\n            }\r\n            else\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4) {\r\n                    var filterAttrs = attrs.split(\",\");\r\n                    var el = $($1);\r\n                    el.html($4);\r\n\r\n                    $.each(filterAttrs, function(i) {\r\n                        el.attr(filterAttrs[i], null);\r\n                    });\r\n\r\n                    return el[0].outerHTML;\r\n                });\r\n            }\r\n        }\r\n        \r\n        return html;\r\n    };\r\n    \r\n    /**\r\n     * 将Markdown文档解析为HTML用于前台显示\r\n     * Parse Markdown to HTML for Font-end preview.\r\n     * \r\n     * @param   {String}   id            用于显示HTML的对象ID\r\n     * @param   {Object}   [options={}]  配置选项，可选\r\n     * @returns {Object}   div           返回jQuery对象元素\r\n     */\r\n    \r\n    editormd.markdownToHTML = function(id, options) {\r\n        var defaults = {\r\n            gfm                  : true,\r\n            toc                  : true,\r\n            tocm                 : false,\r\n            tocStartLevel        : 1,\r\n            tocTitle             : \"目录\",\r\n            tocDropdown          : false,\r\n            tocContainer         : \"\",\r\n            markdown             : \"\",\r\n            markdownSourceCode   : false,\r\n            htmlDecode           : false,\r\n            autoLoadKaTeX        : true,\r\n            pageBreak            : true,\r\n            atLink               : true,    // for @link\r\n            emailLink            : true,    // for mail address auto link\r\n            tex                  : false,\r\n            taskList             : false,   // Github Flavored Markdown task lists\r\n            emoji                : false,\r\n            flowChart            : false,\r\n            sequenceDiagram      : false,\r\n            previewCodeHighlight : true\r\n        };\r\n        \r\n        editormd.$marked  = marked;\r\n\r\n        var div           = $(\"#\" + id);\r\n        var settings      = div.settings = $.extend(true, defaults, options || {});\r\n        var saveTo        = div.find(\"textarea\");\r\n        \r\n        if (saveTo.length < 1)\r\n        {\r\n            div.append(\"<textarea></textarea>\");\r\n            saveTo        = div.find(\"textarea\");\r\n        }        \r\n        \r\n        var markdownDoc   = (settings.markdown === \"\") ? saveTo.val() : settings.markdown; \r\n        var markdownToC   = [];\r\n\r\n        var rendererOptions = {  \r\n            toc                  : settings.toc,\r\n            tocm                 : settings.tocm,\r\n            tocStartLevel        : settings.tocStartLevel,\r\n            taskList             : settings.taskList,\r\n            emoji                : settings.emoji,\r\n            tex                  : settings.tex,\r\n            pageBreak            : settings.pageBreak,\r\n            atLink               : settings.atLink,           // for @link\r\n            emailLink            : settings.emailLink,        // for mail address auto link\r\n            flowChart            : settings.flowChart,\r\n            sequenceDiagram      : settings.sequenceDiagram,\r\n            previewCodeHighlight : settings.previewCodeHighlight,\r\n        };\r\n\r\n        var markedOptions = {\r\n            renderer    : editormd.markedRenderer(markdownToC, rendererOptions),\r\n            gfm         : settings.gfm,\r\n            tables      : true,\r\n            breaks      : true,\r\n            pedantic    : false,\r\n            sanitize    : (settings.htmlDecode) ? false : true, // 是否忽略HTML标签，即是否开启HTML标签解析，为了安全性，默认不开启\r\n            smartLists  : true,\r\n            smartypants : true\r\n        };\r\n        \r\n\t\tmarkdownDoc = new String(markdownDoc);\r\n        \r\n        var markdownParsed = marked(markdownDoc, markedOptions);\r\n        \r\n        markdownParsed = editormd.filterHTMLTags(markdownParsed, settings.htmlDecode);\r\n        \r\n        if (settings.markdownSourceCode) {\r\n            saveTo.text(markdownDoc);\r\n        } else {\r\n            saveTo.remove();\r\n        }\r\n        \r\n        div.addClass(\"markdown-body \" + this.classPrefix + \"html-preview\").append(markdownParsed);\r\n        \r\n        var tocContainer = (settings.tocContainer !== \"\") ? $(settings.tocContainer) : div;\r\n        \r\n        if (settings.tocContainer !== \"\")\r\n        {\r\n            tocContainer.attr(\"previewContainer\", false);\r\n        }\r\n         \r\n        if (settings.toc) \r\n        {\r\n            div.tocContainer = this.markdownToCRenderer(markdownToC, tocContainer, settings.tocDropdown, settings.tocStartLevel);\r\n            \r\n            if (settings.tocDropdown || div.find(\".\" + this.classPrefix + \"toc-menu\").length > 0)\r\n            {\r\n                this.tocDropdownMenu(div, settings.tocTitle);\r\n            }\r\n            \r\n            if (settings.tocContainer !== \"\")\r\n            {\r\n                div.find(\".editormd-toc-menu, .editormd-markdown-toc\").remove();\r\n            }\r\n        }\r\n            \r\n        if (settings.previewCodeHighlight) \r\n        {\r\n            div.find(\"pre\").addClass(\"prettyprint linenums\");\r\n            prettyPrint();\r\n        }\r\n        \r\n        if (!editormd.isIE8) \r\n        {\r\n            if (settings.flowChart) {\r\n                div.find(\".flowchart\").flowChart(); \r\n            }\r\n\r\n            if (settings.sequenceDiagram) {\r\n                div.find(\".sequence-diagram\").sequenceDiagram({theme: \"simple\"});\r\n            }\r\n        }\r\n\r\n        if (settings.tex)\r\n        {\r\n            var katexHandle = function() {\r\n                div.find(\".\" + editormd.classNames.tex).each(function(){\r\n                    var tex  = $(this);                    \r\n                    katex.render(tex.html().replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\"), tex[0]);                    \r\n                    tex.find(\".katex\").css(\"font-size\", \"1.6em\");\r\n                });\r\n            };\r\n            \r\n            if (settings.autoLoadKaTeX && !editormd.$katex && !editormd.kaTeXLoaded)\r\n            {\r\n                this.loadKaTeX(function() {\r\n                    editormd.$katex      = katex;\r\n                    editormd.kaTeXLoaded = true;\r\n                    katexHandle();\r\n                });\r\n            }\r\n            else\r\n            {\r\n                katexHandle();\r\n            }\r\n        }\r\n        \r\n        div.getMarkdown = function() {            \r\n            return saveTo.val();\r\n        };\r\n        \r\n        return div;\r\n    };\r\n    \r\n    // Editor.md themes, change toolbar themes etc.\r\n    // added @1.5.0\r\n    editormd.themes        = [\"default\", \"dark\"];\r\n    \r\n    // Preview area themes\r\n    // added @1.5.0\r\n    editormd.previewThemes = [\"default\", \"dark\"];\r\n    \r\n    // CodeMirror / editor area themes\r\n    // @1.5.0 rename -> editorThemes, old version -> themes\r\n    editormd.editorThemes = [\r\n        \"default\", \"3024-day\", \"3024-night\",\r\n        \"ambiance\", \"ambiance-mobile\",\r\n        \"base16-dark\", \"base16-light\", \"blackboard\",\r\n        \"cobalt\",\r\n        \"eclipse\", \"elegant\", \"erlang-dark\",\r\n        \"lesser-dark\",\r\n        \"mbo\", \"mdn-like\", \"midnight\", \"monokai\",\r\n        \"neat\", \"neo\", \"night\",\r\n        \"paraiso-dark\", \"paraiso-light\", \"pastel-on-dark\",\r\n        \"rubyblue\",\r\n        \"solarized\",\r\n        \"the-matrix\", \"tomorrow-night-eighties\", \"twilight\",\r\n        \"vibrant-ink\",\r\n        \"xq-dark\", \"xq-light\"\r\n    ];\r\n\r\n    editormd.loadPlugins = {};\r\n    \r\n    editormd.loadFiles = {\r\n        js     : [],\r\n        css    : [],\r\n        plugin : []\r\n    };\r\n    \r\n    /**\r\n     * 动态加载Editor.md插件，但不立即执行\r\n     * Load editor.md plugins\r\n     * \r\n     * @param {String}   fileName              插件文件路径\r\n     * @param {Function} [callback=function()] 加载成功后执行的回调函数\r\n     * @param {String}   [into=\"head\"]         嵌入页面的位置\r\n     */\r\n    \r\n    editormd.loadPlugin = function(fileName, callback, into) {\r\n        callback   = callback || function() {};\r\n        \r\n        this.loadScript(fileName, function() {\r\n            editormd.loadFiles.plugin.push(fileName);\r\n            callback();\r\n        }, into);\r\n    };\r\n    \r\n    /**\r\n     * 动态加载CSS文件的方法\r\n     * Load css file method\r\n     * \r\n     * @param {String}   fileName              CSS文件名\r\n     * @param {Function} [callback=function()] 加载成功后执行的回调函数\r\n     * @param {String}   [into=\"head\"]         嵌入页面的位置\r\n     */\r\n    \r\n    editormd.loadCSS   = function(fileName, callback, into) {\r\n        into       = into     || \"head\";        \r\n        callback   = callback || function() {};\r\n        \r\n        var css    = document.createElement(\"link\");\r\n        css.type   = \"text/css\";\r\n        css.rel    = \"stylesheet\";\r\n        css.onload = css.onreadystatechange = function() {\r\n            editormd.loadFiles.css.push(fileName);\r\n            callback();\r\n        };\r\n\r\n        css.href   = fileName + \".css\";\r\n\r\n        if(into === \"head\") {\r\n            document.getElementsByTagName(\"head\")[0].appendChild(css);\r\n        } else {\r\n            document.body.appendChild(css);\r\n        }\r\n    };\r\n    \r\n    editormd.isIE    = (navigator.appName == \"Microsoft Internet Explorer\");\r\n    editormd.isIE8   = (editormd.isIE && navigator.appVersion.match(/8./i) == \"8.\");\r\n\r\n    /**\r\n     * 动态加载JS文件的方法\r\n     * Load javascript file method\r\n     * \r\n     * @param {String}   fileName              JS文件名\r\n     * @param {Function} [callback=function()] 加载成功后执行的回调函数\r\n     * @param {String}   [into=\"head\"]         嵌入页面的位置\r\n     */\r\n\r\n    editormd.loadScript = function(fileName, callback, into) {\r\n        \r\n        into          = into     || \"head\";\r\n        callback      = callback || function() {};\r\n        \r\n        var script    = null; \r\n        script        = document.createElement(\"script\");\r\n        script.id     = fileName.replace(/[\\./]+/g, \"-\");\r\n        script.type   = \"text/javascript\";        \r\n        script.src    = fileName + \".js\";\r\n        \r\n        if (editormd.isIE8) \r\n        {            \r\n            script.onreadystatechange = function() {\r\n                if(script.readyState) \r\n                {\r\n                    if (script.readyState === \"loaded\" || script.readyState === \"complete\") \r\n                    {\r\n                        script.onreadystatechange = null; \r\n                        editormd.loadFiles.js.push(fileName);\r\n                        callback();\r\n                    }\r\n                } \r\n            };\r\n        }\r\n        else\r\n        {\r\n            script.onload = function() {\r\n                editormd.loadFiles.js.push(fileName);\r\n                callback();\r\n            };\r\n        }\r\n\r\n        if (into === \"head\") {\r\n            document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n        } else {\r\n            document.body.appendChild(script);\r\n        }\r\n    };\r\n    \r\n    // 使用国外的CDN，加载速度有时会很慢，或者自定义URL\r\n    // You can custom KaTeX load url.\r\n    editormd.katexURL  = {\r\n        css : \"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\",\r\n        js  : \"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\"\r\n    };\r\n    \r\n    editormd.kaTeXLoaded = false;\r\n    \r\n    /**\r\n     * 加载KaTeX文件\r\n     * load KaTeX files\r\n     * \r\n     * @param {Function} [callback=function()]  加载成功后执行的回调函数\r\n     */\r\n    \r\n    editormd.loadKaTeX = function (callback) {\r\n        editormd.loadCSS(editormd.katexURL.css, function(){\r\n            editormd.loadScript(editormd.katexURL.js, callback || function(){});\r\n        });\r\n    };\r\n        \r\n    /**\r\n     * 锁屏\r\n     * lock screen\r\n     * \r\n     * @param   {Boolean}   lock   Boolean 布尔值，是否锁屏\r\n     * @returns {void}\r\n     */\r\n    \r\n    editormd.lockScreen = function(lock) {\r\n        $(\"html,body\").css(\"overflow\", (lock) ? \"hidden\" : \"\");\r\n    };\r\n        \r\n    /**\r\n     * 动态创建对话框\r\n     * Creating custom dialogs\r\n     * \r\n     * @param   {Object} options 配置项键值对 Key/Value\r\n     * @returns {dialog} 返回创建的dialog的jQuery实例对象\r\n     */\r\n\r\n    editormd.createDialog = function(options) {\r\n        var defaults = {\r\n            name : \"\",\r\n            width : 420,\r\n            height: 240,\r\n            title : \"\",\r\n            drag  : true,\r\n            closed : true,\r\n            content : \"\",\r\n            mask : true,\r\n            maskStyle : {\r\n                backgroundColor : \"#fff\",\r\n                opacity : 0.1\r\n            },\r\n            lockScreen : true,\r\n            footer : true,\r\n            buttons : false\r\n        };\r\n\r\n        options          = $.extend(true, defaults, options);\r\n        \r\n        var $this        = this;\r\n        var editor       = this.editor;\r\n        var classPrefix  = editormd.classPrefix;\r\n        var guid         = (new Date()).getTime();\r\n        var dialogName   = ( (options.name === \"\") ? classPrefix + \"dialog-\" + guid : options.name);\r\n        var mouseOrTouch = editormd.mouseOrTouch;\r\n\r\n        var html         = \"<div class=\\\"\" + classPrefix + \"dialog \" + dialogName + \"\\\">\";\r\n\r\n        if (options.title !== \"\")\r\n        {\r\n            html += \"<div class=\\\"\" + classPrefix + \"dialog-header\\\"\" + ( (options.drag) ? \" style=\\\"cursor: move;\\\"\" : \"\" ) + \">\";\r\n            html += \"<strong class=\\\"\" + classPrefix + \"dialog-title\\\">\" + options.title + \"</strong>\";\r\n            html += \"</div>\";\r\n        }\r\n\r\n        if (options.closed)\r\n        {\r\n            html += \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"dialog-close\\\"></a>\";\r\n        }\r\n\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-container\\\">\" + options.content;                    \r\n\r\n        if (options.footer || typeof options.footer === \"string\") \r\n        {\r\n            html += \"<div class=\\\"\" + classPrefix + \"dialog-footer\\\">\" + ( (typeof options.footer === \"boolean\") ? \"\" : options.footer) + \"</div>\";\r\n        }\r\n\r\n        html += \"</div>\";\r\n\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-mask \" + classPrefix + \"dialog-mask-bg\\\"></div>\";\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-mask \" + classPrefix + \"dialog-mask-con\\\"></div>\";\r\n        html += \"</div>\";\r\n\r\n        editor.append(html);\r\n\r\n        var dialog = editor.find(\".\" + dialogName);\r\n\r\n        dialog.lockScreen = function(lock) {\r\n            if (options.lockScreen)\r\n            {                \r\n                $(\"html,body\").css(\"overflow\", (lock) ? \"hidden\" : \"\");\r\n                $this.resize();\r\n            }\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.showMask = function() {\r\n            if (options.mask)\r\n            {\r\n                editor.find(\".\" + classPrefix + \"mask\").css(options.maskStyle).css(\"z-index\", editormd.dialogZindex - 1).show();\r\n            }\r\n            return dialog;\r\n        };\r\n\r\n        dialog.hideMask = function() {\r\n            if (options.mask)\r\n            {\r\n                editor.find(\".\" + classPrefix + \"mask\").hide();\r\n            }\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.loading = function(show) {                        \r\n            var loading = dialog.find(\".\" + classPrefix + \"dialog-mask\");\r\n            loading[(show) ? \"show\" : \"hide\"]();\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.lockScreen(true).showMask();\r\n\r\n        dialog.show().css({\r\n            zIndex : editormd.dialogZindex,\r\n            border : (editormd.isIE8) ? \"1px solid #ddd\" : \"\",\r\n            width  : (typeof options.width  === \"number\") ? options.width + \"px\"  : options.width,\r\n            height : (typeof options.height === \"number\") ? options.height + \"px\" : options.height\r\n        });\r\n\r\n        var dialogPosition = function(){\r\n            dialog.css({\r\n                top    : ($(window).height() - dialog.height()) / 2 + \"px\",\r\n                left   : ($(window).width() - dialog.width()) / 2 + \"px\"\r\n            });\r\n        };\r\n\r\n        dialogPosition();\r\n\r\n        $(window).resize(dialogPosition);\r\n\r\n        dialog.children(\".\" + classPrefix + \"dialog-close\").bind(mouseOrTouch(\"click\", \"touchend\"), function() {\r\n            dialog.hide().lockScreen(false).hideMask();\r\n        });\r\n\r\n        if (typeof options.buttons === \"object\")\r\n        {\r\n            var footer = dialog.footer = dialog.find(\".\" + classPrefix + \"dialog-footer\");\r\n\r\n            for (var key in options.buttons)\r\n            {\r\n                var btn = options.buttons[key];\r\n                var btnClassName = classPrefix + key + \"-btn\";\r\n\r\n                footer.append(\"<button class=\\\"\" + classPrefix + \"btn \" + btnClassName + \"\\\">\" + btn[0] + \"</button>\");\r\n                btn[1] = $.proxy(btn[1], dialog);\r\n                footer.children(\".\" + btnClassName).bind(mouseOrTouch(\"click\", \"touchend\"), btn[1]);\r\n            }\r\n        }\r\n\r\n        if (options.title !== \"\" && options.drag)\r\n        {                        \r\n            var posX, posY;\r\n            var dialogHeader = dialog.children(\".\" + classPrefix + \"dialog-header\");\r\n\r\n            if (!options.mask) {\r\n                dialogHeader.bind(mouseOrTouch(\"click\", \"touchend\"), function(){\r\n                    editormd.dialogZindex += 2;\r\n                    dialog.css(\"z-index\", editormd.dialogZindex);\r\n                });\r\n            }\r\n\r\n            dialogHeader.mousedown(function(e) {\r\n                e = e || window.event;  //IE\r\n                posX = e.clientX - parseInt(dialog[0].style.left);\r\n                posY = e.clientY - parseInt(dialog[0].style.top);\r\n\r\n                document.onmousemove = moveAction;                   \r\n            });\r\n\r\n            var userCanSelect = function (obj) {\r\n                obj.removeClass(classPrefix + \"user-unselect\").off(\"selectstart\");\r\n            };\r\n\r\n            var userUnselect = function (obj) {\r\n                obj.addClass(classPrefix + \"user-unselect\").on(\"selectstart\", function(event) { // selectstart for IE                        \r\n                    return false;\r\n                });\r\n            };\r\n\r\n            var moveAction = function (e) {\r\n                e = e || window.event;  //IE\r\n\r\n                var left, top, nowLeft = parseInt(dialog[0].style.left), nowTop = parseInt(dialog[0].style.top);\r\n\r\n                if( nowLeft >= 0 ) {\r\n                    if( nowLeft + dialog.width() <= $(window).width()) {\r\n                        left = e.clientX - posX;\r\n                    } else {\t\r\n                        left = $(window).width() - dialog.width();\r\n                        document.onmousemove = null;\r\n                    }\r\n                } else {\r\n                    left = 0;\r\n                    document.onmousemove = null;\r\n                }\r\n\r\n                if( nowTop >= 0 ) {\r\n                    top = e.clientY - posY;\r\n                } else {\r\n                    top = 0;\r\n                    document.onmousemove = null;\r\n                }\r\n\r\n\r\n                document.onselectstart = function() {\r\n                    return false;\r\n                };\r\n\r\n                userUnselect($(\"body\"));\r\n                userUnselect(dialog);\r\n                dialog[0].style.left = left + \"px\";\r\n                dialog[0].style.top  = top + \"px\";\r\n            };\r\n\r\n            document.onmouseup = function() {                            \r\n                userCanSelect($(\"body\"));\r\n                userCanSelect(dialog);\r\n\r\n                document.onselectstart = null;         \r\n                document.onmousemove = null;\r\n            };\r\n\r\n            dialogHeader.touchDraggable = function() {\r\n                var offset = null;\r\n                var start  = function(e) {\r\n                    var orig = e.originalEvent; \r\n                    var pos  = $(this).parent().position();\r\n\r\n                    offset = {\r\n                        x : orig.changedTouches[0].pageX - pos.left,\r\n                        y : orig.changedTouches[0].pageY - pos.top\r\n                    };\r\n                };\r\n\r\n                var move = function(e) {\r\n                    e.preventDefault();\r\n                    var orig = e.originalEvent;\r\n\r\n                    $(this).parent().css({\r\n                        top  : orig.changedTouches[0].pageY - offset.y,\r\n                        left : orig.changedTouches[0].pageX - offset.x\r\n                    });\r\n                };\r\n\r\n                this.bind(\"touchstart\", start).bind(\"touchmove\", move);\r\n            };\r\n\r\n            dialogHeader.touchDraggable();\r\n        }\r\n\r\n        editormd.dialogZindex += 2;\r\n\r\n        return dialog;\r\n    };\r\n    \r\n    /**\r\n     * 鼠标和触摸事件的判断/选择方法\r\n     * MouseEvent or TouchEvent type switch\r\n     * \r\n     * @param   {String} [mouseEventType=\"click\"]    供选择的鼠标事件\r\n     * @param   {String} [touchEventType=\"touchend\"] 供选择的触摸事件\r\n     * @returns {String} EventType                   返回事件类型名称\r\n     */\r\n    \r\n    editormd.mouseOrTouch = function(mouseEventType, touchEventType) {\r\n        mouseEventType = mouseEventType || \"click\";\r\n        touchEventType = touchEventType || \"touchend\";\r\n        \r\n        var eventType  = mouseEventType;\r\n\r\n        try {\r\n            document.createEvent(\"TouchEvent\");\r\n            eventType = touchEventType;\r\n        } catch(e) {}\r\n\r\n        return eventType;\r\n    };\r\n    \r\n    /**\r\n     * 日期时间的格式化方法\r\n     * Datetime format method\r\n     * \r\n     * @param   {String}   [format=\"\"]  日期时间的格式，类似PHP的格式\r\n     * @returns {String}   datefmt      返回格式化后的日期时间字符串\r\n     */\r\n    \r\n    editormd.dateFormat = function(format) {                \r\n        format      = format || \"\";\r\n\r\n        var addZero = function(d) {\r\n            return (d < 10) ? \"0\" + d : d;\r\n        };\r\n\r\n        var date    = new Date(); \r\n        var year    = date.getFullYear();\r\n        var year2   = year.toString().slice(2, 4);\r\n        var month   = addZero(date.getMonth() + 1);\r\n        var day     = addZero(date.getDate());\r\n        var weekDay = date.getDay();\r\n        var hour    = addZero(date.getHours());\r\n        var min     = addZero(date.getMinutes());\r\n        var second  = addZero(date.getSeconds());\r\n        var ms      = addZero(date.getMilliseconds()); \r\n        var datefmt = \"\";\r\n\r\n        var ymd     = year2 + \"-\" + month + \"-\" + day;\r\n        var fymd    = year  + \"-\" + month + \"-\" + day;\r\n        var hms     = hour  + \":\" + min   + \":\" + second;\r\n\r\n        switch (format) \r\n        {\r\n            case \"UNIX Time\" :\r\n                    datefmt = date.getTime();\r\n                break;\r\n\r\n            case \"UTC\" :\r\n                    datefmt = date.toUTCString();\r\n                break;\t\r\n\r\n            case \"yy\" :\r\n                    datefmt = year2;\r\n                break;\t\r\n\r\n            case \"year\" :\r\n            case \"yyyy\" :\r\n                    datefmt = year;\r\n                break;\r\n\r\n            case \"month\" :\r\n            case \"mm\" :\r\n                    datefmt = month;\r\n                break;                        \r\n\r\n            case \"cn-week-day\" :\r\n            case \"cn-wd\" :\r\n                    var cnWeekDays = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\r\n                    datefmt = \"星期\" + cnWeekDays[weekDay];\r\n                break;\r\n\r\n            case \"week-day\" :\r\n            case \"wd\" :\r\n                    var weekDays = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\r\n                    datefmt = weekDays[weekDay];\r\n                break;\r\n\r\n            case \"day\" :\r\n            case \"dd\" :\r\n                    datefmt = day;\r\n                break;\r\n\r\n            case \"hour\" :\r\n            case \"hh\" :\r\n                    datefmt = hour;\r\n                break;\r\n\r\n            case \"min\" :\r\n            case \"ii\" :\r\n                    datefmt = min;\r\n                break;\r\n\r\n            case \"second\" :\r\n            case \"ss\" :\r\n                    datefmt = second;\r\n                break;\r\n\r\n            case \"ms\" :\r\n                    datefmt = ms;\r\n                break;\r\n\r\n            case \"yy-mm-dd\" :\r\n                    datefmt = ymd;\r\n                break;\r\n\r\n            case \"yyyy-mm-dd\" :\r\n                    datefmt = fymd;\r\n                break;\r\n\r\n            case \"yyyy-mm-dd h:i:s ms\" :\r\n            case \"full + ms\" : \r\n                    datefmt = fymd + \" \" + hms + \" \" + ms;\r\n                break;\r\n\r\n            case \"full\" :\r\n            case \"yyyy-mm-dd h:i:s\" :\r\n                default:\r\n                    datefmt = fymd + \" \" + hms;\r\n                break;\r\n        }\r\n\r\n        return datefmt;\r\n    };\r\n\r\n    return editormd;\r\n\r\n}));\r\n"
        },
        {
          "name": "editormd.amd.min.js",
          "type": "blob",
          "size": 54.111328125,
          "content": "/*! Editor.md v1.5.0 | editormd.amd.min.js | Open source online markdown editor. | MIT License | By: Pandao | https://github.com/pandao/editor.md | 2015-06-09 */\r\n!function(e){\"use strict\";if(\"function\"==typeof require&&\"object\"==typeof exports&&\"object\"==typeof module)module.exports=e;else if(\"function\"==typeof define)if(define.amd){var t=\"codemirror/mode/\",i=\"codemirror/addon/\",o=[\"jquery\",\"marked\",\"prettify\",\"katex\",\"raphael\",\"underscore\",\"flowchart\",\"jqueryflowchart\",\"sequenceDiagram\",\"codemirror/lib/codemirror\",t+\"css/css\",t+\"sass/sass\",t+\"shell/shell\",t+\"sql/sql\",t+\"clike/clike\",t+\"php/php\",t+\"xml/xml\",t+\"markdown/markdown\",t+\"javascript/javascript\",t+\"htmlmixed/htmlmixed\",t+\"gfm/gfm\",t+\"http/http\",t+\"go/go\",t+\"dart/dart\",t+\"coffeescript/coffeescript\",t+\"nginx/nginx\",t+\"python/python\",t+\"perl/perl\",t+\"lua/lua\",t+\"r/r\",t+\"ruby/ruby\",t+\"rst/rst\",t+\"smartymixed/smartymixed\",t+\"vb/vb\",t+\"vbscript/vbscript\",t+\"velocity/velocity\",t+\"xquery/xquery\",t+\"yaml/yaml\",t+\"erlang/erlang\",t+\"jade/jade\",i+\"edit/trailingspace\",i+\"dialog/dialog\",i+\"search/searchcursor\",i+\"search/search\",i+\"scroll/annotatescrollbar\",i+\"search/matchesonscrollbar\",i+\"display/placeholder\",i+\"edit/closetag\",i+\"fold/foldcode\",i+\"fold/foldgutter\",i+\"fold/indent-fold\",i+\"fold/brace-fold\",i+\"fold/xml-fold\",i+\"fold/markdown-fold\",i+\"fold/comment-fold\",i+\"mode/overlay\",i+\"selection/active-line\",i+\"edit/closebrackets\",i+\"display/fullscreen\",i+\"search/match-highlighter\"];define(o,e)}else define([\"jquery\"],e);else window.editormd=e()}(function(){\"function\"==typeof define&&define.amd&&(e=arguments[0],marked=arguments[1],prettify=arguments[2],katex=arguments[3],Raphael=arguments[4],_=arguments[5],flowchart=arguments[6],CodeMirror=arguments[9]);var e=\"undefined\"!=typeof jQuery?jQuery:Zepto;if(\"undefined\"!=typeof e){var t=function(e,i){return new t.fn.init(e,i)};t.title=t.$name=\"Editor.md\",t.version=\"1.5.0\",t.homePage=\"https://pandao.github.io/editor.md/\",t.classPrefix=\"editormd-\",t.toolbarModes={full:[\"undo\",\"redo\",\"|\",\"bold\",\"del\",\"italic\",\"quote\",\"ucwords\",\"uppercase\",\"lowercase\",\"|\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"|\",\"list-ul\",\"list-ol\",\"hr\",\"|\",\"link\",\"reference-link\",\"image\",\"code\",\"preformatted-text\",\"code-block\",\"table\",\"datetime\",\"emoji\",\"html-entities\",\"pagebreak\",\"|\",\"goto-line\",\"watch\",\"preview\",\"fullscreen\",\"clear\",\"search\",\"|\",\"help\",\"info\"],simple:[\"undo\",\"redo\",\"|\",\"bold\",\"del\",\"italic\",\"quote\",\"uppercase\",\"lowercase\",\"|\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"|\",\"list-ul\",\"list-ol\",\"hr\",\"|\",\"watch\",\"preview\",\"fullscreen\",\"|\",\"help\",\"info\"],mini:[\"undo\",\"redo\",\"|\",\"watch\",\"preview\",\"|\",\"help\",\"info\"]},t.defaults={mode:\"gfm\",name:\"\",value:\"\",theme:\"\",editorTheme:\"default\",previewTheme:\"\",markdown:\"\",appendMarkdown:\"\",width:\"100%\",height:\"100%\",path:\"./lib/\",pluginPath:\"\",delay:300,autoLoadModules:!0,watch:!0,placeholder:\"Enjoy Markdown! coding now...\",gotoLine:!0,codeFold:!1,autoHeight:!1,autoFocus:!0,autoCloseTags:!0,searchReplace:!0,syncScrolling:!0,readOnly:!1,tabSize:4,indentUnit:4,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,showTrailingSpace:!0,matchBrackets:!0,indentWithTabs:!0,styleSelectedText:!0,matchWordHighlight:!0,styleActiveLine:!0,dialogLockScreen:!0,dialogShowMask:!0,dialogDraggable:!0,dialogMaskBgColor:\"#fff\",dialogMaskOpacity:.1,fontSize:\"13px\",saveHTMLToTextarea:!1,disabledKeyMaps:[],onload:function(){},onresize:function(){},onchange:function(){},onwatch:null,onunwatch:null,onpreviewing:function(){},onpreviewed:function(){},onfullscreen:function(){},onfullscreenExit:function(){},onscroll:function(){},onpreviewscroll:function(){},imageUpload:!1,imageFormats:[\"jpg\",\"jpeg\",\"gif\",\"png\",\"bmp\",\"webp\"],imageUploadURL:\"\",crossDomainUpload:!1,uploadCallbackURL:\"\",toc:!0,tocm:!1,tocTitle:\"\",tocDropdown:!1,tocContainer:\"\",tocStartLevel:1,htmlDecode:!1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0,toolbar:!0,toolbarAutoFixed:!0,toolbarIcons:\"full\",toolbarTitles:{},toolbarHandlers:{ucwords:function(){return t.toolbarHandlers.ucwords},lowercase:function(){return t.toolbarHandlers.lowercase}},toolbarCustomIcons:{lowercase:'<a href=\"javascript:;\" title=\"Lowercase\" unselectable=\"on\"><i class=\"fa\" name=\"lowercase\" style=\"font-size:24px;margin-top: -10px;\">a</i></a>',ucwords:'<a href=\"javascript:;\" title=\"ucwords\" unselectable=\"on\"><i class=\"fa\" name=\"ucwords\" style=\"font-size:20px;margin-top: -3px;\">Aa</i></a>'},toolbarIconsClass:{undo:\"fa-undo\",redo:\"fa-repeat\",bold:\"fa-bold\",del:\"fa-strikethrough\",italic:\"fa-italic\",quote:\"fa-quote-left\",uppercase:\"fa-font\",h1:t.classPrefix+\"bold\",h2:t.classPrefix+\"bold\",h3:t.classPrefix+\"bold\",h4:t.classPrefix+\"bold\",h5:t.classPrefix+\"bold\",h6:t.classPrefix+\"bold\",\"list-ul\":\"fa-list-ul\",\"list-ol\":\"fa-list-ol\",hr:\"fa-minus\",link:\"fa-link\",\"reference-link\":\"fa-anchor\",image:\"fa-picture-o\",code:\"fa-code\",\"preformatted-text\":\"fa-file-code-o\",\"code-block\":\"fa-file-code-o\",table:\"fa-table\",datetime:\"fa-clock-o\",emoji:\"fa-smile-o\",\"html-entities\":\"fa-copyright\",pagebreak:\"fa-newspaper-o\",\"goto-line\":\"fa-terminal\",watch:\"fa-eye-slash\",unwatch:\"fa-eye\",preview:\"fa-desktop\",search:\"fa-search\",fullscreen:\"fa-arrows-alt\",clear:\"fa-eraser\",help:\"fa-question-circle\",info:\"fa-info-circle\"},toolbarIconTexts:{},lang:{name:\"zh-cn\",description:\"开源在线Markdown编辑器<br/>Open source online Markdown editor.\",tocTitle:\"目录\",toolbar:{undo:\"撤销（Ctrl+Z）\",redo:\"重做（Ctrl+Y）\",bold:\"粗体\",del:\"删除线\",italic:\"斜体\",quote:\"引用\",ucwords:\"将每个单词首字母转成大写\",uppercase:\"将所选转换成大写\",lowercase:\"将所选转换成小写\",h1:\"标题1\",h2:\"标题2\",h3:\"标题3\",h4:\"标题4\",h5:\"标题5\",h6:\"标题6\",\"list-ul\":\"无序列表\",\"list-ol\":\"有序列表\",hr:\"横线\",link:\"链接\",\"reference-link\":\"引用链接\",image:\"添加图片\",code:\"行内代码\",\"preformatted-text\":\"预格式文本 / 代码块（缩进风格）\",\"code-block\":\"代码块（多语言风格）\",table:\"添加表格\",datetime:\"日期时间\",emoji:\"Emoji表情\",\"html-entities\":\"HTML实体字符\",pagebreak:\"插入分页符\",\"goto-line\":\"跳转到行\",watch:\"关闭实时预览\",unwatch:\"开启实时预览\",preview:\"全窗口预览HTML（按 Shift + ESC还原）\",fullscreen:\"全屏（按ESC还原）\",clear:\"清空\",search:\"搜索\",help:\"使用帮助\",info:\"关于\"+t.title},buttons:{enter:\"确定\",cancel:\"取消\",close:\"关闭\"},dialog:{link:{title:\"添加链接\",url:\"链接地址\",urlTitle:\"链接标题\",urlEmpty:\"错误：请填写链接地址。\"},referenceLink:{title:\"添加引用链接\",name:\"引用名称\",url:\"链接地址\",urlId:\"链接ID\",urlTitle:\"链接标题\",nameEmpty:\"错误：引用链接的名称不能为空。\",idEmpty:\"错误：请填写引用链接的ID。\",urlEmpty:\"错误：请填写引用链接的URL地址。\"},image:{title:\"添加图片\",url:\"图片地址\",link:\"图片链接\",alt:\"图片描述\",uploadButton:\"本地上传\",imageURLEmpty:\"错误：图片地址不能为空。\",uploadFileEmpty:\"错误：上传的图片不能为空。\",formatNotAllowed:\"错误：只允许上传图片文件，允许上传的图片文件格式有：\"},preformattedText:{title:\"添加预格式文本或代码块\",emptyAlert:\"错误：请填写预格式文本或代码的内容。\"},codeBlock:{title:\"添加代码块\",selectLabel:\"代码语言：\",selectDefaultText:\"请选择代码语言\",otherLanguage:\"其他语言\",unselectedLanguageAlert:\"错误：请选择代码所属的语言类型。\",codeEmptyAlert:\"错误：请填写代码内容。\"},htmlEntities:{title:\"HTML 实体字符\"},help:{title:\"使用帮助\"}}}},t.classNames={tex:t.classPrefix+\"tex\"},t.dialogZindex=99999,t.$katex=null,t.$marked=null,t.$CodeMirror=null,t.$prettyPrint=null;var i,o;t.prototype=t.fn={state:{watching:!1,loaded:!1,preview:!1,fullscreen:!1},init:function(i,o){o=o||{},\"object\"==typeof i&&(o=i);var r=this.classPrefix=t.classPrefix,n=this.settings=e.extend(!0,t.defaults,o);i=\"object\"==typeof i?n.id:i;var a=this.editor=e(\"#\"+i);this.id=i,this.lang=n.lang;var s=this.classNames={textarea:{html:r+\"html-textarea\",markdown:r+\"markdown-textarea\"}};n.pluginPath=\"\"===n.pluginPath?n.path+\"../plugins/\":n.pluginPath,this.state.watching=n.watch?!0:!1,a.hasClass(\"editormd\")||a.addClass(\"editormd\"),a.css({width:\"number\"==typeof n.width?n.width+\"px\":n.width,height:\"number\"==typeof n.height?n.height+\"px\":n.height}),n.autoHeight&&a.css(\"height\",\"auto\");var l=this.markdownTextarea=a.children(\"textarea\");l.length<1&&(a.append(\"<textarea></textarea>\"),l=this.markdownTextarea=a.children(\"textarea\")),l.addClass(s.textarea.markdown).attr(\"placeholder\",n.placeholder),(\"undefined\"==typeof l.attr(\"name\")||\"\"===l.attr(\"name\"))&&l.attr(\"name\",\"\"!==n.name?n.name:i+\"-markdown-doc\");var c=[n.readOnly?\"\":'<a href=\"javascript:;\" class=\"fa fa-close '+r+'preview-close-btn\"></a>',n.saveHTMLToTextarea?'<textarea class=\"'+s.textarea.html+'\" name=\"'+i+'-html-code\"></textarea>':\"\",'<div class=\"'+r+'preview\"><div class=\"markdown-body '+r+'preview-container\"></div></div>','<div class=\"'+r+'container-mask\" style=\"display:block;\"></div>','<div class=\"'+r+'mask\"></div>'].join(\"\\n\");return a.append(c).addClass(r+\"vertical\"),\"\"!==n.theme&&a.addClass(r+\"theme-\"+n.theme),this.mask=a.children(\".\"+r+\"mask\"),this.containerMask=a.children(\".\"+r+\"container-mask\"),\"\"!==n.markdown&&l.val(n.markdown),\"\"!==n.appendMarkdown&&l.val(l.val()+n.appendMarkdown),this.htmlTextarea=a.children(\".\"+s.textarea.html),this.preview=a.children(\".\"+r+\"preview\"),this.previewContainer=this.preview.children(\".\"+r+\"preview-container\"),\"\"!==n.previewTheme&&this.preview.addClass(r+\"preview-theme-\"+n.previewTheme),\"function\"==typeof define&&define.amd&&(\"undefined\"!=typeof katex&&(t.$katex=katex),n.searchReplace&&!n.readOnly&&(t.loadCSS(n.path+\"codemirror/addon/dialog/dialog\"),t.loadCSS(n.path+\"codemirror/addon/search/matchesonscrollbar\"))),\"function\"==typeof define&&define.amd||!n.autoLoadModules?(\"undefined\"!=typeof CodeMirror&&(t.$CodeMirror=CodeMirror),\"undefined\"!=typeof marked&&(t.$marked=marked),this.setCodeMirror().setToolbar().loadedDisplay()):this.loadQueues(),this},loadQueues:function(){var e=this,i=this.settings,o=i.path,r=function(){return t.isIE8?void e.loadedDisplay():void(i.flowChart||i.sequenceDiagram?t.loadScript(o+\"raphael.min\",function(){t.loadScript(o+\"underscore.min\",function(){!i.flowChart&&i.sequenceDiagram?t.loadScript(o+\"sequence-diagram.min\",function(){e.loadedDisplay()}):i.flowChart&&!i.sequenceDiagram?t.loadScript(o+\"flowchart.min\",function(){t.loadScript(o+\"jquery.flowchart.min\",function(){e.loadedDisplay()})}):i.flowChart&&i.sequenceDiagram&&t.loadScript(o+\"flowchart.min\",function(){t.loadScript(o+\"jquery.flowchart.min\",function(){t.loadScript(o+\"sequence-diagram.min\",function(){e.loadedDisplay()})})})})}):e.loadedDisplay())};return t.loadCSS(o+\"codemirror/codemirror.min\"),i.searchReplace&&!i.readOnly&&(t.loadCSS(o+\"codemirror/addon/dialog/dialog\"),t.loadCSS(o+\"codemirror/addon/search/matchesonscrollbar\")),i.codeFold&&t.loadCSS(o+\"codemirror/addon/fold/foldgutter\"),t.loadScript(o+\"codemirror/codemirror.min\",function(){t.$CodeMirror=CodeMirror,t.loadScript(o+\"codemirror/modes.min\",function(){t.loadScript(o+\"codemirror/addons.min\",function(){return e.setCodeMirror(),\"gfm\"!==i.mode&&\"markdown\"!==i.mode?(e.loadedDisplay(),!1):(e.setToolbar(),void t.loadScript(o+\"marked.min\",function(){t.$marked=marked,i.previewCodeHighlight?t.loadScript(o+\"prettify.min\",function(){r()}):r()}))})})}),this},setTheme:function(e){var t=this.editor,i=this.settings.theme,o=this.classPrefix+\"theme-\";return t.removeClass(o+i).addClass(o+e),this.settings.theme=e,this},setEditorTheme:function(e){var i=this.settings;return i.editorTheme=e,\"default\"!==e&&t.loadCSS(i.path+\"codemirror/theme/\"+i.editorTheme),this.cm.setOption(\"theme\",e),this},setCodeMirrorTheme:function(e){return this.setEditorTheme(e),this},setPreviewTheme:function(e){var t=this.preview,i=this.settings.previewTheme,o=this.classPrefix+\"preview-theme-\";return t.removeClass(o+i).addClass(o+e),this.settings.previewTheme=e,this},setCodeMirror:function(){var e=this.settings,i=this.editor;\"default\"!==e.editorTheme&&t.loadCSS(e.path+\"codemirror/theme/\"+e.editorTheme);var o={mode:e.mode,theme:e.editorTheme,tabSize:e.tabSize,dragDrop:!1,autofocus:e.autoFocus,autoCloseTags:e.autoCloseTags,readOnly:e.readOnly?\"nocursor\":!1,indentUnit:e.indentUnit,lineNumbers:e.lineNumbers,lineWrapping:e.lineWrapping,extraKeys:{\"Ctrl-Q\":function(e){e.foldCode(e.getCursor())}},foldGutter:e.codeFold,gutters:[\"CodeMirror-linenumbers\",\"CodeMirror-foldgutter\"],matchBrackets:e.matchBrackets,indentWithTabs:e.indentWithTabs,styleActiveLine:e.styleActiveLine,styleSelectedText:e.styleSelectedText,autoCloseBrackets:e.autoCloseBrackets,showTrailingSpace:e.showTrailingSpace,highlightSelectionMatches:e.matchWordHighlight?{showToken:\"onselected\"===e.matchWordHighlight?!1:/\\w/}:!1};return this.codeEditor=this.cm=t.$CodeMirror.fromTextArea(this.markdownTextarea[0],o),this.codeMirror=this.cmElement=i.children(\".CodeMirror\"),\"\"!==e.value&&this.cm.setValue(e.value),this.codeMirror.css({fontSize:e.fontSize,width:e.watch?\"50%\":\"100%\"}),e.autoHeight&&(this.codeMirror.css(\"height\",\"auto\"),this.cm.setOption(\"viewportMargin\",1/0)),e.lineNumbers||this.codeMirror.find(\".CodeMirror-gutters\").css(\"border-right\",\"none\"),this},getCodeMirrorOption:function(e){return this.cm.getOption(e)},setCodeMirrorOption:function(e,t){return this.cm.setOption(e,t),this},addKeyMap:function(e,t){return this.cm.addKeyMap(e,t),this},removeKeyMap:function(e){return this.cm.removeKeyMap(e),this},gotoLine:function(t){var i=this.settings;if(!i.gotoLine)return this;var o=this.cm,r=(this.editor,o.lineCount()),n=this.preview;if(\"string\"==typeof t&&(\"last\"===t&&(t=r),\"first\"===t&&(t=1)),\"number\"!=typeof t)return alert(\"Error: The line number must be an integer.\"),this;if(t=parseInt(t)-1,t>r)return alert(\"Error: The line number range 1-\"+r),this;o.setCursor({line:t,ch:0});var a=o.getScrollInfo(),s=a.clientHeight,l=o.charCoords({line:t,ch:0},\"local\");if(o.scrollTo(null,(l.top+l.bottom-s)/2),i.watch){var c=this.codeMirror.find(\".CodeMirror-scroll\")[0],h=e(c).height(),d=c.scrollTop,u=d/c.scrollHeight;n.scrollTop(0===d?0:d+h>=c.scrollHeight-16?n[0].scrollHeight:n[0].scrollHeight*u)}return o.focus(),this},extend:function(){return\"undefined\"!=typeof arguments[1]&&(\"function\"==typeof arguments[1]&&(arguments[1]=e.proxy(arguments[1],this)),this[arguments[0]]=arguments[1]),\"object\"==typeof arguments[0]&&\"undefined\"==typeof arguments[0].length&&e.extend(!0,this,arguments[0]),this},set:function(t,i){return\"undefined\"!=typeof i&&\"function\"==typeof i&&(i=e.proxy(i,this)),this[t]=i,this},config:function(t,i){var o=this.settings;return\"object\"==typeof t&&(o=e.extend(!0,o,t)),\"string\"==typeof t&&(o[t]=i),this.settings=o,this.recreate(),this},on:function(t,i){var o=this.settings;return\"undefined\"!=typeof o[\"on\"+t]&&(o[\"on\"+t]=e.proxy(i,this)),this},off:function(e){var t=this.settings;return\"undefined\"!=typeof t[\"on\"+e]&&(t[\"on\"+e]=function(){}),this},showToolbar:function(t){var i=this.settings;return i.readOnly?this:(i.toolbar&&(this.toolbar.length<1||\"\"===this.toolbar.find(\".\"+this.classPrefix+\"menu\").html())&&this.setToolbar(),i.toolbar=!0,this.toolbar.show(),this.resize(),e.proxy(t||function(){},this)(),this)},hideToolbar:function(t){var i=this.settings;return i.toolbar=!1,this.toolbar.hide(),this.resize(),e.proxy(t||function(){},this)(),this},setToolbarAutoFixed:function(t){var i=this.state,o=this.editor,r=this.toolbar,n=this.settings;\"undefined\"!=typeof t&&(n.toolbarAutoFixed=t);var a=function(){var t=e(window),i=t.scrollTop();return n.toolbarAutoFixed?void r.css(i-o.offset().top>10&&i<o.height()?{position:\"fixed\",width:o.width()+\"px\",left:(t.width()-o.width())/2+\"px\"}:{position:\"absolute\",width:\"100%\",left:0}):!1};return!i.fullscreen&&!i.preview&&n.toolbar&&n.toolbarAutoFixed&&e(window).bind(\"scroll\",a),this},setToolbar:function(){var e=this.settings;if(e.readOnly)return this;var i=this.editor,o=(this.preview,this.classPrefix),r=this.toolbar=i.children(\".\"+o+\"toolbar\");if(e.toolbar&&r.length<1){var n='<div class=\"'+o+'toolbar\"><div class=\"'+o+'toolbar-container\"><ul class=\"'+o+'menu\"></ul></div></div>';i.append(n),r=this.toolbar=i.children(\".\"+o+\"toolbar\")}if(!e.toolbar)return r.hide(),this;r.show();for(var a=\"function\"==typeof e.toolbarIcons?e.toolbarIcons():\"string\"==typeof e.toolbarIcons?t.toolbarModes[e.toolbarIcons]:e.toolbarIcons,s=r.find(\".\"+this.classPrefix+\"menu\"),l=\"\",c=!1,h=0,d=a.length;d>h;h++){var u=a[h];if(\"||\"===u)c=!0;else if(\"|\"===u)l+='<li class=\"divider\" unselectable=\"on\">|</li>';else{var f=/h(\\d)/.test(u),g=u;\"watch\"!==u||e.watch||(g=\"unwatch\");var p=e.lang.toolbar[g],m=e.toolbarIconTexts[g],w=e.toolbarIconsClass[g];p=\"undefined\"==typeof p?\"\":p,m=\"undefined\"==typeof m?\"\":m,w=\"undefined\"==typeof w?\"\":w;var v=c?'<li class=\"pull-right\">':\"<li>\";\"undefined\"!=typeof e.toolbarCustomIcons[u]&&\"function\"!=typeof e.toolbarCustomIcons[u]?v+=e.toolbarCustomIcons[u]:(v+='<a href=\"javascript:;\" title=\"'+p+'\" unselectable=\"on\">',v+='<i class=\"fa '+w+'\" name=\"'+u+'\" unselectable=\"on\">'+(f?u.toUpperCase():\"\"===w?m:\"\")+\"</i>\",v+=\"</a>\"),v+=\"</li>\",l=c?v+l:l+v}}return s.html(l),s.find('[title=\"Lowercase\"]').attr(\"title\",e.lang.toolbar.lowercase),s.find('[title=\"ucwords\"]').attr(\"title\",e.lang.toolbar.ucwords),this.setToolbarHandler(),this.setToolbarAutoFixed(),this},dialogLockScreen:function(){return e.proxy(t.dialogLockScreen,this)(),this},dialogShowMask:function(i){return e.proxy(t.dialogShowMask,this)(i),this},getToolbarHandles:function(e){var i=this.toolbarHandlers=t.toolbarHandlers;return e&&\"undefined\"!=typeof toolbarIconHandlers[e]?i[e]:i},setToolbarHandler:function(){var i=this,o=this.settings;if(!o.toolbar||o.readOnly)return this;var r=this.toolbar,n=this.cm,a=this.classPrefix,s=this.toolbarIcons=r.find(\".\"+a+\"menu > li > a\"),l=this.getToolbarHandles();return s.bind(t.mouseOrTouch(\"click\",\"touchend\"),function(t){var r=e(this).children(\".fa\"),a=r.attr(\"name\"),s=n.getCursor(),c=n.getSelection();return\"\"!==a?(i.activeIcon=r,\"undefined\"!=typeof l[a]?e.proxy(l[a],i)(n):\"undefined\"!=typeof o.toolbarHandlers[a]&&e.proxy(o.toolbarHandlers[a],i)(n,r,s,c),\"link\"!==a&&\"reference-link\"!==a&&\"image\"!==a&&\"code-block\"!==a&&\"preformatted-text\"!==a&&\"watch\"!==a&&\"preview\"!==a&&\"search\"!==a&&\"fullscreen\"!==a&&\"info\"!==a&&n.focus(),!1):void 0}),this},createDialog:function(i){return e.proxy(t.createDialog,this)(i)},createInfoDialog:function(){var e=this,i=this.editor,o=this.classPrefix,r=['<div class=\"'+o+\"dialog \"+o+'dialog-info\" style=\"\">','<div class=\"'+o+'dialog-container\">','<h1><i class=\"editormd-logo editormd-logo-lg editormd-logo-color\"></i> '+t.title+\"<small>v\"+t.version+\"</small></h1>\",\"<p>\"+this.lang.description+\"</p>\",'<p style=\"margin: 10px 0 20px 0;\"><a href=\"'+t.homePage+'\" target=\"_blank\">'+t.homePage+' <i class=\"fa fa-external-link\"></i></a></p>','<p style=\"font-size: 0.85em;\">Copyright &copy; 2015 <a href=\"https://github.com/pandao\" target=\"_blank\" class=\"hover-link\">Pandao</a>, The <a href=\"https://github.com/pandao/editor.md/blob/master/LICENSE\" target=\"_blank\" class=\"hover-link\">MIT</a> License.</p>',\"</div>\",'<a href=\"javascript:;\" class=\"fa fa-close '+o+'dialog-close\"></a>',\"</div>\"].join(\"\\n\");i.append(r);var n=this.infoDialog=i.children(\".\"+o+\"dialog-info\");return n.find(\".\"+o+\"dialog-close\").bind(t.mouseOrTouch(\"click\",\"touchend\"),function(){e.hideInfoDialog()}),n.css(\"border\",t.isIE8?\"1px solid #ddd\":\"\").css(\"z-index\",t.dialogZindex).show(),this.infoDialogPosition(),this},infoDialogPosition:function(){var t=this.infoDialog,i=function(){t.css({top:(e(window).height()-t.height())/2+\"px\",left:(e(window).width()-t.width())/2+\"px\"})};return i(),e(window).resize(i),this},showInfoDialog:function(){e(\"html,body\").css(\"overflow-x\",\"hidden\");var i=this.editor,o=this.settings,r=this.infoDialog=i.children(\".\"+this.classPrefix+\"dialog-info\");return r.length<1&&this.createInfoDialog(),this.lockScreen(!0),this.mask.css({opacity:o.dialogMaskOpacity,backgroundColor:o.dialogMaskBgColor}).show(),r.css(\"z-index\",t.dialogZindex).show(),this.infoDialogPosition(),this},hideInfoDialog:function(){return e(\"html,body\").css(\"overflow-x\",\"\"),this.infoDialog.hide(),this.mask.hide(),this.lockScreen(!1),this},lockScreen:function(e){return t.lockScreen(e),this.resize(),this},recreate:function(){var e=this.editor,t=this.settings;return this.codeMirror.remove(),this.setCodeMirror(),t.readOnly||(e.find(\".editormd-dialog\").length>0&&e.find(\".editormd-dialog\").remove(),t.toolbar&&(this.getToolbarHandles(),this.setToolbar())),this.loadedDisplay(!0),this},previewCodeHighlight:function(){var e=this.settings,t=this.previewContainer;return e.previewCodeHighlight&&(t.find(\"pre\").addClass(\"prettyprint linenums\"),\"undefined\"!=typeof prettyPrint&&prettyPrint()),this},katexRender:function(){return null===i?this:(this.previewContainer.find(\".\"+t.classNames.tex).each(function(){var i=e(this);t.$katex.render(i.text(),i[0]),i.find(\".katex\").css(\"font-size\",\"1.6em\")}),this)},flowChartAndSequenceDiagramRender:function(){var i=this,r=this.settings,n=this.previewContainer;if(t.isIE8)return this;if(r.flowChart){if(null===o)return this;n.find(\".flowchart\").flowChart()}r.sequenceDiagram&&n.find(\".sequence-diagram\").sequenceDiagram({theme:\"simple\"});var a=i.preview,s=i.codeMirror,l=s.find(\".CodeMirror-scroll\"),c=l.height(),h=l.scrollTop(),d=h/l[0].scrollHeight,u=0;a.find(\".markdown-toc-list\").each(function(){u+=e(this).height()});var f=a.find(\".editormd-toc-menu\").height();return f=f?f:0,a.scrollTop(0===h?0:h+c>=l[0].scrollHeight-16?a[0].scrollHeight:(a[0].scrollHeight+u+f)*d),this},registerKeyMaps:function(i){var o=this,r=this.cm,n=this.settings,a=t.toolbarHandlers,s=n.disabledKeyMaps;if(i=i||null){for(var l in i)if(e.inArray(l,s)<0){var c={};c[l]=i[l],r.addKeyMap(i)}}else{for(var h in t.keyMaps){var d=t.keyMaps[h],u=\"string\"==typeof d?e.proxy(a[d],o):e.proxy(d,o);if(e.inArray(h,[\"F9\",\"F10\",\"F11\"])<0&&e.inArray(h,s)<0){var f={};f[h]=u,r.addKeyMap(f)}}e(window).keydown(function(t){var i={120:\"F9\",121:\"F10\",122:\"F11\"};if(e.inArray(i[t.keyCode],s)<0)switch(t.keyCode){case 120:return e.proxy(a.watch,o)(),!1;case 121:return e.proxy(a.preview,o)(),!1;case 122:return e.proxy(a.fullscreen,o)(),!1}})}return this},bindScrollEvent:function(){var i=this,o=this.preview,r=this.settings,n=this.codeMirror,a=t.mouseOrTouch;if(!r.syncScrolling)return this;var s=function(){n.find(\".CodeMirror-scroll\").bind(a(\"scroll\",\"touchmove\"),function(t){var n=e(this).height(),a=e(this).scrollTop(),s=a/e(this)[0].scrollHeight,l=0;o.find(\".markdown-toc-list\").each(function(){l+=e(this).height()});var c=o.find(\".editormd-toc-menu\").height();c=c?c:0,o.scrollTop(0===a?0:a+n>=e(this)[0].scrollHeight-16?o[0].scrollHeight:(o[0].scrollHeight+l+c)*s),e.proxy(r.onscroll,i)(t)})},l=function(){n.find(\".CodeMirror-scroll\").unbind(a(\"scroll\",\"touchmove\"))},c=function(){o.bind(a(\"scroll\",\"touchmove\"),function(t){var o=e(this).height(),a=e(this).scrollTop(),s=a/e(this)[0].scrollHeight,l=n.find(\".CodeMirror-scroll\");l.scrollTop(0===a?0:a+o>=e(this)[0].scrollHeight?l[0].scrollHeight:l[0].scrollHeight*s),e.proxy(r.onpreviewscroll,i)(t)})},h=function(){o.unbind(a(\"scroll\",\"touchmove\"))};return n.bind({mouseover:s,mouseout:l,touchstart:s,touchend:l}),\"single\"===r.syncScrolling?this:(o.bind({mouseover:c,mouseout:h,touchstart:c,touchend:h}),this)},bindChangeEvent:function(){var e=this,t=this.cm,o=this.settings;return o.syncScrolling?(t.on(\"change\",function(t,r){o.watch&&e.previewContainer.css(\"padding\",o.autoHeight?\"20px 20px 50px 40px\":\"20px\"),i=setTimeout(function(){clearTimeout(i),e.save(),i=null},o.delay)}),this):this},loadedDisplay:function(t){t=t||!1;var i=this,o=this.editor,r=this.preview,n=this.settings;return this.containerMask.hide(),this.save(),n.watch&&r.show(),o.data(\"oldWidth\",o.width()).data(\"oldHeight\",o.height()),this.resize(),this.registerKeyMaps(),e(window).resize(function(){i.resize()}),this.bindScrollEvent().bindChangeEvent(),t||e.proxy(n.onload,this)(),this.state.loaded=!0,this},width:function(e){return this.editor.css(\"width\",\"number\"==typeof e?e+\"px\":e),this.resize(),this},height:function(e){return this.editor.css(\"height\",\"number\"==typeof e?e+\"px\":e),this.resize(),this},resize:function(t,i){t=t||null,i=i||null;var o=this.state,r=this.editor,n=this.preview,a=this.toolbar,s=this.settings,l=this.codeMirror;if(t&&r.css(\"width\",\"number\"==typeof t?t+\"px\":t),!s.autoHeight||o.fullscreen||o.preview?(i&&r.css(\"height\",\"number\"==typeof i?i+\"px\":i),o.fullscreen&&r.height(e(window).height()),s.toolbar&&!s.readOnly?l.css(\"margin-top\",a.height()+1).height(r.height()-a.height()):l.css(\"margin-top\",0).height(r.height())):(r.css(\"height\",\"auto\"),l.css(\"height\",\"auto\")),s.watch)if(l.width(r.width()/2),n.width(o.preview?r.width():r.width()/2),this.previewContainer.css(\"padding\",s.autoHeight?\"20px 20px 50px 40px\":\"20px\"),s.toolbar&&!s.readOnly?n.css(\"top\",a.height()+1):n.css(\"top\",0),!s.autoHeight||o.fullscreen||o.preview){var c=s.toolbar&&!s.readOnly?r.height()-a.height():r.height();n.height(c)}else n.height(\"\");else l.width(r.width()),n.hide();return o.loaded&&e.proxy(s.onresize,this)(),this},save:function(){if(null===i)return this;var r=this,n=this.state,a=this.settings,s=this.cm,l=s.getValue(),c=this.previewContainer;if(\"gfm\"!==a.mode&&\"markdown\"!==a.mode)return this.markdownTextarea.val(l),this;var h=t.$marked,d=this.markdownToC=[],u=this.markedRendererOptions={toc:a.toc,tocm:a.tocm,tocStartLevel:a.tocStartLevel,pageBreak:a.pageBreak,taskList:a.taskList,emoji:a.emoji,tex:a.tex,atLink:a.atLink,emailLink:a.emailLink,flowChart:a.flowChart,sequenceDiagram:a.sequenceDiagram,previewCodeHighlight:a.previewCodeHighlight},f=this.markedOptions={renderer:t.markedRenderer(d,u),gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:a.htmlDecode?!1:!0,smartLists:!0,smartypants:!0};h.setOptions(f);var g=t.$marked(l,f);if(g=t.filterHTMLTags(g,a.htmlDecode),this.markdownTextarea.text(l),s.save(),a.saveHTMLToTextarea&&this.htmlTextarea.text(g),a.watch||!a.watch&&n.preview){if(c.html(g),this.previewCodeHighlight(),a.toc){var p=\"\"===a.tocContainer?c:e(a.tocContainer),m=p.find(\".\"+this.classPrefix+\"toc-menu\");p.attr(\"previewContainer\",\"\"===a.tocContainer?\"true\":\"false\"),\"\"!==a.tocContainer&&m.length>0&&m.remove(),t.markdownToCRenderer(d,p,a.tocDropdown,a.tocStartLevel),(a.tocDropdown||p.find(\".\"+this.classPrefix+\"toc-menu\").length>0)&&t.tocDropdownMenu(p,\"\"!==a.tocTitle?a.tocTitle:this.lang.tocTitle),\"\"!==a.tocContainer&&c.find(\".markdown-toc\").css(\"border\",\"none\")}a.tex&&(!t.kaTeXLoaded&&a.autoLoadModules?t.loadKaTeX(function(){t.$katex=katex,t.kaTeXLoaded=!0,r.katexRender()}):(t.$katex=katex,this.katexRender())),(a.flowChart||a.sequenceDiagram)&&(o=setTimeout(function(){clearTimeout(o),r.flowChartAndSequenceDiagramRender(),o=null},10)),n.loaded&&e.proxy(a.onchange,this)()}return this},focus:function(){return this.cm.focus(),this},setCursor:function(e){return this.cm.setCursor(e),this},getCursor:function(){return this.cm.getCursor()},setSelection:function(e,t){return this.cm.setSelection(e,t),this},getSelection:function(){return this.cm.getSelection()},setSelections:function(e){return this.cm.setSelections(e),this},getSelections:function(){return this.cm.getSelections()},replaceSelection:function(e){return this.cm.replaceSelection(e),this},insertValue:function(e){return this.replaceSelection(e),this},appendMarkdown:function(e){var t=(this.settings,this.cm);return t.setValue(t.getValue()+e),this},setMarkdown:function(e){return this.cm.setValue(e||this.settings.markdown),this},getMarkdown:function(){return this.cm.getValue()},getValue:function(){return this.cm.getValue()},setValue:function(e){return this.cm.setValue(e),this},clear:function(){return this.cm.setValue(\"\"),this},getHTML:function(){return this.settings.saveHTMLToTextarea?this.htmlTextarea.val():(alert(\"Error: settings.saveHTMLToTextarea == false\"),!1)},getTextareaSavedHTML:function(){return this.getHTML()},getPreviewedHTML:function(){return this.settings.watch?this.previewContainer.html():(alert(\"Error: settings.watch == false\"),!1)},watch:function(t){var o=this.settings;if(e.inArray(o.mode,[\"gfm\",\"markdown\"])<0)return this;if(this.state.watching=o.watch=!0,this.preview.show(),this.toolbar){var r=o.toolbarIconsClass.watch,n=o.toolbarIconsClass.unwatch,a=this.toolbar.find(\".fa[name=watch]\");a.parent().attr(\"title\",o.lang.toolbar.watch),a.removeClass(n).addClass(r)}return this.codeMirror.css(\"border-right\",\"1px solid #ddd\").width(this.editor.width()/2),i=0,this.save().resize(),o.onwatch||(o.onwatch=t||function(){}),e.proxy(o.onwatch,this)(),this},unwatch:function(t){var i=this.settings;if(this.state.watching=i.watch=!1,this.preview.hide(),this.toolbar){var o=i.toolbarIconsClass.watch,r=i.toolbarIconsClass.unwatch,n=this.toolbar.find(\".fa[name=watch]\");n.parent().attr(\"title\",i.lang.toolbar.unwatch),n.removeClass(o).addClass(r)}return this.codeMirror.css(\"border-right\",\"none\").width(this.editor.width()),this.resize(),i.onunwatch||(i.onunwatch=t||function(){}),e.proxy(i.onunwatch,this)(),this},show:function(t){t=t||function(){};var i=this;return this.editor.show(0,function(){e.proxy(t,i)()}),this},hide:function(t){t=t||function(){};var i=this;return this.editor.hide(0,function(){e.proxy(t,i)()}),this},previewing:function(){var i=this,o=this.editor,r=this.preview,n=this.toolbar,a=this.settings,s=this.codeMirror,l=this.previewContainer;if(e.inArray(a.mode,[\"gfm\",\"markdown\"])<0)return this;a.toolbar&&n&&(n.toggle(),n.find(\".fa[name=preview]\").toggleClass(\"active\")),s.toggle();var c=function(e){e.shiftKey&&27===e.keyCode&&i.previewed()};\"none\"===s.css(\"display\")?(this.state.preview=!0,this.state.fullscreen&&r.css(\"background\",\"#fff\"),o.find(\".\"+this.classPrefix+\"preview-close-btn\").show().bind(t.mouseOrTouch(\"click\",\"touchend\"),function(){i.previewed()}),a.watch?l.css(\"padding\",\"\"):this.save(),l.addClass(this.classPrefix+\"preview-active\"),r.show().css({position:\"\",top:0,width:o.width(),height:a.autoHeight&&!this.state.fullscreen?\"auto\":o.height()}),this.state.loaded&&e.proxy(a.onpreviewing,this)(),e(window).bind(\"keyup\",c)):(e(window).unbind(\"keyup\",c),this.previewed())},previewed:function(){var i=this.editor,o=this.preview,r=this.toolbar,n=this.settings,a=this.previewContainer,s=i.find(\".\"+this.classPrefix+\"preview-close-btn\");return this.state.preview=!1,this.codeMirror.show(),n.toolbar&&r.show(),o[n.watch?\"show\":\"hide\"](),s.hide().unbind(t.mouseOrTouch(\"click\",\"touchend\")),a.removeClass(this.classPrefix+\"preview-active\"),n.watch&&a.css(\"padding\",\"20px\"),o.css({background:null,position:\"absolute\",width:i.width()/2,height:n.autoHeight&&!this.state.fullscreen?\"auto\":i.height()-r.height(),top:n.toolbar?r.height():0}),this.state.loaded&&e.proxy(n.onpreviewed,this)(),this},fullscreen:function(){var t=this,i=this.state,o=this.editor,r=(this.preview,this.toolbar),n=this.settings,a=this.classPrefix+\"fullscreen\";r&&r.find(\".fa[name=fullscreen]\").parent().toggleClass(\"active\");var s=function(e){e.shiftKey||27!==e.keyCode||i.fullscreen&&t.fullscreenExit()};return o.hasClass(a)?(e(window).unbind(\"keyup\",s),this.fullscreenExit()):(i.fullscreen=!0,e(\"html,body\").css(\"overflow\",\"hidden\"),o.css({width:e(window).width(),height:e(window).height()}).addClass(a),this.resize(),e.proxy(n.onfullscreen,this)(),e(window).bind(\"keyup\",s)),this},fullscreenExit:function(){var t=this.editor,i=this.settings,o=this.toolbar,r=this.classPrefix+\"fullscreen\";return this.state.fullscreen=!1,o&&o.find(\".fa[name=fullscreen]\").parent().removeClass(\"active\"),e(\"html,body\").css(\"overflow\",\"\"),t.css({width:t.data(\"oldWidth\"),height:t.data(\"oldHeight\")}).removeClass(r),this.resize(),e.proxy(i.onfullscreenExit,this)(),this},executePlugin:function(i,o){var r=this,n=this.cm,a=this.settings;return o=a.pluginPath+o,\"function\"==typeof define?\"undefined\"==typeof this[i]?(alert(\"Error: \"+i+\" plugin is not found, you are not load this plugin.\"),this):(this[i](n),this):(e.inArray(o,t.loadFiles.plugin)<0?t.loadPlugin(o,function(){t.loadPlugins[i]=r[i],r[i](n)}):e.proxy(t.loadPlugins[i],this)(n),this)},search:function(e){var t=this.settings;return t.searchReplace?(t.readOnly||this.cm.execCommand(e||\"find\"),this):(alert(\"Error: settings.searchReplace == false\"),this)},searchReplace:function(){return this.search(\"replace\"),this},searchReplaceAll:function(){return this.search(\"replaceAll\"),this}},t.fn.init.prototype=t.fn,t.dialogLockScreen=function(){var t=this.settings||{dialogLockScreen:!0};t.dialogLockScreen&&(e(\"html,body\").css(\"overflow\",\"hidden\"),this.resize())},t.dialogShowMask=function(t){var i=this.editor,o=this.settings||{dialogShowMask:!0};t.css({top:(e(window).height()-t.height())/2+\"px\",left:(e(window).width()-t.width())/2+\"px\"}),o.dialogShowMask&&i.children(\".\"+this.classPrefix+\"mask\").css(\"z-index\",parseInt(t.css(\"z-index\"))-1).show()},t.toolbarHandlers={undo:function(){this.cm.undo()},redo:function(){this.cm.redo()},bold:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();\n\ne.replaceSelection(\"**\"+i+\"**\"),\"\"===i&&e.setCursor(t.line,t.ch+2)},del:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"~~\"+i+\"~~\"),\"\"===i&&e.setCursor(t.line,t.ch+2)},italic:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"*\"+i+\"*\"),\"\"===i&&e.setCursor(t.line,t.ch+1)},quote:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"> \"+i),e.setCursor(t.line,t.ch+2)):e.replaceSelection(\"> \"+i)},ucfirst:function(){var e=this.cm,i=e.getSelection(),o=e.listSelections();e.replaceSelection(t.firstUpperCase(i)),e.setSelections(o)},ucwords:function(){var e=this.cm,i=e.getSelection(),o=e.listSelections();e.replaceSelection(t.wordsFirstUpperCase(i)),e.setSelections(o)},uppercase:function(){var e=this.cm,t=e.getSelection(),i=e.listSelections();e.replaceSelection(t.toUpperCase()),e.setSelections(i)},lowercase:function(){var e=this.cm,t=(e.getCursor(),e.getSelection()),i=e.listSelections();e.replaceSelection(t.toLowerCase()),e.setSelections(i)},h1:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"# \"+i),e.setCursor(t.line,t.ch+2)):e.replaceSelection(\"# \"+i)},h2:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"## \"+i),e.setCursor(t.line,t.ch+3)):e.replaceSelection(\"## \"+i)},h3:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"### \"+i),e.setCursor(t.line,t.ch+4)):e.replaceSelection(\"### \"+i)},h4:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"#### \"+i),e.setCursor(t.line,t.ch+5)):e.replaceSelection(\"#### \"+i)},h5:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"##### \"+i),e.setCursor(t.line,t.ch+6)):e.replaceSelection(\"##### \"+i)},h6:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"###### \"+i),e.setCursor(t.line,t.ch+7)):e.replaceSelection(\"###### \"+i)},\"list-ul\":function(){var e=this.cm,t=(e.getCursor(),e.getSelection());if(\"\"===t)e.replaceSelection(\"- \"+t);else{for(var i=t.split(\"\\n\"),o=0,r=i.length;r>o;o++)i[o]=\"\"===i[o]?\"\":\"- \"+i[o];e.replaceSelection(i.join(\"\\n\"))}},\"list-ol\":function(){var e=this.cm,t=(e.getCursor(),e.getSelection());if(\"\"===t)e.replaceSelection(\"1. \"+t);else{for(var i=t.split(\"\\n\"),o=0,r=i.length;r>o;o++)i[o]=\"\"===i[o]?\"\":o+1+\". \"+i[o];e.replaceSelection(i.join(\"\\n\"))}},hr:function(){{var e=this.cm,t=e.getCursor();e.getSelection()}e.replaceSelection((0!==t.ch?\"\\n\\n\":\"\\n\")+\"------------\\n\\n\")},tex:function(){if(!this.settings.tex)return alert(\"settings.tex === false\"),this;var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"$$\"+i+\"$$\"),\"\"===i&&e.setCursor(t.line,t.ch+2)},link:function(){this.executePlugin(\"linkDialog\",\"link-dialog/link-dialog\")},\"reference-link\":function(){this.executePlugin(\"referenceLinkDialog\",\"reference-link-dialog/reference-link-dialog\")},pagebreak:function(){if(!this.settings.pageBreak)return alert(\"settings.pageBreak === false\"),this;{var e=this.cm;e.getSelection()}e.replaceSelection(\"\\r\\n[========]\\r\\n\")},image:function(){this.executePlugin(\"imageDialog\",\"image-dialog/image-dialog\")},code:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"`\"+i+\"`\"),\"\"===i&&e.setCursor(t.line,t.ch+1)},\"code-block\":function(){this.executePlugin(\"codeBlockDialog\",\"code-block-dialog/code-block-dialog\")},\"preformatted-text\":function(){this.executePlugin(\"preformattedTextDialog\",\"preformatted-text-dialog/preformatted-text-dialog\")},table:function(){this.executePlugin(\"tableDialog\",\"table-dialog/table-dialog\")},datetime:function(){var e=this.cm,i=(e.getSelection(),new Date,this.settings.lang.name),o=t.dateFormat()+\" \"+t.dateFormat(\"zh-cn\"===i||\"zh-tw\"===i?\"cn-week-day\":\"week-day\");e.replaceSelection(o)},emoji:function(){this.executePlugin(\"emojiDialog\",\"emoji-dialog/emoji-dialog\")},\"html-entities\":function(){this.executePlugin(\"htmlEntitiesDialog\",\"html-entities-dialog/html-entities-dialog\")},\"goto-line\":function(){this.executePlugin(\"gotoLineDialog\",\"goto-line-dialog/goto-line-dialog\")},watch:function(){this[this.settings.watch?\"unwatch\":\"watch\"]()},preview:function(){this.previewing()},fullscreen:function(){this.fullscreen()},clear:function(){this.clear()},search:function(){this.search()},help:function(){this.executePlugin(\"helpDialog\",\"help-dialog/help-dialog\")},info:function(){this.showInfoDialog()}},t.keyMaps={\"Ctrl-1\":\"h1\",\"Ctrl-2\":\"h2\",\"Ctrl-3\":\"h3\",\"Ctrl-4\":\"h4\",\"Ctrl-5\":\"h5\",\"Ctrl-6\":\"h6\",\"Ctrl-B\":\"bold\",\"Ctrl-D\":\"datetime\",\"Ctrl-E\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();return this.settings.emoji?(e.replaceSelection(\":\"+i+\":\"),void(\"\"===i&&e.setCursor(t.line,t.ch+1))):void alert(\"Error: settings.emoji == false\")},\"Ctrl-Alt-G\":\"goto-line\",\"Ctrl-H\":\"hr\",\"Ctrl-I\":\"italic\",\"Ctrl-K\":\"code\",\"Ctrl-L\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection(),o=\"\"===i?\"\":' \"'+i+'\"';e.replaceSelection(\"[\"+i+\"](\"+o+\")\"),\"\"===i&&e.setCursor(t.line,t.ch+1)},\"Ctrl-U\":\"list-ul\",\"Shift-Ctrl-A\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();return this.settings.atLink?(e.replaceSelection(\"@\"+i),void(\"\"===i&&e.setCursor(t.line,t.ch+1))):void alert(\"Error: settings.atLink == false\")},\"Shift-Ctrl-C\":\"code\",\"Shift-Ctrl-Q\":\"quote\",\"Shift-Ctrl-S\":\"del\",\"Shift-Ctrl-K\":\"tex\",\"Shift-Alt-C\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection([\"```\",i,\"```\"].join(\"\\n\")),\"\"===i&&e.setCursor(t.line,t.ch+3)},\"Shift-Ctrl-Alt-C\":\"code-block\",\"Shift-Ctrl-H\":\"html-entities\",\"Shift-Alt-H\":\"help\",\"Shift-Ctrl-E\":\"emoji\",\"Shift-Ctrl-U\":\"uppercase\",\"Shift-Alt-U\":\"ucwords\",\"Shift-Ctrl-Alt-U\":\"ucfirst\",\"Shift-Alt-L\":\"lowercase\",\"Shift-Ctrl-I\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection(),o=\"\"===i?\"\":' \"'+i+'\"';e.replaceSelection(\"![\"+i+\"](\"+o+\")\"),\"\"===i&&e.setCursor(t.line,t.ch+4)},\"Shift-Ctrl-Alt-I\":\"image\",\"Shift-Ctrl-L\":\"link\",\"Shift-Ctrl-O\":\"list-ol\",\"Shift-Ctrl-P\":\"preformatted-text\",\"Shift-Ctrl-T\":\"table\",\"Shift-Alt-P\":\"pagebreak\",F9:\"watch\",F10:\"preview\",F11:\"fullscreen\"};var r=function(e){return String.prototype.trim?e.trim():e.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,\"\")};t.trim=r;var n=function(e){return e.toLowerCase().replace(/\\b(\\w)|\\s(\\w)/g,function(e){return e.toUpperCase()})};t.ucwords=t.wordsFirstUpperCase=n;var a=function(e){return e.toLowerCase().replace(/\\b(\\w)/,function(e){return e.toUpperCase()})};return t.firstUpperCase=t.ucfirst=a,t.urls={atLinkBase:\"https://github.com/\"},t.regexs={atLink:/@(\\w+)/g,email:/(\\w+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,emailLink:/(mailto:)?([\\w\\.\\_]+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,emoji:/:([\\w\\+-]+):/g,emojiDatetime:/(\\d{2}:\\d{2}:\\d{2})/g,twemoji:/:(tw-([\\w]+)-?(\\w+)?):/g,fontAwesome:/:(fa-([\\w]+)(-(\\w+)){0,}):/g,editormdLogo:/:(editormd-logo-?(\\w+)?):/g,pageBreak:/^\\[[=]{8,}\\]$/},t.emoji={path:\"http://www.emoji-cheat-sheet.com/graphics/emojis/\",ext:\".png\"},t.twemoji={path:\"http://twemoji.maxcdn.com/36x36/\",ext:\".png\"},t.markedRenderer=function(i,o){var n={toc:!0,tocm:!1,tocStartLevel:1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1},a=e.extend(n,o||{}),s=t.$marked,l=new s.Renderer;i=i||[];var c=t.regexs,h=c.atLink,d=c.emoji,u=c.email,f=c.emailLink,g=c.twemoji,p=c.fontAwesome,m=c.editormdLogo,w=c.pageBreak;return l.emoji=function(e){e=e.replace(t.regexs.emojiDatetime,function(e){return e.replace(/:/g,\"&#58;\")});var i=e.match(d);if(!i||!a.emoji)return e;for(var o=0,r=i.length;r>o;o++)\":+1:\"===i[o]&&(i[o]=\":\\\\+1:\"),e=e.replace(new RegExp(i[o]),function(e,i){var o=e.match(p),r=e.replace(/:/g,\"\");if(o)for(var n=0,a=o.length;a>n;n++){var s=o[n].replace(/:/g,\"\");return'<i class=\"fa '+s+' fa-emoji\" title=\"'+s.replace(\"fa-\",\"\")+'\"></i>'}else{var l=e.match(m),c=e.match(g);if(l)for(var h=0,d=l.length;d>h;h++){var u=l[h].replace(/:/g,\"\");return'<i class=\"'+u+'\" title=\"Editor.md logo ('+u+')\"></i>'}else{if(!c){var f=\"+1\"===r?\"plus1\":r;return f=\"black_large_square\"===f?\"black_square\":f,f=\"moon\"===f?\"waxing_gibbous_moon\":f,'<img src=\"'+t.emoji.path+f+t.emoji.ext+'\" class=\"emoji\" title=\"&#58;'+r+'&#58;\" alt=\"&#58;'+r+'&#58;\" />'}for(var w=0,v=c.length;v>w;w++){var k=c[w].replace(/:/g,\"\").replace(\"tw-\",\"\");return'<img src=\"'+t.twemoji.path+k+t.twemoji.ext+'\" title=\"twemoji-'+k+'\" alt=\"twemoji-'+k+'\" class=\"emoji twemoji\" />'}}}});return e},l.atLink=function(i){return h.test(i)?(a.atLink&&(i=i.replace(u,function(e,t,i,o){return e.replace(/@/g,\"_#_&#64;_#_\")}),i=i.replace(h,function(e,i){return'<a href=\"'+t.urls.atLinkBase+i+'\" title=\"&#64;'+i+'\" class=\"at-link\">'+e+\"</a>\"}).replace(/_#_&#64;_#_/g,\"@\")),a.emailLink&&(i=i.replace(f,function(t,i,o,r,n){return!i&&e.inArray(n,\"jpg|jpeg|png|gif|webp|ico|icon|pdf\".split(\"|\"))<0?'<a href=\"mailto:'+t+'\">'+t+\"</a>\":t})),i):i},l.link=function(e,t,i){if(this.options.sanitize){try{var o=decodeURIComponent(unescape(e)).replace(/[^\\w:]/g,\"\").toLowerCase()}catch(r){return\"\"}if(0===o.indexOf(\"javascript:\"))return\"\"}var n='<a href=\"'+e+'\"';return h.test(t)||h.test(i)?(t&&(n+=' title=\"'+t.replace(/@/g,\"&#64;\")),n+'\">'+i.replace(/@/g,\"&#64;\")+\"</a>\"):(t&&(n+=' title=\"'+t+'\"'),n+=\">\"+i+\"</a>\")},l.heading=function(e,t,o){var n=e,a=/\\s*\\<a\\s*href\\=\\\"(.*)\\\"\\s*([^\\>]*)\\>(.*)\\<\\/a\\>\\s*/;if(a.test(e)){var s=[];e=e.split(/\\<a\\s*([^\\>]+)\\>([^\\>]*)\\<\\/a\\>/);for(var l=0,c=e.length;c>l;l++)s.push(e[l].replace(/\\s*href\\=\\\"(.*)\\\"\\s*/g,\"\"));e=s.join(\" \")}e=r(e);var h=e.toLowerCase().replace(/[^\\w]+/g,\"-\"),d={text:e,level:t,slug:h},u=/^[\\u4e00-\\u9fa5]+$/.test(e),f=u?escape(e).replace(/\\%/g,\"\"):e.toLowerCase().replace(/[^\\w]+/g,\"-\");i.push(d);var g=\"<h\"+t+' id=\"h'+t+\"-\"+this.options.headerPrefix+f+'\">';return g+='<a name=\"'+e+'\" class=\"reference-link\"></a>',g+='<span class=\"header-link octicon octicon-link\"></span>',g+=this.atLink(a?this.emoji(n):this.emoji(e)),g+=\"</h\"+t+\">\"},l.pageBreak=function(e){return w.test(e)&&a.pageBreak&&(e='<hr style=\"page-break-after:always;\" class=\"page-break editormd-page-break\" />'),e},l.paragraph=function(e){var i=/\\$\\$(.*)\\$\\$/g.test(e),o=/^\\$\\$(.*)\\$\\$$/.test(e),r=o?' class=\"'+t.classNames.tex+'\"':\"\",n=a.tocm?/^(\\[TOC\\]|\\[TOCM\\])$/.test(e):/^\\[TOC\\]$/.test(e),s=/^\\[TOCM\\]$/.test(e);e=!o&&i?e.replace(/(\\$\\$([^\\$]*)\\$\\$)+/g,function(e,i){return'<span class=\"'+t.classNames.tex+'\">'+i.replace(/\\$/g,\"\")+\"</span>\"}):o?e.replace(/\\$/g,\"\"):e;var l='<div class=\"markdown-toc editormd-markdown-toc\">'+e+\"</div>\";return n?s?'<div class=\"editormd-toc-menu\">'+l+\"</div><br/>\":l:w.test(e)?this.pageBreak(e):\"<p\"+r+\">\"+this.atLink(this.emoji(e))+\"</p>\\n\"},l.code=function(e,i,o){return\"seq\"===i||\"sequence\"===i?'<div class=\"sequence-diagram\">'+e+\"</div>\":\"flow\"===i?'<div class=\"flowchart\">'+e+\"</div>\":\"math\"===i||\"latex\"===i||\"katex\"===i?'<p class=\"'+t.classNames.tex+'\">'+e+\"</p>\":s.Renderer.prototype.code.apply(this,arguments)},l.tablecell=function(e,t){var i=t.header?\"th\":\"td\",o=t.align?\"<\"+i+' style=\"text-align:'+t.align+'\">':\"<\"+i+\">\";return o+this.atLink(this.emoji(e))+\"</\"+i+\">\\n\"},l.listitem=function(e){return a.taskList&&/^\\s*\\[[x\\s]\\]\\s*/.test(e)?(e=e.replace(/^\\s*\\[\\s\\]\\s*/,'<input type=\"checkbox\" class=\"task-list-item-checkbox\" /> ').replace(/^\\s*\\[x\\]\\s*/,'<input type=\"checkbox\" class=\"task-list-item-checkbox\" checked disabled /> '),'<li style=\"list-style: none;\">'+this.atLink(this.emoji(e))+\"</li>\"):\"<li>\"+this.atLink(this.emoji(e))+\"</li>\"},l},t.markdownToCRenderer=function(e,t,i,o){var r=\"\",n=0,a=this.classPrefix;o=o||1;for(var s=0,l=e.length;l>s;s++){var c=e[s].text,h=e[s].level;o>h||(r+=h>n?\"\":n>h?new Array(n-h+2).join(\"</ul></li>\"):\"</ul></li>\",r+='<li><a class=\"toc-level-'+h+'\" href=\"#'+c+'\" level=\"'+h+'\">'+c+\"</a><ul>\",n=h)}var d=t.find(\".markdown-toc\");if(d.length<1&&\"false\"===t.attr(\"previewContainer\")){var u='<div class=\"markdown-toc '+a+'markdown-toc\"></div>';u=i?'<div class=\"'+a+'toc-menu\">'+u+\"</div>\":u,t.html(u),d=t.find(\".markdown-toc\")}return i&&d.wrap('<div class=\"'+a+'toc-menu\"></div><br/>'),d.html('<ul class=\"markdown-toc-list\"></ul>').children(\".markdown-toc-list\").html(r.replace(/\\r?\\n?\\<ul\\>\\<\\/ul\\>/g,\"\")),d},t.tocDropdownMenu=function(t,i){i=i||\"Table of Contents\";var o=400,r=t.find(\".\"+this.classPrefix+\"toc-menu\");return r.each(function(){var t=e(this),r=t.children(\".markdown-toc\"),n='<i class=\"fa fa-angle-down\"></i>',a='<a href=\"javascript:;\" class=\"toc-menu-btn\">'+n+i+\"</a>\",s=r.children(\"ul\"),l=s.find(\"li\");r.append(a),l.first().before(\"<li><h1>\"+i+\" \"+n+\"</h1></li>\"),t.mouseover(function(){s.show(),l.each(function(){var t=e(this),i=t.children(\"ul\");if(\"\"===i.html()&&i.remove(),i.length>0&&\"\"!==i.html()){var r=t.children(\"a\").first();r.children(\".fa\").length<1&&r.append(e(n).css({\"float\":\"right\",paddingTop:\"4px\"}))}t.mouseover(function(){i.css(\"z-index\",o).show(),o+=1}).mouseleave(function(){i.hide()})})}).mouseleave(function(){s.hide()})}),r},t.filterHTMLTags=function(t,i){if(\"string\"!=typeof t&&(t=new String(t)),\"string\"!=typeof i)return t;for(var o=i.split(\"|\"),r=o[0].split(\",\"),n=o[1],a=0,s=r.length;s>a;a++){var l=r[a];t=t.replace(new RegExp(\"<s*\"+l+\"s*([^>]*)>([^>]*)<s*/\"+l+\"s*>\",\"igm\"),\"\")}if(\"undefined\"!=typeof n){var c=/\\<(\\w+)\\s*([^\\>]*)\\>([^\\>]*)\\<\\/(\\w+)\\>/gi;t=\"*\"===n?t.replace(c,function(e,t,i,o,r){return\"<\"+t+\">\"+o+\"</\"+r+\">\"}):\"on*\"===n?t.replace(c,function(t,i,o,r,n){var a=e(\"<\"+i+\">\"+r+\"</\"+n+\">\"),s=e(t)[0].attributes,l={};e.each(s,function(e,t){'\"'!==t.nodeName&&(l[t.nodeName]=t.nodeValue)}),e.each(l,function(e){0===e.indexOf(\"on\")&&delete l[e]}),a.attr(l);var c=\"undefined\"!=typeof a[1]?e(a[1]).text():\"\";return a[0].outerHTML+c}):t.replace(c,function(t,i,o,r){var a=n.split(\",\"),s=e(t);return s.html(r),e.each(a,function(e){s.attr(a[e],null)}),s[0].outerHTML})}return t},t.markdownToHTML=function(i,o){var r={gfm:!0,toc:!0,tocm:!1,tocStartLevel:1,tocTitle:\"目录\",tocDropdown:!1,tocContainer:\"\",markdown:\"\",markdownSourceCode:!1,htmlDecode:!1,autoLoadKaTeX:!0,pageBreak:!0,atLink:!0,emailLink:!0,tex:!1,taskList:!1,emoji:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0};t.$marked=marked;var n=e(\"#\"+i),a=n.settings=e.extend(!0,r,o||{}),s=n.find(\"textarea\");s.length<1&&(n.append(\"<textarea></textarea>\"),s=n.find(\"textarea\"));var l=\"\"===a.markdown?s.val():a.markdown,c=[],h={toc:a.toc,tocm:a.tocm,tocStartLevel:a.tocStartLevel,taskList:a.taskList,emoji:a.emoji,tex:a.tex,pageBreak:a.pageBreak,atLink:a.atLink,emailLink:a.emailLink,flowChart:a.flowChart,sequenceDiagram:a.sequenceDiagram,previewCodeHighlight:a.previewCodeHighlight},d={renderer:t.markedRenderer(c,h),gfm:a.gfm,tables:!0,breaks:!0,pedantic:!1,sanitize:a.htmlDecode?!1:!0,smartLists:!0,smartypants:!0};l=new String(l);var u=marked(l,d);u=t.filterHTMLTags(u,a.htmlDecode),a.markdownSourceCode?s.text(l):s.remove(),n.addClass(\"markdown-body \"+this.classPrefix+\"html-preview\").append(u);var f=\"\"!==a.tocContainer?e(a.tocContainer):n;if(\"\"!==a.tocContainer&&f.attr(\"previewContainer\",!1),a.toc&&(n.tocContainer=this.markdownToCRenderer(c,f,a.tocDropdown,a.tocStartLevel),(a.tocDropdown||n.find(\".\"+this.classPrefix+\"toc-menu\").length>0)&&this.tocDropdownMenu(n,a.tocTitle),\"\"!==a.tocContainer&&n.find(\".editormd-toc-menu, .editormd-markdown-toc\").remove()),a.previewCodeHighlight&&(n.find(\"pre\").addClass(\"prettyprint linenums\"),prettyPrint()),t.isIE8||(a.flowChart&&n.find(\".flowchart\").flowChart(),a.sequenceDiagram&&n.find(\".sequence-diagram\").sequenceDiagram({theme:\"simple\"})),a.tex){var g=function(){n.find(\".\"+t.classNames.tex).each(function(){var t=e(this);katex.render(t.html().replace(/&lt;/g,\"<\").replace(/&gt;/g,\">\"),t[0]),t.find(\".katex\").css(\"font-size\",\"1.6em\")})};!a.autoLoadKaTeX||t.$katex||t.kaTeXLoaded?g():this.loadKaTeX(function(){t.$katex=katex,t.kaTeXLoaded=!0,g()})}return n.getMarkdown=function(){return s.val()},n},t.themes=[\"default\",\"dark\"],t.previewThemes=[\"default\",\"dark\"],t.editorThemes=[\"default\",\"3024-day\",\"3024-night\",\"ambiance\",\"ambiance-mobile\",\"base16-dark\",\"base16-light\",\"blackboard\",\"cobalt\",\"eclipse\",\"elegant\",\"erlang-dark\",\"lesser-dark\",\"mbo\",\"mdn-like\",\"midnight\",\"monokai\",\"neat\",\"neo\",\"night\",\"paraiso-dark\",\"paraiso-light\",\"pastel-on-dark\",\"rubyblue\",\"solarized\",\"the-matrix\",\"tomorrow-night-eighties\",\"twilight\",\"vibrant-ink\",\"xq-dark\",\"xq-light\"],t.loadPlugins={},t.loadFiles={js:[],css:[],plugin:[]},t.loadPlugin=function(e,i,o){i=i||function(){},this.loadScript(e,function(){t.loadFiles.plugin.push(e),i()},o)},t.loadCSS=function(e,i,o){o=o||\"head\",i=i||function(){};var r=document.createElement(\"link\");r.type=\"text/css\",r.rel=\"stylesheet\",r.onload=r.onreadystatechange=function(){t.loadFiles.css.push(e),i()},r.href=e+\".css\",\"head\"===o?document.getElementsByTagName(\"head\")[0].appendChild(r):document.body.appendChild(r)},t.isIE=\"Microsoft Internet Explorer\"==navigator.appName,t.isIE8=t.isIE&&\"8.\"==navigator.appVersion.match(/8./i),t.loadScript=function(e,i,o){o=o||\"head\",i=i||function(){};var r=null;r=document.createElement(\"script\"),r.id=e.replace(/[\\./]+/g,\"-\"),r.type=\"text/javascript\",r.src=e+\".js\",t.isIE8?r.onreadystatechange=function(){r.readyState&&(\"loaded\"===r.readyState||\"complete\"===r.readyState)&&(r.onreadystatechange=null,t.loadFiles.js.push(e),i())}:r.onload=function(){t.loadFiles.js.push(e),i()},\"head\"===o?document.getElementsByTagName(\"head\")[0].appendChild(r):document.body.appendChild(r)},t.katexURL={css:\"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\",js:\"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\"},t.kaTeXLoaded=!1,t.loadKaTeX=function(e){t.loadCSS(t.katexURL.css,function(){t.loadScript(t.katexURL.js,e||function(){})})},t.lockScreen=function(t){e(\"html,body\").css(\"overflow\",t?\"hidden\":\"\")},t.createDialog=function(i){var o={name:\"\",width:420,height:240,title:\"\",drag:!0,closed:!0,content:\"\",mask:!0,maskStyle:{backgroundColor:\"#fff\",opacity:.1},lockScreen:!0,footer:!0,buttons:!1};i=e.extend(!0,o,i);var r=this,n=this.editor,a=t.classPrefix,s=(new Date).getTime(),l=\"\"===i.name?a+\"dialog-\"+s:i.name,c=t.mouseOrTouch,h='<div class=\"'+a+\"dialog \"+l+'\">';\"\"!==i.title&&(h+='<div class=\"'+a+'dialog-header\"'+(i.drag?' style=\"cursor: move;\"':\"\")+\">\",h+='<strong class=\"'+a+'dialog-title\">'+i.title+\"</strong>\",h+=\"</div>\"),i.closed&&(h+='<a href=\"javascript:;\" class=\"fa fa-close '+a+'dialog-close\"></a>'),h+='<div class=\"'+a+'dialog-container\">'+i.content,(i.footer||\"string\"==typeof i.footer)&&(h+='<div class=\"'+a+'dialog-footer\">'+(\"boolean\"==typeof i.footer?\"\":i.footer)+\"</div>\"),h+=\"</div>\",h+='<div class=\"'+a+\"dialog-mask \"+a+'dialog-mask-bg\"></div>',h+='<div class=\"'+a+\"dialog-mask \"+a+'dialog-mask-con\"></div>',h+=\"</div>\",n.append(h);var d=n.find(\".\"+l);d.lockScreen=function(t){return i.lockScreen&&(e(\"html,body\").css(\"overflow\",t?\"hidden\":\"\"),r.resize()),d},d.showMask=function(){return i.mask&&n.find(\".\"+a+\"mask\").css(i.maskStyle).css(\"z-index\",t.dialogZindex-1).show(),d},d.hideMask=function(){return i.mask&&n.find(\".\"+a+\"mask\").hide(),d},d.loading=function(e){var t=d.find(\".\"+a+\"dialog-mask\");return t[e?\"show\":\"hide\"](),d},d.lockScreen(!0).showMask(),d.show().css({zIndex:t.dialogZindex,border:t.isIE8?\"1px solid #ddd\":\"\",width:\"number\"==typeof i.width?i.width+\"px\":i.width,height:\"number\"==typeof i.height?i.height+\"px\":i.height});var u=function(){d.css({top:(e(window).height()-d.height())/2+\"px\",left:(e(window).width()-d.width())/2+\"px\"})};if(u(),e(window).resize(u),d.children(\".\"+a+\"dialog-close\").bind(c(\"click\",\"touchend\"),function(){d.hide().lockScreen(!1).hideMask()}),\"object\"==typeof i.buttons){var f=d.footer=d.find(\".\"+a+\"dialog-footer\");for(var g in i.buttons){var p=i.buttons[g],m=a+g+\"-btn\";f.append('<button class=\"'+a+\"btn \"+m+'\">'+p[0]+\"</button>\"),p[1]=e.proxy(p[1],d),f.children(\".\"+m).bind(c(\"click\",\"touchend\"),p[1])}}if(\"\"!==i.title&&i.drag){var w,v,k=d.children(\".\"+a+\"dialog-header\");i.mask||k.bind(c(\"click\",\"touchend\"),function(){t.dialogZindex+=2,d.css(\"z-index\",t.dialogZindex)}),k.mousedown(function(e){e=e||window.event,w=e.clientX-parseInt(d[0].style.left),v=e.clientY-parseInt(d[0].style.top),document.onmousemove=y});var b=function(e){e.removeClass(a+\"user-unselect\").off(\"selectstart\")},x=function(e){e.addClass(a+\"user-unselect\").on(\"selectstart\",function(e){return!1})},y=function(t){t=t||window.event;var i,o,r=parseInt(d[0].style.left),n=parseInt(d[0].style.top);r>=0?r+d.width()<=e(window).width()?i=t.clientX-w:(i=e(window).width()-d.width(),document.onmousemove=null):(i=0,document.onmousemove=null),n>=0?o=t.clientY-v:(o=0,document.onmousemove=null),document.onselectstart=function(){return!1},x(e(\"body\")),x(d),d[0].style.left=i+\"px\",d[0].style.top=o+\"px\"};document.onmouseup=function(){b(e(\"body\")),b(d),document.onselectstart=null,document.onmousemove=null},k.touchDraggable=function(){var t=null,i=function(i){var o=i.originalEvent,r=e(this).parent().position();t={x:o.changedTouches[0].pageX-r.left,y:o.changedTouches[0].pageY-r.top}},o=function(i){i.preventDefault();var o=i.originalEvent;e(this).parent().css({top:o.changedTouches[0].pageY-t.y,left:o.changedTouches[0].pageX-t.x})};this.bind(\"touchstart\",i).bind(\"touchmove\",o)},k.touchDraggable()}return t.dialogZindex+=2,d},t.mouseOrTouch=function(e,t){e=e||\"click\",t=t||\"touchend\";var i=e;try{document.createEvent(\"TouchEvent\"),i=t}catch(o){}return i},t.dateFormat=function(e){e=e||\"\";var t=function(e){return 10>e?\"0\"+e:e},i=new Date,o=i.getFullYear(),r=o.toString().slice(2,4),n=t(i.getMonth()+1),a=t(i.getDate()),s=i.getDay(),l=t(i.getHours()),c=t(i.getMinutes()),h=t(i.getSeconds()),d=t(i.getMilliseconds()),u=\"\",f=r+\"-\"+n+\"-\"+a,g=o+\"-\"+n+\"-\"+a,p=l+\":\"+c+\":\"+h;switch(e){case\"UNIX Time\":u=i.getTime();break;case\"UTC\":u=i.toUTCString();break;case\"yy\":u=r;break;case\"year\":case\"yyyy\":u=o;break;case\"month\":case\"mm\":u=n;break;case\"cn-week-day\":case\"cn-wd\":var m=[\"日\",\"一\",\"二\",\"三\",\"四\",\"五\",\"六\"];u=\"星期\"+m[s];break;case\"week-day\":case\"wd\":var w=[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];u=w[s];break;case\"day\":case\"dd\":u=a;break;case\"hour\":case\"hh\":u=l;break;case\"min\":case\"ii\":u=c;break;case\"second\":case\"ss\":u=h;break;case\"ms\":u=d;break;case\"yy-mm-dd\":u=f;break;case\"yyyy-mm-dd\":u=g;break;case\"yyyy-mm-dd h:i:s ms\":case\"full + ms\":u=g+\" \"+p+\" \"+d;break;case\"full\":case\"yyyy-mm-dd h:i:s\":default:u=g+\" \"+p}return u},t}});"
        },
        {
          "name": "editormd.js",
          "type": "blob",
          "size": 159.4560546875,
          "content": "/*\r\n * Editor.md\r\n *\r\n * @file        editormd.js \r\n * @version     v1.5.0 \r\n * @description Open source online markdown editor.\r\n * @license     MIT License\r\n * @author      Pandao\r\n * {@link       https://github.com/pandao/editor.md}\r\n * @updateTime  2015-06-09\r\n */\r\n\r\n;(function(factory) {\r\n    \"use strict\";\r\n    \r\n\t// CommonJS/Node.js\r\n\tif (typeof require === \"function\" && typeof exports === \"object\" && typeof module === \"object\")\r\n    { \r\n        module.exports = factory;\r\n    }\r\n\telse if (typeof define === \"function\")  // AMD/CMD/Sea.js\r\n\t{\r\n        if (define.amd) // for Require.js\r\n        {\r\n            /* Require.js define replace */\r\n        } \r\n        else \r\n        {\r\n\t\t    define([\"jquery\"], factory);  // for Sea.js\r\n        }\r\n\t} \r\n\telse\r\n\t{ \r\n        window.editormd = factory();\r\n\t}\r\n    \r\n}(function() {    \r\n\r\n    /* Require.js assignment replace */\r\n    \r\n    \"use strict\";\r\n    \r\n    var $ = (typeof (jQuery) !== \"undefined\") ? jQuery : Zepto;\r\n\r\n\tif (typeof ($) === \"undefined\") {\r\n\t\treturn ;\r\n\t}\r\n    \r\n    /**\r\n     * editormd\r\n     * \r\n     * @param   {String} id           编辑器的ID\r\n     * @param   {Object} options      配置选项 Key/Value\r\n     * @returns {Object} editormd     返回editormd对象\r\n     */\r\n    \r\n    var editormd         = function (id, options) {\r\n        return new editormd.fn.init(id, options);\r\n    };\r\n    \r\n    editormd.title        = editormd.$name = \"Editor.md\";\r\n    editormd.version      = \"1.5.0\";\r\n    editormd.homePage     = \"https://pandao.github.io/editor.md/\";\r\n    editormd.classPrefix  = \"editormd-\";\r\n    \r\n    editormd.toolbarModes = {\r\n        full : [\r\n            \"undo\", \"redo\", \"|\", \r\n            \"bold\", \"del\", \"italic\", \"quote\", \"ucwords\", \"uppercase\", \"lowercase\", \"|\", \r\n            \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"|\", \r\n            \"list-ul\", \"list-ol\", \"hr\", \"|\",\r\n            \"link\", \"reference-link\", \"image\", \"code\", \"preformatted-text\", \"code-block\", \"table\", \"datetime\", \"emoji\", \"html-entities\", \"pagebreak\", \"|\",\r\n            \"goto-line\", \"watch\", \"preview\", \"fullscreen\", \"clear\", \"search\", \"|\",\r\n            \"help\", \"info\"\r\n        ],\r\n        simple : [\r\n            \"undo\", \"redo\", \"|\", \r\n            \"bold\", \"del\", \"italic\", \"quote\", \"uppercase\", \"lowercase\", \"|\", \r\n            \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"|\", \r\n            \"list-ul\", \"list-ol\", \"hr\", \"|\",\r\n            \"watch\", \"preview\", \"fullscreen\", \"|\",\r\n            \"help\", \"info\"\r\n        ],\r\n        mini : [\r\n            \"undo\", \"redo\", \"|\",\r\n            \"watch\", \"preview\", \"|\",\r\n            \"help\", \"info\"\r\n        ]\r\n    };\r\n    \r\n    editormd.defaults     = {\r\n        mode                 : \"gfm\",          //gfm or markdown\r\n        name                 : \"\",             // Form element name\r\n        value                : \"\",             // value for CodeMirror, if mode not gfm/markdown\r\n        theme                : \"\",             // Editor.md self themes, before v1.5.0 is CodeMirror theme, default empty\r\n        editorTheme          : \"default\",      // Editor area, this is CodeMirror theme at v1.5.0\r\n        previewTheme         : \"\",             // Preview area theme, default empty\r\n        markdown             : \"\",             // Markdown source code\r\n        appendMarkdown       : \"\",             // if in init textarea value not empty, append markdown to textarea\r\n        width                : \"100%\",\r\n        height               : \"100%\",\r\n        path                 : \"./lib/\",       // Dependents module file directory\r\n        pluginPath           : \"\",             // If this empty, default use settings.path + \"../plugins/\"\r\n        delay                : 300,            // Delay parse markdown to html, Uint : ms\r\n        autoLoadModules      : true,           // Automatic load dependent module files\r\n        watch                : true,\r\n        placeholder          : \"Enjoy Markdown! coding now...\",\r\n        gotoLine             : true,\r\n        codeFold             : false,\r\n        autoHeight           : false,\r\n\t\tautoFocus            : true,\r\n        autoCloseTags        : true,\r\n        searchReplace        : true,\r\n        syncScrolling        : true,           // true | false | \"single\", default true\r\n        readOnly             : false,\r\n        tabSize              : 4,\r\n\t\tindentUnit           : 4,\r\n        lineNumbers          : true,\r\n\t\tlineWrapping         : true,\r\n\t\tautoCloseBrackets    : true,\r\n\t\tshowTrailingSpace    : true,\r\n\t\tmatchBrackets        : true,\r\n\t\tindentWithTabs       : true,\r\n\t\tstyleSelectedText    : true,\r\n        matchWordHighlight   : true,           // options: true, false, \"onselected\"\r\n        styleActiveLine      : true,           // Highlight the current line\r\n        dialogLockScreen     : true,\r\n        dialogShowMask       : true,\r\n        dialogDraggable      : true,\r\n        dialogMaskBgColor    : \"#fff\",\r\n        dialogMaskOpacity    : 0.1,\r\n        fontSize             : \"13px\",\r\n        saveHTMLToTextarea   : false,\r\n        disabledKeyMaps      : [],\r\n        \r\n        onload               : function() {},\r\n        onresize             : function() {},\r\n        onchange             : function() {},\r\n        onwatch              : null,\r\n        onunwatch            : null,\r\n        onpreviewing         : function() {},\r\n        onpreviewed          : function() {},\r\n        onfullscreen         : function() {},\r\n        onfullscreenExit     : function() {},\r\n        onscroll             : function() {},\r\n        onpreviewscroll      : function() {},\r\n        \r\n        imageUpload          : false,\r\n        imageFormats         : [\"jpg\", \"jpeg\", \"gif\", \"png\", \"bmp\", \"webp\"],\r\n        imageUploadURL       : \"\",\r\n        crossDomainUpload    : false,\r\n        uploadCallbackURL    : \"\",\r\n        \r\n        toc                  : true,           // Table of contents\r\n        tocm                 : false,           // Using [TOCM], auto create ToC dropdown menu\r\n        tocTitle             : \"\",             // for ToC dropdown menu btn\r\n        tocDropdown          : false,\r\n        tocContainer         : \"\",\r\n        tocStartLevel        : 1,              // Said from H1 to create ToC\r\n        htmlDecode           : false,          // Open the HTML tag identification \r\n        pageBreak            : true,           // Enable parse page break [========]\r\n        atLink               : true,           // for @link\r\n        emailLink            : true,           // for email address auto link\r\n        taskList             : false,          // Enable Github Flavored Markdown task lists\r\n        emoji                : false,          // :emoji: , Support Github emoji, Twitter Emoji (Twemoji);\r\n                                               // Support FontAwesome icon emoji :fa-xxx: > Using fontAwesome icon web fonts;\r\n                                               // Support Editor.md logo icon emoji :editormd-logo: :editormd-logo-1x: > 1~8x;\r\n        tex                  : false,          // TeX(LaTeX), based on KaTeX\r\n        flowChart            : false,          // flowChart.js only support IE9+\r\n        sequenceDiagram      : false,          // sequenceDiagram.js only support IE9+\r\n        previewCodeHighlight : true,\r\n                \r\n        toolbar              : true,           // show/hide toolbar\r\n        toolbarAutoFixed     : true,           // on window scroll auto fixed position\r\n        toolbarIcons         : \"full\",\r\n        toolbarTitles        : {},\r\n        toolbarHandlers      : {\r\n            ucwords : function() {\r\n                return editormd.toolbarHandlers.ucwords;\r\n            },\r\n            lowercase : function() {\r\n                return editormd.toolbarHandlers.lowercase;\r\n            }\r\n        },\r\n        toolbarCustomIcons   : {               // using html tag create toolbar icon, unused default <a> tag.\r\n            lowercase        : \"<a href=\\\"javascript:;\\\" title=\\\"Lowercase\\\" unselectable=\\\"on\\\"><i class=\\\"fa\\\" name=\\\"lowercase\\\" style=\\\"font-size:24px;margin-top: -10px;\\\">a</i></a>\",\r\n            \"ucwords\"        : \"<a href=\\\"javascript:;\\\" title=\\\"ucwords\\\" unselectable=\\\"on\\\"><i class=\\\"fa\\\" name=\\\"ucwords\\\" style=\\\"font-size:20px;margin-top: -3px;\\\">Aa</i></a>\"\r\n        }, \r\n        toolbarIconsClass    : {\r\n            undo             : \"fa-undo\",\r\n            redo             : \"fa-repeat\",\r\n            bold             : \"fa-bold\",\r\n            del              : \"fa-strikethrough\",\r\n            italic           : \"fa-italic\",\r\n            quote            : \"fa-quote-left\",\r\n            uppercase        : \"fa-font\",\r\n            h1               : editormd.classPrefix + \"bold\",\r\n            h2               : editormd.classPrefix + \"bold\",\r\n            h3               : editormd.classPrefix + \"bold\",\r\n            h4               : editormd.classPrefix + \"bold\",\r\n            h5               : editormd.classPrefix + \"bold\",\r\n            h6               : editormd.classPrefix + \"bold\",\r\n            \"list-ul\"        : \"fa-list-ul\",\r\n            \"list-ol\"        : \"fa-list-ol\",\r\n            hr               : \"fa-minus\",\r\n            link             : \"fa-link\",\r\n            \"reference-link\" : \"fa-anchor\",\r\n            image            : \"fa-picture-o\",\r\n            code             : \"fa-code\",\r\n            \"preformatted-text\" : \"fa-file-code-o\",\r\n            \"code-block\"     : \"fa-file-code-o\",\r\n            table            : \"fa-table\",\r\n            datetime         : \"fa-clock-o\",\r\n            emoji            : \"fa-smile-o\",\r\n            \"html-entities\"  : \"fa-copyright\",\r\n            pagebreak        : \"fa-newspaper-o\",\r\n            \"goto-line\"      : \"fa-terminal\", // fa-crosshairs\r\n            watch            : \"fa-eye-slash\",\r\n            unwatch          : \"fa-eye\",\r\n            preview          : \"fa-desktop\",\r\n            search           : \"fa-search\",\r\n            fullscreen       : \"fa-arrows-alt\",\r\n            clear            : \"fa-eraser\",\r\n            help             : \"fa-question-circle\",\r\n            info             : \"fa-info-circle\"\r\n        },        \r\n        toolbarIconTexts     : {},\r\n        \r\n        lang : {\r\n            name        : \"zh-cn\",\r\n            description : \"开源在线Markdown编辑器<br/>Open source online Markdown editor.\",\r\n            tocTitle    : \"目录\",\r\n            toolbar     : {\r\n                undo             : \"撤销（Ctrl+Z）\",\r\n                redo             : \"重做（Ctrl+Y）\",\r\n                bold             : \"粗体\",\r\n                del              : \"删除线\",\r\n                italic           : \"斜体\",\r\n                quote            : \"引用\",\r\n                ucwords          : \"将每个单词首字母转成大写\",\r\n                uppercase        : \"将所选转换成大写\",\r\n                lowercase        : \"将所选转换成小写\",\r\n                h1               : \"标题1\",\r\n                h2               : \"标题2\",\r\n                h3               : \"标题3\",\r\n                h4               : \"标题4\",\r\n                h5               : \"标题5\",\r\n                h6               : \"标题6\",\r\n                \"list-ul\"        : \"无序列表\",\r\n                \"list-ol\"        : \"有序列表\",\r\n                hr               : \"横线\",\r\n                link             : \"链接\",\r\n                \"reference-link\" : \"引用链接\",\r\n                image            : \"添加图片\",\r\n                code             : \"行内代码\",\r\n                \"preformatted-text\" : \"预格式文本 / 代码块（缩进风格）\",\r\n                \"code-block\"     : \"代码块（多语言风格）\",\r\n                table            : \"添加表格\",\r\n                datetime         : \"日期时间\",\r\n                emoji            : \"Emoji表情\",\r\n                \"html-entities\"  : \"HTML实体字符\",\r\n                pagebreak        : \"插入分页符\",\r\n                \"goto-line\"      : \"跳转到行\",\r\n                watch            : \"关闭实时预览\",\r\n                unwatch          : \"开启实时预览\",\r\n                preview          : \"全窗口预览HTML（按 Shift + ESC还原）\",\r\n                fullscreen       : \"全屏（按ESC还原）\",\r\n                clear            : \"清空\",\r\n                search           : \"搜索\",\r\n                help             : \"使用帮助\",\r\n                info             : \"关于\" + editormd.title\r\n            },\r\n            buttons : {\r\n                enter  : \"确定\",\r\n                cancel : \"取消\",\r\n                close  : \"关闭\"\r\n            },\r\n            dialog : {\r\n                link : {\r\n                    title    : \"添加链接\",\r\n                    url      : \"链接地址\",\r\n                    urlTitle : \"链接标题\",\r\n                    urlEmpty : \"错误：请填写链接地址。\"\r\n                },\r\n                referenceLink : {\r\n                    title    : \"添加引用链接\",\r\n                    name     : \"引用名称\",\r\n                    url      : \"链接地址\",\r\n                    urlId    : \"链接ID\",\r\n                    urlTitle : \"链接标题\",\r\n                    nameEmpty: \"错误：引用链接的名称不能为空。\",\r\n                    idEmpty  : \"错误：请填写引用链接的ID。\",\r\n                    urlEmpty : \"错误：请填写引用链接的URL地址。\"\r\n                },\r\n                image : {\r\n                    title    : \"添加图片\",\r\n                    url      : \"图片地址\",\r\n                    link     : \"图片链接\",\r\n                    alt      : \"图片描述\",\r\n                    uploadButton     : \"本地上传\",\r\n                    imageURLEmpty    : \"错误：图片地址不能为空。\",\r\n                    uploadFileEmpty  : \"错误：上传的图片不能为空。\",\r\n                    formatNotAllowed : \"错误：只允许上传图片文件，允许上传的图片文件格式有：\"\r\n                },\r\n                preformattedText : {\r\n                    title             : \"添加预格式文本或代码块\", \r\n                    emptyAlert        : \"错误：请填写预格式文本或代码的内容。\"\r\n                },\r\n                codeBlock : {\r\n                    title             : \"添加代码块\",                    \r\n                    selectLabel       : \"代码语言：\",\r\n                    selectDefaultText : \"请选择代码语言\",\r\n                    otherLanguage     : \"其他语言\",\r\n                    unselectedLanguageAlert : \"错误：请选择代码所属的语言类型。\",\r\n                    codeEmptyAlert    : \"错误：请填写代码内容。\"\r\n                },\r\n                htmlEntities : {\r\n                    title : \"HTML 实体字符\"\r\n                },\r\n                help : {\r\n                    title : \"使用帮助\"\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    editormd.classNames  = {\r\n        tex : editormd.classPrefix + \"tex\"\r\n    };\r\n\r\n    editormd.dialogZindex = 99999;\r\n    \r\n    editormd.$katex       = null;\r\n    editormd.$marked      = null;\r\n    editormd.$CodeMirror  = null;\r\n    editormd.$prettyPrint = null;\r\n    \r\n    var timer, flowchartTimer;\r\n\r\n    editormd.prototype    = editormd.fn = {\r\n        state : {\r\n            watching   : false,\r\n            loaded     : false,\r\n            preview    : false,\r\n            fullscreen : false\r\n        },\r\n        \r\n        /**\r\n         * 构造函数/实例初始化\r\n         * Constructor / instance initialization\r\n         * \r\n         * @param   {String}   id            编辑器的ID\r\n         * @param   {Object}   [options={}]  配置选项 Key/Value\r\n         * @returns {editormd}               返回editormd的实例对象\r\n         */\r\n        \r\n        init : function (id, options) {\r\n            \r\n            options              = options || {};\r\n            \r\n            if (typeof id === \"object\")\r\n            {\r\n                options = id;\r\n            }\r\n            \r\n            var _this            = this;\r\n            var classPrefix      = this.classPrefix  = editormd.classPrefix; \r\n            var settings         = this.settings     = $.extend(true, {}, editormd.defaults, options);\r\n            \r\n            id                   = (typeof id === \"object\") ? settings.id : id;\r\n            \r\n            var editor           = this.editor       = $(\"#\" + id);\r\n            \r\n            this.id              = id;\r\n            this.lang            = settings.lang;\r\n            \r\n            var classNames       = this.classNames   = {\r\n                textarea : {\r\n                    html     : classPrefix + \"html-textarea\",\r\n                    markdown : classPrefix + \"markdown-textarea\"\r\n                }\r\n            };\r\n            \r\n            settings.pluginPath = (settings.pluginPath === \"\") ? settings.path + \"../plugins/\" : settings.pluginPath; \r\n            \r\n            this.state.watching = (settings.watch) ? true : false;\r\n            \r\n            if ( !editor.hasClass(\"editormd\") ) {\r\n                editor.addClass(\"editormd\");\r\n            }\r\n            \r\n            editor.css({\r\n                width  : (typeof settings.width  === \"number\") ? settings.width  + \"px\" : settings.width,\r\n                height : (typeof settings.height === \"number\") ? settings.height + \"px\" : settings.height\r\n            });\r\n            \r\n            if (settings.autoHeight)\r\n            {\r\n                editor.css(\"height\", \"auto\");\r\n            }\r\n                        \r\n            var markdownTextarea = this.markdownTextarea = editor.children(\"textarea\");\r\n            \r\n            if (markdownTextarea.length < 1)\r\n            {\r\n                editor.append(\"<textarea></textarea>\");\r\n                markdownTextarea = this.markdownTextarea = editor.children(\"textarea\");\r\n            }\r\n            \r\n            markdownTextarea.addClass(classNames.textarea.markdown).attr(\"placeholder\", settings.placeholder);\r\n            \r\n            if (typeof markdownTextarea.attr(\"name\") === \"undefined\" || markdownTextarea.attr(\"name\") === \"\")\r\n            {\r\n                markdownTextarea.attr(\"name\", (settings.name !== \"\") ? settings.name : id + \"-markdown-doc\");\r\n            }\r\n            \r\n            var appendElements = [\r\n                (!settings.readOnly) ? \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"preview-close-btn\\\"></a>\" : \"\",\r\n                ( (settings.saveHTMLToTextarea) ? \"<textarea class=\\\"\" + classNames.textarea.html + \"\\\" name=\\\"\" + id + \"-html-code\\\"></textarea>\" : \"\" ),\r\n                \"<div class=\\\"\" + classPrefix + \"preview\\\"><div class=\\\"markdown-body \" + classPrefix + \"preview-container\\\"></div></div>\",\r\n                \"<div class=\\\"\" + classPrefix + \"container-mask\\\" style=\\\"display:block;\\\"></div>\",\r\n                \"<div class=\\\"\" + classPrefix + \"mask\\\"></div>\"\r\n            ].join(\"\\n\");\r\n            \r\n            editor.append(appendElements).addClass(classPrefix + \"vertical\");\r\n            \r\n            if (settings.theme !== \"\") \r\n            {\r\n                editor.addClass(classPrefix + \"theme-\" + settings.theme);\r\n            }\r\n            \r\n            this.mask          = editor.children(\".\" + classPrefix + \"mask\");    \r\n            this.containerMask = editor.children(\".\" + classPrefix  + \"container-mask\");\r\n            \r\n            if (settings.markdown !== \"\")\r\n            {\r\n                markdownTextarea.val(settings.markdown);\r\n            }\r\n            \r\n            if (settings.appendMarkdown !== \"\")\r\n            {\r\n                markdownTextarea.val(markdownTextarea.val() + settings.appendMarkdown);\r\n            }\r\n            \r\n            this.htmlTextarea     = editor.children(\".\" + classNames.textarea.html);            \r\n            this.preview          = editor.children(\".\" + classPrefix + \"preview\");\r\n            this.previewContainer = this.preview.children(\".\" + classPrefix + \"preview-container\");\r\n            \r\n            if (settings.previewTheme !== \"\") \r\n            {\r\n                this.preview.addClass(classPrefix + \"preview-theme-\" + settings.previewTheme);\r\n            }\r\n            \r\n            if (typeof define === \"function\" && define.amd)\r\n            {\r\n                if (typeof katex !== \"undefined\") \r\n                {\r\n                    editormd.$katex = katex;\r\n                }\r\n                \r\n                if (settings.searchReplace && !settings.readOnly) \r\n                {\r\n                    editormd.loadCSS(settings.path + \"codemirror/addon/dialog/dialog\");\r\n                    editormd.loadCSS(settings.path + \"codemirror/addon/search/matchesonscrollbar\");\r\n                }\r\n            }\r\n            \r\n            if ((typeof define === \"function\" && define.amd) || !settings.autoLoadModules)\r\n            {\r\n                if (typeof CodeMirror !== \"undefined\") {\r\n                    editormd.$CodeMirror = CodeMirror;\r\n                }\r\n                \r\n                if (typeof marked     !== \"undefined\") {\r\n                    editormd.$marked     = marked;\r\n                }\r\n                \r\n                this.setCodeMirror().setToolbar().loadedDisplay();\r\n            } \r\n            else \r\n            {\r\n                this.loadQueues();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 所需组件加载队列\r\n         * Required components loading queue\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        loadQueues : function() {\r\n            var _this        = this;\r\n            var settings     = this.settings;\r\n            var loadPath     = settings.path;\r\n                                \r\n            var loadFlowChartOrSequenceDiagram = function() {\r\n                \r\n                if (editormd.isIE8) \r\n                {\r\n                    _this.loadedDisplay();\r\n                    \r\n                    return ;\r\n                }\r\n\r\n                if (settings.flowChart || settings.sequenceDiagram) \r\n                {\r\n                    editormd.loadScript(loadPath + \"raphael.min\", function() {\r\n\r\n                        editormd.loadScript(loadPath + \"underscore.min\", function() {  \r\n\r\n                            if (!settings.flowChart && settings.sequenceDiagram) \r\n                            {\r\n                                editormd.loadScript(loadPath + \"sequence-diagram.min\", function() {\r\n                                    _this.loadedDisplay();\r\n                                });\r\n                            }\r\n                            else if (settings.flowChart && !settings.sequenceDiagram) \r\n                            {      \r\n                                editormd.loadScript(loadPath + \"flowchart.min\", function() {  \r\n                                    editormd.loadScript(loadPath + \"jquery.flowchart.min\", function() {\r\n                                        _this.loadedDisplay();\r\n                                    });\r\n                                });\r\n                            }\r\n                            else if (settings.flowChart && settings.sequenceDiagram) \r\n                            {  \r\n                                editormd.loadScript(loadPath + \"flowchart.min\", function() {  \r\n                                    editormd.loadScript(loadPath + \"jquery.flowchart.min\", function() {\r\n                                        editormd.loadScript(loadPath + \"sequence-diagram.min\", function() {\r\n                                            _this.loadedDisplay();\r\n                                        });\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                    });\r\n                } \r\n                else\r\n                {\r\n                    _this.loadedDisplay();\r\n                }\r\n            }; \r\n\r\n            editormd.loadCSS(loadPath + \"codemirror/codemirror.min\");\r\n            \r\n            if (settings.searchReplace && !settings.readOnly)\r\n            {\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/dialog/dialog\");\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/search/matchesonscrollbar\");\r\n            }\r\n            \r\n            if (settings.codeFold)\r\n            {\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/fold/foldgutter\");            \r\n            }\r\n            \r\n            editormd.loadScript(loadPath + \"codemirror/codemirror.min\", function() {\r\n                editormd.$CodeMirror = CodeMirror;\r\n                \r\n                editormd.loadScript(loadPath + \"codemirror/modes.min\", function() {\r\n                    \r\n                    editormd.loadScript(loadPath + \"codemirror/addons.min\", function() {\r\n                        \r\n                        _this.setCodeMirror();\r\n                        \r\n                        if (settings.mode !== \"gfm\" && settings.mode !== \"markdown\") \r\n                        {\r\n                            _this.loadedDisplay();\r\n                            \r\n                            return false;\r\n                        }\r\n                        \r\n                        _this.setToolbar();\r\n\r\n                        editormd.loadScript(loadPath + \"marked.min\", function() {\r\n\r\n                            editormd.$marked = marked;\r\n                                \r\n                            if (settings.previewCodeHighlight) \r\n                            {\r\n                                editormd.loadScript(loadPath + \"prettify.min\", function() {\r\n                                    loadFlowChartOrSequenceDiagram();\r\n                                });\r\n                            } \r\n                            else\r\n                            {                  \r\n                                loadFlowChartOrSequenceDiagram();\r\n                            }\r\n                        });\r\n                        \r\n                    });\r\n                    \r\n                });\r\n                \r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置 Editor.md 的整体主题，主要是工具栏\r\n         * Setting Editor.md theme\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setTheme : function(theme) {\r\n            var editor      = this.editor;\r\n            var oldTheme    = this.settings.theme;\r\n            var themePrefix = this.classPrefix + \"theme-\";\r\n            \r\n            editor.removeClass(themePrefix + oldTheme).addClass(themePrefix + theme);\r\n            \r\n            this.settings.theme = theme;\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置 CodeMirror（编辑区）的主题\r\n         * Setting CodeMirror (Editor area) theme\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setEditorTheme : function(theme) {  \r\n            var settings   = this.settings;  \r\n            settings.editorTheme = theme;  \r\n            \r\n            if (theme !== \"default\")\r\n            {\r\n                editormd.loadCSS(settings.path + \"codemirror/theme/\" + settings.editorTheme);\r\n            }\r\n            \r\n            this.cm.setOption(\"theme\", theme);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * setEditorTheme() 的别名\r\n         * setEditorTheme() alias\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setCodeMirrorTheme : function (theme) {            \r\n            this.setEditorTheme(theme);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置 Editor.md 的主题\r\n         * Setting Editor.md theme\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setPreviewTheme : function(theme) {  \r\n            var preview     = this.preview;\r\n            var oldTheme    = this.settings.previewTheme;\r\n            var themePrefix = this.classPrefix + \"preview-theme-\";\r\n            \r\n            preview.removeClass(themePrefix + oldTheme).addClass(themePrefix + theme);\r\n            \r\n            this.settings.previewTheme = theme;\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 配置和初始化CodeMirror组件\r\n         * CodeMirror initialization\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setCodeMirror : function() { \r\n            var settings         = this.settings;\r\n            var editor           = this.editor;\r\n            \r\n            if (settings.editorTheme !== \"default\")\r\n            {\r\n                editormd.loadCSS(settings.path + \"codemirror/theme/\" + settings.editorTheme);\r\n            }\r\n            \r\n            var codeMirrorConfig = {\r\n                mode                      : settings.mode,\r\n                theme                     : settings.editorTheme,\r\n                tabSize                   : settings.tabSize,\r\n                dragDrop                  : false,\r\n                autofocus                 : settings.autoFocus,\r\n                autoCloseTags             : settings.autoCloseTags,\r\n                readOnly                  : (settings.readOnly) ? \"nocursor\" : false,\r\n                indentUnit                : settings.indentUnit,\r\n                lineNumbers               : settings.lineNumbers,\r\n                lineWrapping              : settings.lineWrapping,\r\n                extraKeys                 : {\r\n                                                \"Ctrl-Q\": function(cm) { \r\n                                                    cm.foldCode(cm.getCursor()); \r\n                                                }\r\n                                            },\r\n                foldGutter                : settings.codeFold,\r\n                gutters                   : [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\r\n                matchBrackets             : settings.matchBrackets,\r\n                indentWithTabs            : settings.indentWithTabs,\r\n                styleActiveLine           : settings.styleActiveLine,\r\n                styleSelectedText         : settings.styleSelectedText,\r\n                autoCloseBrackets         : settings.autoCloseBrackets,\r\n                showTrailingSpace         : settings.showTrailingSpace,\r\n                highlightSelectionMatches : ( (!settings.matchWordHighlight) ? false : { showToken: (settings.matchWordHighlight === \"onselected\") ? false : /\\w/ } )\r\n            };\r\n            \r\n            this.codeEditor = this.cm        = editormd.$CodeMirror.fromTextArea(this.markdownTextarea[0], codeMirrorConfig);\r\n            this.codeMirror = this.cmElement = editor.children(\".CodeMirror\");\r\n            \r\n            if (settings.value !== \"\")\r\n            {\r\n                this.cm.setValue(settings.value);\r\n            }\r\n\r\n            this.codeMirror.css({\r\n                fontSize : settings.fontSize,\r\n                width    : (!settings.watch) ? \"100%\" : \"50%\"\r\n            });\r\n            \r\n            if (settings.autoHeight)\r\n            {\r\n                this.codeMirror.css(\"height\", \"auto\");\r\n                this.cm.setOption(\"viewportMargin\", Infinity);\r\n            }\r\n            \r\n            if (!settings.lineNumbers)\r\n            {\r\n                this.codeMirror.find(\".CodeMirror-gutters\").css(\"border-right\", \"none\");\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取CodeMirror的配置选项\r\n         * Get CodeMirror setting options\r\n         * \r\n         * @returns {Mixed}                  return CodeMirror setting option value\r\n         */\r\n        \r\n        getCodeMirrorOption : function(key) {            \r\n            return this.cm.getOption(key);\r\n        },\r\n        \r\n        /**\r\n         * 配置和重配置CodeMirror的选项\r\n         * CodeMirror setting options / resettings\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setCodeMirrorOption : function(key, value) {\r\n            \r\n            this.cm.setOption(key, value);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 添加 CodeMirror 键盘快捷键\r\n         * Add CodeMirror keyboard shortcuts key map\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        addKeyMap : function(map, bottom) {\r\n            this.cm.addKeyMap(map, bottom);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 移除 CodeMirror 键盘快捷键\r\n         * Remove CodeMirror keyboard shortcuts key map\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        removeKeyMap : function(map) {\r\n            this.cm.removeKeyMap(map);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 跳转到指定的行\r\n         * Goto CodeMirror line\r\n         * \r\n         * @param   {String|Intiger}   line      line number or \"first\"|\"last\"\r\n         * @returns {editormd}                   返回editormd的实例对象\r\n         */\r\n        \r\n        gotoLine : function (line) {\r\n            \r\n            var settings = this.settings;\r\n            \r\n            if (!settings.gotoLine)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            var cm       = this.cm;\r\n            var editor   = this.editor;\r\n            var count    = cm.lineCount();\r\n            var preview  = this.preview;\r\n            \r\n            if (typeof line === \"string\")\r\n            {\r\n                if(line === \"last\")\r\n                {\r\n                    line = count;\r\n                }\r\n            \r\n                if (line === \"first\")\r\n                {\r\n                    line = 1;\r\n                }\r\n            }\r\n            \r\n            if (typeof line !== \"number\") \r\n            {  \r\n                alert(\"Error: The line number must be an integer.\");\r\n                return this;\r\n            }\r\n            \r\n            line  = parseInt(line) - 1;\r\n            \r\n            if (line > count)\r\n            {\r\n                alert(\"Error: The line number range 1-\" + count);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            cm.setCursor( {line : line, ch : 0} );\r\n            \r\n            var scrollInfo   = cm.getScrollInfo();\r\n            var clientHeight = scrollInfo.clientHeight; \r\n            var coords       = cm.charCoords({line : line, ch : 0}, \"local\");\r\n            \r\n            cm.scrollTo(null, (coords.top + coords.bottom - clientHeight) / 2);\r\n            \r\n            if (settings.watch)\r\n            {            \r\n                var cmScroll  = this.codeMirror.find(\".CodeMirror-scroll\")[0];\r\n                var height    = $(cmScroll).height(); \r\n                var scrollTop = cmScroll.scrollTop;         \r\n                var percent   = (scrollTop / cmScroll.scrollHeight);\r\n\r\n                if (scrollTop === 0)\r\n                {\r\n                    preview.scrollTop(0);\r\n                } \r\n                else if (scrollTop + height >= cmScroll.scrollHeight - 16)\r\n                { \r\n                    preview.scrollTop(preview[0].scrollHeight);                    \r\n                } \r\n                else\r\n                {                    \r\n                    preview.scrollTop(preview[0].scrollHeight * percent);\r\n                }\r\n            }\r\n\r\n            cm.focus();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 扩展当前实例对象，可同时设置多个或者只设置一个\r\n         * Extend editormd instance object, can mutil setting.\r\n         * \r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        extend : function() {\r\n            if (typeof arguments[1] !== \"undefined\")\r\n            {\r\n                if (typeof arguments[1] === \"function\")\r\n                {\r\n                    arguments[1] = $.proxy(arguments[1], this);\r\n                }\r\n\r\n                this[arguments[0]] = arguments[1];\r\n            }\r\n            \r\n            if (typeof arguments[0] === \"object\" && typeof arguments[0].length === \"undefined\")\r\n            {\r\n                $.extend(true, this, arguments[0]);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置或扩展当前实例对象，单个设置\r\n         * Extend editormd instance object, one by one\r\n         * \r\n         * @param   {String|Object}   key       option key\r\n         * @param   {String|Object}   value     option value\r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        set : function (key, value) {\r\n            \r\n            if (typeof value !== \"undefined\" && typeof value === \"function\")\r\n            {\r\n                value = $.proxy(value, this);\r\n            }\r\n            \r\n            this[key] = value;\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 重新配置\r\n         * Resetting editor options\r\n         * \r\n         * @param   {String|Object}   key       option key\r\n         * @param   {String|Object}   value     option value\r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        config : function(key, value) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof key === \"object\")\r\n            {\r\n                settings = $.extend(true, settings, key);\r\n            }\r\n            \r\n            if (typeof key === \"string\")\r\n            {\r\n                settings[key] = value;\r\n            }\r\n            \r\n            this.settings = settings;\r\n            this.recreate();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 注册事件处理方法\r\n         * Bind editor event handle\r\n         * \r\n         * @param   {String}     eventType      event type\r\n         * @param   {Function}   callback       回调函数\r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        on : function(eventType, callback) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof settings[\"on\" + eventType] !== \"undefined\") \r\n            {                \r\n                settings[\"on\" + eventType] = $.proxy(callback, this);      \r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 解除事件处理方法\r\n         * Unbind editor event handle\r\n         * \r\n         * @param   {String}   eventType          event type\r\n         * @returns {editormd}                    this(editormd instance object.)\r\n         */\r\n        \r\n        off : function(eventType) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof settings[\"on\" + eventType] !== \"undefined\") \r\n            {\r\n                settings[\"on\" + eventType] = function(){};\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 显示工具栏\r\n         * Display toolbar\r\n         * \r\n         * @param   {Function} [callback=function(){}] 回调函数\r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        showToolbar : function(callback) {\r\n            var settings = this.settings;\r\n            \r\n            if(settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            if (settings.toolbar && (this.toolbar.length < 1 || this.toolbar.find(\".\" + this.classPrefix + \"menu\").html() === \"\") )\r\n            {\r\n                this.setToolbar();\r\n            }\r\n            \r\n            settings.toolbar = true; \r\n            \r\n            this.toolbar.show();\r\n            this.resize();\r\n            \r\n            $.proxy(callback || function(){}, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 隐藏工具栏\r\n         * Hide toolbar\r\n         * \r\n         * @param   {Function} [callback=function(){}] 回调函数\r\n         * @returns {editormd}                         this(editormd instance object.)\r\n         */\r\n        \r\n        hideToolbar : function(callback) { \r\n            var settings = this.settings;\r\n            \r\n            settings.toolbar = false;  \r\n            this.toolbar.hide();\r\n            this.resize();\r\n            \r\n            $.proxy(callback || function(){}, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 页面滚动时工具栏的固定定位\r\n         * Set toolbar in window scroll auto fixed position\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setToolbarAutoFixed : function(fixed) {\r\n            \r\n            var state    = this.state;\r\n            var editor   = this.editor;\r\n            var toolbar  = this.toolbar;\r\n            var settings = this.settings;\r\n            \r\n            if (typeof fixed !== \"undefined\")\r\n            {\r\n                settings.toolbarAutoFixed = fixed;\r\n            }\r\n            \r\n            var autoFixedHandle = function(){\r\n                var $window = $(window);\r\n                var top     = $window.scrollTop();\r\n                \r\n                if (!settings.toolbarAutoFixed)\r\n                {\r\n                    return false;\r\n                }\r\n\r\n                if (top - editor.offset().top > 10 && top < editor.height())\r\n                {\r\n                    toolbar.css({\r\n                        position : \"fixed\",\r\n                        width    : editor.width() + \"px\",\r\n                        left     : ($window.width() - editor.width()) / 2 + \"px\"\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    toolbar.css({\r\n                        position : \"absolute\",\r\n                        width    : \"100%\",\r\n                        left     : 0\r\n                    });\r\n                }\r\n            };\r\n            \r\n            if (!state.fullscreen && !state.preview && settings.toolbar && settings.toolbarAutoFixed)\r\n            {\r\n                $(window).bind(\"scroll\", autoFixedHandle);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 配置和初始化工具栏\r\n         * Set toolbar and Initialization\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setToolbar : function() {\r\n            var settings    = this.settings;  \r\n            \r\n            if(settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            var editor      = this.editor;\r\n            var preview     = this.preview;\r\n            var classPrefix = this.classPrefix;\r\n            \r\n            var toolbar     = this.toolbar = editor.children(\".\" + classPrefix + \"toolbar\");\r\n            \r\n            if (settings.toolbar && toolbar.length < 1)\r\n            {            \r\n                var toolbarHTML = \"<div class=\\\"\" + classPrefix + \"toolbar\\\"><div class=\\\"\" + classPrefix + \"toolbar-container\\\"><ul class=\\\"\" + classPrefix + \"menu\\\"></ul></div></div>\";\r\n                \r\n                editor.append(toolbarHTML);\r\n                toolbar = this.toolbar = editor.children(\".\" + classPrefix + \"toolbar\");\r\n            }\r\n            \r\n            if (!settings.toolbar) \r\n            {\r\n                toolbar.hide();\r\n                \r\n                return this;\r\n            }\r\n            \r\n            toolbar.show();\r\n            \r\n            var icons       = (typeof settings.toolbarIcons === \"function\") ? settings.toolbarIcons() \r\n                            : ((typeof settings.toolbarIcons === \"string\")  ? editormd.toolbarModes[settings.toolbarIcons] : settings.toolbarIcons);\r\n            \r\n            var toolbarMenu = toolbar.find(\".\" + this.classPrefix + \"menu\"), menu = \"\";\r\n            var pullRight   = false;\r\n            \r\n            for (var i = 0, len = icons.length; i < len; i++)\r\n            {\r\n                var name = icons[i];\r\n\r\n                if (name === \"||\") \r\n                { \r\n                    pullRight = true;\r\n                } \r\n                else if (name === \"|\")\r\n                {\r\n                    menu += \"<li class=\\\"divider\\\" unselectable=\\\"on\\\">|</li>\";\r\n                }\r\n                else\r\n                {\r\n                    var isHeader = (/h(\\d)/.test(name));\r\n                    var index    = name;\r\n                    \r\n                    if (name === \"watch\" && !settings.watch) {\r\n                        index = \"unwatch\";\r\n                    }\r\n                    \r\n                    var title     = settings.lang.toolbar[index];\r\n                    var iconTexts = settings.toolbarIconTexts[index];\r\n                    var iconClass = settings.toolbarIconsClass[index];\r\n                    \r\n                    title     = (typeof title     === \"undefined\") ? \"\" : title;\r\n                    iconTexts = (typeof iconTexts === \"undefined\") ? \"\" : iconTexts;\r\n                    iconClass = (typeof iconClass === \"undefined\") ? \"\" : iconClass;\r\n\r\n                    var menuItem = pullRight ? \"<li class=\\\"pull-right\\\">\" : \"<li>\";\r\n                    \r\n                    if (typeof settings.toolbarCustomIcons[name] !== \"undefined\" && typeof settings.toolbarCustomIcons[name] !== \"function\")\r\n                    {\r\n                        menuItem += settings.toolbarCustomIcons[name];\r\n                    }\r\n                    else \r\n                    {\r\n                        menuItem += \"<a href=\\\"javascript:;\\\" title=\\\"\" + title + \"\\\" unselectable=\\\"on\\\">\";\r\n                        menuItem += \"<i class=\\\"fa \" + iconClass + \"\\\" name=\\\"\"+name+\"\\\" unselectable=\\\"on\\\">\"+((isHeader) ? name.toUpperCase() : ( (iconClass === \"\") ? iconTexts : \"\") ) + \"</i>\";\r\n                        menuItem += \"</a>\";\r\n                    }\r\n\r\n                    menuItem += \"</li>\";\r\n\r\n                    menu = pullRight ? menuItem + menu : menu + menuItem;\r\n                }\r\n            }\r\n\r\n            toolbarMenu.html(menu);\r\n            \r\n            toolbarMenu.find(\"[title=\\\"Lowercase\\\"]\").attr(\"title\", settings.lang.toolbar.lowercase);\r\n            toolbarMenu.find(\"[title=\\\"ucwords\\\"]\").attr(\"title\", settings.lang.toolbar.ucwords);\r\n            \r\n            this.setToolbarHandler();\r\n            this.setToolbarAutoFixed();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 工具栏图标事件处理对象序列\r\n         * Get toolbar icons event handlers\r\n         * \r\n         * @param   {Object}   cm    CodeMirror的实例对象\r\n         * @param   {String}   name  要获取的事件处理器名称\r\n         * @returns {Object}         返回处理对象序列\r\n         */\r\n            \r\n        dialogLockScreen : function() {\r\n            $.proxy(editormd.dialogLockScreen, this)();\r\n            \r\n            return this;\r\n        },\r\n\r\n        dialogShowMask : function(dialog) {\r\n            $.proxy(editormd.dialogShowMask, this)(dialog);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        getToolbarHandles : function(name) {  \r\n            var toolbarHandlers = this.toolbarHandlers = editormd.toolbarHandlers;\r\n            \r\n            return (name && typeof toolbarIconHandlers[name] !== \"undefined\") ? toolbarHandlers[name] : toolbarHandlers;\r\n        },\r\n        \r\n        /**\r\n         * 工具栏图标事件处理器\r\n         * Bind toolbar icons event handle\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        setToolbarHandler : function() {\r\n            var _this               = this;\r\n            var settings            = this.settings;\r\n            \r\n            if (!settings.toolbar || settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            var toolbar             = this.toolbar;\r\n            var cm                  = this.cm;\r\n            var classPrefix         = this.classPrefix;           \r\n            var toolbarIcons        = this.toolbarIcons = toolbar.find(\".\" + classPrefix + \"menu > li > a\");  \r\n            var toolbarIconHandlers = this.getToolbarHandles();  \r\n                \r\n            toolbarIcons.bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function(event) {\r\n\r\n                var icon                = $(this).children(\".fa\");\r\n                var name                = icon.attr(\"name\");\r\n                var cursor              = cm.getCursor();\r\n                var selection           = cm.getSelection();\r\n\r\n                if (name === \"\") {\r\n                    return ;\r\n                }\r\n                \r\n                _this.activeIcon = icon;\r\n\r\n                if (typeof toolbarIconHandlers[name] !== \"undefined\") \r\n                {\r\n                    $.proxy(toolbarIconHandlers[name], _this)(cm);\r\n                }\r\n                else \r\n                {\r\n                    if (typeof settings.toolbarHandlers[name] !== \"undefined\") \r\n                    {\r\n                        $.proxy(settings.toolbarHandlers[name], _this)(cm, icon, cursor, selection);\r\n                    }\r\n                }\r\n                \r\n                if (name !== \"link\" && name !== \"reference-link\" && name !== \"image\" && name !== \"code-block\" && \r\n                    name !== \"preformatted-text\" && name !== \"watch\" && name !== \"preview\" && name !== \"search\" && name !== \"fullscreen\" && name !== \"info\") \r\n                {\r\n                    cm.focus();\r\n                }\r\n\r\n                return false;\r\n\r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 动态创建对话框\r\n         * Creating custom dialogs\r\n         * \r\n         * @param   {Object} options  配置项键值对 Key/Value\r\n         * @returns {dialog}          返回创建的dialog的jQuery实例对象\r\n         */\r\n        \r\n        createDialog : function(options) {            \r\n            return $.proxy(editormd.createDialog, this)(options);\r\n        },\r\n        \r\n        /**\r\n         * 创建关于Editor.md的对话框\r\n         * Create about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        createInfoDialog : function() {\r\n            var _this        = this;\r\n\t\t\tvar editor       = this.editor;\r\n            var classPrefix  = this.classPrefix;  \r\n            \r\n            var infoDialogHTML = [\r\n                \"<div class=\\\"\" + classPrefix + \"dialog \" + classPrefix + \"dialog-info\\\" style=\\\"\\\">\",\r\n                \"<div class=\\\"\" + classPrefix + \"dialog-container\\\">\",\r\n                \"<h1><i class=\\\"editormd-logo editormd-logo-lg editormd-logo-color\\\"></i> \" + editormd.title + \"<small>v\" + editormd.version + \"</small></h1>\",\r\n                \"<p>\" + this.lang.description + \"</p>\",\r\n                \"<p style=\\\"margin: 10px 0 20px 0;\\\"><a href=\\\"\" + editormd.homePage + \"\\\" target=\\\"_blank\\\">\" + editormd.homePage + \" <i class=\\\"fa fa-external-link\\\"></i></a></p>\",\r\n                \"<p style=\\\"font-size: 0.85em;\\\">Copyright &copy; 2015 <a href=\\\"https://github.com/pandao\\\" target=\\\"_blank\\\" class=\\\"hover-link\\\">Pandao</a>, The <a href=\\\"https://github.com/pandao/editor.md/blob/master/LICENSE\\\" target=\\\"_blank\\\" class=\\\"hover-link\\\">MIT</a> License.</p>\",\r\n                \"</div>\",\r\n                \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"dialog-close\\\"></a>\",\r\n                \"</div>\"\r\n            ].join(\"\\n\");\r\n\r\n            editor.append(infoDialogHTML);\r\n            \r\n            var infoDialog  = this.infoDialog = editor.children(\".\" + classPrefix + \"dialog-info\");\r\n\r\n            infoDialog.find(\".\" + classPrefix + \"dialog-close\").bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function() {\r\n                _this.hideInfoDialog();\r\n            });\r\n            \r\n            infoDialog.css(\"border\", (editormd.isIE8) ? \"1px solid #ddd\" : \"\").css(\"z-index\", editormd.dialogZindex).show();\r\n            \r\n            this.infoDialogPosition();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 关于Editor.md对话居中定位\r\n         * Editor.md dialog position handle\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        infoDialogPosition : function() {\r\n            var infoDialog = this.infoDialog;\r\n            \r\n\t\t\tvar _infoDialogPosition = function() {\r\n\t\t\t\tinfoDialog.css({\r\n\t\t\t\t\ttop  : ($(window).height() - infoDialog.height()) / 2 + \"px\",\r\n\t\t\t\t\tleft : ($(window).width()  - infoDialog.width()) / 2  + \"px\"\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t_infoDialogPosition();\r\n\r\n\t\t\t$(window).resize(_infoDialogPosition);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 显示关于Editor.md\r\n         * Display about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        showInfoDialog : function() {\r\n\r\n            $(\"html,body\").css(\"overflow-x\", \"hidden\");\r\n            \r\n            var _this       = this;\r\n\t\t\tvar editor      = this.editor;\r\n            var settings    = this.settings;         \r\n\t\t\tvar infoDialog  = this.infoDialog = editor.children(\".\" + this.classPrefix + \"dialog-info\");\r\n            \r\n            if (infoDialog.length < 1)\r\n            {\r\n                this.createInfoDialog();\r\n            }\r\n            \r\n            this.lockScreen(true);\r\n            \r\n            this.mask.css({\r\n\t\t\t\t\t\topacity         : settings.dialogMaskOpacity,\r\n\t\t\t\t\t\tbackgroundColor : settings.dialogMaskBgColor\r\n\t\t\t\t\t}).show();\r\n\r\n\t\t\tinfoDialog.css(\"z-index\", editormd.dialogZindex).show();\r\n\r\n\t\t\tthis.infoDialogPosition();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 隐藏关于Editor.md\r\n         * Hide about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        hideInfoDialog : function() {            \r\n            $(\"html,body\").css(\"overflow-x\", \"\");\r\n            this.infoDialog.hide();\r\n            this.mask.hide();\r\n            this.lockScreen(false);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 锁屏\r\n         * lock screen\r\n         * \r\n         * @param   {Boolean}    lock    Boolean 布尔值，是否锁屏\r\n         * @returns {editormd}           返回editormd的实例对象\r\n         */\r\n        \r\n        lockScreen : function(lock) {\r\n            editormd.lockScreen(lock);\r\n            this.resize();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 编辑器界面重建，用于动态语言包或模块加载等\r\n         * Recreate editor\r\n         * \r\n         * @returns {editormd}  返回editormd的实例对象\r\n         */\r\n        \r\n        recreate : function() {\r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var settings         = this.settings;\r\n            \r\n            this.codeMirror.remove();\r\n            \r\n            this.setCodeMirror();\r\n\r\n            if (!settings.readOnly) \r\n            {\r\n                if (editor.find(\".editormd-dialog\").length > 0) {\r\n                    editor.find(\".editormd-dialog\").remove();\r\n                }\r\n                \r\n                if (settings.toolbar) \r\n                {  \r\n                    this.getToolbarHandles();                  \r\n                    this.setToolbar();\r\n                }\r\n            }\r\n            \r\n            this.loadedDisplay(true);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 高亮预览HTML的pre代码部分\r\n         * highlight of preview codes\r\n         * \r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        previewCodeHighlight : function() {    \r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if (settings.previewCodeHighlight) \r\n            {\r\n                previewContainer.find(\"pre\").addClass(\"prettyprint linenums\");\r\n                \r\n                if (typeof prettyPrint !== \"undefined\")\r\n                {                    \r\n                    prettyPrint();\r\n                }\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 解析TeX(KaTeX)科学公式\r\n         * TeX(KaTeX) Renderer\r\n         * \r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        katexRender : function() {\r\n            \r\n            if (timer === null)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            this.previewContainer.find(\".\" + editormd.classNames.tex).each(function(){\r\n                var tex  = $(this);\r\n                editormd.$katex.render(tex.text(), tex[0]);\r\n                \r\n                tex.find(\".katex\").css(\"font-size\", \"1.6em\");\r\n            });   \r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 解析和渲染流程图及时序图\r\n         * FlowChart and SequenceDiagram Renderer\r\n         * \r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        flowChartAndSequenceDiagramRender : function() {\r\n            var $this            = this;\r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if (editormd.isIE8) {\r\n                return this;\r\n            }\r\n\r\n            if (settings.flowChart) {\r\n                if (flowchartTimer === null) {\r\n                    return this;\r\n                }\r\n                \r\n                previewContainer.find(\".flowchart\").flowChart(); \r\n            }\r\n\r\n            if (settings.sequenceDiagram) {\r\n                previewContainer.find(\".sequence-diagram\").sequenceDiagram({theme: \"simple\"});\r\n            }\r\n                    \r\n            var preview    = $this.preview;\r\n            var codeMirror = $this.codeMirror;\r\n            var codeView   = codeMirror.find(\".CodeMirror-scroll\");\r\n\r\n            var height    = codeView.height();\r\n            var scrollTop = codeView.scrollTop();                    \r\n            var percent   = (scrollTop / codeView[0].scrollHeight);\r\n            var tocHeight = 0;\r\n\r\n            preview.find(\".markdown-toc-list\").each(function(){\r\n                tocHeight += $(this).height();\r\n            });\r\n\r\n            var tocMenuHeight = preview.find(\".editormd-toc-menu\").height(); \r\n            tocMenuHeight = (!tocMenuHeight) ? 0 : tocMenuHeight;\r\n\r\n            if (scrollTop === 0) \r\n            {\r\n                preview.scrollTop(0);\r\n            } \r\n            else if (scrollTop + height >= codeView[0].scrollHeight - 16)\r\n            { \r\n                preview.scrollTop(preview[0].scrollHeight);                        \r\n            } \r\n            else\r\n            {                  \r\n                preview.scrollTop((preview[0].scrollHeight + tocHeight + tocMenuHeight) * percent);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 注册键盘快捷键处理\r\n         * Register CodeMirror keyMaps (keyboard shortcuts).\r\n         * \r\n         * @param   {Object}    keyMap      KeyMap key/value {\"(Ctrl/Shift/Alt)-Key\" : function(){}}\r\n         * @returns {editormd}              return this\r\n         */\r\n        \r\n        registerKeyMaps : function(keyMap) {\r\n            \r\n            var _this           = this;\r\n            var cm              = this.cm;\r\n            var settings        = this.settings;\r\n            var toolbarHandlers = editormd.toolbarHandlers;\r\n            var disabledKeyMaps = settings.disabledKeyMaps;\r\n            \r\n            keyMap              = keyMap || null;\r\n            \r\n            if (keyMap)\r\n            {\r\n                for (var i in keyMap)\r\n                {\r\n                    if ($.inArray(i, disabledKeyMaps) < 0)\r\n                    {\r\n                        var map = {};\r\n                        map[i]  = keyMap[i];\r\n\r\n                        cm.addKeyMap(keyMap);\r\n                    }\r\n                }\r\n            }\r\n            else\r\n            {\r\n                for (var k in editormd.keyMaps)\r\n                {\r\n                    var _keyMap = editormd.keyMaps[k];\r\n                    var handle = (typeof _keyMap === \"string\") ? $.proxy(toolbarHandlers[_keyMap], _this) : $.proxy(_keyMap, _this);\r\n                    \r\n                    if ($.inArray(k, [\"F9\", \"F10\", \"F11\"]) < 0 && $.inArray(k, disabledKeyMaps) < 0)\r\n                    {\r\n                        var _map = {};\r\n                        _map[k] = handle;\r\n\r\n                        cm.addKeyMap(_map);\r\n                    }\r\n                }\r\n                \r\n                $(window).keydown(function(event) {\r\n                    \r\n                    var keymaps = {\r\n                        \"120\" : \"F9\",\r\n                        \"121\" : \"F10\",\r\n                        \"122\" : \"F11\"\r\n                    };\r\n                    \r\n                    if ( $.inArray(keymaps[event.keyCode], disabledKeyMaps) < 0 )\r\n                    {\r\n                        switch (event.keyCode)\r\n                        {\r\n                            case 120:\r\n                                    $.proxy(toolbarHandlers[\"watch\"], _this)();\r\n                                    return false;\r\n                                break;\r\n                                \r\n                            case 121:\r\n                                    $.proxy(toolbarHandlers[\"preview\"], _this)();\r\n                                    return false;\r\n                                break;\r\n                                \r\n                            case 122:\r\n                                    $.proxy(toolbarHandlers[\"fullscreen\"], _this)();                        \r\n                                    return false;\r\n                                break;\r\n                                \r\n                            default:\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 绑定同步滚动\r\n         * \r\n         * @returns {editormd} return this\r\n         */\r\n        \r\n        bindScrollEvent : function() {\r\n            \r\n            var _this            = this;\r\n            var preview          = this.preview;\r\n            var settings         = this.settings;\r\n            var codeMirror       = this.codeMirror;\r\n            var mouseOrTouch     = editormd.mouseOrTouch;\r\n            \r\n            if (!settings.syncScrolling) {\r\n                return this;\r\n            }\r\n                \r\n            var cmBindScroll = function() {    \r\n                codeMirror.find(\".CodeMirror-scroll\").bind(mouseOrTouch(\"scroll\", \"touchmove\"), function(event) {\r\n                    var height    = $(this).height();\r\n                    var scrollTop = $(this).scrollTop();                    \r\n                    var percent   = (scrollTop / $(this)[0].scrollHeight);\r\n                    \r\n                    var tocHeight = 0;\r\n                    \r\n                    preview.find(\".markdown-toc-list\").each(function(){\r\n                        tocHeight += $(this).height();\r\n                    });\r\n                    \r\n                    var tocMenuHeight = preview.find(\".editormd-toc-menu\").height();\r\n                    tocMenuHeight = (!tocMenuHeight) ? 0 : tocMenuHeight;\r\n\r\n                    if (scrollTop === 0) \r\n                    {\r\n                        preview.scrollTop(0);\r\n                    } \r\n                    else if (scrollTop + height >= $(this)[0].scrollHeight - 16)\r\n                    { \r\n                        preview.scrollTop(preview[0].scrollHeight);                        \r\n                    } \r\n                    else\r\n                    {\r\n                        preview.scrollTop((preview[0].scrollHeight  + tocHeight + tocMenuHeight) * percent);\r\n                    }\r\n                    \r\n                    $.proxy(settings.onscroll, _this)(event);\r\n                });\r\n            };\r\n\r\n            var cmUnbindScroll = function() {\r\n                codeMirror.find(\".CodeMirror-scroll\").unbind(mouseOrTouch(\"scroll\", \"touchmove\"));\r\n            };\r\n\r\n            var previewBindScroll = function() {\r\n                \r\n                preview.bind(mouseOrTouch(\"scroll\", \"touchmove\"), function(event) {\r\n                    var height    = $(this).height();\r\n                    var scrollTop = $(this).scrollTop();         \r\n                    var percent   = (scrollTop / $(this)[0].scrollHeight);\r\n                    var codeView  = codeMirror.find(\".CodeMirror-scroll\");\r\n\r\n                    if(scrollTop === 0) \r\n                    {\r\n                        codeView.scrollTop(0);\r\n                    }\r\n                    else if (scrollTop + height >= $(this)[0].scrollHeight)\r\n                    {\r\n                        codeView.scrollTop(codeView[0].scrollHeight);                        \r\n                    }\r\n                    else \r\n                    {\r\n                        codeView.scrollTop(codeView[0].scrollHeight * percent);\r\n                    }\r\n                    \r\n                    $.proxy(settings.onpreviewscroll, _this)(event);\r\n                });\r\n\r\n            };\r\n\r\n            var previewUnbindScroll = function() {\r\n                preview.unbind(mouseOrTouch(\"scroll\", \"touchmove\"));\r\n            }; \r\n\r\n\t\t\tcodeMirror.bind({\r\n\t\t\t\tmouseover  : cmBindScroll,\r\n\t\t\t\tmouseout   : cmUnbindScroll,\r\n\t\t\t\ttouchstart : cmBindScroll,\r\n\t\t\t\ttouchend   : cmUnbindScroll\r\n\t\t\t});\r\n            \r\n            if (settings.syncScrolling === \"single\") {\r\n                return this;\r\n            }\r\n            \r\n\t\t\tpreview.bind({\r\n\t\t\t\tmouseover  : previewBindScroll,\r\n\t\t\t\tmouseout   : previewUnbindScroll,\r\n\t\t\t\ttouchstart : previewBindScroll,\r\n\t\t\t\ttouchend   : previewUnbindScroll\r\n\t\t\t});\r\n\r\n            return this;\r\n        },\r\n        \r\n        bindChangeEvent : function() {\r\n            \r\n            var _this            = this;\r\n            var cm               = this.cm;\r\n            var settings         = this.settings;\r\n            \r\n            if (!settings.syncScrolling) {\r\n                return this;\r\n            }\r\n            \r\n            cm.on(\"change\", function(_cm, changeObj) {\r\n                \r\n                if (settings.watch)\r\n                {\r\n                    _this.previewContainer.css(\"padding\", settings.autoHeight ? \"20px 20px 50px 40px\" : \"20px\");\r\n                }\r\n                \r\n                timer = setTimeout(function() {\r\n                    clearTimeout(timer);\r\n                    _this.save();\r\n                    timer = null;\r\n                }, settings.delay);\r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 加载队列完成之后的显示处理\r\n         * Display handle of the module queues loaded after.\r\n         * \r\n         * @param   {Boolean}   recreate   是否为重建编辑器\r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        loadedDisplay : function(recreate) {\r\n            \r\n            recreate             = recreate || false;\r\n            \r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var settings         = this.settings;\r\n            \r\n            this.containerMask.hide();\r\n            \r\n            this.save();\r\n            \r\n            if (settings.watch) {\r\n                preview.show();\r\n            }\r\n            \r\n            editor.data(\"oldWidth\", editor.width()).data(\"oldHeight\", editor.height()); // 为了兼容Zepto\r\n            \r\n            this.resize();\r\n            this.registerKeyMaps();\r\n            \r\n            $(window).resize(function(){\r\n                _this.resize();\r\n            });\r\n            \r\n            this.bindScrollEvent().bindChangeEvent();\r\n            \r\n            if (!recreate)\r\n            {\r\n                $.proxy(settings.onload, this)();\r\n            }\r\n            \r\n            this.state.loaded = true;\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置编辑器的宽度\r\n         * Set editor width\r\n         * \r\n         * @param   {Number|String} width  编辑器宽度值\r\n         * @returns {editormd}             返回editormd的实例对象\r\n         */\r\n        \r\n        width : function(width) {\r\n                \r\n            this.editor.css(\"width\", (typeof width === \"number\") ? width  + \"px\" : width);            \r\n            this.resize();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置编辑器的高度\r\n         * Set editor height\r\n         * \r\n         * @param   {Number|String} height  编辑器高度值\r\n         * @returns {editormd}              返回editormd的实例对象\r\n         */\r\n        \r\n        height : function(height) {\r\n                \r\n            this.editor.css(\"height\", (typeof height === \"number\")  ? height  + \"px\" : height);            \r\n            this.resize();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 调整编辑器的尺寸和布局\r\n         * Resize editor layout\r\n         * \r\n         * @param   {Number|String} [width=null]  编辑器宽度值\r\n         * @param   {Number|String} [height=null] 编辑器高度值\r\n         * @returns {editormd}                    返回editormd的实例对象\r\n         */\r\n        \r\n        resize : function(width, height) {\r\n            \r\n            width  = width  || null;\r\n            height = height || null;\r\n            \r\n            var state      = this.state;\r\n            var editor     = this.editor;\r\n            var preview    = this.preview;\r\n            var toolbar    = this.toolbar;\r\n            var settings   = this.settings;\r\n            var codeMirror = this.codeMirror;\r\n            \r\n            if (width)\r\n            {\r\n                editor.css(\"width\", (typeof width  === \"number\") ? width  + \"px\" : width);\r\n            }\r\n            \r\n            if (settings.autoHeight && !state.fullscreen && !state.preview)\r\n            {\r\n                editor.css(\"height\", \"auto\");\r\n                codeMirror.css(\"height\", \"auto\");\r\n            } \r\n            else \r\n            {\r\n                if (height) \r\n                {\r\n                    editor.css(\"height\", (typeof height === \"number\") ? height + \"px\" : height);\r\n                }\r\n                \r\n                if (state.fullscreen)\r\n                {\r\n                    editor.height($(window).height());\r\n                }\r\n\r\n                if (settings.toolbar && !settings.readOnly) \r\n                {\r\n                    codeMirror.css(\"margin-top\", toolbar.height() + 1).height(editor.height() - toolbar.height());\r\n                } \r\n                else\r\n                {\r\n                    codeMirror.css(\"margin-top\", 0).height(editor.height());\r\n                }\r\n            }\r\n            \r\n            if(settings.watch) \r\n            {\r\n                codeMirror.width(editor.width() / 2);\r\n                preview.width((!state.preview) ? editor.width() / 2 : editor.width());\r\n                \r\n                this.previewContainer.css(\"padding\", settings.autoHeight ? \"20px 20px 50px 40px\" : \"20px\");\r\n                \r\n                if (settings.toolbar && !settings.readOnly) \r\n                {\r\n                    preview.css(\"top\", toolbar.height() + 1);\r\n                } \r\n                else \r\n                {\r\n                    preview.css(\"top\", 0);\r\n                }\r\n                \r\n                if (settings.autoHeight && !state.fullscreen && !state.preview)\r\n                {\r\n                    preview.height(\"\");\r\n                }\r\n                else\r\n                {                \r\n                    var previewHeight = (settings.toolbar && !settings.readOnly) ? editor.height() - toolbar.height() : editor.height();\r\n                    \r\n                    preview.height(previewHeight);\r\n                }\r\n            } \r\n            else \r\n            {\r\n                codeMirror.width(editor.width());\r\n                preview.hide();\r\n            }\r\n            \r\n            if (state.loaded) \r\n            {\r\n                $.proxy(settings.onresize, this)();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 解析和保存Markdown代码\r\n         * Parse & Saving Markdown source code\r\n         * \r\n         * @returns {editormd}     返回editormd的实例对象\r\n         */\r\n        \r\n        save : function() {\r\n            \r\n            var _this            = this;\r\n            var state            = this.state;\r\n            var settings         = this.settings;\r\n\r\n            if (timer === null && !(!settings.watch && state.preview))\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            var cm               = this.cm;            \r\n            var cmValue          = cm.getValue();\r\n            var previewContainer = this.previewContainer;\r\n\r\n            if (settings.mode !== \"gfm\" && settings.mode !== \"markdown\") \r\n            {\r\n                this.markdownTextarea.val(cmValue);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            var marked          = editormd.$marked;\r\n            var markdownToC     = this.markdownToC = [];            \r\n            var rendererOptions = this.markedRendererOptions = {  \r\n                toc                  : settings.toc,\r\n                tocm                 : settings.tocm,\r\n                tocStartLevel        : settings.tocStartLevel,\r\n                pageBreak            : settings.pageBreak,\r\n                taskList             : settings.taskList,\r\n                emoji                : settings.emoji,\r\n                tex                  : settings.tex,\r\n                atLink               : settings.atLink,           // for @link\r\n                emailLink            : settings.emailLink,        // for mail address auto link\r\n                flowChart            : settings.flowChart,\r\n                sequenceDiagram      : settings.sequenceDiagram,\r\n                previewCodeHighlight : settings.previewCodeHighlight,\r\n            };\r\n            \r\n            var markedOptions = this.markedOptions = {\r\n                renderer    : editormd.markedRenderer(markdownToC, rendererOptions),\r\n                gfm         : true,\r\n                tables      : true,\r\n                breaks      : true,\r\n                pedantic    : false,\r\n                sanitize    : (settings.htmlDecode) ? false : true,  // 关闭忽略HTML标签，即开启识别HTML标签，默认为false\r\n                smartLists  : true,\r\n                smartypants : true\r\n            };\r\n            \r\n            marked.setOptions(markedOptions);\r\n                    \r\n            var newMarkdownDoc = editormd.$marked(cmValue, markedOptions);\r\n            \r\n            //console.info(\"cmValue\", cmValue, newMarkdownDoc);\r\n            \r\n            newMarkdownDoc = editormd.filterHTMLTags(newMarkdownDoc, settings.htmlDecode);\r\n            \r\n            //console.error(\"cmValue\", cmValue, newMarkdownDoc);\r\n            \r\n            this.markdownTextarea.text(cmValue);\r\n            \r\n            cm.save();\r\n            \r\n            if (settings.saveHTMLToTextarea) \r\n            {\r\n                this.htmlTextarea.text(newMarkdownDoc);\r\n            }\r\n            \r\n            if(settings.watch || (!settings.watch && state.preview))\r\n            {\r\n                previewContainer.html(newMarkdownDoc);\r\n\r\n                this.previewCodeHighlight();\r\n                \r\n                if (settings.toc) \r\n                {\r\n                    var tocContainer = (settings.tocContainer === \"\") ? previewContainer : $(settings.tocContainer);\r\n                    var tocMenu      = tocContainer.find(\".\" + this.classPrefix + \"toc-menu\");\r\n                    \r\n                    tocContainer.attr(\"previewContainer\", (settings.tocContainer === \"\") ? \"true\" : \"false\");\r\n                    \r\n                    if (settings.tocContainer !== \"\" && tocMenu.length > 0)\r\n                    {\r\n                        tocMenu.remove();\r\n                    }\r\n                    \r\n                    editormd.markdownToCRenderer(markdownToC, tocContainer, settings.tocDropdown, settings.tocStartLevel);\r\n            \r\n                    if (settings.tocDropdown || tocContainer.find(\".\" + this.classPrefix + \"toc-menu\").length > 0)\r\n                    {\r\n                        editormd.tocDropdownMenu(tocContainer, (settings.tocTitle !== \"\") ? settings.tocTitle : this.lang.tocTitle);\r\n                    }\r\n            \r\n                    if (settings.tocContainer !== \"\")\r\n                    {\r\n                        previewContainer.find(\".markdown-toc\").css(\"border\", \"none\");\r\n                    }\r\n                }\r\n                \r\n                if (settings.tex)\r\n                {\r\n                    if (!editormd.kaTeXLoaded && settings.autoLoadModules) \r\n                    {\r\n                        editormd.loadKaTeX(function() {\r\n                            editormd.$katex = katex;\r\n                            editormd.kaTeXLoaded = true;\r\n                            _this.katexRender();\r\n                        });\r\n                    } \r\n                    else \r\n                    {\r\n                        editormd.$katex = katex;\r\n                        this.katexRender();\r\n                    }\r\n                }                \r\n                \r\n                if (settings.flowChart || settings.sequenceDiagram)\r\n                {\r\n                    flowchartTimer = setTimeout(function(){\r\n                        clearTimeout(flowchartTimer);\r\n                        _this.flowChartAndSequenceDiagramRender();\r\n                        flowchartTimer = null;\r\n                    }, 10);\r\n                }\r\n\r\n                if (state.loaded) \r\n                {\r\n                    $.proxy(settings.onchange, this)();\r\n                }\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 聚焦光标位置\r\n         * Focusing the cursor position\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        focus : function() {\r\n            this.cm.focus();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置光标的位置\r\n         * Set cursor position\r\n         * \r\n         * @param   {Object}    cursor 要设置的光标位置键值对象，例：{line:1, ch:0}\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        setCursor : function(cursor) {\r\n            this.cm.setCursor(cursor);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取当前光标的位置\r\n         * Get the current position of the cursor\r\n         * \r\n         * @returns {Cursor}         返回一个光标Cursor对象\r\n         */\r\n        \r\n        getCursor : function() {\r\n            return this.cm.getCursor();\r\n        },\r\n        \r\n        /**\r\n         * 设置光标选中的范围\r\n         * Set cursor selected ranges\r\n         * \r\n         * @param   {Object}    from   开始位置的光标键值对象，例：{line:1, ch:0}\r\n         * @param   {Object}    to     结束位置的光标键值对象，例：{line:1, ch:0}\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        setSelection : function(from, to) {\r\n        \r\n            this.cm.setSelection(from, to);\r\n        \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取光标选中的文本\r\n         * Get the texts from cursor selected\r\n         * \r\n         * @returns {String}         返回选中文本的字符串形式\r\n         */\r\n        \r\n        getSelection : function() {\r\n            return this.cm.getSelection();\r\n        },\r\n        \r\n        /**\r\n         * 设置光标选中的文本范围\r\n         * Set the cursor selection ranges\r\n         * \r\n         * @param   {Array}    ranges  cursor selection ranges array\r\n         * @returns {Array}            return this\r\n         */\r\n        \r\n        setSelections : function(ranges) {\r\n            this.cm.setSelections(ranges);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取光标选中的文本范围\r\n         * Get the cursor selection ranges\r\n         * \r\n         * @returns {Array}         return selection ranges array\r\n         */\r\n        \r\n        getSelections : function() {\r\n            return this.cm.getSelections();\r\n        },\r\n        \r\n        /**\r\n         * 替换当前光标选中的文本或在当前光标处插入新字符\r\n         * Replace the text at the current cursor selected or insert a new character at the current cursor position\r\n         * \r\n         * @param   {String}    value  要插入的字符值\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        replaceSelection : function(value) {\r\n            this.cm.replaceSelection(value);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 在当前光标处插入新字符\r\n         * Insert a new character at the current cursor position\r\n         *\r\n         * 同replaceSelection()方法\r\n         * With the replaceSelection() method\r\n         * \r\n         * @param   {String}    value  要插入的字符值\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        insertValue : function(value) {\r\n            this.replaceSelection(value);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 追加markdown\r\n         * append Markdown to editor\r\n         * \r\n         * @param   {String}    md     要追加的markdown源文档\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        appendMarkdown : function(md) {\r\n            var settings = this.settings;\r\n            var cm       = this.cm;\r\n            \r\n            cm.setValue(cm.getValue() + md);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 设置和传入编辑器的markdown源文档\r\n         * Set Markdown source document\r\n         * \r\n         * @param   {String}    md     要传入的markdown源文档\r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        setMarkdown : function(md) {\r\n            this.cm.setValue(md || this.settings.markdown);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取编辑器的markdown源文档\r\n         * Set Editor.md markdown/CodeMirror value\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        getMarkdown : function() {\r\n            return this.cm.getValue();\r\n        },\r\n        \r\n        /**\r\n         * 获取编辑器的源文档\r\n         * Get CodeMirror value\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        getValue : function() {\r\n            return this.cm.getValue();\r\n        },\r\n        \r\n        /**\r\n         * 设置编辑器的源文档\r\n         * Set CodeMirror value\r\n         * \r\n         * @param   {String}     value   set code/value/string/text\r\n         * @returns {editormd}           返回editormd的实例对象\r\n         */\r\n        \r\n        setValue : function(value) {\r\n            this.cm.setValue(value);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 清空编辑器\r\n         * Empty CodeMirror editor container\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        clear : function() {\r\n            this.cm.setValue(\"\");\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 获取解析后存放在Textarea的HTML源码\r\n         * Get parsed html code from Textarea\r\n         * \r\n         * @returns {String}               返回HTML源码\r\n         */\r\n        \r\n        getHTML : function() {\r\n            if (!this.settings.saveHTMLToTextarea)\r\n            {\r\n                alert(\"Error: settings.saveHTMLToTextarea == false\");\r\n\r\n                return false;\r\n            }\r\n            \r\n            return this.htmlTextarea.val();\r\n        },\r\n        \r\n        /**\r\n         * getHTML()的别名\r\n         * getHTML (alias)\r\n         * \r\n         * @returns {String}           Return html code 返回HTML源码\r\n         */\r\n        \r\n        getTextareaSavedHTML : function() {\r\n            return this.getHTML();\r\n        },\r\n        \r\n        /**\r\n         * 获取预览窗口的HTML源码\r\n         * Get html from preview container\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        getPreviewedHTML : function() {\r\n            if (!this.settings.watch)\r\n            {\r\n                alert(\"Error: settings.watch == false\");\r\n\r\n                return false;\r\n            }\r\n            \r\n            return this.previewContainer.html();\r\n        },\r\n        \r\n        /**\r\n         * 开启实时预览\r\n         * Enable real-time watching\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        watch : function(callback) {     \r\n            var settings        = this.settings;\r\n            \r\n            if ($.inArray(settings.mode, [\"gfm\", \"markdown\"]) < 0)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            this.state.watching = settings.watch = true;\r\n            this.preview.show();\r\n            \r\n            if (this.toolbar)\r\n            {\r\n                var watchIcon   = settings.toolbarIconsClass.watch;\r\n                var unWatchIcon = settings.toolbarIconsClass.unwatch;\r\n                \r\n                var icon        = this.toolbar.find(\".fa[name=watch]\");\r\n                icon.parent().attr(\"title\", settings.lang.toolbar.watch);\r\n                icon.removeClass(unWatchIcon).addClass(watchIcon);\r\n            }\r\n            \r\n            this.codeMirror.css(\"border-right\", \"1px solid #ddd\").width(this.editor.width() / 2); \r\n            \r\n            timer = 0;\r\n            \r\n            this.save().resize();\r\n            \r\n            if (!settings.onwatch)\r\n            {\r\n                settings.onwatch = callback || function() {};\r\n            }\r\n            \r\n            $.proxy(settings.onwatch, this)();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 关闭实时预览\r\n         * Disable real-time watching\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        unwatch : function(callback) {\r\n            var settings        = this.settings;\r\n            this.state.watching = settings.watch = false;\r\n            this.preview.hide();\r\n            \r\n            if (this.toolbar) \r\n            {\r\n                var watchIcon   = settings.toolbarIconsClass.watch;\r\n                var unWatchIcon = settings.toolbarIconsClass.unwatch;\r\n                \r\n                var icon    = this.toolbar.find(\".fa[name=watch]\");\r\n                icon.parent().attr(\"title\", settings.lang.toolbar.unwatch);\r\n                icon.removeClass(watchIcon).addClass(unWatchIcon);\r\n            }\r\n            \r\n            this.codeMirror.css(\"border-right\", \"none\").width(this.editor.width());\r\n            \r\n            this.resize();\r\n            \r\n            if (!settings.onunwatch)\r\n            {\r\n                settings.onunwatch = callback || function() {};\r\n            }\r\n            \r\n            $.proxy(settings.onunwatch, this)();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 显示编辑器\r\n         * Show editor\r\n         * \r\n         * @param   {Function} [callback=function()] 回调函数\r\n         * @returns {editormd}                       返回editormd的实例对象\r\n         */\r\n        \r\n        show : function(callback) {\r\n            callback  = callback || function() {};\r\n            \r\n            var _this = this;\r\n            this.editor.show(0, function() {\r\n                $.proxy(callback, _this)();\r\n            });\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 隐藏编辑器\r\n         * Hide editor\r\n         * \r\n         * @param   {Function} [callback=function()] 回调函数\r\n         * @returns {editormd}                       返回editormd的实例对象\r\n         */\r\n        \r\n        hide : function(callback) {\r\n            callback  = callback || function() {};\r\n            \r\n            var _this = this;\r\n            this.editor.hide(0, function() {\r\n                $.proxy(callback, _this)();\r\n            });\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 隐藏编辑器部分，只预览HTML\r\n         * Enter preview html state\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        previewing : function() {\r\n            \r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var codeMirror       = this.codeMirror;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if ($.inArray(settings.mode, [\"gfm\", \"markdown\"]) < 0) {\r\n                return this;\r\n            }\r\n            \r\n            if (settings.toolbar && toolbar) {\r\n                toolbar.toggle();\r\n                toolbar.find(\".fa[name=preview]\").toggleClass(\"active\");\r\n            }\r\n            \r\n            codeMirror.toggle();\r\n            \r\n            var escHandle = function(event) {\r\n                if (event.shiftKey && event.keyCode === 27) {\r\n                    _this.previewed();\r\n                }\r\n            };\r\n\r\n            if (codeMirror.css(\"display\") === \"none\") // 为了兼容Zepto，而不使用codeMirror.is(\":hidden\")\r\n            {\r\n                this.state.preview = true;\r\n\r\n                if (this.state.fullscreen) {\r\n                    preview.css(\"background\", \"#fff\");\r\n                }\r\n                \r\n                editor.find(\".\" + this.classPrefix + \"preview-close-btn\").show().bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function(){\r\n                    _this.previewed();\r\n                });\r\n            \r\n                if (!settings.watch)\r\n                {\r\n                    this.save();\r\n                } \r\n                else \r\n                {\r\n                    previewContainer.css(\"padding\", \"\");\r\n                }\r\n                \r\n                previewContainer.addClass(this.classPrefix + \"preview-active\");\r\n\r\n                preview.show().css({\r\n                    position  : \"\",\r\n                    top       : 0,\r\n                    width     : editor.width(),\r\n                    height    : (settings.autoHeight && !this.state.fullscreen) ? \"auto\" : editor.height()\r\n                });\r\n                \r\n                if (this.state.loaded)\r\n                {\r\n                    $.proxy(settings.onpreviewing, this)();\r\n                }\r\n\r\n                $(window).bind(\"keyup\", escHandle);\r\n            } \r\n            else \r\n            {\r\n                $(window).unbind(\"keyup\", escHandle);\r\n                this.previewed();\r\n            }\r\n        },\r\n        \r\n        /**\r\n         * 显示编辑器部分，退出只预览HTML\r\n         * Exit preview html state\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        previewed : function() {\r\n            \r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            var previewCloseBtn  = editor.find(\".\" + this.classPrefix + \"preview-close-btn\");\r\n\r\n            this.state.preview   = false;\r\n            \r\n            this.codeMirror.show();\r\n            \r\n            if (settings.toolbar) {\r\n                toolbar.show();\r\n            }\r\n            \r\n            preview[(settings.watch) ? \"show\" : \"hide\"]();\r\n            \r\n            previewCloseBtn.hide().unbind(editormd.mouseOrTouch(\"click\", \"touchend\"));\r\n                \r\n            previewContainer.removeClass(this.classPrefix + \"preview-active\");\r\n                \r\n            if (settings.watch)\r\n            {\r\n                previewContainer.css(\"padding\", \"20px\");\r\n            }\r\n            \r\n            preview.css({ \r\n                background : null,\r\n                position   : \"absolute\",\r\n                width      : editor.width() / 2,\r\n                height     : (settings.autoHeight && !this.state.fullscreen) ? \"auto\" : editor.height() - toolbar.height(),\r\n                top        : (settings.toolbar)    ? toolbar.height() : 0\r\n            });\r\n\r\n            if (this.state.loaded)\r\n            {\r\n                $.proxy(settings.onpreviewed, this)();\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 编辑器全屏显示\r\n         * Fullscreen show\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        fullscreen : function() {\r\n            \r\n            var _this            = this;\r\n            var state            = this.state;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var fullscreenClass  = this.classPrefix + \"fullscreen\";\r\n            \r\n            if (toolbar) {\r\n                toolbar.find(\".fa[name=fullscreen]\").parent().toggleClass(\"active\"); \r\n            }\r\n            \r\n            var escHandle = function(event) {\r\n                if (!event.shiftKey && event.keyCode === 27) \r\n                {\r\n                    if (state.fullscreen)\r\n                    {\r\n                        _this.fullscreenExit();\r\n                    }\r\n                }\r\n            };\r\n\r\n            if (!editor.hasClass(fullscreenClass)) \r\n            {\r\n                state.fullscreen = true;\r\n\r\n                $(\"html,body\").css(\"overflow\", \"hidden\");\r\n                \r\n                editor.css({\r\n                    width    : $(window).width(),\r\n                    height   : $(window).height()\r\n                }).addClass(fullscreenClass);\r\n\r\n                this.resize();\r\n    \r\n                $.proxy(settings.onfullscreen, this)();\r\n\r\n                $(window).bind(\"keyup\", escHandle);\r\n            }\r\n            else\r\n            {           \r\n                $(window).unbind(\"keyup\", escHandle); \r\n                this.fullscreenExit();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 编辑器退出全屏显示\r\n         * Exit fullscreen state\r\n         * \r\n         * @returns {editormd}         返回editormd的实例对象\r\n         */\r\n        \r\n        fullscreenExit : function() {\r\n            \r\n            var editor            = this.editor;\r\n            var settings          = this.settings;\r\n            var toolbar           = this.toolbar;\r\n            var fullscreenClass   = this.classPrefix + \"fullscreen\";  \r\n            \r\n            this.state.fullscreen = false;\r\n            \r\n            if (toolbar) {\r\n                toolbar.find(\".fa[name=fullscreen]\").parent().removeClass(\"active\"); \r\n            }\r\n\r\n            $(\"html,body\").css(\"overflow\", \"\");\r\n\r\n            editor.css({\r\n                width    : editor.data(\"oldWidth\"),\r\n                height   : editor.data(\"oldHeight\")\r\n            }).removeClass(fullscreenClass);\r\n\r\n            this.resize();\r\n            \r\n            $.proxy(settings.onfullscreenExit, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * 加载并执行插件\r\n         * Load and execute the plugin\r\n         * \r\n         * @param   {String}     name    plugin name / function name\r\n         * @param   {String}     path    plugin load path\r\n         * @returns {editormd}           返回editormd的实例对象\r\n         */\r\n        \r\n        executePlugin : function(name, path) {\r\n            \r\n            var _this    = this;\r\n            var cm       = this.cm;\r\n            var settings = this.settings;\r\n            \r\n            path = settings.pluginPath + path;\r\n            \r\n            if (typeof define === \"function\") \r\n            {            \r\n                if (typeof this[name] === \"undefined\")\r\n                {\r\n                    alert(\"Error: \" + name + \" plugin is not found, you are not load this plugin.\");\r\n                    \r\n                    return this;\r\n                }\r\n                \r\n                this[name](cm);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            if ($.inArray(path, editormd.loadFiles.plugin) < 0)\r\n            {\r\n                editormd.loadPlugin(path, function() {\r\n                    editormd.loadPlugins[name] = _this[name];\r\n                    _this[name](cm);\r\n                });\r\n            }\r\n            else\r\n            {\r\n                $.proxy(editormd.loadPlugins[name], this)(cm);\r\n            }\r\n            \r\n            return this;\r\n        },\r\n                \r\n        /**\r\n         * 搜索替换\r\n         * Search & replace\r\n         * \r\n         * @param   {String}     command    CodeMirror serach commands, \"find, fintNext, fintPrev, clearSearch, replace, replaceAll\"\r\n         * @returns {editormd}              return this\r\n         */\r\n        \r\n        search : function(command) {\r\n            var settings = this.settings;\r\n            \r\n            if (!settings.searchReplace)\r\n            {\r\n                alert(\"Error: settings.searchReplace == false\");\r\n                return this;\r\n            }\r\n            \r\n            if (!settings.readOnly)\r\n            {\r\n                this.cm.execCommand(command || \"find\");\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        searchReplace : function() {            \r\n            this.search(\"replace\");\r\n            \r\n            return this;\r\n        },\r\n        \r\n        searchReplaceAll : function() {          \r\n            this.search(\"replaceAll\");\r\n            \r\n            return this;\r\n        }\r\n    };\r\n    \r\n    editormd.fn.init.prototype = editormd.fn; \r\n   \r\n    /**\r\n     * 锁屏\r\n     * lock screen when dialog opening\r\n     * \r\n     * @returns {void}\r\n     */\r\n\r\n    editormd.dialogLockScreen = function() {\r\n        var settings = this.settings || {dialogLockScreen : true};\r\n        \r\n        if (settings.dialogLockScreen) \r\n        {            \r\n            $(\"html,body\").css(\"overflow\", \"hidden\");\r\n            this.resize();\r\n        }\r\n    };\r\n   \r\n    /**\r\n     * 显示透明背景层\r\n     * Display mask layer when dialog opening\r\n     * \r\n     * @param   {Object}     dialog    dialog jQuery object\r\n     * @returns {void}\r\n     */\r\n    \r\n    editormd.dialogShowMask = function(dialog) {\r\n        var editor   = this.editor;\r\n        var settings = this.settings || {dialogShowMask : true};\r\n        \r\n        dialog.css({\r\n            top  : ($(window).height() - dialog.height()) / 2 + \"px\",\r\n            left : ($(window).width()  - dialog.width())  / 2 + \"px\"\r\n        });\r\n\r\n        if (settings.dialogShowMask) {\r\n            editor.children(\".\" + this.classPrefix + \"mask\").css(\"z-index\", parseInt(dialog.css(\"z-index\")) - 1).show();\r\n        }\r\n    };\r\n\r\n    editormd.toolbarHandlers = {\r\n        undo : function() {\r\n            this.cm.undo();\r\n        },\r\n        \r\n        redo : function() {\r\n            this.cm.redo();\r\n        },\r\n        \r\n        bold : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"**\" + selection + \"**\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n        \r\n        del : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"~~\" + selection + \"~~\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n\r\n        italic : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"*\" + selection + \"*\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n\r\n        quote : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"> \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"> \" + selection);\r\n            }\r\n\r\n            //cm.replaceSelection(\"> \" + selection);\r\n            //cm.setCursor(cursor.line, (selection === \"\") ? cursor.ch + 2 : cursor.ch + selection.length + 2);\r\n        },\r\n        \r\n        ucfirst : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(editormd.firstUpperCase(selection));\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        ucwords : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(editormd.wordsFirstUpperCase(selection));\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        uppercase : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(selection.toUpperCase());\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        lowercase : function() {\r\n            var cm         = this.cm;\r\n            var cursor     = cm.getCursor();\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n            \r\n            cm.replaceSelection(selection.toLowerCase());\r\n            cm.setSelections(selections);\r\n        },\r\n\r\n        h1 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"# \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"# \" + selection);\r\n            }\r\n        },\r\n\r\n        h2 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"## \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 3);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"## \" + selection);\r\n            }\r\n        },\r\n\r\n        h3 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 4);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"### \" + selection);\r\n            }\r\n        },\r\n\r\n        h4 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"#### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 5);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"#### \" + selection);\r\n            }\r\n        },\r\n\r\n        h5 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"##### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 6);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"##### \" + selection);\r\n            }\r\n        },\r\n\r\n        h6 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"###### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 7);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"###### \" + selection);\r\n            }\r\n        },\r\n\r\n        \"list-ul\" : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (selection === \"\") \r\n            {\r\n                cm.replaceSelection(\"- \" + selection);\r\n            } \r\n            else \r\n            {\r\n                var selectionText = selection.split(\"\\n\");\r\n\r\n                for (var i = 0, len = selectionText.length; i < len; i++) \r\n                {\r\n                    selectionText[i] = (selectionText[i] === \"\") ? \"\" : \"- \" + selectionText[i];\r\n                }\r\n\r\n                cm.replaceSelection(selectionText.join(\"\\n\"));\r\n            }\r\n        },\r\n\r\n        \"list-ol\" : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if(selection === \"\") \r\n            {\r\n                cm.replaceSelection(\"1. \" + selection);\r\n            }\r\n            else\r\n            {\r\n                var selectionText = selection.split(\"\\n\");\r\n\r\n                for (var i = 0, len = selectionText.length; i < len; i++) \r\n                {\r\n                    selectionText[i] = (selectionText[i] === \"\") ? \"\" : (i+1) + \". \" + selectionText[i];\r\n                }\r\n\r\n                cm.replaceSelection(selectionText.join(\"\\n\"));\r\n            }\r\n        },\r\n\r\n        hr : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(((cursor.ch !== 0) ? \"\\n\\n\" : \"\\n\") + \"------------\\n\\n\");\r\n        },\r\n\r\n        tex : function() {\r\n            if (!this.settings.tex)\r\n            {\r\n                alert(\"settings.tex === false\");\r\n                return this;\r\n            }\r\n            \r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"$$\" + selection + \"$$\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n\r\n        link : function() {\r\n            this.executePlugin(\"linkDialog\", \"link-dialog/link-dialog\");\r\n        },\r\n\r\n        \"reference-link\" : function() {\r\n            this.executePlugin(\"referenceLinkDialog\", \"reference-link-dialog/reference-link-dialog\");\r\n        },\r\n\r\n        pagebreak : function() {\r\n            if (!this.settings.pageBreak)\r\n            {\r\n                alert(\"settings.pageBreak === false\");\r\n                return this;\r\n            }\r\n            \r\n            var cm        = this.cm;\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"\\r\\n[========]\\r\\n\");\r\n        },\r\n\r\n        image : function() {\r\n            this.executePlugin(\"imageDialog\", \"image-dialog/image-dialog\");\r\n        },\r\n        \r\n        code : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"`\" + selection + \"`\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n\r\n        \"code-block\" : function() {\r\n            this.executePlugin(\"codeBlockDialog\", \"code-block-dialog/code-block-dialog\");            \r\n        },\r\n\r\n        \"preformatted-text\" : function() {\r\n            this.executePlugin(\"preformattedTextDialog\", \"preformatted-text-dialog/preformatted-text-dialog\");\r\n        },\r\n        \r\n        table : function() {\r\n            this.executePlugin(\"tableDialog\", \"table-dialog/table-dialog\");         \r\n        },\r\n        \r\n        datetime : function() {\r\n            var cm        = this.cm;\r\n            var selection = cm.getSelection();\r\n            var date      = new Date();\r\n            var langName  = this.settings.lang.name;\r\n            var datefmt   = editormd.dateFormat() + \" \" + editormd.dateFormat((langName === \"zh-cn\" || langName === \"zh-tw\") ? \"cn-week-day\" : \"week-day\");\r\n\r\n            cm.replaceSelection(datefmt);\r\n        },\r\n        \r\n        emoji : function() {\r\n            this.executePlugin(\"emojiDialog\", \"emoji-dialog/emoji-dialog\");\r\n        },\r\n                \r\n        \"html-entities\" : function() {\r\n            this.executePlugin(\"htmlEntitiesDialog\", \"html-entities-dialog/html-entities-dialog\");\r\n        },\r\n                \r\n        \"goto-line\" : function() {\r\n            this.executePlugin(\"gotoLineDialog\", \"goto-line-dialog/goto-line-dialog\");\r\n        },\r\n\r\n        watch : function() {    \r\n            this[this.settings.watch ? \"unwatch\" : \"watch\"]();\r\n        },\r\n\r\n        preview : function() {\r\n            this.previewing();\r\n        },\r\n\r\n        fullscreen : function() {\r\n            this.fullscreen();\r\n        },\r\n\r\n        clear : function() {\r\n            this.clear();\r\n        },\r\n        \r\n        search : function() {\r\n            this.search();\r\n        },\r\n\r\n        help : function() {\r\n            this.executePlugin(\"helpDialog\", \"help-dialog/help-dialog\");\r\n        },\r\n\r\n        info : function() {\r\n            this.showInfoDialog();\r\n        }\r\n    };\r\n    \r\n    editormd.keyMaps = {\r\n        \"Ctrl-1\"       : \"h1\",\r\n        \"Ctrl-2\"       : \"h2\",\r\n        \"Ctrl-3\"       : \"h3\",\r\n        \"Ctrl-4\"       : \"h4\",\r\n        \"Ctrl-5\"       : \"h5\",\r\n        \"Ctrl-6\"       : \"h6\",\r\n        \"Ctrl-B\"       : \"bold\",  // if this is string ==  editormd.toolbarHandlers.xxxx\r\n        \"Ctrl-D\"       : \"datetime\",\r\n        \r\n        \"Ctrl-E\"       : function() { // emoji\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            if (!this.settings.emoji)\r\n            {\r\n                alert(\"Error: settings.emoji == false\");\r\n                return ;\r\n            }\r\n\r\n            cm.replaceSelection(\":\" + selection + \":\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        \"Ctrl-Alt-G\"   : \"goto-line\",\r\n        \"Ctrl-H\"       : \"hr\",\r\n        \"Ctrl-I\"       : \"italic\",\r\n        \"Ctrl-K\"       : \"code\",\r\n        \r\n        \"Ctrl-L\"        : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            var title = (selection === \"\") ? \"\" : \" \\\"\"+selection+\"\\\"\";\r\n\r\n            cm.replaceSelection(\"[\" + selection + \"](\"+title+\")\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        \"Ctrl-U\"         : \"list-ul\",\r\n        \r\n        \"Shift-Ctrl-A\"   : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            if (!this.settings.atLink)\r\n            {\r\n                alert(\"Error: settings.atLink == false\");\r\n                return ;\r\n            }\r\n\r\n            cm.replaceSelection(\"@\" + selection);\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        \r\n        \"Shift-Ctrl-C\"     : \"code\",\r\n        \"Shift-Ctrl-Q\"     : \"quote\",\r\n        \"Shift-Ctrl-S\"     : \"del\",\r\n        \"Shift-Ctrl-K\"     : \"tex\",  // KaTeX\r\n        \r\n        \"Shift-Alt-C\"      : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            cm.replaceSelection([\"```\", selection, \"```\"].join(\"\\n\"));\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 3);\r\n            } \r\n        },\r\n        \r\n        \"Shift-Ctrl-Alt-C\" : \"code-block\",\r\n        \"Shift-Ctrl-H\"     : \"html-entities\",\r\n        \"Shift-Alt-H\"      : \"help\",\r\n        \"Shift-Ctrl-E\"     : \"emoji\",\r\n        \"Shift-Ctrl-U\"     : \"uppercase\",\r\n        \"Shift-Alt-U\"      : \"ucwords\",\r\n        \"Shift-Ctrl-Alt-U\" : \"ucfirst\",\r\n        \"Shift-Alt-L\"      : \"lowercase\",\r\n        \r\n        \"Shift-Ctrl-I\"     : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            var title = (selection === \"\") ? \"\" : \" \\\"\"+selection+\"\\\"\";\r\n\r\n            cm.replaceSelection(\"![\" + selection + \"](\"+title+\")\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 4);\r\n            }\r\n        },\r\n        \r\n        \"Shift-Ctrl-Alt-I\" : \"image\",\r\n        \"Shift-Ctrl-L\"     : \"link\",\r\n        \"Shift-Ctrl-O\"     : \"list-ol\",\r\n        \"Shift-Ctrl-P\"     : \"preformatted-text\",\r\n        \"Shift-Ctrl-T\"     : \"table\",\r\n        \"Shift-Alt-P\"      : \"pagebreak\",\r\n        \"F9\"               : \"watch\",\r\n        \"F10\"              : \"preview\",\r\n        \"F11\"              : \"fullscreen\",\r\n    };\r\n    \r\n    /**\r\n     * 清除字符串两边的空格\r\n     * Clear the space of strings both sides.\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   trimed string    \r\n     */\r\n    \r\n    var trim = function(str) {\r\n        return (!String.prototype.trim) ? str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, \"\") : str.trim();\r\n    };\r\n    \r\n    editormd.trim = trim;\r\n    \r\n    /**\r\n     * 所有单词首字母大写\r\n     * Words first to uppercase\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   string\r\n     */\r\n    \r\n    var ucwords = function (str) {\r\n        return str.toLowerCase().replace(/\\b(\\w)|\\s(\\w)/g, function($1) {  \r\n            return $1.toUpperCase();\r\n        });\r\n    };\r\n    \r\n    editormd.ucwords = editormd.wordsFirstUpperCase = ucwords;\r\n    \r\n    /**\r\n     * 字符串首字母大写\r\n     * Only string first char to uppercase\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   string\r\n     */\r\n    \r\n    var firstUpperCase = function(str) {        \r\n        return str.toLowerCase().replace(/\\b(\\w)/, function($1){\r\n            return $1.toUpperCase();\r\n        });\r\n    };\r\n    \r\n    var ucfirst = firstUpperCase;\r\n    \r\n    editormd.firstUpperCase = editormd.ucfirst = firstUpperCase;\r\n    \r\n    editormd.urls = {\r\n        atLinkBase : \"https://github.com/\"\r\n    };\r\n    \r\n    editormd.regexs = {\r\n        atLink        : /@(\\w+)/g,\r\n        email         : /(\\w+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,\r\n        emailLink     : /(mailto:)?([\\w\\.\\_]+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,\r\n        emoji         : /:([\\w\\+-]+):/g,\r\n        emojiDatetime : /(\\d{2}:\\d{2}:\\d{2})/g,\r\n        twemoji       : /:(tw-([\\w]+)-?(\\w+)?):/g,\r\n        fontAwesome   : /:(fa-([\\w]+)(-(\\w+)){0,}):/g,\r\n        editormdLogo  : /:(editormd-logo-?(\\w+)?):/g,\r\n        pageBreak     : /^\\[[=]{8,}\\]$/\r\n    };\r\n\r\n    // Emoji graphics files url path\r\n    editormd.emoji     = {\r\n        path  : \"https://www.webpagefx.com/tools/emoji-cheat-sheet/graphics/emojis/\",\r\n        ext   : \".png\"\r\n    };\r\n\r\n    // Twitter Emoji (Twemoji)  graphics files url path    \r\n    editormd.twemoji = {\r\n        path : \"http://twemoji.maxcdn.com/36x36/\",\r\n        ext  : \".png\"\r\n    };\r\n\r\n    /**\r\n     * 自定义marked的解析器\r\n     * Custom Marked renderer rules\r\n     * \r\n     * @param   {Array}    markdownToC     传入用于接收TOC的数组\r\n     * @returns {Renderer} markedRenderer  返回marked的Renderer自定义对象\r\n     */\r\n\r\n    editormd.markedRenderer = function(markdownToC, options) {\r\n        var defaults = {\r\n            toc                  : true,           // Table of contents\r\n            tocm                 : false,\r\n            tocStartLevel        : 1,              // Said from H1 to create ToC  \r\n            pageBreak            : true,\r\n            atLink               : true,           // for @link\r\n            emailLink            : true,           // for mail address auto link\r\n            taskList             : false,          // Enable Github Flavored Markdown task lists\r\n            emoji                : false,          // :emoji: , Support Twemoji, fontAwesome, Editor.md logo emojis.\r\n            tex                  : false,          // TeX(LaTeX), based on KaTeX\r\n            flowChart            : false,          // flowChart.js only support IE9+\r\n            sequenceDiagram      : false,          // sequenceDiagram.js only support IE9+\r\n        };\r\n        \r\n        var settings        = $.extend(defaults, options || {});    \r\n        var marked          = editormd.$marked;\r\n        var markedRenderer  = new marked.Renderer();\r\n        markdownToC         = markdownToC || [];        \r\n            \r\n        var regexs          = editormd.regexs;\r\n        var atLinkReg       = regexs.atLink;\r\n        var emojiReg        = regexs.emoji;\r\n        var emailReg        = regexs.email;\r\n        var emailLinkReg    = regexs.emailLink;\r\n        var twemojiReg      = regexs.twemoji;\r\n        var faIconReg       = regexs.fontAwesome;\r\n        var editormdLogoReg = regexs.editormdLogo;\r\n        var pageBreakReg    = regexs.pageBreak;\r\n\r\n        markedRenderer.emoji = function(text) {\r\n            \r\n            text = text.replace(editormd.regexs.emojiDatetime, function($1) {           \r\n                return $1.replace(/:/g, \"&#58;\");\r\n            });\r\n            \r\n            var matchs = text.match(emojiReg);\r\n\r\n            if (!matchs || !settings.emoji) {\r\n                return text;\r\n            }\r\n\r\n            for (var i = 0, len = matchs.length; i < len; i++)\r\n            {            \r\n                if (matchs[i] === \":+1:\") {\r\n                    matchs[i] = \":\\\\+1:\";\r\n                }\r\n\r\n                text = text.replace(new RegExp(matchs[i]), function($1, $2){\r\n                    var faMatchs = $1.match(faIconReg);\r\n                    var name     = $1.replace(/:/g, \"\");\r\n\r\n                    if (faMatchs)\r\n                    {                        \r\n                        for (var fa = 0, len1 = faMatchs.length; fa < len1; fa++)\r\n                        {\r\n                            var faName = faMatchs[fa].replace(/:/g, \"\");\r\n                            \r\n                            return \"<i class=\\\"fa \" + faName + \" fa-emoji\\\" title=\\\"\" + faName.replace(\"fa-\", \"\") + \"\\\"></i>\";\r\n                        }\r\n                    }\r\n                    else\r\n                    {\r\n                        var emdlogoMathcs = $1.match(editormdLogoReg);\r\n                        var twemojiMatchs = $1.match(twemojiReg);\r\n\r\n                        if (emdlogoMathcs)                                        \r\n                        {                            \r\n                            for (var x = 0, len2 = emdlogoMathcs.length; x < len2; x++)\r\n                            {\r\n                                var logoName = emdlogoMathcs[x].replace(/:/g, \"\");\r\n                                return \"<i class=\\\"\" + logoName + \"\\\" title=\\\"Editor.md logo (\" + logoName + \")\\\"></i>\";\r\n                            }\r\n                        }\r\n                        else if (twemojiMatchs) \r\n                        {\r\n                            for (var t = 0, len3 = twemojiMatchs.length; t < len3; t++)\r\n                            {\r\n                                var twe = twemojiMatchs[t].replace(/:/g, \"\").replace(\"tw-\", \"\");\r\n                                return \"<img src=\\\"\" + editormd.twemoji.path + twe + editormd.twemoji.ext + \"\\\" title=\\\"twemoji-\" + twe + \"\\\" alt=\\\"twemoji-\" + twe + \"\\\" class=\\\"emoji twemoji\\\" />\";\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            var src = (name === \"+1\") ? \"plus1\" : name;\r\n                            src     = (src === \"black_large_square\") ? \"black_square\" : src;\r\n                            src     = (src === \"moon\") ? \"waxing_gibbous_moon\" : src;\r\n\r\n                            return \"<img src=\\\"\" + editormd.emoji.path + src + editormd.emoji.ext + \"\\\" class=\\\"emoji\\\" title=\\\"&#58;\" + name + \"&#58;\\\" alt=\\\"&#58;\" + name + \"&#58;\\\" />\";\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            return text;\r\n        };\r\n\r\n        markedRenderer.atLink = function(text) {\r\n\r\n            if (atLinkReg.test(text))\r\n            { \r\n                if (settings.atLink) \r\n                {\r\n                    text = text.replace(emailReg, function($1, $2, $3, $4) {\r\n                        return $1.replace(/@/g, \"_#_&#64;_#_\");\r\n                    });\r\n\r\n                    text = text.replace(atLinkReg, function($1, $2) {\r\n                        return \"<a href=\\\"\" + editormd.urls.atLinkBase + \"\" + $2 + \"\\\" title=\\\"&#64;\" + $2 + \"\\\" class=\\\"at-link\\\">\" + $1 + \"</a>\";\r\n                    }).replace(/_#_&#64;_#_/g, \"@\");\r\n                }\r\n                \r\n                if (settings.emailLink)\r\n                {\r\n                    text = text.replace(emailLinkReg, function($1, $2, $3, $4, $5) {\r\n                        return (!$2 && $.inArray($5, \"jpg|jpeg|png|gif|webp|ico|icon|pdf\".split(\"|\")) < 0) ? \"<a href=\\\"mailto:\" + $1 + \"\\\">\"+$1+\"</a>\" : $1;\r\n                    });\r\n                }\r\n\r\n                return text;\r\n            }\r\n\r\n            return text;\r\n        };\r\n                \r\n        markedRenderer.link = function (href, title, text) {\r\n\r\n            if (this.options.sanitize) {\r\n                try {\r\n                    var prot = decodeURIComponent(unescape(href)).replace(/[^\\w:]/g,\"\").toLowerCase();\r\n                } catch(e) {\r\n                    return \"\";\r\n                }\r\n\r\n                if (prot.indexOf(\"javascript:\") === 0) {\r\n                    return \"\";\r\n                }\r\n            }\r\n\r\n            var out = \"<a href=\\\"\" + href + \"\\\"\";\r\n            \r\n            if (atLinkReg.test(title) || atLinkReg.test(text))\r\n            {\r\n                if (title)\r\n                {\r\n                    out += \" title=\\\"\" + title.replace(/@/g, \"&#64;\");\r\n                }\r\n                \r\n                return out + \"\\\">\" + text.replace(/@/g, \"&#64;\") + \"</a>\";\r\n            }\r\n\r\n            if (title) {\r\n                out += \" title=\\\"\" + title + \"\\\"\";\r\n            }\r\n\r\n            out += \">\" + text + \"</a>\";\r\n\r\n            return out;\r\n        };\r\n        \r\n        markedRenderer.heading = function(text, level, raw) {\r\n                    \r\n            var linkText       = text;\r\n            var hasLinkReg     = /\\s*\\<a\\s*href\\=\\\"(.*)\\\"\\s*([^\\>]*)\\>(.*)\\<\\/a\\>\\s*/;\r\n            var getLinkTextReg = /\\s*\\<a\\s*([^\\>]+)\\>([^\\>]*)\\<\\/a\\>\\s*/g;\r\n\r\n            if (hasLinkReg.test(text)) \r\n            {\r\n                var tempText = [];\r\n                text         = text.split(/\\<a\\s*([^\\>]+)\\>([^\\>]*)\\<\\/a\\>/);\r\n\r\n                for (var i = 0, len = text.length; i < len; i++)\r\n                {\r\n                    tempText.push(text[i].replace(/\\s*href\\=\\\"(.*)\\\"\\s*/g, \"\"));\r\n                }\r\n\r\n                text = tempText.join(\" \");\r\n            }\r\n            \r\n            text = trim(text);\r\n            \r\n            var escapedText    = text.toLowerCase().replace(/[^\\w]+/g, \"-\");\r\n            var toc = {\r\n                text  : text,\r\n                level : level,\r\n                slug  : escapedText\r\n            };\r\n            \r\n            var isChinese = /^[\\u4e00-\\u9fa5]+$/.test(text);\r\n            var id        = (isChinese) ? escape(text).replace(/\\%/g, \"\") : text.toLowerCase().replace(/[^\\w]+/g, \"-\");\r\n\r\n            markdownToC.push(toc);\r\n            \r\n            var headingHTML = \"<h\" + level + \" id=\\\"h\"+ level + \"-\" + this.options.headerPrefix + id +\"\\\">\";\r\n            \r\n            headingHTML    += \"<a name=\\\"\" + text + \"\\\" class=\\\"reference-link\\\"></a>\";\r\n            headingHTML    += \"<span class=\\\"header-link octicon octicon-link\\\"></span>\";\r\n            headingHTML    += (hasLinkReg) ? this.atLink(this.emoji(linkText)) : this.atLink(this.emoji(text));\r\n            headingHTML    += \"</h\" + level + \">\";\r\n\r\n            return headingHTML;\r\n        };\r\n        \r\n        markedRenderer.pageBreak = function(text) {\r\n            if (pageBreakReg.test(text) && settings.pageBreak)\r\n            {\r\n                text = \"<hr style=\\\"page-break-after:always;\\\" class=\\\"page-break editormd-page-break\\\" />\";\r\n            }\r\n            \r\n            return text;\r\n        };\r\n\r\n        markedRenderer.paragraph = function(text) {\r\n            var isTeXInline     = /\\$\\$(.*)\\$\\$/g.test(text);\r\n            var isTeXLine       = /^\\$\\$(.*)\\$\\$$/.test(text);\r\n            var isTeXAddClass   = (isTeXLine)     ? \" class=\\\"\" + editormd.classNames.tex + \"\\\"\" : \"\";\r\n            var isToC           = (settings.tocm) ? /^(\\[TOC\\]|\\[TOCM\\])$/.test(text) : /^\\[TOC\\]$/.test(text);\r\n            var isToCMenu       = /^\\[TOCM\\]$/.test(text);\r\n            \r\n            if (!isTeXLine && isTeXInline) \r\n            {\r\n                text = text.replace(/(\\$\\$([^\\$]*)\\$\\$)+/g, function($1, $2) {\r\n                    return \"<span class=\\\"\" + editormd.classNames.tex + \"\\\">\" + $2.replace(/\\$/g, \"\") + \"</span>\";\r\n                });\r\n            } \r\n            else \r\n            {\r\n                text = (isTeXLine) ? text.replace(/\\$/g, \"\") : text;\r\n            }\r\n            \r\n            var tocHTML = \"<div class=\\\"markdown-toc editormd-markdown-toc\\\">\" + text + \"</div>\";\r\n            \r\n            return (isToC) ? ( (isToCMenu) ? \"<div class=\\\"editormd-toc-menu\\\">\" + tocHTML + \"</div><br/>\" : tocHTML )\r\n                           : ( (pageBreakReg.test(text)) ? this.pageBreak(text) : \"<p\" + isTeXAddClass + \">\" + this.atLink(this.emoji(text)) + \"</p>\\n\" );\r\n        };\r\n\r\n        markedRenderer.code = function (code, lang, escaped) { \r\n\r\n            if (lang === \"seq\" || lang === \"sequence\")\r\n            {\r\n                return \"<div class=\\\"sequence-diagram\\\">\" + code + \"</div>\";\r\n            } \r\n            else if ( lang === \"flow\")\r\n            {\r\n                return \"<div class=\\\"flowchart\\\">\" + code + \"</div>\";\r\n            } \r\n            else if ( lang === \"math\" || lang === \"latex\" || lang === \"katex\")\r\n            {\r\n                return \"<p class=\\\"\" + editormd.classNames.tex + \"\\\">\" + code + \"</p>\";\r\n            } \r\n            else \r\n            {\r\n\r\n                return marked.Renderer.prototype.code.apply(this, arguments);\r\n            }\r\n        };\r\n\r\n        markedRenderer.tablecell = function(content, flags) {\r\n            var type = (flags.header) ? \"th\" : \"td\";\r\n            var tag  = (flags.align)  ? \"<\" + type +\" style=\\\"text-align:\" + flags.align + \"\\\">\" : \"<\" + type + \">\";\r\n            \r\n            return tag + this.atLink(this.emoji(content)) + \"</\" + type + \">\\n\";\r\n        };\r\n\r\n        markedRenderer.listitem = function(text) {\r\n            if (settings.taskList && /^\\s*\\[[x\\s]\\]\\s*/.test(text)) \r\n            {\r\n                text = text.replace(/^\\s*\\[\\s\\]\\s*/, \"<input type=\\\"checkbox\\\" class=\\\"task-list-item-checkbox\\\" /> \")\r\n                           .replace(/^\\s*\\[x\\]\\s*/,  \"<input type=\\\"checkbox\\\" class=\\\"task-list-item-checkbox\\\" checked disabled /> \");\r\n\r\n                return \"<li style=\\\"list-style: none;\\\">\" + this.atLink(this.emoji(text)) + \"</li>\";\r\n            }\r\n            else \r\n            {\r\n                return \"<li>\" + this.atLink(this.emoji(text)) + \"</li>\";\r\n            }\r\n        };\r\n        \r\n        return markedRenderer;\r\n    };\r\n    \r\n    /**\r\n     *\r\n     * 生成TOC(Table of Contents)\r\n     * Creating ToC (Table of Contents)\r\n     * \r\n     * @param   {Array}    toc             从marked获取的TOC数组列表\r\n     * @param   {Element}  container       插入TOC的容器元素\r\n     * @param   {Integer}  startLevel      Hx 起始层级\r\n     * @returns {Object}   tocContainer    返回ToC列表容器层的jQuery对象元素\r\n     */\r\n    \r\n    editormd.markdownToCRenderer = function(toc, container, tocDropdown, startLevel) {\r\n        \r\n        var html        = \"\";    \r\n        var lastLevel   = 0;\r\n        var classPrefix = this.classPrefix;\r\n        \r\n        startLevel      = startLevel  || 1;\r\n        \r\n        for (var i = 0, len = toc.length; i < len; i++) \r\n        {\r\n            var text  = toc[i].text;\r\n            var level = toc[i].level;\r\n            \r\n            if (level < startLevel) {\r\n                continue;\r\n            }\r\n            \r\n            if (level > lastLevel) \r\n            {\r\n                html += \"\";\r\n            }\r\n            else if (level < lastLevel) \r\n            {\r\n                html += (new Array(lastLevel - level + 2)).join(\"</ul></li>\");\r\n            } \r\n            else \r\n            {\r\n                html += \"</ul></li>\";\r\n            }\r\n\r\n            html += \"<li><a class=\\\"toc-level-\" + level + \"\\\" href=\\\"#\" + text + \"\\\" level=\\\"\" + level + \"\\\">\" + text + \"</a><ul>\";\r\n            lastLevel = level;\r\n        }\r\n        \r\n        var tocContainer = container.find(\".markdown-toc\");\r\n        \r\n        if ((tocContainer.length < 1 && container.attr(\"previewContainer\") === \"false\"))\r\n        {\r\n            var tocHTML = \"<div class=\\\"markdown-toc \" + classPrefix + \"markdown-toc\\\"></div>\";\r\n            \r\n            tocHTML = (tocDropdown) ? \"<div class=\\\"\" + classPrefix + \"toc-menu\\\">\" + tocHTML + \"</div>\" : tocHTML;\r\n            \r\n            container.html(tocHTML);\r\n            \r\n            tocContainer = container.find(\".markdown-toc\");\r\n        }\r\n        \r\n        if (tocDropdown)\r\n        {\r\n            tocContainer.wrap(\"<div class=\\\"\" + classPrefix + \"toc-menu\\\"></div><br/>\");\r\n        }\r\n        \r\n        tocContainer.html(\"<ul class=\\\"markdown-toc-list\\\"></ul>\").children(\".markdown-toc-list\").html(html.replace(/\\r?\\n?\\<ul\\>\\<\\/ul\\>/g, \"\"));\r\n        \r\n        return tocContainer;\r\n    };\r\n    \r\n    /**\r\n     *\r\n     * 生成TOC下拉菜单\r\n     * Creating ToC dropdown menu\r\n     * \r\n     * @param   {Object}   container       插入TOC的容器jQuery对象元素\r\n     * @param   {String}   tocTitle        ToC title\r\n     * @returns {Object}                   return toc-menu object\r\n     */\r\n    \r\n    editormd.tocDropdownMenu = function(container, tocTitle) {\r\n        \r\n        tocTitle      = tocTitle || \"Table of Contents\";\r\n        \r\n        var zindex    = 400;\r\n        var tocMenus  = container.find(\".\" + this.classPrefix + \"toc-menu\");\r\n\r\n        tocMenus.each(function() {\r\n            var $this  = $(this);\r\n            var toc    = $this.children(\".markdown-toc\");\r\n            var icon   = \"<i class=\\\"fa fa-angle-down\\\"></i>\";\r\n            var btn    = \"<a href=\\\"javascript:;\\\" class=\\\"toc-menu-btn\\\">\" + icon + tocTitle + \"</a>\";\r\n            var menu   = toc.children(\"ul\");            \r\n            var list   = menu.find(\"li\");\r\n            \r\n            toc.append(btn);\r\n            \r\n            list.first().before(\"<li><h1>\" + tocTitle + \" \" + icon + \"</h1></li>\");\r\n            \r\n            $this.mouseover(function(){\r\n                menu.show();\r\n\r\n                list.each(function(){\r\n                    var li = $(this);\r\n                    var ul = li.children(\"ul\");\r\n\r\n                    if (ul.html() === \"\")\r\n                    {\r\n                        ul.remove();\r\n                    }\r\n\r\n                    if (ul.length > 0 && ul.html() !== \"\")\r\n                    {\r\n                        var firstA = li.children(\"a\").first();\r\n\r\n                        if (firstA.children(\".fa\").length < 1)\r\n                        {\r\n                            firstA.append( $(icon).css({ float:\"right\", paddingTop:\"4px\" }) );\r\n                        }\r\n                    }\r\n\r\n                    li.mouseover(function(){\r\n                        ul.css(\"z-index\", zindex).show();\r\n                        zindex += 1;\r\n                    }).mouseleave(function(){\r\n                        ul.hide();\r\n                    });\r\n                });\r\n            }).mouseleave(function(){\r\n                menu.hide();\r\n            }); \r\n        });       \r\n        \r\n        return tocMenus;\r\n    };\r\n    \r\n    /**\r\n     * 简单地过滤指定的HTML标签\r\n     * Filter custom html tags\r\n     * \r\n     * @param   {String}   html          要过滤HTML\r\n     * @param   {String}   filters       要过滤的标签\r\n     * @returns {String}   html          返回过滤的HTML\r\n     */\r\n    \r\n    editormd.filterHTMLTags = function(html, filters) {\r\n        \r\n        if (typeof html !== \"string\") {\r\n            html = new String(html);\r\n        }\r\n            \r\n        if (typeof filters !== \"string\") {\r\n            return html;\r\n        }\r\n\r\n        var expression = filters.split(\"|\");\r\n        var filterTags = expression[0].split(\",\");\r\n        var attrs      = expression[1];\r\n\r\n        for (var i = 0, len = filterTags.length; i < len; i++)\r\n        {\r\n            var tag = filterTags[i];\r\n\r\n            html = html.replace(new RegExp(\"\\<\\s*\" + tag + \"\\s*([^\\>]*)\\>([^\\>]*)\\<\\s*\\/\" + tag + \"\\s*\\>\", \"igm\"), \"\");\r\n        }\r\n        \r\n        //return html;\r\n\r\n        if (typeof attrs !== \"undefined\")\r\n        {\r\n            var htmlTagRegex = /\\<(\\w+)\\s*([^\\>]*)\\>([^\\>]*)\\<\\/(\\w+)\\>/ig;\r\n\r\n            if (attrs === \"*\")\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4, $5) {\r\n                    return \"<\" + $2 + \">\" + $4 + \"</\" + $5 + \">\";\r\n                });         \r\n            }\r\n            else if (attrs === \"on*\")\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4, $5) {\r\n                    var el = $(\"<\" + $2 + \">\" + $4 + \"</\" + $5 + \">\");\r\n                    var _attrs = $($1)[0].attributes;\r\n                    var $attrs = {};\r\n                    \r\n                    $.each(_attrs, function(i, e) {\r\n                        if (e.nodeName !== '\"') $attrs[e.nodeName] = e.nodeValue;\r\n                    });\r\n                    \r\n                    $.each($attrs, function(i) {                        \r\n                        if (i.indexOf(\"on\") === 0) {\r\n                            delete $attrs[i];\r\n                        }\r\n                    });\r\n                    \r\n                    el.attr($attrs);\r\n                    \r\n                    var text = (typeof el[1] !== \"undefined\") ? $(el[1]).text() : \"\";\r\n\r\n                    return el[0].outerHTML + text;\r\n                });\r\n            }\r\n            else\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4) {\r\n                    var filterAttrs = attrs.split(\",\");\r\n                    var el = $($1);\r\n                    el.html($4);\r\n\r\n                    $.each(filterAttrs, function(i) {\r\n                        el.attr(filterAttrs[i], null);\r\n                    });\r\n\r\n                    return el[0].outerHTML;\r\n                });\r\n            }\r\n        }\r\n        \r\n        return html;\r\n    };\r\n    \r\n    /**\r\n     * 将Markdown文档解析为HTML用于前台显示\r\n     * Parse Markdown to HTML for Font-end preview.\r\n     * \r\n     * @param   {String}   id            用于显示HTML的对象ID\r\n     * @param   {Object}   [options={}]  配置选项，可选\r\n     * @returns {Object}   div           返回jQuery对象元素\r\n     */\r\n    \r\n    editormd.markdownToHTML = function(id, options) {\r\n        var defaults = {\r\n            gfm                  : true,\r\n            toc                  : true,\r\n            tocm                 : false,\r\n            tocStartLevel        : 1,\r\n            tocTitle             : \"目录\",\r\n            tocDropdown          : false,\r\n            tocContainer         : \"\",\r\n            markdown             : \"\",\r\n            markdownSourceCode   : false,\r\n            htmlDecode           : false,\r\n            autoLoadKaTeX        : true,\r\n            pageBreak            : true,\r\n            atLink               : true,    // for @link\r\n            emailLink            : true,    // for mail address auto link\r\n            tex                  : false,\r\n            taskList             : false,   // Github Flavored Markdown task lists\r\n            emoji                : false,\r\n            flowChart            : false,\r\n            sequenceDiagram      : false,\r\n            previewCodeHighlight : true\r\n        };\r\n        \r\n        editormd.$marked  = marked;\r\n\r\n        var div           = $(\"#\" + id);\r\n        var settings      = div.settings = $.extend(true, defaults, options || {});\r\n        var saveTo        = div.find(\"textarea\");\r\n        \r\n        if (saveTo.length < 1)\r\n        {\r\n            div.append(\"<textarea></textarea>\");\r\n            saveTo        = div.find(\"textarea\");\r\n        }        \r\n        \r\n        var markdownDoc   = (settings.markdown === \"\") ? saveTo.val() : settings.markdown; \r\n        var markdownToC   = [];\r\n\r\n        var rendererOptions = {  \r\n            toc                  : settings.toc,\r\n            tocm                 : settings.tocm,\r\n            tocStartLevel        : settings.tocStartLevel,\r\n            taskList             : settings.taskList,\r\n            emoji                : settings.emoji,\r\n            tex                  : settings.tex,\r\n            pageBreak            : settings.pageBreak,\r\n            atLink               : settings.atLink,           // for @link\r\n            emailLink            : settings.emailLink,        // for mail address auto link\r\n            flowChart            : settings.flowChart,\r\n            sequenceDiagram      : settings.sequenceDiagram,\r\n            previewCodeHighlight : settings.previewCodeHighlight,\r\n        };\r\n\r\n        var markedOptions = {\r\n            renderer    : editormd.markedRenderer(markdownToC, rendererOptions),\r\n            gfm         : settings.gfm,\r\n            tables      : true,\r\n            breaks      : true,\r\n            pedantic    : false,\r\n            sanitize    : (settings.htmlDecode) ? false : true, // 是否忽略HTML标签，即是否开启HTML标签解析，为了安全性，默认不开启\r\n            smartLists  : true,\r\n            smartypants : true\r\n        };\r\n        \r\n\t\tmarkdownDoc = new String(markdownDoc);\r\n        \r\n        var markdownParsed = marked(markdownDoc, markedOptions);\r\n        \r\n        markdownParsed = editormd.filterHTMLTags(markdownParsed, settings.htmlDecode);\r\n        \r\n        if (settings.markdownSourceCode) {\r\n            saveTo.text(markdownDoc);\r\n        } else {\r\n            saveTo.remove();\r\n        }\r\n        \r\n        div.addClass(\"markdown-body \" + this.classPrefix + \"html-preview\").append(markdownParsed);\r\n        \r\n        var tocContainer = (settings.tocContainer !== \"\") ? $(settings.tocContainer) : div;\r\n        \r\n        if (settings.tocContainer !== \"\")\r\n        {\r\n            tocContainer.attr(\"previewContainer\", false);\r\n        }\r\n         \r\n        if (settings.toc) \r\n        {\r\n            div.tocContainer = this.markdownToCRenderer(markdownToC, tocContainer, settings.tocDropdown, settings.tocStartLevel);\r\n            \r\n            if (settings.tocDropdown || div.find(\".\" + this.classPrefix + \"toc-menu\").length > 0)\r\n            {\r\n                this.tocDropdownMenu(div, settings.tocTitle);\r\n            }\r\n            \r\n            if (settings.tocContainer !== \"\")\r\n            {\r\n                div.find(\".editormd-toc-menu, .editormd-markdown-toc\").remove();\r\n            }\r\n        }\r\n            \r\n        if (settings.previewCodeHighlight) \r\n        {\r\n            div.find(\"pre\").addClass(\"prettyprint linenums\");\r\n            prettyPrint();\r\n        }\r\n        \r\n        if (!editormd.isIE8) \r\n        {\r\n            if (settings.flowChart) {\r\n                div.find(\".flowchart\").flowChart(); \r\n            }\r\n\r\n            if (settings.sequenceDiagram) {\r\n                div.find(\".sequence-diagram\").sequenceDiagram({theme: \"simple\"});\r\n            }\r\n        }\r\n\r\n        if (settings.tex)\r\n        {\r\n            var katexHandle = function() {\r\n                div.find(\".\" + editormd.classNames.tex).each(function(){\r\n                    var tex  = $(this);                    \r\n                    katex.render(tex.html().replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\"), tex[0]);                    \r\n                    tex.find(\".katex\").css(\"font-size\", \"1.6em\");\r\n                });\r\n            };\r\n            \r\n            if (settings.autoLoadKaTeX && !editormd.$katex && !editormd.kaTeXLoaded)\r\n            {\r\n                this.loadKaTeX(function() {\r\n                    editormd.$katex      = katex;\r\n                    editormd.kaTeXLoaded = true;\r\n                    katexHandle();\r\n                });\r\n            }\r\n            else\r\n            {\r\n                katexHandle();\r\n            }\r\n        }\r\n        \r\n        div.getMarkdown = function() {            \r\n            return saveTo.val();\r\n        };\r\n        \r\n        return div;\r\n    };\r\n    \r\n    // Editor.md themes, change toolbar themes etc.\r\n    // added @1.5.0\r\n    editormd.themes        = [\"default\", \"dark\"];\r\n    \r\n    // Preview area themes\r\n    // added @1.5.0\r\n    editormd.previewThemes = [\"default\", \"dark\"];\r\n    \r\n    // CodeMirror / editor area themes\r\n    // @1.5.0 rename -> editorThemes, old version -> themes\r\n    editormd.editorThemes = [\r\n        \"default\", \"3024-day\", \"3024-night\",\r\n        \"ambiance\", \"ambiance-mobile\",\r\n        \"base16-dark\", \"base16-light\", \"blackboard\",\r\n        \"cobalt\",\r\n        \"eclipse\", \"elegant\", \"erlang-dark\",\r\n        \"lesser-dark\",\r\n        \"mbo\", \"mdn-like\", \"midnight\", \"monokai\",\r\n        \"neat\", \"neo\", \"night\",\r\n        \"paraiso-dark\", \"paraiso-light\", \"pastel-on-dark\",\r\n        \"rubyblue\",\r\n        \"solarized\",\r\n        \"the-matrix\", \"tomorrow-night-eighties\", \"twilight\",\r\n        \"vibrant-ink\",\r\n        \"xq-dark\", \"xq-light\"\r\n    ];\r\n\r\n    editormd.loadPlugins = {};\r\n    \r\n    editormd.loadFiles = {\r\n        js     : [],\r\n        css    : [],\r\n        plugin : []\r\n    };\r\n    \r\n    /**\r\n     * 动态加载Editor.md插件，但不立即执行\r\n     * Load editor.md plugins\r\n     * \r\n     * @param {String}   fileName              插件文件路径\r\n     * @param {Function} [callback=function()] 加载成功后执行的回调函数\r\n     * @param {String}   [into=\"head\"]         嵌入页面的位置\r\n     */\r\n    \r\n    editormd.loadPlugin = function(fileName, callback, into) {\r\n        callback   = callback || function() {};\r\n        \r\n        this.loadScript(fileName, function() {\r\n            editormd.loadFiles.plugin.push(fileName);\r\n            callback();\r\n        }, into);\r\n    };\r\n    \r\n    /**\r\n     * 动态加载CSS文件的方法\r\n     * Load css file method\r\n     * \r\n     * @param {String}   fileName              CSS文件名\r\n     * @param {Function} [callback=function()] 加载成功后执行的回调函数\r\n     * @param {String}   [into=\"head\"]         嵌入页面的位置\r\n     */\r\n    \r\n    editormd.loadCSS   = function(fileName, callback, into) {\r\n        into       = into     || \"head\";        \r\n        callback   = callback || function() {};\r\n        \r\n        var css    = document.createElement(\"link\");\r\n        css.type   = \"text/css\";\r\n        css.rel    = \"stylesheet\";\r\n        css.onload = css.onreadystatechange = function() {\r\n            editormd.loadFiles.css.push(fileName);\r\n            callback();\r\n        };\r\n\r\n        css.href   = fileName + \".css\";\r\n\r\n        if(into === \"head\") {\r\n            document.getElementsByTagName(\"head\")[0].appendChild(css);\r\n        } else {\r\n            document.body.appendChild(css);\r\n        }\r\n    };\r\n    \r\n    editormd.isIE    = (navigator.appName == \"Microsoft Internet Explorer\");\r\n    editormd.isIE8   = (editormd.isIE && navigator.appVersion.match(/8./i) == \"8.\");\r\n\r\n    /**\r\n     * 动态加载JS文件的方法\r\n     * Load javascript file method\r\n     * \r\n     * @param {String}   fileName              JS文件名\r\n     * @param {Function} [callback=function()] 加载成功后执行的回调函数\r\n     * @param {String}   [into=\"head\"]         嵌入页面的位置\r\n     */\r\n\r\n    editormd.loadScript = function(fileName, callback, into) {\r\n        \r\n        into          = into     || \"head\";\r\n        callback      = callback || function() {};\r\n        \r\n        var script    = null; \r\n        script        = document.createElement(\"script\");\r\n        script.id     = fileName.replace(/[\\./]+/g, \"-\");\r\n        script.type   = \"text/javascript\";        \r\n        script.src    = fileName + \".js\";\r\n        \r\n        if (editormd.isIE8) \r\n        {            \r\n            script.onreadystatechange = function() {\r\n                if(script.readyState) \r\n                {\r\n                    if (script.readyState === \"loaded\" || script.readyState === \"complete\") \r\n                    {\r\n                        script.onreadystatechange = null; \r\n                        editormd.loadFiles.js.push(fileName);\r\n                        callback();\r\n                    }\r\n                } \r\n            };\r\n        }\r\n        else\r\n        {\r\n            script.onload = function() {\r\n                editormd.loadFiles.js.push(fileName);\r\n                callback();\r\n            };\r\n        }\r\n\r\n        if (into === \"head\") {\r\n            document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n        } else {\r\n            document.body.appendChild(script);\r\n        }\r\n    };\r\n    \r\n    // 使用国外的CDN，加载速度有时会很慢，或者自定义URL\r\n    // You can custom KaTeX load url.\r\n    editormd.katexURL  = {\r\n        css : \"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\",\r\n        js  : \"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\"\r\n    };\r\n    \r\n    editormd.kaTeXLoaded = false;\r\n    \r\n    /**\r\n     * 加载KaTeX文件\r\n     * load KaTeX files\r\n     * \r\n     * @param {Function} [callback=function()]  加载成功后执行的回调函数\r\n     */\r\n    \r\n    editormd.loadKaTeX = function (callback) {\r\n        editormd.loadCSS(editormd.katexURL.css, function(){\r\n            editormd.loadScript(editormd.katexURL.js, callback || function(){});\r\n        });\r\n    };\r\n        \r\n    /**\r\n     * 锁屏\r\n     * lock screen\r\n     * \r\n     * @param   {Boolean}   lock   Boolean 布尔值，是否锁屏\r\n     * @returns {void}\r\n     */\r\n    \r\n    editormd.lockScreen = function(lock) {\r\n        $(\"html,body\").css(\"overflow\", (lock) ? \"hidden\" : \"\");\r\n    };\r\n        \r\n    /**\r\n     * 动态创建对话框\r\n     * Creating custom dialogs\r\n     * \r\n     * @param   {Object} options 配置项键值对 Key/Value\r\n     * @returns {dialog} 返回创建的dialog的jQuery实例对象\r\n     */\r\n\r\n    editormd.createDialog = function(options) {\r\n        var defaults = {\r\n            name : \"\",\r\n            width : 420,\r\n            height: 240,\r\n            title : \"\",\r\n            drag  : true,\r\n            closed : true,\r\n            content : \"\",\r\n            mask : true,\r\n            maskStyle : {\r\n                backgroundColor : \"#fff\",\r\n                opacity : 0.1\r\n            },\r\n            lockScreen : true,\r\n            footer : true,\r\n            buttons : false\r\n        };\r\n\r\n        options          = $.extend(true, defaults, options);\r\n        \r\n        var $this        = this;\r\n        var editor       = this.editor;\r\n        var classPrefix  = editormd.classPrefix;\r\n        var guid         = (new Date()).getTime();\r\n        var dialogName   = ( (options.name === \"\") ? classPrefix + \"dialog-\" + guid : options.name);\r\n        var mouseOrTouch = editormd.mouseOrTouch;\r\n\r\n        var html         = \"<div class=\\\"\" + classPrefix + \"dialog \" + dialogName + \"\\\">\";\r\n\r\n        if (options.title !== \"\")\r\n        {\r\n            html += \"<div class=\\\"\" + classPrefix + \"dialog-header\\\"\" + ( (options.drag) ? \" style=\\\"cursor: move;\\\"\" : \"\" ) + \">\";\r\n            html += \"<strong class=\\\"\" + classPrefix + \"dialog-title\\\">\" + options.title + \"</strong>\";\r\n            html += \"</div>\";\r\n        }\r\n\r\n        if (options.closed)\r\n        {\r\n            html += \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"dialog-close\\\"></a>\";\r\n        }\r\n\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-container\\\">\" + options.content;                    \r\n\r\n        if (options.footer || typeof options.footer === \"string\") \r\n        {\r\n            html += \"<div class=\\\"\" + classPrefix + \"dialog-footer\\\">\" + ( (typeof options.footer === \"boolean\") ? \"\" : options.footer) + \"</div>\";\r\n        }\r\n\r\n        html += \"</div>\";\r\n\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-mask \" + classPrefix + \"dialog-mask-bg\\\"></div>\";\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-mask \" + classPrefix + \"dialog-mask-con\\\"></div>\";\r\n        html += \"</div>\";\r\n\r\n        editor.append(html);\r\n\r\n        var dialog = editor.find(\".\" + dialogName);\r\n\r\n        dialog.lockScreen = function(lock) {\r\n            if (options.lockScreen)\r\n            {                \r\n                $(\"html,body\").css(\"overflow\", (lock) ? \"hidden\" : \"\");\r\n                $this.resize();\r\n            }\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.showMask = function() {\r\n            if (options.mask)\r\n            {\r\n                editor.find(\".\" + classPrefix + \"mask\").css(options.maskStyle).css(\"z-index\", editormd.dialogZindex - 1).show();\r\n            }\r\n            return dialog;\r\n        };\r\n\r\n        dialog.hideMask = function() {\r\n            if (options.mask)\r\n            {\r\n                editor.find(\".\" + classPrefix + \"mask\").hide();\r\n            }\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.loading = function(show) {                        \r\n            var loading = dialog.find(\".\" + classPrefix + \"dialog-mask\");\r\n            loading[(show) ? \"show\" : \"hide\"]();\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.lockScreen(true).showMask();\r\n\r\n        dialog.show().css({\r\n            zIndex : editormd.dialogZindex,\r\n            border : (editormd.isIE8) ? \"1px solid #ddd\" : \"\",\r\n            width  : (typeof options.width  === \"number\") ? options.width + \"px\"  : options.width,\r\n            height : (typeof options.height === \"number\") ? options.height + \"px\" : options.height\r\n        });\r\n\r\n        var dialogPosition = function(){\r\n            dialog.css({\r\n                top    : ($(window).height() - dialog.height()) / 2 + \"px\",\r\n                left   : ($(window).width() - dialog.width()) / 2 + \"px\"\r\n            });\r\n        };\r\n\r\n        dialogPosition();\r\n\r\n        $(window).resize(dialogPosition);\r\n\r\n        dialog.children(\".\" + classPrefix + \"dialog-close\").bind(mouseOrTouch(\"click\", \"touchend\"), function() {\r\n            dialog.hide().lockScreen(false).hideMask();\r\n        });\r\n\r\n        if (typeof options.buttons === \"object\")\r\n        {\r\n            var footer = dialog.footer = dialog.find(\".\" + classPrefix + \"dialog-footer\");\r\n\r\n            for (var key in options.buttons)\r\n            {\r\n                var btn = options.buttons[key];\r\n                var btnClassName = classPrefix + key + \"-btn\";\r\n\r\n                footer.append(\"<button class=\\\"\" + classPrefix + \"btn \" + btnClassName + \"\\\">\" + btn[0] + \"</button>\");\r\n                btn[1] = $.proxy(btn[1], dialog);\r\n                footer.children(\".\" + btnClassName).bind(mouseOrTouch(\"click\", \"touchend\"), btn[1]);\r\n            }\r\n        }\r\n\r\n        if (options.title !== \"\" && options.drag)\r\n        {                        \r\n            var posX, posY;\r\n            var dialogHeader = dialog.children(\".\" + classPrefix + \"dialog-header\");\r\n\r\n            if (!options.mask) {\r\n                dialogHeader.bind(mouseOrTouch(\"click\", \"touchend\"), function(){\r\n                    editormd.dialogZindex += 2;\r\n                    dialog.css(\"z-index\", editormd.dialogZindex);\r\n                });\r\n            }\r\n\r\n            dialogHeader.mousedown(function(e) {\r\n                e = e || window.event;  //IE\r\n                posX = e.clientX - parseInt(dialog[0].style.left);\r\n                posY = e.clientY - parseInt(dialog[0].style.top);\r\n\r\n                document.onmousemove = moveAction;                   \r\n            });\r\n\r\n            var userCanSelect = function (obj) {\r\n                obj.removeClass(classPrefix + \"user-unselect\").off(\"selectstart\");\r\n            };\r\n\r\n            var userUnselect = function (obj) {\r\n                obj.addClass(classPrefix + \"user-unselect\").on(\"selectstart\", function(event) { // selectstart for IE                        \r\n                    return false;\r\n                });\r\n            };\r\n\r\n            var moveAction = function (e) {\r\n                e = e || window.event;  //IE\r\n\r\n                var left, top, nowLeft = parseInt(dialog[0].style.left), nowTop = parseInt(dialog[0].style.top);\r\n\r\n                if( nowLeft >= 0 ) {\r\n                    if( nowLeft + dialog.width() <= $(window).width()) {\r\n                        left = e.clientX - posX;\r\n                    } else {\t\r\n                        left = $(window).width() - dialog.width();\r\n                        document.onmousemove = null;\r\n                    }\r\n                } else {\r\n                    left = 0;\r\n                    document.onmousemove = null;\r\n                }\r\n\r\n                if( nowTop >= 0 ) {\r\n                    top = e.clientY - posY;\r\n                } else {\r\n                    top = 0;\r\n                    document.onmousemove = null;\r\n                }\r\n\r\n\r\n                document.onselectstart = function() {\r\n                    return false;\r\n                };\r\n\r\n                userUnselect($(\"body\"));\r\n                userUnselect(dialog);\r\n                dialog[0].style.left = left + \"px\";\r\n                dialog[0].style.top  = top + \"px\";\r\n            };\r\n\r\n            document.onmouseup = function() {                            \r\n                userCanSelect($(\"body\"));\r\n                userCanSelect(dialog);\r\n\r\n                document.onselectstart = null;         \r\n                document.onmousemove = null;\r\n            };\r\n\r\n            dialogHeader.touchDraggable = function() {\r\n                var offset = null;\r\n                var start  = function(e) {\r\n                    var orig = e.originalEvent; \r\n                    var pos  = $(this).parent().position();\r\n\r\n                    offset = {\r\n                        x : orig.changedTouches[0].pageX - pos.left,\r\n                        y : orig.changedTouches[0].pageY - pos.top\r\n                    };\r\n                };\r\n\r\n                var move = function(e) {\r\n                    e.preventDefault();\r\n                    var orig = e.originalEvent;\r\n\r\n                    $(this).parent().css({\r\n                        top  : orig.changedTouches[0].pageY - offset.y,\r\n                        left : orig.changedTouches[0].pageX - offset.x\r\n                    });\r\n                };\r\n\r\n                this.bind(\"touchstart\", start).bind(\"touchmove\", move);\r\n            };\r\n\r\n            dialogHeader.touchDraggable();\r\n        }\r\n\r\n        editormd.dialogZindex += 2;\r\n\r\n        return dialog;\r\n    };\r\n    \r\n    /**\r\n     * 鼠标和触摸事件的判断/选择方法\r\n     * MouseEvent or TouchEvent type switch\r\n     * \r\n     * @param   {String} [mouseEventType=\"click\"]    供选择的鼠标事件\r\n     * @param   {String} [touchEventType=\"touchend\"] 供选择的触摸事件\r\n     * @returns {String} EventType                   返回事件类型名称\r\n     */\r\n    \r\n    editormd.mouseOrTouch = function(mouseEventType, touchEventType) {\r\n        mouseEventType = mouseEventType || \"click\";\r\n        touchEventType = touchEventType || \"touchend\";\r\n        \r\n        var eventType  = mouseEventType;\r\n\r\n        try {\r\n            document.createEvent(\"TouchEvent\");\r\n            eventType = touchEventType;\r\n        } catch(e) {}\r\n\r\n        return eventType;\r\n    };\r\n    \r\n    /**\r\n     * 日期时间的格式化方法\r\n     * Datetime format method\r\n     * \r\n     * @param   {String}   [format=\"\"]  日期时间的格式，类似PHP的格式\r\n     * @returns {String}   datefmt      返回格式化后的日期时间字符串\r\n     */\r\n    \r\n    editormd.dateFormat = function(format) {                \r\n        format      = format || \"\";\r\n\r\n        var addZero = function(d) {\r\n            return (d < 10) ? \"0\" + d : d;\r\n        };\r\n\r\n        var date    = new Date(); \r\n        var year    = date.getFullYear();\r\n        var year2   = year.toString().slice(2, 4);\r\n        var month   = addZero(date.getMonth() + 1);\r\n        var day     = addZero(date.getDate());\r\n        var weekDay = date.getDay();\r\n        var hour    = addZero(date.getHours());\r\n        var min     = addZero(date.getMinutes());\r\n        var second  = addZero(date.getSeconds());\r\n        var ms      = addZero(date.getMilliseconds()); \r\n        var datefmt = \"\";\r\n\r\n        var ymd     = year2 + \"-\" + month + \"-\" + day;\r\n        var fymd    = year  + \"-\" + month + \"-\" + day;\r\n        var hms     = hour  + \":\" + min   + \":\" + second;\r\n\r\n        switch (format) \r\n        {\r\n            case \"UNIX Time\" :\r\n                    datefmt = date.getTime();\r\n                break;\r\n\r\n            case \"UTC\" :\r\n                    datefmt = date.toUTCString();\r\n                break;\t\r\n\r\n            case \"yy\" :\r\n                    datefmt = year2;\r\n                break;\t\r\n\r\n            case \"year\" :\r\n            case \"yyyy\" :\r\n                    datefmt = year;\r\n                break;\r\n\r\n            case \"month\" :\r\n            case \"mm\" :\r\n                    datefmt = month;\r\n                break;                        \r\n\r\n            case \"cn-week-day\" :\r\n            case \"cn-wd\" :\r\n                    var cnWeekDays = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\r\n                    datefmt = \"星期\" + cnWeekDays[weekDay];\r\n                break;\r\n\r\n            case \"week-day\" :\r\n            case \"wd\" :\r\n                    var weekDays = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\r\n                    datefmt = weekDays[weekDay];\r\n                break;\r\n\r\n            case \"day\" :\r\n            case \"dd\" :\r\n                    datefmt = day;\r\n                break;\r\n\r\n            case \"hour\" :\r\n            case \"hh\" :\r\n                    datefmt = hour;\r\n                break;\r\n\r\n            case \"min\" :\r\n            case \"ii\" :\r\n                    datefmt = min;\r\n                break;\r\n\r\n            case \"second\" :\r\n            case \"ss\" :\r\n                    datefmt = second;\r\n                break;\r\n\r\n            case \"ms\" :\r\n                    datefmt = ms;\r\n                break;\r\n\r\n            case \"yy-mm-dd\" :\r\n                    datefmt = ymd;\r\n                break;\r\n\r\n            case \"yyyy-mm-dd\" :\r\n                    datefmt = fymd;\r\n                break;\r\n\r\n            case \"yyyy-mm-dd h:i:s ms\" :\r\n            case \"full + ms\" : \r\n                    datefmt = fymd + \" \" + hms + \" \" + ms;\r\n                break;\r\n\r\n            case \"full\" :\r\n            case \"yyyy-mm-dd h:i:s\" :\r\n                default:\r\n                    datefmt = fymd + \" \" + hms;\r\n                break;\r\n        }\r\n\r\n        return datefmt;\r\n    };\r\n\r\n    return editormd;\r\n\r\n}));\r\n"
        },
        {
          "name": "editormd.min.js",
          "type": "blob",
          "size": 52.7978515625,
          "content": "/*! Editor.md v1.5.0 | editormd.min.js | Open source online markdown editor. | MIT License | By: Pandao | https://github.com/pandao/editor.md | 2015-06-09 */\r\n!function(e){\"use strict\";\"function\"==typeof require&&\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e:\"function\"==typeof define?define.amd||define([\"jquery\"],e):window.editormd=e()}(function(){\"use strict\";var e=\"undefined\"!=typeof jQuery?jQuery:Zepto;if(\"undefined\"!=typeof e){var t=function(e,i){return new t.fn.init(e,i)};t.title=t.$name=\"Editor.md\",t.version=\"1.5.0\",t.homePage=\"https://pandao.github.io/editor.md/\",t.classPrefix=\"editormd-\",t.toolbarModes={full:[\"undo\",\"redo\",\"|\",\"bold\",\"del\",\"italic\",\"quote\",\"ucwords\",\"uppercase\",\"lowercase\",\"|\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"|\",\"list-ul\",\"list-ol\",\"hr\",\"|\",\"link\",\"reference-link\",\"image\",\"code\",\"preformatted-text\",\"code-block\",\"table\",\"datetime\",\"emoji\",\"html-entities\",\"pagebreak\",\"|\",\"goto-line\",\"watch\",\"preview\",\"fullscreen\",\"clear\",\"search\",\"|\",\"help\",\"info\"],simple:[\"undo\",\"redo\",\"|\",\"bold\",\"del\",\"italic\",\"quote\",\"uppercase\",\"lowercase\",\"|\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"|\",\"list-ul\",\"list-ol\",\"hr\",\"|\",\"watch\",\"preview\",\"fullscreen\",\"|\",\"help\",\"info\"],mini:[\"undo\",\"redo\",\"|\",\"watch\",\"preview\",\"|\",\"help\",\"info\"]},t.defaults={mode:\"gfm\",name:\"\",value:\"\",theme:\"\",editorTheme:\"default\",previewTheme:\"\",markdown:\"\",appendMarkdown:\"\",width:\"100%\",height:\"100%\",path:\"./lib/\",pluginPath:\"\",delay:300,autoLoadModules:!0,watch:!0,placeholder:\"Enjoy Markdown! coding now...\",gotoLine:!0,codeFold:!1,autoHeight:!1,autoFocus:!0,autoCloseTags:!0,searchReplace:!0,syncScrolling:!0,readOnly:!1,tabSize:4,indentUnit:4,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,showTrailingSpace:!0,matchBrackets:!0,indentWithTabs:!0,styleSelectedText:!0,matchWordHighlight:!0,styleActiveLine:!0,dialogLockScreen:!0,dialogShowMask:!0,dialogDraggable:!0,dialogMaskBgColor:\"#fff\",dialogMaskOpacity:.1,fontSize:\"13px\",saveHTMLToTextarea:!1,disabledKeyMaps:[],onload:function(){},onresize:function(){},onchange:function(){},onwatch:null,onunwatch:null,onpreviewing:function(){},onpreviewed:function(){},onfullscreen:function(){},onfullscreenExit:function(){},onscroll:function(){},onpreviewscroll:function(){},imageUpload:!1,imageFormats:[\"jpg\",\"jpeg\",\"gif\",\"png\",\"bmp\",\"webp\"],imageUploadURL:\"\",crossDomainUpload:!1,uploadCallbackURL:\"\",toc:!0,tocm:!1,tocTitle:\"\",tocDropdown:!1,tocContainer:\"\",tocStartLevel:1,htmlDecode:!1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0,toolbar:!0,toolbarAutoFixed:!0,toolbarIcons:\"full\",toolbarTitles:{},toolbarHandlers:{ucwords:function(){return t.toolbarHandlers.ucwords},lowercase:function(){return t.toolbarHandlers.lowercase}},toolbarCustomIcons:{lowercase:'<a href=\"javascript:;\" title=\"Lowercase\" unselectable=\"on\"><i class=\"fa\" name=\"lowercase\" style=\"font-size:24px;margin-top: -10px;\">a</i></a>',ucwords:'<a href=\"javascript:;\" title=\"ucwords\" unselectable=\"on\"><i class=\"fa\" name=\"ucwords\" style=\"font-size:20px;margin-top: -3px;\">Aa</i></a>'},toolbarIconsClass:{undo:\"fa-undo\",redo:\"fa-repeat\",bold:\"fa-bold\",del:\"fa-strikethrough\",italic:\"fa-italic\",quote:\"fa-quote-left\",uppercase:\"fa-font\",h1:t.classPrefix+\"bold\",h2:t.classPrefix+\"bold\",h3:t.classPrefix+\"bold\",h4:t.classPrefix+\"bold\",h5:t.classPrefix+\"bold\",h6:t.classPrefix+\"bold\",\"list-ul\":\"fa-list-ul\",\"list-ol\":\"fa-list-ol\",hr:\"fa-minus\",link:\"fa-link\",\"reference-link\":\"fa-anchor\",image:\"fa-picture-o\",code:\"fa-code\",\"preformatted-text\":\"fa-file-code-o\",\"code-block\":\"fa-file-code-o\",table:\"fa-table\",datetime:\"fa-clock-o\",emoji:\"fa-smile-o\",\"html-entities\":\"fa-copyright\",pagebreak:\"fa-newspaper-o\",\"goto-line\":\"fa-terminal\",watch:\"fa-eye-slash\",unwatch:\"fa-eye\",preview:\"fa-desktop\",search:\"fa-search\",fullscreen:\"fa-arrows-alt\",clear:\"fa-eraser\",help:\"fa-question-circle\",info:\"fa-info-circle\"},toolbarIconTexts:{},lang:{name:\"zh-cn\",description:\"开源在线Markdown编辑器<br/>Open source online Markdown editor.\",tocTitle:\"目录\",toolbar:{undo:\"撤销（Ctrl+Z）\",redo:\"重做（Ctrl+Y）\",bold:\"粗体\",del:\"删除线\",italic:\"斜体\",quote:\"引用\",ucwords:\"将每个单词首字母转成大写\",uppercase:\"将所选转换成大写\",lowercase:\"将所选转换成小写\",h1:\"标题1\",h2:\"标题2\",h3:\"标题3\",h4:\"标题4\",h5:\"标题5\",h6:\"标题6\",\"list-ul\":\"无序列表\",\"list-ol\":\"有序列表\",hr:\"横线\",link:\"链接\",\"reference-link\":\"引用链接\",image:\"添加图片\",code:\"行内代码\",\"preformatted-text\":\"预格式文本 / 代码块（缩进风格）\",\"code-block\":\"代码块（多语言风格）\",table:\"添加表格\",datetime:\"日期时间\",emoji:\"Emoji表情\",\"html-entities\":\"HTML实体字符\",pagebreak:\"插入分页符\",\"goto-line\":\"跳转到行\",watch:\"关闭实时预览\",unwatch:\"开启实时预览\",preview:\"全窗口预览HTML（按 Shift + ESC还原）\",fullscreen:\"全屏（按ESC还原）\",clear:\"清空\",search:\"搜索\",help:\"使用帮助\",info:\"关于\"+t.title},buttons:{enter:\"确定\",cancel:\"取消\",close:\"关闭\"},dialog:{link:{title:\"添加链接\",url:\"链接地址\",urlTitle:\"链接标题\",urlEmpty:\"错误：请填写链接地址。\"},referenceLink:{title:\"添加引用链接\",name:\"引用名称\",url:\"链接地址\",urlId:\"链接ID\",urlTitle:\"链接标题\",nameEmpty:\"错误：引用链接的名称不能为空。\",idEmpty:\"错误：请填写引用链接的ID。\",urlEmpty:\"错误：请填写引用链接的URL地址。\"},image:{title:\"添加图片\",url:\"图片地址\",link:\"图片链接\",alt:\"图片描述\",uploadButton:\"本地上传\",imageURLEmpty:\"错误：图片地址不能为空。\",uploadFileEmpty:\"错误：上传的图片不能为空。\",formatNotAllowed:\"错误：只允许上传图片文件，允许上传的图片文件格式有：\"},preformattedText:{title:\"添加预格式文本或代码块\",emptyAlert:\"错误：请填写预格式文本或代码的内容。\"},codeBlock:{title:\"添加代码块\",selectLabel:\"代码语言：\",selectDefaultText:\"请选择代码语言\",otherLanguage:\"其他语言\",unselectedLanguageAlert:\"错误：请选择代码所属的语言类型。\",codeEmptyAlert:\"错误：请填写代码内容。\"},htmlEntities:{title:\"HTML 实体字符\"},help:{title:\"使用帮助\"}}}},t.classNames={tex:t.classPrefix+\"tex\"},t.dialogZindex=99999,t.$katex=null,t.$marked=null,t.$CodeMirror=null,t.$prettyPrint=null;var i,o;t.prototype=t.fn={state:{watching:!1,loaded:!1,preview:!1,fullscreen:!1},init:function(i,o){o=o||{},\"object\"==typeof i&&(o=i);var r=this.classPrefix=t.classPrefix,n=this.settings=e.extend(!0,t.defaults,o);i=\"object\"==typeof i?n.id:i;var a=this.editor=e(\"#\"+i);this.id=i,this.lang=n.lang;var s=this.classNames={textarea:{html:r+\"html-textarea\",markdown:r+\"markdown-textarea\"}};n.pluginPath=\"\"===n.pluginPath?n.path+\"../plugins/\":n.pluginPath,this.state.watching=n.watch?!0:!1,a.hasClass(\"editormd\")||a.addClass(\"editormd\"),a.css({width:\"number\"==typeof n.width?n.width+\"px\":n.width,height:\"number\"==typeof n.height?n.height+\"px\":n.height}),n.autoHeight&&a.css(\"height\",\"auto\");var l=this.markdownTextarea=a.children(\"textarea\");l.length<1&&(a.append(\"<textarea></textarea>\"),l=this.markdownTextarea=a.children(\"textarea\")),l.addClass(s.textarea.markdown).attr(\"placeholder\",n.placeholder),(\"undefined\"==typeof l.attr(\"name\")||\"\"===l.attr(\"name\"))&&l.attr(\"name\",\"\"!==n.name?n.name:i+\"-markdown-doc\");var c=[n.readOnly?\"\":'<a href=\"javascript:;\" class=\"fa fa-close '+r+'preview-close-btn\"></a>',n.saveHTMLToTextarea?'<textarea class=\"'+s.textarea.html+'\" name=\"'+i+'-html-code\"></textarea>':\"\",'<div class=\"'+r+'preview\"><div class=\"markdown-body '+r+'preview-container\"></div></div>','<div class=\"'+r+'container-mask\" style=\"display:block;\"></div>','<div class=\"'+r+'mask\"></div>'].join(\"\\n\");return a.append(c).addClass(r+\"vertical\"),\"\"!==n.theme&&a.addClass(r+\"theme-\"+n.theme),this.mask=a.children(\".\"+r+\"mask\"),this.containerMask=a.children(\".\"+r+\"container-mask\"),\"\"!==n.markdown&&l.val(n.markdown),\"\"!==n.appendMarkdown&&l.val(l.val()+n.appendMarkdown),this.htmlTextarea=a.children(\".\"+s.textarea.html),this.preview=a.children(\".\"+r+\"preview\"),this.previewContainer=this.preview.children(\".\"+r+\"preview-container\"),\"\"!==n.previewTheme&&this.preview.addClass(r+\"preview-theme-\"+n.previewTheme),\"function\"==typeof define&&define.amd&&(\"undefined\"!=typeof katex&&(t.$katex=katex),n.searchReplace&&!n.readOnly&&(t.loadCSS(n.path+\"codemirror/addon/dialog/dialog\"),t.loadCSS(n.path+\"codemirror/addon/search/matchesonscrollbar\"))),\"function\"==typeof define&&define.amd||!n.autoLoadModules?(\"undefined\"!=typeof CodeMirror&&(t.$CodeMirror=CodeMirror),\"undefined\"!=typeof marked&&(t.$marked=marked),this.setCodeMirror().setToolbar().loadedDisplay()):this.loadQueues(),this},loadQueues:function(){var e=this,i=this.settings,o=i.path,r=function(){return t.isIE8?void e.loadedDisplay():void(i.flowChart||i.sequenceDiagram?t.loadScript(o+\"raphael.min\",function(){t.loadScript(o+\"underscore.min\",function(){!i.flowChart&&i.sequenceDiagram?t.loadScript(o+\"sequence-diagram.min\",function(){e.loadedDisplay()}):i.flowChart&&!i.sequenceDiagram?t.loadScript(o+\"flowchart.min\",function(){t.loadScript(o+\"jquery.flowchart.min\",function(){e.loadedDisplay()})}):i.flowChart&&i.sequenceDiagram&&t.loadScript(o+\"flowchart.min\",function(){t.loadScript(o+\"jquery.flowchart.min\",function(){t.loadScript(o+\"sequence-diagram.min\",function(){e.loadedDisplay()})})})})}):e.loadedDisplay())};return t.loadCSS(o+\"codemirror/codemirror.min\"),i.searchReplace&&!i.readOnly&&(t.loadCSS(o+\"codemirror/addon/dialog/dialog\"),t.loadCSS(o+\"codemirror/addon/search/matchesonscrollbar\")),i.codeFold&&t.loadCSS(o+\"codemirror/addon/fold/foldgutter\"),t.loadScript(o+\"codemirror/codemirror.min\",function(){t.$CodeMirror=CodeMirror,t.loadScript(o+\"codemirror/modes.min\",function(){t.loadScript(o+\"codemirror/addons.min\",function(){return e.setCodeMirror(),\"gfm\"!==i.mode&&\"markdown\"!==i.mode?(e.loadedDisplay(),!1):(e.setToolbar(),void t.loadScript(o+\"marked.min\",function(){t.$marked=marked,i.previewCodeHighlight?t.loadScript(o+\"prettify.min\",function(){r()}):r()}))})})}),this},setTheme:function(e){var t=this.editor,i=this.settings.theme,o=this.classPrefix+\"theme-\";return t.removeClass(o+i).addClass(o+e),this.settings.theme=e,this},setEditorTheme:function(e){var i=this.settings;return i.editorTheme=e,\"default\"!==e&&t.loadCSS(i.path+\"codemirror/theme/\"+i.editorTheme),this.cm.setOption(\"theme\",e),this},setCodeMirrorTheme:function(e){return this.setEditorTheme(e),this},setPreviewTheme:function(e){var t=this.preview,i=this.settings.previewTheme,o=this.classPrefix+\"preview-theme-\";return t.removeClass(o+i).addClass(o+e),this.settings.previewTheme=e,this},setCodeMirror:function(){var e=this.settings,i=this.editor;\"default\"!==e.editorTheme&&t.loadCSS(e.path+\"codemirror/theme/\"+e.editorTheme);var o={mode:e.mode,theme:e.editorTheme,tabSize:e.tabSize,dragDrop:!1,autofocus:e.autoFocus,autoCloseTags:e.autoCloseTags,readOnly:e.readOnly?\"nocursor\":!1,indentUnit:e.indentUnit,lineNumbers:e.lineNumbers,lineWrapping:e.lineWrapping,extraKeys:{\"Ctrl-Q\":function(e){e.foldCode(e.getCursor())}},foldGutter:e.codeFold,gutters:[\"CodeMirror-linenumbers\",\"CodeMirror-foldgutter\"],matchBrackets:e.matchBrackets,indentWithTabs:e.indentWithTabs,styleActiveLine:e.styleActiveLine,styleSelectedText:e.styleSelectedText,autoCloseBrackets:e.autoCloseBrackets,showTrailingSpace:e.showTrailingSpace,highlightSelectionMatches:e.matchWordHighlight?{showToken:\"onselected\"===e.matchWordHighlight?!1:/\\w/}:!1};return this.codeEditor=this.cm=t.$CodeMirror.fromTextArea(this.markdownTextarea[0],o),this.codeMirror=this.cmElement=i.children(\".CodeMirror\"),\"\"!==e.value&&this.cm.setValue(e.value),this.codeMirror.css({fontSize:e.fontSize,width:e.watch?\"50%\":\"100%\"}),e.autoHeight&&(this.codeMirror.css(\"height\",\"auto\"),this.cm.setOption(\"viewportMargin\",1/0)),e.lineNumbers||this.codeMirror.find(\".CodeMirror-gutters\").css(\"border-right\",\"none\"),this},getCodeMirrorOption:function(e){return this.cm.getOption(e)},setCodeMirrorOption:function(e,t){return this.cm.setOption(e,t),this},addKeyMap:function(e,t){return this.cm.addKeyMap(e,t),this},removeKeyMap:function(e){return this.cm.removeKeyMap(e),this},gotoLine:function(t){var i=this.settings;if(!i.gotoLine)return this;var o=this.cm,r=(this.editor,o.lineCount()),n=this.preview;if(\"string\"==typeof t&&(\"last\"===t&&(t=r),\"first\"===t&&(t=1)),\"number\"!=typeof t)return alert(\"Error: The line number must be an integer.\"),this;if(t=parseInt(t)-1,t>r)return alert(\"Error: The line number range 1-\"+r),this;o.setCursor({line:t,ch:0});var a=o.getScrollInfo(),s=a.clientHeight,l=o.charCoords({line:t,ch:0},\"local\");if(o.scrollTo(null,(l.top+l.bottom-s)/2),i.watch){var c=this.codeMirror.find(\".CodeMirror-scroll\")[0],h=e(c).height(),d=c.scrollTop,u=d/c.scrollHeight;n.scrollTop(0===d?0:d+h>=c.scrollHeight-16?n[0].scrollHeight:n[0].scrollHeight*u)}return o.focus(),this},extend:function(){return\"undefined\"!=typeof arguments[1]&&(\"function\"==typeof arguments[1]&&(arguments[1]=e.proxy(arguments[1],this)),this[arguments[0]]=arguments[1]),\"object\"==typeof arguments[0]&&\"undefined\"==typeof arguments[0].length&&e.extend(!0,this,arguments[0]),this},set:function(t,i){return\"undefined\"!=typeof i&&\"function\"==typeof i&&(i=e.proxy(i,this)),this[t]=i,this},config:function(t,i){var o=this.settings;return\"object\"==typeof t&&(o=e.extend(!0,o,t)),\"string\"==typeof t&&(o[t]=i),this.settings=o,this.recreate(),this},on:function(t,i){var o=this.settings;return\"undefined\"!=typeof o[\"on\"+t]&&(o[\"on\"+t]=e.proxy(i,this)),this},off:function(e){var t=this.settings;return\"undefined\"!=typeof t[\"on\"+e]&&(t[\"on\"+e]=function(){}),this},showToolbar:function(t){var i=this.settings;return i.readOnly?this:(i.toolbar&&(this.toolbar.length<1||\"\"===this.toolbar.find(\".\"+this.classPrefix+\"menu\").html())&&this.setToolbar(),i.toolbar=!0,this.toolbar.show(),this.resize(),e.proxy(t||function(){},this)(),this)},hideToolbar:function(t){var i=this.settings;return i.toolbar=!1,this.toolbar.hide(),this.resize(),e.proxy(t||function(){},this)(),this},setToolbarAutoFixed:function(t){var i=this.state,o=this.editor,r=this.toolbar,n=this.settings;\"undefined\"!=typeof t&&(n.toolbarAutoFixed=t);var a=function(){var t=e(window),i=t.scrollTop();return n.toolbarAutoFixed?void r.css(i-o.offset().top>10&&i<o.height()?{position:\"fixed\",width:o.width()+\"px\",left:(t.width()-o.width())/2+\"px\"}:{position:\"absolute\",width:\"100%\",left:0}):!1};return!i.fullscreen&&!i.preview&&n.toolbar&&n.toolbarAutoFixed&&e(window).bind(\"scroll\",a),this},setToolbar:function(){var e=this.settings;if(e.readOnly)return this;var i=this.editor,o=(this.preview,this.classPrefix),r=this.toolbar=i.children(\".\"+o+\"toolbar\");if(e.toolbar&&r.length<1){var n='<div class=\"'+o+'toolbar\"><div class=\"'+o+'toolbar-container\"><ul class=\"'+o+'menu\"></ul></div></div>';i.append(n),r=this.toolbar=i.children(\".\"+o+\"toolbar\")}if(!e.toolbar)return r.hide(),this;r.show();for(var a=\"function\"==typeof e.toolbarIcons?e.toolbarIcons():\"string\"==typeof e.toolbarIcons?t.toolbarModes[e.toolbarIcons]:e.toolbarIcons,s=r.find(\".\"+this.classPrefix+\"menu\"),l=\"\",c=!1,h=0,d=a.length;d>h;h++){var u=a[h];if(\"||\"===u)c=!0;else if(\"|\"===u)l+='<li class=\"divider\" unselectable=\"on\">|</li>';else{var f=/h(\\d)/.test(u),g=u;\"watch\"!==u||e.watch||(g=\"unwatch\");var p=e.lang.toolbar[g],m=e.toolbarIconTexts[g],w=e.toolbarIconsClass[g];p=\"undefined\"==typeof p?\"\":p,m=\"undefined\"==typeof m?\"\":m,w=\"undefined\"==typeof w?\"\":w;var v=c?'<li class=\"pull-right\">':\"<li>\";\"undefined\"!=typeof e.toolbarCustomIcons[u]&&\"function\"!=typeof e.toolbarCustomIcons[u]?v+=e.toolbarCustomIcons[u]:(v+='<a href=\"javascript:;\" title=\"'+p+'\" unselectable=\"on\">',v+='<i class=\"fa '+w+'\" name=\"'+u+'\" unselectable=\"on\">'+(f?u.toUpperCase():\"\"===w?m:\"\")+\"</i>\",v+=\"</a>\"),v+=\"</li>\",l=c?v+l:l+v}}return s.html(l),s.find('[title=\"Lowercase\"]').attr(\"title\",e.lang.toolbar.lowercase),s.find('[title=\"ucwords\"]').attr(\"title\",e.lang.toolbar.ucwords),this.setToolbarHandler(),this.setToolbarAutoFixed(),this},dialogLockScreen:function(){return e.proxy(t.dialogLockScreen,this)(),this},dialogShowMask:function(i){return e.proxy(t.dialogShowMask,this)(i),this},getToolbarHandles:function(e){var i=this.toolbarHandlers=t.toolbarHandlers;return e&&\"undefined\"!=typeof toolbarIconHandlers[e]?i[e]:i},setToolbarHandler:function(){var i=this,o=this.settings;if(!o.toolbar||o.readOnly)return this;var r=this.toolbar,n=this.cm,a=this.classPrefix,s=this.toolbarIcons=r.find(\".\"+a+\"menu > li > a\"),l=this.getToolbarHandles();return s.bind(t.mouseOrTouch(\"click\",\"touchend\"),function(t){var r=e(this).children(\".fa\"),a=r.attr(\"name\"),s=n.getCursor(),c=n.getSelection();return\"\"!==a?(i.activeIcon=r,\"undefined\"!=typeof l[a]?e.proxy(l[a],i)(n):\"undefined\"!=typeof o.toolbarHandlers[a]&&e.proxy(o.toolbarHandlers[a],i)(n,r,s,c),\"link\"!==a&&\"reference-link\"!==a&&\"image\"!==a&&\"code-block\"!==a&&\"preformatted-text\"!==a&&\"watch\"!==a&&\"preview\"!==a&&\"search\"!==a&&\"fullscreen\"!==a&&\"info\"!==a&&n.focus(),!1):void 0}),this},createDialog:function(i){return e.proxy(t.createDialog,this)(i)},createInfoDialog:function(){var e=this,i=this.editor,o=this.classPrefix,r=['<div class=\"'+o+\"dialog \"+o+'dialog-info\" style=\"\">','<div class=\"'+o+'dialog-container\">','<h1><i class=\"editormd-logo editormd-logo-lg editormd-logo-color\"></i> '+t.title+\"<small>v\"+t.version+\"</small></h1>\",\"<p>\"+this.lang.description+\"</p>\",'<p style=\"margin: 10px 0 20px 0;\"><a href=\"'+t.homePage+'\" target=\"_blank\">'+t.homePage+' <i class=\"fa fa-external-link\"></i></a></p>','<p style=\"font-size: 0.85em;\">Copyright &copy; 2015 <a href=\"https://github.com/pandao\" target=\"_blank\" class=\"hover-link\">Pandao</a>, The <a href=\"https://github.com/pandao/editor.md/blob/master/LICENSE\" target=\"_blank\" class=\"hover-link\">MIT</a> License.</p>',\"</div>\",'<a href=\"javascript:;\" class=\"fa fa-close '+o+'dialog-close\"></a>',\"</div>\"].join(\"\\n\");i.append(r);var n=this.infoDialog=i.children(\".\"+o+\"dialog-info\");return n.find(\".\"+o+\"dialog-close\").bind(t.mouseOrTouch(\"click\",\"touchend\"),function(){e.hideInfoDialog()}),n.css(\"border\",t.isIE8?\"1px solid #ddd\":\"\").css(\"z-index\",t.dialogZindex).show(),this.infoDialogPosition(),this},infoDialogPosition:function(){var t=this.infoDialog,i=function(){t.css({top:(e(window).height()-t.height())/2+\"px\",left:(e(window).width()-t.width())/2+\"px\"})};return i(),e(window).resize(i),this},showInfoDialog:function(){e(\"html,body\").css(\"overflow-x\",\"hidden\");var i=this.editor,o=this.settings,r=this.infoDialog=i.children(\".\"+this.classPrefix+\"dialog-info\");return r.length<1&&this.createInfoDialog(),this.lockScreen(!0),this.mask.css({opacity:o.dialogMaskOpacity,backgroundColor:o.dialogMaskBgColor}).show(),r.css(\"z-index\",t.dialogZindex).show(),this.infoDialogPosition(),this},hideInfoDialog:function(){return e(\"html,body\").css(\"overflow-x\",\"\"),this.infoDialog.hide(),this.mask.hide(),this.lockScreen(!1),this},lockScreen:function(e){return t.lockScreen(e),this.resize(),this},recreate:function(){var e=this.editor,t=this.settings;return this.codeMirror.remove(),this.setCodeMirror(),t.readOnly||(e.find(\".editormd-dialog\").length>0&&e.find(\".editormd-dialog\").remove(),t.toolbar&&(this.getToolbarHandles(),this.setToolbar())),this.loadedDisplay(!0),this},previewCodeHighlight:function(){var e=this.settings,t=this.previewContainer;return e.previewCodeHighlight&&(t.find(\"pre\").addClass(\"prettyprint linenums\"),\"undefined\"!=typeof prettyPrint&&prettyPrint()),this},katexRender:function(){return null===i?this:(this.previewContainer.find(\".\"+t.classNames.tex).each(function(){var i=e(this);t.$katex.render(i.text(),i[0]),i.find(\".katex\").css(\"font-size\",\"1.6em\")}),this)},flowChartAndSequenceDiagramRender:function(){var i=this,r=this.settings,n=this.previewContainer;if(t.isIE8)return this;if(r.flowChart){if(null===o)return this;n.find(\".flowchart\").flowChart()}r.sequenceDiagram&&n.find(\".sequence-diagram\").sequenceDiagram({theme:\"simple\"});var a=i.preview,s=i.codeMirror,l=s.find(\".CodeMirror-scroll\"),c=l.height(),h=l.scrollTop(),d=h/l[0].scrollHeight,u=0;a.find(\".markdown-toc-list\").each(function(){u+=e(this).height()});var f=a.find(\".editormd-toc-menu\").height();return f=f?f:0,a.scrollTop(0===h?0:h+c>=l[0].scrollHeight-16?a[0].scrollHeight:(a[0].scrollHeight+u+f)*d),this},registerKeyMaps:function(i){var o=this,r=this.cm,n=this.settings,a=t.toolbarHandlers,s=n.disabledKeyMaps;if(i=i||null){for(var l in i)if(e.inArray(l,s)<0){var c={};c[l]=i[l],r.addKeyMap(i)}}else{for(var h in t.keyMaps){var d=t.keyMaps[h],u=\"string\"==typeof d?e.proxy(a[d],o):e.proxy(d,o);if(e.inArray(h,[\"F9\",\"F10\",\"F11\"])<0&&e.inArray(h,s)<0){var f={};f[h]=u,r.addKeyMap(f)}}e(window).keydown(function(t){var i={120:\"F9\",121:\"F10\",122:\"F11\"};if(e.inArray(i[t.keyCode],s)<0)switch(t.keyCode){case 120:return e.proxy(a.watch,o)(),!1;case 121:return e.proxy(a.preview,o)(),!1;case 122:return e.proxy(a.fullscreen,o)(),!1}})}return this},bindScrollEvent:function(){var i=this,o=this.preview,r=this.settings,n=this.codeMirror,a=t.mouseOrTouch;if(!r.syncScrolling)return this;var s=function(){n.find(\".CodeMirror-scroll\").bind(a(\"scroll\",\"touchmove\"),function(t){var n=e(this).height(),a=e(this).scrollTop(),s=a/e(this)[0].scrollHeight,l=0;o.find(\".markdown-toc-list\").each(function(){l+=e(this).height()});var c=o.find(\".editormd-toc-menu\").height();c=c?c:0,o.scrollTop(0===a?0:a+n>=e(this)[0].scrollHeight-16?o[0].scrollHeight:(o[0].scrollHeight+l+c)*s),e.proxy(r.onscroll,i)(t)})},l=function(){n.find(\".CodeMirror-scroll\").unbind(a(\"scroll\",\"touchmove\"))},c=function(){o.bind(a(\"scroll\",\"touchmove\"),function(t){var o=e(this).height(),a=e(this).scrollTop(),s=a/e(this)[0].scrollHeight,l=n.find(\".CodeMirror-scroll\");l.scrollTop(0===a?0:a+o>=e(this)[0].scrollHeight?l[0].scrollHeight:l[0].scrollHeight*s),e.proxy(r.onpreviewscroll,i)(t)})},h=function(){o.unbind(a(\"scroll\",\"touchmove\"))};return n.bind({mouseover:s,mouseout:l,touchstart:s,touchend:l}),\"single\"===r.syncScrolling?this:(o.bind({mouseover:c,mouseout:h,touchstart:c,touchend:h}),this)},bindChangeEvent:function(){var e=this,t=this.cm,o=this.settings;return o.syncScrolling?(t.on(\"change\",function(t,r){o.watch&&e.previewContainer.css(\"padding\",o.autoHeight?\"20px 20px 50px 40px\":\"20px\"),i=setTimeout(function(){clearTimeout(i),e.save(),i=null},o.delay)}),this):this},loadedDisplay:function(t){t=t||!1;var i=this,o=this.editor,r=this.preview,n=this.settings;return this.containerMask.hide(),this.save(),n.watch&&r.show(),o.data(\"oldWidth\",o.width()).data(\"oldHeight\",o.height()),this.resize(),this.registerKeyMaps(),e(window).resize(function(){i.resize()}),this.bindScrollEvent().bindChangeEvent(),t||e.proxy(n.onload,this)(),this.state.loaded=!0,this},width:function(e){return this.editor.css(\"width\",\"number\"==typeof e?e+\"px\":e),this.resize(),this},height:function(e){return this.editor.css(\"height\",\"number\"==typeof e?e+\"px\":e),this.resize(),this},resize:function(t,i){t=t||null,i=i||null;var o=this.state,r=this.editor,n=this.preview,a=this.toolbar,s=this.settings,l=this.codeMirror;if(t&&r.css(\"width\",\"number\"==typeof t?t+\"px\":t),!s.autoHeight||o.fullscreen||o.preview?(i&&r.css(\"height\",\"number\"==typeof i?i+\"px\":i),o.fullscreen&&r.height(e(window).height()),s.toolbar&&!s.readOnly?l.css(\"margin-top\",a.height()+1).height(r.height()-a.height()):l.css(\"margin-top\",0).height(r.height())):(r.css(\"height\",\"auto\"),l.css(\"height\",\"auto\")),s.watch)if(l.width(r.width()/2),n.width(o.preview?r.width():r.width()/2),this.previewContainer.css(\"padding\",s.autoHeight?\"20px 20px 50px 40px\":\"20px\"),s.toolbar&&!s.readOnly?n.css(\"top\",a.height()+1):n.css(\"top\",0),!s.autoHeight||o.fullscreen||o.preview){var c=s.toolbar&&!s.readOnly?r.height()-a.height():r.height();n.height(c)}else n.height(\"\");else l.width(r.width()),n.hide();return o.loaded&&e.proxy(s.onresize,this)(),this},save:function(){if(null===i)return this;var r=this,n=this.state,a=this.settings,s=this.cm,l=s.getValue(),c=this.previewContainer;if(\"gfm\"!==a.mode&&\"markdown\"!==a.mode)return this.markdownTextarea.val(l),this;var h=t.$marked,d=this.markdownToC=[],u=this.markedRendererOptions={toc:a.toc,tocm:a.tocm,tocStartLevel:a.tocStartLevel,pageBreak:a.pageBreak,taskList:a.taskList,emoji:a.emoji,tex:a.tex,atLink:a.atLink,emailLink:a.emailLink,flowChart:a.flowChart,sequenceDiagram:a.sequenceDiagram,previewCodeHighlight:a.previewCodeHighlight},f=this.markedOptions={renderer:t.markedRenderer(d,u),gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:a.htmlDecode?!1:!0,smartLists:!0,smartypants:!0};h.setOptions(f);var g=t.$marked(l,f);if(g=t.filterHTMLTags(g,a.htmlDecode),this.markdownTextarea.text(l),s.save(),a.saveHTMLToTextarea&&this.htmlTextarea.text(g),a.watch||!a.watch&&n.preview){if(c.html(g),this.previewCodeHighlight(),a.toc){var p=\"\"===a.tocContainer?c:e(a.tocContainer),m=p.find(\".\"+this.classPrefix+\"toc-menu\");p.attr(\"previewContainer\",\"\"===a.tocContainer?\"true\":\"false\"),\"\"!==a.tocContainer&&m.length>0&&m.remove(),t.markdownToCRenderer(d,p,a.tocDropdown,a.tocStartLevel),(a.tocDropdown||p.find(\".\"+this.classPrefix+\"toc-menu\").length>0)&&t.tocDropdownMenu(p,\"\"!==a.tocTitle?a.tocTitle:this.lang.tocTitle),\"\"!==a.tocContainer&&c.find(\".markdown-toc\").css(\"border\",\"none\")}a.tex&&(!t.kaTeXLoaded&&a.autoLoadModules?t.loadKaTeX(function(){t.$katex=katex,t.kaTeXLoaded=!0,r.katexRender()}):(t.$katex=katex,this.katexRender())),(a.flowChart||a.sequenceDiagram)&&(o=setTimeout(function(){clearTimeout(o),r.flowChartAndSequenceDiagramRender(),o=null},10)),n.loaded&&e.proxy(a.onchange,this)()}return this},focus:function(){return this.cm.focus(),this},setCursor:function(e){return this.cm.setCursor(e),this},getCursor:function(){return this.cm.getCursor()},setSelection:function(e,t){return this.cm.setSelection(e,t),this},getSelection:function(){return this.cm.getSelection()},setSelections:function(e){return this.cm.setSelections(e),this},getSelections:function(){return this.cm.getSelections()},replaceSelection:function(e){return this.cm.replaceSelection(e),this},insertValue:function(e){return this.replaceSelection(e),this},appendMarkdown:function(e){var t=(this.settings,this.cm);return t.setValue(t.getValue()+e),this},setMarkdown:function(e){return this.cm.setValue(e||this.settings.markdown),this},getMarkdown:function(){return this.cm.getValue()},getValue:function(){return this.cm.getValue()},setValue:function(e){return this.cm.setValue(e),this},clear:function(){return this.cm.setValue(\"\"),this},getHTML:function(){return this.settings.saveHTMLToTextarea?this.htmlTextarea.val():(alert(\"Error: settings.saveHTMLToTextarea == false\"),!1)},getTextareaSavedHTML:function(){return this.getHTML()},getPreviewedHTML:function(){return this.settings.watch?this.previewContainer.html():(alert(\"Error: settings.watch == false\"),!1)},watch:function(t){var o=this.settings;if(e.inArray(o.mode,[\"gfm\",\"markdown\"])<0)return this;if(this.state.watching=o.watch=!0,this.preview.show(),this.toolbar){var r=o.toolbarIconsClass.watch,n=o.toolbarIconsClass.unwatch,a=this.toolbar.find(\".fa[name=watch]\");a.parent().attr(\"title\",o.lang.toolbar.watch),a.removeClass(n).addClass(r)}return this.codeMirror.css(\"border-right\",\"1px solid #ddd\").width(this.editor.width()/2),i=0,this.save().resize(),o.onwatch||(o.onwatch=t||function(){}),e.proxy(o.onwatch,this)(),this},unwatch:function(t){var i=this.settings;if(this.state.watching=i.watch=!1,this.preview.hide(),this.toolbar){var o=i.toolbarIconsClass.watch,r=i.toolbarIconsClass.unwatch,n=this.toolbar.find(\".fa[name=watch]\");n.parent().attr(\"title\",i.lang.toolbar.unwatch),n.removeClass(o).addClass(r)}return this.codeMirror.css(\"border-right\",\"none\").width(this.editor.width()),this.resize(),i.onunwatch||(i.onunwatch=t||function(){}),e.proxy(i.onunwatch,this)(),this},show:function(t){t=t||function(){};var i=this;return this.editor.show(0,function(){e.proxy(t,i)()}),this},hide:function(t){t=t||function(){};var i=this;return this.editor.hide(0,function(){e.proxy(t,i)()}),this},previewing:function(){var i=this,o=this.editor,r=this.preview,n=this.toolbar,a=this.settings,s=this.codeMirror,l=this.previewContainer;if(e.inArray(a.mode,[\"gfm\",\"markdown\"])<0)return this;a.toolbar&&n&&(n.toggle(),n.find(\".fa[name=preview]\").toggleClass(\"active\")),s.toggle();var c=function(e){e.shiftKey&&27===e.keyCode&&i.previewed()};\"none\"===s.css(\"display\")?(this.state.preview=!0,this.state.fullscreen&&r.css(\"background\",\"#fff\"),o.find(\".\"+this.classPrefix+\"preview-close-btn\").show().bind(t.mouseOrTouch(\"click\",\"touchend\"),function(){i.previewed()}),a.watch?l.css(\"padding\",\"\"):this.save(),l.addClass(this.classPrefix+\"preview-active\"),r.show().css({position:\"\",top:0,width:o.width(),height:a.autoHeight&&!this.state.fullscreen?\"auto\":o.height()}),this.state.loaded&&e.proxy(a.onpreviewing,this)(),e(window).bind(\"keyup\",c)):(e(window).unbind(\"keyup\",c),this.previewed())},previewed:function(){var i=this.editor,o=this.preview,r=this.toolbar,n=this.settings,a=this.previewContainer,s=i.find(\".\"+this.classPrefix+\"preview-close-btn\");return this.state.preview=!1,this.codeMirror.show(),n.toolbar&&r.show(),o[n.watch?\"show\":\"hide\"](),s.hide().unbind(t.mouseOrTouch(\"click\",\"touchend\")),a.removeClass(this.classPrefix+\"preview-active\"),n.watch&&a.css(\"padding\",\"20px\"),o.css({background:null,position:\"absolute\",width:i.width()/2,height:n.autoHeight&&!this.state.fullscreen?\"auto\":i.height()-r.height(),top:n.toolbar?r.height():0}),this.state.loaded&&e.proxy(n.onpreviewed,this)(),this},fullscreen:function(){var t=this,i=this.state,o=this.editor,r=(this.preview,this.toolbar),n=this.settings,a=this.classPrefix+\"fullscreen\";r&&r.find(\".fa[name=fullscreen]\").parent().toggleClass(\"active\");var s=function(e){e.shiftKey||27!==e.keyCode||i.fullscreen&&t.fullscreenExit()};return o.hasClass(a)?(e(window).unbind(\"keyup\",s),this.fullscreenExit()):(i.fullscreen=!0,e(\"html,body\").css(\"overflow\",\"hidden\"),o.css({width:e(window).width(),height:e(window).height()}).addClass(a),this.resize(),e.proxy(n.onfullscreen,this)(),e(window).bind(\"keyup\",s)),this},fullscreenExit:function(){var t=this.editor,i=this.settings,o=this.toolbar,r=this.classPrefix+\"fullscreen\";return this.state.fullscreen=!1,o&&o.find(\".fa[name=fullscreen]\").parent().removeClass(\"active\"),e(\"html,body\").css(\"overflow\",\"\"),t.css({width:t.data(\"oldWidth\"),height:t.data(\"oldHeight\")}).removeClass(r),this.resize(),e.proxy(i.onfullscreenExit,this)(),this},executePlugin:function(i,o){var r=this,n=this.cm,a=this.settings;return o=a.pluginPath+o,\"function\"==typeof define?\"undefined\"==typeof this[i]?(alert(\"Error: \"+i+\" plugin is not found, you are not load this plugin.\"),this):(this[i](n),this):(e.inArray(o,t.loadFiles.plugin)<0?t.loadPlugin(o,function(){t.loadPlugins[i]=r[i],r[i](n)}):e.proxy(t.loadPlugins[i],this)(n),this)},search:function(e){var t=this.settings;return t.searchReplace?(t.readOnly||this.cm.execCommand(e||\"find\"),this):(alert(\"Error: settings.searchReplace == false\"),this)},searchReplace:function(){return this.search(\"replace\"),this},searchReplaceAll:function(){return this.search(\"replaceAll\"),this}},t.fn.init.prototype=t.fn,t.dialogLockScreen=function(){var t=this.settings||{dialogLockScreen:!0};t.dialogLockScreen&&(e(\"html,body\").css(\"overflow\",\"hidden\"),this.resize())},t.dialogShowMask=function(t){var i=this.editor,o=this.settings||{dialogShowMask:!0};t.css({top:(e(window).height()-t.height())/2+\"px\",left:(e(window).width()-t.width())/2+\"px\"}),o.dialogShowMask&&i.children(\".\"+this.classPrefix+\"mask\").css(\"z-index\",parseInt(t.css(\"z-index\"))-1).show()},t.toolbarHandlers={undo:function(){this.cm.undo()},redo:function(){this.cm.redo()},bold:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"**\"+i+\"**\"),\"\"===i&&e.setCursor(t.line,t.ch+2)},del:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"~~\"+i+\"~~\"),\"\"===i&&e.setCursor(t.line,t.ch+2)},italic:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"*\"+i+\"*\"),\"\"===i&&e.setCursor(t.line,t.ch+1)},quote:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"> \"+i),e.setCursor(t.line,t.ch+2)):e.replaceSelection(\"> \"+i)},ucfirst:function(){var e=this.cm,i=e.getSelection(),o=e.listSelections();e.replaceSelection(t.firstUpperCase(i)),e.setSelections(o)},ucwords:function(){var e=this.cm,i=e.getSelection(),o=e.listSelections();e.replaceSelection(t.wordsFirstUpperCase(i)),e.setSelections(o)},uppercase:function(){var e=this.cm,t=e.getSelection(),i=e.listSelections();e.replaceSelection(t.toUpperCase()),e.setSelections(i)},lowercase:function(){var e=this.cm,t=(e.getCursor(),e.getSelection()),i=e.listSelections();e.replaceSelection(t.toLowerCase()),e.setSelections(i)},h1:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"# \"+i),e.setCursor(t.line,t.ch+2)):e.replaceSelection(\"# \"+i)},h2:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),\ne.replaceSelection(\"## \"+i),e.setCursor(t.line,t.ch+3)):e.replaceSelection(\"## \"+i)},h3:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"### \"+i),e.setCursor(t.line,t.ch+4)):e.replaceSelection(\"### \"+i)},h4:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"#### \"+i),e.setCursor(t.line,t.ch+5)):e.replaceSelection(\"#### \"+i)},h5:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"##### \"+i),e.setCursor(t.line,t.ch+6)):e.replaceSelection(\"##### \"+i)},h6:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection(\"###### \"+i),e.setCursor(t.line,t.ch+7)):e.replaceSelection(\"###### \"+i)},\"list-ul\":function(){var e=this.cm,t=(e.getCursor(),e.getSelection());if(\"\"===t)e.replaceSelection(\"- \"+t);else{for(var i=t.split(\"\\n\"),o=0,r=i.length;r>o;o++)i[o]=\"\"===i[o]?\"\":\"- \"+i[o];e.replaceSelection(i.join(\"\\n\"))}},\"list-ol\":function(){var e=this.cm,t=(e.getCursor(),e.getSelection());if(\"\"===t)e.replaceSelection(\"1. \"+t);else{for(var i=t.split(\"\\n\"),o=0,r=i.length;r>o;o++)i[o]=\"\"===i[o]?\"\":o+1+\". \"+i[o];e.replaceSelection(i.join(\"\\n\"))}},hr:function(){{var e=this.cm,t=e.getCursor();e.getSelection()}e.replaceSelection((0!==t.ch?\"\\n\\n\":\"\\n\")+\"------------\\n\\n\")},tex:function(){if(!this.settings.tex)return alert(\"settings.tex === false\"),this;var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"$$\"+i+\"$$\"),\"\"===i&&e.setCursor(t.line,t.ch+2)},link:function(){this.executePlugin(\"linkDialog\",\"link-dialog/link-dialog\")},\"reference-link\":function(){this.executePlugin(\"referenceLinkDialog\",\"reference-link-dialog/reference-link-dialog\")},pagebreak:function(){if(!this.settings.pageBreak)return alert(\"settings.pageBreak === false\"),this;{var e=this.cm;e.getSelection()}e.replaceSelection(\"\\r\\n[========]\\r\\n\")},image:function(){this.executePlugin(\"imageDialog\",\"image-dialog/image-dialog\")},code:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(\"`\"+i+\"`\"),\"\"===i&&e.setCursor(t.line,t.ch+1)},\"code-block\":function(){this.executePlugin(\"codeBlockDialog\",\"code-block-dialog/code-block-dialog\")},\"preformatted-text\":function(){this.executePlugin(\"preformattedTextDialog\",\"preformatted-text-dialog/preformatted-text-dialog\")},table:function(){this.executePlugin(\"tableDialog\",\"table-dialog/table-dialog\")},datetime:function(){var e=this.cm,i=(e.getSelection(),new Date,this.settings.lang.name),o=t.dateFormat()+\" \"+t.dateFormat(\"zh-cn\"===i||\"zh-tw\"===i?\"cn-week-day\":\"week-day\");e.replaceSelection(o)},emoji:function(){this.executePlugin(\"emojiDialog\",\"emoji-dialog/emoji-dialog\")},\"html-entities\":function(){this.executePlugin(\"htmlEntitiesDialog\",\"html-entities-dialog/html-entities-dialog\")},\"goto-line\":function(){this.executePlugin(\"gotoLineDialog\",\"goto-line-dialog/goto-line-dialog\")},watch:function(){this[this.settings.watch?\"unwatch\":\"watch\"]()},preview:function(){this.previewing()},fullscreen:function(){this.fullscreen()},clear:function(){this.clear()},search:function(){this.search()},help:function(){this.executePlugin(\"helpDialog\",\"help-dialog/help-dialog\")},info:function(){this.showInfoDialog()}},t.keyMaps={\"Ctrl-1\":\"h1\",\"Ctrl-2\":\"h2\",\"Ctrl-3\":\"h3\",\"Ctrl-4\":\"h4\",\"Ctrl-5\":\"h5\",\"Ctrl-6\":\"h6\",\"Ctrl-B\":\"bold\",\"Ctrl-D\":\"datetime\",\"Ctrl-E\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();return this.settings.emoji?(e.replaceSelection(\":\"+i+\":\"),void(\"\"===i&&e.setCursor(t.line,t.ch+1))):void alert(\"Error: settings.emoji == false\")},\"Ctrl-Alt-G\":\"goto-line\",\"Ctrl-H\":\"hr\",\"Ctrl-I\":\"italic\",\"Ctrl-K\":\"code\",\"Ctrl-L\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection(),o=\"\"===i?\"\":' \"'+i+'\"';e.replaceSelection(\"[\"+i+\"](\"+o+\")\"),\"\"===i&&e.setCursor(t.line,t.ch+1)},\"Ctrl-U\":\"list-ul\",\"Shift-Ctrl-A\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();return this.settings.atLink?(e.replaceSelection(\"@\"+i),void(\"\"===i&&e.setCursor(t.line,t.ch+1))):void alert(\"Error: settings.atLink == false\")},\"Shift-Ctrl-C\":\"code\",\"Shift-Ctrl-Q\":\"quote\",\"Shift-Ctrl-S\":\"del\",\"Shift-Ctrl-K\":\"tex\",\"Shift-Alt-C\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection([\"```\",i,\"```\"].join(\"\\n\")),\"\"===i&&e.setCursor(t.line,t.ch+3)},\"Shift-Ctrl-Alt-C\":\"code-block\",\"Shift-Ctrl-H\":\"html-entities\",\"Shift-Alt-H\":\"help\",\"Shift-Ctrl-E\":\"emoji\",\"Shift-Ctrl-U\":\"uppercase\",\"Shift-Alt-U\":\"ucwords\",\"Shift-Ctrl-Alt-U\":\"ucfirst\",\"Shift-Alt-L\":\"lowercase\",\"Shift-Ctrl-I\":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection(),o=\"\"===i?\"\":' \"'+i+'\"';e.replaceSelection(\"![\"+i+\"](\"+o+\")\"),\"\"===i&&e.setCursor(t.line,t.ch+4)},\"Shift-Ctrl-Alt-I\":\"image\",\"Shift-Ctrl-L\":\"link\",\"Shift-Ctrl-O\":\"list-ol\",\"Shift-Ctrl-P\":\"preformatted-text\",\"Shift-Ctrl-T\":\"table\",\"Shift-Alt-P\":\"pagebreak\",F9:\"watch\",F10:\"preview\",F11:\"fullscreen\"};var r=function(e){return String.prototype.trim?e.trim():e.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,\"\")};t.trim=r;var n=function(e){return e.toLowerCase().replace(/\\b(\\w)|\\s(\\w)/g,function(e){return e.toUpperCase()})};t.ucwords=t.wordsFirstUpperCase=n;var a=function(e){return e.toLowerCase().replace(/\\b(\\w)/,function(e){return e.toUpperCase()})};return t.firstUpperCase=t.ucfirst=a,t.urls={atLinkBase:\"https://github.com/\"},t.regexs={atLink:/@(\\w+)/g,email:/(\\w+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,emailLink:/(mailto:)?([\\w\\.\\_]+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,emoji:/:([\\w\\+-]+):/g,emojiDatetime:/(\\d{2}:\\d{2}:\\d{2})/g,twemoji:/:(tw-([\\w]+)-?(\\w+)?):/g,fontAwesome:/:(fa-([\\w]+)(-(\\w+)){0,}):/g,editormdLogo:/:(editormd-logo-?(\\w+)?):/g,pageBreak:/^\\[[=]{8,}\\]$/},t.emoji={path:\"http://www.emoji-cheat-sheet.com/graphics/emojis/\",ext:\".png\"},t.twemoji={path:\"http://twemoji.maxcdn.com/36x36/\",ext:\".png\"},t.markedRenderer=function(i,o){var n={toc:!0,tocm:!1,tocStartLevel:1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1},a=e.extend(n,o||{}),s=t.$marked,l=new s.Renderer;i=i||[];var c=t.regexs,h=c.atLink,d=c.emoji,u=c.email,f=c.emailLink,g=c.twemoji,p=c.fontAwesome,m=c.editormdLogo,w=c.pageBreak;return l.emoji=function(e){e=e.replace(t.regexs.emojiDatetime,function(e){return e.replace(/:/g,\"&#58;\")});var i=e.match(d);if(!i||!a.emoji)return e;for(var o=0,r=i.length;r>o;o++)\":+1:\"===i[o]&&(i[o]=\":\\\\+1:\"),e=e.replace(new RegExp(i[o]),function(e,i){var o=e.match(p),r=e.replace(/:/g,\"\");if(o)for(var n=0,a=o.length;a>n;n++){var s=o[n].replace(/:/g,\"\");return'<i class=\"fa '+s+' fa-emoji\" title=\"'+s.replace(\"fa-\",\"\")+'\"></i>'}else{var l=e.match(m),c=e.match(g);if(l)for(var h=0,d=l.length;d>h;h++){var u=l[h].replace(/:/g,\"\");return'<i class=\"'+u+'\" title=\"Editor.md logo ('+u+')\"></i>'}else{if(!c){var f=\"+1\"===r?\"plus1\":r;return f=\"black_large_square\"===f?\"black_square\":f,f=\"moon\"===f?\"waxing_gibbous_moon\":f,'<img src=\"'+t.emoji.path+f+t.emoji.ext+'\" class=\"emoji\" title=\"&#58;'+r+'&#58;\" alt=\"&#58;'+r+'&#58;\" />'}for(var w=0,v=c.length;v>w;w++){var k=c[w].replace(/:/g,\"\").replace(\"tw-\",\"\");return'<img src=\"'+t.twemoji.path+k+t.twemoji.ext+'\" title=\"twemoji-'+k+'\" alt=\"twemoji-'+k+'\" class=\"emoji twemoji\" />'}}}});return e},l.atLink=function(i){return h.test(i)?(a.atLink&&(i=i.replace(u,function(e,t,i,o){return e.replace(/@/g,\"_#_&#64;_#_\")}),i=i.replace(h,function(e,i){return'<a href=\"'+t.urls.atLinkBase+i+'\" title=\"&#64;'+i+'\" class=\"at-link\">'+e+\"</a>\"}).replace(/_#_&#64;_#_/g,\"@\")),a.emailLink&&(i=i.replace(f,function(t,i,o,r,n){return!i&&e.inArray(n,\"jpg|jpeg|png|gif|webp|ico|icon|pdf\".split(\"|\"))<0?'<a href=\"mailto:'+t+'\">'+t+\"</a>\":t})),i):i},l.link=function(e,t,i){if(this.options.sanitize){try{var o=decodeURIComponent(unescape(e)).replace(/[^\\w:]/g,\"\").toLowerCase()}catch(r){return\"\"}if(0===o.indexOf(\"javascript:\"))return\"\"}var n='<a href=\"'+e+'\"';return h.test(t)||h.test(i)?(t&&(n+=' title=\"'+t.replace(/@/g,\"&#64;\")),n+'\">'+i.replace(/@/g,\"&#64;\")+\"</a>\"):(t&&(n+=' title=\"'+t+'\"'),n+=\">\"+i+\"</a>\")},l.heading=function(e,t,o){var n=e,a=/\\s*\\<a\\s*href\\=\\\"(.*)\\\"\\s*([^\\>]*)\\>(.*)\\<\\/a\\>\\s*/;if(a.test(e)){var s=[];e=e.split(/\\<a\\s*([^\\>]+)\\>([^\\>]*)\\<\\/a\\>/);for(var l=0,c=e.length;c>l;l++)s.push(e[l].replace(/\\s*href\\=\\\"(.*)\\\"\\s*/g,\"\"));e=s.join(\" \")}e=r(e);var h=e.toLowerCase().replace(/[^\\w]+/g,\"-\"),d={text:e,level:t,slug:h},u=/^[\\u4e00-\\u9fa5]+$/.test(e),f=u?escape(e).replace(/\\%/g,\"\"):e.toLowerCase().replace(/[^\\w]+/g,\"-\");i.push(d);var g=\"<h\"+t+' id=\"h'+t+\"-\"+this.options.headerPrefix+f+'\">';return g+='<a name=\"'+e+'\" class=\"reference-link\"></a>',g+='<span class=\"header-link octicon octicon-link\"></span>',g+=this.atLink(a?this.emoji(n):this.emoji(e)),g+=\"</h\"+t+\">\"},l.pageBreak=function(e){return w.test(e)&&a.pageBreak&&(e='<hr style=\"page-break-after:always;\" class=\"page-break editormd-page-break\" />'),e},l.paragraph=function(e){var i=/\\$\\$(.*)\\$\\$/g.test(e),o=/^\\$\\$(.*)\\$\\$$/.test(e),r=o?' class=\"'+t.classNames.tex+'\"':\"\",n=a.tocm?/^(\\[TOC\\]|\\[TOCM\\])$/.test(e):/^\\[TOC\\]$/.test(e),s=/^\\[TOCM\\]$/.test(e);e=!o&&i?e.replace(/(\\$\\$([^\\$]*)\\$\\$)+/g,function(e,i){return'<span class=\"'+t.classNames.tex+'\">'+i.replace(/\\$/g,\"\")+\"</span>\"}):o?e.replace(/\\$/g,\"\"):e;var l='<div class=\"markdown-toc editormd-markdown-toc\">'+e+\"</div>\";return n?s?'<div class=\"editormd-toc-menu\">'+l+\"</div><br/>\":l:w.test(e)?this.pageBreak(e):\"<p\"+r+\">\"+this.atLink(this.emoji(e))+\"</p>\\n\"},l.code=function(e,i,o){return\"seq\"===i||\"sequence\"===i?'<div class=\"sequence-diagram\">'+e+\"</div>\":\"flow\"===i?'<div class=\"flowchart\">'+e+\"</div>\":\"math\"===i||\"latex\"===i||\"katex\"===i?'<p class=\"'+t.classNames.tex+'\">'+e+\"</p>\":s.Renderer.prototype.code.apply(this,arguments)},l.tablecell=function(e,t){var i=t.header?\"th\":\"td\",o=t.align?\"<\"+i+' style=\"text-align:'+t.align+'\">':\"<\"+i+\">\";return o+this.atLink(this.emoji(e))+\"</\"+i+\">\\n\"},l.listitem=function(e){return a.taskList&&/^\\s*\\[[x\\s]\\]\\s*/.test(e)?(e=e.replace(/^\\s*\\[\\s\\]\\s*/,'<input type=\"checkbox\" class=\"task-list-item-checkbox\" /> ').replace(/^\\s*\\[x\\]\\s*/,'<input type=\"checkbox\" class=\"task-list-item-checkbox\" checked disabled /> '),'<li style=\"list-style: none;\">'+this.atLink(this.emoji(e))+\"</li>\"):\"<li>\"+this.atLink(this.emoji(e))+\"</li>\"},l},t.markdownToCRenderer=function(e,t,i,o){var r=\"\",n=0,a=this.classPrefix;o=o||1;for(var s=0,l=e.length;l>s;s++){var c=e[s].text,h=e[s].level;o>h||(r+=h>n?\"\":n>h?new Array(n-h+2).join(\"</ul></li>\"):\"</ul></li>\",r+='<li><a class=\"toc-level-'+h+'\" href=\"#'+c+'\" level=\"'+h+'\">'+c+\"</a><ul>\",n=h)}var d=t.find(\".markdown-toc\");if(d.length<1&&\"false\"===t.attr(\"previewContainer\")){var u='<div class=\"markdown-toc '+a+'markdown-toc\"></div>';u=i?'<div class=\"'+a+'toc-menu\">'+u+\"</div>\":u,t.html(u),d=t.find(\".markdown-toc\")}return i&&d.wrap('<div class=\"'+a+'toc-menu\"></div><br/>'),d.html('<ul class=\"markdown-toc-list\"></ul>').children(\".markdown-toc-list\").html(r.replace(/\\r?\\n?\\<ul\\>\\<\\/ul\\>/g,\"\")),d},t.tocDropdownMenu=function(t,i){i=i||\"Table of Contents\";var o=400,r=t.find(\".\"+this.classPrefix+\"toc-menu\");return r.each(function(){var t=e(this),r=t.children(\".markdown-toc\"),n='<i class=\"fa fa-angle-down\"></i>',a='<a href=\"javascript:;\" class=\"toc-menu-btn\">'+n+i+\"</a>\",s=r.children(\"ul\"),l=s.find(\"li\");r.append(a),l.first().before(\"<li><h1>\"+i+\" \"+n+\"</h1></li>\"),t.mouseover(function(){s.show(),l.each(function(){var t=e(this),i=t.children(\"ul\");if(\"\"===i.html()&&i.remove(),i.length>0&&\"\"!==i.html()){var r=t.children(\"a\").first();r.children(\".fa\").length<1&&r.append(e(n).css({\"float\":\"right\",paddingTop:\"4px\"}))}t.mouseover(function(){i.css(\"z-index\",o).show(),o+=1}).mouseleave(function(){i.hide()})})}).mouseleave(function(){s.hide()})}),r},t.filterHTMLTags=function(t,i){if(\"string\"!=typeof t&&(t=new String(t)),\"string\"!=typeof i)return t;for(var o=i.split(\"|\"),r=o[0].split(\",\"),n=o[1],a=0,s=r.length;s>a;a++){var l=r[a];t=t.replace(new RegExp(\"<s*\"+l+\"s*([^>]*)>([^>]*)<s*/\"+l+\"s*>\",\"igm\"),\"\")}if(\"undefined\"!=typeof n){var c=/\\<(\\w+)\\s*([^\\>]*)\\>([^\\>]*)\\<\\/(\\w+)\\>/gi;t=\"*\"===n?t.replace(c,function(e,t,i,o,r){return\"<\"+t+\">\"+o+\"</\"+r+\">\"}):\"on*\"===n?t.replace(c,function(t,i,o,r,n){var a=e(\"<\"+i+\">\"+r+\"</\"+n+\">\"),s=e(t)[0].attributes,l={};e.each(s,function(e,t){'\"'!==t.nodeName&&(l[t.nodeName]=t.nodeValue)}),e.each(l,function(e){0===e.indexOf(\"on\")&&delete l[e]}),a.attr(l);var c=\"undefined\"!=typeof a[1]?e(a[1]).text():\"\";return a[0].outerHTML+c}):t.replace(c,function(t,i,o,r){var a=n.split(\",\"),s=e(t);return s.html(r),e.each(a,function(e){s.attr(a[e],null)}),s[0].outerHTML})}return t},t.markdownToHTML=function(i,o){var r={gfm:!0,toc:!0,tocm:!1,tocStartLevel:1,tocTitle:\"目录\",tocDropdown:!1,tocContainer:\"\",markdown:\"\",markdownSourceCode:!1,htmlDecode:!1,autoLoadKaTeX:!0,pageBreak:!0,atLink:!0,emailLink:!0,tex:!1,taskList:!1,emoji:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0};t.$marked=marked;var n=e(\"#\"+i),a=n.settings=e.extend(!0,r,o||{}),s=n.find(\"textarea\");s.length<1&&(n.append(\"<textarea></textarea>\"),s=n.find(\"textarea\"));var l=\"\"===a.markdown?s.val():a.markdown,c=[],h={toc:a.toc,tocm:a.tocm,tocStartLevel:a.tocStartLevel,taskList:a.taskList,emoji:a.emoji,tex:a.tex,pageBreak:a.pageBreak,atLink:a.atLink,emailLink:a.emailLink,flowChart:a.flowChart,sequenceDiagram:a.sequenceDiagram,previewCodeHighlight:a.previewCodeHighlight},d={renderer:t.markedRenderer(c,h),gfm:a.gfm,tables:!0,breaks:!0,pedantic:!1,sanitize:a.htmlDecode?!1:!0,smartLists:!0,smartypants:!0};l=new String(l);var u=marked(l,d);u=t.filterHTMLTags(u,a.htmlDecode),a.markdownSourceCode?s.text(l):s.remove(),n.addClass(\"markdown-body \"+this.classPrefix+\"html-preview\").append(u);var f=\"\"!==a.tocContainer?e(a.tocContainer):n;if(\"\"!==a.tocContainer&&f.attr(\"previewContainer\",!1),a.toc&&(n.tocContainer=this.markdownToCRenderer(c,f,a.tocDropdown,a.tocStartLevel),(a.tocDropdown||n.find(\".\"+this.classPrefix+\"toc-menu\").length>0)&&this.tocDropdownMenu(n,a.tocTitle),\"\"!==a.tocContainer&&n.find(\".editormd-toc-menu, .editormd-markdown-toc\").remove()),a.previewCodeHighlight&&(n.find(\"pre\").addClass(\"prettyprint linenums\"),prettyPrint()),t.isIE8||(a.flowChart&&n.find(\".flowchart\").flowChart(),a.sequenceDiagram&&n.find(\".sequence-diagram\").sequenceDiagram({theme:\"simple\"})),a.tex){var g=function(){n.find(\".\"+t.classNames.tex).each(function(){var t=e(this);katex.render(t.html().replace(/&lt;/g,\"<\").replace(/&gt;/g,\">\"),t[0]),t.find(\".katex\").css(\"font-size\",\"1.6em\")})};!a.autoLoadKaTeX||t.$katex||t.kaTeXLoaded?g():this.loadKaTeX(function(){t.$katex=katex,t.kaTeXLoaded=!0,g()})}return n.getMarkdown=function(){return s.val()},n},t.themes=[\"default\",\"dark\"],t.previewThemes=[\"default\",\"dark\"],t.editorThemes=[\"default\",\"3024-day\",\"3024-night\",\"ambiance\",\"ambiance-mobile\",\"base16-dark\",\"base16-light\",\"blackboard\",\"cobalt\",\"eclipse\",\"elegant\",\"erlang-dark\",\"lesser-dark\",\"mbo\",\"mdn-like\",\"midnight\",\"monokai\",\"neat\",\"neo\",\"night\",\"paraiso-dark\",\"paraiso-light\",\"pastel-on-dark\",\"rubyblue\",\"solarized\",\"the-matrix\",\"tomorrow-night-eighties\",\"twilight\",\"vibrant-ink\",\"xq-dark\",\"xq-light\"],t.loadPlugins={},t.loadFiles={js:[],css:[],plugin:[]},t.loadPlugin=function(e,i,o){i=i||function(){},this.loadScript(e,function(){t.loadFiles.plugin.push(e),i()},o)},t.loadCSS=function(e,i,o){o=o||\"head\",i=i||function(){};var r=document.createElement(\"link\");r.type=\"text/css\",r.rel=\"stylesheet\",r.onload=r.onreadystatechange=function(){t.loadFiles.css.push(e),i()},r.href=e+\".css\",\"head\"===o?document.getElementsByTagName(\"head\")[0].appendChild(r):document.body.appendChild(r)},t.isIE=\"Microsoft Internet Explorer\"==navigator.appName,t.isIE8=t.isIE&&\"8.\"==navigator.appVersion.match(/8./i),t.loadScript=function(e,i,o){o=o||\"head\",i=i||function(){};var r=null;r=document.createElement(\"script\"),r.id=e.replace(/[\\./]+/g,\"-\"),r.type=\"text/javascript\",r.src=e+\".js\",t.isIE8?r.onreadystatechange=function(){r.readyState&&(\"loaded\"===r.readyState||\"complete\"===r.readyState)&&(r.onreadystatechange=null,t.loadFiles.js.push(e),i())}:r.onload=function(){t.loadFiles.js.push(e),i()},\"head\"===o?document.getElementsByTagName(\"head\")[0].appendChild(r):document.body.appendChild(r)},t.katexURL={css:\"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\",js:\"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\"},t.kaTeXLoaded=!1,t.loadKaTeX=function(e){t.loadCSS(t.katexURL.css,function(){t.loadScript(t.katexURL.js,e||function(){})})},t.lockScreen=function(t){e(\"html,body\").css(\"overflow\",t?\"hidden\":\"\")},t.createDialog=function(i){var o={name:\"\",width:420,height:240,title:\"\",drag:!0,closed:!0,content:\"\",mask:!0,maskStyle:{backgroundColor:\"#fff\",opacity:.1},lockScreen:!0,footer:!0,buttons:!1};i=e.extend(!0,o,i);var r=this,n=this.editor,a=t.classPrefix,s=(new Date).getTime(),l=\"\"===i.name?a+\"dialog-\"+s:i.name,c=t.mouseOrTouch,h='<div class=\"'+a+\"dialog \"+l+'\">';\"\"!==i.title&&(h+='<div class=\"'+a+'dialog-header\"'+(i.drag?' style=\"cursor: move;\"':\"\")+\">\",h+='<strong class=\"'+a+'dialog-title\">'+i.title+\"</strong>\",h+=\"</div>\"),i.closed&&(h+='<a href=\"javascript:;\" class=\"fa fa-close '+a+'dialog-close\"></a>'),h+='<div class=\"'+a+'dialog-container\">'+i.content,(i.footer||\"string\"==typeof i.footer)&&(h+='<div class=\"'+a+'dialog-footer\">'+(\"boolean\"==typeof i.footer?\"\":i.footer)+\"</div>\"),h+=\"</div>\",h+='<div class=\"'+a+\"dialog-mask \"+a+'dialog-mask-bg\"></div>',h+='<div class=\"'+a+\"dialog-mask \"+a+'dialog-mask-con\"></div>',h+=\"</div>\",n.append(h);var d=n.find(\".\"+l);d.lockScreen=function(t){return i.lockScreen&&(e(\"html,body\").css(\"overflow\",t?\"hidden\":\"\"),r.resize()),d},d.showMask=function(){return i.mask&&n.find(\".\"+a+\"mask\").css(i.maskStyle).css(\"z-index\",t.dialogZindex-1).show(),d},d.hideMask=function(){return i.mask&&n.find(\".\"+a+\"mask\").hide(),d},d.loading=function(e){var t=d.find(\".\"+a+\"dialog-mask\");return t[e?\"show\":\"hide\"](),d},d.lockScreen(!0).showMask(),d.show().css({zIndex:t.dialogZindex,border:t.isIE8?\"1px solid #ddd\":\"\",width:\"number\"==typeof i.width?i.width+\"px\":i.width,height:\"number\"==typeof i.height?i.height+\"px\":i.height});var u=function(){d.css({top:(e(window).height()-d.height())/2+\"px\",left:(e(window).width()-d.width())/2+\"px\"})};if(u(),e(window).resize(u),d.children(\".\"+a+\"dialog-close\").bind(c(\"click\",\"touchend\"),function(){d.hide().lockScreen(!1).hideMask()}),\"object\"==typeof i.buttons){var f=d.footer=d.find(\".\"+a+\"dialog-footer\");for(var g in i.buttons){var p=i.buttons[g],m=a+g+\"-btn\";f.append('<button class=\"'+a+\"btn \"+m+'\">'+p[0]+\"</button>\"),p[1]=e.proxy(p[1],d),f.children(\".\"+m).bind(c(\"click\",\"touchend\"),p[1])}}if(\"\"!==i.title&&i.drag){var w,v,k=d.children(\".\"+a+\"dialog-header\");i.mask||k.bind(c(\"click\",\"touchend\"),function(){t.dialogZindex+=2,d.css(\"z-index\",t.dialogZindex)}),k.mousedown(function(e){e=e||window.event,w=e.clientX-parseInt(d[0].style.left),v=e.clientY-parseInt(d[0].style.top),document.onmousemove=y});var b=function(e){e.removeClass(a+\"user-unselect\").off(\"selectstart\")},x=function(e){e.addClass(a+\"user-unselect\").on(\"selectstart\",function(e){return!1})},y=function(t){t=t||window.event;var i,o,r=parseInt(d[0].style.left),n=parseInt(d[0].style.top);r>=0?r+d.width()<=e(window).width()?i=t.clientX-w:(i=e(window).width()-d.width(),document.onmousemove=null):(i=0,document.onmousemove=null),n>=0?o=t.clientY-v:(o=0,document.onmousemove=null),document.onselectstart=function(){return!1},x(e(\"body\")),x(d),d[0].style.left=i+\"px\",d[0].style.top=o+\"px\"};document.onmouseup=function(){b(e(\"body\")),b(d),document.onselectstart=null,document.onmousemove=null},k.touchDraggable=function(){var t=null,i=function(i){var o=i.originalEvent,r=e(this).parent().position();t={x:o.changedTouches[0].pageX-r.left,y:o.changedTouches[0].pageY-r.top}},o=function(i){i.preventDefault();var o=i.originalEvent;e(this).parent().css({top:o.changedTouches[0].pageY-t.y,left:o.changedTouches[0].pageX-t.x})};this.bind(\"touchstart\",i).bind(\"touchmove\",o)},k.touchDraggable()}return t.dialogZindex+=2,d},t.mouseOrTouch=function(e,t){e=e||\"click\",t=t||\"touchend\";var i=e;try{document.createEvent(\"TouchEvent\"),i=t}catch(o){}return i},t.dateFormat=function(e){e=e||\"\";var t=function(e){return 10>e?\"0\"+e:e},i=new Date,o=i.getFullYear(),r=o.toString().slice(2,4),n=t(i.getMonth()+1),a=t(i.getDate()),s=i.getDay(),l=t(i.getHours()),c=t(i.getMinutes()),h=t(i.getSeconds()),d=t(i.getMilliseconds()),u=\"\",f=r+\"-\"+n+\"-\"+a,g=o+\"-\"+n+\"-\"+a,p=l+\":\"+c+\":\"+h;switch(e){case\"UNIX Time\":u=i.getTime();break;case\"UTC\":u=i.toUTCString();break;case\"yy\":u=r;break;case\"year\":case\"yyyy\":u=o;break;case\"month\":case\"mm\":u=n;break;case\"cn-week-day\":case\"cn-wd\":var m=[\"日\",\"一\",\"二\",\"三\",\"四\",\"五\",\"六\"];u=\"星期\"+m[s];break;case\"week-day\":case\"wd\":var w=[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];u=w[s];break;case\"day\":case\"dd\":u=a;break;case\"hour\":case\"hh\":u=l;break;case\"min\":case\"ii\":u=c;break;case\"second\":case\"ss\":u=h;break;case\"ms\":u=d;break;case\"yy-mm-dd\":u=f;break;case\"yyyy-mm-dd\":u=g;break;case\"yyyy-mm-dd h:i:s ms\":case\"full + ms\":u=g+\" \"+p+\" \"+d;break;case\"full\":case\"yyyy-mm-dd h:i:s\":default:u=g+\" \"+p}return u},t}});"
        },
        {
          "name": "examples",
          "type": "tree",
          "content": null
        },
        {
          "name": "fonts",
          "type": "tree",
          "content": null
        },
        {
          "name": "images",
          "type": "tree",
          "content": null
        },
        {
          "name": "languages",
          "type": "tree",
          "content": null
        },
        {
          "name": "lib",
          "type": "tree",
          "content": null
        },
        {
          "name": "package.json",
          "type": "blob",
          "size": 0.9580078125,
          "content": "{\n  \"name\": \"editor.md\",\n  \"version\": \"1.5.0\",\n  \"description\": \"Open source online markdown editor.\",\n  \"directories\": {\n    \"doc\": \"docs\",\n    \"example\": \"examples\",\n    \"test\": \"tests\"\n  },\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/pandao/editor.md.git\"\n  },\n  \"keywords\": [\n    \"editor.md\",\n    \"markdown\",\n    \"editor\"\n  ],\n  \"author\": \"Pandao\",\n  \"license\": \"MIT\",\n  \"bugs\": {\n    \"url\": \"https://github.com/pandao/editor.md/issues\"\n  },\n  \"homepage\": \"https://github.com/pandao/editor.md\",\n  \"devDependencies\": {\n    \"dateformatter\": \"^0.1.0\",\n    \"gulp\": \"^3.8.11\",\n    \"gulp-concat\": \"^2.4.2\",\n    \"gulp-header\": \"^1.2.2\",\n    \"gulp-jshint\": \"^1.9.0\",\n    \"gulp-minify-css\": \"^0.4.4\",\n    \"gulp-notify\": \"^2.1.0\",\n    \"gulp-rename\": \"^1.2.0\",\n    \"gulp-replace\": \"^0.5.3\",\n    \"gulp-ruby-sass\": \"^1.0.1\",\n    \"gulp-uglifyjs\": \"^0.6.1\",\n    \"gulp-util\": \"^3.0.1\"\n  }\n}\n"
        },
        {
          "name": "plugins",
          "type": "tree",
          "content": null
        },
        {
          "name": "scss",
          "type": "tree",
          "content": null
        },
        {
          "name": "src",
          "type": "tree",
          "content": null
        },
        {
          "name": "tests",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}