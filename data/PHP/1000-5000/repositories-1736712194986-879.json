{
  "metadata": {
    "timestamp": 1736712194986,
    "page": 879,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjg4MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "amphp/http-server",
      "stars": 1297,
      "defaultBranch": "3.x",
      "files": [
        {
          "name": ".editorconfig",
          "type": "blob",
          "size": 0.1279296875,
          "content": "root = true\n\n[*]\nend_of_line = lf\ninsert_final_newline = true\ntrim_trailing_whitespace = true\nindent_style = space\ncharset = utf-8\n"
        },
        {
          "name": ".gitattributes",
          "type": "blob",
          "size": 0.419921875,
          "content": "docs export-ignore\nexamples export-ignore\ntest export-ignore\ntravis export-ignore\n.gitattributes export-ignore\n.gitignore export-ignore\n.travis.yml export-ignore\n.php_cs.dist export-ignore\n.gitmodules export-ignore\n.phpstorm.meta.php export-ignore\nphpunit.xml.dist export-ignore\nREADME.md export-ignore\nCONTRIBUTING.md export-ignore\nCHANGELOG.md export-ignore\n*                    text           eol=lf\n*.png                -text\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.1328125,
          "content": ".php_cs.cache\n.phpunit.result.cache\nbuild\ncoverage\ncomposer.lock\nphpunit.xml\ntest-autobahn/reports\nvendor\ncomposer-require-checker.phar\n"
        },
        {
          "name": ".gitmodules",
          "type": "blob",
          "size": 0.09375,
          "content": "[submodule \"docs/.shared\"]\n\tpath = docs/.shared\n\turl = https://github.com/amphp/amphp.github.io\n"
        },
        {
          "name": ".php-cs-fixer.dist.php",
          "type": "blob",
          "size": 0.2177734375,
          "content": "<?php\n\n$config = new Amp\\CodeStyle\\Config();\n$config->getFinder()\n    ->in(__DIR__ . '/examples')\n    ->in(__DIR__ . '/src')\n    ->in(__DIR__ . '/test');\n\n$config->setCacheFile(__DIR__ . '/.php_cs.cache');\n\nreturn $config;\n"
        },
        {
          "name": ".phpstorm.meta.php",
          "type": "blob",
          "size": 0.1572265625,
          "content": "<?php\n\nnamespace PHPSTORM_META {\n    $STATIC_METHOD_TYPES = [\n        \\PHPUnit\\Framework\\TestCase::createMock(\"\") => [\n            \"\" == \"@\",\n        ],\n    ];\n}"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.052734375,
          "content": "The MIT License (MIT)\n\nCopyright (c) 2015-2023 amphp\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 27.19140625,
          "content": "# amphp/http-server\n\nAMPHP is a collection of event-driven libraries for PHP designed with fibers and concurrency in mind.\nThis package provides a non-blocking, concurrent HTTP/1.1 and HTTP/2 application server for PHP based on [Revolt](https://revolt.run/).\nSeveral features are provided in separate packages, such as the [WebSocket component](https://github.com/amphp/websocket-server).\n\n## Features\n\n- [Static file serving](https://github.com/amphp/http-server-static-content)\n- [WebSockets](https://github.com/amphp/websocket-server)\n- [Dynamic app endpoint routing](https://github.com/amphp/http-server-router)\n- [Request body parser](https://github.com/amphp/http-server-form-parser)\n- [Sessions](https://github.com/amphp/http-server-session)\n- Full TLS support\n- Customizable GZIP compression\n- Supports HTTP/1.1 and HTTP/2\n- Middleware hooks\n- [CORS](https://github.com/labrador-kennel/http-cors) (3rd party)\n\n## Requirements\n\n- PHP 8.1+\n\n## Installation\n\nThis package can be installed as a [Composer](https://getcomposer.org/) dependency.\n\n```bash\ncomposer require amphp/http-server\n```\n\nAdditionally, you might want to install the `nghttp2` library to take advantage of FFI to speed up and reduce the memory usage.\n\n## Usage\n\nThis library provides access to your application through the HTTP protocol, accepting client requests and forwarding those requests to handlers defined by your application which will return a response.\n\nIncoming requests are represented by `Request` objects. A request is provided to an implementor of `RequestHandler`, which defines a `handleRequest()` method returning an instance of `Response`.\n\n```php\npublic function handleRequest(Request $request): Response\n```\n\nRequest handlers are covered in greater detail in the [`RequestHandler` section](#requesthandler).\n\nThis HTTP server is built on top of [the Revolt event-loop](https://revolt.run) and [the non-blocking concurrency framework Amp](https://amphp.org/amp).\nThus it inherits full support of all their primitives and it is possible to use all the non-blocking libraries built on top of Revolt.\n\n> **Note**\n> In general, you should make yourself familiar with [the `Future` **concept**](https://amphp.org/amp#future), with [coroutines](https://amphp.org/amp#coroutines), and be aware of the several [combinator](https://amphp.org/amp#combinators) functions to really succeed at using the HTTP server.\n\n### Blocking I/O\n\nNearly every built-in function of PHP is doing blocking I/O, that means, the executing thread (mostly equivalent to the process in the case of PHP) will effectively be halted until the response is received.\nA few examples of such functions: `mysqli_query`, `file_get_contents`, `usleep` and many more.\n\nA good rule of thumb is: Every built-in PHP function doing I/O is doing it in a blocking way, unless you know for sure it doesn't.\n\nThere are [libraries providing implementations that use non-blocking I/O](https://amphp.org/packages). You should use these instead of the built-in functions.\n\nWe cover the most common I/O needs, such as [network sockets](https://github.com/amphp/socket), [file access](https://github.com/amphp/file), [HTTP requests](https://github.com/amphp/http-client) and [websockets](http://github.com/amphp/websocket-client), [MySQL](https://github.com/amphp/mysql) and [Postgres](http://github.com/amphp/postgres) database clients, and [Redis](https://github.com/amphp/redis). If using blocking I/O or long computations are necessary to fulfill a request, consider using the [Parallel library](https://github.com/amphp/parallel) to run that code in a separate process or thread.\n\n> **Warning**\n> Do not use any blocking I/O functions in the HTTP server.\n\n```php\n// Here's a bad example, DO NOT do something like the following!\n\n$handler = new ClosureRequestHandler(function () {\n    sleep(5); // Equivalent to a blocking I/O function with a 5 second timeout\n\n    return new Response;\n});\n\n// Start a server with this handler and hit it twice.\n// You'll have to wait until the 5 seconds are over until the second request is handled.\n```\n\n### Creating an HTTP Server\n\nYour application will be served by an instance of `HttpServer`. This library provides `SocketHttpServer`, which will be suitable for most applications, built on components found in this library and in [`amphp/socket`](https://github.com/amphp/socket).\n\nTo create an instance of `SocketHttpServer` and listen for requests, minimally four things are required:\n\n* an instance of [`RequestHandler`](#requesthandler) to respond to incoming requests,\n* an instance of [`ErrorHander`](#errorhandler) to provide responses to invalid requests,\n* an instance of `Psr\\Log\\LoggerInterface`, and\n* at least one host+port on which to listen for connections.\n\n```php\n<?php\nuse Amp\\ByteStream;\nuse Amp\\Http\\HttpStatus;\nuse Amp\\Http\\Server\\DefaultErrorHandler;\nuse Amp\\Http\\Server\\Request;\nuse Amp\\Http\\Server\\RequestHandler;\nuse Amp\\Http\\Server\\Response;\nuse Amp\\Http\\Server\\SocketHttpServer;\nuse Amp\\Log\\ConsoleFormatter;\nuse Amp\\Log\\StreamHandler;\nuse Monolog\\Logger;\nuse Monolog\\Processor\\PsrLogMessageProcessor;\n\nrequire __DIR__.'/vendor/autoload.php';\n\n// Note any PSR-3 logger may be used, Monolog is only an example.\n$logHandler = new StreamHandler(ByteStream\\getStdout());\n$logHandler->pushProcessor(new PsrLogMessageProcessor());\n$logHandler->setFormatter(new ConsoleFormatter());\n\n$logger = new Logger('server');\n$logger->pushHandler($logHandler);\n\n$requestHandler = new class() implements RequestHandler {\n    public function handleRequest(Request $request) : Response\n    {\n        return new Response(\n            status: HttpStatus::OK,\n            headers: ['Content-Type' => 'text/plain'],\n            body: 'Hello, world!',\n        );\n    }\n};\n\n$errorHandler = new DefaultErrorHandler();\n\n$server = SocketHttpServer::createForDirectAccess($logger);\n$server->expose('127.0.0.1:1337');\n$server->start($requestHandler, $errorHandler);\n\n// Serve requests until SIGINT or SIGTERM is received by the process.\nAmp\\trapSignal([SIGINT, SIGTERM]);\n\n$server->stop();\n```\n\nThe above example creates a simple server which sends a plain-text response to every request received.\n\n`SocketHttpServer` provides two static constructors for common use-cases in addition to the normal constructor for more advanced and custom uses.\n\n- `SocketHttpServer::createForDirectAccess()`: Used in the example above, this creates an HTTP application server suitable for direct network access. Adjustable limits are imposed on connections per IP, total connections, and concurrent requests (10, 1000, and 1000 by default, respectively). Response compression may be toggled on or off (on by default) and request methods are limited to a known set of HTTP verbs by default.\n- `SocketHttpServer::createForBehindProxy()`: Creates a server appropriate for use when behind a proxy service such as nginx. This static constructor requires a list of trusted proxy IPs (with optional subnet masks) and an enum case of `ForwardedHeaderType` (corresponding to either `Forwarded` or `X-Forwarded-For`) to parse the original client IP from request headers. No limits are imposed on the number of connections to the server, however the number of concurrent requests are limited (1000 by default, adjustable or can be removed). Response compression may be toggled on or off (on by default). Request methods are limited to a known set of HTTP verbs by default.\n\nIf neither of these methods serve your application needs, the `SocketHttpServer` constructor may be used directly. This provides an enormous amount of flexibility in how incoming connections client connections are created and handled, but will require more code to create. The constructor requires the user to pass an instance of `SocketServerFactory`, used to create client `Socket` instances (both components of the [`amphp/socket`](https://github.com/amphp/socket) library), and an instance of `ClientFactory`, which appropriately creates [`Client`](#request-clients) instances which are attached to each `Request` made by the client.\n\n### `RequestHandler`\n\nIncoming requests are represented by `Request` objects. A request is provided to an implementor of `RequestHandler`, which defines a `handleRequest()` method returning an instance of `Response`.\n\n```php\npublic function handleRequest(Request $request): Response\n```\n\nEach client request (i.e., call to `RequestHandler::handleRequest()`) is executed within a separate [coroutine](https://amphp.org/architecture#coroutines) so requests are automatically handled cooperatively within the server process. When a request handler waits on [non-blocking I/O](#blocking-io), other client requests are processed in concurrent coroutines. Your request handler may itself create other coroutines using [`Amp\\async()`](https://amphp.org/amp#coroutines) to execute multiple tasks for a single request.\n\nUsually a `RequestHandler` directly generates a response, but it might also delegate to another `RequestHandler`.\nAn example for such a delegating `RequestHandler` is the [`Router`](https://github.com/amphp/http-server-router).\n\nThe `RequestHandler` interface is meant to be implemented by custom classes.\nFor very simple use cases or quick mocking, you can use `CallableRequestHandler`, which can wrap any `callable` and accepting a `Request` and returning a `Response`.\n\n### Middleware\n\nMiddleware allows pre-processing of requests and post-processing of responses.\nApart from that, a middleware can also intercept the request processing and return a response without delegating to the passed request handler.\nClasses have to implement the `Middleware` interface for that.\n\n> **Note**\n> Middleware generally follows other words like soft- and hardware with its plural.\n> However, we use the term _middlewares_ to refer to multiple objects implementing the `Middleware` interface.\n\n```php\npublic function handleRequest(Request $request, RequestHandler $next): Response\n```\n\n`handleRequest` is the only method of the `Middleware` interface. If the `Middleware` doesn't handle the request itself, it should delegate the response creation to the received `RequestHandler`.\n\n```php\nfunction stackMiddleware(RequestHandler $handler, Middleware ...$middleware): RequestHandler\n```\n\nMultiple middlewares can be stacked by using `Amp\\Http\\Server\\Middleware\\stackMiddleware()`, which accepts a `RequestHandler` as first argument and a variable number of `Middleware` instances. The returned `RequestHandler` will invoke each middleware in the provided order.\n\n```php\n$requestHandler = new class implements RequestHandler {\n    public function handleRequest(Request $request): Response\n    {\n        return new Response(\n            status: HttpStatus::OK,\n            headers: [\"content-type\" => \"text/plain; charset=utf-8\"],\n            body: \"Hello, World!\",\n        );\n    }\n}\n\n$middleware = new class implements Middleware {\n    public function handleRequest(Request $request, RequestHandler $next): Response\n    {\n        $requestTime = microtime(true);\n\n        $response = $next->handleRequest($request);\n        $response->setHeader(\"x-request-time\", microtime(true) - $requestTime);\n\n        return $response;\n    }\n};\n\n$stackedHandler = Middleware\\stackMiddleware($requestHandler, $middleware);\n$errorHandler = new DefaultErrorHandler();\n\n// $logger is a PSR-3 logger instance.\n$server = SocketHttpServer::createForDirectAccess($logger);\n$server->expose('127.0.0.1:1337');\n$server->start($stackedHandler, $errorHandler);\n```\n\n### `ErrorHandler`\n\nAn `ErrorHander` is used by the HTTP server when a malformed or otherwise invalid request is received. The `Request` object is provided if one constructed from the incoming data, but may not always be set.\n\n```php\npublic function handleError(\n    int $status,\n    ?string $reason = null,\n    ?Request $request = null,\n): Response\n```\n\nThis library provides `DefaultErrorHandler` which returns a stylized HTML page as the response body. You may wish to provide a different implementation for your application, potentially using multiple in conjunction with a [router](https://github.com/amphp/http-server-router).\n\n### `Request`\n\n#### Constructor\n\nIt is rare you will need to construct a `Request` object yourself, as they will typically be provided to `RequestHandler::handleRequest()` by the server.\n\n```php\n/**\n * @param string $method The HTTP method verb.\n * @param array<string>|array<string, array<string>> $headers An array of strings or an array of string arrays.\n */\npublic function __construct(\n    private readonly Client $client,\n    string $method,\n    Psr\\Http\\Message\\UriInterface $uri,\n    array $headers = [],\n    Amp\\ByteStream\\ReadableStream|string $body = '',\n    private string $protocol = '1.1',\n    ?Trailers $trailers = null,\n)\n```\n\n#### Methods\n\n```php\npublic function getClient(): Client\n```\n\nReturns the [`Сlient`](#request-clients) sending the request\n\n```php\npublic function getMethod(): string\n```\n\nReturns the HTTP method used to make this request, e.g. `\"GET\"`.\n\n```php\npublic function setMethod(string $method): void\n```\n\nSets the request HTTP method.\n\n```php\npublic function getUri(): Psr\\Http\\Message\\UriInterface\n```\n\nReturns the request [`URI`](https://www.php-fig.org/psr/psr-7/#35-psrhttpmessageuriinterface).\n\n```php\npublic function setUri(Psr\\Http\\Message\\UriInterface $uri): void\n```\n\nSets a new [`URI`](https://www.php-fig.org/psr/psr-7/#35-psrhttpmessageuriinterface) for the request.\n\n```php\npublic function getProtocolVersion(): string\n```\n\nReturns the HTTP protocol version as a string (e.g. \"1.0\", \"1.1\", \"2\").\n\n```php\npublic function setProtocolVersion(string $protocol)\n```\n\nSets a new protocol version number for the request.\n\n```php\n/** @return array<non-empty-string, list<string>> */\npublic function getHeaders(): array\n```\n\nReturns the headers as a string-indexed array of arrays of strings or an empty array if no headers have been set.\n\n```php\npublic function hasHeader(string $name): bool\n```\n\nChecks if given header exists.\n\n```php\n/** @return list<string> */\npublic function getHeaderArray(string $name): array\n```\n\nReturns the array of values for the given header or an empty array if the header does not exist.\n\n```php\npublic function getHeader(string $name): ?string\n```\n\nReturns the value of the given header.\nIf multiple headers are present for the named header, only the first header value will be returned.\nUse `getHeaderArray()` to return an array of all values for the particular header.\nReturns `null` if the header does not exist.\n\n```php\npublic function setHeaders(array $headers): void\n```\n\nSets the headers from the given array.\n\n```php\n/** @param array<string>|string $value */\npublic function setHeader(string $name, array|string $value): void\n```\n\nSets the header to the given value(s).\nAll previous header lines with the given name will be replaced.\n\n```php\n/** @param array<string>|string $value */\npublic function addHeader(string $name, array|string $value): void\n```\n\nAdds an additional header line with the given name.\n\n```php\npublic function removeHeader(string $name): void\n```\n\nRemoves the given header if it exists.\nIf multiple header lines with the same name exist, all of them are removed.\n\n```php\npublic function getBody(): RequestBody\n```\n\nReturns the request body. The [`RequestBody`](#body) allows streamed and buffered access to an [`InputStream`](https://amphp.org/byte-stream/).\n\n```php\npublic function setBody(ReadableStream|string $body)\n```\n\nSets the stream for the message body\n\n> **Note**\n> Using a string will automatically set the `Content-Length` header to the length of the given string.\n> Setting an [`ReadableStream`](https://amphp.org/byte-stream/#readablestream) will remove the `Content-Length` header.\n> If you know the exact content length of your stream, you can add a `content-length` header _after_ calling `setBody()`.\n\n```php\n/** @return array<non-empty-string, RequestCookie> */\npublic function getCookies(): array\n```\n\nReturns all [cookies](https://amphp.org/http/cookies) in associative map of cookie name to `RequestCookie`.\n\n```php\npublic function getCookie(string $name): ?RequestCookie\n```\n\nGets a [cookie](https://amphp.org/http/cookies) value by name or `null`.\n\n```php\npublic function setCookie(RequestCookie $cookie): void\n```\n\nAdds a [`Cookie`](https://amphp.org/http/cookies) to the request.\n\n```php\npublic function removeCookie(string $name): void\n```\n\nRemoves a cookie from the request.\n\n```php\npublic function getAttributes(): array\n```\n\nReturns an array of all the attributes stored in the request's mutable local storage.\n\n```php\npublic function removeAttributes(): array\n```\n\nRemoves all request attributes from the request's mutable local storage.\n\n```php\npublic function hasAttribute(string $name): bool\n```\n\nCheck whether an attribute with the given name exists in the request's mutable local storage.\n\n```php\npublic function getAttribute(string $name): mixed\n```\n\nRetrieve a variable from the request's mutable local storage.\n\n> **Note**\n> Name of the attribute should be namespaced with a vendor and package namespace, like classes.\n\n```php\npublic function setAttribute(string $name, mixed $value): void\n```\n\nAssign a variable to the request's mutable local storage.\n\n> **Note**\n> Name of the attribute should be namespaced with a vendor and package namespace, like classes.\n\n```php\npublic function removeAttribute(string $name): void\n```\n\nRemoves a variable from the request's mutable local storage.\n\n```php\npublic function getTrailers(): Trailers\n```\n\nAllows access to the [`Trailers`](#trailers) of a request.\n\n```php\npublic function setTrailers(Trailers $trailers): void\n```\n\nAssigns the [`Trailers`](#trailers) object to be used in the request.\n\n### Request Clients\n\nClient-related details are bundled into `Amp\\Http\\Server\\Driver\\Client` objects returned from `Request::getClient()`. The `Client` interface provides methods to retrieve the remote and local socket addresses and TLS info (if applicable).\n\n### `Response`\n\nThe **`Response`** class represents an HTTP response. A **`Response`** is returned by [request handlers](#requesthandler) and [middleware](#middleware).\n\n#### Constructor\n\n```php\n/**\n * @param int $code The HTTP response status code.\n * @param array<string>|array<string, array<string>> $headers An array of strings or an array of string arrays.\n */\npublic function __construct(\n    int $code = HttpStatus::OK,\n    array $headers = [],\n    Amp\\ByteStream\\ReadableStream|string $body = '',\n    ?Trailers $trailers = null,\n)\n```\n\n#### Destructor\n\nInvokes dispose handlers (i.e. functions that registered via `onDispose()` method).\n\n> **Note**\n> Uncaught exceptions from the dispose handlers will be forwarded to the [event loop](https://revolt.run) error handler.\n\n#### Methods\n\n```php\npublic function getBody(): Amp\\ByteStream\\ReadableStream\n```\n\nReturns the [stream](https://amphp.org/byte-stream/) for the message body.\n\n```php\npublic function setBody(Amp\\ByteStream\\ReadableStream|string $body)\n```\n\nSets the [stream](https://amphp.org/byte-stream/) for the message body.\n\n> **Note**\n> Using a string will automatically set the `Content-Length` header to the length of the given string.\n> Setting an [`ReadableStream`](https://amphp.org/byte-stream/#readablestream) will remove the `Content-Length` header.\n> If you know the exact content length of your stream, you can add a `content-length` header _after_ calling `setBody()`.\n\n```php\n/** @return array<non-empty-string, list<string>> */\npublic function getHeaders(): array\n```\n\nReturns the headers as a string-indexed array of arrays of strings or an empty array if no headers have been set.\n\n```php\npublic function hasHeader(string $name): bool\n```\n\nChecks if given header exists.\n\n```php\n/** @return list<string> */\npublic function getHeaderArray(string $name): array\n```\n\nReturns the array of values for the given header or an empty array if the header does not exist.\n\n```php\npublic function getHeader(string $name): ?string\n```\n\nReturns the value of the given header.\nIf multiple headers are present for the named header, only the first header value will be returned.\nUse `getHeaderArray()` to return an array of all values for the particular header.\nReturns `null` if the header does not exist.\n\n```php\npublic function setHeaders(array $headers): void\n```\n\nSets the headers from the given array.\n\n```php\n/** @param array<string>|string $value */\npublic function setHeader(string $name, array|string $value): void\n```\n\nSets the header to the given value(s).\nAll previous header lines with the given name will be replaced.\n\n```php\n/** @param array<string>|string $value */\npublic function addHeader(string $name, array|string $value): void\n```\n\nAdds an additional header line with the given name.\n\n```php\npublic function removeHeader(string $name): void\n```\n\nRemoves the given header if it exists.\nIf multiple header lines with the same name exist, all of them are removed.\n\n```php\npublic function getStatus(): int\n```\n\nReturns the response status code.\n\n```php\npublic function getReason(): string\n```\n\nReturns the reason phrase describing the status code.\n\n```php\npublic function setStatus(int $code, string | null $reason): void\n```\n\nSets the numeric HTTP status code (between 100 and 599) and reason phrase. Use null for the reason phrase to use the default phrase associated with the status code.\n\n```php\n/** @return array<non-empty-string, ResponseCookie> */\npublic function getCookies(): array\n```\n\nReturns all [cookies](https://amphp.org/http/cookies) in an associative map of cookie name to `ResponseCookie`.\n\n```php\npublic function getCookie(string $name): ?ResponseCookie\n```\n\nGets a [cookie](https://amphp.org/http/cookies) value by name or `null` if no cookie with that name is present.\n\n```php\npublic function setCookie(ResponseCookie $cookie): void\n```\n\nAdds a [cookie](https://amphp.org/http/cookies) to the response.\n\n```php\npublic function removeCookie(string $name): void\n```\n\nRemoves a [cookie](https://amphp.org/http/cookies) from the response.\n\n```php\n/** @return array<string, Push> Map of URL strings to Push objects. */\npublic function getPushes(): array\n```\n\nReturns list of push resources in an associative map of URL strings to `Push` objects.\n\n```php\n/** @param array<string>|array<string, array<string>> $headers */\npublic function push(string $url, array $headers): void\n```\n\nIndicate resources which a client likely needs to fetch. (e.g. `Link: preload` or HTTP/2 Server Push).\n\n```php\npublic function isUpgraded(): bool\n```\n\nReturns `true` if a detach callback has been set, `false` if none.\n\n```php\n/** @param Closure(Driver\\UpgradedSocket, Request, Response): void $upgrade */\npublic function upgrade(Closure $upgrade): void\n```\n\nSets a callback to be invoked once the response has been written to the client and changes the status of the response to `101 Switching Protocols`. The callback receives an instance of `Driver\\UpgradedSocket`, the `Request` which initiated the upgrade, and this `Response`.\n\nThe callback may be removed by changing the status to something other than 101.\n\n```php\npublic function getUpgradeCallable(): ?Closure\n```\n\nReturns the upgrade function if present.\n\n```php\n/** @param Closure():void $onDispose */\npublic function onDispose(Closure $onDispose): void\n```\n\nRegisters a function that is invoked when the Response is discarded. A response is discarded either once it has been written to the client or if it gets replaced in a middleware chain.\n\n```php\npublic function getTrailers(): Trailers\n```\n\nAllows access to the [`Trailers`](#trailers) of a response.\n\n```php\npublic function setTrailers(Trailers $trailers): void\n```\n\nAssigns the [`Trailers`](#trailers) object to be used in the response. Trailers are sent once the entire response body has been set to the client.\n\n### Body\n\n`RequestBody`, returned from `Request::getBody()`, provides buffered and streamed access to the request body.\nUse the streamed access to handle large messages, which is particularly important if you have larger message limits (like tens of megabytes) and don't want to buffer it all in memory.\nIf multiple people are uploading large bodies concurrently, the memory might quickly get exhausted.\n\nHence, incremental handling is important, accessible via [the `read()` API of `Amp\\ByteStream\\ReadableStream`](https://amphp.org/byte-stream#readablestream).\n\nIn case a client disconnects, the `read()` fails with an `Amp\\Http\\Server\\ClientException`.\nThis exception is thrown for both the `read()` and `buffer()` API.\n\n> **Note**\n> `ClientException`s do not *need* to be caught. You may catch them if you want to continue, but don't have to. The Server will silently end the request cycle and discard that exception then.\n\nInstead of setting the generic body limit high, you should consider increasing the body limit only where needed, which is dynamically possible with the `increaseSizeLimit()` method on `RequestBody`.\n\n> **Note**\n> `RequestBody` itself doesn't provide parsing of form data. You can use [`amphp/http-server-form-parser`](https://github.com/amphp/http-server-form-parser) if you need it.\n\n#### Constructor\n\nLike `Request`, it is rare to need to construct a `RequestBody` instance as one will be provided as part of the `Request`.\n\n```php\npublic function __construct(\n    ReadableStream|string $stream,\n    ?Closure $upgradeSize = null,\n)\n```\n\n#### Methods\n\n```php\npublic function increaseSizeLimit(int $limit): void\n```\n\nIncreases the body size limit dynamically to allow individual request handlers to handle larger request bodies than the default set for the HTTP server.\n\n### Trailers\n\nThe **`Trailers`** class allows access to the trailers of an HTTP request, accessible via `Request::getTrailers()`. `null` is returned if trailers are not expected on the request.\n`Trailers::await()` returns a `Future` which is resolved with an `HttpMessage` object providing methods to access the trailer headers.\n\n```php\n$trailers = $request->getTrailers();\n$message = $trailers?->await();\n```\n\n## Bottlenecks\n\nThe HTTP server won't be the bottleneck. Misconfiguration, use of blocking I/O, or inefficient applications are.\n\nThe server is well-optimized and can handle tens of thousands of requests per second on typical hardware while maintaining a high level of concurrency of thousands of clients.\n\nBut that performance will decrease drastically with inefficient applications.\nThe server has the nice advantage of classes and handlers being always loaded, so there's no time lost with compilation and initialization.\n\nA common trap is to begin operating on big data with simple string operations, requiring many inefficient big copies.\nInstead, streaming should be used where possible for larger request and response bodies.\n\nThe problem really is CPU cost.\nInefficient I/O management (as long as it is non-blocking!) is just delaying individual requests.\nIt is recommended to dispatch simultaneously and eventually bundle multiple independent I/O requests via Amp's combinators, but a slow handler will slow down every other request too.\nWhile one handler is computing, all the other handlers can't continue.\nThus it is imperative to reduce computation times of the handlers to a minimum.\n\n## Examples\n\nSeveral examples can be found in the [`./examples`](https://github.com/amphp/http-server/tree/3.x/examples) directory of the [repository](https://github.com/amphp/http-server).\nThese can be executed as normal PHP scripts on the command line.\n\n```bash\nphp examples/hello-world.php\n```\n\nYou can then access the example server at [`http://localhost:1337/`](http://localhost:1337/) in your browser.\n\n## Security\n\nIf you discover any security related issues, please use the private security issue reporter instead of using the public issue tracker.\n\n## License\n\nThe MIT License (MIT). Please see [LICENSE](./LICENSE) for more information.\n"
        },
        {
          "name": "composer-require-check.json",
          "type": "blob",
          "size": 0.3740234375,
          "content": "{\n    \"symbol-whitelist\": [\n      \"createClientId\",\n      \"DeflateContext\",\n      \"deflate_add\",\n      \"deflate_init\",\n      \"ZLIB_ENCODING_GZIP\",\n      \"ZLIB_ENCODING_RAW\",\n      \"ZLIB_FINISH\",\n      \"ZLIB_SYNC_FLUSH\"\n    ],\n    \"php-core-extensions\": [\n        \"Core\",\n        \"date\",\n        \"pcre\",\n        \"Phar\",\n        \"Reflection\",\n        \"SPL\",\n        \"standard\"\n    ]\n}\n"
        },
        {
          "name": "composer.json",
          "type": "blob",
          "size": 2.2568359375,
          "content": "{\n    \"name\": \"amphp/http-server\",\n    \"homepage\": \"https://github.com/amphp/http-server\",\n    \"description\": \"A non-blocking HTTP application server for PHP based on Amp.\",\n    \"keywords\": [\n        \"http\",\n        \"server\",\n        \"async\",\n        \"non-blocking\",\n        \"amp\",\n        \"amphp\"\n    ],\n    \"license\": \"MIT\",\n    \"authors\": [\n        {\n            \"name\": \"Daniel Lowrey\",\n            \"email\": \"rdlowrey@php.net\"\n        },\n        {\n            \"name\": \"Bob Weinand\"\n        },\n        {\n            \"name\": \"Niklas Keller\",\n            \"email\": \"me@kelunik.com\"\n        },\n        {\n            \"name\": \"Aaron Piotrowski\",\n            \"email\": \"aaron@trowski.com\"\n        }\n    ],\n    \"require\": {\n        \"php\": \">=8.1\",\n        \"amphp/amp\": \"^3\",\n        \"amphp/byte-stream\": \"^2\",\n        \"amphp/cache\": \"^2\",\n        \"amphp/hpack\": \"^3\",\n        \"amphp/http\": \"^2\",\n        \"amphp/pipeline\": \"^1\",\n        \"amphp/socket\": \"^2.1\",\n        \"amphp/sync\": \"^2.2\",\n        \"league/uri\": \"^7.1\",\n        \"league/uri-interfaces\": \"^7.1\",\n        \"psr/http-message\": \"^1 | ^2\",\n        \"psr/log\": \"^1 | ^2 | ^3\",\n        \"revolt/event-loop\": \"^1\"\n    },\n    \"require-dev\": {\n        \"amphp/phpunit-util\": \"^3\",\n        \"amphp/http-client\": \"^5\",\n        \"amphp/log\": \"^2\",\n        \"amphp/php-cs-fixer-config\": \"^2\",\n        \"league/uri-components\": \"^7.1\",\n        \"monolog/monolog\": \"^3\",\n        \"phpunit/phpunit\": \"^9\",\n        \"psalm/phar\": \"~5.23\"\n    },\n    \"minimum-stability\": \"dev\",\n    \"prefer-stable\": true,\n    \"suggest\": {\n        \"ext-zlib\": \"Allows GZip compression of response bodies\"\n    },\n    \"autoload\": {\n        \"psr-4\": {\n            \"Amp\\\\Http\\\\Server\\\\\": \"src\"\n        },\n        \"files\": [\n            \"src/Driver/functions.php\",\n            \"src/Middleware/functions.php\",\n            \"src/functions.php\"\n        ]\n    },\n    \"autoload-dev\": {\n        \"psr-4\": {\n            \"Amp\\\\Http\\\\Server\\\\Test\\\\\": \"test\"\n        },\n        \"files\": [\n            \"test/functions.php\"\n        ]\n    },\n    \"scripts\": {\n        \"test\": \"@php -dzend.assertions=1 -dassert.exception=1 ./vendor/bin/phpunit\",\n        \"code-style\": \"@php ./vendor/bin/php-cs-fixer fix\"\n    },\n    \"config\": {\n        \"allow-plugins\": {\n            \"ocramius/package-versions\": false\n        }\n    }\n}\n"
        },
        {
          "name": "examples",
          "type": "tree",
          "content": null
        },
        {
          "name": "infection.json.dist",
          "type": "blob",
          "size": 0.158203125,
          "content": "{\n    \"timeout\": 10,\n    \"source\": {\n        \"directories\": [\n            \"src\"\n        ]\n    },\n    \"logs\": {\n        \"text\": \"build\\/infection-log.txt\"\n    }\n}\n"
        },
        {
          "name": "phpunit.xml.dist",
          "type": "blob",
          "size": 0.921875,
          "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<phpunit xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:noNamespaceSchemaLocation=\"https://schema.phpunit.de/9.3/phpunit.xsd\"\n         backupGlobals=\"false\"\n         backupStaticAttributes=\"false\"\n         bootstrap=\"vendor/autoload.php\"\n         colors=\"true\"\n         convertErrorsToExceptions=\"true\"\n         convertNoticesToExceptions=\"true\"\n         convertWarningsToExceptions=\"true\"\n         processIsolation=\"false\"\n         stopOnFailure=\"false\"\n>\n  <coverage includeUncoveredFiles=\"true\">\n    <include>\n      <directory>./src</directory>\n    </include>\n  </coverage>\n  <php>\n    <!-- Needed because @dataProvider uses iterator_to_array() -->\n    <ini name=\"memory_limit\" value=\"1G\"/>\n    <ini name=\"error_reporting\" value=\"-1\"/>\n  </php>\n  <testsuites>\n    <testsuite name=\"Amp HTTP Server Test\">\n      <directory>test</directory>\n    </testsuite>\n  </testsuites>\n</phpunit>\n"
        },
        {
          "name": "psalm.xml",
          "type": "blob",
          "size": 1.2060546875,
          "content": "<?xml version=\"1.0\"?>\n<psalm\n        errorLevel=\"2\"\n        phpVersion=\"8.1\"\n        resolveFromConfigFile=\"true\"\n        xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n        xmlns=\"https://getpsalm.org/schema/config\"\n        xsi:schemaLocation=\"https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd\"\n>\n    <projectFiles>\n        <directory name=\"examples\"/>\n        <directory name=\"src\" />\n        <file name=\"test/test-server.php\"/>\n        <ignoreFiles>\n            <directory name=\"vendor\"/>\n        </ignoreFiles>\n    </projectFiles>\n\n    <issueHandlers>\n        <MissingClosureReturnType>\n            <errorLevel type=\"suppress\">\n                <directory name=\"src\" />\n            </errorLevel>\n        </MissingClosureReturnType>\n\n        <PropertyNotSetInConstructor>\n            <errorLevel type=\"suppress\">\n                <file name=\"src/Driver/Http1Driver.php\"/>\n                <file name=\"src/Driver/Http2Driver.php\"/>\n            </errorLevel>\n        </PropertyNotSetInConstructor>\n\n        <RiskyTruthyFalsyComparison>\n            <errorLevel type=\"suppress\">\n                <directory name=\"src\" />\n            </errorLevel>\n        </RiskyTruthyFalsyComparison>\n    </issueHandlers>\n</psalm>\n"
        },
        {
          "name": "resources",
          "type": "tree",
          "content": null
        },
        {
          "name": "src",
          "type": "tree",
          "content": null
        },
        {
          "name": "test",
          "type": "tree",
          "content": null
        },
        {
          "name": "tools",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}