{
  "metadata": {
    "timestamp": 1736712023152,
    "page": 537,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjU0MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "MoeNetwork/Tieba-Cloud-Sign",
      "stars": 1842,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.076171875,
          "content": ".idea/\nsetup/install.lock\n!plugins/wmzz_debug\n.DS_Store\n.devcontainer\n.vscode\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 4.9111328125,
          "content": "# 百度贴吧云签到\r\n在服务器上配置好就无需进行任何操作便可以实现贴吧的全自动签到。     \r\n配合插件使用还可实现云灌水、点赞、封禁、删帖、审查等功能。     \r\n获取插件，教程，扩展，资料等请前往Wiki [GitHub](https://github.com/MoeNetwork/Tieba-Cloud-Sign/wiki)     \r\n\r\n**注意**：Gitee (原Git@osc) 仓库将不再维护，目前唯一指定的仓库为 Github。本项目**没有官方交流群**，如需交流可以直接使用Github的Discussions。**没有商业版本**，目前贴吧云签到由社区共同维护，**不会停止更新**（PR 通常在一天内处理）。\r\n\r\n\r\n## 使用Docker-Compose快速部署\r\n##### 1.安装Docker\r\n[安装docker](http://get.daocloud.io/#install-docker)，[安装docker-compose](https://hub.docker.com/r/gists/docker-compose-bin)\r\n##### 2.下载`docker-compose.yml`并启动服务\r\n下载 `wget https://raw.githubusercontent.com/MoeNetwork/Tieba-Cloud-Sign/master/docker/docker-compose.yml`\r\n如下载不下来，就直接访问 [这个链接](https://github.com/MoeNetwork/Tieba-Cloud-Sign/blob/master/docker/docker-compose.yml)，参考它修改为你自己的`docker-compose.yml`\r\n开始部署 `docker-compose up -d` 参数`-d`为后台运行。(主要时间消耗在下载，启动不用啥时间)\r\n这里已经包含了`MySQL`部署\r\n##### 3.进入网页配置\r\n启动完之后，直接访问`http://<ip>:8080`，本机就访问`http://127.0.0.1:8080`  \r\n在配置数据库连接的时候，选择`自动导入`即可,不用自己输入。  \r\n然后就配置好了。\r\n##### 4.注意事项\r\n如果你使用Windows，请先去`docker-compose.yml`修改mysql的持久化路径，默认当前目录下的`mysql`文件夹。  \r\n或者直接去掉`volumes`也行。  \r\n映射出来的端口，可以修改`docker-compose.yml`的`8080:8080`。默认`8080`  \r\n`CSRF的设置`在`docker-compose.yml`的`CSRF=true`,默认`true`  \r\n除去docker安装，整个安装流程不超两分钟(网速快)。\r\n\r\n## 常见问题解决方案\r\n往往大部分人安装出错第一反应都是：“没错啊，哪里错了，一定是程序错了”\r\n##### 1.如何安装程序\r\n上传此程序到您的网站，然后访问您的网站\r\n##### 2.如何开启 MySQL 连接方式强制功能\r\n如果数据库配置正确，但连接数据库失败（错误代码 20XX），可使用此方法     \r\n打开   mysql_autoload.php     \r\n找到   define('SQLMODE', 'mysqli');     \r\n替换为 define('SQLMODE', 'mysql');\r\n##### 3.如何开启数据库长连接\r\n打开   mysql_autoload.php     \r\n找到   define('LONGSQL', false);     \r\n替换为 define('LONGSQL', true);\r\n##### 4.如何手动修改数据库配置\r\n打开 config.php 并按照里面的注释修改     \r\n切勿使用记事本编辑，否则程序将不能工作\r\n##### 5.如何手动导入数据库\r\n打开 /setup/install.template.sql 并按照里面的注释修改\r\n##### 6.如何安装新版本\r\n（1）自动更新：前往 检查更新 更新程序即可     \r\n（2）手动更新：直接下载 Zip，删除压缩包内的 config.php ，然后上传到您的网站即可     \r\n另外，每一个大版本都会有一个升级脚本，别忘了运行它    \r\n（文件名一般为 update旧版本to新版本.php ，例如 update1.0to2.0.php）      \r\n\r\n## 参与开发\r\n\r\n贴吧云签到是一个开放的开源项目，任何人均可参与开发，Pull Request即可提交您修改的代码     \r\nPull Request和Issue请提交到 Github 代码库，在其他代码库提交可能不会被处理。所有 PR 通常在一天内答复。     \r\n\r\n### 开发者列表\r\n[@Kenvix](https://kenvix.com) [i@kenvix.com]     \r\n[@BANKA2017](https://blog.nest.moe)       \r\n[@n0099](https://n0099.net/)\r\n\r\n<details>\r\n  <summary>点击展开更多开发者和贡献者</summary>\r\n\r\n#### 早期版本开发者\r\n@mokeyjay [i@mokeyjay.com]     \r\n@fyy99 [fyod@qq.com]\r\n\r\n#### 热心贡献者\r\n以下几位反馈/解决了程序的不足之处，特此感谢     \r\n@Ver4 [i@v4.hk]     \r\n@kirainmoe [kotori@wo.cn]     \r\n@VFleaKing [liuhaotian0520@163.com]     \r\n@superxzr [a457418121@gmail.com]         \r\n\r\n[更多贡献者](https://github.com/MoeNetwork/Tieba-Cloud-Sign/graphs/contributors)\r\n</details>\r\n\r\n### 耻辱柱\r\n\r\n<details>\r\n  <summary>这里列出的是 **一小部分** 违反协议者的名单</summary>\r\n\r\n##### 1.@shirakun -- 发布去版权版本\r\n[https://github.com/shirakun/Tieba-Cloud-Sign](https://github.com/shirakun/Tieba-Cloud-Sign)\r\n##### 2.\"CCGV\" -- 去版权、辱骂作者\r\n[http://ccgv.me/](http://ccgv.me/)  [http://ccgv.party/](http://ccgv.party/)\r\n##### 3.多星宇 -- 发布修改版权的版本\r\n[http://www.asp300.com/SoftView/11/SoftView_57242.html](http://www.asp300.com/SoftView/11/SoftView_57242.html)\r\n##### 4.贴吧:国王zhang -- 去版权+辱骂作者+经提醒之后死性不改和删除提醒\r\n[http://52king.cn/tieba](http://52king.cn/tieba)\r\n[http://tieba.baidu.com/p/4822692349](http://tieba.baidu.com/p/4822692349)\r\n\r\n</details>"
        },
        {
          "name": "ajax.php",
          "type": "blob",
          "size": 14.787109375,
          "content": "<?php\nrequire dirname(__FILE__) . '/init.php';\n\nswitch (SYSTEM_PAGE) {\n    case 'ajax:status':\n        global $m,$i;\n        $today = date('d');\n        $count = array(\n            'userSigned'  => 0,\n            'userWaiting' => 0,\n            'userError'   => 0,\n            'allSigned'   => 0,\n            'allWaiting'  => 0,\n            'allNo'       => 0,\n            'allError'    => 0\n        );\n        $signUser = $m->query(\"SELECT `latest`,`status` FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . TABLE . \"` WHERE `uid` = \" . UID . \" AND `no` = '0'\");\n        while ($countUser = $m->fetch_array($signUser)) {\n            if ($countUser['latest'] == $today) {\n                if ($countUser['status'] != '0') {\n                    $count['userError']++;\n                } else {\n                    $count['userSigned']++;\n                }\n            } else {\n                $count['userWaiting']++;\n            }\n        }\n        echo \"<br/><b>签到状态：</b>已签到 {$count['userSigned']} 个贴吧，{$count['userError']} 个出错， {$count['userWaiting']} 个贴吧等待签到\";\n        echo '<br/><b>您的签到数据表：</b>' . DB_PREFIX . TABLE;\n\n        if (ROLE == 'admin') {\n            foreach ($i['table'] as $value) {\n                $signTab = $m->query(\"SELECT `latest`,`status`,`no` FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . $value . \"`\");\n                while ($countTab = $m->fetch_array($signTab)) {\n                    if ($countTab['no'] != '0') {\n                        $count['allNo']++;\n                    } elseif ($countTab['latest'] == $today) {\n                        if ($countTab['status'] != '0') {\n                            $count['allError']++;\n                        } else {\n                            $count['allSigned']++;\n                        }\n                    } else {\n                        $count['allWaiting']++;\n                    }\n                }\n            }\n            echo \"<br/><b>签到状态[总体]：</b>已签到 {$count['allSigned']} 个贴吧，还有 {$count['allWaiting']} 个贴吧等待签到\";\n            echo \"<br/><b>贴吧状态[总体]：</b>有 {$count['allError']} 个贴吧签到出错，{$count['allNo']} 个贴吧已被设定为忽略\";\n            echo '<br/><b>用户注册/添加用户首选表：</b>' . DB_PREFIX . option::get('freetable');\n        }\n        break;\n\n    case 'admin:server':\n        ?>\n        <li class=\"list-group-item\">\n            <b>PHP 版本：</b><?php echo PHP_VERSION ?>\n            <?php if (ini_get('safe_mode')) {\n                echo '线程安全';\n            } else {\n                echo '非线程安全';\n            } ?>\n        </li>\n        <li class=\"list-group-item\">\n            <b>MySQL 版本：</b><?php echo $m->getMysqlVersion() ?>\n        </li>\n        <?php if (!empty($_SERVER['SERVER_ADDR'])) { ?>\n        <li class=\"list-group-item\">\n            <b>服务器地址：</b><?php echo $_SERVER['SERVER_ADDR'] ?>\n        </li>\n        <?php } ?>\n        <li class=\"list-group-item\">\n            <b>服务器软件：</b><?php echo $_SERVER['SERVER_SOFTWARE'] ?>\n        </li>\n        <li class=\"list-group-item\">\n            <b>服务器系统：</b><?php echo php_uname('a') ?>\n        </li>\n        <li class=\"list-group-item\">\n            <b>程序最大运行时间：</b><?php echo ini_get('max_execution_time') ?>s\n        </li>\n        <li class=\"list-group-item\">\n            <b>POST许可：</b><?php echo ini_get('post_max_size'); ?>\n        </li>\n        <li class=\"list-group-item\">\n            <b>文件上传许可：</b><?php echo ini_get('upload_max_filesize'); ?>\n        </li>\n        <?php\n        break;\n\n    case 'admin:update':\n        $c = new wcurl('https://api.github.com/repos/moenetwork/tieba-cloud-sign/commits?per_page=1', ['User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36']);\n        $data = json_decode($c->exec(), true);\n        if (!isset($data[0][\"sha\"])) {\n            die('<div class=\"alert alert-danger\"><b>检查更新失败：无法获取最新版本信息。</b></div>');\n        }\n        $c = new wcurl('https://api.github.com/repos/moenetwork/tieba-cloud-sign/commits/' . $data[0][\"sha\"], ['User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36']);\n        $data = json_decode($c->exec(), true);\n        if (empty($data)) {\n            die('<div class=\"alert alert-danger\"><b>检查更新失败：无法获取最新版本信息。</b></div>');\n        } else {\n            $tip = \"\";\n            if (isset($_GET['ok'])) {\n                $tip .= '<b>更新成功，下面是最新版本信息。</b><hr/>';\n            }\n            $tip .= '<div class=\"text-right\"> <div class=\"label label-primary\">commit</div> <a href=\"https://github.com/MoeNetwork/Tieba-Cloud-Sign/commit/' . $data[\"sha\"] . '\" target=\"_blank\" class=\"label label-info\">' . substr($data[\"sha\"], 0, 7) . '</a> <div class=\"label label-warning\"><span class=\"glyphicon glyphicon-time\" aria-hidden=\"true\"></span> ' . $data[\"commit\"][\"committer\"][\"date\"] . '</div> <div class=\"label label-' . ($data[\"commit\"][\"verification\"][\"verified\"] ? 'success' : 'warning') . '\">' . ($data[\"commit\"][\"verification\"][\"verified\"] ? 'Verified' : 'Not verified') . '</div></div><br /><div>' . nl2br($data[\"commit\"][\"message\"]) . '</div>';\n            //check update scripts\n            foreach ($data[\"files\"] as $file_info) {\n                if ($file_info[\"status\"] === \"added\" && strpos($file_info[\"filename\"], 'setup/update') !== false) {\n                    $tip .= '<hr>本提交包含一个升级脚本，更新后请及时执行 <b>' . $file_info[\"filename\"] . '</b>';\n                }\n            }\n            echo '<div class=\"panel panel-default\" style=\"background-color: #F9F9F9;\"><div class=\"panel-body\">' . $tip . '<hr/><div class=\"text-right\"><a href=\"ajax.php?mod=admin:update:updnow\" class=\"btn btn-primary\" type=\"button\" onclick=\"waitup();\">立即更新</a></div></div></div>';\n        }\n        $c->close();\n        break;\n\n    case 'admin:update:updnow':\n        if (!file_exists(UPDATE_CACHE)) {\n            mkdir(UPDATE_CACHE, 0777, true);\n        }\n        $commit_mode = isset($_GET[\"commit\"]) && $_GET[\"commit\"];\n        //下载zip包\n        //switch (option::get('update_server')){\n        //  //OSCGIT禁止了直接下载\n        //  //CODING仓库都没了\n        //  default:\n        if ($commit_mode) {\n            $c = new wcurl(\"https://github.com/MoeNetwork/Tieba-Cloud-Sign/archive/{$_GET[\"commit\"]}.zip\");\n        } else {\n            $c = new wcurl(UPDATE_SERVER_GITHUB);\n        }\n        $floderName = $commit_mode ? 'Tieba-Cloud-Sign-' . $_GET[\"commit\"] : UPDATE_FNAME_GITHUB;\n        //      break;\n        //}\n        $file = $c->exec();\n        $c->close();\n        $zipPath = UPDATE_CACHE . 'update_' . time() . '.zip';\n        if (file_put_contents($zipPath, $file) === false) {\n            DeleteFile(UPDATE_CACHE);\n            msg('错误 - 更新失败：<br/><br/>无法从更新服务器下载更新包');\n        }\n\n\n        //解压缩\n        $z = new zip();\n        $z->open($zipPath);\n        $z->extract(UPDATE_CACHE);\n        $z->close();\n\n        //检查更新文件\n        $floderName = UPDATE_CACHE . $floderName;\n        if (!is_dir($floderName)) {\n            DeleteFile(UPDATE_CACHE);\n            msg('错误 - 更新失败：<br/><br/>无法解压缩更新包');\n        }\n        //删除配置文件\n        if (file_exists($floderName . '/config.php')) {\n            unlink($floderName . '/config.php');\n        }\n        if (file_exists($floderName . '/app.conf')) {\n            unlink($floderName . '/app.conf');\n        }\n        if (file_exists($floderName . '/config.yaml')) {\n            unlink($floderName . '/config.yaml');\n        }\n        //覆盖文件\n        if (CopyAll($floderName, SYSTEM_ROOT) !== true) {\n            DeleteFile(UPDATE_CACHE);\n            msg('错误 - 更新失败：<br/><br/>无法更新文件');\n        }\n        DeleteFile(UPDATE_CACHE);\n        ////获取最新的版本号\n        //$c = new wcurl('http://kenvix.oschina.io/tieba-cloud-sign/');\n        //$data = json_decode($c->exec(),true);\n        //$c->close();\n        ////修改版本号\n        //option::set('vid',$data['vid']);\n        //暂不支持更新脚本\n        msg('恭喜您，更新成功！', SYSTEM_URL . 'index.php?mod=admin:update&ok');\n        break;\n\n    case 'admin:update:changeServer':\n        if (isset($_GET['server'])) {\n            option::set('update_server', $_GET['server']);\n        }\n        break;\n\n    case 'baiduid:getverify':\n        global $m;\n        if (option::get('bduss_num') == '-1' && ROLE != 'admin') {\n            msg('本站禁止绑定新账号');\n        }\n        if (option::get('bduss_num') != '0' && ISVIP == false) {\n            $count = $m->once_fetch_array(\"SELECT COUNT(*) AS `c` FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE `uid` = \" . UID);\n            if (($count['c'] + 1) > option::get('bduss_num')) {\n                msg('您当前绑定的账号数已达到管理员设置的上限<br/><br/>您当前已绑定 ' . $count['c'] . ' 个账号，最多只能绑定 ' . option::get('bduss_num') . ' 个账号');\n            }\n        }\n        $name  = !empty($_POST['bd_name']) ? $_POST['bd_name'] :\n        die();\n        $pw    = !empty($_POST['bd_pw'])   ? $_POST['bd_pw']   : die();\n        $vcode = !empty($_POST['vcode'])   ? $_POST['vcode']   : '';\n        $vcodestr = !empty($_POST['vcodestr']) ? $_POST['vcodestr'] : '';\n        $loginResult = misc::loginBaidu($name, $pw, $vcode, $vcodestr);\n    if ($loginResult[0] == -3) {\n        echo '{\"error\":\"-3\",\"msg\":\"请输入验证码\",\"vcodestr\":\"' . $loginResult[1] . '\",\"img\":\"' . $loginResult[2] . '\"}';\n        /*\n            echo '<img onclick=\"addbdid_getcode();\" src=\"'.$loginResult[2].'\"style=\"float:left;\">&nbsp;&nbsp;&nbsp;请在下面输入左图中的字符<br>&nbsp;&nbsp;&nbsp;点击图片更换验证码';\n            echo '<br/><br/><div class=\"input-group\"><span class=\"input-group-addon\">验证码</span>';\n            echo '<input type=\"text\" class=\"form-control\" id=\"bd_v\" name=\"bd_v\" placeholder=\"请输入上图的字符\" required></div><br/>';\n            echo '<input type=\"hidden\" id=\"vcodeStr\" name=\"vcodestr\" value=\"'.$loginResult[1].'\"/>';\n        */\n    } elseif ($loginResult[0] == 0) {\n        if ((option::get('same_pid') == '1' || option::get('same_pid') == '2') && !ISADMIN) {\n            $checkSame = $m->once_fetch_array(\"SELECT * FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE `name` = '{$loginResult[2]}'\");\n            if (!empty($checkSame)) {\n                if (option::get('same_pid') == '2') {\n                    echo '{\"error\":\"-11\",\"msg\":\"你已经绑定了这个百度账号或者该账号已被其他人绑定，若要重新绑定，请先解绑\"}';\n                } elseif (option::get('same_pid') == '1' && $checkSame['uid'] == UID) {\n                    echo '{\"error\":\"-10\",\"msg\":\"你已经绑定了这个百度账号，若要重新绑定，请先解绑\"}';\n                }\n                die;\n            }\n        }\n        $m->query(\"INSERT INTO `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` (`uid`,`bduss`,`name`) VALUES  (\" . UID . \", '{$loginResult[1]}', '{$loginResult[2]}')\");\n        echo '{\"error\":\"0\",\"msg\":\"获取BDUSS成功\",\"bduss\":\"' . $loginResult[1] . '\",\"name\":\"' . $loginResult[2] . '\"}';\n    } else {\n        echo '{\"error\":\"' . $loginResult[0] . '\",\"msg\":\"' . $loginResult[1] . '\"}';\n    }\n        break;\n    case \"baiduid:qrlogin\":\n        global $m;\n        if (option::get('bduss_num') == '-1' && ROLE != 'admin') {\n            msg('本站禁止绑定新账号');\n        }\n        if (option::get('bduss_num') != '0' && ISVIP == false) {\n            $count = $m->once_fetch_array(\"SELECT COUNT(*) AS `c` FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE `uid` = \" . UID);\n            if (($count['c'] + 1) > option::get('bduss_num')) {\n                msg('您当前绑定的账号数已达到管理员设置的上限<br/><br/>您当前已绑定 ' . $count['c'] . ' 个账号，最多只能绑定 ' . option::get('bduss_num') . ' 个账号');\n            }\n        }\n        $sign = !empty($_POST['sign']) ? $_POST['sign'] :\n        die();\n        $loginResult = misc::get_real_bduss($sign);\n    if ($loginResult[\"error\"] == 0) {\n        $baiduUserInfo = getBaiduUserInfo($loginResult[\"bduss\"]);\n        if (!empty($baiduUserInfo[\"portrait\"])) {\n            $baidu_name = $baiduUserInfo[\"name\"];\n            $baidu_name_portrait = sqladds($baiduUserInfo[\"portrait\"]);\n            $checkSame = $m->once_fetch_array(\"SELECT * FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE `portrait` = '{$baidu_name_portrait}'\");\n            if (option::get('same_pid') != '3' && (option::get('same_pid') == '1' || option::get('same_pid') == '2') && !ISADMIN) {\n                if (!empty($checkSame)) {\n                    if (option::get('same_pid') == '2') {\n                        $loginResult[\"error\"] = -11;\n                        $loginResult[\"msg\"] = \"你已经绑定了这个百度账号或者该账号已被其他人绑定，若要重新绑定，请先解绑\";\n                    } elseif (option::get('same_pid') == '1' && $checkSame['uid'] == UID) {\n                        $loginResult[\"error\"] = -10;\n                        $loginResult[\"msg\"] = \"你已经绑定了这个百度账号，若要重新绑定，请先解绑\";\n                    }\n                    $loginResult[\"bduss\"] = \"\";\n                } else {\n                    $m->query(\"INSERT INTO `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` (`id`,`uid`,`bduss`,`stoken`,`name`,`portrait`) VALUES  (NULL,'\" . UID . \"', '{$loginResult[\"bduss\"]}', '{$loginResult[\"stoken\"]}', '{$baidu_name}', '{$baidu_name_portrait}')\");\n                    $loginResult[\"msg\"] = \"获取BDUSS成功\";\n                    $loginResult[\"name\"] = \"{$baidu_name} [{$baidu_name_portrait}]\";\n                }\n            } else {\n                if (option::get('same_pid') == '3' && !empty($checkSame)) {\n                    $m->query(\"UPDATE `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` SET `bduss`='{$loginResult[\"bduss\"]}', `stoken`='{$loginResult[\"stoken\"]}' WHERE `id` = '{$checkSame[\"id\"]}';\");\n                    $loginResult[\"msg\"] = \"更新BDUSS成功\";\n                } else {\n                    $m->query(\"INSERT INTO `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` (`id`,`uid`,`bduss`,`stoken`,`name`,`portrait`) VALUES  (NULL,'\" . UID . \"', '{$loginResult[\"bduss\"]}', '{$loginResult[\"stoken\"]}', '{$baidu_name}', '{$baidu_name_portrait}')\");\n                    $loginResult[\"msg\"] = \"获取BDUSS成功\";\n                }\n                $loginResult[\"name\"] = \"{$baidu_name} [{$baidu_name_portrait}]\";\n            }\n        }\n    }\n        echo json_encode($loginResult, JSON_UNESCAPED_UNICODE);\n\n        break;\n    default:\n        msg('未定义操作');\n        break;\n}\n?>\n"
        },
        {
          "name": "config.php",
          "type": "blob",
          "size": 0.9599609375,
          "content": "<?php\n\n//特别警告：禁止使用记事本编辑！\n\n////////////////////////////以下选项只需在使用MySQL时填写////////////////////////////\n//MySQL 数据库地址，普通主机一般为localhost\ndefine('DB_HOST', '127.0.0.1');\n//MySQL 数据库用户名\ndefine('DB_USER', 'root');\n//MySQL 数据库密码\ndefine('DB_PASSWD', '');\n//MySQL 数据库名称\ndefine('DB_NAME', 'tiebacloud');\n//MySQL 启用SSL连接，如需启用请将值改为1\ndefine('DB_SSL', 0);\n\n////////////////////////////以下选项使用任何数据库都需填写////////////////////////////\n//数据库前缀，建议保持默认\ndefine('DB_PREFIX', 'tc_');\n\n///////////////////////////////////////其他设置///////////////////////////////////////\n//停用CSRF防御\n//说明在 https://github.com/MoeNetwork/Tieba-Cloud-Sign/wiki/%E5%85%B3%E4%BA%8E%E4%BA%91%E7%AD%BE%E5%88%B0CSRF%E9%98%B2%E5%BE%A1\ndefine('ANTI_CSRF', true);\n\n//加密用盐，留空为不使用\ndefine('SYSTEM_SALT', '');\n"
        },
        {
          "name": "do.php",
          "type": "blob",
          "size": 2.123046875,
          "content": "<?php\n\ndefine('SYSTEM_DO_NOT_LOGIN', true);\nrequire dirname(__FILE__) . '/init.php';\nglobal $m,$today,$i;\nignore_user_abort(true);\nset_time_limit(0);\n$cron_pw = option::get('cron_pw');\n$cmd_pw = function_exists('getopt') ? getopt('', array('pw::')) : false;\nif (!empty($cron_pw)) {\n    if ((empty($_REQUEST['pw']) || $_REQUEST['pw'] != $cron_pw) && (empty($cmd_pw) || $cmd_pw['pw'] != $cron_pw)) {\n        msg('计划任务执行失败：密码错误<br/><br/>你需要通过访问 <b>do.php?pw=密码</b> 才能执行计划任务<br/>例如：' . SYSTEM_URL . 'do.php?pw=yourpassword<br/><br/>若您要通过命令行执行计划任务，请加上参数 <b>--pw=密码</b><br/>例如：php do.php --pw=yourpassword<br/>命令行模式注意：你需要指明do.php的绝对路径，或者将do.php加入PATH', false);\n    }\n}\nif (isset($_GET['in_thread'])) {\n    define('SYSTEM_CRON_THREAD', true);\n}\ndoAction('cron_1');\nif (SYSTEM_PAGE == 'runcron') {\n    $cron = isset($_GET['cron']) ? sqladds(strip_tags($_GET['cron'])) : msg('运行失败：计划任务未指定');\n    $cpw  = option::get('cron_pw');\n\n    $x    = $m->once_fetch_array(\"SELECT * FROM `\" . DB_PREFIX . \"cron` WHERE `name` = '{$cron}';\");\n    if (empty($x['id'])) {\n        msg('运行失败：此计划任务不存在');\n    }\n\n    $log = cron::run($x['file'], $x['name']);\n\n    if ($x['freq'] == '-1') {\n        cron::del($x['name']);\n    } else {\n        cron::aset(\n            $x['name'],\n            array(\n                'lastdo' => time(),\n                'log'    => $log\n            )\n        );\n    }\n} else {\n    $sign_multith = option::get('sign_multith');\n    if (!isset($_GET['donnot_sign_multith']) && !empty($sign_multith) && function_exists('fsockopen')) {\n        for ($ii = 0; $ii < $sign_multith; $ii++) {\n            sendRequest(SYSTEM_URL . 'do.php?donnot_sign_multith&in_thread&pw=' . $cron_pw);\n        }\n    }\n        $return = '';\n    if (option::get('cron_last_do_time') != $today) {\n        option::set('cron_last_do_time', $today);\n        option::set('cron_last_do', '0');\n    }\n        cron::runall();\n}\ndoAction('cron_2');\nmsg('本次计划任务完成', false, false);\n"
        },
        {
          "name": "docker",
          "type": "tree",
          "content": null
        },
        {
          "name": "favicon.ico",
          "type": "blob",
          "size": 14.732421875,
          "content": null
        },
        {
          "name": "index.php",
          "type": "blob",
          "size": 3.3134765625,
          "content": "<?php\n\n/**\n * 贴吧云签到\n * Copyright (c) 2012~2022 Tieba-Cloud-Sign team and its contributors\n *\n * 获取开发文档：https://github.com/MoeNetwork/Tieba-Cloud-Sign/wikis/\n */\n\nrequire dirname(__FILE__) . '/init.php';\nglobal $i;\n\nif (!isset($_GET['plugin']) && !isset($_GET['pub_plugin']) && !isset($_GET['vip_plugin']) && !isset($_GET['pri_plugin']) && $i['mode'][0] != 'view') {\n    template('control');\n    loadfoot();\n} elseif ($i['mode'][0] == 'view') {\n    if (in_array($i['mode'][1], $i['plugins']['actived']) && file_exists(SYSTEM_ROOT . '/plugins/' . $i['mode'][1] . '/' . 'view_' . $i['mode'][2] . '.php')) {\n        $plug = getPluginInfo($i['mode'][1]);\n        if (in_array($i['mode'][2], $plug['page'])) {\n            include SYSTEM_ROOT . '/plugins/' . $i['mode'][1] . '/' . 'view_' . $i['mode'][2] . '.php';\n        } else {\n            msg('无效的插件自定义页面，请在 插件名_desc.php 中的page键添加此页面');\n        }\n    } else {\n        ReDirect('index.php');\n    }\n} elseif (isset($_GET['plugin'])) {\n    $plug = strip_tags($_GET['plugin']);\n    if (in_array($plug, $i['plugins']['actived'])) {\n        if (file_exists(SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_show.php') && !is_dir(SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_show.php')) {\n            require_once SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_show.php';\n        } else {\n            msg('插件前台显示模块不存在或不正确');\n        }\n    }\n} elseif (isset($_GET['vip_plugin'])) {\n    $plug = strip_tags($_GET['vip_plugin']);\n    if (in_array($plug, $i['plugins']['actived'])) {\n        if (file_exists(SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_vip.php') && !is_dir(SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_vip.php')) {\n            if (ISVIP) {\n                require_once SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_vip.php';\n            } else {\n                msg('权限不足');\n            }\n        } else {\n            msg('插件前台显示模块不存在或不正确');\n        }\n    }\n} elseif (isset($_GET['pri_plugin'])) {\n    $plug = strip_tags($_GET['pri_plugin']);\n    if (in_array($plug, $i['plugins']['actived'])) {\n        if (file_exists(SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_private.php') && !is_dir(SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_private.php')) {\n            if (ROLE == 'admin') {\n                require_once SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_private.php';\n            } else {\n                msg('权限不足');\n            }\n            require_once SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_private.php';\n        } else {\n            msg('插件前台显示模块不存在或不正确');\n        }\n    }\n} elseif (defined('SYSTEM_READY_LOAD_PUBPLUGIN')) {\n    $i['user']['role'] = 'visitor';\n    $plug = strip_tags($_GET['pub_plugin']);\n    if (in_array($plug, $i['plugins']['actived'])) {\n        if (file_exists(SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_public.php') && !is_dir(SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_public.php')) {\n            require_once SYSTEM_ROOT . '/plugins/' . $plug . '/' . $plug . '_public.php';\n        } else {\n            msg('插件前台显示模块不存在或不正确');\n        }\n    } else {\n        ReDirect('index.php?mod=login');\n    }\n    die;\n}\n"
        },
        {
          "name": "init.php",
          "type": "blob",
          "size": 3.3876953125,
          "content": "<?php\n\n/**\n * 贴吧云签到\n * 获取开发文档：https://github.com/MoeNetwork/Tieba-Cloud-Sign/wiki\n */\n\ndefine('SYSTEM_FN', '百度贴吧云签到');\ndefine('SYSTEM_VER', '5.02');\ndefine('SYSTEM_VER_NOTE', '');\ndefine('SYSTEM_ROOT', dirname(__FILE__));\ndefine('PLUGIN_ROOT', dirname(__FILE__) . '/plugins/');\ndefine('SYSTEM_ISCONSOLE', PHP_SAPI === 'cli' or defined('STDIN'));\ndefine('SYSTEM_PAGE', isset($_REQUEST['mod']) ? strip_tags($_REQUEST['mod']) : 'default');\ndefine('SUPPORT_URL', 'https://github.com/MoeNetwork/Tieba-Cloud-Sign/wiki');\nif (defined('SYSTEM_NO_ERROR')) {\n    error_reporting(0);\n}\n\nif (SYSTEM_ISCONSOLE) {\n    function console_htmltag_delete($v)\n    {\n        $v = str_ireplace(array('</td>','</th>'), ' | ', $v);\n        $v = str_ireplace(array('<br/>','</p>','</tr>','</thead>','</tbody>'), PHP_EOL, $v);\n        $v = str_ireplace(array('&nbsp;'), ' ', $v);\n        return SYSTEM_FN . ' Ver.' . SYSTEM_VER . ' ' . SYSTEM_VER_NOTE . ' - 控制台模式' . PHP_EOL . '==========================================================' . PHP_EOL . strip_tags($v);\n    }\n    ob_start('console_htmltag_delete');\n}\nrequire SYSTEM_ROOT . '/lib/msg.php';\n\n//如需停止站点运行，请解除注释，即删除开头的 //\n//msg('站点已关闭！请稍后再试，如有疑问请联系站长解决！');\n\nif (!file_exists(SYSTEM_ROOT . '/setup/install.lock') && file_exists(SYSTEM_ROOT . '/setup/install.php')) {\n    if (empty(getenv('TC_AUTO_CREATE_INSTALL_LOCK')) || file_put_contents(SYSTEM_ROOT . '/setup/install.lock', \"auto created install.lock file\") === false) {\n        msg('<h2>检测到无 install.lock 文件</h2><ul><li><font size=\"4\">如果您尚未安装本程序，请<a href=\"./setup/install.php\">前往安装</a></font></li><li><font size=\"4\">如果您已经安装本程序，请手动放置一个空的 install.lock 文件到 /setup 文件夹下，<b>为了您站点安全，在您完成它之前我们不会工作。</b></font></li></ul><br/><h4>为什么必须建立 install.lock 文件？</h4>它是云签到的保护文件，如果云签到检测不到它，就会认为站点还没安装，此时任何人都可以安装/重装云签到。<br/><br/>', false, true, false);\n    }\n}\n\nheader(\"content-type:text/html; charset=utf-8\");\ndate_default_timezone_set('Asia/Shanghai');\nif (file_exists(SYSTEM_ROOT . '/key.php')) {\n    include SYSTEM_ROOT . '/key.php';\n}\nrequire SYSTEM_ROOT . '/lib/class.E.php';\nrequire SYSTEM_ROOT . '/lib/class.P.php';\nrequire SYSTEM_ROOT . '/config.php';\nrequire SYSTEM_ROOT . '/lib/mysql_autoload.php';\nrequire SYSTEM_ROOT . '/lib/class.former.php';\nrequire SYSTEM_ROOT . '/lib/class.smtp.php';\nrequire SYSTEM_ROOT . '/lib/class.zip.php';\nrequire SYSTEM_ROOT . '/lib/reg.php';\ndefine('SYSTEM_URL', option::get('system_url'));\ndefine('SYSTEM_NAME', option::get('system_name'));\n//版本修订号\ndefine('SYSTEM_REV', option::get('core_revision'));\n//压缩包链接\ndefine('UPDATE_SERVER_GITHUB', 'https://github.com/MoeNetwork/Tieba-Cloud-Sign/archive/master.zip');\n//压缩包内文件夹名\ndefine('UPDATE_FNAME_GITHUB', 'Tieba-Cloud-Sign-master');\n//压缩包解压路径\ndefine('UPDATE_CACHE', SYSTEM_ROOT . '/setup/update_cache/');\nrequire SYSTEM_ROOT . '/lib/sfc.functions.php';\nrequire SYSTEM_ROOT . '/lib/ui.php';\nif (!defined('SYSTEM_NO_PLUGIN')) {\n    require SYSTEM_ROOT . '/lib/plugins.php';\n}\nif (!defined('SYSTEM_NO_CHECK_LOGIN')) {\n    require SYSTEM_ROOT . '/lib/globals.php';\n}\n"
        },
        {
          "name": "lib",
          "type": "tree",
          "content": null
        },
        {
          "name": "license.html",
          "type": "blob",
          "size": 30.1162109375,
          "content": "<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta http-equiv=Content-Type  content=\"text/html; charset=utf-8\" ><title>贴吧云签到《最终用户使用许可协议书》 V2.0</title><style>\n@font-face{\nfont-family:\"Times New Roman\";\n}\n\n@font-face{\nfont-family:\"宋体\";\n}\n\n@font-face{\nfont-family:\"Wingdings\";\n}\n\n@font-face{\nfont-family:\"Calibri\";\n}\n\n@font-face{\nfont-family:\"微软雅黑\";\n}\n\n@list l0:level1{\nmso-level-start-at:4;\nmso-level-number-format:chinese-counting;\nmso-level-suffix:none;\nmso-level-text:\"%1、\";\nmso-level-tab-stop:0.0000pt;\nmso-level-number-position:left;\nmargin-bottom:0pt; margin-top:0pt; margin-left:0.0000pt;\ntext-indent:0.0000pt;\nfont-family:'Times New Roman'; }\n\n@list l0:level2{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%2.\";\nmso-level-tab-stop:72.0000pt;\nmso-level-number-position:left;\nmargin-left:72.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l0:level3{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%3.\";\nmso-level-tab-stop:108.0000pt;\nmso-level-number-position:left;\nmargin-left:108.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l0:level4{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%4.\";\nmso-level-tab-stop:144.0000pt;\nmso-level-number-position:left;\nmargin-left:144.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l0:level5{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%5.\";\nmso-level-tab-stop:180.0000pt;\nmso-level-number-position:left;\nmargin-left:180.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l0:level6{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%6.\";\nmso-level-tab-stop:216.0000pt;\nmso-level-number-position:left;\nmargin-left:216.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l0:level7{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%7.\";\nmso-level-tab-stop:252.0000pt;\nmso-level-number-position:left;\nmargin-left:252.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l0:level8{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%8.\";\nmso-level-tab-stop:288.0000pt;\nmso-level-number-position:left;\nmargin-left:288.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l0:level9{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%9.\";\nmso-level-tab-stop:324.0000pt;\nmso-level-number-position:left;\nmargin-left:324.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l1:level1{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%1.\";\nmso-level-tab-stop:39.0000pt;\nmso-level-number-position:left;\nmargin-left:39.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l2:level1{\nmso-level-number-format:bullet;\nmso-level-suffix:tab;\nmso-level-text:\\F06C;\nmso-level-tab-stop:81.0000pt;\nmso-level-number-position:left;\nmargin-left:81.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Wingdings'; }\n\n@list l3:level1{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%1.\";\nmso-level-tab-stop:18.0000pt;\nmso-level-number-position:left;\nmargin-left:18.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l4:level1{\nmso-level-number-format:bullet;\nmso-level-suffix:tab;\nmso-level-text:\\F06C;\nmso-level-tab-stop:18.0000pt;\nmso-level-number-position:left;\nmargin-left:18.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Wingdings'; }\n\n@list l5:level1{\nmso-level-number-format:bullet;\nmso-level-suffix:tab;\nmso-level-text:\\F06C;\nmso-level-tab-stop:60.0000pt;\nmso-level-number-position:left;\nmargin-left:60.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Wingdings'; }\n\n@list l6:level1{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%1.\";\nmso-level-tab-stop:60.0000pt;\nmso-level-number-position:left;\nmargin-left:60.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l7:level1{\nmso-level-number-format:bullet;\nmso-level-suffix:tab;\nmso-level-text:\\F06C;\nmso-level-tab-stop:39.0000pt;\nmso-level-number-position:left;\nmargin-left:39.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Wingdings'; }\n\n@list l8:level1{\nmso-level-number-format:bullet;\nmso-level-suffix:tab;\nmso-level-text:\\F06C;\nmso-level-tab-stop:102.0000pt;\nmso-level-number-position:left;\nmargin-left:102.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Wingdings'; }\n\n@list l9:level1{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%1.\";\nmso-level-tab-stop:81.0000pt;\nmso-level-number-position:left;\nmargin-left:81.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\n@list l10:level1{\nmso-level-number-format:decimal;\nmso-level-suffix:tab;\nmso-level-text:\"%1.\";\nmso-level-tab-stop:102.0000pt;\nmso-level-number-position:left;\nmargin-left:102.0000pt; text-indent:-18.0000pt; margin-bottom:0pt; margin-top:0pt; font-family:'Times New Roman'; }\n\np.p0{\nmargin:0pt;\nmargin-bottom:0.0001pt;\nmargin-bottom:0pt;\nmargin-top:0pt;\ntext-align:justify;\nfont-size:10.5000pt; font-family:'Times New Roman'; }\n\nspan.10{\nfont-family:'Times New Roman'; }\n\nspan.15{\ncolor:rgb(0,0,255); text-decoration:underline ;font-family:'Times New Roman'; }\n\np.p16{\nmargin-bottom:0pt;\nmargin-top:0pt;\ntext-align:justify;\nfont-weight:normal; font-style:normal; font-size:10.5000pt; font-family:'Calibri'; }\n@page{mso-page-border-surround-header:no;\n\tmso-page-border-surround-footer:no;}@page Section0{\nmargin-top:72.0000pt;\nmargin-bottom:72.0000pt;\nmargin-left:90.0000pt;\nmargin-right:90.0000pt;\nsize:595.3000pt 841.9000pt;\nlayout-grid:15.6000pt;\n}\ndiv.Section0{page:Section0;}</style></head><body style=\"tab-interval:21pt; text-justify-trim:punctuation; \" ><!--StartFragment--><div class=\"Section0\"  style=\"layout-grid:15.6000pt; \" ><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:center; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:14.0000pt; font-family:'微软雅黑'; \" >贴吧云签到《最终用户使用许可协议书》&nbsp;V2.0</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:14.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:bold; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >【首部及导言】</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:bold; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;架设或</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >使用</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >贴吧云签到项目（包括此程序本身及相关所有文档，以下简称&#8220;云签&#8221;）及其衍生品（包括在云签基础上二次创作的项目及依赖云签程序运行的插件等）</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >，您应当阅读并遵守</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >贴吧云签到</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >《</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >最终用户使用许可协议书</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >》（以下简称&#8220;协议&#8221;）</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;。</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >请您务必审慎阅读、充分理解各条款内容，</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >协议中的重点内容可能以加粗或加下划线的形式提示您重点注意。</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >除非您已阅读并接受本协议所有条款，否则您无权</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >架设或使用云签</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >您架设或使用云签</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >即视为您已阅读并同意本协议的约束。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:bold; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >一、【协议的范围】</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:bold; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >本协议是云签用户与</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >StusGame&nbsp;GROUP</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >之间关于用户</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >架设或</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >使用云签</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >及其衍生品</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >所订立的协议。&#8220;</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >StusGame&nbsp;GROUP</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >&#8221;（亦作&#8220;SGP&#8221;）主要指</span><span><a href=\"https://github.com/MoeNetwork/Tieba-Cloud-Sign\" ><span class=\"15\"  style=\"mso-spacerun:'yes'; color:rgb(0,0,255); letter-spacing:0.0000pt; font-weight:normal; text-transform:none; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >https://github.com/MoeNetwork/Tieba-Cloud-Sign</span></a></span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >网站及其运营和管理人员。&#8220;用户&#8221;是指架设或使用云签</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >及其衍生品</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >的架设者、使用人，以下也成为&#8220;您&#8221;。</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >二、【许可使用】</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1&nbsp;通过任何途径下载的云签程序，在不违反本协议的前提下可自行架设、使用。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2&nbsp;其它参考云签及其衍生品的源代码的程序，</span><span style=\"mso-spacerun:'yes'; font-weight:normal; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >须征得至少两位云签开发者同意后</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >，在标示原有版权信息的情况下发行、架设、使用。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >三、【禁止使用】</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1&nbsp;</span><span style=\"mso-spacerun:'yes'; font-weight:bold; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >不得以任何理由、任何手段（包括但不限于删减、遮挡、修改字号、添加nofollow属性等）修改</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:bold; text-transform:none; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >云签</span><span style=\"mso-spacerun:'yes'; font-weight:bold; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >及其衍生品原有的版权信息、版权链接的指向及友情链接，并保证原有版权能够在显眼处展示。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2&nbsp;禁止以任何形式向他人兜售云签的复制品或延伸产品。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3&nbsp;禁止使用云签以任何强制收费形式盈利，捐赠、挂广告等非强制收费形式除外。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; mso-list:l0 level1 lfo1; \" ><![if !supportLists]><span style=\"font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'Times New Roman'; \" ><span style='mso-list:Ignore; ' >四、</span></span><![endif]><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >【许可终止】</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.1&nbsp;无论何时，如果您主动放弃或被收回了许可，您必须立即销毁云签的所有复制品、衍生品，并关闭任何由云签搭建的服务。</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.2&nbsp;如您违反了本协议的任何一项条款和条件，则视为一切许可被收回。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.3&nbsp;</span><span style=\"mso-spacerun:'yes'; font-weight:bold; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >爱用不用，不用就滚</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >，一旦您滚蛋，则视为一切许可被收回。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >五、【权利保留】</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=\"mso-spacerun:'yes'; font-weight:normal; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >未明确声明的一切其它权利均为SGP所保留，对本协议的一切解释权归SGP所有。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >六、【责任限度】</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在适用法律所允许的最大范围内，SGP在任何情况下绝不就因使用或不能使用云签或就未提供支持服务所发生的任何特殊、意外、非直接或间接的损害负赔偿责任，即使事先被告知该损害发生的可能性。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >七、【协议的生效与变更】</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.1&nbsp;</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >SGP有权在必要时修改本协议条款。您可以在相关页面查阅最新版本的协议条款。</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" ><br></span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.2&nbsp;</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >本协议条款变更后，如果您继续</span><span style=\"mso-spacerun:'yes'; font-weight:normal; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >架设或</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >使用云签</span><span style=\"mso-spacerun:'yes'; font-weight:normal; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >及其衍生品</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; text-decoration:underline ;font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >，即视为您已接受修改后的协议。</span><span style=\"mso-spacerun:'yes'; letter-spacing:0.0000pt; font-weight:normal; text-transform:none; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑';  mso-shading:rgb(255,255,255); \" >如果您不接受修改后的协议，那么视为您放弃一切许可（参见4.1）</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >八、【适用和管辖法律】</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;《中华人民共和国著作权法》、《中华人民共和国计算机软件保护条例》、《中华人民共和国商标法》、《中华人民共和国专利法》等中华人民共和国法律。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;【结语】</span><span style=\"mso-spacerun:'yes'; font-weight:bold; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本协议和上述有限保证及责任限制受中华人民共和国法律管辖。</span><br/><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此外，在安装过程中，我们将会收集一些信息以便于统计安装量及改进体验。我们绝不会收集您的隐私信息，也不会向任何人泄露这些信息。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;至此，您肯定已经详细阅读并已理解本协议，并同意严格遵守全部条款和条件。</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:right; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >StusGame&nbsp;GROUP</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p16  style=\"margin-bottom:0pt; margin-top:0pt; text-align:left; \" ><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" >&nbsp;</span><span style=\"mso-spacerun:'yes'; font-weight:normal; font-style:normal; font-size:9.0000pt; font-family:'微软雅黑'; \" ><o:p></o:p></span></p><p class=p0  style=\"margin-bottom:0pt; margin-top:0pt; \" ><span style=\"mso-spacerun:'yes'; font-size:10.5000pt; font-family:'Times New Roman'; \" ><o:p>&nbsp;</o:p></span></p></div><!--EndFragment--></body></html>"
        },
        {
          "name": "plugins",
          "type": "tree",
          "content": null
        },
        {
          "name": "robots.txt",
          "type": "blob",
          "size": 0.23046875,
          "content": "User-agent: *\nDisallow: /setting.php\nDisallow: /ajax.php\nDisallow: /config.php\nDisallow: /do.php\nDisallow: /init.php\nDisallow: /license.html\nDisallow: /README.md\nDisallow: /lib/\nDisallow: /setup/\nDisallow: /source/\nDisallow: /templates/"
        },
        {
          "name": "setting.php",
          "type": "blob",
          "size": 151.9599609375,
          "content": "<?php\n\n/**\n * 设置保存页面\n */\n\nrequire dirname(__FILE__) . '/init.php';\ncsrf();\nif (ROLE != 'user' && ROLE != 'admin' && ROLE != 'vip') {\n    msg('权限不足');\n}\n\nif (ROLE != 'admin' && stristr(strip_tags($_GET['mod']), 'admin:')) {\n    msg('权限不足');\n}\n\nglobal $i;\nglobal $m;\nswitch (SYSTEM_PAGE) {\n    case 'admin:plugins':\n                                                                                                                                                                                                                                                                          doAction('plugin_setting_1');\n        if (isset($_GET['dis'])) {\n            inactivePlugin($_GET['dis']);\n        } elseif (isset($_GET['act'])) {\n            activePlugin($_GET['act']);\n        } elseif (isset($_GET['upd'])) {\n            if (updatePlugin($_GET['upd']) == false) {\n                Redirect('index.php?mod=admin:plugins&error_msg=' . urlencode(\"插件更新失败\"));\n            }\n        } elseif (isset($_GET['uninst'])) {\n            uninstallPlugin($_GET['uninst']);\n        } elseif (isset($_GET['clean'])) {\n            uninstallPlugin($_GET['clean'], false);\n        } elseif (isset($_GET['install'])) {\n            if (!empty($_REQUEST['ver'])) {\n                msg('该插件仅适用于 V' . $_REQUEST['ver'] . ' 及以上的版本，您的云签到版本低于插件所需最低版本，是否强制安装（强制安装可能造成云签到损坏）<br/><br/><a href=\"setting.php?mod=admin:plugins&install=' . $_GET['install'] . '\">强制安装</a>　　<a href=\"setting.php?mod=admin:plugins\">取消安装</a><br/>', false, true);\n            }\n            installPlugin($_GET['install']);\n        } elseif (isset($_GET['xorder'])) {\n            global $m;\n            foreach ($_POST as $id => $order) {\n                $m->query('Update `' . DB_NAME . '`.`' . DB_PREFIX . \"plugins` Set `order`={$order} Where `name`='{$id}'\");\n            }\n        }\n        doAction('plugin_setting_2');\n        Redirect('index.php?mod=admin:plugins&ok');\n\n        break;\n    case 'admin:cloud':\n                                                                                                                                                                                                                                                                          doAction('plugin_update_1');\n        global $i;\n        $plug = $i['plugins']['desc'][$_GET['upd']];\n        if (!file_exists(UPDATE_CACHE)) {\n            mkdir(UPDATE_CACHE, 0777, true);\n        }\n\n        $up_url = SUPPORT_URL . 'getplug.php?m=up&pname=' . $_GET['upd'] . '&user=' . option::get('bbs_us') . '&pw=' . option::get('bbs_pw');\n        $c = new wcurl($up_url);\n        $file = $c->exec();\n        $c->close();\n        if ($file == 'WRONG') {\n            msg('错误 - 更新失败：<br/><br/>产品中心拒绝了下载<br/>请检查全局设置中的账号是否正确以及是否购买过此插件');\n        }\n\n        $zipPath = UPDATE_CACHE . 'update_plug_' . time() . '.zip';\n        if (file_put_contents($zipPath, $file) === false) {\n            DeleteFile(UPDATE_CACHE);\n            msg('错误 - 更新失败：<br/><br/>无法下载更新包');\n        }\n\n        //解压缩\n        $z = new zip();\n        $z->open($zipPath);\n        $z->extract(UPDATE_CACHE);\n        $z->close();\n    //检查更新文件\n        $floderName = UPDATE_CACHE . $_GET['upd'];\n        if (!is_dir($floderName)) {\n            DeleteFile(UPDATE_CACHE);\n            msg('错误 - 更新失败：<br/><br/>无法解压缩更新包');\n        }\n\n        //覆盖文件\n        if (CopyAll($floderName, SYSTEM_ROOT . '/plugins/' . $_GET['upd']) !== true) {\n            DeleteFile(UPDATE_CACHE);\n            msg('错误 - 更新失败：<br/><br/>无法更新文件');\n        }\n        DeleteFile(UPDATE_CACHE);\n        doAction('plugin_update_2');\n        msg('（1/2）已成功下载最新版本的 ' . $plug['plugin']['name'] . ' 插件。请单击下一步，以完成更新<br/><br/><a href=\"setting.php?mod=admin:plugins&upd=' . $_GET['upd'] . '\">>> 下一步</a>', false);\n\n        break;\n    case 'admin:set':\n                                                                                                                                                                                                                                                                          global $m;\n        $sou = $_POST;\n        if ($_GET['type'] == 'sign') {\n            @option::set('cron_limit', $sou['cron_limit']);\n            @option::set('tb_max', $sou['tb_max']);\n            @option::set('bduss_num', $sou['bduss_num']);\n            @option::set('sign_mode', serialize($sou['sign_mode']));\n            @option::set('enable_addtieba', $sou['enable_addtieba']);\n            @option::set('retry_max', $sou['retry_max']);\n            @option::set('sign_hour', $sou['sign_hour']);\n            @option::set('fb', $sou['fb']);\n            @option::set('sign_sleep', $sou['sign_sleep']);\n            @option::set('sign_scan', $sou['sign_scan']);\n            @option::set('same_pid', $sou['same_pid']);\n            if (empty($sou['fb_tables'])) {\n                @option::set('fb_tables', null);\n            } else {\n                $fb_tables = explode(\"\\n\", $sou['fb_tables']);\n                $fb_tab = array();\n                $n = 0;\n                foreach ($fb_tables as $value) {\n                    $n++;\n                    $value = strtolower($value);\n                    $sql = str_ireplace('{VAR-DB}', DB_NAME, str_ireplace('{VAR-TABLE}', trim(DB_PREFIX . $value), file_get_contents(SYSTEM_ROOT . '/setup/template.table.sql')));\n                    $m->query($sql);\n                    $fb_tab[$n] .= trim($value);\n                }\n                @option::set('fb_tables', serialize($fb_tab));\n            }\n        } else {\n            @option::set('system_url', $sou['system_url']);\n            @option::set('system_name', $sou['system_name']);\n            @option::set('system_keywords', $sou['system_keywords']);\n            @option::set('system_description', $sou['system_description']);\n            @option::set('footer', $sou['footer']);\n            @option::set('ann', $sou['ann']);\n            @option::set('enable_reg', $sou['enable_reg']);\n            isset($sou['captcha']) and @option::set('captcha', $sou['captcha']);\n            @option::set('yr_reg', $sou['yr_reg']);\n            @option::set('stop_reg', $sou['stop_reg']);\n            @option::set('icp', $sou['icp']);\n            @option::set('bbs_us', $sou['bbs_us']);\n            @option::set('bbs_pw', $sou['bbs_pw']);\n            @option::set('mail_mode', $sou['mail_mode']);\n            @option::set('mail_name', $sou['mail_name']);\n            @option::set('mail_yourname', $sou['mail_yourname']);\n            @option::set('mail_host', $sou['mail_host']);\n            @option::set('mail_port', $sou['mail_port']);\n            @option::set('mail_auth', $sou['mail_auth']);\n            @option::set('mail_secure', $sou['mail_secure']);\n            @option::set('mail_smtpname', $sou['mail_smtpname']);\n            isset($sou['mail_smtppw']) and @option::set('mail_smtppw', $sou['mail_smtppw']);\n            @option::set('dev', $sou['dev']);\n            @option::set('cron_pw', $sou['cron_pw']);\n            isset($sou['cron_asyn']) and @option::set('cron_asyn', $sou['cron_asyn']);\n            @option::set('sign_multith', $sou['sign_multith']);\n            @option::set('cktime', $sou['cktime']);\n        }\n        doAction('admin_set_save');\n        Redirect('index.php?mod=admin:set:' . $_GET['type'] . '&ok');\n\n        break;\n    case 'admin:tools':\n        /*\n         $toolpw = option::get('toolpw');\n           if(!empty($_POST['toolpw'])){\n          $cookies = md5(md5(md5($_POST['toolpw'])));\n            if(empty($toolpw)){\n                option::add('toolpw',$cookies);\n                setcookie('toolpw',$cookies);\n              Redirect('index.php?mod=admin:tools&ok');\n          } else {\n               setcookie('toolpw',$cookies);\n              Redirect('index.php?mod=admin:tools');\n         }\n          }\n          if($_COOKIE['toolpw'] != $toolpw || empty($toolpw)){\n           Redirect('index.php?mod=admin:tools');\n         }\n        */\n\n        switch (strip_tags($_GET['setting'])) {\n            case 'optim':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         global $m;\n                $rs = $m->query(\"SHOW TABLES FROM `\" . DB_NAME . '`');\n                while ($row = $m->fetch_row($rs)) {\n                    $m->query('OPTIMIZE TABLE  `' . DB_NAME . '`.`' . $row[0] . '`');\n                }\n\n                break;\n            case 'fixdoing':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         option::set('cron_isdoing', 0);\n\n                break;\n            case 'reftable':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         option::set('freetable', getfreetable());\n\n                break;\n            case 'cron_sign_again':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         option::set('cron_sign_again', '');\n\n                break;\n            case 'runsql':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         global $m;\n                if (!empty($_POST['sql'])) {\n                    $sql = str_ireplace('{VAR-DBNAME}', DB_NAME, str_ireplace('{VAR-PREFIX}', DB_PREFIX, $_POST['sql']));\n                    $m->xquery($sql);\n                }\n\n                break;\n            case 'backup':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         global $m;\n                $list  = !empty($_POST['tab']) ? array_map('addslashes', $_POST['tab']) : msg('请至少选择一个需要导出的表');\n                $dump  = '#Warning: Do not change the comments!!!'  . \"\\n\";\n                $dump .= '#Tieba-Cloud-Sign Database Backup' . \"\\n\";\n                $dump .= '#Version:' . SYSTEM_VER . \"\\n\";\n                $dump .= '#Date:' . date('Y-m-d H:i:s') . \"\\n\";\n                $dump .= '############## Start ##############' . \"\\n\";\n                foreach ($list as $table) {\n                    $dump .= dataBak($table);\n                }\n                $dump .= \"\\n\" . '############## End ##############';\n                $file  = 'cloud_sign_' . date('Y-m-d_H-m-s') . '.sql';\n                if (!empty($_POST['zip'])) {\n                    if (!is_dir(SYSTEM_ROOT . '/source/cache')) {\n                        mkdir(SYSTEM_ROOT . '/source/cache', 0777, true);\n                    }\n                    if (CreateZip($file, $dump, SYSTEM_ROOT . '/source/cache/' . $file . '.zip') === true) {\n                        header('Content-Type: application/zip');\n                        header('Content-Disposition: attachment; filename=' . $file . '.zip');\n                        echo file_get_contents(SYSTEM_ROOT . '/source/cache/' . $file . '.zip');\n                        unlink(SYSTEM_ROOT . '/source/cache/' . $file . '.zip');\n                        die;\n                    }\n                }\n                header('Content-Type: text/x-sql');\n                header('Content-Disposition: attachment; filename=' . $file);\n                echo $dump;\n\n                die;\n            break;\n            case 'remtab':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         global $m;\n                if (!empty($_POST['tab'])) {\n                    $m->query('DROP TABLE IF EXISTS `' . $_POST['tab'] . '`');\n                }\n\n                break;\n            case 'truntab':\n                if (!empty($_POST['tab'])) {\n                    $m->query('TRUNCATE TABLE `' . $_POST['tab'] . '`');\n                }\n\n                break;\n/*\n        case 'updatefid':\n          global $m;\n         global $i;\n         $fbs = $i['tabpart'];\nif (!isset($_GET['ok'])) {\n$step = $_GET['step'] + 30;\n$next = isset($_GET['in']) ? strip_tags($_GET['in']) : 'tieba';\n$c  = $m->once_fetch_array(\"SELECT COUNT(*) AS `x` FROM `\".DB_PREFIX.$next.\"`\");\n$c2 = $m->once_fetch_array(\"SELECT COUNT(*) AS `x` FROM `\".DB_PREFIX.$next.\"` WHERE `fid` = '0'\");\nif ($c2['x'] >= 1) {\n$x  = $m->query(\"SELECT * FROM `\".DB_PREFIX.$next.\"` WHERE `fid` = '0' LIMIT 30\");\nwhile ($r = $m->fetch_array($x)) {\n$fid = misc::getFid($r['tieba']);\n$m->query(\"UPDATE `\".DB_PREFIX.$next.\"` SET  `fid` =  '{$fid}' WHERE `\".DB_PREFIX.$next.\"`.`id` = {$r['id']};\");\n}\n} else {\n$step = 0;\nif ($next == 'tieba') {\n$next = $fbs[1];\n} else {\nforeach ($fbs as $ke => $va) {\nif ($va == $next) {\n$newkey = $ke + 1;\n$next = $ke[$newkey];\nbreak;\n}\n}\n}\n}\n\nif (empty($next)) {\nmsg('<meta http-equiv=\"refresh\" content=\"0; url='.SYSTEM_URL.'index.php?mod=admin:tools&ok\" />即将完成更新......程序将自动继续<br/><br/><a href=\"'.SYSTEM_URL.'index.php?mod=admin:tools&ok\">如果你的浏览器没有自动跳转，请点击这里</a>',false);\n}\n\nmsg('<meta http-equiv=\"refresh\" content=\"0; url=setting.php?mod=updatefid&step='.$step.'&in='.$next.'\" />已经更新表：'.DB_PREFIX.$next.' / 即将更新表：'.DB_PREFIX.$next.'<br/><br/>当前进度：'.$step.' / '.$c['x'].' <progress style=\"width:60%\" value=\"'.$step.'\" max=\"'.$c['x'].'\"></progress><br/><br/>切勿关闭浏览器，程序将自动继续<br/><br/><a href=\"setting.php?mod=updatefid&step='.$step.'&in='.$next.'\">如果你的浏览器没有自动跳转，请点击这里</a>',false);\n}\n          break;\n            */\n\n            case 'install_plugin':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         doAction('plugin_install_1');\n                if (!class_exists('ZipArchive')) {\n                    msg('插件安装失败：你的主机不支持 ZipArchive 类，请返回');\n                }\n                if (!is_writable(SYSTEM_ROOT . '/plugins')) {\n                    msg('插件安装失败：你的主机不支持文件写入，请手动安装插件');\n                }\n                if (!isset($_FILES['plugin'])) {\n                    msg('若要安装插件，请上传插件包');\n                }\n                $file = $_FILES['plugin'];\n                if (!empty($file['error'])) {\n                    msg('插件安装失败：在上传文件时发生错误：代码：' . $file['error']);\n                }\n                if (empty($file['size'])) {\n                    msg('插件安装失败：插件包大小无效 ( 0 Byte )，请确认压缩包是否已损坏');\n                }\n                $z  = new ZipArchive();\n                if (!$z->open($file['tmp_name'])) {\n                    msg('插件安装失败：无法打开压缩包');\n                }\n                $rdc = explode('/', $z->getNameIndex(0), 2);\n                $rd  = $rdc[0];\n                if ($z->getFromName($rd . '/' . $rd . '.php') === false) {\n                    if ($z->getFromName($rd . '/' . str_ireplace(array('-master','master-'), '', $rd) . '.php')) {\n                        $z->renameIndex(0, str_ireplace(array('-master','master-'), '', $rd));\n                    } else {\n                        msg('插件安装失败：插件包不合法，请确认此插件为' . SYSTEM_FN . '插件');\n                    }\n                }\n                if (!$z->extractTo(SYSTEM_ROOT . '/plugins')) {\n                    msg('插件安装失败：解压缩失败');\n                }\n                doAction('plugin_install_2');\n                msg('插件安装成功');\n\n                break;\n            default:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         msg('未定义操作');\n\n                break;\n        }\n        doAction('admin_tools_doing');\n        Redirect('index.php?mod=admin:tools&ok');\n\n        break;\n    case 'admin:users':\n        if (!empty($_GET['control'])) {\n            $osq = $m->once_fetch_array(\"SELECT `id`,`role`,`pw` FROM  `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"users` WHERE `id` = '{$_GET['control']}' LIMIT 1\");\n            empty($osq['pw']) and msg('用户不存在');\n            $osq['role'] == 'admin' and msg('无法控制管理员');\n            doAction('admin_users_control');\n            setcookie(\"uid\", $_GET['control'], time() + 999999);\n            setcookie(\"pwd\", hash_hmac('sha256', $osq['pw'], $osq['id'] . $osq['pw']), time() + 999999);\n            setcookie(\"con_uid\", UID);\n            setcookie(\"con_pwd\", $_COOKIE['pwd']);\n            redirect('index.php');\n        }\n        switch (strip_tags($_POST['do'])) {\n            case 'cookie':\n                foreach ($_POST['user'] as $value) {\n                    $m->query(\"DELETE FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE  `\" . DB_PREFIX . \"baiduid`.`uid` = \" . $value);\n                }\n                doAction('admin_users_cookie');\n\n                break;\n            case 'clean':\n                foreach ($_POST['user'] as $value) {\n                    CleanUser($value);\n                }\n                doAction('admin_users_clean');\n\n                break;\n            case 'delete':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         MustAdminWarning($_POST['user']);\n                foreach ($_POST['user'] as $value) {\n                    DeleteUser($value);\n                }\n                doAction('admin_users_delete');\n\n                break;\n            case 'crole':\n                // 判断用户组字符串是否合法\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         $role = $_POST['crolev'];\n                if (!in_array($role, array('user', 'admin', 'vip', 'banned'))) {\n                    msg('无效的用户组！');\n                }\n                // 如果准备将用户组设为admin以外时，先检测是否还有其他admin可用\n                // 避免出现所有用户都被设为非admin的问题\n                if ($role != 'admin') {\n                    MustAdminWarning($_POST['user']);\n                }\n\n                foreach ($_POST['user'] as $value) {\n                    doAction('admin_users_crole_process', $value, $role);\n                    $m->query(\"UPDATE `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"users` SET `role` = '{$role}' WHERE `\" . DB_PREFIX . \"users`.`id` = {$value}\");\n                }\n                doAction('admin_users_crole');\n\n                break;\n            case 'cset':\n                foreach ($_POST['user'] as $value) {\n                    option::udel($value);\n                }\n                doAction('admin_users_cset');\n\n                break;\n            case 'add':\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         $name = isset($_POST['name']) ? strip_tags($_POST['name']) : '';\n                $mail = isset($_POST['mail']) ? strip_tags($_POST['mail']) : '';\n                $pw   = isset($_POST['pwd']) ? strip_tags($_POST['pwd']) : '';\n                $role = isset($_POST['role']) ? strip_tags($_POST['role']) : 'user';\n                if (empty($name) || empty($mail) || empty($pw)) {\n                    msg('添加用户失败：请正确填写用户名、密码或邮箱');\n                }\n                $x = $m->once_fetch_array(\"SELECT COUNT(*) AS total FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"users` WHERE name='{$name}' OR `email`='{$mail}'\");\n                if ($x['total'] > 0) {\n                    msg('添加用户失败：用户名或邮箱已经存在');\n                }\n                $m->query('INSERT INTO `' . DB_NAME . '`.`' . DB_PREFIX . 'users` (`name`, `pw`, `email`, `role`, `t`) VALUES (\\'' . $name . '\\', \\'' . EncodePwd($pw) . '\\', \\'' . $mail . '\\', \\'' . $role . '\\', \\'' . getfreetable() . '\\');');\n                doAction('admin_users_add');\n                Redirect('index.php?mod=admin:users&ok');\n\n                break;\n            default:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         msg('未定义操作');\n\n                break;\n        }\n        Redirect('index.php?mod=admin:users&ok');\n\n        break;\n    case 'admin:cron':\n                                                                                                                                                                                                                                                                          doAction('cron_setting_1');\n        if (!empty($_GET['act'])) {\n            cron::aset($_GET['act'], array('no' => 0));\n        } elseif (!empty($_GET['dis'])) {\n            cron::aset($_GET['dis'], array('no' => 1));\n        } elseif (isset($_GET['uninst'])) {\n            cron::del($_GET['uninst']);\n        } elseif (isset($_GET['add'])) {\n            if (stripos($_POST['file'], 'do.php') !== false) {\n                msg('<h4>请不要将do.php加入到云签的计划任务中来</h4>若需签到，请用云监控监控<br/>' . SYSTEM_URL . 'do.php<br/>即可实现计划任务(cron)的效果<br/><br/>推荐云监控:<a href=\"http://www.aliyun.com/product/jiankong/\" target=\"_blank\">阿里云监控</a> 或 <a href=\"http://jk.cloud.360.cn/\" target=\"_blank\">360网站服务监控</a> 或 <a href=\"http://ce.baidu.com/\" target=\"_blank\">百度云观测</a><br/>如果你的服务器在国外且国内访问较慢，则推荐使用:<a href=\"http://www.mywebcron.com/\" target=\"_blank\">Free Web Cron Service </a>', SYSTEM_URL . 'index.php?mod=admin:cron');\n            } else {\n                cron::set($_POST['name'], $_POST['file'], $_POST['no'], $_POST['desc'], $_POST['freq'], $_POST['lastdo'], $_POST['log']);\n            }\n        } elseif (isset($_GET['run'])) {\n            $return = cron::run($_GET['file'], $_GET['run']);\n            cron::aset($_GET['run'], array('lastdo' => time() , 'log' => $return));\n        } elseif (isset($_GET['xorder'])) {\n            foreach ($_POST['order'] as $key => $value) {\n                cron::aset($key, array('orde' => $value));\n            }\n        }\n        doAction('cron_setting_2');\n        Redirect('index.php?mod=admin:cron&ok');\n\n        break;\n    case 'admin:create_lock':\n        if (!file_put_contents(SYSTEM_ROOT . '/setup/install.lock', '1')) {\n            $msg = '未能放置 install.lock，请手动完成。<br/><br/>';\n        } else {\n            $msg = '系统成功放置 install.lock，但是如果您的环境为引擎，您必须手工放置<br/><br/>';\n        }\n        $msg .= '若要手工放置，请在云签到的 setup 目录下建立一个 install.lock 文件';\n        msg($msg);\n\n        break;\n    case 'baiduid':\n        if (isset($_GET['delete'])) {\n            doAction('baiduid_set_1');\n            CleanUser(UID);\n            $m->query(\"DELETE FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE `\" . DB_PREFIX . \"baiduid`.`uid` = \" . UID);\n        } elseif (!empty($_GET['bduss']) && !empty($_GET[\"stoken\"])) {\n            if (option::get('bduss_num') == '-1' && ROLE != 'admin') {\n                msg('本站禁止绑定新账号');\n            }\n\n            if (option::get('bduss_num') != '0' && ISVIP == false) {\n                $count = $m->once_fetch_array(\"SELECT COUNT(*) AS `c` FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE `\" . DB_PREFIX . \"baiduid`.`uid` = \" . UID);\n                if (($count['c'] + 1) > option::get('bduss_num')) {\n                    msg('您当前绑定的账号数已达到管理员设置的上限<br/><br/>您当前已绑定 ' . $count['c'] . ' 个账号，最多只能绑定 ' . option::get('bduss_num') . ' 个账号');\n                }\n            }\n            // 去除双引号和bduss=\n            $bduss = str_replace('\"', '', isset($_GET['bduss']) ? $_GET['bduss'] : \"\");\n            $bduss = str_ireplace('BDUSS=', '', $bduss);\n            $bduss = str_replace(' ', '', $bduss);\n            $bduss = sqladds($bduss);\n        // 同上操作取得stoken\n            $stoken = str_replace('\"', '', isset($_GET['stoken']) ? $_GET['stoken'] : \"\");\n            $stoken = str_ireplace('STOKEN=', '', $stoken);\n            $stoken = str_replace(' ', '', $stoken);\n            $stoken = sqladds($stoken);\n        //get user info\n            $baiduUserInfo = getBaiduUserInfo($bduss);\n            if (empty($baiduUserInfo[\"portrait\"])) {\n                msg('您的 Cookie 信息有误，请核验后重新绑定');\n            }\n            $baidu_name = sqladds($baiduUserInfo[\"name\"]);\n            $baidu_name_portrait = sqladds($baiduUserInfo[\"portrait\"]);\n            doAction('baiduid_set_2');\n            $checkSame = $m->once_fetch_array(\"SELECT * FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE `portrait` = '{$baidu_name_portrait}'\");\n            if (option::get('same_pid') == '3' && !empty($checkSame)) {\n                $m->query(\"UPDATE `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` SET `bduss`='{$bduss}', `stoken`='{$stoken}' WHERE `id` = '{$checkSame[\"id\"]}';\");\n            } else {\n                $m->query(\"INSERT INTO `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` (`id`,`uid`,`bduss`,`stoken`,`name`,`portrait`) VALUES  (NULL,'\" . UID . \"', '{$bduss}', '{$stoken}', '{$baidu_name}', '{$baidu_name_portrait}')\");\n            }\n        } elseif (!empty($_GET['del'])) {\n            $del = (int) $_GET['del'];\n            doAction('baiduid_set_3');\n            $x = $m->once_fetch_array(\"SELECT * FROM  `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"users` WHERE  `id` = \" . UID . \" LIMIT 1\");\n            $m->query(\"DELETE FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"baiduid` WHERE `\" . DB_PREFIX . \"baiduid`.`uid` = \" . UID . \" AND `\" . DB_PREFIX . \"baiduid`.`id` = \" . $del);\n            $m->query('DELETE FROM `' . DB_NAME . '`.`' . DB_PREFIX . $x['t'] . '` WHERE `' . DB_PREFIX . $x['t'] . '`.`uid` = ' . UID . ' AND `' . DB_PREFIX . $x['t'] . '`.`pid` = ' . $del);\n        } elseif (empty($_GET[\"bduss\"])) {\n            msg('BDUSS或STOKEN不合法，请核验后重新绑定');\n        }\n        /*\n      elseif (!empty($_GET['reget'])){\n           $reget = (int) $_GET['reget'];\n         $x=$m->once_fetch_array(\"SELECT * FROM  `\".DB_NAME.\"`.`\".DB_PREFIX.\"baiduid` WHERE `uid` = \".UID.\" AND `id` = \".$reget.\" LIMIT 1\");\n            if(!empty($x)){\n                $baidu_name = sqladds(getBaiduId($x['bduss']));\n                if(empty($baidu_name)){\n                    $baidu_name = '[E]';\n               }\n              $m->query(\"UPDATE `\".DB_NAME.\"`.`\".DB_PREFIX.\"baiduid` SET `name` = '$baidu_name' WHERE `id` = '$reget'\");\n         }\n      }\n        */\n        doAction('baiduid_set');\n        Redirect(\"index.php?mod=baiduid\");\n\n        break;\n    case 'showtb':\n        if (isset($_GET['set'])) {\n            $x = $m->fetch_array($m->query('SELECT * FROM  `' . DB_NAME . '`.`' . DB_PREFIX . TABLE . '` WHERE  `uid` = ' . UID . ' LIMIT 1'));\n            $f = $x['tieba'];\n            foreach ($_POST['no'] as $k => $x) {\n                $id = intval($k);\n                if ($x == '0') {\n                    $xv = '0';\n                } else {\n                    $xv = '1';\n                }\n                $m->query(\"UPDATE `\" . DB_PREFIX . TABLE . \"` SET `no` =  '{$xv}' WHERE  `id` = '{$id}' AND `uid` = '\" . UID . \"' ;\");\n            }\n            Redirect('index.php?mod=showtb&ok');\n        } elseif (isset($_GET['refreshTiebaList'])) {\n            $r = misc::scanTiebaByUser();\n            echo 1;\n        } elseif (isset($_GET['clean'])) {\n            CleanUser(UID);\n            Redirect('index.php?mod=showtb');\n        } elseif (isset($_GET['reset'])) {\n            $max = $m->fetch_array($m->query(\"select max(id) as id from `\" . DB_NAME . \"`.`\" . DB_PREFIX . TABLE . \"` where `uid`=\" . UID));\n            $min = $m->fetch_array($m->query(\"select min(id) as id from `\" . DB_NAME . \"`.`\" . DB_PREFIX . TABLE . \"` where `uid`=\" . UID));\n            $max = $max['id'];\n            $min = $min['id'];\n            while ($min < $max) {\n                $res = $m->fetch_array($m->query('SELECT * FROM `' . DB_NAME . '`.`' . DB_PREFIX . TABLE . '` WHERE `id` =' . $min . ' Limit 1'));\n                if ($res['status'] != 0) {\n                    $m->query('UPDATE `' . DB_NAME . '`.`' . DB_PREFIX . TABLE . '` SET `latest` = 0,`status` = 0,`last_error` = NULL WHERE `id` =' . $min);\n                }\n                $min = $min + 1;\n            }\n            Redirect('index.php?mod=showtb&ok');\n        } elseif (isset($_POST['add'])) {\n            if (option::get('enable_addtieba') == '1') {\n                $v = addslashes(htmlspecialchars($_POST['add']));\n                $pid = (int) strip_tags($_POST['pid']);\n                $osq = $m->query(\"SELECT * FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . TABLE . \"` WHERE `uid` = \" . UID . \" AND `tieba` = '{$v}';\");\n                if ($m->num_rows($osq) == 0) {\n                    $table = $m->fetch_array($m->query('select * from `' . DB_NAME . '`.`' . DB_PREFIX . 'users` where `id` = ' . UID));\n                    $tb_max = $m->fetch_row($m->query(\"SELECT COUNT(*) FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . $table['t'] . \"` where `uid` = \" . UID));\n                    if (ROLE == 'admin' || ROLE == 'vip') {\n                        $m->query(\"INSERT INTO `\" . DB_NAME . \"`.`\" . DB_PREFIX . TABLE . \"` (`id`, `pid`, `uid`, `tieba`, `no`, `latest`) VALUES (NULL, {$pid} ,'\" . UID . \"', '{$v}', 0, 0);\");\n                    } else {\n                        if ($tb_max[0] < option::get('tb_max')) {\n                            $m->query(\"INSERT INTO `\" . DB_NAME . \"`.`\" . DB_PREFIX . TABLE . \"` (`id`, `pid`, `uid`, `tieba`, `no`, `latest`) VALUES (NULL, {$pid} ,'\" . UID . \"', '{$v}', 0, 0);\");\n                        } else {\n                            msg('错误：您的贴吧数量超过限制，无法刷新！');\n                        }\n                    }\n                }\n            }\n            Redirect('index.php?mod=showtb&ok');\n        }\n        doAction('showtb_set');\n\n        break;\n    case 'set':\n        // 获取头像的url\n        // 无法获取无id帐号头像, 不建议使用 *wontfix\n\n        if ($i['post']['face_img'] == 1 && $i['post']['face_baiduid'] != '') {\n            $data = getUserInfo($i['post']['face_baiduid']);\n            $i['post']['face_url'] = \"https://himg.bdimg.com/sys/portrait/item/{$data[\"data\"][\"portrait\"]}\";\n            if (empty($i['post']['face_url'])) {\n                msg('获取贴吧头像失败，可能是网络问题，请重试');\n            }\n        }\n        /*\n        受信任的设置项，如果插件要使用系统的API去储存设置，必须通过set_save1或set_save2挂载点挂载设置名\n        具体挂载方法为：\n        global $PostArray;\n        $PostArray[] = '设置名';\n        为了兼容旧版本，可以global以后检查一下是不是空变量，为空则为旧版本\n        */\n        $PostArray = array(\n            'face_img',\n            'face_baiduid',\n            'face_url'\n        );\n        doAction('set_save1');\n    //更改邮箱\n        if ($_POST['mail'] != $i['user']['email'] && !empty($_POST['mail'])) {\n            if (checkMail($_POST['mail'])) {\n                $mail = sqladds($_POST['mail']);\n                $z = $m->once_fetch_array(\"SELECT COUNT(*) AS total FROM `\" . DB_NAME . \"`.`\" . DB_PREFIX . \"users` WHERE email='{$mail}'\");\n                if ($z['total'] > 0) {\n                    msg('修改失败：邮箱已经存在');\n                }\n                $m->query(\"UPDATE `\" . DB_PREFIX . \"users` SET `email` = '{$mail}' WHERE `id` = '\" . UID . \"';\");\n            } else {\n                msg('邮箱格式有误，请检查');\n            }\n        }\n        $set = array();\n        foreach ($PostArray as $value) {\n            if (!isset($i['post'][$value])) {\n                $i['post'][$value] = '';\n            }\n            @option::uset($value, $i['post'][$value]);\n        }\n        doAction('set_save2');\n        Redirect('index.php?mod=set&ok');\n\n        break;\n    case 'admin:testmail':\n                                                                                                                                                                                                                                                                          global $i;\n        $x = misc::mail($i['user']['email'], SYSTEM_FN . ' V' . SYSTEM_VER . ' - 邮件发送测试', '这是一封关于 ' . SYSTEM_FN . ' 的测试邮件，如果你收到了此邮件，表示邮件系统可以正常工作<br/><br/>站点地址：' . SYSTEM_URL, array('测试附件.txt' => '这是一个测试附件'));\n        if ($x === true) {\n            Redirect('index.php?mod=admin:set&mailtestok');\n        } else {\n            msg('邮件发送失败，发件日志：<br/>' . $x);\n        }\n\n        break;\n}\n\nif (ROLE == 'admin' && $i['mode'][0] == 'plugin') {\n    option::pset($i['mode'][1], $_POST);\n    Redirect(\"index.php?mod=admin:setplug&plug={$i['mode'][1]}&ok\");\n} elseif (ROLE == 'admin' && $i['mode'][0] == 'setplugin') {\n    settingPlugin($i['mode'][1]);\n}\n"
        },
        {
          "name": "setup",
          "type": "tree",
          "content": null
        },
        {
          "name": "source",
          "type": "tree",
          "content": null
        },
        {
          "name": "templates",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}