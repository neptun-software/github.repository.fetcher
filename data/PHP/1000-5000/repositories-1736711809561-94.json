{
  "metadata": {
    "timestamp": 1736711809561,
    "page": 94,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjEwMA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "hhxsv5/laravel-s",
      "stars": 3847,
      "defaultBranch": "PHP-8.x",
      "files": [
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.0439453125,
          "content": "vendor\n.idea\ncomposer.lock\n*.sw[a-z]\ncoverage"
        },
        {
          "name": ".scrutinizer.yml",
          "type": "blob",
          "size": 0.6171875,
          "content": "checks:\n  php: true\nfilter:\n  excluded_paths:\n    - tests/*\nbuild:\n  environment:\n    php: 8.2.0\n  nodes:\n    analysis:\n      tests:\n        override:\n          - php-scrutinizer-run\n          - phpcs-run src/*\n    my-tests:\n      environment:\n        php:\n          version: 8.2.0\n          pecl_extensions:\n            - swoole-4.8.13\n      dependencies:\n        before:\n          - composer install\n      tests:\n        override:\n          - composer test\n    coverage:\n      tests:\n        override:\n          - command: composer test\n            coverage:\n              file: coverage/coverage.xml\n              format: clover\n"
        },
        {
          "name": ".travis.yml",
          "type": "blob",
          "size": 0.2998046875,
          "content": "language: php\n\nphp:\n  - 7.4\n  - 8.0\n  - 8.1\n  - 8.2\n  - 8.3\n\nbefore_script:\n  - pecl install --onlyreqdeps --nobuild swoole && cd \"$(pecl config-get temp_dir)/swoole\" && phpize && ./configure --enable-openssl && make -j$(nproc) && make -j$(nproc) install && cd -\n  - composer install\n\nscript: composer test\n"
        },
        {
          "name": "KnownIssues-CN.md",
          "type": "blob",
          "size": 8.4599609375,
          "content": "# å¸¸è§é—®é¢˜\n\n## Class swoole does not exist\n- åœ¨`LaravelS`ä¸­ï¼Œ`Swoole`æ˜¯ä»¥`cli`æ¨¡å¼å¯åŠ¨çš„`Http Server`ï¼Œæ›¿ä»£äº†`FPM`ã€‚\n- æŠ•é€’ä»»åŠ¡ã€è§¦å‘å¼‚æ­¥äº‹ä»¶éƒ½ä¼šè°ƒç”¨`app('swoole')`ï¼Œä»`Laravelå®¹å™¨`ä¸­è·å–`Swoole\\http\\server`å®ä¾‹ã€‚åªæœ‰åœ¨`LaravelS`å¯åŠ¨æ—¶ï¼Œæ‰ä¼šæ³¨å…¥è¿™ä¸ªå®ä¾‹åˆ°å®¹å™¨ä¸­ã€‚\n- æ‰€ä»¥ï¼Œä¸€æ—¦è„±ç¦»`LaravelS`ï¼Œç”±äºè·¨è¿›ç¨‹ï¼Œä»¥ä¸‹æƒ…å†µï¼Œä½ å°†`æ— æ³•`æˆåŠŸè°ƒç”¨`app('swoole')`ï¼š\n    - ä»¥å„ç§`å‘½ä»¤è¡Œ`æ–¹å¼è¿è¡Œçš„ä»£ç ï¼Œä¾‹å¦‚Artisanå‘½ä»¤è¡Œã€PHPè„šæœ¬å‘½ä»¤è¡Œï¼›\n    - è¿è¡Œåœ¨`FPM`/`Apache PHP Module`ä¸‹çš„ä»£ç ï¼ŒæŸ¥çœ‹SAPI `Log::info('PHP SAPI', [php_sapi_name()]);`ã€‚\n\n## ä½¿ç”¨åŒ… [encore/laravel-admin](https://github.com/z-song/laravel-admin)\n> ä¿®æ”¹`config/laravels.php`ï¼Œåœ¨`cleaners`ä¸­å¢åŠ `LaravelAdminCleaner`ã€‚\n\n```php\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\LaravelAdminCleaner::class,\n],\n```\n\n## ä½¿ç”¨åŒ… [jenssegers/agent](https://github.com/jenssegers/agent)\n> [ç›‘å¬ç³»ç»Ÿäº‹ä»¶](https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E7%B3%BB%E7%BB%9F%E4%BA%8B%E4%BB%B6)\n\n```php\n// é‡ç½®Agent\n\\Event::listen('laravels.received_request', function (\\Illuminate\\Http\\Request $req, $app) {\n    $app->agent->setHttpHeaders($req->server->all());\n    $app->agent->setUserAgent();\n});\n```\n\n## ä½¿ç”¨åŒ… [barryvdh/laravel-debugbar](https://github.com/barryvdh/laravel-debugbar)\n> å®˜æ–¹ä¸æ”¯æŒ`cli`æ¨¡å¼ï¼Œéœ€é€šè¿‡ä¿®æ”¹ç¯å¢ƒå˜é‡`APP_RUNNING_IN_CONSOLE`ä¸ºé`cli`ï¼Œä½†å¯ç”¨åä¸æ’é™¤ä¼šæœ‰å…¶ä»–é—®é¢˜ã€‚\n\n`.env`ä¸­å¢åŠ ç¯å¢ƒå˜é‡`APP_RUNNING_IN_CONSOLE=false`ã€‚\n\n## ä½¿ç”¨åŒ… [the-control-group/voyager](https://github.com/the-control-group/voyager)\n> `voyager`ä¾èµ–åŒ…[arrilot/laravel-widgets](https://github.com/arrilot/laravel-widgets)ï¼Œè€Œå…¶ä¸­`WidgetGroupCollection`æ˜¯å•ä¾‹ï¼Œ[è¿½åŠ Widget](https://github.com/arrilot/laravel-widgets/blob/master/src/WidgetGroup.php#L270)ä¼šé€ æˆå®ƒä»¬é‡å¤å±•ç¤ºï¼Œé€šè¿‡é‡æ–°æ³¨å†ŒServiceProvideræ¥é‡ç½®æ­¤å•ä¾‹ã€‚\n\n```php\n// config/laravels.php\n'register_providers' => [\n    Arrilot\\Widgets\\ServiceProvider::class,\n],\n```\n\n## ä½¿ç”¨åŒ… [overtrue/wechat](https://github.com/overtrue/wechat)\n> easywechatåŒ…ä¼šå‡ºç°å¼‚æ­¥é€šçŸ¥å›è°ƒå¤±è´¥çš„é—®é¢˜ï¼ŒåŸå› æ˜¯`$app['request']->getContent()`æ˜¯ç©ºçš„ï¼Œç»™å…¶èµ‹å€¼å³å¯ã€‚\n\n```php\n//å›è°ƒé€šçŸ¥\npublic function notify(Request $request)\n{\n    $app = $this->getPayment();//è·å–æ”¯ä»˜å®ä¾‹\n    $app['request'] = $request;//åœ¨åŸæœ‰ä»£ç æ·»åŠ è¿™ä¸€è¡Œï¼Œå°†å½“å‰Requestèµ‹å€¼ç»™$app['request']\n    $response = $app->handlePaidNotify(function ($message, $fail) use($id) {\n        //...\n    });\n    return $response;\n}\n```\n\n\n## ä½¿ç”¨åŒ… [laracasts/flash](https://github.com/laracasts/flash)\n> å¸¸é©»å†…å­˜åï¼Œæ¯æ¬¡è°ƒç”¨flash()ä¼šè¿½åŠ æ¶ˆæ¯æé†’ï¼Œå¯¼è‡´å åŠ å±•ç¤ºæ¶ˆæ¯æé†’ã€‚æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ¡ˆã€‚\n\n1.é€šè¿‡ä¸­é—´ä»¶åœ¨æ¯æ¬¡è¯·æ±‚`å¤„ç†å‰`æˆ–`å¤„ç†å`é‡ç½®$messages `app('flash')->clear();`ã€‚\n\n2.æ¯æ¬¡è¯·æ±‚å¤„ç†åé‡æ–°æ³¨å†Œ`FlashServiceProvider`ï¼Œé…ç½®[register_providers](https://github.com/hhxsv5/laravel-s/blob/master/Settings-CN.md)ã€‚\n\n## ä½¿ç”¨åŒ… [laravel/telescope](https://github.com/laravel/telescope)\n> å› Swooleè¿è¡Œåœ¨`cli`æ¨¡å¼ï¼Œå¯¼è‡´`RequestWatcher`ä¸èƒ½æ­£å¸¸è¯†åˆ«å¿½ç•¥çš„è·¯ç”±ã€‚\n\nè§£å†³æ–¹æ¡ˆï¼š\n\n1.`.env`ä¸­å¢åŠ ç¯å¢ƒå˜é‡`APP_RUNNING_IN_CONSOLE=false`ï¼›\n\n2.ä¿®æ”¹ä»£ç ã€‚\n\n```php\n// ä¿®æ”¹`app/Providers/EventServiceProvider.php`, æ·»åŠ ä¸‹é¢ç›‘å¬ä»£ç åˆ°bootæ–¹æ³•ä¸­\n// use Laravel\\Telescope\\Telescope;\n// use Illuminate\\Support\\Facades\\Event;\nEvent::listen('laravels.received_request', function ($request, $app) {\n    $reflection = new \\ReflectionClass(Telescope::class);\n    $handlingApprovedRequest = $reflection->getMethod('handlingApprovedRequest');\n    $handlingApprovedRequest->setAccessible(true);\n    $handlingApprovedRequest->invoke(null, $app) ? Telescope::startRecording() : Telescope::stopRecording();\n});\n```\n\n## å•ä¾‹æ§åˆ¶å™¨\n\n- Laravel 5.3+ æ§åˆ¶å™¨æ˜¯è¢«ç»‘å®šåœ¨`Router`ä¸‹çš„`Route`ä¸­ï¼Œè€Œ`Router`æ˜¯å•ä¾‹ï¼Œæ§åˆ¶å™¨åªä¼šè¢«æ„é€ `ä¸€æ¬¡`ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–`è¯·æ±‚çº§æ•°æ®`ï¼Œä¸‹é¢å±•ç¤º`é”™è¯¯çš„ç”¨æ³•`ã€‚\n\n```php\nnamespace App\\Http\\Controllers;\nclass TestController extends Controller\n{\n    protected $userId;\n    public function __construct()\n    {\n        // é”™è¯¯çš„ç”¨æ³•ï¼šå› æ§åˆ¶å™¨åªè¢«æ„é€ ä¸€æ¬¡ï¼Œç„¶åå¸¸é©»äºå†…å­˜ï¼Œæ‰€ä»¥$userIdåªä¼šè¢«èµ‹å€¼ä¸€æ¬¡ï¼Œåç»­è¯·æ±‚ä¼šè¯¯è¯»å–ä¹‹å‰è¯·æ±‚$userId\n        $this->userId = session('userId');\n    }\n    public function testAction()\n    {\n        // è¯»å–$this->userId;\n    }\n}\n```\n\n- ä¸¤ç§è§£å†³æ–¹æ³•(äºŒé€‰ä¸€)\n\n1.é¿å…åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–`è¯·æ±‚çº§`çš„æ•°æ®ï¼Œåº”åœ¨å…·ä½“`Action`ä¸­è¯»å–ï¼Œè¿™æ ·ç¼–ç é£æ ¼æ›´åˆç†ï¼Œå»ºè®®è¿™æ ·å†™ã€‚\n\n```bash\n# åˆ—å‡ºä½ çš„è·¯ç”±ä¸­æ‰€æœ‰å…³è”çš„æ§åˆ¶å™¨çš„æ‰€æœ‰å±æ€§\nphp artisan laravels:list-properties\n```\n\n```php\nnamespace App\\Http\\Controllers;\nclass TestController extends Controller\n{\n    protected function getUserId()\n    {\n        return session('userId');\n    }\n    public function testAction()\n    {\n        // é€šè¿‡è°ƒç”¨$this->getUserId()è¯»å–$userId\n    }\n}\n```\n\n2.ä½¿ç”¨`LaravelS`æä¾›çš„`è‡ªåŠ¨é”€æ¯æ§åˆ¶å™¨`æœºåˆ¶ã€‚\n\n```php\n// config/laravels.php\n// å°†enableç½®ä¸ºtrueã€excluded_listç½®ä¸º[]ï¼Œåˆ™è¡¨ç¤ºè‡ªåŠ¨é”€æ¯æ‰€æœ‰æ§åˆ¶å™¨\n'destroy_controllers'      => [\n    'enable'        => true, // å¯ç”¨è‡ªåŠ¨é”€æ¯æ§åˆ¶å™¨\n    'excluded_list' => [\n        //\\App\\Http\\Controllers\\TestController::class, // æ’é™¤é”€æ¯çš„æ§åˆ¶å™¨ç±»åˆ—è¡¨\n    ],\n],\n```\n\n## ä¸èƒ½ä½¿ç”¨è¿™äº›å‡½æ•°\n\n- `flush`/`ob_flush`/`ob_end_flush`/`ob_implicit_flush`ï¼š`swoole_http_response`ä¸æ”¯æŒ`flush`ã€‚\n\n- `dd()`/`exit()`/`die()`: å°†å¯¼è‡´Worker/Task/Processè¿›ç¨‹ç«‹å³é€€å‡ºï¼Œå»ºè®®é€šè¿‡æŠ›å¼‚å¸¸è·³å‡ºå‡½æ•°è°ƒç”¨æ ˆï¼Œ[Swooleæ–‡æ¡£](https://wiki.swoole.com/wiki/page/501.html)ã€‚\n\n- `header()`/`setcookie()`/`http_response_code()`ï¼šHTTPå“åº”åªèƒ½é€šè¿‡Laravel/Lumençš„`Response`å¯¹è±¡ã€‚\n\n## ä¸èƒ½ä½¿ç”¨çš„å…¨å±€å˜é‡\n\n- $_GETã€$_POSTã€$_FILESã€$_COOKIEã€$_REQUESTã€$_SESSIONã€$GLOBALSï¼Œ$_ENVæ˜¯`å¯è¯»`çš„ï¼Œ$_SERVERæ˜¯`éƒ¨åˆ†å¯è¯»`çš„ã€‚\n\n## å¤§å°é™åˆ¶\n\n- `Swoole`é™åˆ¶äº†`GET`è¯·æ±‚å¤´çš„æœ€å¤§å°ºå¯¸ä¸º`8KB`ï¼Œå»ºè®®`Cookie`çš„ä¸è¦å¤ªå¤§ï¼Œä¸ç„¶Cookieå¯èƒ½è§£æå¤±è´¥ã€‚\n\n- `POST`æ•°æ®æˆ–æ–‡ä»¶ä¸Šä¼ çš„å¤§å°å—`Swoole`é…ç½®[`package_max_length`](https://wiki.swoole.com/wiki/page/301.html)é™åˆ¶ï¼Œé»˜è®¤ä¸Šé™`2M`ã€‚\n\n- æ–‡ä»¶ä¸Šä¼ çš„å¤§å°å—åˆ°äº†[memory_limit](https://www.php.net/manual/zh/ini.core.php#ini.memory-limit)çš„é™åˆ¶ï¼Œé»˜è®¤`128M`ã€‚\n\n## Inotifyç›‘å¬æ–‡ä»¶æ•°è¾¾åˆ°ä¸Šé™\n> `Warning: inotify_add_watch(): The user limit on the total number of inotify watches was reached`\n\n- `Linux`ä¸­`Inotify`ç›‘å¬æ–‡ä»¶æ•°é»˜è®¤ä¸Šé™ä¸€èˆ¬æ˜¯`8192`ï¼Œå®é™…é¡¹ç›®çš„æ–‡ä»¶æ•°+ç›®å½•æ ‘å¾ˆå¯èƒ½è¶…è¿‡æ­¤ä¸Šé™ï¼Œè¿›è€Œå¯¼è‡´åç»­çš„ç›‘å¬å¤±è´¥ã€‚\n\n- å¢åŠ æ­¤ä¸Šé™åˆ°`524288`ï¼š`echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p`ï¼Œæ³¨æ„`Docker`æ—¶éœ€è®¾ç½®å¯ç”¨`privileged`ã€‚\n\n## æ³¨æ„include/requireä¸(include/require)_once\n> çœ‹çœ‹é¸Ÿå“¥è¿™ç¯‡æ–‡ç« [å†ä¸€æ¬¡, ä¸è¦ä½¿ç”¨(include/require)_once](http://www.laruence.com/2012/09/12/2765.html)\n\n- å¼•å…¥`ç±»`ã€`æ¥å£`ã€`trait`ã€`å‡½æ•°`æ—¶ä½¿ç”¨(include/require)_onceï¼Œå…¶ä»–æƒ…å†µä½¿ç”¨include/requireã€‚\n\n- åœ¨å¤šè¿›ç¨‹æ¨¡å¼ä¸‹ï¼Œå­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹èµ„æºï¼Œä¸€æ—¦çˆ¶è¿›ç¨‹å¼•å…¥äº†æŸä¸ªéœ€è¦è¢«æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå­è¿›ç¨‹å†æ¬¡`require_once()`æ—¶ä¼šç›´æ¥è¿”å›`true`ï¼Œå¯¼è‡´è¯¥æ–‡ä»¶æ‰§è¡Œå¤±è´¥ã€‚æ­¤æ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨include/requireã€‚\n\n\n## å¯¹äº`Swoole < 1.9.17`çš„ç¯å¢ƒ\n> å¼€å¯`handle_static`åï¼Œé™æ€èµ„æºæ–‡ä»¶å°†ç”±`LaravelS`ç»„ä»¶å¤„ç†ã€‚ç”±äºPHPç¯å¢ƒçš„åŸå› ï¼Œå¯èƒ½ä¼šå¯¼è‡´`MimeTypeGuesser`æ— æ³•æ­£ç¡®è¯†åˆ«`MimeType`ï¼Œæ¯”å¦‚ä¼šJavascriptä¸CSSæ–‡ä»¶ä¼šè¢«è¯†åˆ«ä¸º`text/plain`ã€‚\n\nè§£å†³æ–¹æ¡ˆï¼š\n\n1.å‡çº§Swooleåˆ°`1.9.17+`\n\n2.æ³¨å†Œè‡ªå®šä¹‰MIMEçŒœæµ‹å™¨\n\n```php\n// MyGuessMimeType.php\nuse Symfony\\Component\\HttpFoundation\\File\\MimeType\\MimeTypeGuesserInterface;\nclass MyGuessMimeType implements MimeTypeGuesserInterface\n{\n    protected static $map = [\n        'js'  => 'application/javascript',\n        'css' => 'text/css',\n    ];\n    public function guess($path)\n    {\n        $ext = pathinfo($path, PATHINFO_EXTENSION);\n        if (strlen($ext) > 0) {\n            return Arr::get(self::$map, $ext);\n        } else {\n            return null;\n        }\n    }\n}\n```\n\n```php\n// AppServiceProvider.php\nuse Symfony\\Component\\HttpFoundation\\File\\MimeType\\MimeTypeGuesser;\npublic function boot()\n{\n    MimeTypeGuesser::getInstance()->register(new MyGuessMimeType());\n}\n```\n\n"
        },
        {
          "name": "KnownIssues.md",
          "type": "blob",
          "size": 8.7744140625,
          "content": "# Known issues\n\n## Class swoole does not exist\n- In `LaravelS`, `Swoole` is `Http Server` started in `cli` mode, replacing `FPM`.\n- Delivering a task, triggering an asynchronous event will call `app('swoole')` and get the `Swoole\\http\\server` instance from the `Laravel container`. This instance is injected into the container only when `LaravelS` is started.\n- So, once you leave the `LaravelS`, due to the cross-process, you will be `unable` to successfully call `app('swoole')`:\n    - The code that runs in various `command line` modes, such as the Artisan command line and the PHP script command line.\n    - Run the code under `FPM`/`Apache PHP Module`, view SAPI `Log::info('PHP SAPI', [php_sapi_name()]);`.\n\n## Use package [encore/laravel-admin](https://github.com/z-song/laravel-admin)\n> Modify `config/laravels.php` and add` LaravelAdminCleaner` in `cleaners`.\n\n```php\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\LaravelAdminCleaner::class,\n],\n```\n\n## Use package [jenssegers/agent](https://github.com/jenssegers/agent)\n> [Listen System Event](https://github.com/hhxsv5/laravel-s/blob/master/README.md#system-events)\n\n```php\n// Reset Agent\n\\Event::listen('laravels.received_request', function (\\Illuminate\\Http\\Request $req, $app) {\n    $app->agent->setHttpHeaders($req->server->all());\n    $app->agent->setUserAgent();\n});\n```\n\n## Use package [barryvdh/laravel-debugbar](https://github.com/barryvdh/laravel-debugbar)\n> Not support `cli` mode officially, you need to add the environment variable `APP_RUNNING_IN_CONSOLE` to be non-cli`, but there may be some other issues.\n\nAdd environment variable `APP_RUNNING_IN_CONSOLE=false` to `.env`.\n\n## Use package [the-control-group/voyager](https://github.com/the-control-group/voyager)\n> `voyager` dependencies [arrilot/laravel-widgets](https://github.com/arrilot/laravel-widgets), where `WidgetGroupCollection` is a singleton, [appending widget](https://github.com/Arrilot/laravel-widgets/blob/master/src/WidgetGroup.php#L270) will cause them to repeat the display, you need to reset the singleton by re-registering the ServiceProvider.\n\n```php\n// config/laravels.php\n'register_providers' => [\n    Arrilot\\Widgets\\ServiceProvider::class,\n],\n```\n\n## Use package [overtrue/wechat](https://github.com/overtrue/wechat)\n> The asynchronous notification callback will be failing, because `$app['request']->getContent()` is empty, give it a value.\n\n```php\npublic function notify(Request $request)\n{\n    $app = $this->getPayment();//Get payment instance\n    $app['request'] = $request;//Add this line to the original code and assign the current request instance to $app['request']\n    $response = $app->handlePaidNotify(function ($message, $fail) use($id) {\n        //...\n    });\n    return $response;\n}\n```\n## Use package [laracasts/flash](https://github.com/laracasts/flash)\n> Flash messages are held in memory all the time. Appending to `$messages` when call flash() every time, leads to the multiple messages. There are two solutions.\n\n1.Reset `$messages` by middleware `app('flash')->clear();`.\n\n2.Re-register `FlashServiceProvider` after handling request, Refer [register_providers](https://github.com/hhxsv5/laravel-s/blob/master/Settings.md).\n\n## Use package [laravel/telescope](https://github.com/laravel/telescope)\n> Because Swoole is running in `cli` mode, `RequestWatcher` does not recognize the ignored route properly.\n\nSolution:\n\n1.Add environment variable `APP_RUNNING_IN_CONSOLE=false` to `.env`;\n\n2.Modify code.\n\n```php\n// Edit file `app/Providers/EventServiceProvider.php`, add the following code into method `boot`\n// use Laravel\\Telescope\\Telescope;\n// use Illuminate\\Support\\Facades\\Event;\nEvent::listen('laravels.received_request', function ($request, $app) {\n    $reflection = new \\ReflectionClass(Telescope::class);\n    $handlingApprovedRequest = $reflection->getMethod('handlingApprovedRequest');\n    $handlingApprovedRequest->setAccessible(true);\n    $handlingApprovedRequest->invoke(null, $app) ? Telescope::startRecording() : Telescope::stopRecording();\n});\n```\n\n## Singleton controller\n\n- Laravel 5.3+ controller is bound to `Route` under `Router`, and `Router` is a singleton, controller will only be constructed `once`, so you cannot initialize `request-level data` in the constructor, the following shows you the `wrong` usage.\n\n```php\nnamespace App\\Http\\Controllers;\nclass TestController extends Controller\n{\n    protected $userId;\n    public function __construct()\n    {\n        // Wrong usage: Since the controller is only constructed once and then resident in memory, $userId will only be assigned once, and subsequent requests will be misread before requesting $userId\n        $this->userId = session('userId');\n    }\n    public function testAction()\n    {\n        // read $this->userId;\n    }\n}\n```\n\n- Two solutions (choose one)\n\n1.Avoid initializing `request-level` data in the constructor, which should be read in the concrete `Action`. This coding style is more reasonable, it is recommended to do so.\n\n```bash\n# List all properties of all controllers related your routes.\nphp artisan laravels:list-properties\n```\n\n```php\nnamespace App\\Http\\Controllers;\nclass TestController extends Controller\n{\n    protected function getUserId()\n    {\n        return session('userId');\n    }\n    public function testAction()\n    {\n        // call $this->getUserId() to read $userId\n    }\n}\n```\n\n2.Use the `automatic destruction controller` mechanism provided by `LaravelS`.\n\n```php\n// config/laravels.php\n// Set enable to true and exclude_list to [], which means that all controllers are automatically destroyed.\n'destroy_controllers'      => [\n    'enable'        => true, // Enable automatic destruction controller\n    'excluded_list' => [\n        //\\App\\Http\\Controllers\\TestController::class, // The excluded list of destroyed controller classes\n    ],\n],\n```\n\n## Cannot call these functions\n\n- `flush`/`ob_flush`/`ob_end_flush`/`ob_implicit_flush`: `swoole_http_response` does not support `flush`.\n\n- `dd()`/`exit()`/`die()`: will lead to Worker/Task/Process quit right now, suggest jump out function call stack by throwing exception.\n\n- `header()`/`setcookie()`/`http_response_code()`: Make HTTP response by Laravel/Lumen `Response` only in LaravelS underlying.\n\n## Cannot use these global variables\n\n- $_GET/$_POST/$_FILES/$_COOKIE/$_REQUEST/$_SESSION/$GLOBALS, $_ENV is `readable`, $_SERVER is `partial readable`.\n\n## Size restriction\n\n- The max size of `GET` request's header is `8KB`, limited by `Swoole`, the big `Cookie` will lead to parse Cookie fail.\n\n- The max size of `POST` data/file is limited by `Swoole` [package_max_length](https://www.swoole.co.uk/docs/modules/swoole-server/configuration), default `2M`.\n\n- The max size of the file upload is limited by [memory_limit](https://www.php.net/manual/en/ini.core.php#ini.memory-limit), default `128M`.\n\n## Inotify reached the watchers limit\n> `Warning: inotify_add_watch(): The user limit on the total number of inotify watches was reached`\n\n- Inotify limit is default `8192` for most `Linux`, but the amount of actual project may be more than it, then lead to watch fail.\n\n- Increase the amount of inotify watchers to `524288`: `echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p`, note: you need to enable `privileged` for `Docker`.\n\n## include/requireä¸(include/require)_once\n> See Laruence's blog [Do NOT USE (include/require)_once](http://www.laruence.com/2012/09/12/2765.html)\n\n- To include the files about `class`/`interface`/`trait`/`function`, sugguest to use (include/require)_once. In other cases, use include/require.\n\n- In the multi-process mode, the child process inherits the parent process resource. Once the parent process includes a file that needs to be executed, the child process will directly return true when it uses require_once(), causing the file to fail to execute. Now, you need to use include/require.\n\n## If `Swoole < 1.9.17`\n> After enabling `handle_static`, static resource files will be handled by `LaravelS`. Due to the PHP environment, `MimeTypeGuesser` may not correctly recognize `MimeType`. For example, Javascript and CSS files will be recognized as `text/plain`.\n\nSolutions:\n\n1.Upgrade Swoole to `1.9.17+`.\n\n2.Register a custom MIME guesser.\n\n```php\n// MyGuessMimeType.php\nuse Symfony\\Component\\HttpFoundation\\File\\MimeType\\MimeTypeGuesserInterface;\nclass MyGuessMimeType implements MimeTypeGuesserInterface\n{\n    protected static $map = [\n        'js'  => 'application/javascript',\n        'css' => 'text/css',\n    ];\n    public function guess($path)\n    {\n        $ext = pathinfo($path, PATHINFO_EXTENSION);\n        if (strlen($ext) > 0) {\n            return Arr::get(self::$map, $ext);\n        } else {\n            return null;\n        }\n    }\n}\n```\n\n```php\n// AppServiceProvider.php\nuse Symfony\\Component\\HttpFoundation\\File\\MimeType\\MimeTypeGuesser;\npublic function boot()\n{\n    MimeTypeGuesser::getInstance()->register(new MyGuessMimeType());\n}\n```\n\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.0380859375,
          "content": "MIT License\n\nCopyright (c) 2018 hhxsv5\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n"
        },
        {
          "name": "README-CN.md",
          "type": "blob",
          "size": 60.71484375,
          "content": "<div align=\"center\">\n    <img src=\"https://github.com/hhxsv5/laravel-s/raw/PHP-8.x/logo.svg\" alt=\"LaravelS Logo\" height=\"80\">\n     <p>\n        <a href=\"https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md\">ä¸­æ–‡æ–‡æ¡£</a> |\n        <a href=\"https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md\">English Docs</a>\n    </p>\n    <p>ğŸš€ LaravelS æ˜¯ Laravel/Lumen å’Œ Swoole ä¹‹é—´å¼€ç®±å³ç”¨çš„é€‚é…å™¨</p>\n    <p>\n        <a href=\"https://github.com/hhxsv5/laravel-s/releases\">\n            <img src=\"https://img.shields.io/github/release/hhxsv5/laravel-s.svg\" alt=\"Latest Version\">\n        </a>\n        <a href=\"https://www.php.net/\">\n            <img src=\"https://img.shields.io/packagist/php-v/hhxsv5/laravel-s\" alt=\"PHP Version\">\n        </a>\n        <a href=\"https://github.com/swoole/swoole-src\">\n            <img src=\"https://img.shields.io/badge/swoole-%3E=5.0.0-flat.svg\" alt=\"Swoole Version\">\n        </a>\n        <a href=\"https://packagist.org/packages/hhxsv5/laravel-s/stats\">\n            <img src=\"https://img.shields.io/packagist/dt/hhxsv5/laravel-s\" alt=\"Total Downloads\">\n        </a>\n        <a href=\"https://scrutinizer-ci.com/g/hhxsv5/laravel-s/\">\n            <img src=\"https://scrutinizer-ci.com/g/hhxsv5/laravel-s/badges/build.png?b=PHP-8.x\" alt=\"Build Status\">\n        </a>\n        <a href=\"https://scrutinizer-ci.com/g/hhxsv5/laravel-s/\">\n            <img src=\"https://scrutinizer-ci.com/g/hhxsv5/laravel-s/badges/code-intelligence.svg?b=PHP-8.x\" alt=\"Code Intelligence Status\">\n        </a>\n        <a href=\"https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/LICENSE\">\n            <img src=\"https://img.shields.io/github/license/hhxsv5/laravel-s\" alt=\"License\">\n        </a>\n    </p>\n</div>\n\n---\n\n## æŒç»­æ›´æ–°\n- *è¯·`Watch`æ­¤ä»“åº“ï¼Œä»¥è·å¾—æœ€æ–°çš„æ›´æ–°ã€‚*\n- **QQäº¤æµç¾¤**ï¼š\n  - `698480528` [![ç‚¹å‡»åŠ ç¾¤](https://pub.idqqimg.com/wpa/images/group.png \"ç‚¹å‡»åŠ ç¾¤\")](//shang.qq.com/wpa/qunwpa?idkey=f949191c8f413a3ecc5fbce661e57d379740ba92172bd50b02d23a5ab36cc7d6)\n  - `62075835` [![ç‚¹å‡»åŠ ç¾¤](https://pub.idqqimg.com/wpa/images/group.png \"ç‚¹å‡»åŠ ç¾¤\")](//shang.qq.com/wpa/qunwpa?idkey=5230f8da0693a812811e21e19d5823ee802ee5d24def177663f42a32a9060e97)\n\næ–‡æ¡£ç›®å½•\n=================\n\n* [ç‰¹æ€§](#ç‰¹æ€§)\n* [Benchmark](#benchmark)\n* [è¦æ±‚](#è¦æ±‚)\n* [å®‰è£…](#å®‰è£…)\n* [è¿è¡Œ](#è¿è¡Œ)\n* [éƒ¨ç½²](#éƒ¨ç½²)\n* [ä¸Nginxé…åˆä½¿ç”¨ï¼ˆæ¨èï¼‰](#ä¸nginxé…åˆä½¿ç”¨æ¨è)\n* [ä¸Apacheé…åˆä½¿ç”¨](#ä¸apacheé…åˆä½¿ç”¨)\n* [å¯ç”¨WebSocketæœåŠ¡å™¨](#å¯ç”¨websocketæœåŠ¡å™¨)\n* [ç›‘å¬äº‹ä»¶](#ç›‘å¬äº‹ä»¶)\n    * [ç³»ç»Ÿäº‹ä»¶](#ç³»ç»Ÿäº‹ä»¶)\n    * [è‡ªå®šä¹‰çš„å¼‚æ­¥äº‹ä»¶](#è‡ªå®šä¹‰çš„å¼‚æ­¥äº‹ä»¶)\n* [å¼‚æ­¥çš„ä»»åŠ¡é˜Ÿåˆ—](#å¼‚æ­¥çš„ä»»åŠ¡é˜Ÿåˆ—)\n* [æ¯«ç§’çº§å®šæ—¶ä»»åŠ¡](#æ¯«ç§’çº§å®šæ—¶ä»»åŠ¡)\n* [ä¿®æ”¹ä»£ç åè‡ªåŠ¨Reload](#ä¿®æ”¹ä»£ç åè‡ªåŠ¨reload)\n* [åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨SwooleServerå®ä¾‹](#åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨swooleserverå®ä¾‹)\n* [ä½¿ç”¨SwooleTable](#ä½¿ç”¨swooletable)\n* [å¤šç«¯å£æ··åˆåè®®](#å¤šç«¯å£æ··åˆåè®®)\n* [åç¨‹](#åç¨‹)\n* [è‡ªå®šä¹‰è¿›ç¨‹](#è‡ªå®šä¹‰è¿›ç¨‹)\n* [å¸¸ç”¨ç»„ä»¶](#å¸¸ç”¨ç»„ä»¶)\n    * [Apollo](#apollo)\n    * [Prometheus](#prometheus)\n* [å…¶ä»–ç‰¹æ€§](#å…¶ä»–ç‰¹æ€§)\n    * [é…ç½®Swooleäº‹ä»¶](#é…ç½®Swooleäº‹ä»¶)\n    * [Serverless](#serverless)\n* [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)\n* [ç”¨æˆ·ä¸æ¡ˆä¾‹](#ç”¨æˆ·ä¸æ¡ˆä¾‹)\n* [å…¶ä»–é€‰æ‹©](#å…¶ä»–é€‰æ‹©)\n* [èµåŠ©](#èµåŠ©)\n    * [æ„Ÿè°¢](#æ„Ÿè°¢)\n* [License](#license)\n\n## ç‰¹æ€§\n\n- å†…ç½®Http/[WebSocket](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E5%90%AF%E7%94%A8websocket%E6%9C%8D%E5%8A%A1%E5%99%A8)æœåŠ¡å™¨\n\n- [å¤šç«¯å£æ··åˆåè®®](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E5%A4%9A%E7%AB%AF%E5%8F%A3%E6%B7%B7%E5%90%88%E5%8D%8F%E8%AE%AE)\n\n- [è‡ªå®šä¹‰è¿›ç¨‹](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%9B%E7%A8%8B)\n\n- å¸¸é©»å†…å­˜\n\n- [å¼‚æ­¥çš„äº‹ä»¶ç›‘å¬](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BA%8B%E4%BB%B6)\n\n- [å¼‚æ­¥çš„ä»»åŠ¡é˜Ÿåˆ—](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E5%BC%82%E6%AD%A5%E7%9A%84%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97)\n\n- [æ¯«ç§’çº§å®šæ—¶ä»»åŠ¡](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E6%AF%AB%E7%A7%92%E7%BA%A7%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1)\n\n- [å¸¸ç”¨ç»„ä»¶](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6)\n\n- å¹³æ»‘Reload\n\n- [ä¿®æ”¹ä»£ç åè‡ªåŠ¨Reload](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E5%90%8E%E8%87%AA%E5%8A%A8reload)\n\n- åŒæ—¶æ”¯æŒLaravelä¸Lumenï¼Œå…¼å®¹ä¸»æµç‰ˆæœ¬\n\n- ç®€å•ï¼Œå¼€ç®±å³ç”¨\n\n## Benchmark\n\n- [Which is the fastest web framework?](https://github.com/the-benchmarker/web-frameworks)\n\n- [TechEmpower Framework Benchmarks](https://www.techempower.com/benchmarks/)\n\n## è¦æ±‚\n\n| ä¾èµ– | è¯´æ˜ |\n| -------- | -------- |\n| [PHP](https://www.php.net/) | `>=8.2` `æ¨è8.2` |\n| [Swoole](https://www.swoole.com/) | `>=5.0` `æ¨è5.1.1` |\n| [Laravel](https://laravel.com/)/[Lumen](https://lumen.laravel.com/) | `>=10` `æ¨è10` |\n\n## å®‰è£…\n\n1.é€šè¿‡[Composer](https://getcomposer.org/)å®‰è£…([packagist](https://packagist.org/packages/hhxsv5/laravel-s))ã€‚æœ‰å¯èƒ½æ‰¾ä¸åˆ°`3.0`ç‰ˆæœ¬ï¼Œè§£å†³æ–¹æ¡ˆç§»æ­¥[#81](https://github.com/hhxsv5/laravel-s/issues/81)ã€‚\n```bash\n# PHP >=8.2\ncomposer require \"hhxsv5/laravel-s:~3.8.0\"\n\n# PHP >=5.5.9,<=7.4.33\n# composer require \"hhxsv5/laravel-s:~3.7.0\"\n\n# ç¡®ä¿ä½ çš„composer.lockæ–‡ä»¶æ˜¯åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­\n```\n\n2.æ³¨å†ŒService Providerï¼ˆä»¥ä¸‹ä¸¤æ­¥äºŒé€‰ä¸€ï¼‰ã€‚\n\n- `Laravel`: ä¿®æ”¹æ–‡ä»¶`config/app.php`ï¼Œ`Laravel 5.5+æ”¯æŒåŒ…è‡ªåŠ¨å‘ç°ï¼Œä½ åº”è¯¥è·³è¿‡è¿™æ­¥`\n    ```php\n    'providers' => [\n        //...\n        Hhxsv5\\LaravelS\\Illuminate\\LaravelSServiceProvider::class,\n    ],\n    ```\n\n- `Lumen`: ä¿®æ”¹æ–‡ä»¶`bootstrap/app.php`\n    ```php\n    $app->register(Hhxsv5\\LaravelS\\Illuminate\\LaravelSServiceProvider::class);\n    ```\n\n3.å‘å¸ƒé…ç½®å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚\n> *æ¯æ¬¡å‡çº§LaravelSåï¼Œéœ€é‡æ–°publishï¼›ç‚¹å‡»[Release](https://github.com/hhxsv5/laravel-s/releases)å»äº†è§£å„ä¸ªç‰ˆæœ¬çš„å˜æ›´è®°å½•ã€‚*\n\n```bash\nphp artisan laravels publish\n# é…ç½®æ–‡ä»¶ï¼šconfig/laravels.php\n# äºŒè¿›åˆ¶æ–‡ä»¶ï¼šbin/laravels bin/fswatch bin/inotify\n```\n\n4.ä¿®æ”¹é…ç½®`config/laravels.php`ï¼šç›‘å¬çš„IPã€ç«¯å£ç­‰ï¼Œè¯·å‚è€ƒ[é…ç½®é¡¹](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/Settings-CN.md)ã€‚\n\n5.æ€§èƒ½è°ƒä¼˜\n\n- [è°ƒæ•´å†…æ ¸å‚æ•°](https://wiki.swoole.com/#/other/sysctl?id=%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0%e8%b0%83%e6%95%b4)\n\n- [Workeræ•°é‡](https://wiki.swoole.com/#/server/setting?id=worker_num)ï¼šLaravelS ä½¿ç”¨ Swoole çš„`åŒæ­¥IO`æ¨¡å¼ï¼Œ`worker_num`è®¾ç½®çš„è¶Šå¤§å¹¶å‘æ€§èƒ½è¶Šå¥½ï¼Œä½†ä¼šé€ æˆæ›´å¤šçš„å†…å­˜å ç”¨å’Œè¿›ç¨‹åˆ‡æ¢å¼€é”€ã€‚å¦‚æœ`1`ä¸ªè¯·æ±‚è€—æ—¶`100ms`ï¼Œä¸ºäº†æä¾›`1000QPS`çš„å¹¶å‘èƒ½åŠ›ï¼Œè‡³å°‘éœ€è¦é…ç½®`100`ä¸ªWorkerè¿›ç¨‹ï¼Œè®¡ç®—æ–¹æ³•ï¼šworker_num = 1000QPS/(1s/1ms) = 100ï¼Œæ•…éœ€è¿›è¡Œå¢é‡å‹æµ‹è®¡ç®—å‡ºæœ€ä½³çš„`worker_num`ã€‚\n\n- [Task Workeræ•°é‡](https://wiki.swoole.com/#/server/setting?id=task_worker_num)\n\n\n## è¿è¡Œ\n> `åœ¨è¿è¡Œä¹‹å‰ï¼Œè¯·å…ˆä»”ç»†é˜…è¯»ï¼š`[æ³¨æ„äº‹é¡¹](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9)(è¿™éå¸¸é‡è¦)ã€‚\n\n- æ“ä½œå‘½ä»¤ï¼š`php bin/laravels {start|stop|restart|reload|info|help}`ã€‚\n\n| å‘½ä»¤ | è¯´æ˜ |\n| --------- | --------- |\n| start | å¯åŠ¨LaravelSï¼Œå±•ç¤ºå·²å¯åŠ¨çš„è¿›ç¨‹åˆ—è¡¨ \"*ps -ef&#124;grep laravels*\" |\n| stop | åœæ­¢LaravelSï¼Œå¹¶è§¦å‘è‡ªå®šä¹‰è¿›ç¨‹çš„`onStop`æ–¹æ³• |\n| restart | é‡å¯LaravelSï¼šå…ˆå¹³æ»‘`Stop`ï¼Œç„¶åå†`Start`ï¼›åœ¨`Start`å®Œæˆä¹‹å‰ï¼ŒæœåŠ¡æ˜¯`ä¸å¯ç”¨çš„` |\n| reload | å¹³æ»‘é‡å¯æ‰€æœ‰Task/Worker/Timerè¿›ç¨‹(è¿™äº›è¿›ç¨‹å†…åŒ…å«äº†ä½ çš„ä¸šåŠ¡ä»£ç )ï¼Œå¹¶è§¦å‘è‡ªå®šä¹‰è¿›ç¨‹çš„`onReload`æ–¹æ³•ï¼Œä¸ä¼šé‡å¯Master/Mangerè¿›ç¨‹ï¼›ä¿®æ”¹`config/laravels.php`åï¼Œä½ `åªæœ‰`è°ƒç”¨`restart`æ¥å®Œæˆé‡å¯ |\n| info | æ˜¾ç¤ºç»„ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯ |\n| help | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |\n\n- å¯åŠ¨é€‰é¡¹ï¼Œé’ˆå¯¹`start`å’Œ`restart`å‘½ä»¤ã€‚\n\n| é€‰é¡¹ | è¯´æ˜ |\n| --------- | --------- |\n| -d&#124;--daemonize | ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œæ­¤é€‰é¡¹å°†è¦†ç›–`laravels.php`ä¸­`swoole.daemonize`è®¾ç½® |\n| -e&#124;--env | æŒ‡å®šè¿è¡Œçš„ç¯å¢ƒï¼Œå¦‚`--env=testing`å°†ä¼šä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶`.env.testing`ï¼Œè¿™ä¸ªç‰¹æ€§è¦æ±‚`Laravel 5.2+` |\n| -i&#124;--ignore | å¿½ç•¥æ£€æŸ¥Masterè¿›ç¨‹çš„PIDæ–‡ä»¶ |\n| -x&#124;--x-version | è®°å½•å½“å‰å·¥ç¨‹çš„ç‰ˆæœ¬å·(åˆ†æ”¯)ï¼Œä¿å­˜åœ¨`$_ENV`/`$_SERVER`ä¸­ï¼Œè®¿é—®æ–¹å¼ï¼š`$_ENV['X_VERSION']` `$_SERVER['X_VERSION']` `$request->server->get('X_VERSION')` |\n\n- `è¿è¡Œæ—¶`æ–‡ä»¶ï¼š`start`æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ`php artisan laravels config`å¹¶ç”Ÿæˆè¿™äº›æ–‡ä»¶ï¼Œå¼€å‘è€…ä¸€èˆ¬ä¸éœ€è¦å…³æ³¨å®ƒä»¬ï¼Œå»ºè®®å°†å®ƒä»¬åŠ åˆ°`.gitignore`ä¸­ã€‚\n\n| æ–‡ä»¶ | è¯´æ˜ |\n| --------- | --------- |\n| storage/laravels.conf | LaravelSçš„`è¿è¡Œæ—¶`é…ç½®æ–‡ä»¶ |\n| storage/laravels.pid | Masterè¿›ç¨‹çš„PIDæ–‡ä»¶ |\n| storage/laravels-timer-process.pid | å®šæ—¶å™¨Timerè¿›ç¨‹çš„PIDæ–‡ä»¶ |\n| storage/laravels-custom-processes.pid | æ‰€æœ‰è‡ªå®šä¹‰è¿›ç¨‹çš„PIDæ–‡ä»¶ |\n\n## éƒ¨ç½²\n> å»ºè®®é€šè¿‡[Supervisord](http://supervisord.org/)ç›‘ç®¡ä¸»è¿›ç¨‹ï¼Œå‰ææ˜¯ä¸èƒ½åŠ `-d`é€‰é¡¹å¹¶ä¸”è®¾ç½®`swoole.daemonize`ä¸º`false`ã€‚\n\n```\n[program:laravel-s-test]\ndirectory=/var/www/laravel-s-test\ncommand=/usr/local/bin/php bin/laravels start -i\nnumprocs=1\nautostart=true\nautorestart=true\nstartretries=3\nuser=www-data\nredirect_stderr=true\nstdout_logfile=/var/log/supervisor/%(program_name)s.log\n```\n\n## ä¸Nginxé…åˆä½¿ç”¨ï¼ˆæ¨èï¼‰\n> [ç¤ºä¾‹](https://github.com/hhxsv5/docker/blob/master/nginx/conf.d/laravels.conf)ã€‚\n\n```nginx\ngzip on;\ngzip_min_length 1024;\ngzip_comp_level 2;\ngzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml application/x-httpd-php image/jpeg image/gif image/png font/ttf font/otf image/svg+xml;\ngzip_vary on;\ngzip_disable \"msie6\";\nupstream swoole {\n    # é€šè¿‡ IP:Port è¿æ¥\n    server 127.0.0.1:5200 weight=5 max_fails=3 fail_timeout=30s;\n    # é€šè¿‡ UnixSocket Stream è¿æ¥ï¼Œå°è¯€çªï¼šå°†socketæ–‡ä»¶æ”¾åœ¨/dev/shmç›®å½•ä¸‹ï¼Œå¯è·å¾—æ›´å¥½çš„æ€§èƒ½\n    #server unix:/yourpath/laravel-s-test/storage/laravels.sock weight=5 max_fails=3 fail_timeout=30s;\n    #server 192.168.1.1:5200 weight=3 max_fails=3 fail_timeout=30s;\n    #server 192.168.1.2:5200 backup;\n    keepalive 16;\n}\nserver {\n    listen 80;\n    # åˆ«å¿˜äº†ç»‘Host\n    server_name laravels.com;\n    root /yourpath/laravel-s-test/public;\n    access_log /yourpath/log/nginx/$server_name.access.log  main;\n    autoindex off;\n    index index.html index.htm;\n    # Nginxå¤„ç†é™æ€èµ„æº(å»ºè®®å¼€å¯gzip)ï¼ŒLaravelSå¤„ç†åŠ¨æ€èµ„æºã€‚\n    location / {\n        try_files $uri @laravels;\n    }\n    # å½“è¯·æ±‚PHPæ–‡ä»¶æ—¶ç›´æ¥å“åº”404ï¼Œé˜²æ­¢æš´éœ²public/*.php\n    #location ~* \\.php$ {\n    #    return 404;\n    #}\n    location @laravels {\n        # proxy_connect_timeout 60s;\n        # proxy_send_timeout 60s;\n        # proxy_read_timeout 120s;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Real-PORT $remote_port;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header Scheme $scheme;\n        proxy_set_header Server-Protocol $server_protocol;\n        proxy_set_header Server-Name $server_name;\n        proxy_set_header Server-Addr $server_addr;\n        proxy_set_header Server-Port $server_port;\n        # â€œswooleâ€æ˜¯æŒ‡upstream\n        proxy_pass http://swoole;\n    }\n}\n```\n\n## ä¸Apacheé…åˆä½¿ç”¨\n\n```apache\nLoadModule proxy_module /yourpath/modules/mod_proxy.so\nLoadModule proxy_balancer_module /yourpath/modules/mod_proxy_balancer.so\nLoadModule lbmethod_byrequests_module /yourpath/modules/mod_lbmethod_byrequests.so\nLoadModule proxy_http_module /yourpath/modules/mod_proxy_http.so\nLoadModule slotmem_shm_module /yourpath/modules/mod_slotmem_shm.so\nLoadModule rewrite_module /yourpath/modules/mod_rewrite.so\nLoadModule remoteip_module /yourpath/modules/mod_remoteip.so\nLoadModule deflate_module /yourpath/modules/mod_deflate.so\n\n<IfModule deflate_module>\n    SetOutputFilter DEFLATE\n    DeflateCompressionLevel 2\n    AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml application/x-httpd-php image/jpeg image/gif image/png font/ttf font/otf image/svg+xml\n</IfModule>\n\n<VirtualHost *:80>\n    # åˆ«å¿˜äº†ç»‘Host\n    ServerName www.laravels.com\n    ServerAdmin hhxsv5@sina.com\n\n    DocumentRoot /yourpath/laravel-s-test/public;\n    DirectoryIndex index.html index.htm\n    <Directory \"/\">\n        AllowOverride None\n        Require all granted\n    </Directory>\n\n    RemoteIPHeader X-Forwarded-For\n\n    ProxyRequests Off\n    ProxyPreserveHost On\n    <Proxy balancer://laravels>  \n        BalancerMember http://192.168.1.1:5200 loadfactor=7\n        #BalancerMember http://192.168.1.2:5200 loadfactor=3\n        #BalancerMember http://192.168.1.3:5200 loadfactor=1 status=+H\n        ProxySet lbmethod=byrequests\n    </Proxy>\n    #ProxyPass / balancer://laravels/\n    #ProxyPassReverse / balancer://laravels/\n\n    # Apacheå¤„ç†é™æ€èµ„æºï¼ŒLaravelSå¤„ç†åŠ¨æ€èµ„æºã€‚\n    RewriteEngine On\n    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d\n    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f\n    RewriteRule ^/(.*)$ balancer://laravels%{REQUEST_URI} [P,L]\n\n    ErrorLog ${APACHE_LOG_DIR}/www.laravels.com.error.log\n    CustomLog ${APACHE_LOG_DIR}/www.laravels.com.access.log combined\n</VirtualHost>\n```\n## å¯ç”¨WebSocketæœåŠ¡å™¨\n> WebSocketæœåŠ¡å™¨ç›‘å¬çš„IPå’Œç«¯å£ä¸HttpæœåŠ¡å™¨ç›¸åŒã€‚\n\n1.åˆ›å»ºWebSocket Handlerç±»ï¼Œå¹¶å®ç°æ¥å£`WebSocketHandlerInterface`ã€‚startæ—¶ä¼šè‡ªåŠ¨å®ä¾‹åŒ–ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºå®ä¾‹ã€‚\n\n```php\nnamespace App\\Services;\nuse Hhxsv5\\LaravelS\\Swoole\\WebSocketHandlerInterface;\nuse Swoole\\Http\\Request;\nuse Swoole\\Http\\Response;\nuse Swoole\\WebSocket\\Frame;\nuse Swoole\\WebSocket\\Server;\n/**\n * @see https://wiki.swoole.com/#/start/start_ws_server\n */\nclass WebSocketService implements WebSocketHandlerInterface\n{\n    // å£°æ˜æ²¡æœ‰å‚æ•°çš„æ„é€ å‡½æ•°\n    public function __construct()\n    {\n    }\n    // public function onHandShake(Request $request, Response $response)\n    // {\n           // è‡ªå®šä¹‰æ¡æ‰‹ï¼šhttps://wiki.swoole.com/#/websocket_server?id=onhandshake\n           // æˆåŠŸæ¡æ‰‹ä¹‹åä¼šè‡ªåŠ¨è§¦å‘onOpenäº‹ä»¶\n    // }\n    public function onOpen(Server $server, Request $request)\n    {\n        // åœ¨è§¦å‘onOpenäº‹ä»¶ä¹‹å‰ï¼Œå»ºç«‹WebSocketçš„HTTPè¯·æ±‚å·²ç»ç»è¿‡äº†Laravelçš„è·¯ç”±ï¼Œ\n        // æ‰€ä»¥Laravelçš„Requestã€Authç­‰ä¿¡æ¯æ˜¯å¯è¯»çš„ï¼ŒSessionæ˜¯å¯è¯»å†™çš„ï¼Œä½†ä»…é™åœ¨onOpenäº‹ä»¶ä¸­ã€‚\n        // \\Log::info('New WebSocket connection', [$request->fd, request()->all(), session()->getId(), session('xxx'), session(['yyy' => time()])]);\n        // æ­¤å¤„æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«ä¸Šå±‚æ•è·å¹¶è®°å½•åˆ°Swooleæ—¥å¿—ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨try/catch\n        $server->push($request->fd, 'Welcome to LaravelS');\n    }\n    public function onMessage(Server $server, Frame $frame)\n    {\n        // \\Log::info('Received message', [$frame->fd, $frame->data, $frame->opcode, $frame->finish]);\n        // æ­¤å¤„æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«ä¸Šå±‚æ•è·å¹¶è®°å½•åˆ°Swooleæ—¥å¿—ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨try/catch\n        $server->push($frame->fd, date('Y-m-d H:i:s'));\n    }\n    public function onClose(Server $server, $fd, $reactorId)\n    {\n        // æ­¤å¤„æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«ä¸Šå±‚æ•è·å¹¶è®°å½•åˆ°Swooleæ—¥å¿—ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨try/catch\n    }\n}\n```\n\n2.æ›´æ”¹é…ç½®`config/laravels.php`ã€‚\n\n```php\n// ...\n'websocket'      => [\n    'enable'  => true, // æ³¨æ„ï¼šè®¾ç½®enableä¸ºtrue\n    'handler' => \\App\\Services\\WebSocketService::class,\n],\n'swoole'         => [\n    //...\n    // dispatch_modeåªèƒ½è®¾ç½®ä¸º2ã€4ã€5ï¼Œhttps://wiki.swoole.com/#/server/setting?id=dispatch_mode\n    'dispatch_mode' => 2,\n    //...\n],\n// ...\n```\n\n3.ä½¿ç”¨`SwooleTable`ç»‘å®šFDä¸UserIdï¼Œå¯é€‰çš„ï¼Œ[Swoole Tableç¤ºä¾‹](#ä½¿ç”¨swooletable)ã€‚ä¹Ÿå¯ä»¥ç”¨å…¶ä»–å…¨å±€å­˜å‚¨æœåŠ¡ï¼Œä¾‹å¦‚Redis/Memcached/MySQLï¼Œä½†éœ€è¦æ³¨æ„å¤šä¸ª`Swoole Server`å®ä¾‹æ—¶FDå¯èƒ½å†²çªã€‚\n\n4.ä¸Nginxé…åˆä½¿ç”¨ï¼ˆæ¨èï¼‰\n> å‚è€ƒ [WebSocketä»£ç†](http://nginx.org/en/docs/http/websocket.html)\n\n```nginx\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\nupstream swoole {\n    # é€šè¿‡ IP:Port è¿æ¥\n    server 127.0.0.1:5200 weight=5 max_fails=3 fail_timeout=30s;\n    # é€šè¿‡ UnixSocket Stream è¿æ¥ï¼Œå°è¯€çªï¼šå°†socketæ–‡ä»¶æ”¾åœ¨/dev/shmç›®å½•ä¸‹ï¼Œå¯è·å¾—æ›´å¥½çš„æ€§èƒ½\n    #server unix:/yourpath/laravel-s-test/storage/laravels.sock weight=5 max_fails=3 fail_timeout=30s;\n    #server 192.168.1.1:5200 weight=3 max_fails=3 fail_timeout=30s;\n    #server 192.168.1.2:5200 backup;\n    keepalive 16;\n}\nserver {\n    listen 80;\n    # åˆ«å¿˜äº†ç»‘Host\n    server_name laravels.com;\n    root /yourpath/laravel-s-test/public;\n    access_log /yourpath/log/nginx/$server_name.access.log  main;\n    autoindex off;\n    index index.html index.htm;\n    # Nginxå¤„ç†é™æ€èµ„æº(å»ºè®®å¼€å¯gzip)ï¼ŒLaravelSå¤„ç†åŠ¨æ€èµ„æºã€‚\n    location / {\n        try_files $uri @laravels;\n    }\n    # å½“è¯·æ±‚PHPæ–‡ä»¶æ—¶ç›´æ¥å“åº”404ï¼Œé˜²æ­¢æš´éœ²public/*.php\n    #location ~* \\.php$ {\n    #    return 404;\n    #}\n    # Httpå’ŒWebSocketå…±å­˜ï¼ŒNginxé€šè¿‡locationåŒºåˆ†\n    # !!! WebSocketè¿æ¥æ—¶è·¯å¾„ä¸º/ws\n    # Javascript: var ws = new WebSocket(\"ws://laravels.com/ws\");\n    location =/ws {\n        # proxy_connect_timeout 60s;\n        # proxy_send_timeout 60s;\n        # proxy_read_timeoutï¼šå¦‚æœ60ç§’å†…è¢«ä»£ç†çš„æœåŠ¡å™¨æ²¡æœ‰å“åº”æ•°æ®ç»™Nginxï¼Œé‚£ä¹ˆNginxä¼šå…³é—­å½“å‰è¿æ¥ï¼›åŒæ—¶ï¼ŒSwooleçš„å¿ƒè·³è®¾ç½®ä¹Ÿä¼šå½±å“è¿æ¥çš„å…³é—­\n        # proxy_read_timeout 60s;\n        proxy_http_version 1.1;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Real-PORT $remote_port;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header Scheme $scheme;\n        proxy_set_header Server-Protocol $server_protocol;\n        proxy_set_header Server-Name $server_name;\n        proxy_set_header Server-Addr $server_addr;\n        proxy_set_header Server-Port $server_port;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n        proxy_pass http://swoole;\n    }\n    location @laravels {\n        # proxy_connect_timeout 60s;\n        # proxy_send_timeout 60s;\n        # proxy_read_timeout 60s;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Real-PORT $remote_port;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header Scheme $scheme;\n        proxy_set_header Server-Protocol $server_protocol;\n        proxy_set_header Server-Name $server_name;\n        proxy_set_header Server-Addr $server_addr;\n        proxy_set_header Server-Port $server_port;\n        proxy_pass http://swoole;\n    }\n}\n```\n\n5.å¿ƒè·³é…ç½®\n\n- Swooleçš„å¿ƒè·³é…ç½®\n\n    ```php\n    // config/laravels.php\n    'swoole' => [\n        //...\n        // è¡¨ç¤ºæ¯60ç§’éå†ä¸€æ¬¡ï¼Œä¸€ä¸ªè¿æ¥å¦‚æœ600ç§’å†…æœªå‘æœåŠ¡å™¨å‘é€ä»»ä½•æ•°æ®ï¼Œæ­¤è¿æ¥å°†è¢«å¼ºåˆ¶å…³é—­\n        'heartbeat_idle_time'      => 600,\n        'heartbeat_check_interval' => 60,\n        //...\n    ],\n    ```\n\n- Nginxè¯»å–ä»£ç†æœåŠ¡å™¨è¶…æ—¶çš„é…ç½®\n\n    ```nginx\n    # å¦‚æœ60ç§’å†…è¢«ä»£ç†çš„æœåŠ¡å™¨æ²¡æœ‰å“åº”æ•°æ®ç»™Nginxï¼Œé‚£ä¹ˆNginxä¼šå…³é—­å½“å‰è¿æ¥\n    proxy_read_timeout 60s;\n    ```\n\n6.åœ¨æ§åˆ¶å™¨ä¸­æ¨é€æ•°æ®\n\n```php\nnamespace App\\Http\\Controllers;\nclass TestController extends Controller\n{\n    public function push()\n    {\n        $fd = 1; // Find fd by userId from a map [userId=>fd].\n        /**@var \\Swoole\\WebSocket\\Server $swoole */\n        $swoole = app('swoole');\n        $success = $swoole->push($fd, 'Push data to fd#1 in Controller');\n        var_dump($success);\n    }\n}\n```\n\n## ç›‘å¬äº‹ä»¶\n\n### ç³»ç»Ÿäº‹ä»¶\n> é€šå¸¸ï¼Œä½ å¯ä»¥åœ¨è¿™äº›äº‹ä»¶ä¸­é‡ç½®æˆ–é”€æ¯ä¸€äº›å…¨å±€æˆ–é™æ€çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å½“å‰çš„è¯·æ±‚å’Œå“åº”ã€‚\n\n- `laravels.received_request` å°†`Swoole\\Http\\Request`è½¬æˆ`Illuminate\\Http\\Request`åï¼Œåœ¨Laravelå†…æ ¸å¤„ç†è¯·æ±‚å‰ã€‚\n\n    ```php\n    // ä¿®æ”¹`app/Providers/EventServiceProvider.php`, æ·»åŠ ä¸‹é¢ç›‘å¬ä»£ç åˆ°bootæ–¹æ³•ä¸­\n    // å¦‚æœå˜é‡$eventsä¸å­˜åœ¨ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡Facadeè°ƒç”¨\\Event::listen()ã€‚\n    $events->listen('laravels.received_request', function (\\Illuminate\\Http\\Request $req, $app) {\n        $req->query->set('get_key', 'hhxsv5');// ä¿®æ”¹querystring\n        $req->request->set('post_key', 'hhxsv5'); // ä¿®æ”¹post body\n    });\n    ```\n\n- `laravels.generated_response` åœ¨Laravelå†…æ ¸å¤„ç†å®Œè¯·æ±‚åï¼Œå°†`Illuminate\\Http\\Response`è½¬æˆ`Swoole\\Http\\Response`ä¹‹å‰(ä¸‹ä¸€æ­¥å°†å“åº”ç»™å®¢æˆ·ç«¯)ã€‚\n\n    ```php\n    // ä¿®æ”¹`app/Providers/EventServiceProvider.php`, æ·»åŠ ä¸‹é¢ç›‘å¬ä»£ç åˆ°bootæ–¹æ³•ä¸­\n    // å¦‚æœå˜é‡$eventsä¸å­˜åœ¨ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡Facadeè°ƒç”¨\\Event::listen()ã€‚\n    $events->listen('laravels.generated_response', function (\\Illuminate\\Http\\Request $req, \\Symfony\\Component\\HttpFoundation\\Response $rsp, $app) {\n        $rsp->headers->set('header-key', 'hhxsv5');// ä¿®æ”¹header\n    });\n    ```\n\n### è‡ªå®šä¹‰çš„å¼‚æ­¥äº‹ä»¶\n> æ­¤ç‰¹æ€§ä¾èµ–`Swoole`çš„`AsyncTask`ï¼Œå¿…é¡»å…ˆè®¾ç½®`config/laravels.php`çš„`swoole.task_worker_num`ã€‚å¼‚æ­¥äº‹ä»¶çš„å¤„ç†èƒ½åŠ›å—Taskè¿›ç¨‹æ•°å½±å“ï¼Œéœ€åˆç†è®¾ç½®[task_worker_num](https://wiki.swoole.com/#/server/setting?id=task_worker_num)ã€‚\n\n1.åˆ›å»ºäº‹ä»¶ç±»ã€‚\n\n```php\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Event;\nclass TestEvent extends Event\n{\n    protected $listeners = [\n        // ç›‘å¬å™¨åˆ—è¡¨\n        TestListener1::class,\n        // TestListener2::class,\n    ];\n    private $data;\n    public function __construct($data)\n    {\n        $this->data = $data;\n    }\n    public function getData()\n    {\n        return $this->data;\n    }\n}\n```\n\n2.åˆ›å»ºç›‘å¬å™¨ç±»ã€‚\n\n```php\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Event;\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Listener;\nclass TestListener1 extends Listener\n{\n    public function handle(Event $event)\n    {\n        \\Log::info(__CLASS__ . ':handle start', [$event->getData()]);\n        sleep(2);// æ¨¡æ‹Ÿä¸€äº›æ…¢é€Ÿçš„äº‹ä»¶å¤„ç†\n        // ç›‘å¬å™¨ä¸­ä¹Ÿå¯ä»¥æŠ•é€’Taskï¼Œä½†ä¸æ”¯æŒTaskçš„finish()å›è°ƒã€‚\n        // æ³¨æ„ï¼šconfig/laravels.phpä¸­ä¿®æ”¹é…ç½®task_ipc_modeä¸º1æˆ–2ï¼Œå‚è€ƒ https://wiki.swoole.com/#/server/setting?id=task_ipc_mode\n        $ret = Task::deliver(new TestTask('task data'));\n        var_dump($ret);\n        // æ­¤å¤„æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«ä¸Šå±‚æ•è·å¹¶è®°å½•åˆ°Swooleæ—¥å¿—ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨try/catch\n        // return false; // åœæ­¢å°†äº‹ä»¶ä¼ æ’­åˆ°åé¢çš„ç›‘å¬å™¨\n    }\n}\n```\n\n3.è§¦å‘äº‹ä»¶ã€‚\n\n```php\n// å®ä¾‹åŒ–TestEventå¹¶é€šè¿‡fireè§¦å‘ï¼Œæ­¤æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œè§¦å‘åç«‹å³è¿”å›ï¼Œç”±Taskè¿›ç¨‹ç»§ç»­å¤„ç†ç›‘å¬å™¨ä¸­çš„handleé€»è¾‘\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Event;\n$event = new TestEvent('event data');\n// $event->delay(10); // å»¶è¿Ÿ10ç§’è§¦å‘\n// $event->setTries(3); // å‡ºç°å¼‚å¸¸æ—¶ï¼Œç´¯è®¡å°è¯•3æ¬¡\n$success = Event::fire($event);\nvar_dump($success);// åˆ¤æ–­æ˜¯å¦è§¦å‘æˆåŠŸ\n```\n\n## å¼‚æ­¥çš„ä»»åŠ¡é˜Ÿåˆ—\n> æ­¤ç‰¹æ€§ä¾èµ–`Swoole`çš„`AsyncTask`ï¼Œå¿…é¡»å…ˆè®¾ç½®`config/laravels.php`çš„`swoole.task_worker_num`ã€‚å¼‚æ­¥ä»»åŠ¡çš„å¤„ç†èƒ½åŠ›å—Taskè¿›ç¨‹æ•°å½±å“ï¼Œéœ€åˆç†è®¾ç½®[task_worker_num](https://wiki.swoole.com/#/server/setting?id=task_worker_num)ã€‚\n\n1.åˆ›å»ºä»»åŠ¡ç±»ã€‚\n\n```php\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\nclass TestTask extends Task\n{\n    private $data;\n    private $result;\n    public function __construct($data)\n    {\n        $this->data = $data;\n    }\n    // å¤„ç†ä»»åŠ¡çš„é€»è¾‘ï¼Œè¿è¡Œåœ¨Taskè¿›ç¨‹ä¸­ï¼Œä¸èƒ½æŠ•é€’ä»»åŠ¡\n    public function handle()\n    {\n        \\Log::info(__CLASS__ . ':handle start', [$this->data]);\n        sleep(2);// æ¨¡æ‹Ÿä¸€äº›æ…¢é€Ÿçš„äº‹ä»¶å¤„ç†\n        // æ­¤å¤„æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«ä¸Šå±‚æ•è·å¹¶è®°å½•åˆ°Swooleæ—¥å¿—ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨try/catch\n        $this->result = 'the result of ' . $this->data;\n    }\n    // å¯é€‰çš„ï¼Œå®Œæˆäº‹ä»¶ï¼Œä»»åŠ¡å¤„ç†å®Œåçš„é€»è¾‘ï¼Œè¿è¡Œåœ¨Workerè¿›ç¨‹ä¸­ï¼Œå¯ä»¥æŠ•é€’ä»»åŠ¡\n    public function finish()\n    {\n        \\Log::info(__CLASS__ . ':finish start', [$this->result]);\n        Task::deliver(new TestTask2('task2')); // æŠ•é€’å…¶ä»–ä»»åŠ¡\n    }\n}\n```\n\n2.æŠ•é€’ä»»åŠ¡ã€‚\n\n```php\n// å®ä¾‹åŒ–TestTaskå¹¶é€šè¿‡deliveræŠ•é€’ï¼Œæ­¤æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼ŒæŠ•é€’åç«‹å³è¿”å›ï¼Œç”±Taskè¿›ç¨‹ç»§ç»­å¤„ç†TestTaskä¸­çš„handleé€»è¾‘\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\n$task = new TestTask('task data');\n// $task->delay(3); // å»¶è¿Ÿ3ç§’æŠ•é€’ä»»åŠ¡\n// $task->setTries(3); // å‡ºç°å¼‚å¸¸æ—¶ï¼Œç´¯è®¡å°è¯•3æ¬¡\n$ret = Task::deliver($task);\nvar_dump($ret);// åˆ¤æ–­æ˜¯å¦æŠ•é€’æˆåŠŸ\n```\n\n## æ¯«ç§’çº§å®šæ—¶ä»»åŠ¡\n> åŸºäº[Swooleçš„æ¯«ç§’å®šæ—¶å™¨](https://wiki.swoole.com/#/timer)ï¼Œå°è£…çš„å®šæ—¶ä»»åŠ¡ï¼Œå–ä»£`Linux`çš„`Crontab`ã€‚\n\n1.åˆ›å»ºå®šæ—¶ä»»åŠ¡ç±»ã€‚\n```php\nnamespace App\\Jobs\\Timer;\nuse App\\Tasks\\TestTask;\nuse Swoole\\Coroutine;\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\nuse Hhxsv5\\LaravelS\\Swoole\\Timer\\CronJob;\nclass TestCronJob extends CronJob\n{\n    protected $i = 0;\n    // !!! å®šæ—¶ä»»åŠ¡çš„`interval`å’Œ`isImmediate`æœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼šä¸€æ˜¯é‡è½½å¯¹åº”çš„æ–¹æ³•ï¼ŒäºŒæ˜¯æ³¨å†Œå®šæ—¶ä»»åŠ¡æ—¶ä¼ å…¥å‚æ•°ã€‚\n    // --- é‡è½½å¯¹åº”çš„æ–¹æ³•æ¥è¿”å›é…ç½®ï¼šå¼€å§‹\n    public function interval()\n    {\n        return 1000;// æ¯1ç§’è¿è¡Œä¸€æ¬¡\n    }\n    public function isImmediate()\n    {\n        return false;// æ˜¯å¦ç«‹å³æ‰§è¡Œç¬¬ä¸€æ¬¡ï¼Œfalseåˆ™ç­‰å¾…é—´éš”æ—¶é—´åæ‰§è¡Œç¬¬ä¸€æ¬¡\n    }\n    // --- é‡è½½å¯¹åº”çš„æ–¹æ³•æ¥è¿”å›é…ç½®ï¼šç»“æŸ\n    public function run()\n    {\n        \\Log::info(__METHOD__, ['start', $this->i, microtime(true)]);\n        // do something\n        // sleep(1); // Swoole < 2.1\n        Coroutine::sleep(1); // Swoole>=2.1 run()æ–¹æ³•å·²è‡ªåŠ¨åˆ›å»ºäº†åç¨‹ã€‚\n        $this->i++;\n        \\Log::info(__METHOD__, ['end', $this->i, microtime(true)]);\n\n        if ($this->i >= 10) { // è¿è¡Œ10æ¬¡åä¸å†æ‰§è¡Œ\n            \\Log::info(__METHOD__, ['stop', $this->i, microtime(true)]);\n            $this->stop(); // ç»ˆæ­¢æ­¤å®šæ—¶ä»»åŠ¡ï¼Œä½†restart/reloadåä¼šå†æ¬¡è¿è¡Œ\n            // CronJobä¸­ä¹Ÿå¯ä»¥æŠ•é€’Taskï¼Œä½†ä¸æ”¯æŒTaskçš„finish()å›è°ƒã€‚\n            // æ³¨æ„ï¼šä¿®æ”¹config/laravels.phpï¼Œé…ç½®task_ipc_modeä¸º1æˆ–2ï¼Œå‚è€ƒ https://wiki.swoole.com/#/server/setting?id=task_ipc_mode\n            $ret = Task::deliver(new TestTask('task data'));\n            var_dump($ret);\n        }\n        // æ­¤å¤„æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«ä¸Šå±‚æ•è·å¹¶è®°å½•åˆ°Swooleæ—¥å¿—ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨try/catch\n    }\n}\n```\n\n2.æ³¨å†Œå®šæ—¶ä»»åŠ¡ç±»ã€‚\n\n```php\n// åœ¨\"config/laravels.php\"æ³¨å†Œå®šæ—¶ä»»åŠ¡ç±»\n[\n    // ...\n    'timer'          => [\n        'enable' => true, // å¯ç”¨Timer\n        'jobs'   => [ // æ³¨å†Œçš„å®šæ—¶ä»»åŠ¡ç±»åˆ—è¡¨\n            // å¯ç”¨LaravelScheduleJobæ¥æ‰§è¡Œ`php artisan schedule:run`ï¼Œæ¯åˆ†é’Ÿä¸€æ¬¡ï¼Œæ›¿ä»£Linux Crontab\n            // \\Hhxsv5\\LaravelS\\Illuminate\\LaravelScheduleJob::class,\n            // ä¸¤ç§é…ç½®å‚æ•°çš„æ–¹å¼ï¼š\n            // [\\App\\Jobs\\Timer\\TestCronJob::class, [1000, true]], // æ³¨å†Œæ—¶ä¼ å…¥å‚æ•°\n            \\App\\Jobs\\Timer\\TestCronJob::class, // é‡è½½å¯¹åº”çš„æ–¹æ³•æ¥è¿”å›å‚æ•°\n        ],\n        'max_wait_time' => 5, // Reloadæ—¶æœ€å¤§ç­‰å¾…æ—¶é—´\n        // æ‰“å¼€å…¨å±€å®šæ—¶å™¨å¼€å…³ï¼šå½“å¤šå®ä¾‹éƒ¨ç½²æ—¶ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹è¿è¡Œå®šæ—¶ä»»åŠ¡ï¼Œæ­¤åŠŸèƒ½ä¾èµ– Redisï¼Œå…·ä½“è¯·çœ‹ https://laravel.com/docs/7.x/redis\n        'global_lock'     => false,\n        'global_lock_key' => config('app.name', 'Laravel'),\n    ],\n    // ...\n];\n```\n\n3.æ³¨æ„åœ¨æ„å»ºæœåŠ¡å™¨é›†ç¾¤æ—¶ï¼Œä¼šå¯åŠ¨å¤šä¸ª`å®šæ—¶å™¨`ï¼Œè¦ç¡®ä¿åªå¯åŠ¨ä¸€ä¸ªå®šæœŸå™¨ï¼Œé¿å…é‡å¤æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚\n\n4.LaravelS `v3.4.0`å¼€å§‹æ”¯æŒçƒ­é‡å¯[Reload]`å®šæ—¶å™¨`è¿›ç¨‹ï¼ŒLaravelS åœ¨æ”¶åˆ°`SIGUSR1`ä¿¡å·åä¼šç­‰å¾…`max_wait_time`(é»˜è®¤5)ç§’å†ç»“æŸè¿›ç¨‹ï¼Œç„¶å`Manager`è¿›ç¨‹ä¼šé‡æ–°æ‹‰èµ·`å®šæ—¶å™¨`è¿›ç¨‹ã€‚\n\n5.å¦‚æœä½ ä»…éœ€è¦ç”¨åˆ°`åˆ†é’Ÿçº§`çš„å®šæ—¶ä»»åŠ¡ï¼Œå»ºè®®å¯ç”¨`Hhxsv5\\LaravelS\\Illuminate\\LaravelScheduleJob`æ¥æ›¿ä»£Linux Crontabï¼Œè¿™æ ·å°±å¯ä»¥æ²¿ç”¨[Laravelä»»åŠ¡è°ƒåº¦](https://learnku.com/docs/laravel/7.x/scheduling/7492)çš„ç¼–ç ä¹ æƒ¯ï¼Œé…ç½®`Kernel`å³å¯ã€‚\n\n```php\n// app/Console/Kernel.php\nprotected function schedule(Schedule $schedule)\n{\n    // runInBackground()æ–¹æ³•ä¼šæ–°å¯å­è¿›ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šå½±å“å…¶ä»–ä»»åŠ¡çš„æ‰§è¡Œæ—¶æœº\n    $schedule->command(TestCommand::class)->runInBackground()->everyMinute();\n}\n```\n\n## ä¿®æ”¹ä»£ç åè‡ªåŠ¨Reload\n\n- åŸºäº`inotify`ï¼Œä»…æ”¯æŒLinuxã€‚\n\n    1.å®‰è£…[inotify](http://pecl.php.net/package/inotify)æ‰©å±•ã€‚\n\n    2.å¼€å¯[é…ç½®é¡¹](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/Settings-CN.md#inotify_reloadenable)ã€‚\n\n    3.æ³¨æ„ï¼š`inotify`åªæœ‰åœ¨`Linux`å†…ä¿®æ”¹æ–‡ä»¶æ‰èƒ½æ”¶åˆ°æ–‡ä»¶å˜æ›´äº‹ä»¶ï¼Œå»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆDockerï¼Œ[Vagrantè§£å†³æ–¹æ¡ˆ](https://github.com/mhallin/vagrant-notify-forwarder)ã€‚\n\n- åŸºäº`fswatch`ï¼Œæ”¯æŒOS Xã€Linuxã€Windowsã€‚\n\n    1.å®‰è£…[fswatch](https://github.com/emcrisostomo/fswatch)ã€‚\n\n    2.åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤ã€‚\n\n    ```bash\n    # ç›‘å¬å½“å‰ç›®å½•\n    ./bin/fswatch\n    # ç›‘å¬appç›®å½•\n    ./bin/fswatch ./app\n    ```\n\n- åŸºäº`inotifywait`ï¼Œä»…æ”¯æŒLinuxã€‚\n\n    1.å®‰è£…[inotify-tools](https://github.com/rvoicilas/inotify-tools)ã€‚\n\n    2.åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤ã€‚\n\n    ```bash\n    # ç›‘å¬å½“å‰ç›®å½•\n    ./bin/inotify\n    # ç›‘å¬appç›®å½•\n    ./bin/inotify ./app\n    ```\n\n- å½“ä»¥ä¸Šæ–¹æ³•éƒ½ä¸è¡Œæ—¶ï¼Œç»ˆæè§£å†³æ–¹æ¡ˆï¼šé…ç½®`max_request=1,worker_num=1`ï¼Œè¿™æ ·`Worker`è¿›ç¨‹å¤„ç†å®Œä¸€ä¸ªè¯·æ±‚å°±ä¼šé‡å¯ï¼Œè¿™ç§æ–¹æ³•çš„æ€§èƒ½éå¸¸å·®ï¼Œ`æ•…ä»…é™åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨`ã€‚\n\n## åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨`SwooleServer`å®ä¾‹\n\n```php\n/**\n * å¦‚æœå¯ç”¨WebSocket serverï¼Œ$swooleæ˜¯`Swoole\\WebSocket\\Server`çš„å®ä¾‹ï¼Œå¦åˆ™æ˜¯æ˜¯`Swoole\\Http\\Server`çš„å®ä¾‹\n * @var \\Swoole\\WebSocket\\Server|\\Swoole\\Http\\Server $swoole\n */\n$swoole = app('swoole');\nvar_dump($swoole->stats());\n$swoole->push($fd, 'Push WebSocket message');\n```\n\n## ä½¿ç”¨`SwooleTable`\n\n1.å®šä¹‰Tableï¼Œæ”¯æŒå®šä¹‰å¤šä¸ªTableã€‚\n> Swooleå¯åŠ¨ä¹‹å‰ä¼šåˆ›å»ºå®šä¹‰çš„æ‰€æœ‰Tableã€‚\n\n```php\n// åœ¨\"config/laravels.php\"é…ç½®\n[\n    // ...\n    'swoole_tables'  => [\n        // åœºæ™¯ï¼šWebSocketä¸­UserIdä¸FDç»‘å®š\n        'ws' => [// Keyä¸ºTableåç§°ï¼Œä½¿ç”¨æ—¶ä¼šè‡ªåŠ¨æ·»åŠ Tableåç¼€ï¼Œé¿å…é‡åã€‚è¿™é‡Œå®šä¹‰åä¸ºwsTableçš„Table\n            'size'   => 102400,//Tableçš„æœ€å¤§è¡Œæ•°\n            'column' => [// Tableçš„åˆ—å®šä¹‰\n                ['name' => 'value', 'type' => \\Swoole\\Table::TYPE_INT, 'size' => 8],\n            ],\n        ],\n        //...ç»§ç»­å®šä¹‰å…¶ä»–Table\n    ],\n    // ...\n];\n```\n\n2.è®¿é—®Tableï¼šæ‰€æœ‰çš„Tableå®ä¾‹å‡ç»‘å®šåœ¨`SwooleServer`ä¸Šï¼Œé€šè¿‡`app('swoole')->xxxTable`è®¿é—®ã€‚\n\n```php\nnamespace App\\Services;\nuse Hhxsv5\\LaravelS\\Swoole\\WebSocketHandlerInterface;\nuse Swoole\\Http\\Request;\nuse Swoole\\WebSocket\\Frame;\nuse Swoole\\WebSocket\\Server;\nclass WebSocketService implements WebSocketHandlerInterface\n{\n    /**@var \\Swoole\\Table $wsTable */\n    private $wsTable;\n    public function __construct()\n    {\n        $this->wsTable = app('swoole')->wsTable;\n    }\n    // åœºæ™¯ï¼šWebSocketä¸­UserIdä¸FDç»‘å®š\n    public function onOpen(Server $server, Request $request)\n    {\n        // var_dump(app('swoole') === $server);// åŒä¸€å®ä¾‹\n        /**\n         * è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·\n         * æ­¤ç‰¹æ€§è¦æ±‚å»ºç«‹WebSocketè¿æ¥çš„è·¯å¾„è¦ç»è¿‡Authenticateä¹‹ç±»çš„ä¸­é—´ä»¶ã€‚\n         * ä¾‹å¦‚ï¼š\n         * æµè§ˆå™¨ç«¯ï¼švar ws = new WebSocket(\"ws://127.0.0.1:5200/ws\");\n         * é‚£ä¹ˆLaravelä¸­/wsè·¯ç”±å°±éœ€è¦åŠ ä¸Šç±»ä¼¼Authenticateçš„ä¸­é—´ä»¶ã€‚\n         * Route::get('/ws', function () {\n         *     // å“åº”çŠ¶æ€ç 200çš„ä»»æ„å†…å®¹\n         *     return 'websocket';\n         * })->middleware(['auth']);\n         */\n        // $user = Auth::user();\n        // $userId = $user ? $user->id : 0; // 0 è¡¨ç¤ºæœªç™»å½•çš„è®¿å®¢ç”¨æˆ·\n        $userId = mt_rand(1000, 10000);\n        // if (!$userId) {\n        //     // æœªç™»å½•ç”¨æˆ·ç›´æ¥æ–­å¼€è¿æ¥\n        //     $server->disconnect($request->fd);\n        //     return;\n        // }\n        $this->wsTable->set('uid:' . $userId, ['value' => $request->fd]);// ç»‘å®šuidåˆ°fdçš„æ˜ å°„\n        $this->wsTable->set('fd:' . $request->fd, ['value' => $userId]);// ç»‘å®šfdåˆ°uidçš„æ˜ å°„\n        $server->push($request->fd, \"Welcome to LaravelS #{$request->fd}\");\n    }\n    public function onMessage(Server $server, Frame $frame)\n    {\n        // å¹¿æ’­\n        foreach ($this->wsTable as $key => $row) {\n            if (strpos($key, 'uid:') === 0 && $server->isEstablished($row['value'])) {\n                $content = sprintf('Broadcast: new message \"%s\" from #%d', $frame->data, $frame->fd);\n                $server->push($row['value'], $content);\n            }\n        }\n    }\n    public function onClose(Server $server, $fd, $reactorId)\n    {\n        $uid = $this->wsTable->get('fd:' . $fd);\n        if ($uid !== false) {\n            $this->wsTable->del('uid:' . $uid['value']); // è§£ç»‘uidæ˜ å°„\n        }\n        $this->wsTable->del('fd:' . $fd);// è§£ç»‘fdæ˜ å°„\n        $server->push($fd, \"Goodbye #{$fd}\");\n    }\n}\n```\n\n## å¤šç«¯å£æ··åˆåè®®\n\n> æ›´å¤šçš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ[Swooleå¢åŠ ç›‘å¬çš„ç«¯å£](https://wiki.swoole.com/#/server/methods?id=addlistener)ä¸[å¤šç«¯å£æ··åˆåè®®](https://wiki.swoole.com/#/server/port)\n\nä¸ºäº†ä½¿æˆ‘ä»¬çš„ä¸»æœåŠ¡å™¨èƒ½æ”¯æŒé™¤`HTTP`å’Œ`WebSocket`å¤–çš„æ›´å¤šåè®®ï¼Œæˆ‘ä»¬å¼•å…¥äº†`Swoole`çš„`å¤šç«¯å£æ··åˆåè®®`ç‰¹æ€§ï¼Œåœ¨LaravelSä¸­ç§°ä¸º`Socket`ã€‚ç°åœ¨ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨Laravelä¸Šæ„å»º`TCP/UDP`åº”ç”¨ã€‚\n\n1. åˆ›å»º`Socket`å¤„ç†ç±»ï¼Œç»§æ‰¿`Hhxsv5\\LaravelS\\Swoole\\Socket\\{TcpSocket|UdpSocket|Http|WebSocket}`\n\n    ```php\n    namespace App\\Sockets;\n    use Hhxsv5\\LaravelS\\Swoole\\Socket\\TcpSocket;\n    use Swoole\\Server;\n    class TestTcpSocket extends TcpSocket\n    {\n        public function onConnect(Server $server, $fd, $reactorId)\n        {\n            \\Log::info('New TCP connection', [$fd]);\n            $server->send($fd, 'Welcome to LaravelS.');\n        }\n        public function onReceive(Server $server, $fd, $reactorId, $data)\n        {\n            \\Log::info('Received data', [$fd, $data]);\n            $server->send($fd, 'LaravelS: ' . $data);\n            if ($data === \"quit\\r\\n\") {\n                $server->send($fd, 'LaravelS: bye' . PHP_EOL);\n                $server->close($fd);\n            }\n        }\n        public function onClose(Server $server, $fd, $reactorId)\n        {\n            \\Log::info('Close TCP connection', [$fd]);\n            $server->send($fd, 'Goodbye');\n        }\n    }\n    ```\n\n    è¿™äº›è¿æ¥å’Œä¸»æœåŠ¡å™¨ä¸Šçš„HTTP/WebSocketè¿æ¥å…±äº«`Worker`è¿›ç¨‹ï¼Œå› æ­¤å¯ä»¥åœ¨è¿™äº›äº‹ä»¶å›è°ƒä¸­ä½¿ç”¨LaravelSæä¾›çš„`å¼‚æ­¥ä»»åŠ¡æŠ•é€’`ã€`SwooleTable`ã€Laravelæä¾›çš„ç»„ä»¶å¦‚`DB`ã€`Eloquent`ç­‰ã€‚åŒæ—¶ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¯¥åè®®ç«¯å£çš„`Swoole\\Server\\Port`å¯¹è±¡ï¼Œåªéœ€è¦åƒå¦‚ä¸‹ä»£ç ä¸€æ ·è®¿é—®`Socket`ç±»çš„æˆå‘˜`swoolePort`å³å¯ã€‚\n\n    ```php\n    public function onReceive(Server $server, $fd, $reactorId, $data)\n    {\n        $port = $this->swoolePort; // è·å¾—`Swoole\\Server\\Port`å¯¹è±¡\n    }\n    ```\n\n    ```php\n    namespace App\\Http\\Controllers;\n    class TestController extends Controller\n    {\n        public function test()\n        {\n            /**@var \\Swoole\\Http\\Server|\\Swoole\\WebSocket\\Server $swoole */\n            $swoole = app('swoole');\n            // $swoole->portsï¼šéå†æ‰€æœ‰Portå¯¹è±¡ï¼Œhttps://wiki.swoole.com/#/server/properties?id=ports\n            $port = $swoole->ports[1]; // è·å¾—`Swoole\\Server\\Port`å¯¹è±¡ï¼Œ$port[0]æ˜¯ä¸»æœåŠ¡å™¨çš„ç«¯å£\n            foreach ($port->connections as $fd) { // éå†æ‰€æœ‰è¿æ¥\n                // $swoole->send($fd, 'Send tcp message');\n                // if($swoole->isEstablished($fd)) {\n                //     $swoole->push($fd, 'Send websocket message');\n                // }\n            }\n        }\n    }\n    ```\n\n2. æ³¨å†Œå¥—æ¥å­—ã€‚\n\n    ```php\n    // ä¿®æ”¹æ–‡ä»¶ config/laravels.php\n    // ...\n    'sockets' => [\n        [\n            'host'     => '127.0.0.1',\n            'port'     => 5291,\n            'type'     => SWOOLE_SOCK_TCP,// æ”¯æŒçš„åµŒå¥—å­—ç±»å‹ï¼šhttps://wiki.swoole.com/#/consts?id=socket-%e7%b1%bb%e5%9e%8b\n            'settings' => [// Swooleå¯ç”¨çš„é…ç½®é¡¹ï¼šhttps://wiki.swoole.com/#/server/port?id=%e5%8f%af%e9%80%89%e5%8f%82%e6%95%b0\n                'open_eof_check' => true,\n                'package_eof'    => \"\\r\\n\",\n            ],\n            'handler'  => \\App\\Sockets\\TestTcpSocket::class,\n            'enable'   => true, // æ˜¯å¦å¯ç”¨ï¼Œé»˜è®¤ä¸ºtrue\n        ],\n    ],\n    ```\n\n    å…³äºå¿ƒè·³é…ç½®ï¼Œåªèƒ½è®¾ç½®åœ¨`ä¸»æœåŠ¡å™¨`ä¸Šï¼Œä¸èƒ½é…ç½®åœ¨`å¥—æ¥å­—`ä¸Šï¼Œä½†`å¥—æ¥å­—`ä¼šç»§æ‰¿`ä¸»æœåŠ¡å™¨`çš„å¿ƒè·³é…ç½®ã€‚\n\n    å¯¹äºTCPåè®®ï¼Œ`dispatch_mode`é€‰é¡¹è®¾ä¸º`1/3`æ—¶ï¼Œåº•å±‚ä¼šå±è”½`onConnect`/`onClose`äº‹ä»¶ï¼ŒåŸå› æ˜¯è¿™ä¸¤ç§æ¨¡å¼ä¸‹æ— æ³•ä¿è¯`onConnect`/`onClose`/`onReceive`çš„é¡ºåºã€‚å¦‚æœéœ€è¦ç”¨åˆ°è¿™ä¸¤ä¸ªäº‹ä»¶ï¼Œè¯·å°†`dispatch_mode`æ”¹ä¸º`2/4/5`ï¼Œ[å‚è€ƒ](https://wiki.swoole.com/#/server/setting?id=dispatch_mode)ã€‚\n\n    ```php\n    'swoole' => [\n        //...\n        'dispatch_mode' => 2,\n        //...\n    ];\n    ```\n\n3. æµ‹è¯•ã€‚\n\n- TCPï¼š`telnet 127.0.0.1 5291`\n\n- UDPï¼šLinuxä¸‹ `echo \"Hello LaravelS\" > /dev/udp/127.0.0.1/5292`\n\n4. å…¶ä»–åè®®çš„æ³¨å†Œç¤ºä¾‹ã€‚\n\n    - UDP\n    ```php\n    'sockets' => [\n        [\n            'host'     => '0.0.0.0',\n            'port'     => 5292,\n            'type'     => SWOOLE_SOCK_UDP,\n            'settings' => [\n                'open_eof_check' => true,\n                'package_eof'    => \"\\r\\n\",\n            ],\n            'handler'  => \\App\\Sockets\\TestUdpSocket::class,\n        ],\n    ],\n    ```\n\n    - Http\n    ```php\n    'sockets' => [\n        [\n            'host'     => '0.0.0.0',\n            'port'     => 5293,\n            'type'     => SWOOLE_SOCK_TCP,\n            'settings' => [\n                'open_http_protocol' => true,\n            ],\n            'handler'  => \\App\\Sockets\\TestHttp::class,\n        ],\n    ],\n    ```\n\n    - WebSocketï¼šä¸»æœåŠ¡å™¨å¿…é¡»`å¼€å¯WebSocket`ï¼Œå³éœ€è¦å°†`websocket.enable`ç½®ä¸º`true`ã€‚\n    ```php\n    'sockets' => [\n        [\n            'host'     => '0.0.0.0',\n            'port'     => 5294,\n            'type'     => SWOOLE_SOCK_TCP,\n            'settings' => [\n                'open_http_protocol'      => true,\n                'open_websocket_protocol' => true,\n            ],\n            'handler'  => \\App\\Sockets\\TestWebSocket::class,\n        ],\n    ],\n    ```\n\n\n## åç¨‹\n\n> [SwooleåŸå§‹æ–‡æ¡£](https://wiki.swoole.com/#/start/coroutine)\n\n- è­¦å‘Šï¼šåç¨‹ä¸‹ä»£ç æ‰§è¡Œé¡ºåºæ˜¯ä¹±åºçš„ï¼Œè¯·æ±‚çº§çš„æ•°æ®åº”è¯¥ä»¥åç¨‹IDéš”ç¦»ï¼Œä½†Laravel/Lumenä¸­å­˜åœ¨å¾ˆå¤šå•ä¾‹ã€é™æ€å±æ€§ï¼Œä¸åŒè¯·æ±‚é—´çš„æ•°æ®ä¼šç›¸äº’å½±å“ï¼Œè¿™æ˜¯`ä¸å®‰å…¨`çš„ã€‚æ¯”å¦‚æ•°æ®åº“è¿æ¥å°±æ˜¯å•ä¾‹ï¼ŒåŒä¸€ä¸ªæ•°æ®åº“è¿æ¥å…±äº«åŒä¸€ä¸ªPDOèµ„æºï¼Œè¿™åœ¨åŒæ­¥é˜»å¡æ¨¡å¼ä¸‹æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†åœ¨å¼‚æ­¥åç¨‹ä¸‹æ˜¯ä¸è¡Œçš„ï¼Œæ¯æ¬¡æŸ¥è¯¢éœ€è¦åˆ›å»ºä¸åŒçš„è¿æ¥ï¼Œç»´æŠ¤ä¸åŒçš„IOçŠ¶æ€ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°è¿æ¥æ± ã€‚\n\n- `ä¸è¦`ä½¿ç”¨åç¨‹ï¼Œä»…`è‡ªå®šä¹‰è¿›ç¨‹`ä¸­å¯ä½¿ç”¨åç¨‹ã€‚\n\n## è‡ªå®šä¹‰è¿›ç¨‹\n\n> æ”¯æŒå¼€å‘è€…åˆ›å»ºä¸€äº›ç‰¹æ®Šçš„å·¥ä½œè¿›ç¨‹ï¼Œç”¨äºç›‘æ§ã€ä¸ŠæŠ¥æˆ–è€…å…¶ä»–ç‰¹æ®Šçš„ä»»åŠ¡ï¼Œå‚è€ƒ[addProcess](https://wiki.swoole.com/#/server/methods?id=addprocess)ã€‚\n\n1. åˆ›å»ºProccessç±»ï¼Œå®ç°CustomProcessInterfaceæ¥å£ã€‚\n\n    ```php\n    namespace App\\Processes;\n    use App\\Tasks\\TestTask;\n    use Hhxsv5\\LaravelS\\Swoole\\Process\\CustomProcessInterface;\n    use Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\n    use Swoole\\Coroutine;\n    use Swoole\\Http\\Server;\n    use Swoole\\Process;\n    class TestProcess implements CustomProcessInterface\n    {\n        /**\n         * @var bool é€€å‡ºæ ‡è®°ï¼Œç”¨äºReloadæ›´æ–°\n         */\n        private static $quit = false;\n\n        public static function callback(Server $swoole, Process $process)\n        {\n            // è¿›ç¨‹è¿è¡Œçš„ä»£ç ï¼Œä¸èƒ½é€€å‡ºï¼Œä¸€æ—¦é€€å‡ºManagerè¿›ç¨‹ä¼šè‡ªåŠ¨å†æ¬¡åˆ›å»ºè¯¥è¿›ç¨‹ã€‚\n            while (!self::$quit) {\n                \\Log::info('Test process: running');\n                // sleep(1); // Swoole < 2.1\n                Coroutine::sleep(1); // Swoole>=2.1 å·²è‡ªåŠ¨ä¸ºcallback()æ–¹æ³•åˆ›å»ºäº†åç¨‹å¹¶å¯ç”¨äº†åç¨‹Runtimeï¼Œæ³¨æ„æ‰€ä½¿ç”¨çš„ç»„ä»¶ä¸åç¨‹å…¼å®¹æ€§ï¼Œä¸å…¼å®¹æ—¶å¯ä»…å¼€å¯éƒ¨åˆ†åç¨‹ï¼Œå¦‚ï¼š\\Swoole\\Runtime::enableCoroutine(SWOOLE_HOOK_TCP | SWOOLE_HOOK_SLEEP | SWOOLE_HOOK_FILE);\n                // è‡ªå®šä¹‰è¿›ç¨‹ä¸­ä¹Ÿå¯ä»¥æŠ•é€’Taskï¼Œä½†ä¸æ”¯æŒTaskçš„finish()å›è°ƒã€‚\n                // æ³¨æ„ï¼šä¿®æ”¹config/laravels.phpï¼Œé…ç½®task_ipc_modeä¸º1æˆ–2ï¼Œå‚è€ƒ https://wiki.swoole.com/#/server/setting?id=task_ipc_mode\n                $ret = Task::deliver(new TestTask('task data'));\n                var_dump($ret);\n                // ä¸Šå±‚ä¼šæ•è·callbackä¸­æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶è®°å½•åˆ°Swooleæ—¥å¿—ï¼Œç„¶åæ­¤è¿›ç¨‹ä¼šé€€å‡ºï¼Œ3ç§’åManagerè¿›ç¨‹ä¼šé‡æ–°åˆ›å»ºè¿›ç¨‹ï¼Œæ‰€ä»¥éœ€è¦å¼€å‘è€…è‡ªè¡Œtry/catchæ•è·å¼‚å¸¸ï¼Œé¿å…é¢‘ç¹åˆ›å»ºè¿›ç¨‹ã€‚\n                // throw new \\Exception('an exception');\n            }\n        }\n        // è¦æ±‚ï¼šLaravelS >= v3.4.0 å¹¶ä¸” callback() å¿…é¡»æ˜¯å¼‚æ­¥éé˜»å¡ç¨‹åºã€‚\n        public static function onReload(Server $swoole, Process $process)\n        {\n            // Stop the process...\n            // Then end process\n            \\Log::info('Test process: reloading');\n            self::$quit = true;\n            // $process->exit(0); // å¼ºåˆ¶é€€å‡ºè¿›ç¨‹\n        }\n        // è¦æ±‚ï¼šLaravelS >= v3.7.4 å¹¶ä¸” callback() å¿…é¡»æ˜¯å¼‚æ­¥éé˜»å¡ç¨‹åºã€‚\n        public static function onStop(Server $swoole, Process $process)\n        {\n            // Stop the process...\n            // Then end process\n            \\Log::info('Test process: stopping');\n            self::$quit = true;\n            // $process->exit(0); // å¼ºåˆ¶é€€å‡ºè¿›ç¨‹\n        }\n    }\n    ```\n\n2. æ³¨å†ŒTestProcessã€‚\n\n    ```php\n    // ä¿®æ”¹æ–‡ä»¶ config/laravels.php\n    // ...\n    'processes' => [\n        'test' => [ // Keyä¸ºè¿›ç¨‹å\n            'class'    => \\App\\Processes\\TestProcess::class,\n            'redirect' => false, // æ˜¯å¦é‡å®šå‘è¾“å…¥è¾“å‡º\n            'pipe'     => 0,     // ç®¡é“ç±»å‹ï¼š0ä¸åˆ›å»ºç®¡é“ï¼Œ1åˆ›å»ºSOCK_STREAMç±»å‹ç®¡é“ï¼Œ2åˆ›å»ºSOCK_DGRAMç±»å‹ç®¡é“\n            'enable'   => true,  // æ˜¯å¦å¯ç”¨ï¼Œé»˜è®¤true\n            //'num'    => 3,  // åˆ›å»ºå¤šä¸ªè¿›ç¨‹å®ä¾‹ï¼Œé»˜è®¤ä¸º1\n            //'queue'    => [ // å¯ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡ï¼Œé…ç½®ç©ºæ•°ç»„è¡¨ç¤ºä½¿ç”¨é»˜è®¤å‚æ•°\n            //    'msg_key'  => 0,    // æ¶ˆæ¯é˜Ÿåˆ—çš„KEYï¼Œé»˜è®¤ä¼šä½¿ç”¨ftok(__FILE__, 1)\n            //    'mode'     => 2,    // é€šä¿¡æ¨¡å¼ï¼Œé»˜è®¤ä¸º2ï¼Œè¡¨ç¤ºäº‰æŠ¢æ¨¡å¼\n            //    'capacity' => 8192, // å•ä¸ªæ¶ˆæ¯é•¿åº¦ï¼Œé•¿åº¦å—é™äºæ“ä½œç³»ç»Ÿå†…æ ¸å‚æ•°çš„é™åˆ¶ï¼Œé»˜è®¤ä¸º8192ï¼Œæœ€å¤§ä¸è¶…è¿‡65536\n            //],\n            //'restart_interval' => 5, // è¿›ç¨‹å¼‚å¸¸é€€å‡ºåéœ€ç­‰å¾…å¤šå°‘ç§’å†é‡å¯ï¼Œé»˜è®¤5ç§’\n        ],\n    ],\n    ```\n\n3. æ³¨æ„ï¼šcallback()æ–¹æ³•ä¸èƒ½é€€å‡ºï¼Œå¦‚æœé€€å‡ºï¼ŒManagerè¿›ç¨‹å°†ä¼šé‡æ–°åˆ›å»ºè¿›ç¨‹ã€‚\n\n4. ç¤ºä¾‹ï¼šå‘è‡ªå®šä¹‰è¿›ç¨‹ä¸­å†™æ•°æ®ã€‚\n\n    ```php\n    // config/laravels.php\n    'processes' => [\n        'test' => [\n            'class'    => \\App\\Processes\\TestProcess::class,\n            'redirect' => false,\n            'pipe'     => 1,\n        ],\n    ],\n    ```\n\n    ```php\n    // app/Processes/TestProcess.php\n    public static function callback(Server $swoole, Process $process)\n    {\n        while ($data = $process->read()) {\n            \\Log::info('TestProcess: read data', [$data]);\n            $process->write('TestProcess: ' . $data);\n        }\n    }\n    ```\n\n    ```php\n    // app/Http/Controllers/TestController.php\n    public function testProcessWrite()\n    {\n        /**@var \\Swoole\\Process[] $process */\n        $customProcesses = \\Hhxsv5\\LaravelS\\LaravelS::getCustomProcesses();\n        $process = $customProcesses['test'];\n        $process->write('TestController: write data' . time());\n        var_dump($process->read());\n    }\n    ```\n\n## å¸¸ç”¨ç»„ä»¶\n\n### Apollo\n> å¯åŠ¨`LaravelS`æ—¶ä¼šè·å–`Apollo`é…ç½®å¹¶å†™å…¥åˆ°`.env`æ–‡ä»¶ï¼ŒåŒæ—¶ä¼šå¯åŠ¨è‡ªå®šä¹‰è¿›ç¨‹`apollo`ç”¨äºç›‘å¬é…ç½®å˜æ›´ï¼Œå½“é…ç½®å‘ç”Ÿå˜æ›´æ—¶è‡ªåŠ¨`reload`ã€‚\n\n1. å¯ç”¨Apolloç»„ä»¶ï¼šå¯åŠ¨å‚æ•°åŠ ä¸Š`--enable-apollo`ä»¥åŠApolloçš„é…ç½®å‚æ•°ã€‚\n    \n    ```bash\n    php bin/laravels start --enable-apollo --apollo-server=http://127.0.0.1:8080 --apollo-app-id=LARAVEL-S-TEST\n    ```\n\n2. é…ç½®çƒ­æ›´æ–°ï¼ˆå¯é€‰çš„ï¼‰ã€‚\n\n    ```php\n    // ä¿®æ”¹æ–‡ä»¶ config/laravels.php\n    'processes' => Hhxsv5\\LaravelS\\Components\\Apollo\\Process::getDefinition(),\n    ```\n\n    ```php\n    // å½“å­˜åœ¨å…¶ä»–è‡ªå®šä¹‰è¿›ç¨‹é…ç½®æ—¶\n    'processes' => [\n        'test' => [\n            'class'    => \\App\\Processes\\TestProcess::class,\n            'redirect' => false,\n            'pipe'     => 1,\n        ],\n        // ...\n    ] + Hhxsv5\\LaravelS\\Components\\Apollo\\Process::getDefinition(),\n    ```\n\n3. å¯ç”¨çš„å‚æ•°åˆ—è¡¨ã€‚\n\n| å‚æ•°å | æè¿° | é»˜è®¤å€¼ | ç¤ºä¾‹ |\n| -------- | -------- | -------- | -------- |\n| apollo-server | ApolloæœåŠ¡å™¨URL | - | --apollo-server=http://127.0.0.1:8080 |\n| apollo-app-id | Apolloåº”ç”¨ID | - | --apollo-app-id=LARAVEL-S-TEST |\n| apollo-namespaces | APPæ‰€å±çš„å‘½åç©ºé—´ï¼Œå¯æŒ‡å®šå¤šä¸ª | application | --apollo-namespaces=application --apollo-namespaces=env |\n| apollo-cluster | APPæ‰€å±çš„é›†ç¾¤ | default | --apollo-cluster=default |\n| apollo-client-ip | å½“å‰å®ä¾‹çš„IPï¼Œè¿˜å¯ç”¨äºç°åº¦å‘å¸ƒ | æœ¬æœºå†…ç½‘IP | --apollo-client-ip=10.2.1.83 |\n| apollo-pull-timeout | æ‹‰å–é…ç½®æ—¶çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ | 5 | --apollo-pull-timeout=5 |\n| apollo-backup-old-env | æ›´æ–°é…ç½®æ–‡ä»¶`.env`æ—¶æ˜¯å¦å¤‡ä»½è€çš„é…ç½®æ–‡ä»¶ | false | --apollo-backup-old-env |\n\n### Prometheus\n> æ”¯æŒPrometheusç›‘æ§ä¸å‘Šè­¦ï¼ŒGrafanaå¯è§†åŒ–æŸ¥çœ‹ç›‘æ§æŒ‡æ ‡ã€‚è¯·å‚è€ƒ[Docker Compose](https://github.com/hhxsv5/docker)å®ŒæˆPrometheusä¸Grafanaçš„ç¯å¢ƒæ­å»ºã€‚\n\n1. ä¾èµ–[APCu >= 5.0.0](https://pecl.php.net/package/apcu)æ‰©å±•ï¼Œè¯·å…ˆå®‰è£…å®ƒ `pecl install apcu`ã€‚\n\n2. æ‹·è´é…ç½®æ–‡ä»¶`prometheus.php`åˆ°ä½ çš„å·¥ç¨‹`config`ç›®å½•ã€‚è§†æƒ…å†µä¿®æ”¹é…ç½®ã€‚\n    ```bash\n    # é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤\n    cp vendor/hhxsv5/laravel-s/config/prometheus.php config/\n    ```\n    å¦‚æœæ˜¯`Lumen`å·¥ç¨‹ï¼Œè¿˜éœ€è¦åœ¨`bootstrap/app.php`ä¸­æ‰‹åŠ¨åŠ è½½é…ç½®`$app->configure('prometheus');`ã€‚\n\n3. é…ç½®`å…¨å±€`ä¸­é—´ä»¶ï¼š`Hhxsv5\\LaravelS\\Components\\Prometheus\\RequestMiddleware::class`ã€‚ä¸ºäº†å°½å¯èƒ½ç²¾ç¡®åœ°ç»Ÿè®¡è¯·æ±‚è€—æ—¶ï¼Œ`RequestMiddleware`å¿…é¡»ä½œä¸º`ç¬¬ä¸€ä¸ª`å…¨å±€ä¸­é—´ä»¶ï¼Œéœ€è¦æ”¾åœ¨å…¶ä»–ä¸­é—´ä»¶çš„å‰é¢ã€‚\n\n4. æ³¨å†Œ ServiceProviderï¼š`Hhxsv5\\LaravelS\\Components\\Prometheus\\ServiceProvider::class`ã€‚\n\n5. åœ¨`config/laravels.php`ä¸­é…ç½® CollectorProcess è¿›ç¨‹ï¼Œç”¨äºå®šæ—¶é‡‡é›† Swoole Worker/Task/Timer è¿›ç¨‹çš„æŒ‡æ ‡ã€‚\n    ```php\n    'processes' => Hhxsv5\\LaravelS\\Components\\Prometheus\\CollectorProcess::getDefinition(),\n    ```\n\n6. åˆ›å»ºè·¯ç”±ï¼Œè¾“å‡ºç›‘æ§æŒ‡æ ‡æ•°æ®ã€‚\n    ```php\n    use Hhxsv5\\LaravelS\\Components\\Prometheus\\Exporter;\n\n    Route::get('/actuator/prometheus', function () {\n        $result = app(Exporter::class)->render();\n        return response($result, 200, ['Content-Type' => Exporter::REDNER_MIME_TYPE]);\n    });\n    ```\n\n7. å®ŒæˆPrometheusçš„é…ç½®ï¼Œå¯åŠ¨Prometheusã€‚\n    ```yml\n    global:\n      scrape_interval: 5s\n      scrape_timeout: 5s\n      evaluation_interval: 30s\n    scrape_configs:\n    - job_name: laravel-s-test\n      honor_timestamps: true\n      metrics_path: /actuator/prometheus\n      scheme: http\n      follow_redirects: true\n      static_configs:\n      - targets:\n        - 127.0.0.1:5200 # The ip and port of the monitored service\n    # Dynamically discovered using one of the supported service-discovery mechanisms\n    # https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config\n    # - job_name: laravels-eureka\n    #   honor_timestamps: true\n    #   scrape_interval: 5s\n    #   metrics_path: /actuator/prometheus\n    #   scheme: http\n    #   follow_redirects: true\n      # eureka_sd_configs:\n      # - server: http://127.0.0.1:8080/eureka\n      #   follow_redirects: true\n      #   refresh_interval: 5s\n    ```\n\n8. å¯åŠ¨Grafanaï¼Œç„¶åå¯¼å…¥[panel json](https://github.com/hhxsv5/laravel-s/tree/PHP-8.x/grafana-dashboard.json)ã€‚\n\n<img src=\"https://raw.githubusercontent.com/hhxsv5/laravel-s/PHP-8.x/grafana-dashboard.png\" height=\"800px\" alt=\"Grafana Dashboard\">\n\n## å…¶ä»–ç‰¹æ€§\n\n### é…ç½®Swooleäº‹ä»¶\n\næ”¯æŒçš„äº‹ä»¶åˆ—è¡¨ï¼š\n\n| äº‹ä»¶ | éœ€å®ç°çš„æ¥å£ | å‘ç”Ÿæ—¶æœº |\n| -------- | -------- | -------- |\n| ServerStart | Hhxsv5\\LaravelS\\Swoole\\Events\\ServerStartInterface | å‘ç”Ÿåœ¨Masterè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œ`æ­¤äº‹ä»¶ä¸­ä¸åº”å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œåªèƒ½åšä¸€äº›åˆå§‹åŒ–çš„ç®€å•å·¥ä½œ` |\n| ServerStop | Hhxsv5\\LaravelS\\Swoole\\Events\\ServerStopInterface | å‘ç”Ÿåœ¨Serveræ­£å¸¸é€€å‡ºæ—¶ï¼Œ`æ­¤äº‹ä»¶ä¸­ä¸èƒ½ä½¿ç”¨å¼‚æ­¥æˆ–åç¨‹ç›¸å…³çš„API` |\n| WorkerStart | Hhxsv5\\LaravelS\\Swoole\\Events\\WorkerStartInterface | å‘ç”Ÿåœ¨Worker/Taskè¿›ç¨‹å¯åŠ¨å®Œæˆå |\n| WorkerStop | Hhxsv5\\LaravelS\\Swoole\\Events\\WorkerStopInterface | å‘ç”Ÿåœ¨Worker/Taskè¿›ç¨‹æ­£å¸¸é€€å‡ºå |\n| WorkerError | Hhxsv5\\LaravelS\\Swoole\\Events\\WorkerErrorInterface | å‘ç”Ÿåœ¨Worker/Taskè¿›ç¨‹å‘ç”Ÿå¼‚å¸¸æˆ–è‡´å‘½é”™è¯¯æ—¶ |\n\n1.åˆ›å»ºäº‹ä»¶å¤„ç†ç±»ï¼Œå®ç°ç›¸åº”çš„æ¥å£ã€‚\n```php\nnamespace App\\Events;\nuse Hhxsv5\\LaravelS\\Swoole\\Events\\ServerStartInterface;\nuse Swoole\\Atomic;\nuse Swoole\\Http\\Server;\nclass ServerStartEvent implements ServerStartInterface\n{\n    public function __construct()\n    {\n    }\n    public function handle(Server $server)\n    {\n        // åˆå§‹åŒ–ä¸€ä¸ªå…¨å±€è®¡æ•°å™¨(è·¨è¿›ç¨‹çš„å¯ç”¨)\n        $server->atomicCount = new Atomic(2233);\n\n        // æ§åˆ¶å™¨ä¸­è°ƒç”¨ï¼šapp('swoole')->atomicCount->get();\n    }\n}\n```\n\n```php\nnamespace App\\Events;\nuse Hhxsv5\\LaravelS\\Swoole\\Events\\WorkerStartInterface;\nuse Swoole\\Http\\Server;\nclass WorkerStartEvent implements WorkerStartInterface\n{\n    public function __construct()\n    {\n    }\n    public function handle(Server $server, $workerId)\n    {\n        // åˆå§‹åŒ–ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± å¯¹è±¡\n        // DatabaseConnectionPool::init();\n    }\n}\n```\n\n2.é…ç½®ã€‚\n```php\n// ä¿®æ”¹æ–‡ä»¶ config/laravels.php\n'event_handlers' => [\n    'ServerStart' => [\\App\\Events\\ServerStartEvent::class], // æŒ‰æ•°ç»„é¡ºåºè§¦å‘äº‹ä»¶\n    'WorkerStart' => [\\App\\Events\\WorkerStartEvent::class],\n],\n```\n\n### Serverless\n\n#### é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—\n> [å‡½æ•°è®¡ç®—å®˜æ–¹æ–‡æ¡£](https://help.aliyun.com/product/50980.html)ã€‚\n\n1.ä¿®æ”¹`bootstrap/app.php`ï¼Œè®¾ç½®storageç›®å½•ã€‚å› ä¸ºé¡¹ç›®ç›®å½•åªè¯»ï¼Œ`/tmp`ç›®å½•æ‰å¯è¯»å†™ã€‚\n\n```php\n$app->useStoragePath(env('APP_STORAGE_PATH', '/tmp/storage'));\n```\n\n2.åˆ›å»ºShellè„šæœ¬`laravels_bootstrap`ï¼Œå¹¶èµ‹äºˆ`å¯æ‰§è¡Œæƒé™`ã€‚\n\n```bash\n#!/usr/bin/env bash\nset +e\n\n# åˆ›å»ºstorageç›¸å…³ç›®å½•\nmkdir -p /tmp/storage/app/public\nmkdir -p /tmp/storage/framework/cache\nmkdir -p /tmp/storage/framework/sessions\nmkdir -p /tmp/storage/framework/testing\nmkdir -p /tmp/storage/framework/views\nmkdir -p /tmp/storage/logs\n\n# è®¾ç½®ç¯å¢ƒå˜é‡APP_STORAGE_PATHï¼Œè¯·ç¡®ä¿ä¸.envçš„APP_STORAGE_PATHä¸€æ ·\nexport APP_STORAGE_PATH=/tmp/storage\n\n# Start LaravelS\nphp bin/laravels start\n```\n\n3.é…ç½®`template.xml`ã€‚\n\n```xml\nROSTemplateFormatVersion: '2015-09-01'\nTransform: 'Aliyun::Serverless-2018-04-03'\nResources:\n  laravel-s-demo:\n    Type: 'Aliyun::Serverless::Service'\n    Properties:\n      Description: 'LaravelS Demo for Serverless'\n    fc-laravel-s:\n      Type: 'Aliyun::Serverless::Function'\n      Properties:\n        Handler: laravels.handler\n        Runtime: custom\n        MemorySize: 512\n        Timeout: 30\n        CodeUri: ./\n        InstanceConcurrency: 10\n        EnvironmentVariables:\n          BOOTSTRAP_FILE: laravels_bootstrap\n\n```\n\n## æ³¨æ„äº‹é¡¹\n\n### å•ä¾‹é—®é¢˜\n\n- ä¼ ç»ŸFPMä¸‹ï¼Œå•ä¾‹æ¨¡å¼çš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä»…åœ¨æ¯æ¬¡è¯·æ±‚ä¸­ï¼Œè¯·æ±‚å¼€å§‹=>å®ä¾‹åŒ–å•ä¾‹=>è¯·æ±‚ç»“æŸå=>å•ä¾‹å¯¹è±¡èµ„æºå›æ”¶ã€‚\n\n- Swoole Serverä¸‹ï¼Œæ‰€æœ‰å•ä¾‹å¯¹è±¡ä¼šå¸¸é©»äºå†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™å•ä¾‹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸FPMä¸åŒï¼Œè¯·æ±‚å¼€å§‹=>å®ä¾‹åŒ–å•ä¾‹=>è¯·æ±‚ç»“æŸ=>å•ä¾‹å¯¹è±¡ä¾æ—§ä¿ç•™ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±ç»´æŠ¤å•ä¾‹çš„çŠ¶æ€ã€‚\n\n- å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼š\n\n    1. å†™ä¸€ä¸ª`XxxCleaner`æ¸…ç†å™¨ç±»æ¥æ¸…ç†å•ä¾‹å¯¹è±¡çŠ¶æ€ï¼Œæ­¤ç±»éœ€å®ç°æ¥å£`Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\CleanerInterface`ï¼Œç„¶åæ³¨å†Œåˆ°`laravels.php`çš„`cleaners`ä¸­ã€‚\n    \n    2. ç”¨ä¸€ä¸ª`ä¸­é—´ä»¶`æ¥`é‡ç½®`å•ä¾‹å¯¹è±¡çš„çŠ¶æ€ã€‚\n\n    3. å¦‚æœæ˜¯ä»¥`ServiceProvider`æ³¨å†Œçš„å•ä¾‹å¯¹è±¡ï¼Œå¯æ·»åŠ è¯¥`ServiceProvider`åˆ°`laravels.php`çš„`register_providers`ä¸­ï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚ä¼šé‡æ–°æ³¨å†Œè¯¥`ServiceProvider`ï¼Œé‡æ–°å®ä¾‹åŒ–å•ä¾‹å¯¹è±¡ï¼Œ[å‚è€ƒ](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/Settings-CN.md#register_providers)ã€‚\n\n### æ¸…ç†å™¨\n> [è®¾ç½®æ¸…ç†å™¨](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/Settings-CN.md#cleaners)ã€‚\n\n### å¸¸è§é—®é¢˜\n> [å¸¸è§é—®é¢˜](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/KnownIssues-CN.md)ï¼šä¸€æ½å­çš„å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚\n\n### è°ƒè¯•æ–¹å¼\n\n- è®°å½•æ—¥å¿—ï¼›å¦‚æƒ³è¦åœ¨æ§åˆ¶å°è¾“å‡ºï¼Œå¯ä½¿ç”¨`stderr`ï¼ŒLog::channel('stderr')->debug('debug message')ã€‚\n\n- [Laravel Dump Server](https://github.com/beyondcode/laravel-dump-server)ï¼ˆLaravel 5.7å·²é»˜è®¤é›†æˆï¼‰ã€‚\n\n### è¯»å–è¯·æ±‚\nåº”é€šè¿‡`Illuminate\\Http\\Request`å¯¹è±¡æ¥è¯»å–è¯·æ±‚ä¿¡æ¯ï¼Œ$_ENVæ˜¯å¯è¯»å–çš„ï¼Œ$_SERVERæ˜¯éƒ¨åˆ†å¯è¯»çš„ï¼Œ`ä¸èƒ½ä½¿ç”¨`$_GETã€$_POSTã€$_FILESã€$_COOKIEã€$_REQUESTã€$_SESSIONã€$GLOBALSã€‚\n\n```php\npublic function form(\\Illuminate\\Http\\Request $request)\n{\n    $name = $request->input('name');\n    $all = $request->all();\n    $sessionId = $request->cookie('sessionId');\n    $photo = $request->file('photo');\n    // è°ƒç”¨getContent()æ¥è·å–åŸå§‹çš„POST bodyï¼Œè€Œä¸èƒ½ç”¨file_get_contents('php://input')\n    $rawContent = $request->getContent();\n    //...\n}\n```\n\n### è¾“å‡ºå“åº”\næ¨èé€šè¿‡è¿”å›`Illuminate\\Http\\Response`å¯¹è±¡æ¥å“åº”è¯·æ±‚ï¼Œå…¼å®¹echoã€vardump()ã€print_r()ï¼Œ`ä¸èƒ½ä½¿ç”¨`å‡½æ•° dd()ã€exit()ã€die()ã€header()ã€setcookie()ã€http_response_code()ã€‚\n\n```php\npublic function json()\n{\n    return response()->json(['time' => time()])->header('header1', 'value1')->withCookie('c1', 'v1');\n}\n```\n\n### æŒä¹…è¿æ¥\n`å•ä¾‹çš„è¿æ¥`å°†è¢«å¸¸é©»å†…å­˜ï¼Œå»ºè®®å¼€å¯`æŒä¹…è¿æ¥`ï¼Œè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚\n1. æ•°æ®åº“è¿æ¥ï¼Œè¿æ¥æ–­å¼€åä¼šè‡ªåŠ¨é‡è¿\n\n```php\n// config/database.php\n'connections' => [\n    'my_conn' => [\n        'driver'    => 'mysql',\n        'host'      => env('DB_MY_CONN_HOST', 'localhost'),\n        'port'      => env('DB_MY_CONN_PORT', 3306),\n        'database'  => env('DB_MY_CONN_DATABASE', 'forge'),\n        'username'  => env('DB_MY_CONN_USERNAME', 'forge'),\n        'password'  => env('DB_MY_CONN_PASSWORD', ''),\n        'charset'   => 'utf8mb4',\n        'collation' => 'utf8mb4_unicode_ci',\n        'prefix'    => '',\n        'strict'    => false,\n        'options'   => [\n            // å¼€å¯æŒä¹…è¿æ¥\n            \\PDO::ATTR_PERSISTENT => true,\n        ],\n    ],\n],\n```\n\n2. Redisè¿æ¥ï¼Œè¿æ¥æ–­å¼€å`ä¸ä¼šç«‹å³`è‡ªåŠ¨é‡è¿ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªå…³äºè¿æ¥æ–­å¼€çš„å¼‚å¸¸ï¼Œä¸‹æ¬¡ä¼šè‡ªåŠ¨é‡è¿ã€‚éœ€ç¡®ä¿æ¯æ¬¡æ“ä½œRediså‰æ­£ç¡®çš„`SELECT DB`ã€‚\n\n```php\n// config/database.php\n'redis' => [\n    'client' => env('REDIS_CLIENT', 'phpredis'), // æ¨èä½¿ç”¨phpredisï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½\n    'default' => [\n        'host'       => env('REDIS_HOST', 'localhost'),\n        'password'   => env('REDIS_PASSWORD', null),\n        'port'       => env('REDIS_PORT', 6379),\n        'database'   => 0,\n        'persistent' => true, // å¼€å¯æŒä¹…è¿æ¥\n    ],\n],\n```\n\n### å…³äºå†…å­˜æ³„éœ²\n\n- é¿å…ä½¿ç”¨å…¨å±€å˜é‡ï¼Œå¦‚ä¸€å®šè¦ï¼Œè¯·æ‰‹åŠ¨æ¸…ç†æˆ–é‡ç½®ã€‚\n\n- æ— é™è¿½åŠ å…ƒç´ åˆ°å…¨å±€å˜é‡ã€é™æ€å˜é‡ã€å•ä¾‹ï¼Œå°†å¯¼è‡´å†…å­˜æº¢å‡ºã€‚\n\n    ```php\n    class Test\n    {\n        public static $array = [];\n        public static $string = '';\n    }\n\n    // æŸæ§åˆ¶å™¨\n    public function test(Request $req)\n    {\n        // å†…å­˜æº¢å‡º\n        Test::$array[] = $req->input('param1');\n        Test::$string .= $req->input('param2');\n    }\n    ```\n\n- å†…å­˜æ³„éœ²çš„æ£€æµ‹æ–¹æ³•\n\n    1. ä¿®æ”¹`config/laravels.php`ï¼š`worker_num=1, max_request=1000000`ï¼Œæµ‹è¯•å®Œæˆåè®°å¾—æ”¹å›å»ï¼›\n\n    2. å¢åŠ è·¯ç”±`/debug-memory-leak`ï¼Œä¸è®¾ç½®ä»»ä½•`è·¯ç”±ä¸­é—´ä»¶`ï¼Œç”¨äºè§‚å¯Ÿ`Worker`è¿›ç¨‹çš„å†…å­˜å˜åŒ–æƒ…å†µï¼›\n\n    ```php\n    Route::get('/debug-memory-leak', function () {\n        global $previous;\n        $current = memory_get_usage();\n        $stats = [\n            'prev_mem' => $previous,\n            'curr_mem' => $current,\n            'diff_mem' => $current - $previous,\n        ];\n        $previous = $current;\n        return $stats;\n    });\n    ```\n\n    3. å¯åŠ¨`LaravelS`ï¼Œè¯·æ±‚`/debug-memory-leak`ï¼Œç›´åˆ°`diff_mem`å°äºæˆ–ç­‰äºé›¶ï¼›å¦‚æœ`diff_mem`ä¸€ç›´å¤§äºé›¶ï¼Œè¯´æ˜`å…¨å±€ä¸­é—´ä»¶`æˆ–`Laravelæ¡†æ¶`å¯èƒ½å­˜åœ¨å†…å­˜æ³„éœ²ï¼›\n    \n    4. å®Œæˆ`æ­¥éª¤3`åï¼Œ`äº¤æ›¿`è¯·æ±‚ä¸šåŠ¡è·¯ç”±ä¸`/debug-memory-leak`ï¼ˆå»ºè®®ä½¿ç”¨`ab`/`wrk`å¯¹ä¸šåŠ¡è·¯ç”±è¿›è¡Œå¤§é‡çš„è¯·æ±‚ï¼‰ï¼Œåˆšå¼€å§‹å‡ºç°çš„å†…å­˜å¢æ¶¨æ˜¯æ­£å¸¸ç°è±¡ã€‚ä¸šåŠ¡è·¯ç”±ç»è¿‡å¤§é‡è¯·æ±‚åï¼Œå¦‚æœ`diff_mem`ä¸€ç›´å¤§äºé›¶ï¼Œå¹¶ä¸”`curr_mem`æŒç»­å¢å¤§ï¼Œåˆ™å¤§æ¦‚ç‡å­˜åœ¨å†…å­˜æ³„éœ²ï¼›å¦‚æœ`curr_mem`å§‹ç»ˆåœ¨ä¸€å®šèŒƒå›´å†…å˜åŒ–ï¼Œæ²¡æœ‰æŒç»­å˜å¤§ï¼Œåˆ™å¤§æ¦‚ç‡ä¸å­˜åœ¨å†…å­˜æ³„éœ²ã€‚\n\n    5. å¦‚æœå§‹ç»ˆæ²¡æ³•è§£å†³ï¼Œ[max_request](https://wiki.swoole.com/#/server/setting?id=max_request)æ˜¯æœ€åå…œåº•çš„æ–¹æ¡ˆã€‚\n\n\n### Linuxå†…æ ¸å‚æ•°è°ƒæ•´\n> [Linuxå†…æ ¸å‚æ•°è°ƒæ•´](https://wiki.swoole.com/#/other/sysctl?id=%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0%e8%b0%83%e6%95%b4)\n\n### å‹åŠ›æµ‹è¯•\n> [å‹åŠ›æµ‹è¯•](https://wiki.swoole.com/wiki/page/62.html)\n\n## ç”¨æˆ·ä¸æ¡ˆä¾‹\n\n- `ç‰¹åˆ«èµåŠ©å•†` [æœé…±ç¤¾åŒº](https://guojiang.club/?utm_source=laravels&utm_campaign=sponsor)ï¼šæœé…±ç¤¾åŒºæ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä¼šå‘˜åˆ¶ç¤¾åŒºï¼Œè¿™é‡Œæä¾›é«˜è´¨é‡çš„æŠ€æœ¯èµ„æ–™ï¼Œ\nä¸“æ³¨ç¨‹åºå‘˜æˆé•¿ï¼Œåˆ›ä¸šå­µåŒ–ï¼Œæä¾›ä¼˜ç§€ä¸”ç¨³å®šçš„å¼€æºäº§å“ã€‚\n    \n    <img src=\"https://user-images.githubusercontent.com/7278743/72538652-19bad000-38b9-11ea-844a-8f66a2c76185.jpeg\" height=\"300px\" alt=\"æœé…±ç¤¾åŒº\">\n\n- [KuCoin](https://www.kucoin.com/r/rf/QBSADJ41)ï¼šTOP5çš„åŠ å¯†è´§å¸äº¤æ˜“æ‰€ã€‚\n\n- [åŒ»è”](https://www.medlinker.com/)ï¼šWEBç«™ã€Mç«™ã€APPã€å°ç¨‹åºçš„è´¦æˆ·ä½“ç³»æœåŠ¡ã€‚\n    \n    <img src=\"https://user-images.githubusercontent.com/7278743/46649457-af05e980-cbcb-11e8-94a1-b13d743d33fd.png\" height=\"300px\" alt=\"åŒ»è”\">\n\n- [ITOKåœ¨çº¿å®¢æœå¹³å°](http://demo.topitsm.com)ï¼šç”¨æˆ·ITå·¥å•çš„å¤„ç†è·Ÿè¸ªåŠåœ¨çº¿å®æ—¶æ²Ÿé€šã€‚\n    \n    <img src=\"https://user-images.githubusercontent.com/7278743/46649548-10c65380-cbcc-11e8-81e6-f4a8dca2eb2c.png\" height=\"300px\" alt=\"ITOKåœ¨çº¿å®¢æœå¹³å°\">\n\n- [ç›Ÿå‘±å‘±](http://mgg.yamecent.com)\n    \n    <img src=\"https://user-images.githubusercontent.com/7278743/46648932-b3310780-cbc9-11e8-971e-ca26e3378507.png\" height=\"300px\" alt=\"ç›Ÿå‘±å‘±\">\n\n- [WookTeam](https://github.com/kuaifan/wookteam)ï¼šWookTeamæ˜¯ä¸€æ¬¾è½»é‡çº§çš„åœ¨çº¿å›¢é˜Ÿåä½œå·¥å…·ï¼Œæä¾›å„ç±»æ–‡æ¡£å·¥å…·ã€åœ¨çº¿æ€ç»´å¯¼å›¾ã€åœ¨çº¿æµç¨‹å›¾ã€é¡¹ç›®ç®¡ç†ã€ä»»åŠ¡åˆ†å‘ï¼ŒçŸ¥è¯†åº“ç®¡ç†ç­‰å·¥å…·ã€‚\n\n- å¾®ä¿¡å…¬ä¼—å·-å¹¿å·å¡”ï¼šæ´»åŠ¨ã€å•†åŸ\n    \n    <img src=\"https://user-images.githubusercontent.com/7278743/46649832-1a9c8680-cbcd-11e8-902e-978fa644f4d9.png\" height=\"300px\" alt=\"å¹¿å·å¡”\">\n\n- ä¼é¹…æ¸¸æˆç›’å­ã€æ˜æ˜Ÿæ–°åŠ¿åŠ›ã€ä»¥åŠå°ç¨‹åºå¹¿å‘ŠæœåŠ¡\n    \n    <img src=\"https://user-images.githubusercontent.com/7278743/46649296-2c7d2a00-cbcb-11e8-94d3-bc12fc9566d6.jpg\" height=\"300px\" alt=\"ä¼é¹…æ¸¸æˆç›’å­\">\n\n- å°ç¨‹åº-ä¿®æœºåŒ æ‰‹æœºä¸Šé—¨ç»´ä¿®æœåŠ¡ï¼šæ‰‹æœºç»´ä¿®æœåŠ¡ï¼Œæä¾›ä¸Šé—¨æœåŠ¡ï¼Œæ”¯æŒåœ¨çº¿ç»´ä¿®ã€‚\n    \n    <img src=\"https://user-images.githubusercontent.com/7278743/46941544-eda11580-d09d-11e8-8c3a-16c567655277.png\" height=\"300px\" alt=\"ä¿®æœºåŒ æ‰‹æœºä¸Šé—¨ç»´ä¿®æœåŠ¡\">\n\n- äº¿å¥APP\n\n## å…¶ä»–é€‰æ‹©\n\n- [swooletw/laravel-swoole](https://github.com/swooletw/laravel-swoole)\n\n## èµåŠ©\n> æ‚¨çš„æ”¯æŒæ˜¯æˆ‘ä»¬åšæŒçš„æœ€å¤§åŠ¨åŠ›ã€‚\n\n<img src=\"https://raw.githubusercontent.com/hhxsv5/laravel-s/PHP-8.x/sponsor.png\" height=\"300px\" alt=\"èµåŠ©\">\n\n### æ„Ÿè°¢\n\n| æ”¯æŒè€… | é‡‘é¢(å…ƒ) |\n| --- | --- |\n| *æ€å‹‡ | 18.88 |\n| *å¾·å›½ | 18.88 |\n| é­‚ä¹‹æŒ½æ­Œ | 100 |\n| å°å—ç“œ | 10.01 |\n| *ä¸æ™º | 16.66 |\n| åŒ¿å | 20 |\n| åŒ¿å | 20 |\n| *æ´‹ Blues | 18.88 |\n| *é’§æ³½ Panda | 10.24 |\n| *ç¿” æµ·è´¼ç‹è·¯é£ | 12 |\n| *è·ƒ Axiong | 10 |\n| è½ä¼½ | 10 |\n| å¾ˆèƒ–çš„èƒ–å­ | 15 |\n| éœ¹æ ¼è½¯ä»¶ | 18.88 |\n| Bygones | 18.88 |\n| *æ˜¥ Flymoo | 100 |\n| å¼‚ä¹¡äºº | 20 |\n| onlyä¸¶å¦³ | 100 |\n| æœˆæ®‡ | 18.88 |\n| Shmily | 20 |\n| *ä¿Š | 20 |\n| *å“² | 20 |\n| Alex | 20 |\n| X | 20 |\n| *æ´‹ | 20 |\n| *æ´‹ | 20 |\n| *å¼º | 50 |\n| Anthony | 18.88 |\n| *å®˜é¾™ | 100 |\n| 0oé£èˆo0æœ¨æœ¨ *ç§‘ | 288 |\n| *å‹‡ | 66.66 |\n| æœé…±ç¤¾åŒº | 1076 |\n| *ä¹¾ | 18.88 |\n| *å¥¥ | 8.88 |\n| åŒæœ¨ | 20 |\n\n## License\n\n[MIT](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/LICENSE)\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 59.9091796875,
          "content": "<div align=\"center\">\n    <img src=\"https://github.com/hhxsv5/laravel-s/raw/PHP-8.x/logo.svg\" alt=\"LaravelS Logo\" height=\"80\">\n     <p>\n        <a href=\"https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md\">English Docs</a> |\n        <a href=\"https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md\">ä¸­æ–‡æ–‡æ¡£</a>\n    </p>\n    <p>ğŸš€ LaravelS is an out-of-the-box adapter between Laravel/Lumen and Swoole</p>\n    <p>\n        <a href=\"https://github.com/hhxsv5/laravel-s/releases\">\n            <img src=\"https://img.shields.io/github/release/hhxsv5/laravel-s.svg\" alt=\"Latest Version\">\n        </a>\n        <a href=\"https://www.php.net/\">\n            <img src=\"https://img.shields.io/packagist/php-v/hhxsv5/laravel-s\" alt=\"PHP Version\">\n        </a>\n        <a href=\"https://github.com/swoole/swoole-src\">\n            <img src=\"https://img.shields.io/badge/swoole-%3E=5.0.0-flat.svg\" alt=\"Swoole Version\">\n        </a>\n        <a href=\"https://packagist.org/packages/hhxsv5/laravel-s/stats\">\n            <img src=\"https://img.shields.io/packagist/dt/hhxsv5/laravel-s\" alt=\"Total Downloads\">\n        </a>\n        <a href=\"https://scrutinizer-ci.com/g/hhxsv5/laravel-s/\">\n            <img src=\"https://scrutinizer-ci.com/g/hhxsv5/laravel-s/badges/build.png?b=PHP-8.x\" alt=\"Build Status\">\n        </a>\n        <a href=\"https://scrutinizer-ci.com/g/hhxsv5/laravel-s/\">\n            <img src=\"https://scrutinizer-ci.com/g/hhxsv5/laravel-s/badges/code-intelligence.svg?b=PHP-8.x\" alt=\"Code Intelligence Status\">\n        </a>\n        <a href=\"https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/LICENSE\">\n            <img src=\"https://img.shields.io/github/license/hhxsv5/laravel-s\" alt=\"License\">\n        </a>\n    </p>\n</div>\n\n---\n\n## Continuous Updates\n- *Please `Watch` this repository to get the latest updates.*\n\nTable of Contents\n=================\n\n* [Features](#features)\n* [Benchmark](#benchmark)\n* [Requirements](#requirements)\n* [Install](#install)\n* [Run](#run)\n* [Deploy](#deploy)\n* [Cooperate with Nginx (Recommended)](#cooperate-with-nginx-recommended)\n* [Cooperate with Apache](#cooperate-with-apache)\n* [Enable WebSocket server](#enable-websocket-server)\n* [Listen events](#listen-events)\n    * [System events](#system-events)\n    * [Customized asynchronous events](#customized-asynchronous-events)\n* [Asynchronous task queue](#asynchronous-task-queue)\n* [Millisecond cron job](#millisecond-cron-job)\n* [Automatically reload after modifying code](#automatically-reload-after-modifying-code)\n* [Get the instance of SwooleServer in your project](#get-the-instance-of-swooleserver-in-your-project)\n* [Use SwooleTable](#use-swooletable)\n* [Multi-port mixed protocol](#multi-port-mixed-protocol)\n* [Coroutine](#coroutine)\n* [Custom process](#custom-process)\n* [Common components](#common-components)\n    * [Apollo](#apollo)\n    * [Prometheus](#prometheus)\n* [Other features](#other-features)\n    * [Configure Swoole events](#configure-swoole-events)\n    * [Serverless](#serverless)\n* [Important notices](#important-notices)\n* [Users and cases](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README-CN.md#%E7%94%A8%E6%88%B7%E4%B8%8E%E6%A1%88%E4%BE%8B)\n* [Alternatives](#alternatives)\n* [Sponsor](#sponsor)\n* [License](#license)\n\n## Features\n\n- Built-in Http/[WebSocket](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#enable-websocket-server) server\n\n- [Multi-port mixed protocol](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#multi-port-mixed-protocol)\n\n- [Custom process](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#custom-process)\n\n- Memory resident\n\n- [Asynchronous event listening](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#customized-asynchronous-events)\n\n- [Asynchronous task queue](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#asynchronous-task-queue)\n\n- [Millisecond cron job](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#millisecond-cron-job)\n\n- [Common Components](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#common-components)\n\n- Gracefully reload\n\n- [Automatically reload after modifying code](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#automatically-reload-after-modifying-code)\n\n- Support Laravel/Lumen both, good compatibility\n\n- Simple & Out of the box\n\n## Benchmark\n\n- [Which is the fastest web framework?](https://github.com/the-benchmarker/web-frameworks)\n\n- [TechEmpower Framework Benchmarks](https://www.techempower.com/benchmarks/)\n\n## Requirements\n\n| Dependency | Requirement |\n| -------- | -------- |\n| [PHP](https://secure.php.net/) | `>=8.2` `Recommend 8.2` |\n| [Swoole](https://www.swoole.co.uk/) | `>=5.0` `Recommend 5.1.1` |\n| [Laravel](https://laravel.com/)/[Lumen](https://lumen.laravel.com/) | `>=10` `Recommend 10` |\n\n## Install\n\n1.Require package via [Composer](https://getcomposer.org/)([packagist](https://packagist.org/packages/hhxsv5/laravel-s)).\n```bash\n# PHP >=8.2\ncomposer require \"hhxsv5/laravel-s:~3.8.0\"\n\n# PHP >=5.5.9,<=7.4.33\n# composer require \"hhxsv5/laravel-s:~3.7.0\"\n\n# Make sure that your composer.lock file is under the VCS\n```\n\n2.Register service provider(pick one of two).\n\n- `Laravel`: in `config/app.php` file, `Laravel 5.5+ supports package discovery automatically, you should skip this step`\n    ```php\n    'providers' => [\n        //...\n        Hhxsv5\\LaravelS\\Illuminate\\LaravelSServiceProvider::class,\n    ],\n    ```\n\n- `Lumen`: in `bootstrap/app.php` file\n    ```php\n    $app->register(Hhxsv5\\LaravelS\\Illuminate\\LaravelSServiceProvider::class);\n    ```\n\n3.Publish configuration and binaries.\n> *After upgrading LaravelS, you need to republish; click [here](https://github.com/hhxsv5/laravel-s/releases) to see the change notes of each version.*\n\n```bash\nphp artisan laravels publish\n# Configuration: config/laravels.php\n# Binary: bin/laravels bin/fswatch bin/inotify\n```\n\n4.Change `config/laravels.php`: listen_ip, listen_port, refer [Settings](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/Settings.md).\n\n5.Performance tuning\n\n- [Adjust kernel parameters](https://wiki.swoole.com/#/other/sysctl?id=%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0%e8%b0%83%e6%95%b4)\n\n- [Number of Workers](https://www.swoole.co.uk/docs/modules/swoole-server/configuration#worker_num): LaravelS uses Swoole's `Synchronous IO` mode, the larger the `worker_num` setting, the better the concurrency performance, but it will cause more memory usage and process switching overhead. If one request takes 100ms, in order to provide 1000QPS concurrency, at least 100 Worker processes need to be configured. The calculation method is: worker_num = 1000QPS/(1s/1ms) = 100, so incremental pressure testing is needed to calculate the best` worker_num`.\n\n- [Number of Task Workers](https://www.swoole.co.uk/docs/modules/swoole-server/configuration#task_worker_num)\n\n## Run\n> `Please read the notices carefully before running`, [Important notices](https://github.com/hhxsv5/laravel-s#important-notices)(IMPORTANT).\n\n- Commands: `php bin/laravels {start|stop|restart|reload|info|help}`.\n\n| Command | Description |\n| --------- | --------- |\n| start | Start LaravelS, list the processes by \"*ps -ef&#124;grep laravels*\" |\n| stop | Stop LaravelS, and trigger the method `onStop` of Custom process |\n| restart | Restart LaravelS: Stop gracefully before starting; The service is `unavailable` until startup is complete |\n| reload | Reload all Task/Worker/Timer processes which contain your business codes, and trigger the method `onReload` of Custom process, CANNOT reload Master/Manger processes. After modifying `config/laravels.php`, you `only` have to call `restart` to restart |\n| info | Display component version information |\n| help | Display help information |\n\n- Boot options for the commands `start` and `restart`.\n\n| Option | Description |\n| --------- | --------- |\n| -d&#124;--daemonize | Run as a daemon, this option will override the `swoole.daemonize` setting in `laravels.php` |\n| -e&#124;--env | The environment the command should run under, such as `--env=testing` will use the configuration file `.env.testing` firstly, this feature requires Laravel 5.2+ |\n| -i&#124;--ignore | Ignore checking PID file of Master process |\n| -x&#124;--x-version | The version(branch) of the current project, stored in $_ENV/$_SERVER, access via `$_ENV['X_VERSION']` `$_SERVER['X_VERSION']` `$request->server->get('X_VERSION')` |\n\n- `Runtime` files: `start` will automatically execute `php artisan laravels config` and generate these files, developers generally don't need to pay attention to them, it's recommended to add them to `.gitignore`.\n\n| File | Description |\n| --------- | --------- |\n| storage/laravels.conf | LaravelS's `runtime` configuration file |\n| storage/laravels.pid | PID file of Master process |\n| storage/laravels-timer-process.pid | PID file of the Timer process |\n| storage/laravels-custom-processes.pid | PID file of all custom processes |\n\n## Deploy\n> It is recommended to supervise the main process through [Supervisord](http://supervisord.org/), the premise is without option `-d` and to set `swoole.daemonize` to `false`.\n\n```\n[program:laravel-s-test]\ndirectory=/var/www/laravel-s-test\ncommand=/usr/local/bin/php bin/laravels start -i\nnumprocs=1\nautostart=true\nautorestart=true\nstartretries=3\nuser=www-data\nredirect_stderr=true\nstdout_logfile=/var/log/supervisor/%(program_name)s.log\n```\n\n## Cooperate with Nginx (Recommended)\n> [Demo](https://github.com/hhxsv5/docker/blob/master/nginx/conf.d/laravels.conf).\n\n```nginx\ngzip on;\ngzip_min_length 1024;\ngzip_comp_level 2;\ngzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml application/x-httpd-php image/jpeg image/gif image/png font/ttf font/otf image/svg+xml;\ngzip_vary on;\ngzip_disable \"msie6\";\nupstream swoole {\n    # Connect IP:Port\n    server 127.0.0.1:5200 weight=5 max_fails=3 fail_timeout=30s;\n    # Connect UnixSocket Stream file, tips: put the socket file in the /dev/shm directory to get better performance\n    #server unix:/yourpath/laravel-s-test/storage/laravels.sock weight=5 max_fails=3 fail_timeout=30s;\n    #server 192.168.1.1:5200 weight=3 max_fails=3 fail_timeout=30s;\n    #server 192.168.1.2:5200 backup;\n    keepalive 16;\n}\nserver {\n    listen 80;\n    # Don't forget to bind the host\n    server_name laravels.com;\n    root /yourpath/laravel-s-test/public;\n    access_log /yourpath/log/nginx/$server_name.access.log  main;\n    autoindex off;\n    index index.html index.htm;\n    # Nginx handles the static resources(recommend enabling gzip), LaravelS handles the dynamic resource.\n    location / {\n        try_files $uri @laravels;\n    }\n    # Response 404 directly when request the PHP file, to avoid exposing public/*.php\n    #location ~* \\.php$ {\n    #    return 404;\n    #}\n    location @laravels {\n        # proxy_connect_timeout 60s;\n        # proxy_send_timeout 60s;\n        # proxy_read_timeout 120s;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Real-PORT $remote_port;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header Scheme $scheme;\n        proxy_set_header Server-Protocol $server_protocol;\n        proxy_set_header Server-Name $server_name;\n        proxy_set_header Server-Addr $server_addr;\n        proxy_set_header Server-Port $server_port;\n        # \"swoole\" is the upstream\n        proxy_pass http://swoole;\n    }\n}\n```\n\n## Cooperate with Apache\n\n```apache\nLoadModule proxy_module /yourpath/modules/mod_proxy.so\nLoadModule proxy_balancer_module /yourpath/modules/mod_proxy_balancer.so\nLoadModule lbmethod_byrequests_module /yourpath/modules/mod_lbmethod_byrequests.so\nLoadModule proxy_http_module /yourpath/modules/mod_proxy_http.so\nLoadModule slotmem_shm_module /yourpath/modules/mod_slotmem_shm.so\nLoadModule rewrite_module /yourpath/modules/mod_rewrite.so\nLoadModule remoteip_module /yourpath/modules/mod_remoteip.so\nLoadModule deflate_module /yourpath/modules/mod_deflate.so\n\n<IfModule deflate_module>\n    SetOutputFilter DEFLATE\n    DeflateCompressionLevel 2\n    AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml application/x-httpd-php image/jpeg image/gif image/png font/ttf font/otf image/svg+xml\n</IfModule>\n\n<VirtualHost *:80>\n    # Don't forget to bind the host\n    ServerName www.laravels.com\n    ServerAdmin hhxsv5@sina.com\n\n    DocumentRoot /yourpath/laravel-s-test/public;\n    DirectoryIndex index.html index.htm\n    <Directory \"/\">\n        AllowOverride None\n        Require all granted\n    </Directory>\n\n    RemoteIPHeader X-Forwarded-For\n\n    ProxyRequests Off\n    ProxyPreserveHost On\n    <Proxy balancer://laravels>  \n        BalancerMember http://192.168.1.1:5200 loadfactor=7\n        #BalancerMember http://192.168.1.2:5200 loadfactor=3\n        #BalancerMember http://192.168.1.3:5200 loadfactor=1 status=+H\n        ProxySet lbmethod=byrequests\n    </Proxy>\n    #ProxyPass / balancer://laravels/\n    #ProxyPassReverse / balancer://laravels/\n\n    # Apache handles the static resources, LaravelS handles the dynamic resource.\n    RewriteEngine On\n    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d\n    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f\n    RewriteRule ^/(.*)$ balancer://laravels%{REQUEST_URI} [P,L]\n\n    ErrorLog ${APACHE_LOG_DIR}/www.laravels.com.error.log\n    CustomLog ${APACHE_LOG_DIR}/www.laravels.com.access.log combined\n</VirtualHost>\n```\n\n## Enable WebSocket server\n> The Listening address of WebSocket Sever is the same as Http Server.\n\n1.Create WebSocket Handler class, and implement interface `WebSocketHandlerInterface`.The instant is automatically instantiated when start, you do not need to manually create it.\n```php\nnamespace App\\Services;\nuse Hhxsv5\\LaravelS\\Swoole\\WebSocketHandlerInterface;\nuse Swoole\\Http\\Request;\nuse Swoole\\Http\\Response;\nuse Swoole\\WebSocket\\Frame;\nuse Swoole\\WebSocket\\Server;\n/**\n * @see https://www.swoole.co.uk/docs/modules/swoole-websocket-server\n */\nclass WebSocketService implements WebSocketHandlerInterface\n{\n    // Declare constructor without parameters\n    public function __construct()\n    {\n    }\n    // public function onHandShake(Request $request, Response $response)\n    // {\n           // Custom handshake: https://www.swoole.co.uk/docs/modules/swoole-websocket-server-on-handshake\n           // The onOpen event will be triggered automatically after a successful handshake\n    // }\n    public function onOpen(Server $server, Request $request)\n    {\n        // Before the onOpen event is triggered, the HTTP request to establish the WebSocket has passed the Laravel route,\n        // so Laravel's Request, Auth information are readable, Session is readable and writable, but only in the onOpen event.\n        // \\Log::info('New WebSocket connection', [$request->fd, request()->all(), session()->getId(), session('xxx'), session(['yyy' => time()])]);\n        // The exceptions thrown here will be caught by the upper layer and recorded in the Swoole log. Developers need to try/catch manually.\n        $server->push($request->fd, 'Welcome to LaravelS');\n    }\n    public function onMessage(Server $server, Frame $frame)\n    {\n        // \\Log::info('Received message', [$frame->fd, $frame->data, $frame->opcode, $frame->finish]);\n        // The exceptions thrown here will be caught by the upper layer and recorded in the Swoole log. Developers need to try/catch manually.\n        $server->push($frame->fd, date('Y-m-d H:i:s'));\n    }\n    public function onClose(Server $server, $fd, $reactorId)\n    {\n        // The exceptions thrown here will be caught by the upper layer and recorded in the Swoole log. Developers need to try/catch manually.\n    }\n}\n```\n\n2.Modify `config/laravels.php`.\n```php\n// ...\n'websocket'      => [\n    'enable'  => true, // Note: set enable to true\n    'handler' => \\App\\Services\\WebSocketService::class,\n],\n'swoole'         => [\n    //...\n    // Must set dispatch_mode in (2, 4, 5), see https://www.swoole.co.uk/docs/modules/swoole-server/configuration\n    'dispatch_mode' => 2,\n    //...\n],\n// ...\n```\n3.Use `SwooleTable` to bind FD & UserId, optional, [Swoole Table Demo](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/README.md#use-swooletable). Also you can use the other global storage services, like Redis/Memcached/MySQL, but be careful that FD will be possible conflicting between multiple `Swoole Servers`.\n\n4.Cooperate with Nginx (Recommended)\n> Refer [WebSocket Proxy](http://nginx.org/en/docs/http/websocket.html)\n\n```nginx\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\nupstream swoole {\n    # Connect IP:Port\n    server 127.0.0.1:5200 weight=5 max_fails=3 fail_timeout=30s;\n    # Connect UnixSocket Stream file, tips: put the socket file in the /dev/shm directory to get better performance\n    #server unix:/yourpath/laravel-s-test/storage/laravels.sock weight=5 max_fails=3 fail_timeout=30s;\n    #server 192.168.1.1:5200 weight=3 max_fails=3 fail_timeout=30s;\n    #server 192.168.1.2:5200 backup;\n    keepalive 16;\n}\nserver {\n    listen 80;\n    # Don't forget to bind the host\n    server_name laravels.com;\n    root /yourpath/laravel-s-test/public;\n    access_log /yourpath/log/nginx/$server_name.access.log  main;\n    autoindex off;\n    index index.html index.htm;\n    # Nginx handles the static resources(recommend enabling gzip), LaravelS handles the dynamic resource.\n    location / {\n        try_files $uri @laravels;\n    }\n    # Response 404 directly when request the PHP file, to avoid exposing public/*.php\n    #location ~* \\.php$ {\n    #    return 404;\n    #}\n    # Http and WebSocket are concomitant, Nginx identifies them by \"location\"\n    # !!! The location of WebSocket is \"/ws\"\n    # Javascript: var ws = new WebSocket(\"ws://laravels.com/ws\");\n    location =/ws {\n        # proxy_connect_timeout 60s;\n        # proxy_send_timeout 60s;\n        # proxy_read_timeout: Nginx will close the connection if the proxied server does not send data to Nginx in 60 seconds; At the same time, this close behavior is also affected by heartbeat setting of Swoole.\n        # proxy_read_timeout 60s;\n        proxy_http_version 1.1;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Real-PORT $remote_port;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header Scheme $scheme;\n        proxy_set_header Server-Protocol $server_protocol;\n        proxy_set_header Server-Name $server_name;\n        proxy_set_header Server-Addr $server_addr;\n        proxy_set_header Server-Port $server_port;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n        proxy_pass http://swoole;\n    }\n    location @laravels {\n        # proxy_connect_timeout 60s;\n        # proxy_send_timeout 60s;\n        # proxy_read_timeout 60s;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Real-PORT $remote_port;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header Scheme $scheme;\n        proxy_set_header Server-Protocol $server_protocol;\n        proxy_set_header Server-Name $server_name;\n        proxy_set_header Server-Addr $server_addr;\n        proxy_set_header Server-Port $server_port;\n        proxy_pass http://swoole;\n    }\n}\n```\n\n5.Heartbeat setting\n\n- Heartbeat setting of Swoole\n\n    ```php\n    // config/laravels.php\n    'swoole' => [\n        //...\n        // All connections are traversed every 60 seconds. If a connection does not send any data to the server within 600 seconds, the connection will be forced to close.\n        'heartbeat_idle_time'      => 600,\n        'heartbeat_check_interval' => 60,\n        //...\n    ],\n    ```\n\n- Proxy read timeout of Nginx\n\n    ```nginx\n    # Nginx will close the connection if the proxied server does not send data to Nginx in 60 seconds\n    proxy_read_timeout 60s;\n    ```\n\n6.Push data in controller\n\n```php\nnamespace App\\Http\\Controllers;\nclass TestController extends Controller\n{\n    public function push()\n    {\n        $fd = 1; // Find fd by userId from a map [userId=>fd].\n        /**@var \\Swoole\\WebSocket\\Server $swoole */\n        $swoole = app('swoole');\n        $success = $swoole->push($fd, 'Push data to fd#1 in Controller');\n        var_dump($success);\n    }\n}\n```\n\n## Listen events\n\n### System events\n> Usually, you can reset/destroy some `global/static` variables, or change the current `Request/Response` object.\n\n- `laravels.received_request` After LaravelS parsed `Swoole\\Http\\Request` to `Illuminate\\Http\\Request`, before Laravel's Kernel handles this request.\n\n    ```php\n    // Edit file `app/Providers/EventServiceProvider.php`, add the following code into method `boot`\n    // If no variable $events, you can also call Facade \\Event::listen(). \n    $events->listen('laravels.received_request', function (\\Illuminate\\Http\\Request $req, $app) {\n        $req->query->set('get_key', 'hhxsv5');// Change query of request\n        $req->request->set('post_key', 'hhxsv5'); // Change post of request\n    });\n    ```\n\n- `laravels.generated_response` After Laravel's Kernel handled the request, before LaravelS parses `Illuminate\\Http\\Response` to `Swoole\\Http\\Response`.\n\n    ```php\n    // Edit file `app/Providers/EventServiceProvider.php`, add the following code into method `boot`\n    // If no variable $events, you can also call Facade \\Event::listen(). \n    $events->listen('laravels.generated_response', function (\\Illuminate\\Http\\Request $req, \\Symfony\\Component\\HttpFoundation\\Response $rsp, $app) {\n        $rsp->headers->set('header-key', 'hhxsv5');// Change header of response\n    });\n    ```\n\n### Customized asynchronous events\n> This feature depends on `AsyncTask` of `Swoole`, your need to set `swoole.task_worker_num` in `config/laravels.php` firstly. The performance of asynchronous event processing is influenced by number of Swoole task process, you need to set [task_worker_num](https://www.swoole.co.uk/docs/modules/swoole-server/configuration) appropriately.\n\n1.Create event class.\n```php\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Event;\nclass TestEvent extends Event\n{\n    protected $listeners = [\n        // Listener list\n        TestListener1::class,\n        // TestListener2::class,\n    ];\n    private $data;\n    public function __construct($data)\n    {\n        $this->data = $data;\n    }\n    public function getData()\n    {\n        return $this->data;\n    }\n}\n```\n\n2.Create listener class.\n```php\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Event;\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Listener;\nclass TestListener1 extends Listener\n{\n    public function handle(Event $event)\n    {\n        \\Log::info(__CLASS__ . ':handle start', [$event->getData()]);\n        sleep(2);// Simulate the slow codes\n        // Deliver task in CronJob, but NOT support callback finish() of task.\n        // Note: Modify task_ipc_mode to 1 or 2 in config/laravels.php, see https://www.swoole.co.uk/docs/modules/swoole-server/configuration\n        $ret = Task::deliver(new TestTask('task data'));\n        var_dump($ret);\n        // The exceptions thrown here will be caught by the upper layer and recorded in the Swoole log. Developers need to try/catch manually.\n        // return false; // Stop propagating this event to subsequent listeners\n    }\n}\n```\n\n3.Fire event.\n```php\n// Create instance of event and fire it, \"fire\" is asynchronous.\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Event;\n$event = new TestEvent('event data');\n// $event->delay(10); // Delay 10 seconds to fire event\n// $event->setTries(3); // When an error occurs, try 3 times in total\n$success = Event::fire($event);\nvar_dump($success);// Return true if sucess, otherwise false\n```\n\n## Asynchronous task queue\n> This feature depends on `AsyncTask` of `Swoole`, your need to set `swoole.task_worker_num` in `config/laravels.php` firstly. The performance of task processing is influenced by number of Swoole task process, you need to set [task_worker_num](https://www.swoole.co.uk/docs/modules/swoole-server/configuration) appropriately.\n\n1.Create task class.\n```php\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\nclass TestTask extends Task\n{\n    private $data;\n    private $result;\n    public function __construct($data)\n    {\n        $this->data = $data;\n    }\n    // The logic of task handling, run in task process, CAN NOT deliver task\n    public function handle()\n    {\n        \\Log::info(__CLASS__ . ':handle start', [$this->data]);\n        sleep(2);// Simulate the slow codes\n        // The exceptions thrown here will be caught by the upper layer and recorded in the Swoole log. Developers need to try/catch manually.\n        $this->result = 'the result of ' . $this->data;\n    }\n    // Optional, finish event, the logic of after task handling, run in worker process, CAN deliver task \n    public function finish()\n    {\n        \\Log::info(__CLASS__ . ':finish start', [$this->result]);\n        Task::deliver(new TestTask2('task2 data')); // Deliver the other task\n    }\n}\n```\n\n2.Deliver task.\n```php\n// Create instance of TestTask and deliver it, \"deliver\" is asynchronous.\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\n$task = new TestTask('task data');\n// $task->delay(3);// delay 3 seconds to deliver task\n// $task->setTries(3); // When an error occurs, try 3 times in total\n$ret = Task::deliver($task);\nvar_dump($ret);// Return true if sucess, otherwise false\n```\n\n## Millisecond cron job\n> Wrapper cron job base on [Swoole's Millisecond Timer](https://www.swoole.co.uk/docs/modules/swoole-async-io), replace `Linux` `Crontab`.\n\n1.Create cron job class.\n```php\nnamespace App\\Jobs\\Timer;\nuse App\\Tasks\\TestTask;\nuse Swoole\\Coroutine;\nuse Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\nuse Hhxsv5\\LaravelS\\Swoole\\Timer\\CronJob;\nclass TestCronJob extends CronJob\n{\n    protected $i = 0;\n    // !!! The `interval` and `isImmediate` of cron job can be configured in two ways(pick one of two): one is to overload the corresponding method, and the other is to pass parameters when registering cron job.\n    // --- Override the corresponding method to return the configuration: begin\n    public function interval()\n    {\n        return 1000;// Run every 1000ms\n    }\n    public function isImmediate()\n    {\n        return false;// Whether to trigger `run` immediately after setting up\n    }\n    // --- Override the corresponding method to return the configuration: end\n    public function run()\n    {\n        \\Log::info(__METHOD__, ['start', $this->i, microtime(true)]);\n        // do something\n        // sleep(1); // Swoole < 2.1\n        Coroutine::sleep(1); // Swoole>=2.1 Coroutine will be automatically created for run().\n        $this->i++;\n        \\Log::info(__METHOD__, ['end', $this->i, microtime(true)]);\n\n        if ($this->i >= 10) { // Run 10 times only\n            \\Log::info(__METHOD__, ['stop', $this->i, microtime(true)]);\n            $this->stop(); // Stop this cron job, but it will run again after restart/reload.\n            // Deliver task in CronJob, but NOT support callback finish() of task.\n            // Note: Modify task_ipc_mode to 1 or 2 in config/laravels.php, see https://www.swoole.co.uk/docs/modules/swoole-server/configuration\n            $ret = Task::deliver(new TestTask('task data'));\n            var_dump($ret);\n        }\n        // The exceptions thrown here will be caught by the upper layer and recorded in the Swoole log. Developers need to try/catch manually.\n    }\n}\n```\n\n2.Register cron job.\n```php\n// Register cron jobs in file \"config/laravels.php\"\n[\n    // ...\n    'timer'          => [\n        'enable' => true, // Enable Timer\n        'jobs'   => [ // The list of cron job\n            // Enable LaravelScheduleJob to run `php artisan schedule:run` every 1 minute, replace Linux Crontab\n            // \\Hhxsv5\\LaravelS\\Illuminate\\LaravelScheduleJob::class,\n            // Two ways to configure parameters:\n            // [\\App\\Jobs\\Timer\\TestCronJob::class, [1000, true]], // Pass in parameters when registering\n            \\App\\Jobs\\Timer\\TestCronJob::class, // Override the corresponding method to return the configuration\n        ],\n        'max_wait_time' => 5, // Max waiting time of reloading\n        // Enable the global lock to ensure that only one instance starts the timer when deploying multiple instances. This feature depends on Redis, please see https://laravel.com/docs/7.x/redis\n        'global_lock'     => false,\n        'global_lock_key' => config('app.name', 'Laravel'),\n    ],\n    // ...\n];\n```\n\n3.Note: it will launch multiple timers when build the server cluster, so you need to make sure that launch one timer only to avoid running repetitive task.\n\n4.LaravelS `v3.4.0` starts to support the hot restart [Reload] `Timer` process. After LaravelS receives the `SIGUSR1` signal, it waits for `max_wait_time`(default 5) seconds to end the process, then the `Manager` process will pull up the `Timer` process again.\n\n5.If you only need to use `minute-level` scheduled tasks, it is recommended to enable `Hhxsv5\\LaravelS\\Illuminate\\LaravelScheduleJob` instead of Linux Crontab, so that you can follow the coding habits of [Laravel task scheduling](https://laravel.com/docs/7.x/scheduling) and configure `Kernel`.\n\n```php\n// app/Console/Kernel.php\nprotected function schedule(Schedule $schedule)\n{\n    // runInBackground() will start a new child process to execute the task. This is asynchronous and will not affect the execution timing of other tasks.\n    $schedule->command(TestCommand::class)->runInBackground()->everyMinute();\n}\n```\n\n## Automatically reload after modifying code\n\n- Via `inotify`, support Linux only.\n\n    1.Install [inotify](http://pecl.php.net/package/inotify) extension.\n\n    2.Turn on the switch in [Settings](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/Settings.md#inotify_reloadenable).\n\n    3.Notice: Modify the file only in `Linux` to receive the file change events. It's recommended to use the latest Docker. [Vagrant Solution](https://github.com/mhallin/vagrant-notify-forwarder).\n\n- Via `fswatch`, support OS X/Linux/Windows.\n\n    1.Install [fswatch](https://github.com/emcrisostomo/fswatch).\n\n    2.Run command in your project root directory.\n\n    ```bash\n    # Watch current directory\n    ./bin/fswatch\n    # Watch app directory\n    ./bin/fswatch ./app\n    ```\n\n- Via `inotifywait`, support Linux.\n\n    1.Install [inotify-tools](https://github.com/rvoicilas/inotify-tools).\n\n    2.Run command in your project root directory.\n\n    ```bash\n    # Watch current directory\n    ./bin/inotify\n    # Watch app directory\n    ./bin/inotify ./app\n    ```\n\n- When the above methods does not work, the ultimate solution: set `max_request=1,worker_num=1`, so that `Worker` process will restart after processing a request. The performance of this method is very poor, `so only development environment use`.\n\n## Get the instance of `SwooleServer` in your project\n\n```php\n/**\n * $swoole is the instance of `Swoole\\WebSocket\\Server` if enable WebSocket server, otherwise `Swoole\\Http\\Server`\n * @var \\Swoole\\WebSocket\\Server|\\Swoole\\Http\\Server $swoole\n */\n$swoole = app('swoole');\nvar_dump($swoole->stats());\n$swoole->push($fd, 'Push WebSocket message');\n```\n\n## Use `SwooleTable`\n\n1.Define Table, support multiple.\n> All defined tables will be created before Swoole starting.\n\n```php\n// in file \"config/laravels.php\"\n[\n    // ...\n    'swoole_tables'  => [\n        // Sceneï¼šbind UserId & FD in WebSocket\n        'ws' => [// The Key is table name, will add suffix \"Table\" to avoid naming conflicts. Here defined a table named \"wsTable\"\n            'size'   => 102400,// The max size\n            'column' => [// Define the columns\n                ['name' => 'value', 'type' => \\Swoole\\Table::TYPE_INT, 'size' => 8],\n            ],\n        ],\n        //...Define the other tables\n    ],\n    // ...\n];\n```\n\n2.Access `Table`: all table instances will be bound on `SwooleServer`, access by `app('swoole')->xxxTable`.\n\n```php\nnamespace App\\Services;\nuse Hhxsv5\\LaravelS\\Swoole\\WebSocketHandlerInterface;\nuse Swoole\\Http\\Request;\nuse Swoole\\WebSocket\\Frame;\nuse Swoole\\WebSocket\\Server;\nclass WebSocketService implements WebSocketHandlerInterface\n{\n    /**@var \\Swoole\\Table $wsTable */\n    private $wsTable;\n    public function __construct()\n    {\n        $this->wsTable = app('swoole')->wsTable;\n    }\n    // Sceneï¼šbind UserId & FD in WebSocket\n    public function onOpen(Server $server, Request $request)\n    {\n        // var_dump(app('swoole') === $server);// The same instance\n        /**\n         * Get the currently logged in user\n         * This feature requires that the path to establish a WebSocket connection go through middleware such as Authenticate.\n         * E.g:\n         * Browser side: var ws = new WebSocket(\"ws://127.0.0.1:5200/ws\");\n         * Then the /ws route in Laravel needs to add the middleware like Authenticate.\n         * Route::get('/ws', function () {\n         *     // Respond any content with status code 200\n         *     return 'websocket';\n         * })->middleware(['auth']);\n         */\n        // $user = Auth::user();\n        // $userId = $user ? $user->id : 0; // 0 means a guest user who is not logged in\n        $userId = mt_rand(1000, 10000);\n        // if (!$userId) {\n        //     // Disconnect the connections of unlogged users\n        //     $server->disconnect($request->fd);\n        //     return;\n        // }\n        $this->wsTable->set('uid:' . $userId, ['value' => $request->fd]);// Bind map uid to fd\n        $this->wsTable->set('fd:' . $request->fd, ['value' => $userId]);// Bind map fd to uid\n        $server->push($request->fd, \"Welcome to LaravelS #{$request->fd}\");\n    }\n    public function onMessage(Server $server, Frame $frame)\n    {\n        // Broadcast\n        foreach ($this->wsTable as $key => $row) {\n            if (strpos($key, 'uid:') === 0 && $server->isEstablished($row['value'])) {\n                $content = sprintf('Broadcast: new message \"%s\" from #%d', $frame->data, $frame->fd);\n                $server->push($row['value'], $content);\n            }\n        }\n    }\n    public function onClose(Server $server, $fd, $reactorId)\n    {\n        $uid = $this->wsTable->get('fd:' . $fd);\n        if ($uid !== false) {\n            $this->wsTable->del('uid:' . $uid['value']); // Unbind uid map\n        }\n        $this->wsTable->del('fd:' . $fd);// Unbind fd map\n        $server->push($fd, \"Goodbye #{$fd}\");\n    }\n}\n```\n\n## Multi-port mixed protocol\n\n> For more information, please refer to [Swoole Server AddListener](https://www.swoole.co.uk/docs/modules/swoole-server-methods#swoole_server-addlistener)\n\nTo make our main server support more protocols not just Http and WebSocket, we bring the feature `multi-port mixed protocol` of Swoole in LaravelS and name it `Socket`. Now, you can build `TCP/UDP` applications easily on top of Laravel.\n\n1. Create `Socket` handler class, and extend `Hhxsv5\\LaravelS\\Swoole\\Socket\\{TcpSocket|UdpSocket|Http|WebSocket}`.\n\n    ```php\n    namespace App\\Sockets;\n    use Hhxsv5\\LaravelS\\Swoole\\Socket\\TcpSocket;\n    use Swoole\\Server;\n    class TestTcpSocket extends TcpSocket\n    {\n        public function onConnect(Server $server, $fd, $reactorId)\n        {\n            \\Log::info('New TCP connection', [$fd]);\n            $server->send($fd, 'Welcome to LaravelS.');\n        }\n        public function onReceive(Server $server, $fd, $reactorId, $data)\n        {\n            \\Log::info('Received data', [$fd, $data]);\n            $server->send($fd, 'LaravelS: ' . $data);\n            if ($data === \"quit\\r\\n\") {\n                $server->send($fd, 'LaravelS: bye' . PHP_EOL);\n                $server->close($fd);\n            }\n        }\n        public function onClose(Server $server, $fd, $reactorId)\n        {\n            \\Log::info('Close TCP connection', [$fd]);\n            $server->send($fd, 'Goodbye');\n        }\n    }\n    ```\n\n    These `Socket` connections share the same worker processes with your `HTTP`/`WebSocket` connections. So it won't be a problem at all if you want to deliver tasks, use `SwooleTable`, even Laravel components such as DB, Eloquent and so on.\n    At the same time, you can access `Swoole\\Server\\Port` object directly by member property `swoolePort`.\n\n    ```php\n    public function onReceive(Server $server, $fd, $reactorId, $data)\n    {\n        $port = $this->swoolePort; // Get the `Swoole\\Server\\Port` object\n    }\n    ```\n\n    ```php\n    namespace App\\Http\\Controllers;\n    class TestController extends Controller\n    {\n        public function test()\n        {\n            /**@var \\Swoole\\Http\\Server|\\Swoole\\WebSocket\\Server $swoole */\n            $swoole = app('swoole');\n            // $swoole->ports: Traverse all Port objects, https://www.swoole.co.uk/docs/modules/swoole-server/multiple-ports\n            $port = $swoole->ports[0]; // Get the `Swoole\\Server\\Port` object, $port[0] is the port of the main server\n            foreach ($port->connections as $fd) { // Traverse all connections\n                // $swoole->send($fd, 'Send tcp message');\n                // if($swoole->isEstablished($fd)) {\n                //     $swoole->push($fd, 'Send websocket message');\n                // }\n            }\n        }\n    }\n    ```\n\n2. Register Sockets.\n\n    ```php\n    // Edit `config/laravels.php`\n    //...\n    'sockets' => [\n        [\n            'host'     => '127.0.0.1',\n            'port'     => 5291,\n            'type'     => SWOOLE_SOCK_TCP,// Socket type: SWOOLE_SOCK_TCP/SWOOLE_SOCK_TCP6/SWOOLE_SOCK_UDP/SWOOLE_SOCK_UDP6/SWOOLE_UNIX_DGRAM/SWOOLE_UNIX_STREAM\n            'settings' => [// Swoole settingsï¼šhttps://www.swoole.co.uk/docs/modules/swoole-server-methods#swoole_server-addlistener\n                'open_eof_check' => true,\n                'package_eof'    => \"\\r\\n\",\n            ],\n            'handler'  => \\App\\Sockets\\TestTcpSocket::class,\n            'enable'   => true, // whether to enable, default true\n        ],\n    ],\n    ```\n\n    About the heartbeat configuration, it can only be set on the `main server` and cannot be configured on `Socket`, but the `Socket` inherits the heartbeat configuration of the `main server`.\n\n    For TCP socket, `onConnect` and `onClose` events will be blocked when `dispatch_mode` of Swoole is `1/3`, so if you want to unblock these two events please set `dispatch_mode` to `2/4/5`.\n\n    ```php\n    'swoole' => [\n        //...\n        'dispatch_mode' => 2,\n        //...\n    ];\n    ```\n\n3. Test.\n\n- TCP: `telnet 127.0.0.1 5291`\n\n- UDP: [Linux] `echo \"Hello LaravelS\" > /dev/udp/127.0.0.1/5292`\n\n4. Register example of other protocols.\n\n    - UDP\n    ```php\n    'sockets' => [\n        [\n            'host'     => '0.0.0.0',\n            'port'     => 5292,\n            'type'     => SWOOLE_SOCK_UDP,\n            'settings' => [\n                'open_eof_check' => true,\n                'package_eof'    => \"\\r\\n\",\n            ],\n            'handler'  => \\App\\Sockets\\TestUdpSocket::class,\n        ],\n    ],\n    ```\n\n    - Http\n    ```php\n    'sockets' => [\n        [\n            'host'     => '0.0.0.0',\n            'port'     => 5293,\n            'type'     => SWOOLE_SOCK_TCP,\n            'settings' => [\n                'open_http_protocol' => true,\n            ],\n            'handler'  => \\App\\Sockets\\TestHttp::class,\n        ],\n    ],\n    ```\n\n    - WebSocket: The main server must `turn on WebSocket`, that is, set `websocket.enable` to `true`.\n    ```php\n    'sockets' => [\n        [\n            'host'     => '0.0.0.0',\n            'port'     => 5294,\n            'type'     => SWOOLE_SOCK_TCP,\n            'settings' => [\n                'open_http_protocol'      => true,\n                'open_websocket_protocol' => true,\n            ],\n            'handler'  => \\App\\Sockets\\TestWebSocket::class,\n        ],\n    ],\n    ```\n\n## Coroutine\n\n> [Swoole Coroutine](https://www.swoole.co.uk/coroutine)\n\n- Warning: The order of code execution in the coroutine is out of order. The data of the request level should be isolated by the coroutine ID. However, there are many singleton and static attributes in Laravel/Lumen, the data between different requests will affect each other, it's `Unsafe`. For example, the database connection is a singleton, the same database connection shares the same PDO resource. This is fine in the synchronous blocking mode, but it does not work in the asynchronous coroutine mode. Each query needs to create different connections and maintain IO state of different connections, which requires a connection pool.\n\n- `DO NOT` enable the coroutine, only the custom process can use the coroutine.\n\n## Custom process\n\n> Support developers to create special work processes for monitoring, reporting, or other special tasks. Refer [addProcess](https://www.swoole.co.uk/docs/modules/swoole-server-methods#swoole_server-addprocess).\n\n1. Create Proccess class, implements CustomProcessInterface.\n\n    ```php\n    namespace App\\Processes;\n    use App\\Tasks\\TestTask;\n    use Hhxsv5\\LaravelS\\Swoole\\Process\\CustomProcessInterface;\n    use Hhxsv5\\LaravelS\\Swoole\\Task\\Task;\n    use Swoole\\Coroutine;\n    use Swoole\\Http\\Server;\n    use Swoole\\Process;\n    class TestProcess implements CustomProcessInterface\n    {\n        /**\n         * @var bool Quit tag for Reload updates\n         */\n        private static $quit = false;\n\n        public static function callback(Server $swoole, Process $process)\n        {\n            // The callback method cannot exit. Once exited, Manager process will automatically create the process \n            while (!self::$quit) {\n                \\Log::info('Test process: running');\n                // sleep(1); // Swoole < 2.1\n                Coroutine::sleep(1); // Swoole>=2.1: Coroutine & Runtime will be automatically enabled for callback(). Pay attention to the compatibility between the components used and the coroutines. If they are not compatible, only some coroutines can be enabled, such as: \\Swoole\\Runtime::enableCoroutine(SWOOLE_HOOK_TCP | SWOOLE_HOOK_SLEEP | SWOOLE_HOOK_FILE);\n                 // Deliver task in custom process, but NOT support callback finish() of task.\n                // Note: Modify task_ipc_mode to 1 or 2 in config/laravels.php, see https://www.swoole.co.uk/docs/modules/swoole-server/configuration\n                $ret = Task::deliver(new TestTask('task data'));\n                var_dump($ret);\n                // The upper layer will catch the exception thrown in the callback and record it in the Swoole log, and then this process will exit. The Manager process will re-create the process after 3 seconds, so developers need to try/catch to catch the exception by themselves to avoid frequent process creation.\n                // throw new \\Exception('an exception');\n            }\n        }\n        // Requirements: LaravelS >= v3.4.0 & callback() must be async non-blocking program.\n        public static function onReload(Server $swoole, Process $process)\n        {\n            // Stop the process...\n            // Then end process\n            \\Log::info('Test process: reloading');\n            self::$quit = true;\n            // $process->exit(0); // Force exit process\n        }\n        // Requirements: LaravelS >= v3.7.4 & callback() must be async non-blocking program.\n        public static function onStop(Server $swoole, Process $process)\n        {\n            // Stop the process...\n            // Then end process\n            \\Log::info('Test process: stopping');\n            self::$quit = true;\n            // $process->exit(0); // Force exit process\n        }\n    }\n    ```\n\n2. Register TestProcess.\n\n    ```php\n    // Edit `config/laravels.php`\n    // ...\n    'processes' => [\n        'test' => [ // Key name is process name\n            'class'    => \\App\\Processes\\TestProcess::class,\n            'redirect' => false, // Whether redirect stdin/stdout, true or false\n            'pipe'     => 0,     // The type of pipeline, 0: no pipeline 1: SOCK_STREAM 2: SOCK_DGRAM\n            'enable'   => true,  // Whether to enable, default true\n            //'num'    => 3   // To create multiple processes of this class, default is 1\n            //'queue'    => [ // Enable message queue as inter-process communication, configure empty array means use default parameters\n            //    'msg_key'  => 0,    // The key of the message queue. Default: ftok(__FILE__, 1).\n            //    'mode'     => 2,    // Communication mode, default is 2, which means contention mode\n            //    'capacity' => 8192, // The length of a single message, is limited by the operating system kernel parameters. The default is 8192, and the maximum is 65536\n            //],\n            //'restart_interval' => 5, // After the process exits abnormally, how many seconds to wait before restarting the process, default 5 seconds\n        ],\n    ],\n    ```\n\n3. Note: The callback() cannot quit. If quit, the Manager process will re-create the process.\n\n4. Example: Write data to a custom process.\n\n    ```php\n    // config/laravels.php\n    'processes' => [\n        'test' => [\n            'class'    => \\App\\Processes\\TestProcess::class,\n            'redirect' => false,\n            'pipe'     => 1,\n        ],\n    ],\n    ```\n\n    ```php\n    // app/Processes/TestProcess.php\n    public static function callback(Server $swoole, Process $process)\n    {\n        while ($data = $process->read()) {\n            \\Log::info('TestProcess: read data', [$data]);\n            $process->write('TestProcess: ' . $data);\n        }\n    }\n    ```\n\n    ```php\n    // app/Http/Controllers/TestController.php\n    public function testProcessWrite()\n    {\n        /**@var \\Swoole\\Process[] $process */\n        $customProcesses = \\Hhxsv5\\LaravelS\\LaravelS::getCustomProcesses();\n        $process = $customProcesses['test'];\n        $process->write('TestController: write data' . time());\n        var_dump($process->read());\n    }\n    ```\n\n## Common components\n\n### Apollo\n> `LaravelS` will pull the `Apollo` configuration and write it to the `.env` file when starting. At the same time, `LaravelS` will start the custom process `apollo` to monitor the configuration and automatically `reload` when the configuration changes.\n\n1. Enable Apollo: add `--enable-apollo` and Apollo parameters to the startup parameters.\n    \n    ```bash\n    php bin/laravels start --enable-apollo --apollo-server=http://127.0.0.1:8080 --apollo-app-id=LARAVEL-S-TEST\n    ```\n\n2. Support hot updates(optional).\n\n    ```php\n    // Edit `config/laravels.php`\n    'processes' => Hhxsv5\\LaravelS\\Components\\Apollo\\Process::getDefinition(),\n    ```\n\n    ```php\n    // When there are other custom process configurations\n    'processes' => [\n        'test' => [\n            'class'    => \\App\\Processes\\TestProcess::class,\n            'redirect' => false,\n            'pipe'     => 1,\n        ],\n        // ...\n    ] + Hhxsv5\\LaravelS\\Components\\Apollo\\Process::getDefinition(),\n    ```\n\n3. List of available parameters.\n\n| Parameter | Description | Default | Demo |\n| -------- | -------- | -------- | -------- |\n| apollo-server | Apollo server URL | - | --apollo-server=http://127.0.0.1:8080 |\n| apollo-app-id | Apollo APP ID | - | --apollo-app-id=LARAVEL-S-TEST |\n| apollo-namespaces | The namespace to which the APP belongs, support specify the multiple | application | --apollo-namespaces=application --apollo-namespaces=env |\n| apollo-cluster | The cluster to which the APP belongs | default | --apollo-cluster=default |\n| apollo-client-ip | IP of current instance, can also be used for grayscale publishing | Local intranet IP | --apollo-client-ip=10.2.1.83 |\n| apollo-pull-timeout | Timeout time(seconds) when pulling configuration | 5 | --apollo-pull-timeout=5 |\n| apollo-backup-old-env | Whether to backup the old configuration file when updating the configuration file `.env` | false | --apollo-backup-old-env |\n\n### Prometheus\n> Support Prometheus monitoring and alarm, Grafana visually view monitoring metrics. Please refer to [Docker Compose](https://github.com/hhxsv5/docker) for the environment construction of Prometheus and Grafana.\n\n1. Require extension [APCu >= 5.0.0](https://pecl.php.net/package/apcu), please install it by `pecl install apcu`.\n\n2. Copy the configuration file `prometheus.php` to the `config` directory of your project. Modify the configuration as appropriate.\n    ```bash\n    # Execute commands in the project root directory\n    cp vendor/hhxsv5/laravel-s/config/prometheus.php config/\n    ```\n    If your project is `Lumen`, you also need to manually load the configuration `$app->configure('prometheus');` in `bootstrap/app.php`.\n\n3. Configure `global` middleware: `Hhxsv5\\LaravelS\\Components\\Prometheus\\RequestMiddleware::class`. In order to count the request time consumption as accurately as possible, `RequestMiddleware` must be the `first` global middleware, which needs to be placed in front of other middleware.\n\n4. Register ServiceProvider: `Hhxsv5\\LaravelS\\Components\\Prometheus\\ServiceProvider::class`.\n\n5. Configure the CollectorProcess in `config/laravels.php` to collect the metrics of Swoole Worker/Task/Timer processes regularly.\n    ```php\n    'processes' => Hhxsv5\\LaravelS\\Components\\Prometheus\\CollectorProcess::getDefinition(),\n    ```\n\n6. Create the route to output metrics.\n    ```php\n    use Hhxsv5\\LaravelS\\Components\\Prometheus\\Exporter;\n\n    Route::get('/actuator/prometheus', function () {\n        $result = app(Exporter::class)->render();\n        return response($result, 200, ['Content-Type' => Exporter::REDNER_MIME_TYPE]);\n    });\n    ```\n\n7. Complete the configuration of Prometheus and start it.\n    ```yml\n    global:\n      scrape_interval: 5s\n      scrape_timeout: 5s\n      evaluation_interval: 30s\n    scrape_configs:\n    - job_name: laravel-s-test\n      honor_timestamps: true\n      metrics_path: /actuator/prometheus\n      scheme: http\n      follow_redirects: true\n      static_configs:\n      - targets:\n        - 127.0.0.1:5200 # The ip and port of the monitored service\n    # Dynamically discovered using one of the supported service-discovery mechanisms\n    # https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config\n    # - job_name: laravels-eureka\n    #   honor_timestamps: true\n    #   scrape_interval: 5s\n    #   metrics_path: /actuator/prometheus\n    #   scheme: http\n    #   follow_redirects: true\n      # eureka_sd_configs:\n      # - server: http://127.0.0.1:8080/eureka\n      #   follow_redirects: true\n      #   refresh_interval: 5s\n    ```\n\n8. Start Grafana, then import [panel json](https://github.com/hhxsv5/laravel-s/tree/PHP-8.x/grafana-dashboard.json).\n\n<img src=\"https://raw.githubusercontent.com/hhxsv5/laravel-s/PHP-8.x/grafana-dashboard.png\" height=\"800px\" alt=\"Grafana Dashboard\">\n\n## Other features\n\n### Configure Swoole events\n\nSupported events:\n\n| Event | Interface | When happened |\n| -------- | -------- | -------- |\n| ServerStart | Hhxsv5\\LaravelS\\Swoole\\Events\\ServerStartInterface | Occurs when the Master process is starting, `this event should not handle complex business logic, and can only do some simple work of initialization`. |\n| ServerStop | Hhxsv5\\LaravelS\\Swoole\\Events\\ServerStopInterface | Occurs when the server exits normally, `CANNOT use async or coroutine related APIs in this event`. |\n| WorkerStart | Hhxsv5\\LaravelS\\Swoole\\Events\\WorkerStartInterface | Occurs after the Worker/Task process is started, and the Laravel initialization has been completed. |\n| WorkerStop | Hhxsv5\\LaravelS\\Swoole\\Events\\WorkerStopInterface | Occurs after the Worker/Task process exits normally |\n| WorkerError | Hhxsv5\\LaravelS\\Swoole\\Events\\WorkerErrorInterface | Occurs when an exception or fatal error occurs in the Worker/Task process |\n\n1.Create an event class to implement the corresponding interface.\n```php\nnamespace App\\Events;\nuse Hhxsv5\\LaravelS\\Swoole\\Events\\ServerStartInterface;\nuse Swoole\\Atomic;\nuse Swoole\\Http\\Server;\nclass ServerStartEvent implements ServerStartInterface\n{\n    public function __construct()\n    {\n    }\n    public function handle(Server $server)\n    {\n        // Initialize a global counter (available across processes)\n        $server->atomicCount = new Atomic(2233);\n\n        // Invoked in controller: app('swoole')->atomicCount->get();\n    }\n}\n```\n\n```php\nnamespace App\\Events;\nuse Hhxsv5\\LaravelS\\Swoole\\Events\\WorkerStartInterface;\nuse Swoole\\Http\\Server;\nclass WorkerStartEvent implements WorkerStartInterface\n{\n    public function __construct()\n    {\n    }\n    public function handle(Server $server, $workerId)\n    {\n        // Initialize a database connection pool\n        // DatabaseConnectionPool::init();\n    }\n}\n```\n2.Configuration.\n```php\n// Edit `config/laravels.php`\n'event_handlers' => [\n    'ServerStart' => [\\App\\Events\\ServerStartEvent::class], // Trigger events in array order\n    'WorkerStart' => [\\App\\Events\\WorkerStartEvent::class],\n],\n```\n\n### Serverless\n\n#### Alibaba Cloud Function Compute\n> [Function Compute](https://www.alibabacloud.com/help/product/50980.htm).\n\n1.Modify `bootstrap/app.php` and set the storage directory. Because the project directory is read-only, the `/tmp` directory can only be read and written.\n\n```php\n$app->useStoragePath(env('APP_STORAGE_PATH', '/tmp/storage'));\n```\n\n2.Create a shell script `laravels_bootstrap` and grant `executable permission`.\n\n```bash\n#!/usr/bin/env bash\nset +e\n\n# Create storage-related directories\nmkdir -p /tmp/storage/app/public\nmkdir -p /tmp/storage/framework/cache\nmkdir -p /tmp/storage/framework/sessions\nmkdir -p /tmp/storage/framework/testing\nmkdir -p /tmp/storage/framework/views\nmkdir -p /tmp/storage/logs\n\n# Set the environment variable APP_STORAGE_PATH, please make sure it's the same as APP_STORAGE_PATH in .env\nexport APP_STORAGE_PATH=/tmp/storage\n\n# Start LaravelS\nphp bin/laravels start\n```\n\n3.Configure `template.xml`.\n\n```xml\nROSTemplateFormatVersion: '2015-09-01'\nTransform: 'Aliyun::Serverless-2018-04-03'\nResources:\n  laravel-s-demo:\n    Type: 'Aliyun::Serverless::Service'\n    Properties:\n      Description: 'LaravelS Demo for Serverless'\n    fc-laravel-s:\n      Type: 'Aliyun::Serverless::Function'\n      Properties:\n        Handler: laravels.handler\n        Runtime: custom\n        MemorySize: 512\n        Timeout: 30\n        CodeUri: ./\n        InstanceConcurrency: 10\n        EnvironmentVariables:\n          BOOTSTRAP_FILE: laravels_bootstrap\n\n```\n\n## Important notices\n\n### Singleton Issue\n\n- Under FPM mode, singleton instances will be instantiated and recycled in every request, request start=>instantiate instance=>request end=>recycled instance.\n\n- Under Swoole Server, All singleton instances will be held in memory, different lifetime from FPM, request start=>instantiate instance=>request end=>do not recycle singleton instance. So need developer to maintain status of singleton instances in every request.\n\n- Common solutions:\n\n    1. Write a `XxxCleaner` class to clean up the singleton object state. This class implements the interface `Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\CleanerInterface` and then registers it in `cleaners` of `laravels.php`.\n\n    2. `Reset` status of singleton instances by `Middleware`.\n\n    1. Re-register `ServiceProvider`, add `XxxServiceProvider` into `register_providers` of file `laravels.php`. So that reinitialize singleton instances in every request [Refer](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/Settings.md#register_providers).\n\n### Cleaners\n> [Configuration cleaners](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/Settings.md#cleaners).\n\n### Known issues\n> [Known issues](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/KnownIssues.md): a package of known issues and solutions.\n\n### Debugging method\n\n- Logging; if you want to output to the console, you can use `stderr`, Log::channel('stderr')->debug('debug message').\n\n- [Laravel Dump Server](https://github.com/beyondcode/laravel-dump-server)(Laravel 5.7 has been integrated by default).\n\n### Read request\nRead request by `Illuminate\\Http\\Request` Object, $_ENV is readable, $_SERVER is partially readable, `CANNOT USE` $_GET/$_POST/$_FILES/$_COOKIE/$_REQUEST/$_SESSION/$GLOBALS.\n\n```php\npublic function form(\\Illuminate\\Http\\Request $request)\n{\n    $name = $request->input('name');\n    $all = $request->all();\n    $sessionId = $request->cookie('sessionId');\n    $photo = $request->file('photo');\n    // Call getContent() to get the raw POST body, instead of file_get_contents('php://input')\n    $rawContent = $request->getContent();\n    //...\n}\n```\n\n### Output response\nRespond by `Illuminate\\Http\\Response` Object, compatible with echo/vardump()/print_r()ï¼Œ`CANNOT USE` functions dd()/exit()/die()/header()/setcookie()/http_response_code().\n\n```php\npublic function json()\n{\n    return response()->json(['time' => time()])->header('header1', 'value1')->withCookie('c1', 'v1');\n}\n```\n\n### Persistent connection\n`Singleton connection` will be resident in memory, it is recommended to turn on `persistent connection` for better performance.\n1. Database connection, it `will` reconnect automatically `immediately` after disconnect.\n\n```php\n// config/database.php\n'connections' => [\n    'my_conn' => [\n        'driver'    => 'mysql',\n        'host'      => env('DB_MY_CONN_HOST', 'localhost'),\n        'port'      => env('DB_MY_CONN_PORT', 3306),\n        'database'  => env('DB_MY_CONN_DATABASE', 'forge'),\n        'username'  => env('DB_MY_CONN_USERNAME', 'forge'),\n        'password'  => env('DB_MY_CONN_PASSWORD', ''),\n        'charset'   => 'utf8mb4',\n        'collation' => 'utf8mb4_unicode_ci',\n        'prefix'    => '',\n        'strict'    => false,\n        'options'   => [\n            // Enable persistent connection\n            \\PDO::ATTR_PERSISTENT => true,\n        ],\n    ],\n],\n```\n\n2. Redis connection, it `won't` reconnect automatically `immediately` after disconnect, and will throw an exception about lost connection, reconnect next time. You need to make sure that `SELECT DB` correctly before operating Redis every time.\n\n```php\n// config/database.php\n'redis' => [\n    'client' => env('REDIS_CLIENT', 'phpredis'), // It is recommended to use phpredis for better performance.\n    'default' => [\n        'host'       => env('REDIS_HOST', 'localhost'),\n        'password'   => env('REDIS_PASSWORD', null),\n        'port'       => env('REDIS_PORT', 6379),\n        'database'   => 0,\n        'persistent' => true, // Enable persistent connection\n    ],\n],\n```\n\n### About memory leaks\n\n- Avoid using global variables. If necessary, please clean or reset them manually.\n\n- Infinitely appending element into `static`/`global` variable will lead to OOM(Out of Memory).\n\n    ```php\n    class Test\n    {\n        public static $array = [];\n        public static $string = '';\n    }\n\n    // Controller\n    public function test(Request $req)\n    {\n        // Out of Memory\n        Test::$array[] = $req->input('param1');\n        Test::$string .= $req->input('param2');\n    }\n    ```\n\n- Memory leak detection method\n\n    1. Modify `config/laravels.php`: `worker_num=1, max_request=1000000`, remember to change it back after test;\n\n    2. Add routing `/debug-memory-leak` without `route middleware` to observe the memory changes of the `Worker` process;\n\n    ```php\n    Route::get('/debug-memory-leak', function () {\n        global $previous;\n        $current = memory_get_usage();\n        $stats = [\n            'prev_mem' => $previous,\n            'curr_mem' => $current,\n            'diff_mem' => $current - $previous,\n        ];\n        $previous = $current;\n        return $stats;\n    });\n    ```\n\n    3. Start `LaravelS` and request `/debug-memory-leak` until `diff_mem` is less than or equal to zero; if `diff_mem` is always greater than zero, it means that there may be a memory leak in `Global Middleware` or `Laravel Framework`;\n    \n    4. After completing `Step 3`, `alternately` request the business routes and `/debug-memory-leak` (It is recommended to use `ab`/`wrk` to make a large number of requests for business routes), the initial increase in memory is normal. After a large number of requests for the business routes, if `diff_mem` is always greater than zero and `curr_mem` continues to increase, there is a high probability of memory leak; If `curr_mem` always changes within a certain range and does not continue to increase, there is a low probability of memory leak.\n\n    5. If you still can't solve it, [max_request](https://www.swoole.co.uk/docs/modules/swoole-server/configuration#max_request) is the last guarantee.\n\n### Linux kernel parameter adjustment\n> [Linux kernel parameter adjustment](https://wiki.swoole.com/#/other/sysctl?id=%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0%e8%b0%83%e6%95%b4)\n\n### Pressure test\n> [Pressure test](https://wiki.swoole.com/wiki/page/62.html)\n\n## Alternatives\n\n- [swooletw/laravel-swoole](https://github.com/swooletw/laravel-swoole)\n\n## Sponsor\n\n- [PayPal](https://www.paypal.me/hhxsv5)\n\n- [BTC](https://www.blockchain.com/btc/address/367HnAzVTAEk8offesDhcsCQswnugsE54u)\n\n- [Gitee](https://gitee.com/hhxsv5/laravel-s?donate=true)\n\n## License\n\n[MIT](https://github.com/hhxsv5/laravel-s/blob/PHP-8.x/LICENSE)\n"
        },
        {
          "name": "Settings-CN.md",
          "type": "blob",
          "size": 5.8916015625,
          "content": "# LaravelS é…ç½®é¡¹\n\n## listen_ip\n> `string` ç›‘å¬çš„IPï¼Œç›‘å¬æœ¬æœº`127.0.0.1`(IPv4) `::1`(IPv6)ï¼Œç›‘å¬æ‰€æœ‰åœ°å€ `0.0.0.0`(IPv4) `::`(IPv6)ï¼Œ é»˜è®¤`127.0.0.1`ã€‚\n\n## listen_port\n> `int` ç›‘å¬çš„ç«¯å£ï¼Œå¦‚æœç«¯å£å°äº1024åˆ™éœ€è¦`root`æƒé™ï¼Œé»˜è®¤ `5200`ã€‚\n\n## socket_type\n> é»˜è®¤`SWOOLE_SOCK_TCP`ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ— éœ€å…³å¿ƒè¿™ä¸ªé…ç½®ã€‚è‹¥éœ€Nginxä»£ç†è‡³`UnixSocket Stream`æ–‡ä»¶ï¼Œåˆ™éœ€ä¿®æ”¹ä¸º`SWOOLE_SOCK_UNIX_STREAM`ï¼Œæ­¤æ—¶`listen_ip`åˆ™æ˜¯`UnixSocket Stream`æ–‡ä»¶çš„è·¯å¾„ã€‚\n\n## server\n> `string` å½“é€šè¿‡LaravelSå“åº”æ•°æ®æ—¶ï¼Œè®¾ç½®HTTPå¤´éƒ¨`Server`çš„å€¼ï¼Œè‹¥ä¸ºç©ºåˆ™ä¸è®¾ç½®ï¼Œé»˜è®¤ `LaravelS`ã€‚\n\n## handle_static\n> `bool` æ˜¯å¦å¼€å¯LaravelSå¤„ç†é™æ€èµ„æº(è¦æ±‚ `Swoole >= 1.7.21`ï¼Œè‹¥`Swoole >= 1.9.17`åˆ™ç”±Swooleè‡ªå·±å¤„ç†)ï¼Œé»˜è®¤`false`ï¼Œå»ºè®®Nginxå¤„ç†é™æ€èµ„æºï¼ŒLaravelSä»…å¤„ç†åŠ¨æ€èµ„æºã€‚é™æ€èµ„æºçš„é»˜è®¤è·¯å¾„ä¸º`base_path('public')`ï¼Œå¯é€šè¿‡ä¿®æ”¹`swoole.document_root`å˜æ›´ã€‚\n\n## laravel_base_path\n> `string` `Laravel/Lumen`çš„åŸºç¡€è·¯å¾„ï¼Œé»˜è®¤`base_path()`ï¼Œå¯ç”¨äºé…ç½®`ç¬¦å·é“¾æ¥`ã€‚\n\n## inotify_reload.enable\n> `bool` æ˜¯å¦å¼€å¯`Inotify Reload`ï¼Œç”¨äºå½“ä¿®æ”¹ä»£ç åå®æ—¶Reloadæ‰€æœ‰workerè¿›ç¨‹ï¼Œä¾èµ–åº“[inotify](http://pecl.php.net/package/inotify)ï¼Œé€šè¿‡å‘½ä»¤`php --ri inotify`æ£€æŸ¥æ˜¯å¦å¯ç”¨ï¼Œé»˜è®¤`false`ï¼Œ`å»ºè®®ä»…å¼€å‘ç¯å¢ƒå¼€å¯`ï¼Œ[ä¿®æ”¹ç›‘å¬æ•°ä¸Šé™](https://github.com/hhxsv5/laravel-s/blob/master/KnownIssues-CN.md#inotify%E7%9B%91%E5%90%AC%E6%96%87%E4%BB%B6%E6%95%B0%E8%BE%BE%E5%88%B0%E4%B8%8A%E9%99%90)ã€‚\n \n## inotify_reload.watch_path\n> `string` `Inotify` ç›‘æ§çš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤æœ‰`base_path()`ã€‚\n\n## inotify_reload.file_types\n> `array` `Inotify` ç›‘æ§çš„æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤æœ‰`.php`ã€‚\n\n## inotify_reload.excluded_dirs\n> `array` `Inotify` ç›‘æ§æ—¶éœ€è¦æ’é™¤(æˆ–å¿½ç•¥)çš„ç›®å½•ï¼Œé»˜è®¤`[]`ï¼Œç¤ºä¾‹ï¼š`[base_path('vendor')]`ã€‚\n\n## inotify_reload.log\n> `bool` æ˜¯å¦è¾“å‡ºReloadçš„æ—¥å¿—ï¼Œé»˜è®¤`true`ã€‚\n\n## event_handlers\n> `array` é…ç½®`Swoole`çš„äº‹ä»¶å›è°ƒå‡½æ•°ï¼Œkey-valueæ ¼å¼ï¼Œkeyä¸ºäº‹ä»¶åï¼Œvalueä¸ºå®ç°äº†äº‹ä»¶å¤„ç†æ¥å£çš„ç±»ï¼Œå‚è€ƒ[ç¤ºä¾‹](https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E9%85%8D%E7%BD%AEswoole%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0)ã€‚\n\n## websocket.enable\n> `bool` æ˜¯å¦å¯ç”¨WebSocketæœåŠ¡å™¨ã€‚å¯ç”¨åWebSocketæœåŠ¡å™¨ç›‘å¬çš„IPå’Œç«¯å£ä¸HttpæœåŠ¡å™¨ç›¸åŒï¼Œé»˜è®¤`false`ã€‚\n\n## websocket.handler\n> `string` WebSocketé€»è¾‘å¤„ç†çš„ç±»åï¼Œéœ€å®ç°æ¥å£`WebSocketHandlerInterface`ï¼Œå‚è€ƒ[ç¤ºä¾‹](https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E5%90%AF%E7%94%A8websocket%E6%9C%8D%E5%8A%A1%E5%99%A8)ã€‚\n\n## sockets\n> `array` é…ç½®`TCP/UDP`å¥—æ¥å­—åˆ—è¡¨ï¼Œå‚è€ƒ[ç¤ºä¾‹](https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E5%A4%9A%E7%AB%AF%E5%8F%A3%E6%B7%B7%E5%90%88%E5%8D%8F%E8%AE%AE)ã€‚\n\n## processes\n> `array` é…ç½®è‡ªå®šä¹‰è¿›ç¨‹åˆ—è¡¨ï¼Œå‚è€ƒ[ç¤ºä¾‹](https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%9B%E7%A8%8B)ã€‚\n\n## timer\n> `array` é…ç½®æ¯«ç§’å®šæ—¶å™¨ï¼Œå‚è€ƒ[ç¤ºä¾‹](https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E6%AF%AB%E7%A7%92%E7%BA%A7%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1)ã€‚\n\n## swoole_tables\n> `array` å®šä¹‰çš„`swoole_table`åˆ—è¡¨ï¼Œå‚è€ƒ[ç¤ºä¾‹](https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E4%BD%BF%E7%94%A8swoole_table)ã€‚\n\n## cleaners\n> `array` `æ¯æ¬¡è¯·æ±‚`çš„æ¸…ç†å™¨åˆ—è¡¨ï¼Œç”¨äºæ¸…ç†ä¸€äº›æ®‹ç•™çš„å…¨å±€å˜é‡ã€å•ä¾‹å¯¹è±¡ã€é™æ€å±æ€§ï¼Œé¿å…å¤šæ¬¡è¯·æ±‚é—´æ•°æ®æ±¡æŸ“ã€‚è¿™äº›æ¸…ç†å™¨ç±»å¿…é¡»å®ç°æ¥å£`Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\CleanerInterface`ã€‚æ¸…ç†çš„é¡ºåºä¸æ•°ç»„çš„é¡ºåºä¿æŒä¸€è‡´ã€‚[è¿™äº›æ¸…ç†å™¨](https://github.com/hhxsv5/laravel-s/blob/master/src/Illuminate/CleanerManager.php#L31)é»˜è®¤å·²å¯ç”¨ï¼Œæ— éœ€å†é…ç½®ã€‚\n\n```php\n// å¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†Sessionã€Authenticationã€Passportï¼Œéœ€é…ç½®å¦‚ä¸‹æ¸…ç†å™¨\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\SessionCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\AuthCleaner::class,\n],\n```\n\n```php\n// å¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†åŒ…\"tymon/jwt-auth\"ï¼Œéœ€é…ç½®å¦‚ä¸‹æ¸…ç†å™¨\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\SessionCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\AuthCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\JWTCleaner::class,\n],\n```\n\n```php\n// å¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†åŒ…\"spatie/laravel-menu\"ï¼Œéœ€é…ç½®å¦‚ä¸‹æ¸…ç†å™¨\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\MenuCleaner::class,\n],\n```\n\n```php\n// å¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†åŒ…\"encore/laravel-admin\"ï¼Œéœ€é…ç½®å¦‚ä¸‹æ¸…ç†å™¨\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\SessionCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\AuthCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\LaravelAdminCleaner::class,\n],\n```\n\n```php\n// å¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†åŒ…\"jqhph/dcat-admin\"\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\SessionCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\AuthCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\DcatAdminCleaner::class,\n],\n```\n\n```php\n// å¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†åŒ…\"tightenco/ziggy\"ï¼Œè§£å†³\"Ziggy is not defined\"\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\ZiggyCleaner::class,\n],\n```\n\n## register_providers\n> `array` `æ¯æ¬¡è¯·æ±‚`éœ€è¦é‡æ–°æ³¨å†Œçš„`Service Provider`åˆ—è¡¨ï¼Œè‹¥å­˜åœ¨`boot()`æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œã€‚ä¸€èˆ¬ç”¨äºæ¸…ç†`æ³¨å†Œäº†å•ä¾‹çš„ServiceProvider`ã€‚\n\n```php\n//...\n'register_providers' => [\n    \\Xxx\\Yyy\\XxxServiceProvider::class,\n],\n//...\n```\n\n## destroy_controllers\n> `array` æ¯æ¬¡è¯·æ±‚åè‡ªåŠ¨é”€æ¯æ§åˆ¶å™¨ï¼Œè§£å†³å•ä¾‹æ§åˆ¶å™¨çš„é—®é¢˜ï¼Œå‚è€ƒ[ç¤ºä¾‹](https://github.com/hhxsv5/laravel-s/blob/master/KnownIssues-CN.md#%E5%8D%95%E4%BE%8B%E6%8E%A7%E5%88%B6%E5%99%A8)ã€‚\n\n## swoole\n> `array` Swooleçš„`åŸå§‹`é…ç½®é¡¹ï¼Œè¯·å‚è€ƒ[SwooleæœåŠ¡å™¨é…ç½®é¡¹](https://wiki.swoole.com/#/server/setting)ã€‚"
        },
        {
          "name": "Settings.md",
          "type": "blob",
          "size": 5.9853515625,
          "content": "# LaravelS Settings\n\n## listen_ip\n> `string` The listening ip, like local address `127.0.0.1`(IPv4) `::1`(IPv6), all addresses `0.0.0.0`(IPv4) `::`(IPv6), default `127.0.0.1`.\n\n## listen_port\n> `int` The listening port, need `root` permission if port less than `1024`, default `5200`.\n\n## socket_type\n> `int` Default `SWOOLE_SOCK_TCP`. Usually, you donâ€™t need to care about it. Unless you want Nginx to proxy to the `UnixSocket Stream` file, you need to modify it to `SWOOLE_SOCK_UNIX_STREAM`, and `listen_ip` is the path of `UnixSocket Stream` file.\n\n## server\n> `string` Set HTTP header `Server` when respond by LaravelS, default `LaravelS`.\n\n## handle_static\n> `bool` Whether handle the static resource by LaravelS(Require `Swoole >= 1.7.21`, Handle by Swoole if `Swoole >= 1.9.17`), default `false`, Suggest that Nginx handles the statics and LaravelS handles the dynamics. The default path of static resource is `base_path('public')`, you can modify `swoole.document_root` to change it.\n\n## laravel_base_path\n> `string` The basic path of `Laravel/Lumen`, default `base_path()`, be used for `symbolic link`.\n\n## inotify_reload.enable\n> `bool` Whether enable the `Inotify Reload` to reload all worker processes when your code is modified, depend on [inotify](http://pecl.php.net/package/inotify), use `php --ri inotify` to check whether the available. default `false`, `recommend to enable in development environment only`, change [Watchers Limit](https://github.com/hhxsv5/laravel-s/blob/master/KnownIssues.md#inotify-reached-the-watchers-limit).\n\n## inotify_reload.watch_path\n> `string` The file path that `Inotify` watches, default `base_path()`.\n\n## inotify_reload.file_types\n> `array` The file types that `Inotify` watches, default `['.php']`.\n\n## inotify_reload.excluded_dirs\n> `array` The excluded/ignored directories that `Inotify` watches, default `[]`, eg: `[base_path('vendor')]`.\n\n## inotify_reload.log\n> `bool` Whether output the reload log, default `true`.\n\n## event_handlers\n> `array` Configure the event callback function of `Swoole`, key-value format, key is the event name, and value is the class that implements the event processing interface, refer [Demo](https://github.com/hhxsv5/laravel-s/blob/master/README.md#configuring-the-event-callback-function-of-swoole).\n\n## websocket.enable\n> `bool` Whether enable WebSocket Server. The Listening address of WebSocket Sever is the same as Http Server, default `false`.\n\n## websocket.handler\n> `string` The class name for WebSocket handler, needs to implement interface `WebSocketHandlerInterface`, refer [Demo](https://github.com/hhxsv5/laravel-s/blob/master/README.md#enable-websocket-server).\n\n## sockets\n> `array` The socket list for TCP/UDP, refer [Demo](https://github.com/hhxsv5/laravel-s/blob/master/README.md#multi-port-mixed-protocol).\n\n## processes\n> `array` The custom process list, refer [Demo](https://github.com/hhxsv5/laravel-s/blob/master/README.md#custom-process).\n\n## timer\n> `array` The millisecond timer, refer [Demo](https://github.com/hhxsv5/laravel-s/blob/master/README.md#millisecond-cron-job).\n\n## swoole_tables\n> `array` The defined of `swoole_table` list, refer [Demo](https://github.com/hhxsv5/laravel-s/blob/master/README.md#use-swoole_table).\n\n## cleaners\n> `array` The list of cleaners for `each request` is used to clean up some residual global variables, singleton objects, and static properties to avoid data pollution between requests, these classes must implement interface `Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\CleanerInterface`. The order of cleanup is consistent with the order of the arrays. [These cleaners](https://github.com/hhxsv5/laravel-s/blob/master/src/Illuminate/CleanerManager.php#L31) enabled by default, and do not need to be configured.\n\n```php\n// Need to configure the following cleaners if you use the session/authentication/passport in your project\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\SessionCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\AuthCleaner::class,\n],\n```\n\n```php\n// Need to configure the following cleaners if you use the package \"tymon/jwt-auth\" in your project\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\SessionCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\AuthCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\JWTCleaner::class,\n],\n```\n\n```php\n// Need to configure the following cleaners if you use the package \"spatie/laravel-menu\" in your project\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\MenuCleaner::class,\n],\n```\n\n```php\n// Need to configure the following cleaners if you use the package \"encore/laravel-admin\" in your project\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\SessionCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\AuthCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\LaravelAdminCleaner::class,\n],\n```\n\n```php\n// Need to configure the following cleaners if you use the package \"jqhph/dcat-admin\" in your project\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\SessionCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\AuthCleaner::class,\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\DcatAdminCleaner::class,\n],\n```\n\n```php\n// Need to configure the following cleaners if you use the package \"tightenco/ziggy\" in your project to solve \"Ziggy is not defined\"\n'cleaners' => [\n    Hhxsv5\\LaravelS\\Illuminate\\Cleaners\\ZiggyCleaner::class,\n],\n```\n\n## register_providers\n> `array` The `Service Provider` list, will be re-registered `each request`, and run method `boot()` if it exists. Usually, be used to clear the `Service Provider` which registers `Singleton` instances.\n\n```php\n//...\n'register_providers' => [\n    \\Xxx\\Yyy\\XxxServiceProvider::class,\n],\n//...\n```\n\n## destroy_controllers\n> `array` Automatically destroy the controllers after each request to solve the problem of the singleton controllers, refer [Demo](https://github.com/hhxsv5/laravel-s/blob/master/KnownIssues.md#singleton-controller).\n\n## swoole\n> `array` Swoole's `original` configuration items, refer [Swoole Server Configuration](https://www.swoole.co.uk/docs/modules/swoole-server/configuration)."
        },
        {
          "name": "bin",
          "type": "tree",
          "content": null
        },
        {
          "name": "composer.json",
          "type": "blob",
          "size": 1.521484375,
          "content": "{\n  \"name\": \"hhxsv5/laravel-s\",\n  \"type\": \"library\",\n  \"license\": \"MIT\",\n  \"support\": {\n    \"issues\": \"https://github.com/hhxsv5/laravel-s/issues\",\n    \"source\": \"https://github.com/hhxsv5/laravel-s\"\n  },\n  \"description\": \"ğŸš€ LaravelS is an out-of-the-box adapter between Laravel/Lumen and Swoole.\",\n  \"keywords\": [\n    \"laravels\",\n    \"laravel-s\",\n    \"swoole\",\n    \"laravel\",\n    \"lumen\",\n    \"async\",\n    \"coroutine\",\n    \"server\",\n    \"http\",\n    \"websocket\",\n    \"tcp\",\n    \"udp\",\n    \"process\",\n    \"task\",\n    \"timer\",\n    \"inotify\",\n    \"performance\"\n  ],\n  \"homepage\": \"https://github.com/hhxsv5/laravel-s\",\n  \"authors\": [\n    {\n      \"name\": \"Xie Biao\",\n      \"email\": \"hhxsv5@sina.com\"\n    }\n  ],\n  \"require\": {\n    \"php\": \">=8.2\",\n    \"ext-curl\": \"*\",\n    \"ext-json\": \"*\",\n    \"ext-pcntl\": \"*\",\n    \"swoole/ide-helper\": \"@dev\",\n    \"symfony/console\": \">=6.4.0\"\n  },\n  \"suggest\": {\n    \"ext-swoole\": \"Coroutine-based concurrency library for PHP, require >= 1.7.19.\",\n    \"ext-inotify\": \"Inotify, used to real-time reload.\"\n  },\n  \"autoload\": {\n    \"psr-4\": {\n      \"Hhxsv5\\\\LaravelS\\\\\": \"src\"\n    }\n  },\n  \"extra\": {\n    \"laravel\": {\n      \"providers\": [\n        \"Hhxsv5\\\\LaravelS\\\\Illuminate\\\\LaravelSServiceProvider\"\n      ]\n    }\n  },\n  \"bin\": [\n    \"bin/fswatch\"\n  ],\n  \"prefer-stable\": true,\n  \"minimum-stability\": \"dev\",\n  \"require-dev\": {\n    \"phpunit/phpunit\": \">=4.8.36\"\n  },\n  \"autoload-dev\": {\n    \"psr-4\": {\n      \"Hhxsv5\\\\LaravelS\\\\Tests\\\\\": \"tests\"\n    }\n  },\n  \"scripts\": {\n    \"test\": \"./vendor/bin/phpunit -c phpunit.xml\"\n  }\n}\n"
        },
        {
          "name": "config",
          "type": "tree",
          "content": null
        },
        {
          "name": "grafana-dashboard.json",
          "type": "blob",
          "size": 58.0361328125,
          "content": "{\n  \"annotations\": {\n    \"list\": [\n      {\n        \"builtIn\": 1,\n        \"datasource\": \"-- Grafana --\",\n        \"enable\": true,\n        \"hide\": true,\n        \"iconColor\": \"rgba(0, 211, 255, 1)\",\n        \"limit\": 100,\n        \"name\": \"Annotations & Alerts\",\n        \"showIn\": 0,\n        \"type\": \"dashboard\"\n      }\n    ]\n  },\n  \"description\": \"\",\n  \"editable\": true,\n  \"gnetId\": null,\n  \"graphTooltip\": 1,\n  \"id\": 1,\n  \"iteration\": 1734057491478,\n  \"links\": [],\n  \"panels\": [\n    {\n      \"collapsed\": false,\n      \"datasource\": null,\n      \"gridPos\": {\n        \"h\": 1,\n        \"w\": 24,\n        \"x\": 0,\n        \"y\": 0\n      },\n      \"id\": 30,\n      \"panels\": [],\n      \"title\": \"HTTP Request\",\n      \"type\": \"row\"\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"description\": \"\",\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 1\n      },\n      \"hiddenSeries\": false,\n      \"id\": 6,\n      \"interval\": null,\n      \"legend\": {\n        \"avg\": true,\n        \"current\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"maxDataPoints\": null,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(rate(http_server_requests_seconds_count{application=\\\"$application\\\"}[1m])) by (application, method)\",\n          \"hide\": false,\n          \"interval\": \"1\",\n          \"legendFormat\": \"{{application}}-{{method}}\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(rate(http_server_requests_seconds_count{application=\\\"$application\\\"}[1m])) by (application)\",\n          \"hide\": false,\n          \"interval\": \"1\",\n          \"legendFormat\": \"{{application}}\",\n          \"refId\": \"B\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(rate(swoole_request_count{application=\\\"$application\\\"}[1m])) by (application)\",\n          \"hide\": false,\n          \"interval\": \"1\",\n          \"legendFormat\": \"{{application}}-Swoole\",\n          \"refId\": \"C\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(rate(swoole_request_count{application=\\\"$application\\\"}[1m])) by (application)-sum(rate(http_server_requests_seconds_count{application=\\\"$application\\\"}[1m])) by (application)\",\n          \"hide\": true,\n          \"interval\": \"1\",\n          \"legendFormat\": \"{{application}}-Not Included(404...)\",\n          \"refId\": \"D\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Total RPS\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:550\",\n          \"format\": \"reqps\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:551\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 1\n      },\n      \"hiddenSeries\": false,\n      \"id\": 4,\n      \"interval\": null,\n      \"legend\": {\n        \"avg\": true,\n        \"current\": false,\n        \"max\": true,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"topk(20, sum(rate(http_server_requests_seconds_count{application=\\\"$application\\\"}[1m])) by (application, method, uri))\",\n          \"format\": \"time_series\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"1\",\n          \"legendFormat\": \"{{application}}-{{method}}-{{uri}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Top RPS\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:143\",\n          \"format\": \"reqps\",\n          \"label\": \"\",\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:144\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 9\n      },\n      \"hiddenSeries\": false,\n      \"id\": 8,\n      \"interval\": null,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": true,\n        \"hideEmpty\": false,\n        \"hideZero\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"topk(20, sum(rate(http_server_requests_seconds_count{application=\\\"$application\\\",status=~\\\"5..\\\"}[1m])) by (application, method, uri))\",\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{method}}-{{uri}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Total 5xx\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:74\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:75\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": 1\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"description\": \"\",\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 9\n      },\n      \"hiddenSeries\": false,\n      \"id\": 10,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"rightSide\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"topk(20, sum(rate(http_server_requests_seconds_count{application=\\\"$application\\\",status=~\\\"5..\\\"}[1m])) by (application, method, uri) / sum(rate(http_server_requests_seconds_count{application=\\\"$application\\\"}[1m])) by (application, method, uri))\",\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{method}}-{{uri}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"5xx Percentage\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"min\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:242\",\n          \"format\": \"percentunit\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:243\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 17\n      },\n      \"hiddenSeries\": false,\n      \"id\": 2,\n      \"interval\": null,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": true,\n        \"current\": true,\n        \"max\": true,\n        \"min\": true,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"topk(20, sum(rate(http_server_requests_seconds_sum{application=\\\"$application\\\"}[1m])) by (application, method, uri)/sum(rate(http_server_requests_seconds_count{application=\\\"$application\\\"}[1m])) by (application, method, uri))\",\n          \"format\": \"time_series\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{method}}-{{uri}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Avg Duration\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:24\",\n          \"format\": \"Âµs\",\n          \"label\": \"\",\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:25\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 17\n      },\n      \"hiddenSeries\": false,\n      \"id\": 40,\n      \"interval\": null,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": true,\n        \"current\": true,\n        \"max\": true,\n        \"min\": true,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"topk(20, max(http_server_requests_seconds_max{application=\\\"$application\\\"}) by (application, method, uri))\",\n          \"format\": \"time_series\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{method}}-{{uri}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Max Duration\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:24\",\n          \"format\": \"Âµs\",\n          \"label\": \"\",\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:25\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": true,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 26\n      },\n      \"hiddenSeries\": false,\n      \"id\": 24,\n      \"interval\": null,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"rightSide\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": false,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"swoole_request_count{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"format\": \"time_series\",\n          \"instant\": true,\n          \"interval\": \"1\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Total Requests\",\n      \"tooltip\": {\n        \"shared\": false,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"series\",\n        \"name\": null,\n        \"show\": false,\n        \"values\": [\n          \"current\"\n        ]\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:568\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:569\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": true,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 26\n      },\n      \"hiddenSeries\": false,\n      \"id\": 12,\n      \"interval\": null,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"rightSide\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": false,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"topk(10, sum(http_server_requests_seconds_count{application=\\\"$application\\\"}) by (application, method, uri))\",\n          \"format\": \"time_series\",\n          \"instant\": true,\n          \"interval\": \"1\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{method}}-{{uri}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Top Requests\",\n      \"tooltip\": {\n        \"shared\": false,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"series\",\n        \"name\": null,\n        \"show\": false,\n        \"values\": [\n          \"current\"\n        ]\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:568\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:569\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": true,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"description\": \"\",\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 35\n      },\n      \"hiddenSeries\": false,\n      \"id\": 22,\n      \"interval\": null,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"rightSide\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": false,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"bottomk(10, sum(http_server_requests_seconds_count{application=\\\"$application\\\"}) by (application, method, uri))\",\n          \"format\": \"time_series\",\n          \"instant\": true,\n          \"interval\": \"1\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{method}}-{{uri}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Bottom Requests\",\n      \"tooltip\": {\n        \"shared\": false,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"series\",\n        \"name\": null,\n        \"show\": false,\n        \"values\": [\n          \"current\"\n        ]\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:568\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:569\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"collapsed\": false,\n      \"datasource\": null,\n      \"gridPos\": {\n        \"h\": 1,\n        \"w\": 24,\n        \"x\": 0,\n        \"y\": 44\n      },\n      \"id\": 39,\n      \"panels\": [],\n      \"title\": \"CPU/Memory Stats\",\n      \"type\": \"row\"\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 45\n      },\n      \"hiddenSeries\": false,\n      \"id\": 21,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"system_load_average_1m{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} 1m\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"system_load_average_5m{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} 5m\",\n          \"refId\": \"B\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"system_load_average_15m{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} 15m\",\n          \"refId\": \"C\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"swoole_cpu_num{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} CPU\",\n          \"refId\": \"D\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Load Average\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 45\n      },\n      \"hiddenSeries\": false,\n      \"id\": 19,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"apcu_seg_size{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}} Total\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"apcu_avail_mem{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Available\",\n          \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"APCu Memory\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"decimals\": 2,\n          \"format\": \"bytes\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 54\n      },\n      \"hiddenSeries\": false,\n      \"id\": 25,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_memory_usage{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"worker\\\"}) by (application, instance)\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Current Used\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_memory_real_usage{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"worker\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} System Allocated\",\n          \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Memory Usage(Worker)\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"decimals\": 2,\n          \"format\": \"bytes\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 54\n      },\n      \"hiddenSeries\": false,\n      \"id\": 26,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_memory_usage{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"task\\\"}) by (application, instance)\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Current Used\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_memory_real_usage{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"task\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} System Allocated\",\n          \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Memory Usage(Task Worker)\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"decimals\": 2,\n          \"format\": \"bytes\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 62\n      },\n      \"hiddenSeries\": false,\n      \"id\": 37,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_memory_usage{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"timer\\\"}) by (application, instance)\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Current Used\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_memory_real_usage{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"timer\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} System Allocated\",\n          \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Memory Usage(Timer)\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"decimals\": 2,\n          \"format\": \"bytes\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"collapsed\": false,\n      \"datasource\": null,\n      \"gridPos\": {\n        \"h\": 1,\n        \"w\": 24,\n        \"x\": 0,\n        \"y\": 71\n      },\n      \"id\": 32,\n      \"panels\": [],\n      \"title\": \"Swoole Stats\",\n      \"type\": \"row\"\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 72\n      },\n      \"hiddenSeries\": false,\n      \"id\": 16,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"swoole_worker_num{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Total\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"swoole_idle_worker_num{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Idle\",\n          \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Worker Num\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1069\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1070\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"description\": \"\",\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 72\n      },\n      \"hiddenSeries\": false,\n      \"id\": 17,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"swoole_task_worker_num{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Total\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"swoole_task_idle_worker_num{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Idle\",\n          \"refId\": \"B\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"swoole_tasking_num{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}} Tasking\",\n          \"refId\": \"C\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Task Worker Num\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1069\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1070\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 80\n      },\n      \"hiddenSeries\": false,\n      \"id\": 20,\n      \"legend\": {\n        \"avg\": true,\n        \"current\": true,\n        \"max\": true,\n        \"min\": true,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"swoole_connection_num{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"interval\": \"\",\n          \"legendFormat\": \"{{application}}-{{instance}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Connection Num\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": true,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 9,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 80\n      },\n      \"hiddenSeries\": false,\n      \"id\": 23,\n      \"interval\": null,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"rightSide\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": false,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"time()-swoole_start_time{application=\\\"$application\\\",instance=~\\\"$instance\\\"}\",\n          \"format\": \"time_series\",\n          \"instant\": true,\n          \"interval\": \"1\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}\",\n          \"refId\": \"A\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Up Time\",\n      \"tooltip\": {\n        \"shared\": false,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"series\",\n        \"name\": null,\n        \"show\": false,\n        \"values\": [\n          \"current\"\n        ]\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:568\",\n          \"format\": \"dtdhms\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:569\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"collapsed\": false,\n      \"datasource\": null,\n      \"gridPos\": {\n        \"h\": 1,\n        \"w\": 24,\n        \"x\": 0,\n        \"y\": 89\n      },\n      \"id\": 34,\n      \"panels\": [],\n      \"title\": \"GC Status\",\n      \"type\": \"row\"\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 90\n      },\n      \"hiddenSeries\": false,\n      \"id\": 28,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_runs{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"worker\\\"}) by (application, instance)\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Runs\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_collected{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"worker\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Collected\",\n          \"refId\": \"B\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_threshold{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"worker\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Threshold\",\n          \"refId\": \"C\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_roots{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"worker\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Roots\",\n          \"refId\": \"D\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"GC Status(Worker)\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"decimals\": null,\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 90\n      },\n      \"hiddenSeries\": false,\n      \"id\": 27,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_runs{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"task\\\"}) by (application, instance)\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Runs\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_collected{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"task\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Collected\",\n          \"refId\": \"B\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_threshold{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"task\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Threshold\",\n          \"refId\": \"C\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_roots{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"task\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Roots\",\n          \"refId\": \"D\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"GC Status(Task Worker)\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"decimals\": null,\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": null,\n      \"fieldConfig\": {\n        \"defaults\": {},\n        \"overrides\": []\n      },\n      \"fill\": 1,\n      \"fillGradient\": 0,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 98\n      },\n      \"hiddenSeries\": false,\n      \"id\": 36,\n      \"legend\": {\n        \"avg\": false,\n        \"current\": true,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"alertThreshold\": true\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"7.5.11\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_runs{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"timer\\\"}) by (application, instance)\",\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Runs\",\n          \"refId\": \"A\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_collected{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"timer\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Collected\",\n          \"refId\": \"B\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_threshold{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"timer\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Threshold\",\n          \"refId\": \"C\"\n        },\n        {\n          \"exemplar\": true,\n          \"expr\": \"sum(swoole_process_gc_roots{application=\\\"$application\\\",instance=~\\\"$instance\\\",process_type=\\\"timer\\\"}) by (application, instance)\",\n          \"hide\": false,\n          \"instant\": false,\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{application}}-{{instance}}  Roots\",\n          \"refId\": \"D\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"GC Status(Timer)\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 2,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"$$hashKey\": \"object:1328\",\n          \"decimals\": null,\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"$$hashKey\": \"object:1329\",\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    }\n  ],\n  \"refresh\": \"5s\",\n  \"schemaVersion\": 27,\n  \"style\": \"dark\",\n  \"tags\": [],\n  \"templating\": {\n    \"list\": [\n      {\n        \"allValue\": \"''\",\n        \"current\": {\n          \"selected\": false,\n          \"text\": \"Lumen\",\n          \"value\": \"Lumen\"\n        },\n        \"datasource\": null,\n        \"definition\": \"label_values(application)\",\n        \"description\": null,\n        \"error\": null,\n        \"hide\": 0,\n        \"includeAll\": false,\n        \"label\": \"Application\",\n        \"multi\": false,\n        \"name\": \"application\",\n        \"options\": [],\n        \"query\": {\n          \"query\": \"label_values(application)\",\n          \"refId\": \"StandardVariableQuery\"\n        },\n        \"refresh\": 1,\n        \"regex\": \"\",\n        \"skipUrlSync\": false,\n        \"sort\": 1,\n        \"tagValuesQuery\": \"\",\n        \"tags\": [],\n        \"tagsQuery\": \"\",\n        \"type\": \"query\",\n        \"useTags\": false\n      },\n      {\n        \"allValue\": \"\",\n        \"current\": {\n          \"selected\": true,\n          \"text\": [\n            \"All\"\n          ],\n          \"value\": [\n            \"$__all\"\n          ]\n        },\n        \"datasource\": null,\n        \"definition\": \"label_values(swoole_connection_num{application=\\\"$application\\\"},instance)\",\n        \"description\": null,\n        \"error\": null,\n        \"hide\": 0,\n        \"includeAll\": true,\n        \"label\": \"Instance\",\n        \"multi\": true,\n        \"name\": \"instance\",\n        \"options\": [],\n        \"query\": {\n          \"query\": \"label_values(swoole_connection_num{application=\\\"$application\\\"},instance)\",\n          \"refId\": \"StandardVariableQuery\"\n        },\n        \"refresh\": 1,\n        \"regex\": \"\",\n        \"skipUrlSync\": false,\n        \"sort\": 1,\n        \"tagValuesQuery\": \"\",\n        \"tags\": [],\n        \"tagsQuery\": \"\",\n        \"type\": \"query\",\n        \"useTags\": false\n      }\n    ]\n  },\n  \"time\": {\n    \"from\": \"now-24h\",\n    \"to\": \"now\"\n  },\n  \"timepicker\": {},\n  \"timezone\": \"\",\n  \"title\": \"LaravelS Service Monitor\",\n  \"uid\": \"GHNOMaF7z\",\n  \"version\": 7\n}"
        },
        {
          "name": "grafana-dashboard.png",
          "type": "blob",
          "size": 1004.951171875,
          "content": null
        },
        {
          "name": "logo.svg",
          "type": "blob",
          "size": 2.9384765625,
          "content": "<svg data-v-423bf9ae=\"\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 226.77551139567802 60\" class=\"font\"><!----><!----><defs data-v-423bf9ae=\"\"><linearGradient data-v-423bf9ae=\"\" gradientTransform=\"rotate(25)\" id=\"83061931-a8ee-446f-9411-18575971cd6c\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"><stop data-v-423bf9ae=\"\" offset=\"0%\" style=\"stop-color: rgb(214, 65, 63); stop-opacity: 1;\"></stop><stop data-v-423bf9ae=\"\" offset=\"100%\" style=\"stop-color: rgb(66, 133, 211); stop-opacity: 1;\"></stop></linearGradient></defs><g data-v-423bf9ae=\"\" id=\"e7ddf80a-7629-4fa2-bab1-ed897fbc5609\" fill=\"url(#83061931-a8ee-446f-9411-18575971cd6c)\" transform=\"matrix(6.1224488604322,0,0,6.1224488604322,-0.0000031648800273842426,-4.285714427340487)\"><path d=\"M0.98 9.51L3.53 9.51L3.53 10.50L0 10.50L0 9.51L0 0.70L0.98 0.70L0.98 9.51ZM7.80 10.50L6.55 2.67L5.84 7.20L6.55 7.20L6.55 8.18L5.68 8.18L5.31 10.50L4.31 10.50L4.69 8.18L4.31 8.18L4.31 7.20L4.84 7.20L5.88 0.70L7.22 0.70L8.79 10.50L7.80 10.50ZM9.34 10.50L9.34 4.62L10.32 4.62L10.32 10.50L9.34 10.50ZM9.34 0.70L12.17 0.70L12.17 0.70Q12.61 0.70 12.94 1.03L12.94 1.03L12.94 1.03Q13.27 1.36 13.27 1.82L13.27 1.82L13.27 4.48L13.27 4.48Q13.27 4.94 12.94 5.27L12.94 5.27L12.94 5.27Q12.61 5.60 12.17 5.60L12.17 5.60L11.82 5.60L13.27 10.50L12.22 10.50L10.53 4.62L12.17 4.62L12.17 4.62Q12.29 4.62 12.29 4.48L12.29 4.48L12.29 1.82L12.29 1.82Q12.29 1.68 12.17 1.68L12.17 1.68L10.32 1.68L10.32 4.62L9.34 1.68L9.34 0.70ZM17.53 10.50L16.28 2.67L15.57 7.20L16.28 7.20L16.28 8.18L15.41 8.18L15.04 10.50L14.04 10.50L14.42 8.18L14.04 8.18L14.04 7.20L14.57 7.20L15.61 0.70L16.95 0.70L18.52 10.50L17.53 10.50ZM22.55 0.70L23.55 0.70L21.98 10.50L20.64 10.50L19.07 0.70L20.06 0.70L21.31 8.54L22.55 0.70ZM27.92 1.68L25.37 1.68L25.37 4.62L27.41 4.62L27.41 5.60L25.37 5.60L25.37 9.52L27.92 9.52L27.92 10.50L24.39 10.50L24.39 4.62L25.37 4.62L24.39 1.68L24.39 0.70L27.92 0.70L27.92 1.68ZM29.81 9.51L32.35 9.51L32.35 10.50L28.83 10.50L28.83 9.51L28.83 0.70L29.81 0.70L29.81 9.51ZM37.04 2.86L36.06 2.86L36.06 1.81L36.06 1.81Q36.06 1.67 35.92 1.67L35.92 1.67L34.40 1.67L34.40 1.67Q34.26 1.67 34.26 1.81L34.26 1.81L34.26 4.47L34.26 4.47Q34.26 4.56 34.34 4.59L34.34 4.59L35.92 4.59L35.92 4.59Q36.40 4.59 36.72 4.92L36.72 4.92L36.72 4.92Q37.04 5.25 37.04 5.71L37.04 5.71L37.04 9.39L37.04 9.39Q37.04 9.81 36.78 10.12L36.78 10.12L36.78 10.12Q36.51 10.43 36.11 10.50L36.11 10.50L34.22 10.50L34.22 10.50Q33.81 10.43 33.54 10.12L33.54 10.12L33.54 10.12Q33.28 9.81 33.28 9.39L33.28 9.39L33.28 8.34L34.26 8.34L34.26 9.39L34.26 9.39Q34.26 9.53 34.40 9.53L34.40 9.53L35.92 9.53L35.92 9.53Q36.06 9.53 36.06 9.39L36.06 9.39L36.06 5.71L36.06 5.71Q36.06 5.61 35.98 5.59L35.98 5.59L34.40 5.59L34.40 5.59Q33.94 5.59 33.61 5.26L33.61 5.26L33.61 5.26Q33.28 4.93 33.28 4.47L33.28 4.47L33.28 1.81L33.28 1.81Q33.28 1.39 33.54 1.08L33.54 1.08L33.54 1.08Q33.81 0.77 34.22 0.70L34.22 0.70L36.11 0.70L36.11 0.70Q36.51 0.77 36.78 1.08L36.78 1.08L36.78 1.08Q37.04 1.39 37.04 1.81L37.04 1.81L37.04 2.86Z\"></path></g><!----><!----></svg>"
        },
        {
          "name": "phpunit.xml",
          "type": "blob",
          "size": 1.6552734375,
          "content": "<phpunit\n        xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n        xsi:noNamespaceSchemaLocation=\"https://schema.phpunit.de/6.3/phpunit.xsd\"\n        bootstrap=\"vendor/autoload.php\"\n        colors=\"true\"\n        convertErrorsToExceptions=\"true\"\n        convertNoticesToExceptions=\"true\"\n        convertWarningsToExceptions=\"true\"\n        processIsolation=\"false\"\n        stopOnError=\"false\"\n        stopOnFailure=\"false\"\n        stopOnIncomplete=\"false\"\n        stopOnSkipped=\"false\"\n        stopOnRisky=\"false\"\n        timeoutForSmallTests=\"1\"\n        timeoutForMediumTests=\"10\"\n        timeoutForLargeTests=\"60\"\n        verbose=\"false\">\n    <testsuites>\n        <testsuite name=\"laravel-s\">\n            <directory phpVersion=\"7.4.0\" phpVersionOperator=\">=\" suffix=\"Test.php\">tests</directory>\n            <exclude>tests/TestCase.php</exclude>\n        </testsuite>\n    </testsuites>\n    <filter>\n        <whitelist processUncoveredFilesFromWhitelist=\"true\">\n            <directory suffix=\".php\">tests</directory>\n        </whitelist>\n    </filter>\n    <php>\n        <const name=\"PHPUNIT\" value=\"true\"/>\n    </php>\n    <logging>\n        <log type=\"coverage-html\" target=\"coverage/report\" lowUpperBound=\"35\"\n             highLowerBound=\"70\"/>\n        <log type=\"coverage-clover\" target=\"coverage/coverage.xml\"/>\n        <log type=\"coverage-php\" target=\"coverage/coverage.serialized\"/>\n        <log type=\"coverage-text\" target=\"php://stdout\" showUncoveredFiles=\"false\"/>\n        <log type=\"junit\" target=\"coverage/logfile.xml\"/>\n        <log type=\"testdox-html\" target=\"coverage/testdox.html\"/>\n        <log type=\"testdox-text\" target=\"coverage/testdox.txt\"/>\n    </logging>\n</phpunit>\n"
        },
        {
          "name": "sponsor.png",
          "type": "blob",
          "size": 116.57421875,
          "content": null
        },
        {
          "name": "src",
          "type": "tree",
          "content": null
        },
        {
          "name": "tests",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}