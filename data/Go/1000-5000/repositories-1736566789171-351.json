{
  "metadata": {
    "timestamp": 1736566789171,
    "page": 351,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjM2MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "igrigorik/ga-beacon",
      "stars": 3538,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.0498046875,
          "content": "*.6\n*.8\n*.o\n*.so\n*.cgo?.*\n_cgo_*\n_test*\n*.out\n_obj\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.0537109375,
          "content": "The MIT License (MIT)\n\nCopyright (c) 2014 Ilya Grigorik\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE."
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 5.5341796875,
          "content": "# Google Analytics Beacon [![Analytics](https://ga-beacon.appspot.com/UA-71196-10/ga-beacon/readme?pixel)](https://github.com/igrigorik/ga-beacon)\n\nSometimes it is impossible to embed the JavaScript tracking code provided by Google Analytics: the host page does not allow arbitrary JavaScript, and there is no Google Analytics integration. However, not all is lost! **If you can embed a simple image (pixel tracker), then you can beacon data to Google Analytics.** For a great, hands-on explanation of how this works, check out the following guides:\n\n* [Using a Beacon Image for GitHub, Website and Email Analytics](http://www.sitepoint.com/using-beacon-image-github-website-email-analytics/)\n(also see FAQ below regarding GitHub)\n* [Tracking Google Sheet views with Google Analytics using GA Beacon](http://mashe.hawksey.info/2014/02/tracking-google-sheet-views-with-google-analytics/)\n\n### Can I use this production?\n\nThe ga-beacon.appspot.com instance is a **demo** instance, good for prototyping and proof of concepts. If you intend to use this in production for your application, you should deploy **your own instance** of this service, which will allow you to scale the service up and down to meet your capacity needs, introspect the logs, customize the code, and so on.\n\nDeploying your own instance is trivial: fork this repo, modify the project name in app.yaml, and follow the [normal GAE deploy instructions](https://cloud.google.com/appengine/training/go-plus-appengine/deploy). You should be up and running in less than five minutes.\n\n### Setup instructions\n\nFirst, log in to your Google Analytics account and [set up a new property](https://support.google.com/analytics/answer/1042508?hl=en):\n\n* Select \"Website\", use new \"Universal Analytics\" tracking\n* **Website name:** anything you want (e.g. GitHub projects)\n* **WebSite URL: https://ga-beacon.appspot.com/**\n* Click \"Get Tracking ID\", copy the `UA-XXXXX-X` ID on next page\n\nNext, add a tracking image to the pages you want to track:\n\n* _https://ga-beacon.appspot.com/UA-XXXXX-X/insert/any/path_\n* `UA-XXXXX-X` should be your tracking ID\n* `insert/any/path` is an arbitrary path. For best results specify a meaningful and self-descriptive path. You have to do this manually, the beacon won't automatically record the page path it's embedded on.\n\nExample tracker markup if you are using Markdown:\n\n```markdown\n[![Analytics](https://ga-beacon.appspot.com/UA-XXXXX-X/welcome-page)](https://github.com/igrigorik/ga-beacon)\n```\n\nOr RDoc:\n\n```rdoc\n{<img src=\"https://ga-beacon.appspot.com/UA-XXXXX-X/welcome-page\" />}[https://github.com/igrigorik/ga-beacon]\n```\n\nIf you prefer, you can skip the badge and use a transparent pixel. To do so, simply append `?pixel` to the image URL. There are also \"flat\" style variants available, which are available when appending `?flat` or `?flat-gif` to the image URL. And that's it, add the tracker image to the pages you want to track and then head to your Google Analytics account to see real-time and aggregated visit analytics for your projects!\n\nYou may also auto-calculate the tracking path based in the \"referer\" information of the image. To activate this simple add `?useReferer` to the image URL (or `&useReferer` if you need to combine this with the `?pixel`, `?flat` or `?flat-gif` parameter). Although they are some odd browsers that don't always send the referer header, the amount of traffic coming from those browsers is usually not relevant at all. Of course that if you need to measure the traffic from those odd browsers you should not use this method.\n\n### FAQ\n\n- **How does this work?** Google Analytics provides a [measurement protocol](https://developers.google.com/analytics/devguides/collection/protocol/v1/devguide) which allows us to POST arbitrary visit data directly to Google servers, and that's exactly what GA Beacon does: we include an image request on our pages which hits the GA Beacon service, and GA Beacon POSTs the visit data to Google Analytics to record the visit. As a result, if you can embed an image, you can beacon data to Google Analytics.\n\n- **Why do we need to proxy?** Google Analytics supports reporting of visit data [via GET requests](https://developers.google.com/analytics/devguides/collection/protocol/v1/reference#transport), but unfortunately we can't use that directly because we need to generate and report a unique visitor ID for each hit - e.g. some pages do not allow us to run JS on the client to generate the ID. To address this, we proxy the request through ga-beacon.appspot.com, which in turn is responsible for generating the unique visitor ID (server generated UUID), setting the appropriate cookies for repeat hits, and reporting the hits to Google Analytics.\n\n- **What about referrals and other visitor information?** Unfortunately the static tracking pixel approach limits the information we can collect about the visit. For example, referral information can't be passed to the tracking pixel because we can't execute JavaScript. As a result, the available metrics are restricted to unique visitors, pageviews, and the User-Agent and IP address of the visitor.\n\n- **Do I have to use ga-beacon.appspot.com?** You can if you want to - it's free, but there are no capacity or availability promises. For best results, deploy your own instance directly on Google App Engine: clone this repository, change the project name, and deploy your own instance - easy as that. The project is under MIT license.\n\n- **Can I use this to track visits to my GitHub README and other GitHub-served content?** No, you cannot - see https://github.com/igrigorik/ga-beacon/commit/6acd8627bb7be36f24f5516e9873c92719a50e55\n"
        },
        {
          "name": "app.yaml",
          "type": "blob",
          "size": 0.1611328125,
          "content": "runtime: go113\n\ndefault_expiration: \"1d\"\n\nhandlers:\n- url: /favicon\\.ico\n  static_files: static/favicon.ico\n  upload: static/favicon\\.ico\n\n- url: /.*\n  script: auto\n"
        },
        {
          "name": "ga-beacon.go",
          "type": "blob",
          "size": 5.1611328125,
          "content": "package main\n\nimport (\n\t\"context\"\n\t\"crypto/rand\"\n\t\"encoding/hex\"\n\t\"fmt\"\n\t\"html/template\"\n\t\"io/ioutil\"\n\t\"log\"\n\t\"net/http\"\n\t\"net/url\"\n\t\"os\"\n\t\"strings\"\n\t\"time\"\n\n\t\"google.golang.org/appengine/delay\"\n)\n\nconst beaconURL = \"http://www.google-analytics.com/collect\"\n\nvar (\n\tpixel        = mustReadFile(\"static/pixel.gif\")\n\tbadge        = mustReadFile(\"static/badge.svg\")\n\tbadgeGif     = mustReadFile(\"static/badge.gif\")\n\tbadgeFlat    = mustReadFile(\"static/badge-flat.svg\")\n\tbadgeFlatGif = mustReadFile(\"static/badge-flat.gif\")\n\tpageTemplate = template.Must(template.New(\"page\").ParseFiles(\"page.html\"))\n)\n\nfunc main() {\n\thttp.HandleFunc(\"/\", handler)\n\n\tport := os.Getenv(\"PORT\")\n\tif port == \"\" {\n\t\tport = \"8080\"\n\t\tlog.Printf(\"Defaulting to port %s\", port)\n\t}\n\n\tlog.Printf(\"Listening on port %s\", port)\n\tif err := http.ListenAndServe(\":\"+port, nil); err != nil {\n\t\tlog.Fatal(err)\n\t}\n}\n\nfunc mustReadFile(path string) []byte {\n\tb, err := ioutil.ReadFile(path)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn b\n}\n\nfunc generateUUID(cid *string) error {\n\tb := make([]byte, 16)\n\t_, err := rand.Read(b)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tb[8] = (b[8] | 0x80) & 0xBF // what's the purpose ?\n\tb[6] = (b[6] | 0x40) & 0x4F // what's the purpose ?\n\t*cid = hex.EncodeToString(b)\n\treturn nil\n}\n\nvar delayHit = delay.Func(\"collect\", logHit)\n\nfunc sendToGA(c context.Context, ua string, ip string, cid string, values url.Values) error {\n\tclient := &http.Client{}\n\n\treq, _ := http.NewRequest(\"POST\", beaconURL, strings.NewReader(values.Encode()))\n\treq.Header.Add(\"User-Agent\", ua)\n\treq.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n\n\tif resp, err := client.Do(req); err != nil {\n\t\tlog.Printf(\"GA collector POST error: %s\", err.Error())\n\t\treturn err\n\t} else {\n\t\tlog.Printf(\"GA collector status: %v, cid: %v, ip: %s\", resp.Status, cid, ip)\n\t\tlog.Printf(\"Reported payload: %v\", values)\n\t}\n\treturn nil\n}\n\nfunc logHit(c context.Context, params []string, query url.Values, ua string, ip string, cid string) error {\n\t// 1) Initialize default values from path structure\n\t// 2) Allow query param override to report arbitrary values to GA\n\t//\n\t// GA Protocol reference: https://developers.google.com/analytics/devguides/collection/protocol/v1/reference\n\n\tpayload := url.Values{\n\t\t\"v\":   {\"1\"},        // protocol version = 1\n\t\t\"t\":   {\"pageview\"}, // hit type\n\t\t\"tid\": {params[0]},  // tracking / property ID\n\t\t\"cid\": {cid},        // unique client ID (server generated UUID)\n\t\t\"dp\":  {params[1]},  // page path\n\t\t\"uip\": {ip},         // IP address of the user\n\t}\n\n\tfor key, val := range query {\n\t\tpayload[key] = val\n\t}\n\n\treturn sendToGA(c, ua, ip, cid, payload)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n\tc := r.Context()\n\tparams := strings.SplitN(strings.Trim(r.URL.Path, \"/\"), \"/\", 2)\n\tquery, _ := url.ParseQuery(r.URL.RawQuery)\n\trefOrg := r.Header.Get(\"Referer\")\n\n\t// / -> redirect\n\tif len(params[0]) == 0 {\n\t\thttp.Redirect(w, r, \"https://github.com/igrigorik/ga-beacon\", http.StatusFound)\n\t\treturn\n\t}\n\n\t// activate referrer path if ?useReferer is used and if referer exists\n\tif _, ok := query[\"useReferer\"]; ok {\n\t\tif len(refOrg) != 0 {\n\t\t\treferer := strings.Replace(strings.Replace(refOrg, \"http://\", \"\", 1), \"https://\", \"\", 1)\n\t\t\tif len(referer) != 0 {\n\t\t\t\t// if the useReferer is present and the referer information exists\n\t\t\t\t//  the path is ignored and the beacon referer information is used instead.\n\t\t\t\tparams = strings.SplitN(strings.Trim(r.URL.Path, \"/\")+\"/\"+referer, \"/\", 2)\n\t\t\t}\n\t\t}\n\t}\n\t// /account -> account template\n\tif len(params) == 1 {\n\t\ttemplateParams := struct {\n\t\t\tAccount string\n\t\t\tReferer string\n\t\t}{\n\t\t\tAccount: params[0],\n\t\t\tReferer: refOrg,\n\t\t}\n\t\tif err := pageTemplate.ExecuteTemplate(w, \"page.html\", templateParams); err != nil {\n\t\t\thttp.Error(w, \"could not show account page\", 500)\n\t\t\tlog.Printf(\"Cannot execute template: %v\", err)\n\t\t}\n\t\treturn\n\t}\n\n\t// /account/page -> GIF + log pageview to GA collector\n\tvar cid string\n\tif cookie, err := r.Cookie(\"cid\"); err != nil {\n\t\tif err := generateUUID(&cid); err != nil {\n\t\t\tlog.Printf(\"Failed to generate client UUID: %v\", err)\n\t\t} else {\n\t\t\tlog.Printf(\"Generated new client UUID: %v\", cid)\n\t\t\thttp.SetCookie(w, &http.Cookie{Name: \"cid\", Value: cid, Path: fmt.Sprint(\"/\", params[0])})\n\t\t}\n\t} else {\n\t\tcid = cookie.Value\n\t\tlog.Printf(\"Existing CID found: %v\", cid)\n\t}\n\n\tif len(cid) != 0 {\n\t\tvar cacheUntil = time.Now().Format(http.TimeFormat)\n\t\tw.Header().Set(\"Cache-Control\", \"no-cache, no-store, must-revalidate, private\")\n\t\tw.Header().Set(\"Expires\", cacheUntil)\n\t\tw.Header().Set(\"CID\", cid)\n\n\t\tlogHit(c, params, query, r.Header.Get(\"User-Agent\"), r.RemoteAddr, cid)\n\t\t// delayHit.Call(c, params, r.Header.Get(\"User-Agent\"), cid)\n\t}\n\n\t// Write out GIF pixel or badge, based on presence of \"pixel\" param.\n\tif _, ok := query[\"pixel\"]; ok {\n\t\tw.Header().Set(\"Content-Type\", \"image/gif\")\n\t\tw.Write(pixel)\n\t} else if _, ok := query[\"gif\"]; ok {\n\t\tw.Header().Set(\"Content-Type\", \"image/gif\")\n\t\tw.Write(badgeGif)\n\t} else if _, ok := query[\"flat\"]; ok {\n\t\tw.Header().Set(\"Content-Type\", \"image/svg+xml\")\n\t\tw.Write(badgeFlat)\n\t} else if _, ok := query[\"flat-gif\"]; ok {\n\t\tw.Header().Set(\"Content-Type\", \"image/gif\")\n\t\tw.Write(badgeFlatGif)\n\t} else {\n\t\tw.Header().Set(\"Content-Type\", \"image/svg+xml\")\n\t\tw.Write(badge)\n\t}\n}\n"
        },
        {
          "name": "page.html",
          "type": "blob",
          "size": 0.7744140625,
          "content": "<!DOCTYPE HTML>\n<html>\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n  <title>GA account: {{.Account}}</title>\n\n  <script>\n  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n\n  ga('create', '{{.Account}}', 'ga-beacon.appspot.com');\n  ga('send', 'pageview');\n  </script>\n</head>\n\n<body>\n<p>GA account: {{.Account}}</p>\n<p>Beacon Referrer: {{.Referer}}</p>\n<p>Setup instructions: <a href=\"https://github.com/igrigorik/ga-beacon\">https://github.com/igrigorik/ga-beacon</a></p>\n</body>\n</html>\n"
        },
        {
          "name": "static",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}