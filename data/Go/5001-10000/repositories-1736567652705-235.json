{
  "metadata": {
    "timestamp": 1736567652705,
    "page": 235,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjI0MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "alexellis/k3sup",
      "stars": 6418,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".DEREK.yml",
          "type": "blob",
          "size": 1.958984375,
          "content": "curators:\n - alexellis\n - welteki\n\nfeatures:\n - dco_check\n - comments\n - pr_description_required\n - release_notes\n\ncustom_messages:\n  - name: k3s\n    value: |\n           --\n           Thank you for your interest in k3sup.\n           \n           This issue appears to be a problem with the upstream k3s project\n           which k3sup installs and automates.\n           \n           Please raise an issue on [Rancher's k3s repository](https://github.com/rancher/k3s/) and\n           link it back to this issue for tracking purposes. If Rancher determines that this is\n           actually an error with k3sup, then please feel free to return and re-open the issue, or\n           to comment again.\n\n  - name: template\n    value: |\n           This project uses Issue and PR templates and requires that all\n           users fill out the template in detail before help can be given.\n\n           To continue please edit your Issue/PR or open a new one, and \n           please provide all the fields requested.\n\n           Thank you for your contribution.\n\n  - name: propose\n    value: |\n           This project follows a contributing guide which states that all\n           changes must be proposed with an Issue before being worked on.\n           \n           Please raise an Issue and update your Pull Request to include\n           the ID or link as part of the description.\n\n           Thank you for your contribution.\n\n  - name: test\n    value: |\n           This project follows a contributing guide which requires that\n           all changes are tested before being merged. You should include\n           worked examples that a maintainer can run to prove that the\n           changes are good.\n\n           Screenshots and command line output are also accepted, but\n           must show the positive, and negative cases, not just that \n           what was added worked as you expected.\n\n           Thank you for your contribution.\n\ncontributing_url: https://github.com/alexellis/arkade/blob/master/CONTRIBUTING.md\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.08203125,
          "content": "k3sup\nbin/**\nkubeconfig\n.DS_Store\n.idea/\nmc\n/install.sh\n/*.json\n*.txt\n/bootstrap.sh\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.0791015625,
          "content": "MIT License\n\nCopyright (c) 2019 Alex Ellis\n\nExclusions: assets, images and logos.\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE."
        },
        {
          "name": "Makefile",
          "type": "blob",
          "size": 1.18359375,
          "content": "Version := $(shell git describe --tags --dirty)\n# Version := \"dev\"\nGitCommit := $(shell git rev-parse HEAD)\nLDFLAGS := \"-s -w -X github.com/alexellis/k3sup/cmd.Version=$(Version) -X github.com/alexellis/k3sup/cmd.GitCommit=$(GitCommit)\"\nexport GO111MODULE=on\nSOURCE_DIRS = main.go cmd pkg\n\n.PHONY: all\nall: gofmt test dist hash\n\n.PHONY: test\ntest:\n\tCGO_ENABLED=0 go test $(shell go list ./... | grep -v /vendor/|xargs echo) -cover\n\n.PHONY: gofmt\ngofmt:\n\t@test -z $(shell gofmt -l $(SOURCE_DIRS) ./ | grep -v vendor/| tee /dev/stderr) || (echo \"[WARN] Fix formatting issues with 'make gofmt'\" && exit 1)\n\n.PHONY: dist\ndist:\n\tmkdir -p bin/\n\trm -rf bin/k3sup*\n\tCGO_ENABLED=0 GOOS=linux go build -ldflags $(LDFLAGS) -o bin/k3sup\n\tGOARM=7 GOARCH=arm CGO_ENABLED=0 GOOS=linux go build -ldflags $(LDFLAGS) -o bin/k3sup-armhf\n\tGOARCH=arm64 CGO_ENABLED=0 GOOS=linux go build -ldflags $(LDFLAGS) -o bin/k3sup-arm64\n\tCGO_ENABLED=0 GOOS=darwin go build -ldflags $(LDFLAGS) -o bin/k3sup-darwin\n\tGOARCH=arm64 CGO_ENABLED=0 GOOS=darwin go build -ldflags $(LDFLAGS) -o bin/k3sup-darwin-arm64\n\tGOOS=windows CGO_ENABLED=0 go build -ldflags $(LDFLAGS) -o bin/k3sup.exe\n\n.PHONY: hash\nhash:\n\trm -rf bin/*.sha256 && ./hack/hashgen.sh\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 36.283203125,
          "content": "# k3sup üöÄ (said 'ketchup')\n\n<img src=\"docs/assets/k3sup.png\" width=\"20%\" alt=\"k3sup logo\">\n\nk3sup is a light-weight utility to get from zero to KUBECONFIG with [k3s](https://k3s.io/) on any local or remote VM. All you need is `ssh` access and the `k3sup` binary to get `kubectl` access immediately.\n\nThe tool is written in Go and is cross-compiled for Linux, Windows, MacOS and even on Raspberry Pi.\n\nHow do you say it? Ketchup, as in tomato.\n\n[![Sponsor this](https://img.shields.io/static/v1?label=Sponsor&message=%E2%9D%A4&logo=GitHub&link=https://github.com/sponsors/alexellis)](https://github.com/sponsors/alexellis)\n[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)\n[![build](https://github.com/alexellis/k3sup/actions/workflows/build.yaml/badge.svg)](https://github.com/alexellis/k3sup/actions/workflows/build.yaml)\n[![Github All Releases](https://img.shields.io/github/downloads/alexellis/k3sup/total.svg)]()\n\n## Contents:\n- [k3sup üöÄ (said 'ketchup')](#k3sup--said-ketchup)\n  - [Contents:](#contents)\n  - [What's this for? üíª](#whats-this-for-)\n  - [Do you love `k3sup`?](#do-you-love-k3sup)\n    - [Uses](#uses)\n    - [Bootstrapping Kubernetes](#bootstrapping-kubernetes)\n  - [Download `k3sup` (tl;dr)](#download-k3sup-tldr)\n    - [A note for Windows users](#a-note-for-windows-users)\n  - [Demo üìº](#demo-)\n  - [Usage ‚úÖ](#usage-)\n  - [Pre-requisites for k3sup servers and agents](#pre-requisites-for-k3sup-servers-and-agents)\n    - [üëë Setup a Kubernetes *server* with `k3sup`](#-setup-a-kubernetes-server-with-k3sup)\n    - [Checking if a cluster is ready](#checking-if-a-cluster-is-ready)\n    - [Merging clusters into your KUBECONFIG](#merging-clusters-into-your-kubeconfig)\n    - [üò∏ Join some agents to your Kubernetes server](#-join-some-agents-to-your-kubernetes-server)\n    - [Use your hardware authentication / 2FA or SSH Agent](#use-your-hardware-authentication--2fa-or-ssh-agent)\n    - [K3sup plan for automation](#k3sup-plan-for-automation)\n    - [Create a multi-master (HA) setup with external SQL](#create-a-multi-master-ha-setup-with-external-sql)\n    - [Create a multi-master (HA) setup with embedded etcd](#create-a-multi-master-ha-setup-with-embedded-etcd)\n    - [üë®‚Äçüíª Micro-tutorial for Raspberry Pi (2, 3, or 4) ü•ß](#-micro-tutorial-for-raspberry-pi-2-3-or-4-)\n  - [Caveats on security](#caveats-on-security)\n  - [Contributing](#contributing)\n    - [Blog posts & tweets](#blog-posts--tweets)\n    - [Contributing via GitHub](#contributing-via-github)\n    - [License](#license)\n  - [üì¢ What are people saying about `k3sup`?](#-what-are-people-saying-about-k3sup)\n  - [Similar tools & glossary](#similar-tools--glossary)\n  - [Troubleshooting and support](#troubleshooting-and-support)\n    - [Maybe the problem is with K3s?](#maybe-the-problem-is-with-k3s)\n    - [Common issues](#common-issues)\n    - [Support and k3sup for commercial use](#support-and-k3sup-for-commercial-use)\n    - [Getting access to your KUBECONFIG](#getting-access-to-your-kubeconfig)\n    - [Smart cards and 2FA](#smart-cards-and-2fa)\n    - [Misc note on `iptables`](#misc-note-on-iptables)\n\n## What's this for? üíª\n\nThis tool uses `ssh` to install `k3s` to a remote Linux host. You can also use it to join existing Linux hosts into a k3s cluster as `agents`. First, `k3s` is installed using the utility script from Rancher, along with a flag for your host's public IP so that TLS works properly. The `kubeconfig` file on the server is then fetched and updated so that you can connect from your laptop using `kubectl`.\n\nYou may wonder why a tool like this needs to exist when you can do this sort of thing with bash.\n\nk3sup was developed to automate what can be a very manual and confusing process for many developers, who are already short on time. Once you've provisioned a VM with your favourite tooling, `k3sup` means you are only 60 seconds away from running `kubectl get pods` on your own computer. If you are a local computer, you can bypass SSH with `k3sup install --local`\n\n## Do you use `k3sup`?\n\n`k3sup` was created by [Alex Ellis](https://github.com/users/alexellis/sponsorship) - the founder of [OpenFaaS &reg;](https://www.openfaas.com/) & [inlets](https://inlets.dev/). \n\n<a href=\"https://github.com/sponsors/alexellis/\">\n<img alt=\"Sponsor this project\" src=\"https://github.com/alexellis/alexellis/blob/master/sponsor-today.png\" width=\"90%\">\n</a>\n\nWant to see continued development? [Sponsor alexellis on GitHub](https://github.com/users/alexellis/sponsorship)\n\n### Uses\n\n* Bootstrap Kubernetes with k3s onto any VM with `k3sup install` - either manually, during CI or through `cloud-init`\n* Get from zero to `kubectl` with `k3s` on Raspberry Pi (RPi), VMs, AWS EC2, Packet bare-metal, DigitalOcean, Civo, Scaleway, and others\n* Build a HA, multi-master (server) cluster\n* Fetch the KUBECONFIG from an existing `k3s` cluster\n* Join nodes into an existing `k3s` cluster with `k3sup join`\n\n### Bootstrapping Kubernetes\n\n![Conceptual architecture](./docs/k3sup-cloud.png)\n*Conceptual architecture, showing `k3sup` running locally against any VM such as AWS EC2 or a VPS such as DigitalOcean.*\n\n## Download `k3sup` (tl;dr)\n\n`k3sup` is distributed as a static Go binary. You can use the installer on MacOS and Linux, or visit the [Releases page](https://github.com/alexellis/k3sup/releases) to download the executable for Windows.\n\n```sh\ncurl -sLS https://get.k3sup.dev | sh\nsudo install k3sup /usr/local/bin/\n\nk3sup --help\n```\n\n### A note for Windows users\n\nWindows users can use `k3sup install` and `k3sup join` with a normal \"Windows command prompt\".\n\n## Demo üìº\n\nIn the demo I install Kubernetes (`k3s`) onto two separate machines and get my `kubeconfig` downloaded to my laptop each time in around one minute.\n\n1) Ubuntu 18.04 VM created on DigitalOcean with ssh key copied automatically\n2) Raspberry Pi 4 with my ssh key copied over via `ssh-copy-id`\n\nWatch the demo:\n\n[![asciicast](https://asciinema.org/a/262630.svg)](https://asciinema.org/a/262630)\n\n## Usage ‚úÖ\n\nThe `k3sup` tool is a client application which you can run on your own computer. It uses SSH to connect to remote servers and creates a local KUBECONFIG file on your disk. Binaries are provided for MacOS, Windows, and Linux (including ARM).\n\n## Pre-requisites for k3sup servers and agents\n\nSome Linux hosts are configured to allow `sudo` to run without having to repeat your password. For those which are not already configured that way, you'll need to make the following changes if you wish to use `k3sup`:\n\n```bash\n# sudo visudo\n\n# Then add to the bottom of the file\n# replace \"alex\" with your username i.e. \"ubuntu\"\nalex ALL=(ALL) NOPASSWD: ALL\n```\n\nIn most circumstances, cloud images for Ubuntu and other distributions will not require this step.\n\nAs an alternative, if you only need a single server you can log in interactively and run `k3sup install --local` instead of using SSH.\n\n### üëë Setup a Kubernetes *server* with `k3sup`\n\nYou can setup a server and stop here, or go on to use the `join` command to add some \"agents\" aka `nodes` or `workers` into the cluster to expand its compute capacity.\n\nProvision a new VM running a compatible operating system such as Ubuntu, Debian, Raspbian, or something else. Make sure that you opt-in to copy your registered SSH keys over to the new VM or host automatically.\n\n> Note: You can copy ssh keys to a remote VM with `ssh-copy-id user@IP`.\n\nImagine the IP was `192.168.0.1` and the username was `ubuntu`, then you would run this:\n\n* Run `k3sup`:\n\n```sh\nexport IP=192.168.0.1\nk3sup install --ip $IP --user ubuntu\n\n# Or use a hostname and SSH key for EC2\nexport HOST=\"ec2-3-250-131-77.eu-west-1.compute.amazonaws.com\"\nk3sup install --host $HOST --user ubuntu \\\n  --ssh-key $HOME/ec2-key.pem\n```\n\nOther options for `install`:\n\n* `--cluster` - start this server in clustering mode using embedded etcd (embedded HA)\n* `--skip-install` - if you already have k3s installed, you can just run this command to get the `kubeconfig`\n* `--ssh-key` - specify a specific path for the SSH key for remote login\n* `--local` - Perform a local install without using ssh\n* `--local-path` - default is `./kubeconfig` - set the file where you want to save your cluster's `kubeconfig`.  By default this file will be overwritten.\n* `--merge` - Merge config into existing file instead of overwriting (e.g. to add config to the default kubectl config, use `--local-path ~/.kube/config --merge`).\n* `--context` - default is `default` - set the name of the kubeconfig context.\n* `--ssh-port` - default is `22`, but you can specify an alternative port i.e. `2222`\n* `--no-extras` - disable \"servicelb\" and \"traefik\"\n* `--k3s-extra-args` - Optional extra arguments to pass to k3s installer, wrapped in quotes, i.e. `--k3s-extra-args '--disable traefik'` or `--k3s-extra-args '--docker'`. For multiple args combine then within single quotes `--k3s-extra-args '--disable traefik --docker'`.\n* `--k3s-version` - set the specific version of k3s, i.e. `v1.21.1`\n* `--k3s-channel` - set a specific version of k3s based upon a channel i.e. `stable`\n- `--ipsec` - Enforces the optional extra argument for k3s: `--flannel-backend` option: `ipsec`\n* `--print-command` - Prints out the command, sent over SSH to the remote computer\n* `--datastore` - used to pass a SQL connection-string to the `--datastore-endpoint` flag of k3s. You must use [the format required by k3s in the Rancher docs](https://rancher.com/docs/k3s/latest/en/installation/ha/).\n\nSee even more install options by running `k3sup install --help`.\n\n* Now try the access:\n\n```bash\nexport KUBECONFIG=`pwd`/kubeconfig\nkubectl get node\n```\n\nNote that you should always use `pwd/` so that a full path is set, and you can change directory if you wish.\n\n### Checking if a cluster is ready\n\nThere are various ways to confirm whether a cluster is ready to use.\n\nK3sup runs the \"kubectl get nodes\" command using a KUBECONFIG file, and looks for the \"Ready\" status on each node, including agents/workers.\n\nInstall K3s directly on the node and then check if it's ready:\n\n```bash\nk3sup install \\\n  --local \\\n  --context localk3s\n\nk3sup ready \\\n  --context localk3s \\\n  --kubeconfig ./kubeconfig\n```\n\nCheck a remote server saved to a local file:\n\n```bash\nk3sup install \\\n  --ip 192.168.0.101 \\\n  --user pi\n\nk3sup ready \\\n  --context default \\\n  --kubeconfig ./kubeconfig\n```\n\nCheck a merged context in your default KUBECONFIG:\n\n```bash\nk3sup install \\\n  --ip 192.168.0.101 \\\n  --user pi \\\n  --context pik3s \\\n  --merge \\\n  --local-path $HOME/.kube/config\n\n# $HOME/.kube/config is a default for kubeconfig\nk3sup ready --context pik3s\n```\n\n### Merging clusters into your KUBECONFIG\n\nYou can also merge the remote config into your main KUBECONFIG file `$HOME/.kube/config`, then use `kubectl config get-contexts` or `kubectx` to manage it.\n\nThe default \"context\" name for the remote k3s cluster is `default`, however you can override this as below.\n\nFor example:\n\n```bash\nk3sup install \\\n  --ip $IP \\\n  --user $USER \\\n  --merge \\\n  --local-path $HOME/.kube/config \\\n  --context my-k3s\n```\n\nHere we set a context of `my-k3s` and also merge into our main local `KUBECONFIG` file, so we could run `kubectl config use-context my-k3s` or `kubectx my-k3s`.\n\n### üò∏ Join some agents to your Kubernetes server\n\nLet's say that you have a server, and have already run the following:\n\n```sh\nexport SERVER_IP=192.168.0.100\nexport USER=root\n\nk3sup install --ip $SERVER_IP --user $USER\n```\n\nNext join one or more `agents` to the cluster:\n\n```sh\nexport AGENT_IP=192.168.0.101\n\nexport SERVER_IP=192.168.0.100\nexport USER=root\n\nk3sup join --ip $AGENT_IP --server-ip $SERVER_IP --user $USER\n```\n\nPlease note that if you are using different usernames for SSH'ing to the agent and the server that you must provide the username for the server via the `--server-user` parameter.\n\nThat's all, so with the above command you can have a two-node cluster up and running, whether that's using VMs on-premises, using Raspberry Pis, 64-bit ARM or even cloud VMs on EC2.\n\n### Use your hardware authentication / 2FA or SSH Agent\n\nYou may wish to use the `ssh-agent` utility if:\n\n* Your SSH key is protected by a password, and you don't want to type it in for each k3sup command\n* You use a hardware authentication device key like a [Yubico YubiKey](https://amzn.to/3ApXR82) to authenticate SSH sessions\n\nRun the following to set `SSH_AUTH_SOCK`:\n\n```\n$ eval $(ssh-agent)\nAgent pid 2641757\n```\n\nOptionally, if your key is encrypted, run: `ssh-add ~/.ssh/id_rsa`\n\nNow run any `k3sup` command, and your SSH key will be requested from the ssh-agent instead of from the usual location.\n\nYou can also specify an SSH key with `--ssh-key` if you want to use a specific key-pair.\n\n### K3sup plan for automation\n\nA new command was added to k3sup to help with automating large amounts of nodes.\n\n`k3sup plan` reads a JSON input file containing hosts, and will generate an installation command for a number of servers and agents.\n\nExample input file:\n\n```json\n[\n  {\n    \"hostname\": \"node-a-1\",\n    \"ip\": \"192.168.129.138\"\n  },\n  {\n    \"hostname\": \"node-a-2\",\n    \"ip\": \"192.168.129.128\"\n  },\n  {\n    \"hostname\": \"node-a-3\",\n    \"ip\": \"192.168.129.131\"\n  },\n  {\n    \"hostname\": \"node-a-4\",\n    \"ip\": \"192.168.129.130\"\n  },\n  {\n    \"hostname\": \"node-a-5\",\n    \"ip\": \"192.168.129.127\"\n  }\n]\n```\n\nThe following will create 1x primary server, with 2x additional servers within a HA etcd cluster, the last two nodes will be added as agents:\n\n```bash\nk3sup plan \\\n  devices.json \\\n  --user ubuntu \\\n  --servers 3 \\\n  --server-k3s-extra-args \"--disable traefik\" \\\n  --background > bootstrap.sh\n```\n\nThen make the file executable and run it:\n\n```bash\nchmod +x bootstrap.sh\n./bootstrap.sh\n```\n\nWatch a demo with dozens of Firecracker VMs: [Testing Kubernetes at Scale with bare-metal](https://youtu.be/o4UxRw-Cc8c)\n\nThe initial version of `k3sup plan` has a reduced set of flags. Flags such as `--k3s-version` and `--datastore` are not available, but feel free to propose an issue with what you need.\n\n### Create a multi-master (HA) setup with external SQL\n\nThe easiest way to test out k3s' multi-master (HA) mode with external storage, is to set up a Mysql server using DigitalOcean's managed service.\n\n* Get the connection string from your DigitalOcean dashboard, and adapt it\n\nBefore:\n```\nmysql://doadmin:80624d3936dfc8d2e80593@db-mysql-lon1-90578-do-user-6456202-0.a.db.ondigitalocean.com:25060/defaultdb?ssl-mode=REQUIRED\n\n```\n\nAfter:\n```\nmysql://doadmin:80624d3936dfc8d2e80593@tcp(db-mysql-lon1-90578-do-user-6456202-0.a.db.ondigitalocean.com:25060)/defaultdb\n```\n\nNote that we've removed `?ssl-mode=REQUIRED` and wrapped the host/port in `tcp()`.\n\n```bash\nexport DATASTORE=\"mysql://doadmin:80624d3936dfc8d2e80593@tcp(db-mysql-lon1-90578-do-user-6456202-0.a.db.ondigitalocean.com:25060)/defaultdb\n```\n\nYou can prefix this command with `  ` two spaces, to prevent it being cached in your bash history.\n\nGenerate a token used to encrypt data (If you already have a running node this can be retrieved by logging into a running node and looking in `/var/lib/rancher/k3s/server/token`)\n\n```bash\n# Best option for a token:\nexport TOKEN=$(openssl rand -base64 64)\n\n# Fallback for no openssl, on a Linux host:\nexport TOKEN=$(tr -dc A-Za-z0-9 </dev/urandom | head -c 64)\n\n# Failing that, then try:\nexport TOKEN=$(head -c 64 /dev/urandom|shasum| cut -d - -f 1)\n```\n\n\n* Create three VMs\n\nImagine we have the following three VMs, two will be servers, and one will be an agent.\n\n```bash\nexport SERVER1=104.248.135.109\nexport SERVER2=104.248.25.221\nexport AGENT1=104.248.137.25\n```\n\n* Install the first server\n\n```bash\nk3sup install --user root --ip $SERVER1 --datastore=\"${DATASTORE}\" --token=${TOKEN}\n```\n\n* Install the second server\n\n```bash\nk3sup install --user root --ip $SERVER2 --datastore=\"${DATASTORE}\" --token=${TOKEN}\n```\n\n* Join the first agent\n\nYou can join the agent to either server, the datastore is not required for this step.\n\n```bash\nk3sup join --user root --server-ip $SERVER1 --ip $AGENT1\n```\n\nPlease note that if you are using different usernames for SSH'ing to the agent and the server that you must provide the username for the server via the `--server-user` parameter.\n\n* Additional steps\n\nIf you run `kubectl get node`, you'll now see two masters/servers and one agent, however, we joined the agent to the first server. If the first server goes down, the agent will effectively also go offline.\n\n```bash\nkubectl get node\n\nNAME              STATUS                        ROLES    AGE     VERSION\nk3sup-1           Ready                         master   73s     v1.19.6+k3s1\nk3sup-2           Ready                         master   2m31s   v1.19.6+k3s1\nk3sup-3           Ready                         <none>   14s     v1.19.6+k3s1\n```\n\nThere are two ways to prevent a dependency on the IP address of any one host. The first is to create a TCP load-balancer in the cloud of your choice, the second is for you to create a DNS round-robbin record, which contains all of the IPs of your servers.\n\nIn your DigitalOcean dashboard, go to the Networking menu and click \"Load Balancer\", create one in the same region as your Droplets and SQL server. Select your two Droplets, i.e. `104.248.34.61` and `142.93.175.203`, and use `TCP` with port `6443`.\n\nIf you want to run `k3sup join` against the IP of the LB, then you should also add `TCP` port `22`\n\nMake sure that the health-check setting is also set to `TCP` and port `6443`. Wait to get your IP, mine was: `174.138.101.83`\n\nSave the LB into an environment variable:\n\n```bash\nexport LB=174.138.101.83\n```\n\nNow use `ssh` to log into both of your servers, and edit their config files at `/etc/systemd/system/k3s.service`, update the lines `--tls-san` and the following address, to that of your LB:\n\n```\nExecStart=/usr/local/bin/k3s \\\n    server \\\n        '--tls-san' \\\n        '104.248.135.109' \\\n```\n\nBecomes:\n\n```\nExecStart=/usr/local/bin/k3s \\\n    server \\\n        '--tls-san' \\\n        '174.138.101.83' \\\n```\n\nNow run:\n\n```bash\nsudo systemctl daemon-reload && \\\n  sudo systemctl restart k3s-agent\n```\n\nAnd repeat these steps on the other server.\n\nYou can update the agent manually, via ssh and edit `/etc/systemd/system/k3s-agent.service.env` on the host, or use `k3sup join` again, but only if you added port `22` to your LB:\n\n```bash\nk3sup join --user root --server-ip $LB --ip $AGENT1\n```\n\nFinally, regenerate your KUBECONFIG file with the LB's IP, instead of one of the servers:\n\n```bash\nk3sup install --skip-install --ip $LB\n```\n\nLog into the first server, and stop k3s `sudo systemctl stop k3s`, then check that kubectl still functions as expected:\n\n```bash\nexport KUBECONFIG=`pwd`/kubeconfig\nkubectl get node -o wide\n\nNAME              STATUS                        ROLES    AGE   VERSION\nk3sup-1           NotReady                      master   23m   v1.19.6+k3s1\nk3sup-2           Ready                         master   25m   v1.19.6+k3s1\nk3sup-3           Ready                         <none>   22m   v1.19.6+k3s1\n```\n\nYou've just simulated a failure of one of your masters/servers, and you can still access kubectl. Congratulations on building a resilient k3s cluster.\n\n### Create a multi-master (HA) setup with embedded etcd\n\nIn k3s `v1.19.5+k3s1` a HA multi-master (multi-server in k3s terminology) configuration is available called \"embedded etcd\". A quorum of servers will be required, which means having an odd number of nodes and least three. [See more](https://rancher.com/docs/k3s/latest/en/installation/ha-embedded/)\n\n* Initialize the cluster with the first server\n\nNote the `--cluster` flag\n\n```sh\nexport SERVER_IP=192.168.0.100\nexport USER=root\n\nk3sup install \\\n  --ip $SERVER_IP \\\n  --user $USER \\\n  --cluster \\\n  --k3s-version v1.19.1+k3s1\n```\n\n* Join each additional server\n\n> Note the new `--server` flag\n\n```sh\nexport USER=root\nexport SERVER_IP=192.168.0.100\nexport NEXT_SERVER_IP=192.168.0.101\n\nk3sup join \\\n  --ip $NEXT_SERVER_IP \\\n  --user $USER \\\n  --server-user $USER \\\n  --server-ip $SERVER_IP \\\n  --server \\\n  --k3s-version v1.19.1+k3s1\n```\n\nNow check `kubectl get node`:\n\n```sh\nkubectl get node\nNAME              STATUS   ROLES    AGE     VERSION\npaprika-gregory   Ready    master   8m27s   v1.19.2-k3s\ncave-sensor       Ready    master   27m     v1.19.2-k3s\n```\n\nIf you used `--no-extras` on the initial installation you will also need to provide it on each join:\n\n```sh\nexport USER=root\nexport SERVER_IP=192.168.0.100\nexport NEXT_SERVER_IP=192.168.0.101\n\nk3sup join \\\n  --ip $NEXT_SERVER_IP \\\n  --user $USER \\\n  --server-user $USER \\\n  --server-ip $SERVER_IP \\\n  --server \\\n  --no-extras \\\n  --k3s-version v1.19.1+k3s1\n```\n\n### üë®‚Äçüíª Micro-tutorial for Raspberry Pi (2, 3, or 4) ü•ß\n\nIn a few moments you will have Kubernetes up and running on your Raspberry Pi 2, 3 or 4. Stand by for the fastest possible install. At the end you will have a KUBECONFIG file on your local computer that you can use to access your cluster remotely.\n\n![](./docs/k3sup-rpi.png)\n*Conceptual architecture, showing `k3sup` running locally against bare-metal ARM devices.*\n\n* [Download etcher.io](https://www.balena.io/etcher/) for your OS\n\n* Flash an SD card using [Raspbian Lite](https://www.raspberrypi.org/downloads/raspbian/)\n\n* Enable SSH by creating an empty file named `ssh` in the boot partition\n\n* Generate an ssh-key if you don't already have one with `ssh-keygen` (hit enter to all questions)\n\n* Find the RPi IP with `ping -c raspberrypi.local`, then set `export SERVER_IP=\"\"` with the IP\n\n* Enable container features in the kernel, by editing `/boot/cmdline.txt` (or `/boot/firmware/cmdline.txt` on Ubuntu)\n\n* Add the following to the end of the line: ` cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory`\n\n* Copy over your ssh key with: `ssh-copy-id pi@raspberrypi.local`\n\n* Run `k3sup install --ip $SERVER_IP --user pi`\n\n* Point at the config file and get the status of the node:\n\n```sh\nexport KUBECONFIG=`pwd`/kubeconfig\nkubectl get node -o wide\n```\n\nYou now have `kubectl` access from your laptop to your Raspberry Pi running k3s.\n\nIf you want to join some nodes, run `export IP=\"\"` for each additional RPi, followed by:\n\n* `k3sup join --ip $IP --server-ip $SERVER_IP --user pi`\n\n> Remember all these commands are run from your computer, not the RPi.\n\nNow where next? I would recommend my detailed tutorial where I spend time looking at how to flash the SD card, deploy k3s, deploy OpenFaaS (for some useful microservices), and then get incoming HTTP traffic.\n\nTry it now: [Will it cluster? K3s on Raspbian](https://blog.alexellis.io/test-drive-k3s-on-raspberry-pi/)\n\n## Caveats on security\n\nIf you are using public cloud, then make sure you see the notes from the Rancher team on setting up a Firewall or Security Group.\n\nk3s docs: [k3s configuration / open ports](https://rancher.com/docs/k3s/latest/en/installation/installation-requirements/#networking)\n\n## Contributing\n\n### Blog posts & tweets\n\nBlogs posts, tutorials, and Tweets about k3sup (`#k3sup`) are appreciated. Please send a PR to the README.md file to add yours.\n\n### Contributing via GitHub\n\nBefore contributing code, please see the [CONTRIBUTING guide](https://github.com/alexellis/arkade/blob/master/CONTRIBUTING.md). Note that k3sup uses the same guide [arkade](https://arkade.dev)\n\nBoth Issues and PRs have their own templates. Please fill out the whole template.\n\nAll commits must be signed-off as part of the [Developer Certificate of Origin (DCO)](https://developercertificate.org)\n\n### License\n\nMIT\n\n## üì¢ What are people saying about `k3sup`?\n\n* [Five years of Raspberry Pi clusters](https://www.raspberrypi.org/blog/five-years-of-raspberry-pi-clusters/) - raspberrypi.org\n\n* [Multi-master HA Kubernetes in < 5 minutes](https://blog.alexellis.io/multi-master-ha-kubernetes-in-5-minutes/) by Alex Ellis\n\n* [Kubernetes Homelab with Raspberry Pi and k3sup](https://blog.alexellis.io/raspberry-pi-homelab-with-k3sup/)\n\n* [Building a Kubernetes cluster on Raspberry Pi running Ubuntu server](https://medium.com/icetek/building-a-kubernetes-cluster-on-raspberry-pi-running-ubuntu-server-8fc4edb30963) by Jakub Czapli≈Ñski\n\n* [Multi-node Kubernetes on Civo in 5 minutes flat with k3sup!](https://www.civo.com/learn/kubernetes-on-civo-in-5-minutes-flat) - Civo Learn guide\n\n* [Zero to k3s Kubeconfig in seconds on AWS EC2 with k3sup](https://rancher.com/blog/2019/k3s-kubeconfig-in-seconds) by Saiyam Pathak\n\n* [Create a 3-node k3s cluster with k3sup & DigitalOcean](https://blog.alexellis.io/create-a-3-node-k3s-cluster-with-k3sup-digitalocean/)\n\n* [Cheap k3s cluster using Amazon Lightsail](https://eamonbauman.com/2020/05/09/cheap-k3s-cluster-using-amazon-lightsail/)\n\n* [k3sup mentioned on Kubernetes Podcast episode 67](https://kubernetespodcast.com/episode/067-orka/) by Craig Box & Adam Glick\n\n* [Scheduling Kubernetes workloads to Raspberry Pi using Inlets and Crossplane](https://github.com/crossplaneio/tbs/blob/master/episodes/9/assets/README.md) by [Daniel Mangum](https://github.com/hasheddan)\n  * Also checkout the live [demo](https://youtu.be/RVAFEAnirZA)\n\n* Blog post by Ruan Bekker:\n\n    > Provision k3s to all the places with a awesome utility called \"k3sup\" by @alexellisuk. Definitely worth checking it out, its epic!\n\n    [Provision k3s on the fly with k3sup](https://sysadmins.co.za/provision-k3s-on-the-fly-with-k3sup/)\n\n* [Dave Cadwallader (@geek_dave)](https://twitter.com/geek_dave/status/1162386683200851969?s=20):\n\n    > Alex - Thanks so much for all the effort you put into your tools and tutorials.  My rpi homelab has been a valuable learning playground for CNCF tech thanks to you!\n\n* [k3sup in KubeWeekly #181](https://kubeweekly.io/2019/08/22/kubeweekly-181/)\n\n* [Will it cluster? K3s on Raspbian](https://blog.alexellis.io/test-drive-k3s-on-raspberry-pi/)\n\n* [Kubernetes the Easy Way with k3sup ‚Äì Cisco DevOps Series](https://blogs.cisco.com/developer/kubernetes-the-easy-way-devops-14)\n\n* [Trying tiny k3s on Google Cloud with k3sup](https://starkandwayne.com/blog/trying-tiny-k3s-on-google-cloud-with-k3sup/) by Stark & Wayne\n\n* [Setting up a Raspberry Pi Kubernetes Cluster with Blinkt! Strips that Show Number of Pods per Node](https://pleasereleaseme.net/setting-up-a-raspberry-pi-kubernetes-cluster-with-blinkt-strips-that-show-number-of-pods-per-node-using-k3sup/)\n\n* [From Zero to Kubernetes Dashboard within Minutes with k3sup and Kontena Lens](https://medium.com/@laurinevala/from-zero-to-kubernetes-dashboard-within-minutes-with-k3sup-and-kontena-lens-84f881400b10) - by Lauri Nevala\n\n* [BYOK - Build your Own Kubernetes Cluster with Raspberry Pis, k3s, and k3sup](https://speakerdeck.com/mikesir87/byok-build-your-own-kubernetes-cluster-with-raspberry-pis-k3s-and-k3sup) by Michael Irwin\n\n* [Run Kubernetes On Your Machine with k3sup](https://itnext.io/run-kubernetes-on-your-machine-7ee463af21a2) by Luc Juggery\n\n* [Trying out k3sup](https://blog.baeke.info/2019/10/25/trying-out-k3sup/) by Geert Baeke\n\n* [Creating your first Kubernetes cluster with k3sup](https://dev.to/kalaspuffar/creating-your-first-kubernetes-cluster-3kp2) by Daniel Persson\n\n* [My 2019 In Review - Hello Open Source](https://blog.heyal.co.uk/My-2019/) by Alistair Hey\n\n* [Kubernetes 104: Create a 2-node k3s cluster with k3sup](https://ahmed-abdelsamad.blogspot.com/2019/09/kubernetes-104-create-2-node-k3s.html) by Ahmed Abelsamad\n\n* [My home Kubernetes cluster driven by GitOps and k3sup](https://github.com/onedr0p/k3s-gitops) - by Devin Buhl\n\n* [Raspberry Pi: From 0 to k3s cluster in 5 min with k3sup and Ansible](https://blog.cloudgsx.es/topic/10/raspberry-pi-from-0-to-k3s-cluster-in-5-min-with-k3sup-and-ansible) - by Pablo Caderno\n\n* [Kubernetes: from Zero to Hero with Kompose, Minikube, k3sup and Helm](https://blog.mi.hdm-stuttgart.de/index.php/2020/02/29/image-editor-on-kubernetes-with-kompose-minikube-k3s-k3sup-and-helm-part-2/) by Leon Klingele, Alexander Merker & Florian Wintel\n\n* [Deploying a highly-available K3s with k3sup](https://ma.ttias.be/deploying-highly-available-k3s-k3sup/) by Dmitriy Akulov\n\n* [Multi-master HA Kubernetes using K3Sup on Windows10/Server 2019](https://github.com/TechGuyTN/K3Sup-Windows10/blob/d7ad4f642ae6ebf441b8137bd71111c9c2890add/README.md) by Aaron Holt\n\n* [Ansible Role: k3sup](https://github.com/vandot/ansible-role-k3sup) by Ivan Vandot\n\n* [HashiCorp Vault on K3s on RPi4](https://github.com/colin-mccarthy/k3s-pi-vault/tree/d5e616de9048da8b990dc7b99a6d2d96bd9e9cc5) by Colin McCarthy\n\n* [Raspberry Pi Cluster Part 2: ToDo API running on Kubernetes with k3s](https://www.dinofizzotti.com/blog/2020-05-09-raspberry-pi-cluster-part-2-todo-api-running-on-kubernetes-with-k3s/) by Dino Fizzotti\n\n* [Cloud Native Tools for Developers Webinar Recap](https://www.openfaas.com/blog/cloud-native-tools-webinar/) by Alex Ellis & Alistair Hey\n\n* [Unobtrusive local development with kubernetes, k3s, traefik2](https://www.codementor.io/@slavko/unobtrusive-local-development-with-kubernetes-k3s-traefik2-15uq596oja) by Vyacheslav\n\n* [C√≥mo desplegar un cl√∫ster de Kubernetes en 60 segundos con k3sup](https://www.cduser.com/como-desplegar-un-cluster-de-kubernetes-en-60-segundos-con-k3sup/) by Ignacio Van Droogenbroeck\n\n* [Raspberry Kubernetes cluster for my homlab with k3sup](https://hybridhacker.com/homelab-raspberry-kubernetes-cluster-with-k3sup.html) by Nicola Ballotta\n\n* [k3sup On MacOS Catalina](https://gizmo.codes/k3sup-on-macos-catalina/) by John Doyle\n\n* [Provision k3s on Google Cloud with Terraform and k3sup ‚Äî Nimble](https://medium.com/nimble/provision-k3s-on-google-cloud-with-terraform-and-k3sup-nimble-38fa3167b4c3) by Carlos Herrera\n\n* [K3s: Edge Kubernetes](https://redmonk.com/jgovernor/2020/01/31/k3s-edge-kubernetes/) by James Governor\n\n* [OpenStack sur LXD avec Juju et k3sup dans phoenixNAP](https://deep75.medium.com/openstack-sur-lxd-avec-juju-et-k3sup-dans-phoenixnap-e5867a487497)\n\n* [Creating a k3s Cluster with k3sup & Multipass üíª‚ò∏Ô∏è](https://dev.to/tomowatt/creating-a-k3s-cluster-with-k3sup-multipass-h26) by Tom Watt\n\n* [How I‚Äôve set up my highly-available Kubernetes cluster](https://jmac.ph/2021/01/25/how-ive-set-up-my-highly-available-kubernetes-cluster/) by JJ Macalinao\n\n* [Creating a K3S Raspberry PI Cluster with K3Sup to fire up nightscout with MongoDB](https://h3rmanns.medium.com/creating-a-k3s-raspberry-pi-cluster-with-k3sup-to-fire-up-a-nightscout-backend-service-based-on-a-27c1f5727e5b)\n\n* [Kubernetes Cluster with Rancher on Windows using K3s](https://adyanth.site/posts/kubernetes-cluster-on-windows/) by Adyanth H\n\n* [k3s in LXC on Proxmox with k3sup by Todd Edwards](https://gist.github.com/triangletodd/02f595cd4c0dc9aac5f7763ca2264185)\n\nCheckout the [Announcement tweet](https://twitter.com/alexellisuk/status/1162272786250735618?s=20)\n\n## Similar tools & glossary\n\nGlossary:\n\n* Kubernetes: master/slave\n* k3s: server/agent\n\nRelated tools:\n\n* [k3s](https://github.com/rancher/k3s) - Kubernetes as installed by `k3sup`. k3s is a compliant, light-weight, multi-architecture distribution of Kubernetes. It can be used to run Kubernetes locally or remotely for development, or in edge locations.\n* [k3d](https://github.com/rancher/k3d) - this tool runs a Docker container on your local laptop with k3s inside\n* [kind](https://github.com/kubernetes-sigs/kind) - kind can run a Kubernetes cluster within a Docker container for local development. k3s is also suitable for this purpose through `k3d`. KinD is not suitable for running a remote cluster for development.\n* [kubeadm](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/) - a tool to create fully-loaded, production-ready Kubernetes clusters with or without high-availability (HA). Tends to be heavier-weight and slower than k3s. It is aimed at cloud VMs or bare-metal computers which means it doesn't always work well with low-powered ARM devices.\n* [k3v](https://github.com/ibuildthecloud/k3v) - \"virtual kubernetes\" - a very early PoC from the author of k3s aiming to slice up a single cluster for multiple tenants\n* [k3sup-multipass](https://github.com/matti/k3sup-multipass) - a helper to launch single node k3s cluster with one command using a [multipass](https://multipass.run) VM and optionally proxy the ingress to localhost for easier development.\n\n## Troubleshooting and support\n\n### Maybe the problem is with K3s?\n\nIf you're having issues, it's likely that this is a problem with K3s, and not with k3sup. How do we know that? K3sup is a very mature project and has a few use-cases that it generally performs very well.\n\nRancher provides support for K3s [on their Slack](https://slack.rancher.io/) in the `#k3s` channel. This should be your first port of call. Your second port of call is to raise an issue with the K3s maintainers in the [K3s repo](https://github.com/k3s-io/k3s/issues)\n\nDo you want to install a specific version of K3s? See `k3sup install --help` and the `--k3s-version` and `--k3s-channel` flags.\n\nIs your system ready to run Kubernetes? K3s requires certain Kernel modules to be available, run `k3s check-config` and check the output. Alex tests K3sup with Raspberry Pi OS and Ubuntu LTS on a regular basis.\n\n### Common issues\n\nThe most common problem is that you missed a step, fortunately it's relatively easy to get the logs from the K3s service and it should tell you what's wrong.\n\n* For the Raspberry Pi you probably haven't updated `cmdline.txt` to enable cgroups for CPU and memory. Update it as per the instructions in this file.\n* You ran `kubectl` on a node. Don't do this. k3sup copies the file to your local workstation. Don't log into agents or servers other than to check logs / upgrade the system.\n* `sudo: a terminal is required to read the password` - setup password-less `sudo` on your hosts, see also:[Pre-requisites for k3sup agents and servers](#pre-requisites-for-k3sup-servers-and-agents)\n* You want to install directly on a server, without using SSH. See also: `k3sup install --local` which doesn't use SSH, but executes the commands directly on a host.\n\n* K3s server didn't start. Log in and run `sudo systemctl status k3s` or `sudo journalctl -u k3s` to see the logs for the service.\n* The K3s agent didn't start. Log in and run `sudo systemctl status k3s-agent`\n* You tried to remove and re-add a server in an etcd cluster and it failed. This is a known issue, see the [K3s issue tracker](https://github.com/k3s-io/k3s/issues).\n* You tried to use an unsupported version of a database for HA. See [this list from Rancher](https://rancher.com/docs/k3s/latest/en/installation/datastore/)\n* Your tried to join a node to the cluster and got an error \"ssh: handshake failed\". This is probably one of three possibilities:\n  - You did not run `ssh-copy-id`. Try to run it and check if you can log in to the server and the new node without a password prompt using regular `ssh`.\n  - You have an RSA public key. There is an [underlying issue in a Go library](https://github.com/golang/go/issues/39885) which is [referred here](https://github.com/alexellis/k3sup/issues/63). Please provide the additional parameter `--ssh-key ~/.ssh/id_rsa` (or wherever your private key lives) until the issue is resolved.\n  - You are using different usernames for SSH'ing to the server and the node to be added. In that case, playe provide the username for the server via the `--server-user` parameter.\n* Your `.ssh/config` file isn't being used by K3sup. K3sup does not use the config file used by the `ssh` command-line, but instead uses CLI flags, run `k3sup install/join --help` to learn which are supported.\n\n> Note: Passing `--no-deploy` to `--k3s-extra-args` was deprecated by the K3s installer in K3s 1.17. Use `--disable` instead or `--no-extras`.\n\n### Getting access to your KUBECONFIG\n\nYou may have run into an issue where `sudo` access is required for `kubectl` access.\n\nYou should not run kubectl on your server or agent nodes. k3sup is designed to rewrite and/or merge your cluster's config to your local KUBECONFIG file. You should run `kubectl` on your laptop / client machine.\n\nIf you've lost your kubeconfig, you can use `k3sup install --skip-install`. See also the various flags for merging and setting a context name.\n\n### Smart cards and 2FA\n\n> Warning: issues requesting support for smart cards / 2FA will be closed immediately. The feature has been proven to work, and is provided as-is.\n\nYou can use a smart card or 2FA security key such as a Yubikey. You must have your ssh-agent configured correctly, at that point k3sup will defer to the agent to make connections on MacOS and Linux. [Find out more](https://github.com/alexellis/k3sup/pull/312)\n\n### Misc note on `iptables`\n\n> Note added by Eduardo Minguez Perez\n\nCurrently there is an issue in k3s involving `iptables >= 1.8` that can affect the network communication. See the [k3s issue](https://github.com/rancher/k3s/issues/703) and the corresponding [kubernetes one](https://github.com/kubernetes/kubernetes/issues/71305) for more information and workarounds. The issue has been observed in Debian Buster but it can affect other distributions as well.\n"
        },
        {
          "name": "cmd",
          "type": "tree",
          "content": null
        },
        {
          "name": "docs",
          "type": "tree",
          "content": null
        },
        {
          "name": "get.sh",
          "type": "blob",
          "size": 4.9609375,
          "content": "#!/bin/bash\n\n# Copyright OpenFaaS Author(s) 2019\n#########################\n# Repo specific content #\n#########################\n\nexport VERIFY_CHECKSUM=0\nexport ALIAS=\"\"\nexport OWNER=alexellis\nexport REPO=k3sup\nexport BINLOCATION=\"/usr/local/bin\"\nexport SUCCESS_CMD=\"$BINLOCATION/$REPO version\"\n\n###############################\n# Content common across repos #\n###############################\n\nversion=$(curl -sI https://github.com/$OWNER/$REPO/releases/latest | grep -i \"location:\" | awk -F\"/\" '{ printf \"%s\", $NF }' | tr -d '\\r')\nif [ ! $version ]; then\n    echo \"Failed while attempting to install $REPO. Please manually install:\"\n    echo \"\"\n    echo \"1. Open your web browser and go to https://github.com/$OWNER/$REPO/releases\"\n    echo \"2. Download the latest release for your platform. Call it '$REPO'.\"\n    echo \"3. chmod +x ./$REPO\"\n    echo \"4. mv ./$REPO $BINLOCATION\"\n    if [ -n \"$ALIAS_NAME\" ]; then\n        echo \"5. ln -sf $BINLOCATION/$REPO $BINLOCATION/$ALIAS_NAME\"\n    fi\n    exit 1\nfi\n\nhasCli() {\n\n    hasCurl=$(which curl)\n    if [ \"$?\" = \"1\" ]; then\n        echo \"You need curl to use this script.\"\n        exit 1\n    fi\n}\n\ncheckHash(){\n\n    sha_cmd=\"sha256sum\"\n\n    if [ ! -x \"$(command -v $sha_cmd)\" ]; then\n    sha_cmd=\"shasum -a 256\"\n    fi\n\n    if [ -x \"$(command -v $sha_cmd)\" ]; then\n\n    targetFileDir=${targetFile%/*}\n\n    (cd $targetFileDir && curl -sSL $url.sha256|$sha_cmd -c >/dev/null)\n   \n        if [ \"$?\" != \"0\" ]; then\n            rm $targetFile\n            echo \"Binary checksum didn't match. Exiting\"\n            exit 1\n        fi   \n    fi\n}\n\ngetPackage() {\n    uname=$(uname)\n    userid=$(id -u)\n\n    suffix=\"\"\n    case $uname in\n    \"Darwin\")\n        arch=$(uname -m)\n        echo $arch\n        case $arch in\n        \"x86_64\")\n        suffix=\"-darwin\"\n        ;;\n        esac\n        case $arch in\n        \"arm64\")\n        suffix=\"-darwin-arm64\"\n        ;;\n        esac\n    ;;\n    \"MINGW\"*)\n    suffix=\".exe\"\n    BINLOCATION=\"$HOME/bin\"\n    mkdir -p $BINLOCATION\n\n    ;;\n    \"Linux\")\n        arch=$(uname -m)\n        echo $arch\n        case $arch in\n        \"aarch64\")\n        suffix=\"-arm64\"\n        ;;\n        esac\n        case $arch in\n        \"armv6l\" | \"armv7l\")\n        suffix=\"-armhf\"\n        ;;\n        esac\n    ;;\n    esac\n\n    targetFile=\"/tmp/$REPO$suffix\"\n    \n    if [ \"$userid\" != \"0\" ]; then\n        targetFile=\"$(pwd)/$REPO$suffix\"\n    fi\n\n    if [ -e \"$targetFile\" ]; then\n        rm \"$targetFile\"\n    fi\n\n    url=https://github.com/$OWNER/$REPO/releases/download/$version/$REPO$suffix\n    echo \"Downloading package $url as $targetFile\"\n\n    curl -sSL $url --output \"$targetFile\"\n\n    if [ \"$?\" = \"0\" ]; then\n\n        if [ \"$VERIFY_CHECKSUM\" = \"1\" ]; then\n            checkHash\n        fi\n\n    chmod +x \"$targetFile\"\n\n    echo \"Download complete.\"\n       \n    if [ ! -w \"$BINLOCATION\" ]; then\n\n            echo\n            echo \"============================================================\"\n            echo \"  The script was run as a user who is unable to write\"\n            echo \"  to $BINLOCATION. To complete the installation the\"\n            echo \"  following commands may need to be run manually.\"\n            echo \"============================================================\"\n            echo\n            echo \"  sudo cp $REPO$suffix $BINLOCATION/$REPO\"\n            \n            if [ -n \"$ALIAS_NAME\" ]; then\n                echo \"  sudo ln -sf $BINLOCATION/$REPO $BINLOCATION/$ALIAS_NAME\"\n            fi\n            \n            echo\n\n        else\n\n            echo\n            echo \"Running with sufficient permissions to attempt to move $REPO to $BINLOCATION\"\n\n            if [ ! -w \"$BINLOCATION/$REPO\" ] && [ -f \"$BINLOCATION/$REPO\" ]; then\n\n            echo\n            echo \"================================================================\"\n            echo \"  $BINLOCATION/$REPO already exists and is not writeable\"\n            echo \"  by the current user.  Please adjust the binary ownership\"\n            echo \"  or run sh/bash with sudo.\" \n            echo \"================================================================\"\n            echo\n            exit 1\n\n            fi\n\n            mv $targetFile $BINLOCATION/$REPO\n        \n            if [ \"$?\" = \"0\" ]; then\n                echo \"New version of $REPO installed to $BINLOCATION\"\n            fi\n\n            if [ -e \"$targetFile\" ]; then\n                rm \"$targetFile\"\n            fi\n\n            if [ -n \"$ALIAS_NAME\" ]; then\n                if [ ! -L $BINLOCATION/$ALIAS_NAME ]; then\n                    ln -s $BINLOCATION/$REPO $BINLOCATION/$ALIAS_NAME\n                    echo \"Creating alias '$ALIAS_NAME' for '$REPO'.\"\n                fi\n            fi\n\n            ${SUCCESS_CMD}\n        fi\n    fi\n}\n\nthanks() {\n    echo\n    echo \"================================================================\"\n    echo \"  Support Alex's work on K3sup via GitHub Sponsors\"\n    echo \"\" \n    echo \"  https://github.com/sponsors/alexellis\" \n    echo \"================================================================\"\n    echo\n}\n\nhasCli\ngetPackage\nthanks"
        },
        {
          "name": "go.mod",
          "type": "blob",
          "size": 0.3994140625,
          "content": "module github.com/alexellis/k3sup\n\ngo 1.21\n\nrequire (\n\tgithub.com/alexellis/go-execute/v2 v2.2.1\n\tgithub.com/mitchellh/go-homedir v1.1.0\n\tgithub.com/morikuni/aec v1.0.0\n\tgithub.com/spf13/cobra v1.8.0\n\tgolang.org/x/crypto v0.17.0\n\tgolang.org/x/term v0.15.0\n)\n\nrequire (\n\tgithub.com/inconshreveable/mousetrap v1.1.0 // indirect\n\tgithub.com/spf13/pflag v1.0.5 // indirect\n\tgolang.org/x/sys v0.15.0 // indirect\n)\n"
        },
        {
          "name": "go.sum",
          "type": "blob",
          "size": 2.2861328125,
          "content": "github.com/alexellis/go-execute/v2 v2.0.0 h1:e2fB9kZcPG0yg65XHL1/t6efcCUdt32AMbr/mv7A2tc=\ngithub.com/alexellis/go-execute/v2 v2.0.0/go.mod h1:FMdRnUTiFAmYXcv23txrp3VYZfLo24nMpiIneWgKHTQ=\ngithub.com/alexellis/go-execute/v2 v2.2.1 h1:4Ye3jiCKQarstODOEmqDSRCqxMHLkC92Bhse743RdOI=\ngithub.com/alexellis/go-execute/v2 v2.2.1/go.mod h1:FMdRnUTiFAmYXcv23txrp3VYZfLo24nMpiIneWgKHTQ=\ngithub.com/cpuguy83/go-md2man/v2 v2.0.2/go.mod h1:tgQtvFlXSQOSOSIRvRPT7W67SCa46tRHOmNcaadrF8o=\ngithub.com/cpuguy83/go-md2man/v2 v2.0.3/go.mod h1:tgQtvFlXSQOSOSIRvRPT7W67SCa46tRHOmNcaadrF8o=\ngithub.com/inconshreveable/mousetrap v1.1.0 h1:wN+x4NVGpMsO7ErUn/mUI3vEoE6Jt13X2s0bqwp9tc8=\ngithub.com/inconshreveable/mousetrap v1.1.0/go.mod h1:vpF70FUmC8bwa3OWnCshd2FqLfsEA9PFc4w1p2J65bw=\ngithub.com/mitchellh/go-homedir v1.1.0 h1:lukF9ziXFxDFPkA1vsr5zpc1XuPDn/wFntq5mG+4E0Y=\ngithub.com/mitchellh/go-homedir v1.1.0/go.mod h1:SfyaCUpYCn1Vlf4IUYiD9fPX4A5wJrkLzIz1N1q0pr0=\ngithub.com/morikuni/aec v1.0.0 h1:nP9CBfwrvYnBRgY6qfDQkygYDmYwOilePFkwzv4dU8A=\ngithub.com/morikuni/aec v1.0.0/go.mod h1:BbKIizmSmc5MMPqRYbxO4ZU0S0+P200+tUnFx7PXmsc=\ngithub.com/russross/blackfriday/v2 v2.1.0/go.mod h1:+Rmxgy9KzJVeS9/2gXHxylqXiyQDYRxCVz55jmeOWTM=\ngithub.com/spf13/cobra v1.7.0 h1:hyqWnYt1ZQShIddO5kBpj3vu05/++x6tJ6dg8EC572I=\ngithub.com/spf13/cobra v1.7.0/go.mod h1:uLxZILRyS/50WlhOIKD7W6V5bgeIt+4sICxh6uRMrb0=\ngithub.com/spf13/cobra v1.8.0 h1:7aJaZx1B85qltLMc546zn58BxxfZdR/W22ej9CFoEf0=\ngithub.com/spf13/cobra v1.8.0/go.mod h1:WXLWApfZ71AjXPya3WOlMsY9yMs7YeiHhFVlvLyhcho=\ngithub.com/spf13/pflag v1.0.5 h1:iy+VFUOCP1a+8yFto/drg2CJ5u0yRoB7fZw3DKv/JXA=\ngithub.com/spf13/pflag v1.0.5/go.mod h1:McXfInJRrz4CZXVZOBLb0bTZqETkiAhM9Iw0y3An2Bg=\ngolang.org/x/crypto v0.17.0 h1:r8bRNjWL3GshPW3gkd+RpvzWrZAwPS49OmTGZ/uhM4k=\ngolang.org/x/crypto v0.17.0/go.mod h1:gCAAfMLgwOJRpTjQ2zCCt2OcSfYMTeZVSRtQlPC7Nq4=\ngolang.org/x/sys v0.15.0 h1:h48lPFYpsTvQJZF4EKyI4aLHaev3CxivZmv7yZig9pc=\ngolang.org/x/sys v0.15.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\ngolang.org/x/term v0.15.0 h1:y/Oo/a/q3IXu26lQgl04j/gjuBDOBlx7X6Om1j2CPW4=\ngolang.org/x/term v0.15.0/go.mod h1:BDl952bC7+uMoWR75FIrCDx79TPU9oHkTZ9yRbYOrX0=\ngopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=\ngopkg.in/yaml.v3 v3.0.1/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=\n"
        },
        {
          "name": "hack",
          "type": "tree",
          "content": null
        },
        {
          "name": "main.go",
          "type": "blob",
          "size": 1.3203125,
          "content": "package main\n\nimport (\n\t\"os\"\n\n\t\"github.com/alexellis/k3sup/cmd\"\n\t\"github.com/alexellis/k3sup/pkg\"\n\t\"github.com/spf13/cobra\"\n)\n\nfunc main() {\n\n\tcmdInstall := cmd.MakeInstall()\n\tcmdVersion := cmd.MakeVersion()\n\tcmdJoin := cmd.MakeJoin()\n\tcmdUpdate := cmd.MakeUpdate()\n\tcmdReady := cmd.MakeReady()\n\tcmdPlan := cmd.MakePlan()\n\tcmdNodeToken := cmd.MakeNodeToken()\n\n\tprintk3supASCIIArt := cmd.PrintK3supASCIIArt\n\n\tvar rootCmd = &cobra.Command{\n\t\tUse: \"k3sup\",\n\t\tRun: func(cmd *cobra.Command, args []string) {\n\t\t\tprintk3supASCIIArt()\n\t\t\tcmd.Help()\n\t\t},\n\t\tExample: `  # Install k3s on a server with embedded etcd\n  k3sup install \\\n    --cluster \\\n    --host $SERVER_1 \\\n    --user $SERVER_1_USER \\\n    --k3s-channel stable\n\n  # Join a second server\n  k3sup join \\\n    --server \\\n    --host $SERVER_2 \\\n    --user $SERVER_2_USER \\\n    --server-host $SERVER_1 \\\n    --server-user $SERVER_1_USER \\\n    --k3s-channel stable\n\n  # Join an agent to the cluster\n  k3sup join \\\n    --host $SERVER_1 \\\n    --user $SERVER_1_USER \\\n    --k3s-channel stable\n  \n` + pkg.SupportMessageShort,\n\t}\n\n\trootCmd.AddCommand(cmdInstall)\n\trootCmd.AddCommand(cmdVersion)\n\trootCmd.AddCommand(cmdJoin)\n\trootCmd.AddCommand(cmdUpdate)\n\trootCmd.AddCommand(cmdReady)\n\trootCmd.AddCommand(cmdPlan)\n\trootCmd.AddCommand(cmdNodeToken)\n\n\tif err := rootCmd.Execute(); err != nil {\n\t\tos.Exit(1)\n\t}\n}\n"
        },
        {
          "name": "pkg",
          "type": "tree",
          "content": null
        },
        {
          "name": "vendor",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}