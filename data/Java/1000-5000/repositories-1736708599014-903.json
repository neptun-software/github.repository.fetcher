{
  "metadata": {
    "timestamp": 1736708599014,
    "page": 903,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjkyMA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "QNJR-GROUP/EasyTransaction",
      "stars": 2361,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.1640625,
          "content": "server_back.properties\r\n*.class\r\n*.log\r\n*.log.*\r\n.factorypath\r\n/target/*\r\n/.settings/*\r\n/bin/*\r\n/.project\r\n/.classpath\r\n/logs\r\n/target/\r\n.DS_Store\r\n.flattened-pom.xml\r\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 11.287109375,
          "content": "                                 Apache License\r\n                           Version 2.0, January 2004\r\n                        http://www.apache.org/licenses/\r\n\r\n   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION\r\n\r\n   1. Definitions.\r\n\r\n      \"License\" shall mean the terms and conditions for use, reproduction,\r\n      and distribution as defined by Sections 1 through 9 of this document.\r\n\r\n      \"Licensor\" shall mean the copyright owner or entity authorized by\r\n      the copyright owner that is granting the License.\r\n\r\n      \"Legal Entity\" shall mean the union of the acting entity and all\r\n      other entities that control, are controlled by, or are under common\r\n      control with that entity. For the purposes of this definition,\r\n      \"control\" means (i) the power, direct or indirect, to cause the\r\n      direction or management of such entity, whether by contract or\r\n      otherwise, or (ii) ownership of fifty percent (50%) or more of the\r\n      outstanding shares, or (iii) beneficial ownership of such entity.\r\n\r\n      \"You\" (or \"Your\") shall mean an individual or Legal Entity\r\n      exercising permissions granted by this License.\r\n\r\n      \"Source\" form shall mean the preferred form for making modifications,\r\n      including but not limited to software source code, documentation\r\n      source, and configuration files.\r\n\r\n      \"Object\" form shall mean any form resulting from mechanical\r\n      transformation or translation of a Source form, including but\r\n      not limited to compiled object code, generated documentation,\r\n      and conversions to other media types.\r\n\r\n      \"Work\" shall mean the work of authorship, whether in Source or\r\n      Object form, made available under the License, as indicated by a\r\n      copyright notice that is included in or attached to the work\r\n      (an example is provided in the Appendix below).\r\n\r\n      \"Derivative Works\" shall mean any work, whether in Source or Object\r\n      form, that is based on (or derived from) the Work and for which the\r\n      editorial revisions, annotations, elaborations, or other modifications\r\n      represent, as a whole, an original work of authorship. For the purposes\r\n      of this License, Derivative Works shall not include works that remain\r\n      separable from, or merely link (or bind by name) to the interfaces of,\r\n      the Work and Derivative Works thereof.\r\n\r\n      \"Contribution\" shall mean any work of authorship, including\r\n      the original version of the Work and any modifications or additions\r\n      to that Work or Derivative Works thereof, that is intentionally\r\n      submitted to Licensor for inclusion in the Work by the copyright owner\r\n      or by an individual or Legal Entity authorized to submit on behalf of\r\n      the copyright owner. For the purposes of this definition, \"submitted\"\r\n      means any form of electronic, verbal, or written communication sent\r\n      to the Licensor or its representatives, including but not limited to\r\n      communication on electronic mailing lists, source code control systems,\r\n      and issue tracking systems that are managed by, or on behalf of, the\r\n      Licensor for the purpose of discussing and improving the Work, but\r\n      excluding communication that is conspicuously marked or otherwise\r\n      designated in writing by the copyright owner as \"Not a Contribution.\"\r\n\r\n      \"Contributor\" shall mean Licensor and any individual or Legal Entity\r\n      on behalf of whom a Contribution has been received by Licensor and\r\n      subsequently incorporated within the Work.\r\n\r\n   2. Grant of Copyright License. Subject to the terms and conditions of\r\n      this License, each Contributor hereby grants to You a perpetual,\r\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\r\n      copyright license to reproduce, prepare Derivative Works of,\r\n      publicly display, publicly perform, sublicense, and distribute the\r\n      Work and such Derivative Works in Source or Object form.\r\n\r\n   3. Grant of Patent License. Subject to the terms and conditions of\r\n      this License, each Contributor hereby grants to You a perpetual,\r\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\r\n      (except as stated in this section) patent license to make, have made,\r\n      use, offer to sell, sell, import, and otherwise transfer the Work,\r\n      where such license applies only to those patent claims licensable\r\n      by such Contributor that are necessarily infringed by their\r\n      Contribution(s) alone or by combination of their Contribution(s)\r\n      with the Work to which such Contribution(s) was submitted. If You\r\n      institute patent litigation against any entity (including a\r\n      cross-claim or counterclaim in a lawsuit) alleging that the Work\r\n      or a Contribution incorporated within the Work constitutes direct\r\n      or contributory patent infringement, then any patent licenses\r\n      granted to You under this License for that Work shall terminate\r\n      as of the date such litigation is filed.\r\n\r\n   4. Redistribution. You may reproduce and distribute copies of the\r\n      Work or Derivative Works thereof in any medium, with or without\r\n      modifications, and in Source or Object form, provided that You\r\n      meet the following conditions:\r\n\r\n      (a) You must give any other recipients of the Work or\r\n          Derivative Works a copy of this License; and\r\n\r\n      (b) You must cause any modified files to carry prominent notices\r\n          stating that You changed the files; and\r\n\r\n      (c) You must retain, in the Source form of any Derivative Works\r\n          that You distribute, all copyright, patent, trademark, and\r\n          attribution notices from the Source form of the Work,\r\n          excluding those notices that do not pertain to any part of\r\n          the Derivative Works; and\r\n\r\n      (d) If the Work includes a \"NOTICE\" text file as part of its\r\n          distribution, then any Derivative Works that You distribute must\r\n          include a readable copy of the attribution notices contained\r\n          within such NOTICE file, excluding those notices that do not\r\n          pertain to any part of the Derivative Works, in at least one\r\n          of the following places: within a NOTICE text file distributed\r\n          as part of the Derivative Works; within the Source form or\r\n          documentation, if provided along with the Derivative Works; or,\r\n          within a display generated by the Derivative Works, if and\r\n          wherever such third-party notices normally appear. The contents\r\n          of the NOTICE file are for informational purposes only and\r\n          do not modify the License. You may add Your own attribution\r\n          notices within Derivative Works that You distribute, alongside\r\n          or as an addendum to the NOTICE text from the Work, provided\r\n          that such additional attribution notices cannot be construed\r\n          as modifying the License.\r\n\r\n      You may add Your own copyright statement to Your modifications and\r\n      may provide additional or different license terms and conditions\r\n      for use, reproduction, or distribution of Your modifications, or\r\n      for any such Derivative Works as a whole, provided Your use,\r\n      reproduction, and distribution of the Work otherwise complies with\r\n      the conditions stated in this License.\r\n\r\n   5. Submission of Contributions. Unless You explicitly state otherwise,\r\n      any Contribution intentionally submitted for inclusion in the Work\r\n      by You to the Licensor shall be under the terms and conditions of\r\n      this License, without any additional terms or conditions.\r\n      Notwithstanding the above, nothing herein shall supersede or modify\r\n      the terms of any separate license agreement you may have executed\r\n      with Licensor regarding such Contributions.\r\n\r\n   6. Trademarks. This License does not grant permission to use the trade\r\n      names, trademarks, service marks, or product names of the Licensor,\r\n      except as required for reasonable and customary use in describing the\r\n      origin of the Work and reproducing the content of the NOTICE file.\r\n\r\n   7. Disclaimer of Warranty. Unless required by applicable law or\r\n      agreed to in writing, Licensor provides the Work (and each\r\n      Contributor provides its Contributions) on an \"AS IS\" BASIS,\r\n      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\r\n      implied, including, without limitation, any warranties or conditions\r\n      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A\r\n      PARTICULAR PURPOSE. You are solely responsible for determining the\r\n      appropriateness of using or redistributing the Work and assume any\r\n      risks associated with Your exercise of permissions under this License.\r\n\r\n   8. Limitation of Liability. In no event and under no legal theory,\r\n      whether in tort (including negligence), contract, or otherwise,\r\n      unless required by applicable law (such as deliberate and grossly\r\n      negligent acts) or agreed to in writing, shall any Contributor be\r\n      liable to You for damages, including any direct, indirect, special,\r\n      incidental, or consequential damages of any character arising as a\r\n      result of this License or out of the use or inability to use the\r\n      Work (including but not limited to damages for loss of goodwill,\r\n      work stoppage, computer failure or malfunction, or any and all\r\n      other commercial damages or losses), even if such Contributor\r\n      has been advised of the possibility of such damages.\r\n\r\n   9. Accepting Warranty or Additional Liability. While redistributing\r\n      the Work or Derivative Works thereof, You may choose to offer,\r\n      and charge a fee for, acceptance of support, warranty, indemnity,\r\n      or other liability obligations and/or rights consistent with this\r\n      License. However, in accepting such obligations, You may act only\r\n      on Your own behalf and on Your sole responsibility, not on behalf\r\n      of any other Contributor, and only if You agree to indemnify,\r\n      defend, and hold each Contributor harmless for any liability\r\n      incurred by, or claims asserted against, such Contributor by reason\r\n      of your accepting any such warranty or additional liability.\r\n\r\n   END OF TERMS AND CONDITIONS\r\n\r\n   APPENDIX: How to apply the Apache License to your work.\r\n\r\n      To apply the Apache License to your work, attach the following\r\n      boilerplate notice, with the fields enclosed by brackets \"{}\"\r\n      replaced with your own identifying information. (Don't include\r\n      the brackets!)  The text should be enclosed in the appropriate\r\n      comment syntax for the file format. We also recommend that a\r\n      file or class name and description of purpose be included on the\r\n      same \"printed page\" as the copyright notice for easier\r\n      identification within third-party archives.\r\n\r\n   Copyright {yyyy} {name of copyright owner}\r\n\r\n   Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   you may not use this file except in compliance with the License.\r\n   You may obtain a copy of the License at\r\n\r\n       http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n   Unless required by applicable law or agreed to in writing, software\r\n   distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   See the License for the specific language governing permissions and\r\n   limitations under the License.\r\n"
        },
        {
          "name": "easytrans-core",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-dashboard",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-demo",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-extensionsuite-database-starter",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-log-database-starter",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-log-redis-starter",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-queue-kafka-starter",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-queue-ons-starter",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-rpc-dubbo-starter",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-rpc-rest-ribbon-starter",
          "type": "tree",
          "content": null
        },
        {
          "name": "easytrans-starter",
          "type": "tree",
          "content": null
        },
        {
          "name": "pom.xml",
          "type": "blob",
          "size": 6.802734375,
          "content": "<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\r\n\t<modelVersion>4.0.0</modelVersion>\r\n\t<name>EasyTransaction</name>\r\n\r\n\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t<artifactId>easytrans</artifactId>\r\n\t<!-- since maven 3.5 -->\r\n\t<version>${revision}</version>\r\n\t<packaging>pom</packaging>\r\n\r\n\r\n\t<description>A distribute transaction solution unified the usage of TCC , SAGA , reliable message, compensate and so on</description>\r\n\t<url>https://github.com/QNJR-GROUP/EasyTransaction</url>\r\n\t<organization>\r\n\t\t<name>QNJR</name>\r\n\t</organization>\r\n\t\r\n\t<licenses>\r\n\t\t<license>\r\n\t\t\t<name>Apache License, Version 2.0</name>\r\n\t\t\t<url>http://www.apache.org/licenses/LICENSE-2.0</url>\r\n\t\t</license>\r\n\t</licenses>\r\n\t\r\n\t<developers>\r\n\t\t<developer>\r\n\t\t\t<id>Xu Deyou</id>\r\n\t\t\t<name>Xu Deyou</name>\r\n\t\t\t<email>skyes.xu@qq.com</email>\r\n\t\t</developer>\r\n\t</developers>\r\n\r\n\t<scm>\r\n\t\t<connection>scm:git:git://github.com/QNJR-GROUP/EasyTransaction.git</connection>\r\n\t\t<developerConnection>scm:git:ssh://github.com:QNJR-GROUP/EasyTransaction.git</developerConnection>\r\n\t\t<url>https://github.com/QNJR-GROUP/EasyTransaction/tree/master</url>\r\n\t</scm>\r\n\r\n\r\n\t<properties>\r\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\r\n\t\t<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\r\n\t\t<java.version>1.8</java.version>\r\n\t\t<revision>1.4.3</revision>\r\n\t</properties>\r\n\r\n\r\n\t<modules>\r\n\t\t<module>easytrans-core</module>\r\n\t\t<module>easytrans-starter</module>\r\n\t\t<module>easytrans-log-database-starter</module>\r\n\t\t<module>easytrans-log-redis-starter</module>\r\n\t\t<module>easytrans-rpc-dubbo-starter</module>\r\n\t\t<module>easytrans-rpc-rest-ribbon-starter</module>\r\n\t\t<module>easytrans-queue-ons-starter</module>\r\n\t\t<module>easytrans-queue-kafka-starter</module>\r\n\t\t<module>easytrans-extensionsuite-database-starter</module>\r\n\t\t<!-- <module>easytrans-dashboard</module> -->\r\n\t</modules>\r\n\r\n\r\n \t<parent>\r\n\t\t<groupId>org.springframework.boot</groupId>\r\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\r\n\t\t<version>1.5.19.RELEASE</version>\r\n\t</parent>\r\n\r\n\t<dependencyManagement>\r\n\t\t<dependencies>\r\n \t\t\t<dependency>\r\n\t\t\t\t<groupId>org.springframework.cloud</groupId>\r\n\t\t\t\t<artifactId>spring-cloud-dependencies</artifactId>\r\n\t\t\t\t<version>Dalston.SR5</version>\r\n\t\t\t\t<type>pom</type>\r\n\t\t\t\t<scope>import</scope>\r\n\t\t\t</dependency> \r\n\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t\t\t\t<artifactId>easytrans-core</artifactId>\r\n\t\t\t\t<version>${revision}</version>\r\n\t\t\t</dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t\t\t\t<artifactId>easytrans-starter</artifactId>\r\n\t\t\t\t<version>${revision}</version>\r\n\t\t\t</dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t\t\t\t<artifactId>easytrans-queue-ons-starter</artifactId>\r\n\t\t\t\t<version>${revision}</version>\r\n\t\t\t</dependency>\r\n\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t\t\t\t<artifactId>easytrans-queue-kafka-starter</artifactId>\r\n\t\t\t\t<version>${revision}</version>\r\n\t\t\t</dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t\t\t\t<artifactId>easytrans-rpc-rest-ribbon-starter</artifactId>\r\n\t\t\t\t<version>${revision}</version>\r\n\t\t\t</dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t\t\t\t<artifactId>easytrans-rpc-dubbo-starter</artifactId>\r\n\t\t\t\t<version>${revision}</version>\r\n\t\t\t</dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t\t\t\t<artifactId>easytrans-log-database-starter</artifactId>\r\n\t\t\t\t<version>${revision}</version>\r\n\t\t\t</dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>com.yiqiniu.easytrans</groupId>\r\n\t\t\t\t<artifactId>easytrans-log-redis-starter</artifactId>\r\n\t\t\t\t<version>${revision}</version>\r\n\t\t\t</dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n                <groupId>com.yiqiniu.easytrans</groupId>\r\n                <artifactId>easytrans-extensionsuite-database-starter</artifactId>\r\n                <version>${revision}</version>\r\n            </dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n                <groupId>com.yiqiniu.easytrans</groupId>\r\n                <artifactId>easytrans-dashboard</artifactId>\r\n                <version>${revision}</version>\r\n            </dependency>\r\n\r\n\t\t\t<dependency>\r\n\t\t\t\t<groupId>org.apache.curator</groupId>\r\n\t\t\t\t<artifactId>curator-recipes</artifactId>\r\n\t\t\t\t<version>4.0.1</version>\r\n\t\t\t</dependency>\r\n\t\t\t\r\n\t\t\t<dependency>\r\n                <groupId>org.apache.curator</groupId>\r\n                <artifactId>curator-framework</artifactId>\r\n                <version>4.0.1</version>\r\n            </dependency>\r\n\r\n \t\t\t<dependency>\r\n\t\t\t\t<groupId>org.apache.zookeeper</groupId>\r\n\t\t\t\t<artifactId>zookeeper</artifactId>\r\n\t\t\t\t<version>3.4.10</version>\r\n\t\t\t</dependency> \r\n\t\t</dependencies>\r\n\t</dependencyManagement>\r\n\t\r\n\t<build>\r\n\t\t<plugins>\r\n\t\t\t<plugin>\r\n\t\t\t\t<groupId>org.codehaus.mojo</groupId>\r\n\t\t\t\t<artifactId>flatten-maven-plugin</artifactId>\r\n\t\t\t\t<version>1.0.0</version>\r\n\t\t\t\t<configuration>\r\n\t\t\t\t\t<flattenMode>bom</flattenMode>\r\n\t\t\t\t\t<updatePomFile>true</updatePomFile>\r\n\t\t\t\t</configuration>\r\n\t\t\t\t<executions>\r\n\t\t\t\t\t<execution>\r\n\t\t\t\t\t\t<id>flatten</id>\r\n\t\t\t\t\t\t<phase>process-resources</phase>\r\n\t\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t\t<goal>flatten</goal>\r\n\t\t\t\t\t\t</goals>\r\n\t\t\t\t\t</execution>\r\n\t\t\t\t\t<execution>\r\n\t\t\t\t\t\t<id>flatten.clean</id>\r\n\t\t\t\t\t\t<phase>clean</phase>\r\n\t\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t\t<goal>clean</goal>\r\n\t\t\t\t\t\t</goals>\r\n\t\t\t\t\t</execution>\r\n\t\t\t\t</executions>\r\n\t\t\t</plugin>\r\n\t\t\t<plugin>\r\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t\t\t<artifactId>maven-source-plugin</artifactId>\r\n\t\t\t\t<executions>\r\n\t\t\t\t\t<execution>\r\n\t\t\t\t\t\t<id>attach-sources</id>\r\n\t\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t\t<goal>jar-no-fork</goal>\r\n\t\t\t\t\t\t</goals>\r\n\t\t\t\t\t</execution>\r\n\t\t\t\t</executions>\r\n\t\t\t</plugin>\r\n\t\t\t<plugin>\r\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t\t\t<artifactId>maven-javadoc-plugin</artifactId>\r\n\t\t\t\t<configuration>\r\n\t\t\t\t\t<additionalparam>-Xdoclint:none</additionalparam>\r\n\t\t\t\t</configuration>\r\n\t\t\t\t<executions>\r\n\t\t\t\t\t<execution>\r\n\t\t\t\t\t\t<id>attach-javadocs</id>\r\n\t\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t\t<goal>jar</goal>\r\n\t\t\t\t\t\t</goals>\r\n\t\t\t\t\t</execution>\r\n\t\t\t\t</executions>\r\n\t\t\t</plugin>\r\n\t\t\t<plugin>\r\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t\t\t<artifactId>maven-gpg-plugin</artifactId>\r\n\t\t\t\t<version>1.5</version>\r\n\t\t\t\t<executions>\r\n\t\t\t\t\t<execution>\r\n\t\t\t\t\t\t<id>sign-artifacts</id>\r\n\t\t\t\t\t\t<phase>verify</phase>\r\n\t\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t\t<goal>sign</goal>\r\n\t\t\t\t\t\t</goals>\r\n\t\t\t\t\t</execution>\r\n\t\t\t\t</executions>\r\n\t\t\t</plugin>\r\n\t\t</plugins>\r\n\t</build>\r\n\r\n\t<distributionManagement>\r\n\t\t<snapshotRepository>\r\n\t\t\t<id>ossrh</id>\r\n\t\t\t<url>https://oss.sonatype.org/content/repositories/snapshots</url>\r\n\t\t</snapshotRepository>\r\n\t\t<repository>\r\n\t\t\t<id>ossrh</id>\r\n\t\t\t<url>https://oss.sonatype.org/service/local/staging/deploy/maven2/</url>\r\n\t\t</repository>\r\n\t</distributionManagement>\r\n\r\n</project>"
        },
        {
          "name": "readme-en.md",
          "type": "blob",
          "size": 18.39453125,
          "content": "This article a bit outofdate, some new function has been added , you can refer readme.md in Chinese for news, or you can submit an issue to let me know you want me to update this article\n\n\n# English\n(English is not my native language, can someone help me to review the text below?)\n\n## The origin\n\nThis framework is inspired by a PPT <Distribute transation handling in a large scale SOA system>(<大规模SOA系统的分布式事务处理>) written by Cheng Li who works in Alipay\n\n\nThis framework aims to solve the problem in our company that have repeatedly designed intermediate states, idempotent implementations, and retry logic for each distributed transaction scenario.\n\n\nWith this framework, we can solve all the distributed transaction scenarios that have been found, reduce the design and development workload, improve the development efficiency, and uniformly ensure the reliability of transaction implementation.\n\n\nCharacteristic:\n\n* a framework composited all types of transaction patterns.\n* multiple pattern of transactions can be used together.\n* High performance.\n\t* most business system bottlenecks are in the business database, \n\t* and the framework's extra consumption to business database is a 25-byte row(if the framework's idempotent implementation is not enabled)\n* Optional idempotent implementations and calling sequence guarantee implement\n\t* it will greatly reduce business development consumption\n\t* but when enabled, an idempotent control row will write into the business database\n* Can be completely decoupled in business code, no framework class will introduced in businese code(but not configuration code)\n* support nested transactions.\n* Without additional deployment for coordinators, coordinators are in the service APP\n\t* you can also split coordinators out of service APP too\n* Distributed transaction ID can be associated with businese ID, businese type, and APPID, which is convenient for monitoring the execution of distributed transactions of various services.\n\n\n\n## Distributed transaction scenario and corresponding implementation of framework\n\nDistributed business scenario\n\n* no distributed transactions.\n\t* most commonly used\n\t* top priority\n* use the message queue to achieve Eventually consistent\n\t* applicable to the business that can decide the global transaction status(commit/rollback) internally(with out other service)\n\t* commonly used\n\t* if you must interact with other service's write interfaces, give priority to use.\n\t* based on whether it is guaranteed to be delivered to subscribers, divided into reliable information and best effort delivery message.\n* compensation pattern\n\t* applicable to businesses that require remote execution results to determine global-transaction status, and remote execution is able to make compensation.\n\t* common\n\t* Priority is given to compensation-based eventual consistency transactions if there's unsolvable problems with message queues are used\n\t* In this framework, compensation pattern do not support nested transaction, you can use TCC instead when nested transaction is required\n* TCC pattern\n\t* applicable to businesses that require remote execution results to determine global-transaction status, and remote execution is unable to make compensation.\n\t* the least common.\n\t* the final solution encompasses all scenarios that must be implemented using 2PC. \n\t* The maximum amount of coding and the maximum consumption of performance,it should be avoid using as far as possible.\n* SAGA pattern\n\t* it's similar to compensation pattern.\n\t* the difference between compensation pattern and SAGA is that slave/sub transactions are not executed during the local transaction of master\n\t* SAGA executed asynchronously through the queue, thus reducing the lock time of master transaction records\n\t* When a lot of synchronous calls(e.g. TCC,Compensation) are in master transacion, SAGA can be used instead of synchronous calls for performance\n\t* when using saga,there's something to be pay attention(just go and see demo), because the transaction of the master will be split into two.\n\t* The SAGA implemented in this framework is not a traditional SAGA. \n\t* The difference between traditional SAGA and this SAGA can be analogized to the relationship between traditional compensation and TCC.\n\t* And the framework uses RPC instead of queues to implement SAGA for reasons that can be seen in the SAGA-TCC DEMO\n\n### The corresponding implement and basic principles of the framework\n\nThe framework implements all kinds of transaction patterns mentioned above and provides a unified and easy to use interface. The following section introduced the basic principles.\n\n#### without distribute transaction\njust as the tradition local transaction, EastyTransaction totally not intervention\n\n#### Other distribute transaction\n\nThe core dependency of the framework is Spring's TransactionSynchronization class. Easytransaction can be used as long as the TransactionManager inherits from AbstractPlatformTransactionManager (basically all the TransactionManager inherits from this implementation). In addition, after version 1.0.0, the framework uses SPRING BOOT configuration capabilities and JDK8 features, so SPRING BOOT and JDK8 is also a must option.\n\n\nFor distributed transactions, the framework hook the corresponding framework operations into TransactionSynchronization before calling the remote transaction method, e.g.:\n\n* when using reliable messages, the framework will send messages after the golobal-transaction status conifrms, ensuring that the messages can be seen externally after global-transaction status confirms, lighten the burden of coding sending-acknowledging-detecting pattern\n* when Using TCC, the framework calls Confirm or Cancel depending on the golobal-transaction status\n\n\nThe framework has background threads responsible for CRASH recovery (e.g. to execute confirm or rollback in TCC) based on \"write logs prior to the execution of a distributed service invocation,so that we can tell whether the remote service may have been invoked\" and \"a framework record submitted with the transaction to determine the global-transaction status\" \n\nThe framework also has an  (optional) implementation of idempotency, which ensures that business methods are logically executed only once (it is possible to execute multiple times, but methods executed multiple times are rolled back, so business programs need to control their idempotency when it comes to non-rollbackable external resources)\n\nThe framework also handles method call orders, for example, in compensation pattern:\n* If the original operation is not invoked(or delay by network), the corresponding compensation operation written by user will not be invoked(but framework will mark that compensation has already executed)\n* If compensation methods has marked executed, the (delayed) orignal operation whether it has been executed or not, will not be invoked\n\n\nThe results of all remote calls are returned in the form of a Future object, which gives the framework room for performance optimization, and all logs will not be written until trying to obtain first result. Once a business program attempts to get execution results, it writes the log in bulk and subsequently calls the remote method concurrently.\n\nThe framework will check whether there's an exception in remote-calls before COMMIT. Once there's a remote method throws an Exception, the framework will roll back the business before commit. This ensures the simplicity of the programming model and facilitates the correct and understandable code.\n\n\n\n## coding introduction\n\n###  code\n\nBusiness code can introduce EasyTransaction by maven\n\n\t  <dependency>\n        <groupId>com.yiqiniu.easytrans</groupId>\n        <artifactId>easytrans-starter</artifactId>\n        <version>1.1.3</version>\n      </dependency>\n\nThis Starter contains several default implement, included: RDBS based distributed transaction log，Netflix-ribbon based http RPC implement，KAFKA based queue，if you want to replace it ,just exclude it.\n\n\n#### Business initiator\nFor business initiators, the framework exposes only one interface.\n\n    public interface EasyTransFacade {\n\t/**\n\t * start easy Transaction\n\t * @param busCode appId+busCode+trxId is a global unique id,no matter this transaction commit or roll back\n\t * @param trxId see busCode\n\t */\n\tvoid startEasyTrans(String busCode, String trxId);\n\n\t/**\n\t * execute remote transaction\n\t * @param params\n\t * @return\n\t */\n\t<P extends EasyTransRequest<R, E>, E extends EasyTransExecutor, R extends Serializable> Future<R> execute(P params);\n    }\n\nthe remote method can be invoked directly without considering the specific type of distributed transaction and subsequent processing,as following:\n\n\t@Transactional\n\tpublic int buySomething(int userId,long money){\n\t\t\n\t\t/**\n\t\t * finish the local transaction first, in order for performance and generated of business id\n\t\t */\n\t\tInteger id = saveOrderRecord(jdbcTemplate,userId,money);\n\t\t\n\t\t/**\n\t\t * annotation the global transactionId, it is combined of appId + bussiness_code + id\n\t\t * this line of code can be omit,then framework will use \"default\" as businessCode, and will generate an id\n\t\t * but it will make us harder to associate an global transaction to an concrete business\n\t\t */\n\t\ttransaction.startEasyTrans(BUSINESS_CODE, id);\n\t\t\n\t\t/**\n\t\t * call remote service to deduct money, it's a TCC service,\n\t\t * framework will maintains the eventually constancy based on the final transaction status of method buySomething \n\t\t * if you think introducing object transaction(EasyTransFacade) is an unacceptable coupling\n\t\t * then you can refer to another demo(interfacecall) in the demos directory, it will show you how to execute transaction by user defined interface\n\t\t */\n\t\tWalletPayRequestVO deductRequest = new WalletPayRequestVO();\n\t\tdeductRequest.setUserId(userId);\n\t\tdeductRequest.setPayAmount(money);\n\t\t\n\t\t/**\n\t\t * return future for the benefits of performance enhance(batch write execute log and batch execute RPC)\n\t\t */\n\t\tFuture<WalletPayResponseVO> deductFuture = transaction.execute(deductRequest);\n\t\t\n\t\t\n\t\t/**\n\t\t * publish a message when this global-transaction is confirm\n\t\t * so the other services subscribe for this event can receive this message\n\t\t */\n\t\tOrderFinishedMessage orderFinishedMsg = new OrderFinishedMessage();\n\t\torderFinishedMsg.setUserId(userId);\n\t\torderFinishedMsg.setOrderAmt(money);\n\t\ttransaction.execute(orderFinishedMsg);\n\t\t\n\t\t/**\n\t\t * you can add more types of transaction calls here, e.g. SAGA-TCC、Compensation and so on\n\t\t * framework will maintains the eventually consistent \n\t\t */\n\t\t\n\t\t/**\n\t\t * we can get remote service result to determine whether to commit this transaction \n\t\t * \n\t\t * deductFuture.get(); \n\t\t */\n\t\treturn id;\n\t}\n\n#### Service Provider\nFor service providers, the corresponding interface is implemented and registered to the Bean container of Spring.\n\nFor example in TCC，it needs to implements TccMethod：\n\n    @Component\n    public class WalletPayTccMethod implements TccMethod<WalletPayTccMethodRequest, WalletPayTccMethodResult>{\n\n\t@Resource\n\tprivate WalletService wlletService;\n\n\t@Override\n\tpublic WalletPayTccMethodResult doTry(WalletPayTccMethodRequest param) {\n\t\treturn wlletService.doTryPay(param);\n\t}\n\n\t@Override\n\tpublic void doConfirm(WalletPayTccMethodRequest param) {\n\t\twlletService.doConfirmPay(param);\n\t}\n\n\t@Override\n\tpublic void doCancel(WalletPayTccMethodRequest param) {\n\t\twlletService.doCancelPay(param);\n\t}\n    }\n\nWalletPayTccMethodRequest is the request parameter, which is POJO inherited from the EasyTransRequest class, And it needs to add BusinessIdentifer annotations to tell the framework what's the AppID and  business code corresponding to this request:\n\n\t@BusinessIdentifer(appId=Constant.APPID,busCode=METHOD_NAME)\n\tpublic class WalletPayTccMethodRequest implements TccTransRequest<WalletPayTccMethodResult>{\n\t\tprivate static final long serialVersionUID = 1L;\n\t\t\n\t\tprivate Integer userId;\n\t\t\n\t\tprivate Long payAmount;\n\n\t\tpublic Long getPayAmount() {\n\t\t\treturn payAmount;\n\t\t}\n\n\t\tpublic void setPayAmount(Long payAmount) {\n\t\t\tthis.payAmount = payAmount;\n\t\t}\n\n\t\tpublic Integer getUserId() {\n\t\t\treturn userId;\n\t\t}\n\n\t\tpublic void setUserId(Integer userId) {\n\t\t\tthis.userId = userId;\n\t\t}\n\t}\n\nThe above example is a traditional form of invocation. The business code decoupling form is as follows. For more specific usage, please refer to demo(interfacecall):\n\n\t@Transactional\n\tpublic String buySomething(int userId,long money){\n\t\t\n\t\tint id = saveOrderRecord(jdbcTemplate,userId,money);\n\t\t\n\t\t//WalletPayRequestVOjust need to implements Serializable\n\t\tWalletPayRequestVO request = new WalletPayRequestVO();\n\t\trequest.setUserId(userId);\n\t\trequest.setPayAmount(money);\n\t\t\n\t\t//payService is an framework generated object of a user customed interface without any super classes\n\t\tWalletPayResponseVO pay = payService.pay(request);\n\n\t\treturn \"id:\" + id + \" freeze:\" + pay.getFreezeAmount();\n\t\t}\n\n#### more examples\nplease refer in the directory easytrans-demo\nmore completed configuration and usage please refer in UT of easytrans-starter\n\n### configuration\n\nEach business database needs to add two tables.\n\n\t-- to record whether the global-transaction status\n\t-- the fileds start with 'p_'  represents the parent transaction ID corresponding to this transaction.\n\t-- When select for update executed, if transaction ID corresponding record does not exist, transaction must be failed.\n\t-- Records exist, but status 0 indicates transaction success, and 1 indicates transaction failure (including parent transaction and this transaction)\n\t- the record exists, but status is 2 indicating that the final state of the transaction is unknown.\n\tCREATE TABLE `executed_trans` (\n\t  `app_id` smallint(5) unsigned NOT NULL,\n\t  `bus_code` smallint(5) unsigned NOT NULL,\n\t  `trx_id` bigint(20) unsigned NOT NULL,\n\t  `p_app_id` smallint(5) unsigned DEFAULT NULL,\n\t  `p_bus_code` smallint(5) unsigned DEFAULT NULL,\n\t  `p_trx_id` bigint(20) unsigned DEFAULT NULL,\n\t  `status` tinyint(1) NOT NULL,\n\t  PRIMARY KEY (`app_id`,`bus_code`,`trx_id`),\n\t  KEY `parent` (`p_app_id`,`p_bus_code`,`p_trx_id`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;\n\t\n\tCREATE TABLE `idempotent` (\n\t  `src_app_id` smallint(5) unsigned NOT NULL COMMENT 'source AppID',\n\t  `src_bus_code` smallint(5) unsigned NOT NULL COMMENT 'source business code',\n\t  `src_trx_id` bigint(20) unsigned NOT NULL COMMENT 'source transaction ID',\n\t  `app_id` smallint(5) NOT NULL COMMENT 'invoked APPID',\n\t  `bus_code` smallint(5) NOT NULL COMMENT 'invoked business code',\n\t  `call_seq` smallint(5) NOT NULL COMMENT 'invokded sequence of the same businesss code within a global-transaction',\n\t  `handler` smallint(5) NOT NULL COMMENT 'handler appid',\n\t  `called_methods` varchar(64) NOT NULL COMMENT 'invoked methods',\n\t  `md5` binary(16) NOT NULL COMMENT 'request parameter MD5',\n\t  `sync_method_result` blob COMMENT 'business called result',\n\t  `create_time` datetime NOT NULL COMMENT 'executed time',\n\t  `update_time` datetime NOT NULL,\n\t  `lock_version` smallint(32) NOT NULL COMMENT 'lock version',\n\t  PRIMARY KEY (`src_app_id`,`src_bus_code`,`src_trx_id`,`app_id`,`bus_code`,`call_seq`,`handler`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\n\n（RDBS based distributed transaction log，if you use REDIS,then it's unnecessary）You need to have a RDBS that record transaction logs and create two tables for it. Each business service must have a transaction log database. Multiple services can share one transaction log database.\n\n\tCREATE TABLE `trans_log_detail` (\n\t  `log_detail_id` int(11) NOT NULL AUTO_INCREMENT,\n\t  `trans_log_id` binary(12) NOT NULL,\n\t  `log_detail` blob,\n\t  `create_time` datetime NOT NULL,\n\t  PRIMARY KEY (`log_detail_id`),\n\t  KEY `app_id` (`trans_log_id`)\n\t) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;\n\t\n\tCREATE TABLE `trans_log_unfinished` (\n\t  `trans_log_id` binary(12) NOT NULL,\n\t  `create_time` datetime NOT NULL,\n\t  PRIMARY KEY (`trans_log_id`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\tSELECT * FROM translog.trans_log_detail;\n\n## extension\n\nThe framework use interface to glue each module, it is flexible expansion. The following modules are recommended to extend:\n\n* RPC implementation\n\t* support for Alibaba DUBBO, SPRING CLOUD RIBBON/EUREKA at present.\n\t* welcome additional implementation.\n* message queue implementation\n\t* support for Alibaba ONS at present (using unordered messages when creating) and KAFKA\n\t* welcomes additional implementation and requires two core approaches.\n* serialization implementation\n\t* The serialization provided by Spring-core\n\t* welcomes additional implementation to enhance efficiency.\n* Filter implementation\n\t* there are idempotent Filter, metadata setting FILTER, and nested transaction assistance handling Filter.\n\t* new Filter can be added if additional requirements are available.\n* implementation of data source selector\n\t* currently provides single data source selector.\n\t* If the service has multiple data sources, it needs to implement a business-related data source selector and select the data source according to the request\n* implementation of transaction execution logs\n\t* the implementation of relational database and REDIS is currently available.\n\t* To improve efficiency, you can implement transaction logs based on other forms, such as file systems, HBASE, etc. Welcome PR\n* master slave selector\n\t* implementation of master-slave selection based on ZK.\n\t* if you don't want to use ZK, you can replace ZK yourself.\n\n## best practices\n\ntransaction logging based on Database\n\n*  use different server for the transaction log database and the business database.\n\n\nThe parameters and return values\n\n* because of the persistence cost, ensure that the parameters and return values of the calling method as small as possible.\n\n\n\n\n## FAQ\n\n1. how to determine whether a global-transaction is commited after CRASH?\n\n* when invoking the startEasyTrans () method, the framework inserts a record into executed_trans.\n* the remote transaction method can only be executed after the startEasyTrans () method is called.\n* The business initiator (master transaction) holds the lock of the executed_trans record until the master transaction rolls back or commits\n* So when the CRASH recovery process uses select for update to query the executed_trans record, it is bound to get an accurate result of whether or not it has been submitted (if the master transaction is still in progress, select for update will wait)\n* Use select for update to avoid misquerying the global-transaction status result in MVCC\n\n## Others\nwechat public account of author\n\n![wechat public account](https://raw.githubusercontent.com/QNJR-GROUP/ImageHub/master/easytrans/wechat_public_account.jpg)\n\nif you like this framework，please STAR it,THX\n\nemail: skyes.xu@qq.com\n\n\n\n\n"
        },
        {
          "name": "readme.md",
          "type": "blob",
          "size": 21.2880859375,
          "content": "[English Readme](readme-en.md)\n\n# 中文\n## 零、SEO\n柔性事务，分布式事务，TCC，SAGA，可靠消息，最大努力交付消息，事务消息，补偿，全局事务，soft transaction, distribute transaction, compensation,自动补偿\n\n本框架可一站式解决分布式SOA（包括微服务等）的事务问题。\n\n## 一、由来 及 特性\n这个框架是结合公司之前遇到的分布式事务场景以及 支付宝程立分享的一个PPT<大规模SOA系统的分布式事务处理>而设计实现。\n\n本框架意在解决之前公司对于每个分布式事务场景中都自行重复设计 中间状态、幂等实现及重试逻辑 的状况。\n\n采纳本框架后能解决现有已发现的所有分布式事务场景，减少设计开发设计工作量，提高开发效率，并统一保证事务实现的可靠性。\n\n特性：\n\n* 引入JAR包即用，无需独立部署协调者，无需独立部署ZooKeeper(使用extensionsuite-database-starter时)\n* 一个框架包含多种事务形态，一个框架搞定所有类型的事务\n* 多种事务形态可混合使用\n* 高性能,大多数业务系统瓶颈在业务数据库，若不启用框架的幂等功能，对业务数据库的额外消耗仅为写入25字节的一行\n* 可选的框架自带幂等实现及调用错乱次序处理，大幅减轻业务开发工作量,但启用的同时会在业务数据库增加一条幂等控制行\n* 业务代码可实现完全无入侵\n* 支持嵌套事务\n* 分布式事务ID可关联业务ID，业务类型，APPID，便于监控各个业务的分布式事务执行情况\n* 整合Seata的AT模式，改造行锁使其存储到本地，改造集中式TC为ET的分布式协调\n\n\n## 二、分布式事务场景及框架对应实现\n\n### 分布式事务场景\n* 无需分布式事务\n    * 最常用\n    * 最优先使用\n* 使用消息队列完成的最终一致性事务\n    * 适用于服务可以自行决定全局事务状态（rollback/commit）的场景\n    * 常见\n    * 若一定要与其他服务写接口发生交互，则优先使用\n    * 依据是否保证投递到订阅者，分为可靠消息及最大努力交付消息\n    * 有时业务要求一些本质是异步的操作同步返回结果，若同步返回失败则后台异步补单。这种业务本质也归属于无需外部数据变更以协助完成的最终一致性，但介于其同步时要返回结果，其有区别于可靠消息。\n* 使用传统补偿完成的最终一致性事务\n    * 适用于需要获取远程执行结果来决定逻辑事务走向 且 可以进行补偿的业务\n    * 若使用消息队列不能解决的事务问题优先考虑使用基于补偿的最终一致性事务（若需要嵌套事务，则使用TCC）\n    * 本框架中传统补偿不支持嵌套，若有需要，可改用TCC\n* 使用自动补偿完成的最终一致性事务（整合改造阿里的Seata/Fescar的AT模式完成）\n    * 适用于需要获取远程执行结果来决定逻辑事务走向 且 不介意偶尔读取并展示脏数据的场景\n    * 该模式下，普通select时数据整体处于脏读状态，进行本地更新事务时，若进行逻辑判断所需的字段会参与到全局事务时，需要用AutoCpsLocalTransactionExecutor.executeWithGlobalLockCheck方法加上Select for update获取准确值后再判断\n    * 因上述全局事务及本地事务的协作是一个隐式、易错点，甚至于写每一个涉及更新的SQL都需要考虑上面这个因素，因此希望引入并使用自动补偿时，需建立好相关使用规范，以避免后续项目失控\n    * 同时由于最终一致到达的时间相对单机事务来说长很多，因此若有某些记录为热记录，并且其用了自动补偿，则性能会下降很多\n* 使用TCC完成最终一致性事务\n    * 适用于需要获取远程执行结果来决定逻辑事务走向 且 不可以进行补偿的业务\n    * 最终解决办法，囊括所有必须使用2PC实现的场景。编码量最大，性能消耗最大\n* SAGA\n\t* 其与传统补偿相似（在某些框架里定义的Saga即为本框架定义的传统补偿）\n\t* 本框架定义的SAGA为正向操作和反向操作都不在主控事务执行过程中执行，通过队列异步执行，因此可以减少事务记录加锁时间\n\t* 若同步操作较多（TCC、补偿）的情况下，可以用SAGA替代同步操作，这样会有性能上的提升\n\t* 但使用SAGA其主控方代码形态会有稍有变化，因为其主控方的事务要拆成两个(具体请查看DEMO),有额外编码负担\n\t* 本框架实现的SAGA并非传统的SAGA,可以将其类比为异步TCC，与传统SAGA的区别可以类比 传统补偿及TCC的关系\n\t* 还有就是本框架使用RPC而非队列实现SAGA，具体原因可以在SAGA-TCC这个DEMO里查看\n\n关于如何选择分布式事务形态，更详细的可参考，请点赞以帮助SEO：https://www.cnblogs.com/skyesx/p/9697817.html \n\n### 框架对应实现及基本原理\n框架实现了上述所有事务场景的解决方案，并提供了统一易用的接口。以下介绍基本实现原理\n\n\n#### 无需分布式事务\n对于此类事务，框架完全不介入，不执行一行额外代码\n\n#### 其他事务场景\n框架的核心依赖是Spring的TransactionSynchronization，只要使用的事务管理器继承自AbstractPlatformTransactionManager都能使用本框架（基本上事务管理器都继承自本实现）,在此之外，1.0.0版本之后，框架使用了SPRING BOOT的配置功能及JDK8的特性，因此SPRING BOOT及JDK8也是必选项\n\n对于分布式事务，框架会在调用远程事务方法前，将对应的框架操作挂载到TransactionSynchronization中，如：\n* 使用消息队列完成的最终一致性事务，框架将会在全局事务状态确认为提交后发发送消息，保证只有全局事务确认后才能被外部看见，这里也省去业务开发者对于 发送-确认-检测 类型 队列实现的代码量\n* 使用TCC完成最终一致性事务,框架将会根据事务的实际完成情况调用Confirm或者Cancel,用传统补偿完成的最终一致性事务也类似\n\n框架有后台线程负责CRASH恢复，其根据“在执行分布式服务调用前写入的WriteAheadLog获得可能已经调用的业务”以及“跟随业务一起提交的一条框架记录以确认的业务最终提交状态”来进行最终的CRASH具体操作（如TCC的Confirm或者Rollback）\n\n框架对于幂等也有完整的实现（可选），框架能保证业务方法逻辑上只执行一遍（有可能执行多遍，但多次执行的方法会被回滚掉，因此，涉及不可回滚的外部资源时，业务程序需自行把控其幂等性）\n\n框架对于方法间有调用关系依赖的也进行妥善的处理，例如基于传统补偿完成的最终一致性事务中\n* 业务方法没有被调用(或者由于延时晚于补偿方法执行)，那么补偿方法对应的业务实现也不会被调用（但框架仍会记录下补偿方法已经被调用过）\n* 补偿方法已经被掉用过了，那么业务方法无论曾经有没有被执行过，都不会被调用\n\n所有远程调用的结果都是以Future形式返回，这给框架的性能优化提供了空间，在第一次获取结果前，所有的日志都不会被写入所有远程方法都不会被调用。一旦业务程序尝试获取执行结果时，才会批量写入日志及后续并发调用远程方法。\n\n如果业务程序没有尝试获取执行结果，框架COMMIT前会统一尝试GET一遍，对于所有远程方法一旦抛出了Exception,框架都会在最后commit前将业务回滚，而无论之前是否catch住了，这样能保证编程模型的简洁，方便写出正确易理解的代码。\n\n## 三、使用简介\n\n### 业务代码\n\n组件已上传到中央仓库，对于业务代码可以直接加入以下内容到pom中\n\n\t  <dependency>\n        <groupId>com.yiqiniu.easytrans</groupId>\n        <artifactId>easytrans-starter</artifactId>\n        <version>1.4.3</version>\n      </dependency>\n\nStarter里包含了若干默认的组件实现:基于mysql的分布式事务日志存储，基于ribbon-rest的RPC实现，基于KAFKA的消息队列，若不需要或者要替换，可以EXCLUDE掉\n\n\n#### 业务发起者\n对于业务发起者，框架只暴露一个接口\n\n    public interface EasyTransFacade {\n\t/**\n\t * start easy Transaction\n\t * @param busCode appId+busCode+trxId is a global unique id,no matter this transaction commit or roll back\n\t * @param trxId see busCode\n\t */\n\tvoid startEasyTrans(String busCode, String trxId);\n\n\t/**\n\t * execute remote transaction\n\t * @param params\n\t * @return\n\t */\n\t<P extends EasyTransRequest<R, E>, E extends EasyTransExecutor, R extends Serializable> Future<R> execute(P params);\n    }\n\n使用方法如下，使用方直接调用远程方法即可，无需考虑具体的分布式事务类型及后续处理：\n\n    @Transactional\n    public void buySomething(int userId,long money){\n    /**\n\t\t* 本地业务方法，下订单，并获得订单号\n\t\t*/\n\t\tJdbcTemplate jdbcTemplate = util.getJdbcTemplate();\n\t\tInteger id = saveOrderRecord(jdbcTemplate,userId,money);\n\t\t\n\t\t/**\n\t\t * 声明全局事务ID，其由appId,业务代码，业务代码内ID构成\n\t\t * 这个方法也可以不调用，框架用默认的业务代码及自动生成的ID号，但这样做的缺点是全局事务ID无法直接关联到具体业务\n\t\t * 不过这个可以通过自定义BusinessCodeGenerator及TrxIdGenerator来产生关联\n\t\t */\n\t\ttransaction.startEasyTrans(BUSINESS_CODE, id);\n\t\t\n\t\t/**\n\t\t * 调用远程服务扣除所需的钱,这个远程服务实现了TCC接口,\n\t\t * 框架会根据buySomething方法的事务结果来维护远程服务的最终一致性\n\t\t */\n\t\tWalletPayTccMethodRequest deductRequest = new WalletPayTccMethodRequest();\n\t\tdeductRequest.setUserId(userId);\n\t\tdeductRequest.setPayAmount(money/2);\n\t\t// 业务上可多次调用同一方法，最后生效的也是实际调用的次数\n\t\tFuture<WalletPayTccMethodResult> deductFuture = transaction.execute(deductRequest);\n\t\tFuture<WalletPayTccMethodResult> deductFuture = transaction.execute(deductRequest);\n\n\t\t/**\n\t\t * 调用远程服务进行账务登记，账务服务是一个可补偿服务\n\t\t * 当buySomething方法对应的事务回滚了，框架将会自动调用补偿对应的业务方法\n\t\t * \n\t\t */\n\t\tAccountingRequest accountingRequest = new AccountingRequest();\n\t\taccountingRequest.setAmount(money);\n\t\taccountingRequest.setUserId(userId);\n\t\tFuture<AccountingResponse> accountingFuture = transaction.execute(accountingRequest);\n\t\t\n\t     /**\n\t\t * \n\t\t * 发布消息以触发相关的业务处理，例如增加积分。这是一个可靠的消息。\n\t\t * 这个消息会在buySomething()的事务提交后，保证成功发布出去\n\t\t * 但至于消息是否成功消费，这取决于Queue接口的具体实现\n\t\t */\n\t\tOrderMessage orderMessage = new OrderMessage();\n\t\torderMessage.setUserId(userId);\n\t\torderMessage.setAmount(money);\n\t\tFuture<PublishResult> reliableMessage = transaction.execute(orderMessage);\n    }\n\n\n\n#### 服务提供者\n对于服务提供者，则实现对应的接口，并将其注册到Spring的Bean容器即可\n\n如提供TCC服务的业务，需实现TccMethod接口：\n\n     public interface TccMethod<P extends TccTransRequest<R>, R  extends Serializable> extends RpcBusinessProvider<P> {\n    \tR doTry(P param);\n    \tvoid doConfirm(P param);\n    \tvoid doCancel(P param);\n    }\n\n具体实现：\n   \n    @Component\n    public class WalletPayTccMethod implements TccMethod<WalletPayTccMethodRequest, WalletPayTccMethodResult>{\n\n\t@Resource\n\tprivate WalletService wlletService;\n\n\t@Override\n\tpublic WalletPayTccMethodResult doTry(WalletPayTccMethodRequest param) {\n\t\treturn wlletService.doTryPay(param);\n\t}\n\n\t@Override\n\tpublic void doConfirm(WalletPayTccMethodRequest param) {\n\t\twlletService.doConfirmPay(param);\n\t}\n\n\t@Override\n\tpublic void doCancel(WalletPayTccMethodRequest param) {\n\t\twlletService.doCancelPay(param);\n\t}\n    }\n\n其中WalletPayTccMethodRequest是请求参数，其为继承自EasyTransRequest类的POJO,且其需要添加BusinessIdentifer注解，以便于框架确认本请求对应的业务ID\n\n\t@BusinessIdentifer(appId=Constant.APPID,busCode=METHOD_NAME)\n\tpublic class WalletPayTccMethodRequest implements TccTransRequest<WalletPayTccMethodResult>{\n\t\tprivate static final long serialVersionUID = 1L;\n\t\t\n\t\tprivate Integer userId;\n\t\t\n\t\tprivate Long payAmount;\n\n\t\tpublic Long getPayAmount() {\n\t\t\treturn payAmount;\n\t\t}\n\n\t\tpublic void setPayAmount(Long payAmount) {\n\t\t\tthis.payAmount = payAmount;\n\t\t}\n\n\t\tpublic Integer getUserId() {\n\t\t\treturn userId;\n\t\t}\n\n\t\tpublic void setUserId(Integer userId) {\n\t\t\tthis.userId = userId;\n\t\t}\n\t}\n\n以上的示例是传统的调用形式，无业务代码入侵的使用形式如下,更具体的使用请参考demo(interfacecall)：\n\n\n\t@Transactional\n\tpublic String buySomething(int userId,long money){\n\t\t\n\t\tint id = saveOrderRecord(jdbcTemplate,userId,money);\n\t\t\n\t\t//WalletPayRequestVO 是一个VO，无任何继承及注解，只有相关的属性及GETTER,SETTER\n\t\tWalletPayRequestVO request = new WalletPayRequestVO();\n\t\trequest.setUserId(userId);\n\t\trequest.setPayAmount(money);\n\t\t\n\t\t//payService是通过框架生成的一个PayService接口实例，调用该实例的方法即完成了分布式事务调用\n\t\tWalletPayResponseVO pay = payService.pay(request);\n\t\t\n\n\t\treturn \"id:\" + id + \" freeze:\" + pay.getFreezeAmount();\n\t\t}\n\n#### 更多例子\n请参考easytrans-demos里面的代码，这里提供了一个简明的代码。\n更完整的配置及相关用例请参考easytrans-starter里的UT案例，UT中有一个MockSerivice,使用了各种场景的事务。并对事务的各种异常场景做了测试。\n\n### 运行配置\n\n每个运行业务的库都需要新增两张表,表的字段类型经过了修改，若之前建了表，需要重建\n\n    -- 用于记录业务发起方的最终业务有没有执行\n    -- p_开头的，代表本事务对应的父事务id\n    -- select for update查询时，若事务ID对应的记录不存在则事务一定失败了\n    -- 记录存在，但status为0表示事务成功,为1表示事务失败（包含父事务和本事务）\n    -- 记录存在，但status为2表示事务最终状态未知\n\tCREATE TABLE `executed_trans` (\n\t  `app_id` smallint(5) unsigned NOT NULL,\n\t  `bus_code` smallint(5) unsigned NOT NULL,\n\t  `trx_id` bigint(20) unsigned NOT NULL,\n\t  `p_app_id` smallint(5) unsigned DEFAULT NULL,\n\t  `p_bus_code` smallint(5) unsigned DEFAULT NULL,\n\t  `p_trx_id` bigint(20) unsigned DEFAULT NULL,\n\t  `status` tinyint(1) NOT NULL,\n\t  PRIMARY KEY (`app_id`,`bus_code`,`trx_id`),\n\t  KEY `parent` (`p_app_id`,`p_bus_code`,`p_trx_id`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;\n\t\n\tCREATE TABLE `idempotent` (\n\t  `src_app_id` smallint(5) unsigned NOT NULL COMMENT '来源AppID',\n\t  `src_bus_code` smallint(5) unsigned NOT NULL COMMENT '来源业务类型',\n\t  `src_trx_id` bigint(20) unsigned NOT NULL COMMENT '来源交易ID',\n\t  `app_id` smallint(5) NOT NULL COMMENT '调用APPID',\n\t  `bus_code` smallint(5) NOT NULL COMMENT '调用的业务代码',\n\t  `call_seq` smallint(5) NOT NULL COMMENT '同一事务同一方法内调用的次数',\n\t  `handler` smallint(5) NOT NULL COMMENT '处理者appid',\n\t  `called_methods` varchar(64) NOT NULL COMMENT '被调用过的方法名',\n\t  `md5` binary(16) NOT NULL COMMENT '参数摘要',\n\t  `sync_method_result` blob COMMENT '同步方法的返回结果',\n\t  `create_time` datetime NOT NULL COMMENT '执行时间',\n\t  `update_time` datetime NOT NULL,\n\t  `lock_version` smallint(32) NOT NULL COMMENT '乐观锁版本号',\n\t  PRIMARY KEY (`src_app_id`,`src_bus_code`,`src_trx_id`,`app_id`,`bus_code`,`call_seq`,`handler`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\n\n（基于数据库实现的事物日志，若使用REDIS记录事务日志则无需以下表）需要有一个记录事务日志的数据库，并为其创建两张表。每个业务服务都必须有对应的事务日志数据库。可多个服务共用一个，也可以一个服务单独一个事务日志。\n\n\tCREATE TABLE `trans_log_detail` (\n\t  `log_detail_id` int(11) NOT NULL AUTO_INCREMENT,\n\t  `trans_log_id` binary(12) NOT NULL,\n\t  `log_detail` blob,\n\t  `create_time` datetime NOT NULL,\n\t  PRIMARY KEY (`log_detail_id`),\n\t  KEY `app_id` (`trans_log_id`)\n\t) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;\n\t\n\tCREATE TABLE `trans_log_unfinished` (\n\t  `trans_log_id` binary(12) NOT NULL,\n\t  `create_time` datetime NOT NULL,\n\t  PRIMARY KEY (`trans_log_id`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\tSELECT * FROM translog.trans_log_detail;\n\n\n若需要使用自动补偿功能，则需要在业务库额外增加以下两个表\n\n    CREATE TABLE `undo_log` (\n      `id` bigint(20) NOT NULL AUTO_INCREMENT,\n      `branch_id` bigint(20) NOT NULL,\n      `xid` varchar(100) NOT NULL,\n      `context` varchar(128) NOT NULL,\n      `rollback_info` longblob NOT NULL,\n      `log_status` int(11) NOT NULL,\n      `log_created` datetime NOT NULL,\n      `log_modified` datetime NOT NULL,\n      `ext` varchar(100) DEFAULT NULL,\n      PRIMARY KEY (`id`),\n      UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)\n    ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;\n\n\n    CREATE TABLE `fescar_lock` (\n      `t_name` varchar(64) NOT NULL,\n      `t_pk` varchar(128) NOT NULL,\n      `xid` varchar(256) NOT NULL,\n      `create_time` datetime NOT NULL,\n      PRIMARY KEY (`t_name`,`t_pk`)\n    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\n\n详细的配置会后续作出手册，但在此之前各位可以参考easytrans-starter里的UT案例 或者 参考demo进行\n\n\n## 四、扩展性\n框架采用接口粘合各个模块，具有较强的扩展性，推荐 扩展、替换 的模块：\n* RPC实现\n    * 目前支持DUBBO，SPRING CLOUD RIBBON/EUREKA的支持\n    * 欢迎增加额外实现\n* 消息队列实现\n    * 目前支持阿里ONS(创建时请使用无序消息)及KAFKA\n    * 欢迎增加额外实现，需实现两个核心方法\n* 序列化实现\n    * 目前使用Spring-core提供的序列化，效率较低，但目前性能不是瓶颈，没做优化\n    * 欢迎增加额外实现以提高效率\n* 增删改Filter具体实现类\n    * 目前有幂等Filter、元数据设置FILTER、级联事务协助处理Filter\n    * 若有额外需求可新增Filter\n* 数据源选择器的实现\n    * 目前提供单数据源选择器\n    * 若服务有多个数据源，需自行实现业务相关的数据源选择器，根据请求选择数据源\n* 事务执行日志的实现\n    * 目前提供基于关系数据库及REDIS的实现\n    * 为提高效率，可自行实现基于其他形式的事务日志，如文件系统，HBASE等，欢迎PR\n* 主从选择器\n    * 基于ZK的主从选择\n    * 基于MySQL的主从选择\n* 字符串编码器\n    * 基于ZK的字符串编码\n    * 基于MYSQL的字符串编码\n* id生成器\n    * 基于ZK的雪花ID生成\n    * 基于MYSQL的雪花ID生成\n\n## 五、最佳实践\n\n### 基于数据库的事务日志\n* 将事务日志数据库与业务数据库分开存放\n\n### 参数及返回值\n* 因有持久化成本，请保证调用方法的参数及返回值尽量小\n\n\n## 六、FAQ\n1. 如何在CRASH后判断一个柔性事务是否提交？\n\t* 在调用startEasyTrans()方法时，框架将插入一条记录到executed_trans中\n\t* 在调用startEasyTrans()方法后，才可以执行远程事务方法\n\t* 业务发起者（主控事务）将持有executed_trans记录的锁直到主控事务回滚或者提交\n\t* 因此CRASH恢复进程使用select for update 查询executed_trans记录时，必然能得到准确的是否已经提交的结果（若主控事务仍在进行中，select for update将会等待）\n\t* 使用select for update是为了避免在MVCC情况下错误查询出最终事务提交结果的情况\n\n## 七、外部组件版本兼容性\n* 若未使用 extensionsuite-database-starter需要使用ZK时，ZK请使用3.4及以上版本\n* SpringBoot 2.0.x 以及 SpringCloud F版本的整合请参考Demo里的tccandfescar\n    * 需要注意的是写文档时最新版的spring boot（2.0.8）引入的最新版mysql-connector-java （5.1.47）存在bug,要降级为5.1.46\n    * 另因SpringCloud大版本变更时导致某些包名变动，在F版本时使用ET的Ribbon时，需要在项目单独引入spring-cloud-starter-netflix-ribbon\n* 如果遇到ZK库相关的包匹配问题，需要检查当前项目的相关包版本\n    * 在1.2.0版本后，curator-recipes及curator-framework需为4.x.x,zookeeper客户端版本需为3.4.x或者3.5.x（视ZK服务器版本而定）\n    * 1.2.0版本前，curator-recipes及curator-framework需为2..x.x,zookeeper客户端版本同上\n\n\n## 八、其他\n欢迎加作者个人微信及公众号\n\n公众号\n\n![wechat public account](https://raw.githubusercontent.com/QNJR-GROUP/ImageHub/master/easytrans/wechat_public_account.jpg)\n\n微信（加微信请注明来源 ET）\n\n![wechat](https://github.com/QNJR-GROUP/ImageHub/blob/master/easytrans/wechat.png?raw=true)\n\n若觉得框架不错，希望能STAR,THX\n\nemail: skyes.xu@qq.com\n\n我写的关于ET的一些额外文章，请点赞以帮助SEO：\n* 如何选择分布式事务形态 https://www.cnblogs.com/skyesx/p/9697817.html\n* “若干分布式事务框架”与“我的偏见” https://www.cnblogs.com/skyesx/p/10041923.html\n* Seata及EasyTransaction架构的比对思考 https://www.cnblogs.com/skyesx/p/10674700.html\n* EasyTransaction主要源码分析（请先阅读  Seata架构的比对思考，再结合 代码以及demo调试过程看这篇，直接看的话这里的点太零碎了） https://www.cnblogs.com/skyesx/p/11111726.html\n\n\n\n\n"
        }
      ]
    }
  ]
}