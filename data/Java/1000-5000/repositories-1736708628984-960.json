{
  "metadata": {
    "timestamp": 1736708628984,
    "page": 960,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjk4MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "jenkinsci/kubernetes-plugin",
      "stars": 2274,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".dockerignore",
          "type": "blob",
          "size": 0.0390625,
          "content": ".git\nwork\ntarget\n!target/kubernetes.hpi\n"
        },
        {
          "name": ".git-blame-ignore-revs",
          "type": "blob",
          "size": 0.09765625,
          "content": "# https://github.com/jenkinsci/kubernetes-plugin/pull/1478\n9c1d58d9badd988622b4772632037126176e1ef0\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.138671875,
          "content": "/target/\n/.classpath\n/.project\n/.factorypath\n/.settings/\n/work/\n/.idea/\n*.iml\nnbactions.xml\nnb-configuration.xml\n*.bak\n/.vscode/\n**/.DS_Store\n"
        },
        {
          "name": ".mvn",
          "type": "tree",
          "content": null
        },
        {
          "name": "CHANGELOG-archive.md",
          "type": "blob",
          "size": 38.46875,
          "content": "CHANGELOG\n=========\n\nKnown issues\n------------\n* Nested pod templates and inheritance issues [JENKINS-49700](https://issues.jenkins-ci.org/browse/JENKINS-49700)\n\nSee the full list of issues at [JIRA](https://issues.jenkins-ci.org/issues/?filter=15575)\n\n1.16.5 and newer\n------\n\nNo longer tracked in this file. See [GitHub releases](https://github.com/jenkinsci/kubernetes-plugin/releases) instead.\n\n1.16.4\n------\n* Add http connections count [#528](https://github.com/jenkinsci/kubernetes-plugin/pull/528)\n* Hide deprecated credential type [#529](https://github.com/jenkinsci/kubernetes-plugin/pull/529) [JENKINS-49717](https://issues.jenkins-ci.org/browse/JENKINS-49717)\n* Allow option `showRawYaml` in Jenkinsfiles [#519](https://github.com/jenkinsci/kubernetes-plugin/pull/519)\n\n1.16.3\n------\n* **testing** Fixed test flakes [#496](https://github.com/jenkinsci/kubernetes-plugin/pull/496) [JENKINS-46076](https://issues.jenkins-ci.org/browse/JENKINS-46076)\n* **testing** Add a test for the `showRawYaml` option [#525](https://github.com/jenkinsci/kubernetes-plugin/pull/525)\n* Simplify logic to return pod status [#526](https://github.com/jenkinsci/kubernetes-plugin/pull/526)\n* **testing** Simplify testing logic by providing a generic method to load and schedule a pipeline definition [#527](https://github.com/jenkinsci/kubernetes-plugin/pull/527)\n* Prevent save of Kubernetes agent through UI [#514](https://github.com/jenkinsci/kubernetes-plugin/pull/514) [JENKINS-57965](https://issues.jenkins-ci.org/browse/JENKINS-57965)\n* Support \"Docker Host Certificates\" credentials to authenticate against Kubernetes [#520](https://github.com/jenkinsci/kubernetes-plugin/pull/520)\n\n1.16.2\n------\n* Fixed an issue where only the last PodTemplateFilter would be applied [#521](https://github.com/jenkinsci/kubernetes-plugin/pull/521)\n\n1.16.1\n------\n* Update parent POM to 3.44 [#505](https://github.com/jenkinsci/kubernetes-plugin/pull/505)\n* Update plugin dependencies\n  * structs 1.19 [#494](https://github.com/jenkinsci/kubernetes-plugin/pull/494)\n  * variant 1.2 [#464](https://github.com/jenkinsci/kubernetes-plugin/pull/464)\n  * cloudbees-folder 6.8 [#471](https://github.com/jenkinsci/kubernetes-plugin/pull/471)\n  * credentials 2.2.0 / ssh-credentials 1.17 [#499](https://github.com/jenkinsci/kubernetes-plugin/pull/499)\n* Making ContainerExecProc periodically send a newline to keep a socket alive [#513](https://github.com/jenkinsci/kubernetes-plugin/pull/513)[JENKINS-58065](https://issues.jenkins-ci.org/browse/JENKINS-58065)\n\n1.16.0\n----------\n* Update kubernetes-client to 4.3.0 [#454](https://github.com/jenkinsci/kubernetes-plugin/pull/454)\n* Do not display secrets in build logs [JENKINS-57893](https://issues.jenkins-ci.org/browse/JENKINS-57893)\n\n1.15.7\n------\n* Fix a thread safety issue when handling dynamic podtemplates [#489](https://github.com/jenkinsci/kubernetes-plugin/pull/489)\n* Explicit inheritance should override implicit inheritance. Declarative k8s template do not inherit from parent pod template by default. [#480](https://github.com/jenkinsci/kubernetes-plugin/pull/480) [JENKINS-57548](https://issues.jenkins-ci.org/browse/JENKINS-57548)\n\n1.15.6\n------\n* Fix databinding of ContainerTemplate DescribableModel.uninstantiate2 works. [#486](https://github.com/jenkinsci/kubernetes-plugin/pull/486) [JENKINS-57116](https://issues.jenkins-ci.org/browse/JENKINS-57827)\n* Update jackson dependency to 2.9.9 to address CVE-2019-12086 [#483](https://github.com/jenkinsci/kubernetes-plugin/pull/483)\n\n1.15.5\n------\n* Fix empty yamls introduced on upgrade to 1.15.1 [#462](https://github.com/jenkinsci/kubernetes-plugin/pull/462) [JENKINS-57116](https://issues.jenkins-ci.org/browse/JENKINS-57116)\n\n1.15.4\n------\n* Wait for some time before closing the Kubernetes expired clients [#418](https://github.com/jenkinsci/kubernetes-plugin/pull/418) [JENKINS-55392](https://issues.jenkins-ci.org/browse/JENKINS-55392)\n* Add `showRawYaml` option to (not) show raw yaml in console [#459](https://github.com/jenkinsci/kubernetes-plugin/pull/459) [JENKINS-56121](https://issues.jenkins-ci.org/browse/JENKINS-56121)\n\n1.15.3\n------\n* Wait for agent to connect on provisioning to avoid multiple Pod launches [#455](https://github.com/jenkinsci/kubernetes-plugin/pull/455) [JENKINS-56347](https://issues.jenkins-ci.org/browse/JENKINS-56347)\n* Always initialize `yamls` field [#460](https://github.com/jenkinsci/kubernetes-plugin/pull/460) [JENKINS-57214](https://issues.jenkins-ci.org/browse/JENKINS-57214)\n\n1.15.2\n------\n* Merge pod templates definitions from yaml, fix issue with missing yaml in UI [#456](https://github.com/jenkinsci/kubernetes-plugin/pull/456) [JENKINS-57112](https://issues.jenkins-ci.org/browse/JENKINS-57112)\n\n1.15.1\n------\n* Merge pod templates definitions from yaml [#449](https://github.com/jenkinsci/kubernetes-plugin/pull/449) [JENKINS-56082](https://issues.jenkins-ci.org/browse/JENKINS-56082)\n\n1.15.0\n------\n* Allow Setting Default Mode In Secret Volumes [#452](https://github.com/jenkinsci/kubernetes-plugin/pull/452)\n* Prevent a wait forever if websocket is not connected [#436](https://github.com/jenkinsci/kubernetes-plugin/pull/436)\n* Don't set build result in Declarative agent blocks [#445](https://github.com/jenkinsci/kubernetes-plugin/pull/445) [JENKINS-56544](https://issues.jenkins-ci.org/browse/JENKINS-56544)\n\n1.14.9\n------\n* Fix `connectTimeout` and `readTimeout` not being persisted [#439](https://github.com/jenkinsci/kubernetes-plugin/pull/439) [#442](https://github.com/jenkinsci/kubernetes-plugin/pull/442) [JENKINS-53532](https://issues.jenkins-ci.org/browse/JENKINS-53532)\n\n1.14.8\n------\n* Do not close Kubernetes client after `containerLog` step [#435](https://github.com/jenkinsci/kubernetes-plugin/pull/435) [JENKINS-55392](https://issues.jenkins-ci.org/browse/JENKINS-55392)\n* Upgrade kubernetes-client to 4.1.3. Pass `exec` buffer size using new method [#431](https://github.com/jenkinsci/kubernetes-plugin/pull/431) [JENKINS-50429](https://issues.jenkins-ci.org/browse/JENKINS-50429)\n\n1.14.7\n------\n* Use a bigger buffer for stdin on kubernetes exec [#427](https://github.com/jenkinsci/kubernetes-plugin/pull/427) [JENKINS-50429](https://issues.jenkins-ci.org/browse/JENKINS-50429)\n* Improve labels and help text for cloud and pod templates cap [#422](https://github.com/jenkinsci/kubernetes-plugin/pull/422)\n\n1.14.6\n------\n* Add a system property to override default Slave Connect Timeout in seconds [#432](https://github.com/jenkinsci/kubernetes-plugin/pull/432)\n* Add build url as default annotation [#433](https://github.com/jenkinsci/kubernetes-plugin/pull/433) [JENKINS-56133](https://issues.jenkins-ci.org/browse/JENKINS-56133)\n* Update kubernetes client to 4.1.2 [#434](https://github.com/jenkinsci/kubernetes-plugin/pull/434) [JENKINS-52593](https://issues.jenkins-ci.org/browse/JENKINS-52593)\n* Use a watcher to monitor pod status while launching the agent [#423](https://github.com/jenkinsci/kubernetes-plugin/pull/423)\n\n1.14.5\n------\n* Expire Kubernetes clients after one day and make it configurable [#429](https://github.com/jenkinsci/kubernetes-plugin/pull/429) [JENKINS-56140](https://issues.jenkins-ci.org/browse/JENKINS-56140)\n* Allow non admin to call `getContainers` and `getPodEvents` returning an empty list [#430](https://github.com/jenkinsci/kubernetes-plugin/pull/430) [JENKINS-56155](https://issues.jenkins-ci.org/browse/JENKINS-56155)\n\n1.14.4\n------\n* Set `nodeUsageMode` to `EXCLUSIVE` as default [#386](https://github.com/jenkinsci/kubernetes-plugin/pull/386)\n* Add `slaveConnectTimeout` and `namespace` to declarative pipeline [#421](https://github.com/jenkinsci/kubernetes-plugin/pull/421) [JENKINS-55960](https://issues.jenkins-ci.org/browse/JENKINS-55960)\n\n1.14.3\n------\n* Use label as pod name when not set [#375](https://github.com/jenkinsci/kubernetes-plugin/pull/375)\n* Upgrade dependencies to latest versions [#417](https://github.com/jenkinsci/kubernetes-plugin/pull/417) [#307](https://github.com/jenkinsci/kubernetes-plugin/pull/307)\n\n1.14.2\n------\n* Require Jenkins 2.138.4 instead of 2.150.1 [#413](https://github.com/jenkinsci/kubernetes-plugin/pull/413)\n* Combine env vars into a single set before writing once in container shell execution [#393](https://github.com/jenkinsci/kubernetes-plugin/pull/393) [JENKINS-50429](https://issues.jenkins-ci.org/browse/JENKINS-50429)\n* Fail faster if a pod enters in error state during provisioning [#414](https://github.com/jenkinsci/kubernetes-plugin/pull/414) \n\n1.14.1\n------\n* Allow setting namespace from Pod yaml [#405](https://github.com/jenkinsci/kubernetes-plugin/pull/405) [JENKINS-51610](https://issues.jenkins-ci.org/browse/JENKINS-51610)\n\n1.14.0\n------\n* Add page to Kubernetes nodes to show pod events [#408](https://github.com/jenkinsci/kubernetes-plugin/pull/408)\n\n1.13.9\n------\n* Require Jenkins 2.150.1 [#411](https://github.com/jenkinsci/kubernetes-plugin/pull/411)\n* Do not wait for pod if it has been deleted or if it has failed [#410](https://github.com/jenkinsci/kubernetes-plugin/pull/410) [#412](https://github.com/jenkinsci/kubernetes-plugin/pull/412)\n\n1.13.8\n------\n* Don't close kubernetes client upon cache removal [#407](https://github.com/jenkinsci/kubernetes-plugin/pull/407) [JENKINS-55138](https://issues.jenkins-ci.org/browse/JENKINS-55138)\n\n1.13.7\n------\n* Add missing field maxRequestsPerHost to copy constructor [#403](https://github.com/jenkinsci/kubernetes-plugin/pull/403)\n* Fix maxRequestsPerHost form validation [#400](https://github.com/jenkinsci/kubernetes-plugin/pull/400)\n\n1.13.6\n------\n* Prevent multiple instances of KubernetesClient that can cause memory leaks with multiple API http connections [#397](https://github.com/jenkinsci/kubernetes-plugin/pull/397) [JENKINS-54770](https://issues.jenkins-ci.org/browse/JENKINS-54770)\n  * Note that this will enforce the limit of connections to the Kubernetes API and you may need to increase the value of *Max connections to Kubernetes API* if you see errors like [`JENKINS-40825`](https://issues.jenkins-ci.org/browse/JENKINS-40825)`: interrupted while waiting for websocket connection`\n\n\n1.13.5\n------\n* Populate jnlp tunnel in the jnlp endpoint to launch agent whether Jenkins is behind load balancer or not [#389](https://github.com/jenkinsci/kubernetes-plugin/pull/389)\n* Combine parent pod template ports with children [#340](https://github.com/jenkinsci/kubernetes-plugin/pull/340) [JENKINS-50932](https://issues.jenkins-ci.org/browse/JENKINS-50932)\n\n1.13.4\n------\n* Allow custom workspace in declarative pipeline [#380](https://github.com/jenkinsci/kubernetes-plugin/pull/380) [JENKINS-53817](https://issues.jenkins-ci.org/browse/JENKINS-53817)\n\n1.13.3\n------\n* Upgrade kubernetes-client to 4.1.0 [#391](https://github.com/jenkinsci/kubernetes-plugin/pull/391) [JENKINS-52593](https://issues.jenkins-ci.org/browse/JENKINS-52593)\n\n1.13.2\n------\n* Pod name is detected as `localhost` in Bluemix IKS [#388](https://github.com/jenkinsci/kubernetes-plugin/pull/388) [JENKINS-53297](https://issues.jenkins-ci.org/browse/JENKINS-53297)\n\n1.13.1\n------\n* Allow adding jenkins job metadata to the pods using the KubernetesComputer extenion point [#383](https://github.com/jenkinsci/kubernetes-plugin/pull/383)\n\n1.13.0\n------\n* Display Pod log for Kubernetes agents in the node view [#367](https://github.com/jenkinsci/kubernetes-plugin/pull/367)\n\n1.12.9\n------\n* Declarative pipeline: stdin/stdout/stderr of a remote process are not redirected. Do not wrap the default `jnlp` container calls in `container` steps [#377](https://github.com/jenkinsci/kubernetes-plugin/pull/377) [JENKINS-53422](https://issues.jenkins-ci.org/browse/JENKINS-53422)\n\n1.12.8\n------\n* Handle null retention policy resulting from direct xml pod template injection (seen during agent termination) [#381](https://github.com/jenkinsci/kubernetes-plugin/pull/381)\n\n1.12.7\n------\n* Fix nested Pod Templates support [#382](https://github.com/jenkinsci/kubernetes-plugin/pull/382) [JENKINS-50196](https://issues.jenkins-ci.org/browse/JENKINS-50196)\n* Fix pod spec display in build logs [#384](https://github.com/jenkinsci/kubernetes-plugin/pull/384)\n\n1.12.6\n------\n\n* Container and instance cap are not honored when requesting lots of slaves [#374](https://github.com/jenkinsci/kubernetes-plugin/pull/374) [JENKINS-53313](https://issues.jenkins-ci.org/browse/JENKINS-53313)\n\n1.12.5\n------\n\n* Check for nulls in older kubernetes versions, fixes some NPEs in Kubernetes 1.5 [#378](https://github.com/jenkinsci/kubernetes-plugin/pull/378) [JENKINS-53370](https://issues.jenkins-ci.org/browse/JENKINS-53370)\n\n1.12.4\n------\n\n* Add volumes from pod template to JNLP container [#371](https://github.com/jenkinsci/kubernetes-plugin/pull/371) [JENKINS-50879](https://issues.jenkins-ci.org/browse/JENKINS-50879)\n* Chinese localization [#368](https://github.com/jenkinsci/kubernetes-plugin/pull/368)[#370](https://github.com/jenkinsci/kubernetes-plugin/pull/370)\n\n1.12.3\n------\n\n* Upgrade Jenkins to 2.121.2 [#365](https://github.com/jenkinsci/kubernetes-plugin/pull/365)\n\n1.12.2\n------\n\n* Using declarative, environment variables like COMMIT_ID, GIT_BRANCH are not populated. Use CheckoutScript to populate environment [#364](https://github.com/jenkinsci/kubernetes-plugin/pull/364) [JENKINS-52623](https://issues.jenkins-ci.org/browse/JENKINS-52623)\n\n1.12.1\n------\n\n* Upgrade kubernetes-client to 4.0.0. Drops support for OpenShift <1.6 [#358](https://github.com/jenkinsci/kubernetes-plugin/pull/358) [JENKINS-53363](https://issues.jenkins-ci.org/browse/JENKINS-53363)\n* Fix defaults for Pod Retention on Pod templates [#363](https://github.com/jenkinsci/kubernetes-plugin/pull/363) [JENKINS-48149](https://issues.jenkins-ci.org/browse/JENKINS-48149)\n\n1.12.0\n------\n\n* Add optional usage restriction for a Kubernetes cloud using folder properties [#282](https://github.com/jenkinsci/kubernetes-plugin/pull/282)\n\n1.11.0\n------\n\n* Add Pod Retention policies to keep pods around on failure [#354](https://github.com/jenkinsci/kubernetes-plugin/pull/354) [JENKINS-48149](https://issues.jenkins-ci.org/browse/JENKINS-48149)\n\n1.10.2\n------\n\n* Global configuration `testConnection` using GET allows stealing credentials + CSRF [SECURITY-1016](https://issues.jenkins-ci.org/browse/SECURITY-1016)\n\n1.10.1\n-------\n\n* Tool Location overwrites are not preserved [#318](https://github.com/jenkinsci/kubernetes-plugin/pull/318) [JENKINS-44285](https://issues.jenkins-ci.org/browse/JENKINS-44285)\n\n1.10.0\n-------\n\n* Add `yamlFile` option for Declarative agent to read yaml definition from a different file [#355](https://github.com/jenkinsci/kubernetes-plugin/pull/355) [JENKINS-52259](https://issues.jenkins-ci.org/browse/JENKINS-52259)\n\n1.9.3\n-----\n\n* Avoid streaming to 2 similar OutputStreams [#356](https://github.com/jenkinsci/kubernetes-plugin/pull/356)\n\n1.9.2\n-----\n\n* Combine all resources declared in requests and limits not just CPU and memory [#350](https://github.com/jenkinsci/kubernetes-plugin/pull/350)\n\n1.9.1\n-----\n\n* Jenkins master in windows changes the file separator of `mountPath` incorrectly [#308](https://github.com/jenkinsci/kubernetes-plugin/pull/308) [JENKINS-47178](https://issues.jenkins-ci.org/browse/JENKINS-47178)\n\n1.9.0\n-----\n\n* Update parent and Jenkins versions [#349](https://github.com/jenkinsci/kubernetes-plugin/pull/349)\n\n1.8.4\n-----\n\n* Fix mountPath error provisioning `mountPath: Required value` [#346](https://github.com/jenkinsci/kubernetes-plugin/pull/346) [JENKINS-50525](https://issues.jenkins-ci.org/browse/JENKINS-50525)\n\n1.8.3\n-----\n\n* Preserve unsupported directives in `PodTemplate` yaml, add explicit support for envFrom\n [#348](https://github.com/jenkinsci/kubernetes-plugin/pull/348)\n\n1.8.2\n-----\n\n* Do not emit empty strings for resource requests/limits\n [#342](https://github.com/jenkinsci/kubernetes-plugin/pull/342)\n\n1.8.1\n-----\n* Get the exit code the correct way. Solves problems with many pipeline steps that rely on tool outputs [#300](https://github.com/jenkinsci/kubernetes-plugin/pull/300) [JENKINS-50392](https://issues.jenkins-ci.org/browse/JENKINS-50392)\n\n1.8.0\n-----\n* Validate label and container names with regex [#332](https://github.com/jenkinsci/kubernetes-plugin/pull/332) [#343](https://github.com/jenkinsci/kubernetes-plugin/pull/343) [JENKINS-51248](https://issues.jenkins-ci.org/browse/JENKINS-51248)\n\n1.7.1\n-----\n* Do not print credentials in build output or logs. Only affects certain pipeline steps like `withDockerRegistry`. `sh` step is not affected [SECURITY-883](https://issues.jenkins-ci.org/browse/SECURITY-883)\n\n1.7.0\n-----\n* Add option to apply caps only on alive pods [#252](https://github.com/jenkinsci/kubernetes-plugin/pull/252)\n* Add idleMinutes to pod template in declarative pipeline [#336](https://github.com/jenkinsci/kubernetes-plugin/pull/336) [JENKINS-51569](https://issues.jenkins-ci.org/browse/JENKINS-51569)\n\n1.6.4\n-----\n* Use Jackson and Apache HttpComponents Client libraries from API plugins [#333](https://github.com/jenkinsci/kubernetes-plugin/pull/333) [JENKINS-51582](https://issues.jenkins-ci.org/browse/JENKINS-51582)\n\n1.6.3\n-----\n* Merge labels from yaml [#326](https://github.com/jenkinsci/kubernetes-plugin/pull/326) [JENKINS-51137](https://issues.jenkins-ci.org/browse/JENKINS-51137)\n* Instance cap reached with preexisting pods due to lack of labels [#325](https://github.com/jenkinsci/kubernetes-plugin/pull/325) [JENKINS-50268](https://issues.jenkins-ci.org/browse/JENKINS-50268)\n\n1.6.2\n-----\n* Transfer any master proxy related envs that the remoting jar uses to the pod templates with `addMasterProxyEnvVars` option [#321](https://github.com/jenkinsci/kubernetes-plugin/pull/321)\n\n1.6.1\n-----\n* Some fields are not inherited from parent template (InheritFrom, InstanceCap, SlaveConnectTimeout, IdleMinutes, ActiveDeadlineSeconds, ServiceAccount, CustomWorkspaceVolumeEnabled) [#319](https://github.com/jenkinsci/kubernetes-plugin/pull/319)\n\n1.6.0\n-----\n* Support multiple containers in declarative pipeline [#306](https://github.com/jenkinsci/kubernetes-plugin/pull/306) [JENKINS-48135](https://issues.jenkins-ci.org/browse/JENKINS-48135)\n* Expose pod configuration via yaml to UI and merge tolerations when inheriting [#311](https://github.com/jenkinsci/kubernetes-plugin/pull/311)\n* Resolve NPE merging yaml when resource requests/limits are not set [#310](https://github.com/jenkinsci/kubernetes-plugin/pull/310)\n* Do not pass arguments to jnlp container [#315](https://github.com/jenkinsci/kubernetes-plugin/pull/315) [JENKINS-50913](https://issues.jenkins-ci.org/browse/JENKINS-50913)\n\n1.5.2\n-----\n* Merge default `jnlp` container options [JENKINS-50533](https://issues.jenkins-ci.org/browse/JENKINS-50533) [#305](https://github.com/jenkinsci/kubernetes-plugin/pull/305)\n\n1.5.1\n-----\n* Fix duplicated volume mounts [JENKINS-50525](https://issues.jenkins-ci.org/browse/JENKINS-50525) [#303](https://github.com/jenkinsci/kubernetes-plugin/pull/303)\n* Use the correct agent namespace in logs [#304](https://github.com/jenkinsci/kubernetes-plugin/pull/304)\n\n1.5\n-----\n* Allow creating Pod templates from yaml. This allows setting all possible fields in Kubernetes API using yaml [JENKINS-50282](https://issues.jenkins-ci.org/browse/JENKINS-50282) [#275](https://github.com/jenkinsci/kubernetes-plugin/pull/275)\n* Print agent specification upon node allocation [#302](https://github.com/jenkinsci/kubernetes-plugin/pull/302)\n\n1.4.1\n-----\n* Env vars using `PATH+SOMETHING` syntax clear the previous env var [JENKINS-50437](https://issues.jenkins-ci.org/browse/JENKINS-50437) [#301](https://github.com/jenkinsci/kubernetes-plugin/pull/301)\n\n1.4\n-----\n* Support passing `kubeconfig` file as credentials using secretFile credentials [JENKINS-49817](https://issues.jenkins-ci.org/browse/JENKINS-49817) [#294](https://github.com/jenkinsci/kubernetes-plugin/pull/294)\n* Allow customization of NodeProvisioner.PlannedNode using extension point [#298](https://github.com/jenkinsci/kubernetes-plugin/pull/298)\n\n1.3.3\n-----\n* Upgrade kubernetes-client to 3.1.10 [#271](https://github.com/jenkinsci/kubernetes-plugin/pull/271)\n* Copy `jenkinsTunnel` in copy constructor [#295](https://github.com/jenkinsci/kubernetes-plugin/pull/295)\n\n1.3.2\n-----\n* Fix ssh-agent execution inside container. envVars on procstarter were discarded [JENKINS-42582](https://issues.jenkins-ci.org/browse/JENKINS-42582) [#291](https://github.com/jenkinsci/kubernetes-plugin/pull/291)\n* Allow specifying a different shell command other than `/bin/sh` [#287](https://github.com/jenkinsci/kubernetes-plugin/pull/287)\n\n1.3.1\n-----\n* Track agents being in provisioning to avoid overprovisioning [JENKINS-47501](https://issues.jenkins-ci.org/browse/JENKINS-47501) [#289](https://github.com/jenkinsci/kubernetes-plugin/pull/289)\n\n1.3\n-----\n* Implement extension points to contribute pod templates and filter them [JENKINS-49594](https://issues.jenkins-ci.org/browse/JENKINS-49594) [#288](https://github.com/jenkinsci/kubernetes-plugin/pull/288)\n\n1.2.1\n-----\n* Don't persist PodTemplateMap and implement onResume in PodTemplateStep. Will prevent potential leaking of dynamic pod templates definitions across restarts [JENKINS-47759](https://issues.jenkins-ci.org/browse/JENKINS-47759) [#285](https://github.com/jenkinsci/kubernetes-plugin/pull/285)\n* Provide injection of run context (build level) environment variables for container steps in declarative pipeline usage [JENKINS-49465](https://issues.jenkins-ci.org/browse/JENKINS-49465) [#285](https://github.com/jenkinsci/kubernetes-plugin/pull/285)\n* Fix global environment variables [JENKINS-47376](https://issues.jenkins-ci.org/browse/JENKINS-47376) [#245](https://github.com/jenkinsci/kubernetes-plugin/pull/245)\n\n1.2\n-----\n* Move PodTemplate -> Pod conversion to PodTemplateBuilder [#276](https://github.com/jenkinsci/kubernetes-plugin/pull/276)\n* Split credentials classes into new plugin [kubernetes-credentials](https://github.com/jenkinsci/kubernetes-credentials-plugin)  [#268](https://github.com/jenkinsci/kubernetes-plugin/pull/268)\n\n1.1.4\n-----\n* Store definition of dynamic templates to a separate configuration than Kubernetes cloud [JENKINS-49166](https://issues.jenkins-ci.org/browse/JENKINS-49166) [#279](https://github.com/jenkinsci/kubernetes-plugin/pull/279)\n  * This can cause some side effects on the order the templates are picked, see\n    * [JENKINS-49366](https://issues.jenkins-ci.org/browse/JENKINS-49366) Nested podTemplate stopped working in 1.1.4\n    * [JENKINS-49313](https://issues.jenkins-ci.org/browse/JENKINS-49313) Incorrect podTemplate deployed starting in 1.1.4\n* Prevent unneeded exec operations [#239](https://github.com/jenkinsci/kubernetes-plugin/pull/239)\n\n1.1.3\n-----\n* Fix UI support of environment variables [JENKINS-47112](https://issues.jenkins-ci.org/browse/JENKINS-47112) [#273](https://github.com/jenkinsci/kubernetes-plugin/pull/273)\n* Missing call to `slave.terminate()` [#256](https://github.com/jenkinsci/kubernetes-plugin/pull/256)\n* Rename slave -> agent [#258](https://github.com/jenkinsci/kubernetes-plugin/pull/258)\n* Add new line when logging the agent in Jenkins [#267](https://github.com/jenkinsci/kubernetes-plugin/pull/267)\n\n1.1.2\n-----\n* Namespace is erroneously autodetected as 'default' [#261](https://github.com/jenkinsci/kubernetes-plugin/pull/261)\n* Do not require 2.89 for installation, revert to 2.32.1 [#263](https://github.com/jenkinsci/kubernetes-plugin/pull/263)\n* IllegalStateException at hudson.XmlFile.replaceIfNotAtTopLevel [JENKINS-45892](https://issues.jenkins-ci.org/browse/JENKINS-45892) [#257](https://github.com/jenkinsci/kubernetes-plugin/pull/257)\n\n1.1.1\n-----\n* Fix agent reconnection after master restart [JENKINS-47476](https://issues.jenkins-ci.org/browse/JENKINS-47476) [#244](https://github.com/jenkinsci/kubernetes-plugin/pull/244)\n* Wait 5s for complete disconnection of agents to avoid stack trace [#248](https://github.com/jenkinsci/kubernetes-plugin/pull/248)\n* If namespace is not provided nor autoconfigured should use `default` [#234](https://github.com/jenkinsci/kubernetes-plugin/pull/234)\n* Kubernetes plugin not using cmd proc variables, affecting `sshagent` step [JENKINS-47225](https://issues.jenkins-ci.org/browse/JENKINS-47225)[#236](https://github.com/jenkinsci/kubernetes-plugin/pull/236)\n* Escape quotes in environment variables [JENKINS-46670](https://issues.jenkins-ci.org/browse/JENKINS-46670)[#218](https://github.com/jenkinsci/kubernetes-plugin/pull/218)\n\n1.1\n-----\n* Only allow tasks after all containers in pod are ready [#230](https://github.com/jenkinsci/kubernetes-plugin/pull/230)\n* Add activeDeadlineSeconds to Pod template [#221](https://github.com/jenkinsci/kubernetes-plugin/pull/221)\n* Default podTemplate slaveConnectTimeout to 100 [#235](https://github.com/jenkinsci/kubernetes-plugin/pull/235)\n* Allow overriding HOME env var and remove duplicated env vars [#224](https://github.com/jenkinsci/kubernetes-plugin/pull/224)\n* Rename jenkinsci/jnlp-slave -> jenkins/jnlp-slave and upgrade to 3.10-1 [#231](https://github.com/jenkinsci/kubernetes-plugin/pull/231)\n* Do not use a tty to prevent nohup.out from being created [JENKINS-46087](https://issues.jenkins-ci.org/browse/JENKINS-46085) [#212](https://github.com/jenkinsci/kubernetes-plugin/pull/222)\n* Pod annotations cannot contain duplicate keys when combining pod templates [#220](https://github.com/jenkinsci/kubernetes-plugin/pull/220)\n* Kubernetes agents not getting deleted in Jenkins after pods are deleted [JENKINS-35246](https://issues.jenkins-ci.org/browse/JENKINS-35246) [#217](https://github.com/jenkinsci/kubernetes-plugin/pull/217)\n* Remove unused JENKINS_JNLP_URL env var [#219](https://github.com/jenkinsci/kubernetes-plugin/pull/219)\n\n1.0\n-----\n\n* `containerLog` step to get the logs of a container running in the agent pod [JENKINS-46085](https://issues.jenkins-ci.org/browse/JENKINS-46085) [#195](https://github.com/jenkinsci/kubernetes-plugin/pull/195)\n* Autoconfigure cloud if kubernetes url is not set [#208](https://github.com/jenkinsci/kubernetes-plugin/pull/208)\n* Change containerCap and instanceCap 0 to mean do not use [JENKINS-45845](https://issues.jenkins-ci.org/browse/JENKINS-45845) [#199](https://github.com/jenkinsci/kubernetes-plugin/pull/199)\n* Add environment variables to container from a secret [JENKINS-39867](https://issues.jenkins-ci.org/browse/JENKINS-39867) [#162](https://github.com/jenkinsci/kubernetes-plugin/pull/162)\n * Deprecate `containerEnvVar` for `envVar` and added `secretEnvVar`\n* Enable setting slaveConnectTimeout in podTemplate defined in pipeline [#213](https://github.com/jenkinsci/kubernetes-plugin/pull/213)\n* Read Jenkins URL from cloud configuration or `KUBERNETES_JENKINS_URL` env var [#216](https://github.com/jenkinsci/kubernetes-plugin/pull/216)\n* Make `withEnv` work inside a container [JENKINS-46278](https://issues.jenkins-ci.org/browse/JENKINS-46278) [#204](https://github.com/jenkinsci/kubernetes-plugin/pull/204)\n* Close resource leak, fix broken pipe error. Make number of concurrent requests to Kubernetes configurable [JENKINS-40825](https://issues.jenkins-ci.org/browse/JENKINS-40825) [#182](https://github.com/jenkinsci/kubernetes-plugin/pull/182)\n* Delete pods in the cloud namespace when pod namespace is not defined [JENKINS-45910](https://issues.jenkins-ci.org/browse/JENKINS-45910) [#192](https://github.com/jenkinsci/kubernetes-plugin/pull/192)\n* Use `Util.replaceMacro` instead of our custom replacement logic. Behavior change: when a var is not defined it is not replaced, ie. `${key1} or ${key2} or ${key3}` -> `value1 or value2 or ${key3}` [#198](https://github.com/jenkinsci/kubernetes-plugin/pull/198)\n* Allow to create non-configurable instances programmatically [#191](https://github.com/jenkinsci/kubernetes-plugin/pull/191)\n* Do not cache kubernetes connection to reflect config changes and credential expiration [JENKINS-39867](https://issues.jenkins-ci.org/browse/JENKINS-39867) [#189](https://github.com/jenkinsci/kubernetes-plugin/pull/189)\n* Inherit podAnnotations when inheriting pod templates [#209](https://github.com/jenkinsci/kubernetes-plugin/pull/209)\n* Remove unneeded plugin dependencies, make pipeline-model-extensions optional [#214](https://github.com/jenkinsci/kubernetes-plugin/pull/214)\n\n0.12\n-----\n\n* Add an experimental Declarative Agent extension for Kubernetes [JENKINS-41758](https://issues.jenkins-ci.org/browse/JENKINS-41758) [#127](https://github.com/jenkinsci/kubernetes-plugin/pull/127)\n* Implement Port mapping [#165](https://github.com/jenkinsci/kubernetes-plugin/pull/165)\n* Support idleMinutes field in pipeline [#154](https://github.com/jenkinsci/kubernetes-plugin/pull/154)\n* Add command liveness probe support [#158](https://github.com/jenkinsci/kubernetes-plugin/pull/158)\n* Add toggle for node usage mode [#158](https://github.com/jenkinsci/kubernetes-plugin/pull/158)\n* Add namespace support on PodTemplate.\n* Make PodTemplate optional within pipeline [JENKINS-42315](https://issues.jenkins-ci.org/browse/JENKINS-42315)\n* Make Slave Jenkins connection timeout configurable [#141](https://github.com/jenkinsci/kubernetes-plugin/pull/141)\n* Fix durable pipeline PID NumberFormatException [JENKINS-42048](https://issues.jenkins-ci.org/browse/JENKINS-42048) [#157](https://github.com/jenkinsci/kubernetes-plugin/pull/157)\n* Don't provision nodes if there are no PodTemplates set to usage mode Normal [#171](https://github.com/jenkinsci/kubernetes-plugin/pull/171)\n* Refactoring add/set methods in PodTemplate [#173](https://github.com/jenkinsci/kubernetes-plugin/pull/173)\n* Delete the build pod after we have finished with the template block [#172](https://github.com/jenkinsci/kubernetes-plugin/pull/172)\n* Default to use the kubernetes.default.svc.cluster.local endpoint\n* Do not print stack trace on ConnectException\n* Upgrade kubernetes client to 2.3.1 [JENKINS-44189](https://issues.jenkins-ci.org/browse/JENKINS-42048)\n* Step namespace should have priority over anything else [#161](https://github.com/jenkinsci/kubernetes-plugin/pull/161)\n* Wait for pod to exist up to 60 seconds before erroring [#155](https://github.com/jenkinsci/kubernetes-plugin/pull/155)\n* Catch IOException on ContainerExecProc#kill\n* Do not print stack trace on connection exception\n* Restore random naming for pipeline managed pod templates.\n* Dir context is not honored by shell step [JENKINS-40925](https://issues.jenkins-ci.org/browse/JENKINS-40925) [#146](https://github.com/jenkinsci/kubernetes-plugin/pull/146)\n* Limit pod name to 63 characters, and change the randomly generated string [#143](https://github.com/jenkinsci/kubernetes-plugin/pull/143)\n* Fix workingDir inheritance error [#136](https://github.com/jenkinsci/kubernetes-plugin/pull/136)\n* Use name instead of label for the nesting stack [#137](https://github.com/jenkinsci/kubernetes-plugin/pull/137)\n* Exception in configure page when 'Kubernetes URL' isn't filled [JENKINS-45282](https://issues.jenkins-ci.org/browse/JENKINS-45282) [#174](https://github.com/jenkinsci/kubernetes-plugin/pull/174)\n* kubectl temporary config file should work where Jenkins project contains spaces [#178](https://github.com/jenkinsci/kubernetes-plugin/pull/178)\n* Thread/connection leak [#177](https://github.com/jenkinsci/kubernetes-plugin/pull/177)\n\n\n0.11\n-----\n\n* Pod Template \"Annotations\" Field [#105](https://github.com/jenkinsci/kubernetes-plugin/pull/105)\n* The workspace volume is now configurable [#114](https://github.com/jenkinsci/kubernetes-plugin/pull/114)\n* Allow the user to configure a pod template that will be used for providing the default values. [#133](https://github.com/jenkinsci/kubernetes-plugin/pull/133)\n* Cleanup environment variable mapping, allow overriding HOME env variable [#128](https://github.com/jenkinsci/kubernetes-plugin/pull/128)\n* When upgrading from <0.9 set the container name to jnlp. To avoid creating an extra container, the one that exists and the new jnlp auto generated [#132](https://github.com/jenkinsci/kubernetes-plugin/pull/132)\n* Make the name field in the pod template the pod name [#134](https://github.com/jenkinsci/kubernetes-plugin/pull/134)\n* [JENKINS-41847] NPE in addProvisionedSlave when label is null [#129](https://github.com/jenkinsci/kubernetes-plugin/pull/129)\n* [JENKINS-41725] NPE in PodTemplateUtils.combine [#130](https://github.com/jenkinsci/kubernetes-plugin/pull/130)\n* [JENKINS-41287] Fix error when job contains spaces [#131](https://github.com/jenkinsci/kubernetes-plugin/pull/131)\n* Remove node if pod startup fails [#122](https://github.com/jenkinsci/kubernetes-plugin/pull/122)\n* Avoid NPE if cloud is deleted or renamed [#118](https://github.com/jenkinsci/kubernetes-plugin/pull/118)\n* Fixing deletion of containers in pod templates, containers property is databound [#113](https://github.com/jenkinsci/kubernetes-plugin/pull/113)\n* Prevent NPE in PodTemplateAction [#112](https://github.com/jenkinsci/kubernetes-plugin/pull/112)\n* [JENKINS-40457] java.lang.ArrayStoreException when a image pull secret is defined [#111](https://github.com/jenkinsci/kubernetes-plugin/pull/111)\n\n0.10\n-----\n\n* **NOTE if you have defined a JNLP container in your Pod definition**, you need to remove it or rename it to `jnlp`, otherwise a new container called `jnlp` will be created. Set \"Arguments to pass to the command\" to `${computer.jnlpmac} ${computer.name}`\n* Fixing checkbox serialization by jelly views [#110](https://github.com/jenkinsci/kubernetes-plugin/pull/110)\n* Do not throw exceptions in the test configuration page [#107](https://github.com/jenkinsci/kubernetes-plugin/pull/107)\n* Upgrade to the latest kubernetes-client version. [#106](https://github.com/jenkinsci/kubernetes-plugin/pull/106)\n* feat: make pipeline support instanceCap field [#102](https://github.com/jenkinsci/kubernetes-plugin/pull/102)\n* Instantiating Kubernetes Client with proper config in Container Steps [#104](https://github.com/jenkinsci/kubernetes-plugin/pull/104)\n* Fix NPE when slaves are read from disk [#103](https://github.com/jenkinsci/kubernetes-plugin/pull/103)\n* [JENKINS-39867] Upgrade fabric8 to 1.4.26 [#101](https://github.com/jenkinsci/kubernetes-plugin/pull/101)\n* The pod watcher now checks readiness of the right pod. [#97](https://github.com/jenkinsci/kubernetes-plugin/pull/97)\n* Fix logic for waitUntilContainerIsReady [#95](https://github.com/jenkinsci/kubernetes-plugin/pull/95)\n* instanceCap is not used in pipeline [#92](https://github.com/jenkinsci/kubernetes-plugin/pull/92)\n* Allow nesting of templates for inheritance. [#94](https://github.com/jenkinsci/kubernetes-plugin/pull/94)\n* Wait until all containers are in ready state before starting the slave [#93](https://github.com/jenkinsci/kubernetes-plugin/pull/93)\n* Adding basic retention for idle slaves, using the idleTimeout setting properly [#91](https://github.com/jenkinsci/kubernetes-plugin/pull/91)\n* Improve the inheritFrom functionality to better cover containers and volumes. [#84](https://github.com/jenkinsci/kubernetes-plugin/pull/84)\n* Fix null pointer exceptions. [#89](https://github.com/jenkinsci/kubernetes-plugin/pull/89)\n* fix PvcVolume jelly templates path [#90](https://github.com/jenkinsci/kubernetes-plugin/pull/90)\n* Added tool installations to the pod template. [#85](https://github.com/jenkinsci/kubernetes-plugin/pull/85)\n* fix configmap volume name [#87](https://github.com/jenkinsci/kubernetes-plugin/pull/87)\n* set the serviceAccount when creating new pods [#86](https://github.com/jenkinsci/kubernetes-plugin/pull/86)\n* Read and connect timeout are now correctly used to configure the client. [#82](https://github.com/jenkinsci/kubernetes-plugin/pull/82)\n* Fix nodeSelector in podTemplate [#83](https://github.com/jenkinsci/kubernetes-plugin/pull/83)\n* Use the client's namespace when deleting a pod (fixes a regression preventing pods to delete). [#81](https://github.com/jenkinsci/kubernetes-plugin/pull/81)\n\n\n0.9\n-----\n\n* Make it possible to define more than one container inside a pod.\n* Add new pod template step which allows defining / overriding a pod template from a pipeline script.\n* Introduce pipeline step that allows choosing one of the containers of the pod and have all 'sh' steps executed there.\n* allow setting dynamic pod volumes in pipelines\n* Add support for persistent volume claims\n* Add support for containerEnvVar's in pipelines\n* [JENKINS-37087] Handle multiple labels per pod correctly\n* [JENKINS-37087] Iterate over all matching templates\n* Fix slave description and labels\n* [JENKINS-38829] Add help text for Kubernetes server certificate\n* #59: Allow blank namespace and reuse whatever is discovered by the client.\n* Ensure instanceCap defaults to unlimited\n* Add Jenkins computer name to the container env vars\n* Split arguments having quotes into account\n* Allow the user to enable pseudo-TTY on container level.\n* Use provided arguments without forcing jnlpmac and name into them. Provide placeholders for jnlpmac and name for the user to use. Fallback container uses as default arguments jnlpmac and name.\n* Split volume classes into their own package (#77)\n\n0.8\n-----\n\n* Add ability to define list of image pull secrets for pod template\n* Fix name printing\n* [JENKINS-36253] Add Annotations to Pod Template\n* Add support for NFS volumes (#63)\n* Change health check url for one that works (Jenkins 2 enables CSRF protection and security by default)\n* Issue #59 Allow autodiscovery of namespace\n* Update kubernetes-client\n* Add support for service account\n\n0.7\n-----\n\n* Set HOME and working dir for build to execute into slave agent remoteFS (#57)\n* JENKINS-34840 Fix NPE when node selector is null\n* Add resouce request and limit to container\n* Generate Cloud Slave node base on pod template name\n* check for null prior to ranging over template.getEnvVars() (#61)\n* Fix StringIndexOutOfBoundsException in slave name\n\n0.6\n-----\n\n* Add support for secrets and empty dir volumes\n* Add support for nodeSelector in pod templates\n* Add support for storing OpenShift OAuth access token as credential\n* Allow client certificate as kubernetes api credentials (JENKINS-30894)\n* Fix ArrayIndexOutOfBoundsException building node selector map when field is empty on the configuration (JENKINS-33649)\n* Add support for env variables\n* Add checkbox for image pull policy\n\n0.5\n-----\n\n* Update fabric8 client for Kubernetes to 2.2.16\n* Use a replication controller to run Jenkins master\n* Generate OpenShift OAuth Bearer token on demand based on user credentials\n* Add support for Container Cleanup Timeout\n* Fix JENKINS-31076 â€” Proper message if credentials are not defined or not found\n* Add support for hostPath volumes\n\n0.4.1\n-----\n\n* Avoid looooooong slave name\n* Support token based authentication for CLI\n\n0.4\n-----\n\n* Use a Bearer token to connect to API master (typically to connect to OpenShift Origin)\n* Enable a dedicated credential type when jenkins do run inside kubernetes with service account enabled, so cloud can be setup with a fixed configuration, but actual credentials get injected at runtime\n\n0.2\n-----\n\n* Replace obsolete Kubernetes client library with Fabric8\n* Let user configure the kubernetes cluster CA root certificate for self-signed deployment (typically, Google Container Engine)\n* Upgrade Docker-plugin dependency to 0.9.4 - warning: 0.10 is incompatible\n\n0.1\n-----\n\n* Initial implementation\n"
        },
        {
          "name": "Dockerfile",
          "type": "blob",
          "size": 0.9052734375,
          "content": "FROM jenkins/jenkins:lts-alpine\n\nARG VERSION=1.15.5\n#RUN /usr/local/bin/install-plugins.sh kubernetes:${VERSION}\n\nRUN jenkins-plugin-cli --plugins kubernetes-client-api \\\n    kubernetes-credentials \\\n    docker-commons \\\n    cloudbees-folder \\\n    workflow-api \\\n    variant \\\n    durable-task \\\n    workflow-durable-task-step \\\n    metrics \\\n    caffeine-api\nCOPY target/kubernetes.hpi /usr/share/jenkins/ref/plugins/kubernetes.hpi\n\n# RUN curl -o /usr/share/jenkins/ref/plugins/kubernetes.hpi \\\n#  http://repo.jenkins-ci.org/snapshots/org/csanchez/jenkins/plugins/kubernetes/0.12/kubernetes-$VERSION.hpi\n\n# remove executors in controller\nCOPY src/main/docker/master-executors.groovy /usr/share/jenkins/ref/init.groovy.d/\n\n# ENV JAVA_OPTS=\"-Djava.util.logging.config.file=/var/jenkins_home/log.properties\"\nENV JAVA_OPTS=\"-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=1 -XshowSettings:vm\"\n"
        },
        {
          "name": "Jenkinsfile",
          "type": "blob",
          "size": 3.1181640625,
          "content": "properties([\n    disableConcurrentBuilds(abortPrevious: true),\n    durabilityHint('PERFORMANCE_OPTIMIZED'),\n    buildDiscarder(logRotator(numToKeepStr: '5')),\n])\n\ndef splits\nstage('Determine splits') {\n    node('maven-11') {\n        checkout scm\n        splits = splitTests parallelism: count(2), generateInclusions: true, estimateTestsFromFiles: true\n    }\n}\nstage('Tests') {\n    def branches = [:]\n    branches['failFast'] = true\n\n    for (int i = 0; i < splits.size(); i++) {\n        def num = i\n        def split = splits[num]\n        def index = num + 1\n        branches[\"kind-${index}\"] = {\n            node('docker') {\n                timeout(90) {\n                    checkout scm\n                    try {\n                        writeFile file: (split.includes ? \"$WORKSPACE_TMP/includes.txt\" : \"$WORKSPACE_TMP/excludes.txt\"), text: split.list.join(\"\\n\")\n                        writeFile file: (split.includes ? \"$WORKSPACE_TMP/excludes.txt\" : \"$WORKSPACE_TMP/includes.txt\"), text: ''\n                        sh './kind.sh -Penable-jacoco -Dsurefire.includesFile=\"$WORKSPACE_TMP/includes.txt\" -Dsurefire.excludesFile=\"$WORKSPACE_TMP/excludes.txt\"'\n                        junit 'target/surefire-reports/*.xml'\n                        withEnv(['NUM=' + num]) {\n                            sh '''\n                                for f in $(find . -name jacoco.exec)\n                                do\n                                    mv \"$f\" \"$(echo \"$f\" | sed s/jacoco./jacoco-$NUM./)\"\n                                done\n                            '''\n                        }\n                        if (num == 0) {\n                            stash name: 'classes', includes: '**/target/classes/**'\n                        }\n                        stash name: 'coverage-exec-' + num, allowEmpty: true, includes: '**/target/jacoco*.exec'\n                    } finally {\n                        dir(env.WORKSPACE_TMP) {\n                            if (fileExists('kindlogs/docker-info.txt')) {\n                                archiveArtifacts 'kindlogs/'\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n    branches['jdk11'] = {\n        retry(count: 3, conditions: [kubernetesAgent(handleNonKubernetes: true), nonresumable()]) {\n            node('maven-11') {\n                timeout(60) {\n                    checkout scm\n                    sh 'mvn -B -ntp -Dset.changelist -Dmaven.test.failure.ignore clean install'\n                    infra.prepareToPublishIncrementals()\n                    junit 'target/surefire-reports/*.xml'\n                }\n            }\n        }\n    }\n    parallel branches\n    stage('aggregate coverage') {\n        node('maven-17') {\n            checkout scm\n            unstash 'classes'\n            for (int i = 0; i < splits.size(); i++) {\n                unstash 'coverage-exec-' + i\n            }\n            sh 'mvn -B -ntp -P merge-jacoco-reports validate'\n            recordCoverage(tools: [[parser: 'JACOCO', pattern: '**/jacoco/jacoco.xml']], sourceCodeRetention: 'MODIFIED')\n        }\n    }\n}\n// Stage part of the library\ninfra.maybePublishIncrementals()\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 11.0595703125,
          "content": "Apache License\n                           Version 2.0, January 2004\n                        http://www.apache.org/licenses/\n\n   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION\n\n   1. Definitions.\n\n      \"License\" shall mean the terms and conditions for use, reproduction,\n      and distribution as defined by Sections 1 through 9 of this document.\n\n      \"Licensor\" shall mean the copyright owner or entity authorized by\n      the copyright owner that is granting the License.\n\n      \"Legal Entity\" shall mean the union of the acting entity and all\n      other entities that control, are controlled by, or are under common\n      control with that entity. For the purposes of this definition,\n      \"control\" means (i) the power, direct or indirect, to cause the\n      direction or management of such entity, whether by contract or\n      otherwise, or (ii) ownership of fifty percent (50%) or more of the\n      outstanding shares, or (iii) beneficial ownership of such entity.\n\n      \"You\" (or \"Your\") shall mean an individual or Legal Entity\n      exercising permissions granted by this License.\n\n      \"Source\" form shall mean the preferred form for making modifications,\n      including but not limited to software source code, documentation\n      source, and configuration files.\n\n      \"Object\" form shall mean any form resulting from mechanical\n      transformation or translation of a Source form, including but\n      not limited to compiled object code, generated documentation,\n      and conversions to other media types.\n\n      \"Work\" shall mean the work of authorship, whether in Source or\n      Object form, made available under the License, as indicated by a\n      copyright notice that is included in or attached to the work\n      (an example is provided in the Appendix below).\n\n      \"Derivative Works\" shall mean any work, whether in Source or Object\n      form, that is based on (or derived from) the Work and for which the\n      editorial revisions, annotations, elaborations, or other modifications\n      represent, as a whole, an original work of authorship. For the purposes\n      of this License, Derivative Works shall not include works that remain\n      separable from, or merely link (or bind by name) to the interfaces of,\n      the Work and Derivative Works thereof.\n\n      \"Contribution\" shall mean any work of authorship, including\n      the original version of the Work and any modifications or additions\n      to that Work or Derivative Works thereof, that is intentionally\n      submitted to Licensor for inclusion in the Work by the copyright owner\n      or by an individual or Legal Entity authorized to submit on behalf of\n      the copyright owner. For the purposes of this definition, \"submitted\"\n      means any form of electronic, verbal, or written communication sent\n      to the Licensor or its representatives, including but not limited to\n      communication on electronic mailing lists, source code control systems,\n      and issue tracking systems that are managed by, or on behalf of, the\n      Licensor for the purpose of discussing and improving the Work, but\n      excluding communication that is conspicuously marked or otherwise\n      designated in writing by the copyright owner as \"Not a Contribution.\"\n\n      \"Contributor\" shall mean Licensor and any individual or Legal Entity\n      on behalf of whom a Contribution has been received by Licensor and\n      subsequently incorporated within the Work.\n\n   2. Grant of Copyright License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      copyright license to reproduce, prepare Derivative Works of,\n      publicly display, publicly perform, sublicense, and distribute the\n      Work and such Derivative Works in Source or Object form.\n\n   3. Grant of Patent License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      (except as stated in this section) patent license to make, have made,\n      use, offer to sell, sell, import, and otherwise transfer the Work,\n      where such license applies only to those patent claims licensable\n      by such Contributor that are necessarily infringed by their\n      Contribution(s) alone or by combination of their Contribution(s)\n      with the Work to which such Contribution(s) was submitted. If You\n      institute patent litigation against any entity (including a\n      cross-claim or counterclaim in a lawsuit) alleging that the Work\n      or a Contribution incorporated within the Work constitutes direct\n      or contributory patent infringement, then any patent licenses\n      granted to You under this License for that Work shall terminate\n      as of the date such litigation is filed.\n\n   4. Redistribution. You may reproduce and distribute copies of the\n      Work or Derivative Works thereof in any medium, with or without\n      modifications, and in Source or Object form, provided that You\n      meet the following conditions:\n\n      (a) You must give any other recipients of the Work or\n          Derivative Works a copy of this License; and\n\n      (b) You must cause any modified files to carry prominent notices\n          stating that You changed the files; and\n\n      (c) You must retain, in the Source form of any Derivative Works\n          that You distribute, all copyright, patent, trademark, and\n          attribution notices from the Source form of the Work,\n          excluding those notices that do not pertain to any part of\n          the Derivative Works; and\n\n      (d) If the Work includes a \"NOTICE\" text file as part of its\n          distribution, then any Derivative Works that You distribute must\n          include a readable copy of the attribution notices contained\n          within such NOTICE file, excluding those notices that do not\n          pertain to any part of the Derivative Works, in at least one\n          of the following places: within a NOTICE text file distributed\n          as part of the Derivative Works; within the Source form or\n          documentation, if provided along with the Derivative Works; or,\n          within a display generated by the Derivative Works, if and\n          wherever such third-party notices normally appear. The contents\n          of the NOTICE file are for informational purposes only and\n          do not modify the License. You may add Your own attribution\n          notices within Derivative Works that You distribute, alongside\n          or as an addendum to the NOTICE text from the Work, provided\n          that such additional attribution notices cannot be construed\n          as modifying the License.\n\n      You may add Your own copyright statement to Your modifications and\n      may provide additional or different license terms and conditions\n      for use, reproduction, or distribution of Your modifications, or\n      for any such Derivative Works as a whole, provided Your use,\n      reproduction, and distribution of the Work otherwise complies with\n      the conditions stated in this License.\n\n   5. Submission of Contributions. Unless You explicitly state otherwise,\n      any Contribution intentionally submitted for inclusion in the Work\n      by You to the Licensor shall be under the terms and conditions of\n      this License, without any additional terms or conditions.\n      Notwithstanding the above, nothing herein shall supersede or modify\n      the terms of any separate license agreement you may have executed\n      with Licensor regarding such Contributions.\n\n   6. Trademarks. This License does not grant permission to use the trade\n      names, trademarks, service marks, or product names of the Licensor,\n      except as required for reasonable and customary use in describing the\n      origin of the Work and reproducing the content of the NOTICE file.\n\n   7. Disclaimer of Warranty. Unless required by applicable law or\n      agreed to in writing, Licensor provides the Work (and each\n      Contributor provides its Contributions) on an \"AS IS\" BASIS,\n      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n      implied, including, without limitation, any warranties or conditions\n      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A\n      PARTICULAR PURPOSE. You are solely responsible for determining the\n      appropriateness of using or redistributing the Work and assume any\n      risks associated with Your exercise of permissions under this License.\n\n   8. Limitation of Liability. In no event and under no legal theory,\n      whether in tort (including negligence), contract, or otherwise,\n      unless required by applicable law (such as deliberate and grossly\n      negligent acts) or agreed to in writing, shall any Contributor be\n      liable to You for damages, including any direct, indirect, special,\n      incidental, or consequential damages of any character arising as a\n      result of this License or out of the use or inability to use the\n      Work (including but not limited to damages for loss of goodwill,\n      work stoppage, computer failure or malfunction, or any and all\n      other commercial damages or losses), even if such Contributor\n      has been advised of the possibility of such damages.\n\n   9. Accepting Warranty or Additional Liability. While redistributing\n      the Work or Derivative Works thereof, You may choose to offer,\n      and charge a fee for, acceptance of support, warranty, indemnity,\n      or other liability obligations and/or rights consistent with this\n      License. However, in accepting such obligations, You may act only\n      on Your own behalf and on Your sole responsibility, not on behalf\n      of any other Contributor, and only if You agree to indemnify,\n      defend, and hold each Contributor harmless for any liability\n      incurred by, or claims asserted against, such Contributor by reason\n      of your accepting any such warranty or additional liability.\n\n   END OF TERMS AND CONDITIONS\n\n   APPENDIX: How to apply the Apache License to your work.\n\n      To apply the Apache License to your work, attach the following\n      boilerplate notice, with the fields enclosed by brackets \"{}\"\n      replaced with your own identifying information. (Don't include\n      the brackets!)  The text should be enclosed in the appropriate\n      comment syntax for the file format. We also recommend that a\n      file or class name and description of purpose be included on the\n      same \"printed page\" as the copyright notice for easier\n      identification within third-party archives.\n\n   Copyright {yyyy} {name of copyright owner}\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 42.7890625,
          "content": "Kubernetes plugin for Jenkins\n=========================\n\n[![kubernetes version](https://img.shields.io/jenkins/plugin/v/kubernetes.svg?label=kubernetes)](https://plugins.jenkins.io/kubernetes)\n[![kubernetes installs](https://img.shields.io/jenkins/plugin/i/kubernetes.svg)](https://plugins.jenkins.io/kubernetes)\n[![kubernetes license](https://img.shields.io/github/license/jenkinsci/kubernetes-plugin)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/LICENSE)\n[![Language grade: Java](https://img.shields.io/lgtm/grade/java/g/jenkinsci/kubernetes-plugin.svg?logo=lgtm&logoWidth=18)](https://lgtm.com/projects/g/jenkinsci/kubernetes-plugin/context:java)\n\nJenkins plugin to run dynamic agents in a Kubernetes cluster.\n\nBased on the [Scaling Docker with Kubernetes](http://www.infoq.com/articles/scaling-docker-with-kubernetes) article,\nautomates the scaling of Jenkins agents running in Kubernetes.\n\nThe plugin creates a Kubernetes Pod for each agent started, and stops it after each build.\n\nAgents are launched as inbound agents, so it is expected that the container connects automatically to the Jenkins controller.\nFor that some environment variables are automatically injected:\n\n* `JENKINS_URL` : Jenkins web interface url\n* `JENKINS_SECRET` : the secret key for authentication\n* `JENKINS_AGENT_NAME` : the name of the Jenkins agent\n* `JENKINS_NAME` : the name of the Jenkins agent (Deprecated. Only here for backwards compatibility)\n\nTested with [`jenkins/inbound-agent`](https://hub.docker.com/r/jenkins/inbound-agent),\nsee the [Docker image source code](https://github.com/jenkinsci/docker-agent).\n\nIt is not required to run the Jenkins controller inside Kubernetes.\n\n# ðŸ“œ Table of Contents\n\n- [Generic setup](#generic-setup)\n- [Usage](#usage)\n- [Configuration reference](#configuration-reference)\n- [Inheritance](#inheritance)\n- [Declarative Pipeline](#declarative-pipeline)\n- [Misc.](#misc.)\n- [Running on OpenShift](#running-on-openshift)\n- [Features controlled using system properties](#features-controlled-using-system-properties)\n- [Windows support](#windows-support)\n- [Constraints](#constraints)\n- [Configuration on minikube](#configuration-on-minikube)\n- [Configuration on Google Container Engine](#configuration-on-google-container-engine)\n- [Troubleshooting ðŸ”¨](#troubleshooting)\n- [Building and Testing](#building-and-testing)\n- [Docker image](#docker-image)\n- [Running in Kubernetes](#running-in-kubernetes)\n- [Related Projects](#related-projects)\n\n# Generic Setup\n## Prerequisites\n* A running Kubernetes cluster 1.14 or later. For OpenShift users, this means OpenShift Container Platform 4.x.\n* A Jenkins instance installed\n* The Jenkins Kubernetes plugin installed\n* A ServiceAccount with sufficient privileges ([example](src/main/kubernetes/service-account.yml))\n\n## Configuration\n\nFill in the Kubernetes plugin configuration.\nIn order to do that, you will open the Jenkins UI and navigate to **Manage Jenkins -> Manage Nodes and Clouds -> Configure Clouds -> Add a new cloud -> Kubernetes** and enter the *Kubernetes URL* and *Jenkins URL* appropriately, unless Jenkins is running in Kubernetes in which case the defaults work.\n\nSupported credentials include:\n\n* Username/password\n* Secret File (kubeconfig file)\n* Secret text (Token-based authentication) (OpenShift)\n* Google Service Account from private key (GKE authentication)\n* X.509 Client Certificate\n\nIf you check **WebSocket** then agents will connect over HTTP(S) rather than the Jenkins service TCP port.\nThis is unnecessary when the Jenkins controller runs in the same Kubernetes cluster,\nbut can greatly simplify setup when agents are in an external cluster\nand the Jenkins controller is not directly accessible (for example, it is behind a reverse proxy or a ingress resource).\nSee [JEP-222](https://jenkins.io/jep/222) for more.\n\nTo test this connection is successful you can use the **Test Connection** button to ensure there is\nadequate communication from Jenkins to the Kubernetes cluster, as seen below\n\n![image](images/cloud-configuration.png)\n\n\n### Garbage collection (beta)\n\nIn some exceptional cases, agent pods can be left behind, with no declared Jenkins agent in the controller. They will try to reconnect over and over, until something deletes them.\n\nThe plugin provides a garbage collection mechanism to clean up these pods. As it has been introduced recently,\nand generates extra load on the Kubernetes API server, it is disabled by default.\n\nFeel free to enable it and provide feedback about this functionality.\n\n![image](images/garbage-collection.png)\n\n## Static pod templates\n\nIn addition to that, in the **Kubernetes Pod Template** section, we need to configure the image that will be used to \nspin up the agent pod. The Jenkins agent runs by default in a container named `jnlp` (historical name, kept for backward compatibility).\n\nYou may use it, use a different agent container name and/or provide your own container image.\n\nTo avoid drift between the Jenkins controller and your agent, we recommend *not* to include the agent JAR in your image, but instead use the *Inject Jenkins agent in agent container* checkbox.\n\nThe provided container image must have a JRE installed that is compatible with the Java version required by the Jenkins controller.\n\nIn the â€˜Kubernetes Pod Templateâ€™ section you need to specify the following (the rest of the configuration is up to you):\nKubernetes Pod Template Name - can be any and will be shown as a prefix for unique generated agentâ€™ names, which will \nbe run automatically during builds\nDocker image - the docker image name that will be used as a reference to spin up a new Jenkins agent, as seen below\n\n![image](images/pod-template-configuration.png)\n\n> **Note:** If your Jenkins controller is outside the cluster and uses a self-signed HTTPS certificate,\n>   you will need some [additional configuration](#using-websockets-with-a-jenkins-master-with-self-signed-https-certificate).\n\n### Restricting what jobs can use your configured cloud\n\nClouds can be configured to only allow certain jobs to use them.\n\nTo enable this, in your cloud's advanced configuration check the\n`Restrict pipeline support to authorized folders` box. For a job to then\nuse this cloud configuration you will need to add it in the jobs folder's configuration.\n\n# Usage\n## Overview\n\nThe Kubernetes plugin allocates Jenkins agents in Kubernetes pods.\n\nWithin these pods, there is always one special container that is running the Jenkins agent.\n\nIts name defaults to `jnlp`, but you can override the name with one of your choosing in pod template configuration.\n\nOther containers can run arbitrary processes of your choosing, and it is possible to run commands dynamically in any container in the agent pod using the `container` step (pipeline only). \n\n## Using a label\n\nPod templates defined using the user interface declare a label. When a freestyle job or a pipeline job using\n`node('some-label')` uses a label declared by a pod template, the Kubernetes Cloud allocates a new pod to run the\nJenkins agent.\n\nIt should be noted that the main reason to use the global pod template definition is to migrate a huge corpus of\nexisting projects (including freestyle) to run on Kubernetes without changing job definitions.\nNew users setting up new Kubernetes builds should use the `podTemplate` step as shown in the example snippets\n[here](examples).\n\n## Using the pipeline step\n\nThe `podTemplate` step defines an ephemeral pod template. It is created while the pipeline execution is within the\n`podTemplate` block. It is immediately deleted afterwards. Such pod templates are not intended to be shared with other\nbuilds or projects in the Jenkins instance.\n\nThe following idiom creates a pod template with a generated unique label (available as `POD_LABEL`) and runs commands inside it.\n\n```groovy\npodTemplate {\n    node(POD_LABEL) {\n        // pipeline steps...\n    }\n}\n```\n\nCommands will be executed by default in the designated agent container, where the Jenkins agent is running.\n\nThis will run in the agent container:\n```groovy\npodTemplate {\n    node(POD_LABEL) {\n        stage('Run shell') {\n            sh 'echo hello world'\n        }\n    }\n}\n```\n\nFind more examples in the [examples dir](examples).\n\nThe default agent image used can be customized by adding it to the template\n\n```groovy\ncontainerTemplate(name: 'jnlp', image: 'jenkins/inbound-agent', args: '${computer.jnlpmac} ${computer.name}'),\n```\n\nor with the yaml syntax. Pretty much any field from the [pod model](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/) can be specified through the yaml syntax.\n\n```yaml\napiVersion: v1\nkind: Pod\nspec:\n  containers:\n  - name: jnlp\n    image: 'jenkins/inbound-agent'\n    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n```\n\n### Multiple containers support\n\nMultiple containers can be defined for the agent pod, with shared resources, like mounts. Ports in each container can\nbe accessed as in any Kubernetes pod, by using `localhost`.\n\nOne container must run the Jenkins agent. If unspecified, a container named `jnlp` will be created with the inbound-agent image.\nThe Jenkins agent requires a JRE to run, so you can avoid the extra container by providing a name using the `agentContainer`.\nTo get the Jenkins agent injected, you will also need to set `agentInjection` to `true`, and leave the command and argument fields empty for this container.\nThe container specified by `agentContainer` will be the one where shell steps (or any other step running remote commands on the agent) will run on.\n\nTo execute commands in another container part of the pod (different from the one running the Jenkins agent), you can use the `container` step.\n\n**Note**\n---\nDue to implementation constraints, there can be issues when executing commands in different containers if they run using different uids.\nIt is recommended to use the same uid across the different containers part of the same pod to avoid any issue.\n---\n\n```groovy\npodTemplate(\n  agentContainer: 'maven',\n  agentInjection: true,\n  containers: [\n    containerTemplate(name: 'maven', image: 'maven:3.9.9-eclipse-temurin-17'),\n    containerTemplate(name: 'golang', image: 'golang:1.16.5', command: 'sleep', args: '99d')\n  ]) {\n\n    node(POD_LABEL) {\n        stage('Get a Maven project') {\n            git 'https://github.com/jenkinsci/kubernetes-plugin.git'\n            container('maven') {\n                stage('Build a Maven project') {\n                    sh 'mvn -B -ntp clean install'\n                }\n            }\n        }\n\n        stage('Get a Golang project') {\n            git url: 'https://github.com/hashicorp/terraform.git', branch: 'main'\n            container('golang') {\n                stage('Build a Go project') {\n                    sh '''\n                    mkdir -p /go/src/github.com/hashicorp\n                    ln -s `pwd` /go/src/github.com/hashicorp/terraform\n                    cd /go/src/github.com/hashicorp/terraform && make\n                    '''\n                }\n            }\n        }\n\n    }\n}\n```\n\nor\n\n```groovy\npodTemplate(\n  agentContainer: 'maven',\n  agentInjection: true,\n  yaml: '''\n    apiVersion: v1\n    kind: Pod\n    spec:\n      containers:\n      - name: maven\n        image: maven:3.9.9-eclipse-temurin-17\n      - name: golang\n        image: golang:1.16.5\n        command:\n        - sleep\n        args:\n        - 99d\n''') {\n  node(POD_LABEL) {\n    stage('Get a Maven project') {\n      git 'https://github.com/jenkinsci/kubernetes-plugin.git'\n      container('maven') {\n        stage('Build a Maven project') {\n          sh 'mvn -B -ntp clean install'\n        }\n      }\n    }\n\n    stage('Get a Golang project') {\n      git url: 'https://github.com/hashicorp/terraform-provider-google.git', branch: 'main'\n      container('golang') {\n        stage('Build a Go project') {\n          sh '''\n            mkdir -p /go/src/github.com/hashicorp\n            ln -s `pwd` /go/src/github.com/hashicorp/terraform\n            cd /go/src/github.com/hashicorp/terraform && make\n          '''\n        }\n      }\n    }\n  }\n}\n```\n\n#### `POD_CONTAINER` variable\n\nThe variable `POD_CONTAINER` contains the name of the container in the current context.\nIt is defined only within a `container` block.\n\n```groovy\npodTemplate(containers: [â€¦]) {\n  node(POD_LABEL) {\n    stage('Run shell') {\n      container('mycontainer') {\n        sh \"echo hello from $POD_CONTAINER\" // displays 'hello from mycontainer'\n      }\n    }\n  }\n}\n```\n\n### Retrying after infrastructure outages\n\nYou can use the `retry` step to automatically try the whole build stage again with a fresh pod in case of fatal infrastructure problems.\n(For example: cluster backup & restore; node pool used for agents drained and upgraded.)\n\n```groovy\npodTemplate(â€¦) {\n  retry(count: 2, conditions: [kubernetesAgent(), nonresumable()]) {\n    node(POD_LABEL) {\n      sh 'your-build-process'\n    }\n  }\n}\n```\n\nwill rerun the whole `node` block (using the same pod definition) in case the first attempt fails for a qualifying reason traceable to loss of the pod\n(_not_ routine problems such as compilation errors or `OutOfMemoryError`).\n\nFor Declarative Pipeline, just add the `retries` option, as shown below.\n\n# Configuration reference\n## Pod template\n\nPod templates are used to create agents. They can be either configured via the user interface, or in a pipeline, using\nthe `podTemplate` step.\nEither way it provides access to the following fields:\n\n* **cloud** The name of the cloud as defined in Jenkins settings. Defaults to `kubernetes`\n* **name** The name of the pod. This is only used for inheritance.\n* **namespace** The namespace of the pod.\n* **label** The node label. This is how the pod template can be referred to when asking for an agent through the `node` step. In a pipeline, it is recommended to omit this field and rely on the generated label that can be referred to using the `POD_LABEL` variable defined within the `podTemplate` block.\n* **yaml** [yaml representation of the Pod](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/), to allow setting any values not supported as fields\n* **yamlMergeStrategy** `merge()` or `override()`. Controls whether the yaml definition overrides or is merged with the yaml definition inherited from pod templates declared with `inheritFrom`. Defaults to `override()` (for backward compatibility reasons).\n* **containers** The container templates part of the pod *(see below for details)*.\n* **serviceAccount** The service account of the pod.\n* **nodeSelector** The node selector of the pod.\n* **nodeUsageMode** Either `NORMAL` or `EXCLUSIVE`, this controls whether Jenkins only schedules jobs with label expressions matching or use the node as much as possible.\n* **volumes** Volumes that are defined for the pod and are mounted by **ALL** containers.\n  * `configMapVolume` : a read only volume that is mounted from a ConfigMap.\n  * `dynamicPVC()` : a persistent volume claim managed dynamically. It is deleted at the same time as the pod.\n  * `emptyDirVolume` (default): an empty dir allocated on the host machine\n  * `hostPathVolume()` : a host path volume\n  * `nfsVolume()` : a nfs volume\n  * `persistentVolumeClaim()` : an existing persistent volume claim by name.\n  * `secretVolume` : a read only volume that is mounted from a Kubernetes secret.\n* **envVars** Environment variables that are applied to **ALL** containers.\n    * **envVar** An environment variable whose value is defined inline.\n    * **secretEnvVar** An environment variable whose value is derived from a Kubernetes secret.\n* **imagePullSecrets** List of pull secret names, to [pull images from a private Docker registry](https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/).\n* **annotations** Annotations to apply to the pod.\n* **inheritFrom** List of one or more pod templates to inherit from *(more details below)*.\n* **slaveConnectTimeout** Timeout in seconds for an agent to be online *(more details below)*.\n* **podRetention** Controls the behavior of keeping agent pods. Can be 'never()', 'onFailure()', 'always()', or 'default()' - if empty will default to deleting the pod after `activeDeadlineSeconds` has passed.\n* **activeDeadlineSeconds** If `podRetention` is set to `never()` or `onFailure()`, the pod is deleted after this deadline is passed.\n* **idleMinutes** Allows the pod to remain active for reuse until the configured number of minutes has passed since the last step was executed on it.\n* **showRawYaml** Enable or disable the output of the raw pod manifest. Defaults to `true`\n* **runAsUser** The user ID to run all containers in the pod as.\n* **runAsGroup** The group ID to run all containers in the pod as. \n* **hostNetwork** Use the hosts network.\n* **workspaceVolume** The type of volume to use for the workspace.\n  * `dynamicPVC()` : a persistent volume claim managed dynamically. It is deleted at the same time as the pod.\n  * `emptyDirWorkspaceVolume` (default): an empty dir allocated on the host machine\n  * `hostPathWorkspaceVolume()` : a host path volume\n  * `nfsWorkspaceVolume()` : a nfs volume\n  * `persistentVolumeClaimWorkspaceVolume()` : an existing persistent volume claim by name.\n\n## Container template\n\nContainer templates are part of pod. They can be configured via the user interface or in a pipeline and allow you to set the following fields:\n\n* **name** The name of the container.\n* **image** The image of the container.\n* **envVars** Environment variables that are applied to the container **(supplementing and overriding env vars that are set on pod level)**.\n    * **envVar** An environment variable whose value is defined inline.\n    * **secretEnvVar** An environment variable whose value is derived from a Kubernetes secret.\n* **command** The command the container will execute. Will overwrite the Docker entrypoint. A typical value is `sleep`.\n* **args** The arguments passed to the command. A typical value is `99999999`.\n* **ttyEnabled** Flag to mark that tty should be enabled.\n* **livenessProbe** Parameters to be added to a exec liveness probe in the container (does not support httpGet liveness probes)\n* **ports** Expose ports on the container.\n* **alwaysPullImage** The container will pull the image upon starting.\n* **runAsUser** The user ID to run the container as.\n* **runAsGroup** The group ID to run the container as.\n\n#### Specifying a different default agent connection timeout\n\nBy default, the agent connection timeout is set to 1000 seconds. It can be customized using a system property. Please refer to the section below.\n\n#### Using yaml to define Pod Templates\n\nIn order to support any possible value in Kubernetes `Pod` object, we can pass a yaml snippet that will be used as a base\nfor the template. If any other properties are set outside the YAML, they will take precedence.\n\n```groovy\npodTemplate(yaml: '''\n    apiVersion: v1\n    kind: Pod\n    metadata:\n      labels: \n        some-label: some-label-value\n    spec:\n      containers:\n      - name: busybox\n        image: busybox\n        command:\n        - sleep\n        args:\n        - 99d\n    ''') {\n    node(POD_LABEL) {\n      container('busybox') {\n        echo POD_CONTAINER // displays 'busybox'\n        sh 'hostname'\n      }\n    }\n}\n```\n\nYou can use [`readFile`](https://www.jenkins.io/doc/pipeline/steps/workflow-basic-steps/#readfile-read-file-from-workspace) or [`readTrusted`](https://jenkins.io/doc/pipeline/steps/coding-webhook/#readtrusted-read-trusted-file-from-scm) steps to load the yaml from a file.\nAlso note that in declarative pipelines the `yamlFile` can be used (see this [example](examples/declarative_from_yaml_file)).\n\n##### Example\n\n`pod.yaml`\n```yaml\napiVersion: v1\nkind: Pod\nspec:\n  containers:\n  - name: maven\n    image: maven:3.9.9-eclipse-temurin-17\n    command:\n    - sleep\n    args:\n    - 99d\n  - name: golang\n    image: golang:1.16.5\n    command:\n    - sleep\n    args:\n    - 99d\n```\n\n`Jenkinsfile`\n```groovy\npodTemplate(yaml: readTrusted('pod.yaml')) {\n  node(POD_LABEL) {\n    // ...\n  }\n}\n```\n\n### Liveness Probe Usage\n```groovy\ncontainerTemplate(name: 'busybox', image: 'busybox', command: 'sleep', args: '99d',\n                  livenessProbe: containerLivenessProbe(execArgs: 'some --command', initialDelaySeconds: 30, timeoutSeconds: 1, failureThreshold: 3, periodSeconds: 10, successThreshold: 1)\n)\n```\nSee [Defining a liveness command](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#defining-a-liveness-command) for more details.\n\n# Inheritance\n\n## Overview\n\nA pod template may or may not inherit from an existing template.\n\nDepending on fields, the inheritance behaviour can vary. For simple values (strings), the child template will override the parent template. However for complex values (lists, maps), the child template will merge with the parent template.\n\n* **yaml** is merged according to the value of `yamlMergeStrategy` specified in the child pod template.\n* **Service account** and **Node selector** when are overridden completely substitute any possible value found on the 'parent'.\n* **Container templates** that are added to the podTemplate, that has a matching containerTemplate (a container template\nwith the same name) in the 'parent' template, will inherit the configuration of the parent containerTemplate.\nIf no matching container template is found, the template is added as is.\n* **Volume** inheritance works exactly as **Container templates**.\n* **Image Pull Secrets** are combined (all secrets defined both on 'parent' and 'current' template are used).\n\nIn the example below, we will inherit from a pod template we created previously, and will just override the version of\n`maven` so that it uses Java 21 instead:\n\n![image](images/mypod-1-general.png)\n![image](images/mypod-2-golang.png)\n![image](images/mypod-3-maven.png)\n\n```groovy\npodTemplate(inheritFrom: 'mypod', containers: [\n    containerTemplate(name: 'maven', image: 'maven:3.9.9-eclipse-temurin-21')\n  ]) {\n  node(POD_LABEL) {\n    â€¦\n  }\n}\n```\n\nOr in declarative pipeline\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      inheritFrom 'mypod'\n      yaml '''\n      spec:\n        containers:\n        - name: maven\n          image: maven:3.9.9-eclipse-temurin-21\n'''\n      â€¦\n    }\n  }\n  stages {\n    â€¦\n  }\n}\n```\n\nNote that we only need to specify the things that are different. So, `command` and `arguments` are not specified, as\nthey are inherited.\nAlso, the `golang` container will be added as defined in the 'parent' template.\n\n## Multiple Pod template inheritance\n\nField `inheritFrom` may refer a single pod template or multiple separated by space. In the later case each template will\nbe processed in the order they appear in the list *(later items overriding earlier ones)*.\nIn any case if the referenced template is not found it will be ignored.\n\n\n## Nesting Pod templates\n\nField `inheritFrom` provides an easy way to compose pod templates that have been pre-configured. In many cases it would\nbe useful to define and compose pod templates directly in the pipeline using groovy.\nThis is made possible via nesting. You can nest multiple pod templates together in order to compose a single one.\n\nThe example below composes two different pod templates in order to create one with maven and docker capabilities.\n\n```groovy\npodTemplate(containers: [containerTemplate(image: 'docker', name: 'docker', command: 'sleep', args: '99d')]) {\n    podTemplate(containers: [containerTemplate(image: 'maven', name: 'maven', command: 'sleep', args: '99d')]) {\n      node(POD_LABEL) { // gets a pod with both docker and maven\n        â€¦\n      }\n    }\n}\n```\n\nThis feature is extra useful, pipeline library developers as it allows you to wrap pod templates into functions and let\nusers nest those functions according to their needs.\n\nFor example one could create functions for their podTemplates and import them for use.\nSay here's our file `src/com/foo/utils/PodTemplates.groovy`:\n```groovy\npackage com.foo.utils\n\npublic void dockerTemplate(body) {\n  podTemplate(\n        containers: [containerTemplate(name: 'docker', image: 'docker', command: 'sleep', args: '99d')],\n        volumes: [hostPathVolume(hostPath: '/var/run/docker.sock', mountPath: '/var/run/docker.sock')]) {\n    body.call()\n}\n}\n\npublic void mavenTemplate(body) {\n  podTemplate(\n        containers: [containerTemplate(name: 'maven', image: 'maven', command: 'sleep', args: '99d')],\n        volumes: [secretVolume(secretName: 'maven-settings', mountPath: '/root/.m2'),\n                  persistentVolumeClaim(claimName: 'maven-local-repo', mountPath: '/root/.m2repo')]) {\n    body.call()\n}\n}\n\nreturn this\n```\n\nThen consumers of the library could just express the need for a maven pod with docker capabilities by combining the two,\nhowever once again, you will need to express the specific container you wish to execute commands in.\nYou can **NOT** omit the `node` statement.\n\nNote that `POD_LABEL` will be the innermost generated label to get a node which has all the outer pods available on the\nnode, as shown in this example:\n\n```groovy\nimport com.foo.utils.PodTemplates\n\npodTemplates = new PodTemplates()\n\npodTemplates.dockerTemplate {\n  podTemplates.mavenTemplate {\n    node(POD_LABEL) {\n      container('docker') {\n        sh \"echo hello from $POD_CONTAINER\" // displays 'hello from docker'\n      }\n      container('maven') {\n        sh \"echo hello from $POD_CONTAINER\" // displays 'hello from maven'\n      }\n     }\n  }\n}\n```\n\nIn scripted pipelines, there are cases where this implicit inheritance via nested declaration is not wanted or another\nexplicit inheritance is preferred.\nIn this case, use `inheritFrom ''` to remove any inheritance, or `inheritFrom 'otherParent'` to override it.\n\n# Declarative Pipeline\n\nDeclarative agents can be defined from yaml\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      yaml '''\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          labels:\n            some-label: some-label-value\n        spec:\n          containers:\n          - name: maven\n            image: maven:3.9.9-eclipse-temurin-17\n            command:\n            - cat\n            tty: true\n          - name: busybox\n            image: busybox\n            command:\n            - cat\n            tty: true\n        '''\n      retries 2\n    }\n  }\n  stages {\n    stage('Run maven') {\n      steps {\n        container('maven') {\n          sh 'mvn -version'\n        }\n        container('busybox') {\n          sh '/bin/busybox'\n        }\n      }\n    }\n  }\n}\n```\n\nor using `yamlFile` to keep the pod template in a separate `KubernetesPod.yaml` file\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      yamlFile 'KubernetesPod.yaml'\n      retries 2\n    }\n  }\n  stages {\n    â€¦\n  }\n}\n```\n\nNote that it was previously possible to define `containerTemplate` but that has been deprecated in favor of the yaml format.\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      //cloud 'kubernetes'\n      containerTemplate {\n        name 'maven'\n        image 'maven:3.9.9-eclipse-temurin-17'\n        command 'sleep'\n        args '99d'\n      }\n    }\n  }\n  stages {\n    â€¦\n  }\n}\n```\n\nRun steps within a container by default. Steps will be nested within an implicit `container(name) {...}` block instead\nof being executed in the agent container.\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      defaultContainer 'maven'\n      yamlFile 'KubernetesPod.yaml'\n    }\n  }\n\n  stages {\n    stage('Run maven') {\n      steps {\n        sh 'mvn -version'\n      }\n    }\n  }\n}\n```\n\nRun the Pipeline or individual stage within a custom workspace - not required unless explicitly stated.\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      customWorkspace 'some/other/path'\n      defaultContainer 'maven'\n      yamlFile 'KubernetesPod.yaml'\n    }\n  }\n\n  stages {\n    stage('Run maven') {\n      steps {\n        sh 'mvn -version'\n        sh \"echo Workspace dir is ${pwd()}\"\n      }\n    }\n  }\n}\n```\n\n## Default inheritance\nUnlike scripted k8s template, declarative templates do not inherit from parent template.\nSince the agents declared at stage level can override a global agent, implicit inheritance was leading to confusion.\n\nYou need to explicitly declare the inheritance if necessary using the field `inheritFrom`.\n\nIn the following example, `nested-pod` will only contain the `maven` container.\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      yaml '''\n        spec:\n        containers:\n        - name: golang\n            image: golang:1.16.5\n            command:\n            - sleep\n            args:\n            - 99d\n        '''\n    }\n  }\n  stages {\n    stage('Run maven') {\n        agent {\n            kubernetes {\n                yaml '''\n                    spec:\n                    containers:\n                    - name: maven\n                      image: maven:3.9.9-eclipse-temurin-17\n                      command:\n                      - sleep\n                      args:\n                      - 99d\n                    '''\n            }\n        }\n      steps {\n        â€¦\n      }\n    }\n  }\n}\n\n```\n\n# Misc.\n\n## Accessing container logs from the pipeline\n\nIf you use the `containerTemplate` to run some service in the background\n(e.g. a database for your integration tests), you might want to access its log from the pipeline.\nThis can be done with the `containerLog` step, which prints the log of the\nrequested container to the build log.\n\n#### Required Parameters\n* **name** the name of the container to get logs from, as defined in `podTemplate`. Parameter name\ncan be omitted in simple usage:\n\n```groovy\ncontainerLog 'mongodb'\n```\n\n#### Optional Parameters\n* **returnLog** return the log instead of printing it to the build log (default: `false`)\n* **tailingLines** only return the last n lines of the log (optional)\n* **sinceSeconds** only return the last n seconds of the log (optional)\n* **limitBytes** limit output to n bytes (from the beginning of the log, not exact).\n\nAlso see the online help and [examples/containerLog.groovy](examples/containerLog.groovy).\n\n# Features controlled using system properties\n\nPlease read [Features controlled by system properties](https://www.jenkins.io/doc/book/managing/system-properties/) page to know how to set up system properties within Jenkins.\n\n* `KUBERNETES_JENKINS_URL` : Jenkins URL to be used by agents. This is meant to be used for OEM integration.\n* `io.jenkins.plugins.kubernetes.disableNoDelayProvisioning` (since 1.19.1) Whether to disable the no-delay provisioning strategy the plugin uses (defaults to `false`).\n* `io.jenkins.plugins.kubernetes.NoDelayProvisionerStrategy.disableCloudShuffle` Whether to disable the shuffling of clouds. When true clouds will be searched in order they are defined (defaults to `false`).\n* `jenkins.host.address` : (for unit tests) controls the host agents should use to contact Jenkins\n* `org.csanchez.jenkins.plugins.kubernetes.PodTemplate.connectionTimeout` : The time in seconds to wait before considering the pod scheduling has failed (defaults to `1000`)\n* `org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator.stdinBufferSize` : stdin buffer size in bytes for commands sent to Kubernetes exec api. A low value will cause slowness in commands executed. A higher value will consume more memory (defaults to `16*1024`)\n* `org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator.websocketConnectionTimeout` : Time to wait for the websocket used by `container` step to connect (defaults to `30`)\n\n# Running on OpenShift\n\n## Random UID problem\n\nOpenShift runs containers using a _random_ UID that is overriding what is specified in Docker images.\nFor this reason, you may end up with the following warning in your build\n\n```\n[WARNING] HOME is set to / in the agent container. You may encounter troubles when using tools or ssh client. This usually happens if the uid doesnt have any entry in /etc/passwd. Please add a user to your Dockerfile or set the HOME environment variable to a valid directory in the pod template definition.\n```\n\nAt the moment the jenkinsci agent image is not built for OpenShift and will issue this warning.\n\nThis issue can be circumvented in various ways:\n* build a docker image for OpenShift in order to behave when running using an arbitrary uid.\n* override HOME environment variable in the pod spec to use `/home/jenkins` and mount a volume to `/home/jenkins` to ensure the user running the container can write to it\n\nSee this [example](examples/openshift-home-yaml.groovy) configuration.\n\n## Running with OpenShift 3\n\nOpenShift 3 is based on an older version of Kubernetes, which is not anymore directly supported since Kubernetes plugin version 1.26.0.\n\nTo get agents working for Openshift 3, add this `Node Selector` to your Pod Templates:\n```\nbeta.kubernetes.io/os=linux\n```\n\n# Windows support\n\nYou can run pods on Windows if your cluster has Windows nodes.\nSee the [example](src/main/resources/org/csanchez/jenkins/plugins/kubernetes/pipeline/samples/windows.groovy).\n\n# Configuration on minikube\n\nCreate and start [minikube](https://github.com/kubernetes/minikube)\n\nThe client certificate needs to be converted to PKCS, will need a password\n\n    openssl pkcs12 -export -out ~/.minikube/minikube.pfx -inkey ~/.minikube/apiserver.key -in ~/.minikube/apiserver.crt -certfile ~/.minikube/ca.crt -passout pass:secret\n\nValidate that the certificates work\n\n    curl --cacert ~/.minikube/ca.crt --cert ~/.minikube/minikube.pfx:secret --cert-type P12 https://$(minikube ip):8443\n\nAdd a Jenkins credential of type certificate, upload it from `~/.minikube/minikube.pfx`, password `secret`\n\nFill *Kubernetes server certificate key* with the contents of `~/.minikube/ca.crt`\n\n\n# Configuration on Google Container Engine\n\nCreate a cluster\n\n    gcloud container clusters create jenkins --num-nodes 1 --machine-type g1-small\n\nand note the admin password and server certificate.\n\nOr use Google Developer Console to create a Container Engine cluster, then run\n\n    gcloud container clusters get-credentials jenkins\n    kubectl config view --raw\n\nthe last command will output kubernetes cluster configuration including API server URL, admin password and root certificate\n\n\n# Troubleshooting\n\nFirst watch if the Jenkins agent pods are started.\nMake sure you are in the correct cluster and namespace.\n\n    kubectl get -a pods --watch\n\nIf they are in a different state than `Running`, use `describe` to get the events\n\n    kubectl describe pods/my-jenkins-agent\n\nIf they are `Running`, use `logs` to get the log output\n\n    kubectl logs -f pods/my-jenkins-agent jnlp\n\nIf pods are not started or for any other error, check the logs on the controller side.\n\nFor more detail, configure a new [Jenkins log recorder](https://wiki.jenkins-ci.org/display/JENKINS/Logging) for\n`org.csanchez.jenkins.plugins.kubernetes` at `ALL` level.\n\nTo inspect the json messages sent back and forth to the Kubernetes API server you can configure\na new [Jenkins log recorder](https://wiki.jenkins-ci.org/display/JENKINS/Logging) for `okhttp3`\nat `DEBUG` level.\n\n## Deleting pods in bad state\n\n    kubectl get pods -o name --selector=jenkins=slave --all-namespaces  | xargs -I {} kubectl delete {}\n\n## Pipeline `sh` step hangs when multiple containers are used\nTo debug this you need to set `-Dorg.jenkinsci.plugins.durabletask.BourneShellScript.LAUNCH_DIAGNOSTICS=true` system property\nand then restart the pipeline. Most likely in the console log you will see the following:\n```console\nsh: can't create /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-log.txt: Permission denied\nsh: can't create /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-result.txt.tmp: Permission denied\nmv: can't rename '/home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-result.txt.tmp': No such file or directory\ntouch: /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-log.txt: Permission denied\ntouch: /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-log.txt: Permission denied\ntouch: /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-log.txt: Permission denied\n```\nUsually this happens when UID of the user in agent container differs from the one in another container(s). \nAll containers you use should have the same UID of the user, also this can be achieved by setting `securityContext`:\n```yaml\napiVersion: v1\nkind: Pod\nspec:\n  securityContext:\n    runAsUser: 1000 # default UID of jenkins user in agent image\n  containers:\n  - name: maven\n    image: maven:3.9.9-eclipse-temurin-17\n    command:\n    - cat\n    tty: true\n```\n\n## Using WebSockets with a Jenkins controller with self-signed HTTPS certificate\n\nUsing WebSockets is the easiest and recommended way to establish the connection between agents and a Jenkins controller running outside the cluster.\nHowever, if your Jenkins controller has HTTPS configured with self-signed certificate, you'll need to make sure the agent container trusts the CA.\nTo do that, you can extend the `jenkins/inbound-agent` image and add your certificate as follows:\n\n```Dockerfile\nFROM jenkins/inbound-agent\n\nUSER root\n\nADD cert.pem /tmp/cert.pem\n\nRUN keytool -noprompt -storepass changeit -cacerts \\\n  -import -file /tmp/cert.pem -alias jenkinsMaster && \\\n  rm -f /tmp/cert.pem\n\nUSER jenkins\n```\n\nThen, use it as the agent container for the pod template as usual. No command or args need to be specified.\n\n> **Notes:**\n>\n> * Support for using WebSockets with JDK 11 was added in the Remoting v4.11, so make sure your base image is new enough. See [here](https://issues.jenkins.io/browse/JENKINS-61212) for more information.\n>\n> * When using the WebSocket mode, the `-disableHttpsCertValidation` on the `jenkins/inbound-agent` becomes unavailable, as well as `-cert`, and that's why you have to extend the docker image.\n\n## [WARNING] label option is deprecated\n\n```\n[WARNING] label option is deprecated. To use a static pod template, use the 'inheritFrom' option.\n```\n\nYou need to change from something like:\n\n```\nagent {\n\tkubernetes {\n\t\tlabel 'somelabel'\n\t}\n}\n```\n\nTo something like:\n\n```\nagent {\n\tkubernetes {\n\t\tinheritFrom 'somelabel'\n\t}\n}\n```\n\n\n# Building and Testing\n\nIntegration tests will use the currently configured context auto-detected from kube config file or service account.\n\n## Manual Testing\n\nRun `mvn clean install` and copy `target/kubernetes.hpi` to Jenkins plugins folder.\n\n## Running Kubernetes Integration Tests\n\nSet up your `$KUBECONFIG` however you like, for example\n\n```bash\nkind create cluster\n```\n\nthen\n\n```bash\nkubectl krew install tunnel # as needed; install Krew first\nkubectl tunnel expose jenkins 8000:8000 8001:8001 &\nmvn test -Djenkins.host.address=jenkins.default -Dport=8000 -DslaveAgentPort=8001 -Dtest=KubernetesPipelineTest#runInPod\n```\n\nAlternately, you can run everything like in CI:\n\n```bash\nexport KIND_PRELOAD=true # optionally\n./kind.sh -Dtest=KubernetesPipelineTest#runInPod\n```\n\nYou can also run interactively after setting up the tunnel:\n\n```bash\nmvn hpi:run -Djenkins.host.address=jenkins.default -Dport=8000 -Djenkins.model.Jenkins.slaveAgentPort=8001\n```\n\n# Docker image\n\nDocker image for Jenkins, with plugin installed.\nBased on the [official image](https://hub.docker.com/r/jenkins/jenkins/).\n\n## Running the Docker image\n\n```bash\ndocker run --rm --name jenkins -p 8080:8080 -p 50000:50000 -v /var/jenkins_home csanchez/jenkins-kubernetes\n```\n\n\n# Running in Kubernetes\n\nThe example configuration will create a stateful set running Jenkins with persistent volume\nand using a service account to authenticate to Kubernetes API.\n\n## Running locally with minikube\n\nA local testing cluster with one node can be created with [minikube](https://github.com/kubernetes/minikube)\n\n```bash\nminikube start\n```\n\nYou may need to set the correct permissions for host mounted volumes\n\n```bash\nminikube ssh\nsudo chown 1000:1000 /tmp/hostpath-provisioner/pvc-*\n```\n\nThen create the Jenkins namespace, controller and Service with\n\n```bash\nkubectl create namespace kubernetes-plugin\nkubectl config set-context $(kubectl config current-context) --namespace=kubernetes-plugin\nkubectl create -f src/main/kubernetes/service-account.yml\nkubectl create -f src/main/kubernetes/jenkins.yml\n```\n\nGet the url to connect to with\n\n```bash\nminikube service jenkins --namespace kubernetes-plugin --url\n```\n\n## Running in Google Container Engine GKE\n\nAssuming you created a Kubernetes cluster named `jenkins` this is how to run both Jenkins and agents there.\n\nCreating all the elements and setting the default namespace\n\n```bash\nkubectl create namespace kubernetes-plugin\nkubectl config set-context $(kubectl config current-context) --namespace=kubernetes-plugin\nkubectl create -f src/main/kubernetes/service-account.yml\nkubectl create -f src/main/kubernetes/jenkins.yml\n```\n\nConnect to the ip of the network load balancer created by Kubernetes, port 80.\nGet the ip (in this case `104.197.19.100`) with `kubectl describe services/jenkins`\n(it may take a bit to populate)\n\n    $ kubectl describe services/jenkins\n    Name:           jenkins\n    Namespace:      default\n    Labels:         <none>\n    Selector:       name=jenkins\n    Type:           LoadBalancer\n    IP:         10.175.244.232\n    LoadBalancer Ingress:   104.197.19.100\n    Port:           http    80/TCP\n    NodePort:       http    30080/TCP\n    Endpoints:      10.172.1.5:8080\n    Port:           agent   50000/TCP\n    NodePort:       agent   32081/TCP\n    Endpoints:      10.172.1.5:50000\n    Session Affinity:   None\n    No events.\n\nUntil Kubernetes 1.4 removes the SNATing of source ips, seems that CSRF (enabled by default in Jenkins 2)\nneeds to be configured to avoid `WARNING: No valid crumb was included in request` errors.\nThis can be done checking _Enable proxy compatibility_ under Manage Jenkins -> Configure Global Security\n\nConfigure Jenkins, adding the `Kubernetes` cloud under configuration, setting\nKubernetes URL to the container engine cluster endpoint or simply `https://kubernetes.default.svc.cluster.local`.\nUnder credentials, click `Add` and select `Kubernetes Service Account`,\nor alternatively use the Kubernetes API username and password. Select 'Certificate' as credentials type if the\nkubernetes cluster is configured to use client certificates for authentication.\n\nUsing `Kubernetes Service Account` will cause the plugin to use the default token mounted inside the Jenkins pod. See [Configure Service Accounts for Pods](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/) for more information.\n\n![image](credentials.png)\n\nYou may want to set `Jenkins URL` to the internal service IP, `http://10.175.244.232` in this case,\nto connect through the internal network.\n\nSet `Container Cap` to a reasonable number for tests, i.e. 3.\n\nAdd an image with\n\n* Docker image: `jenkins/inbound-agent`\n* Jenkins agent root directory: `/home/jenkins/agent`\n\n![image](configuration.png)\n\nNow it is ready to be used.\n\nTearing it down\n\n```bash\nkubectl delete namespace/kubernetes-plugin\n```\n\n\n## Customizing the deployment\n\n### Modify CPUs and memory request/limits (Kubernetes Resource API)\n\nModify file `./src/main/kubernetes/jenkins.yml` with desired limits\n\n```yaml\nresources:\n  limits:\n    cpu: 1\n    memory: 1Gi\n  requests:\n    cpu: 0.5\n    memory: 500Mi\n```\n\nNote: the JVM will use the memory `requests` as the heap limit (-Xmx)\n\n## Building\n\n```bash\ndocker build -t csanchez/jenkins-kubernetes .\n```\n \n# Related Projects\n\n* [Kubernetes Pipeline plugin](https://github.com/jenkinsci/kubernetes-pipeline-plugin): pipeline extension to provide native support for using Kubernetes pods, secrets and volumes to perform builds\n* [kubernetes-credentials](https://github.com/jenkinsci/kubernetes-credentials-plugin): Credentials provider that reads Kubernetes secrets\n"
        },
        {
          "name": "README_zh.md",
          "type": "blob",
          "size": 28.3916015625,
          "content": "jenkins-kubernetes-plugin\n=========================\n\nè¿™æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨ Kubernetes é›†ç¾¤ä¸Šè¿è¡ŒåŠ¨æ€èŠ‚ç‚¹çš„ Jenkins æ’ä»¶ã€‚\n\nBased on the [Scaling Docker with Kubernetes](http://www.infoq.com/articles/scaling-docker-with-kubernetes) article,\nautomates the scaling of Jenkins agents running in Kubernetes.\n\nè¯¥æ’ä»¶åœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªåŒ…å« Docker é•œåƒçš„ Kubernetes Podï¼Œå¹¶åœ¨æž„å»ºç»“æŸæ—¶åœæ­¢ã€‚\n\nFor that some environment variables are automatically injected:\nèŠ‚ç‚¹ä½¿ç”¨ JNLP æ¥å¯åŠ¨ï¼Œå¹¶è‡ªåŠ¨è¿žæŽ¥åˆ° Jenkins controller ä¸Šã€‚æœŸé—´ï¼Œä¼šè‡ªåŠ¨æ³¨å…¥ä¸€äº›çŽ¯å¢ƒå˜é‡ï¼š\n\n* `JENKINS_URL`: Jenkins ç•Œé¢åœ°å€\n* `JENKINS_SECRET`: è®¤è¯ç”¨çš„å¯†é’¥\n* `JENKINS_AGENT_NAME`: Jenkins èŠ‚ç‚¹çš„åç§°\n* `JENKINS_NAME`: Jenkins èŠ‚ç‚¹çš„åç§°ï¼ˆå·²åºŸå¼ƒï¼Œä¿æŒå‘åŽå…¼å®¹ï¼‰\n\nä½¿ç”¨é•œåƒ [`jenkins/inbound-agent`](https://hub.docker.com/r/jenkins/inbound-agent) åšçš„æµ‹è¯•ã€‚\næŸ¥çœ‹[Docker é•œåƒæºç ](https://github.com/jenkinsci/docker-agent)ã€‚\n\nJenkins controller å¯ä»¥ä¸åœ¨ Kubernetes ä¸Šè¿è¡Œã€‚\n\n# Kubernetes äº‘é…ç½®\n\nåœ¨ Jenkins è®¾ç½®ä¸­ï¼Œç‚¹å‡»\"æ·»åŠ äº‘\"ï¼Œé€‰æ‹© `Kubernetes` åŽå¡«å†™å¦‚ä¸‹ä¿¡æ¯ï¼š\n_åç§°_ã€_Kubernetes åœ°å€_ã€ _Kubernetes server æœåŠ¡è¯ä¹¦ key_ ç­‰ç­‰ã€‚\n\nå¦‚æžœæ²¡æœ‰è®¾ç½® _Kubernetes åœ°å€_ï¼Œè¿žæŽ¥é€‰é¡¹ä¼šè‡ªåŠ¨ä»Ž `Service Account` æˆ– `kube config` æ–‡ä»¶ä¸­è¯»å–ã€‚\n\nåœ¨ Kubernetes å¤–è¿è¡Œçš„ Jenkins controller è¯ï¼Œåˆ™éœ€è¦è®¾ç½®å‡­æ®ã€‚å‡­æ®çš„å€¼å°±æ˜¯ä½ ä¸º Jenkins åœ¨é›†ç¾¤ä¸­åˆ›å»º\nçš„ `Service Account` çš„ `Token`ï¼ŒèŠ‚ç‚¹è¿è¡Œæ—¶ä¹Ÿä¼šä½¿ç”¨ã€‚\n\n### é™åˆ¶å“ªäº›ä»»åŠ¡å¯ä»¥ä½¿ç”¨ä½ é…ç½®çš„äº‘\n\n\"äº‘\"å¯ä»¥é…ç½®ä¸ºåªè¿è¡Œç‰¹å®šçš„ä»»åŠ¡æ¥ä½¿ç”¨ã€‚\n\nè¦ä½¿ç”¨è¯¥ç‰¹æ€§çš„è¯ï¼Œåœ¨ä½ çš„äº‘çš„é«˜çº§é…ç½®ä¸­å‹¾é€‰ `Restrict pipeline support to authorized folders` ã€‚\nå¯¹è¦ä½¿ç”¨è¯¥äº‘é…ç½®çš„ä»»åŠ¡ï¼Œéœ€è¦åœ¨å¯¹åº”çš„æ–‡ä»¶å¤¹é…ç½®ä¸­æ·»åŠ ã€‚\n\n# æµæ°´çº¿æ”¯æŒ\n\nåœ¨å¯ä»¥æµæ°´çº¿ä¸­å®šä¹‰èŠ‚ç‚¹å¹¶ä½¿ç”¨ï¼Œç„¶è€Œï¼Œé»˜è®¤çš„æ‰§è¡ŒçŽ¯å¢ƒæ€»ä¼šæ˜¯ `jnlp` å®¹å™¨ã€‚ä½ éœ€è¦æ ¹æ®æƒ…å†µæŒ‡å®šå®¹å™¨ã€‚\n\nè¿™ä¼šè¿è¡Œåœ¨ `jnlp` å®¹å™¨ä¸­\n\n```groovy\n// this guarantees the node will use this template\ndef label = \"mypod-${UUID.randomUUID().toString()}\"\npodTemplate(label: label) {\n    node(label) {\n        stage('Run shell') {\n            sh 'echo hello world'\n        }\n    }\n}\n```\n\nè¿™ä¼šè¿è¡Œåœ¨æŒ‡å®šçš„å®¹å™¨ä¸­\n\n```groovy\ndef label = \"mypod-${UUID.randomUUID().toString()}\"\npodTemplate(label: label) {\n  node(label) {\n    stage('Run shell') {\n      container('mycontainer') {\n        sh 'echo hello world'\n      }\n    }\n  }\n}\n```\n\nåœ¨[examples ç›®å½•](examples)ä¸­å¯ä»¥æ‰¾åˆ°æ›´å¤šçš„ä¾‹å­ã€‚\n\nå¯ä»¥åœ¨æ¨¡æ¿ä¸­è‡ªå®šä¹‰ `jnlp` èŠ‚ç‚¹é•œåƒ\n\n```groovy\ncontainerTemplate(name: 'jnlp', image: 'jenkins/inbound-agent', args: '${computer.jnlpmac} ${computer.name}'),\n```\n\næˆ–è€…ä½¿ç”¨ `yaml` è¯­æ³•\n\n```yaml\napiVersion: v1\nkind: Pod\nspec:\n  containers:\n  - name: jnlp\n    image: 'jenkins/inbound-agent'\n    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n```\n\n### å®¹å™¨ç»„æ”¯æŒ\n\nå¯ä»¥åœ¨ `agent pod` ä¸­å®šä¹‰å¤šä¸ªå®¹å™¨ï¼Œå¹¶å…±äº«ç±»ä¼¼æŒ‚è½½ç‚¹çš„èµ„æºã€‚æ¯ä¸ªå®¹å™¨ä¸­çš„ç«¯å£éƒ½å¯ä»¥é€šè¿‡ `localhost` è®¿é—®ã€‚\n\né€šè¿‡ `container` æŒ‡ä»¤å¯ä»¥ç›´æŽ¥åœ¨æ¯ä¸ªå®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ã€‚è¯¥ç‰¹æ€§ä»ç„¶è¿˜æœ‰ä¸€äº›å¹¶å‘æ‰§è¡Œå’Œæµæ°´çº¿æ¢å¤çš„é—®é¢˜ï¼Œå› æ­¤è¿˜å¤„äºŽ **ALPHA** çŠ¶æ€ã€‚\n\n```groovy\ndef label = \"mypod-${UUID.randomUUID().toString()}\"\npodTemplate(label: label, containers: [\n    containerTemplate(name: 'maven', image: 'maven:3.3.9-jdk-8-alpine', ttyEnabled: true, command: 'cat'),\n    containerTemplate(name: 'golang', image: 'golang:1.8.0', ttyEnabled: true, command: 'cat')\n  ]) {\n\n    node(label) {\n        stage('Get a Maven project') {\n            git 'https://github.com/jenkinsci/kubernetes-plugin.git'\n            container('maven') {\n                stage('Build a Maven project') {\n                    sh 'mvn -B clean install'\n                }\n            }\n        }\n\n        stage('Get a Golang project') {\n            git url: 'https://github.com/hashicorp/terraform.git'\n            container('golang') {\n                stage('Build a Go project') {\n                    sh \"\"\"\n                    mkdir -p /go/src/github.com/hashicorp\n                    ln -s `pwd` /go/src/github.com/hashicorp/terraform\n                    cd /go/src/github.com/hashicorp/terraform && make core-dev\n                    \"\"\"\n                }\n            }\n        }\n\n    }\n}\n```\n\n### Pod å’Œå®¹å™¨æ¨¡æ¿é…ç½®\n\n`podTemplate` æ˜¯ `pod` çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œç”¨äºŽåˆ›å»ºèŠ‚ç‚¹ã€‚å®ƒå¯ä»¥é€šè¿‡ç”¨æˆ·ç•Œé¢æˆ–è€…æµæ°´çº¿æ¥é…ç½®ã€‚\nä¸ç®¡å“ªç§æ–¹å¼ï¼Œéƒ½æä¾›äº†å¦‚ä¸‹çš„å­—æ®µï¼š\n\n* **cloud** åœ¨ Jenkins è®¾ç½®ä¸­é…ç½®çš„äº‘çš„åç§°ã€‚é»˜è®¤ä¸º `kubernetes`\n* **name** pod çš„åç§°\n* **namespace** pod çš„å‘½åç©ºé—´\n* **label** pod çš„æ ‡ç­¾ã€‚ä¸ºäº†é¿å…åœ¨å¤šä¸ªæž„å»ºä¸­å†²çªï¼Œæœ€å¥½è®¾ç½®ä¸€ä¸ªå”¯ä¸€å€¼\n* **yaml** [Pod çš„ yaml å½¢å¼](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.10/#pod-v1-core)å…è®¸è®¾ç½®ä»»ä½•å€¼ï¼ˆå³ä½¿å½“å‰å­—æ®µåˆ—è¡¨ä¸­ä¸å­˜åœ¨çš„ï¼‰\n* **containers** å®¹å™¨æ¨¡æ¿ï¼Œç”¨äºŽåˆ›å»º pod ä¸­çš„å®¹å™¨ *(å¦‚ä¸‹æ‰€ç¤º)*.\n* **serviceAccount** pod çš„ service account\n* **nodeSelector** node çš„èŠ‚ç‚¹é€‰æ‹©å™¨\n* **nodeUsageMode** \"æ­£å¸¸\"æˆ–è€…\"ç‹¬å \"ï¼Œè¿™ä¼šå†³å®š Jenkins æ˜¯å¦åªè°ƒåº¦ä¸Žæ ‡ç­¾è¡¨è¾¾å¼åŒ¹é…çš„ä»»åŠ¡æˆ–å°½å¯èƒ½åœ°ä½¿ç”¨èŠ‚ç‚¹\n* **volumes** å®šä¹‰åœ¨ pod ä¸­çš„å·ï¼Œå¹¶ä¼šæŒ‚è½½åˆ° **æ‰€æœ‰** å®¹å™¨\n* **envVars** çŽ¯å¢ƒå˜é‡ï¼Œä¼šåº”ç”¨åˆ° **æ‰€æœ‰** å®¹å™¨\n    * **envVar** ç›´æŽ¥å®šä¹‰çš„çŽ¯å¢ƒå˜é‡\n    * **secretEnvVar** å€¼æ¥è‡ªäºŽ Kubernetes ä¸­çš„ secret\n* **imagePullSecrets** [ä»Žç§æœ‰ Docker registry ä¸Šæ‹‰å–é•œåƒ](https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/)æ—¶ä½¿ç”¨çš„å‡­æ®åç§°åˆ—è¡¨\n* **annotations** åº”ç”¨åˆ° pod ä¸Šçš„æ³¨è§£\n* **inheritFrom** è¦ç»§æ‰¿çš„ä¸€ä¸ªæˆ–å¤šä¸ª pod æ¨¡æ¿ *(è¯¦æƒ…å‚è§ä¸‹æ–‡)*.\n* **slaveConnectTimeout** èŠ‚ç‚¹ä¸Šçº¿æ—¶çš„è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰*(è¯¦æƒ…å‚è§ä¸‹æ–‡)*.\n* **podRetention** ç”¨äºŽå†³å®šæ˜¯å¦ä¿ç•™èŠ‚ç‚¹ podã€‚å¯ä»¥æ˜¯ 'never()'ã€ 'onFailure()'ã€ 'always()' æˆ– 'default()'ï¼Œå¦‚æžœä¸ºç©ºçš„è¯ï¼Œè¶…è¿‡ `activeDeadlineSeconds` è®¾å®šçš„æ—¶é—´æ—¶é—´åŽä¼šåˆ é™¤ pod\n* **activeDeadlineSeconds** å¦‚æžœ `podRetention` è®¾ç½®ä¸º 'never()' æˆ– 'onFailure()' çš„è¯ï¼Œåœ¨æ—¶é—´è¶…è¿‡åŽ pod ä¼šè¢«åˆ é™¤\n* **idleMinutes** å…è®¸ pod ä¿æŒæ´»è·ƒä»¥ä¾¿å†æ¬¡ä½¿ç”¨ï¼Œç›´åˆ°æœ€åŽä¸€æ¬¡æ‰§è¡ŒåŽçš„æ—¶é—´è¶…è¿‡é…ç½®çš„åˆ†é’Ÿæ•°\n\n`containerTemplate` æ˜¯å®¹å™¨çš„æ¨¡æ¿ï¼Œä¼šè¢«åŠ åˆ° pod ä¸­ã€‚åŒæ ·åœ°ï¼Œå®ƒçš„é…ç½®å¯ä»¥é€šè¿‡ç”¨æˆ·ç•Œé¢æˆ–æµæ°´çº¿æ¥é…ç½®ï¼Œå­—æ®µåŒ…æ‹¬ï¼š\n\n* **name** å®¹å™¨çš„åç§°\n* **image** å®¹å™¨çš„é•œåƒ\n* **envVars** åº”ç”¨äºŽå®¹å™¨çš„çŽ¯å¢ƒå˜é‡ **(æ˜¯ pod çº§åˆ«çŽ¯å¢ƒå˜é‡çš„è¡¥å……ï¼Œå¹¶ä¼šè¦†ç›–)**.\n    * **envVar** ç›´æŽ¥å®šä¹‰çš„çŽ¯å¢ƒå˜é‡\n    * **secretEnvVar** å€¼æ¥è‡ªäºŽ Kubernetes ä¸­çš„ secret\n* **command** å®¹å™¨å¯åŠ¨æ—¶ä¼šæ‰§è¡Œçš„å‘½ä»¤\n* **args** ä¼ é€’ç»™å¯åŠ¨å‘½ä»¤çš„å‚æ•°\n* **ttyEnabled** æ˜¯å¦å¯ç”¨ `tty` çš„æ ‡è®°\n* **livenessProbe** æ·»åŠ ç»™å®¹å™¨ä¸­çš„å¯æ‰§è¡Œ liveness æŽ¢æµ‹çš„å‚æ•°ï¼ˆä¸æ”¯æŒ httpGet liveness æŽ¢æµ‹ï¼‰\n* **ports** å®¹å™¨ä¸­æš´éœ²çš„ç«¯å£\n\n#### æŒ‡å®šä¸åŒçš„èŠ‚ç‚¹è¿žæŽ¥è¶…æ—¶æ—¶é—´\n\nèŠ‚ç‚¹çš„è¿žæŽ¥è¶…æ—¶æ—¶é—´é»˜è®¤ä¸º100ç§’ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œè¿™æ—¶ä½ å¯ä»¥è®¾ç½®ç³»ç»Ÿå±žæ€§ \n`org.csanchez.jenkins.plugins.kubernetes.PodTemplate.connectionTimeout` ä¸ºä¸åŒçš„å€¼ã€‚\nè¯·é˜…è¯»[ç”±ç³»ç»Ÿå±žæ€§æŽ§åˆ¶çš„ç‰¹æ€§](https://wiki.jenkins.io/display/JENKINS/Features+controlled+by+system+properties)ï¼Œä»¥ä¾¿\näº†è§£å¦‚ä½•åœ¨ Jenkins ä¸­è®¾ç½®ç³»ç»Ÿå±žæ€§ã€‚\n\n#### ä½¿ç”¨ yaml å®šä¹‰ Pod æ¨¡æ¿\n\nä¸ºäº†æ”¯æŒ Kubernetes ä¸­ `Pod` å¯¹è±¡çš„ä»»ä½•å¯èƒ½çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€ä¸ª yaml ç‰‡æ®µï¼Œä½œä¸ºæ¨¡æ¿çš„åŸºç¡€ã€‚ä»»ä½•åœ¨ yaml å¤–éƒ¨è®¾ç½®çš„å±žæ€§çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚\n\n```groovy\ndef label = \"mypod-${UUID.randomUUID().toString()}\"\npodTemplate(label: label, yaml: \"\"\"\napiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    some-label: some-label-value\nspec:\n  containers:\n  - name: busybox\n    image: busybox\n    command:\n    - cat\n    tty: true\n\"\"\"\n) {\n    node (label) {\n      container('busybox') {\n        sh \"hostname\"\n      }\n    }\n}\n```\n\nä½ å¯ä»¥ä½¿ç”¨æ­¥éª¤ [`readFile`](https://jenkins.io/zh/doc/pipeline/steps/workflow-basic-steps/#code-readfile-code-read-file-from-workspace) \næˆ– [`readTrusted`](https://jenkins.io/doc/pipeline/steps/coding-webhook/#readtrusted-read-trusted-file-from-scm) ä»Žæ–‡ä»¶ä¸­åŠ è½½ yaml.\nå®ƒä»Ž Jenkins æŽ§åˆ¶å°çš„æ’ä»¶é…ç½®ç•Œé¢ä¸Šä¹Ÿèƒ½è®¿é—®åˆ°ã€‚\n\n#### å­˜æ´»æ€§æŽ¢æµ‹çš„ä½¿ç”¨\n\n```groovy\ncontainerTemplate(name: 'busybox', image: 'busybox', ttyEnabled: true, command: 'cat',\n    livenessProbe: containerLivenessProbe( execArgs: 'some --command',\n    initialDelaySeconds: 30, timeoutSeconds: 1, failureThreshold: 3, periodSeconds: 10, successThreshold: 1))\n```\n\næŸ¥çœ‹é¡µé¢[å®šä¹‰ä¸€ä¸ªå­˜æ´»æ€§å‘½ä»¤](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#defining-a-liveness-command) äº†è§£æ›´å¤šè¯¦æƒ…ã€‚\n\n### Pod æ¨¡æ¿ç»§æ‰¿\n\n`podTemplate` å¯ä»¥ç»§æ‰¿ä¸€ä¸ªå·²æœ‰çš„æ¨¡æ¿ï¼Œæˆ–è€…ä¸ç»§æ‰¿ã€‚è¿™æ„å‘³ç€ï¼Œ`podTemplate` å°†ä¼šç»§æ‰¿èŠ‚ç‚¹é€‰æ‹©å™¨ã€service accountã€é•œåƒæ‹‰å–å‡­æ®ï¼Œå®¹å™¨æ¨¡æ¿å’Œå·ã€‚\n\n**yaml** æ˜¯ **æ°¸è¿œ** ä¸ä¼šåˆå¹¶çš„ï¼Œå¦‚æžœåœ¨å­ pod æ¨¡æ¿ä¸­å®šä¹‰äº†çš„è¯ï¼Œå°±ä¸ä¼šç”¨çˆ¶æ¨¡æ¿çš„ã€‚\n\n**Service account** å’Œ **èŠ‚ç‚¹é€‰æ‹©å™¨** ä¼šè¦†ç›–çˆ¶æ¨¡æ¿ä¸­çš„å€¼ã€‚\n\n**å®¹å™¨æ¨¡æ¿** å¦‚æžœåŒ¹é…åˆ°äº†çˆ¶æ¨¡æ¿ä¸­åç§°ç›¸åŒåˆ°å®¹å™¨æ¨¡æ¿çš„è¯ï¼Œåˆ™ä¼šç»§æ‰¿çˆ¶çš„é…ç½®ï¼›å¦‚æžœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œå°±ç”¨å½“å‰çš„ã€‚\n\n**å·** ç»§æ‰¿æœºåˆ¶ä¸Ž **å®¹å™¨æ¨¡æ¿** ä¸€è‡´ã€‚\n\n**é•œåƒæ‹‰å–å‡­æ®** æ‰€æœ‰å®šä¹‰åœ¨\"çˆ¶\"å’Œ\"å½“å‰\"æ¨¡æ¿ä¸­çš„å‡­æ®éƒ½ä¼šç”¨åˆ°ã€‚\n\nåœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œä¼šç»§æ‰¿ä¹‹å‰åˆ›å»ºçš„ pod æ¨¡æ¿ï¼Œå¹¶åªæ˜¯è¦†ç›– `maven` çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ jdk-7 :\n\n```groovy\npodTemplate(label: 'anotherpod', inheritFrom: 'mypod',  containers: [\n    containerTemplate(name: 'maven', image: 'maven:3.3.9-jdk-7-alpine')\n  ]) {\n\n      //Let's not repeat ourselves and ommit this part\n}\n```\n\næ³¨æ„ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‡å®šä¸åŒçš„éƒ¨åˆ†ã€‚å› æ­¤ï¼Œä¸éœ€è¦ `ttyEnabled` å’Œ `command`ï¼Œå®ƒä»¬éƒ½ä¼šè¢«ç»§æ‰¿ã€‚åŒæ ·åœ°ï¼Œç”±äºŽçˆ¶æ¨¡æ¿ä¸­æœ‰ `golang` å®¹å™¨ï¼Œæ‰€ä»¥ä¹Ÿä¼šè¢«æ·»åŠ ã€‚\n\n#### Pod æ¨¡æ¿å¤šé‡ç»§æ‰¿\n\nå­—æ®µ `inheritFrom` å¯ä»¥å¼•ç”¨å•ä¸ªæˆ–ç”±ç©ºæ ¼åˆ†å‰²çš„å¤šä¸ªæ¨¡æ¿ã€‚åœ¨åŒ…å«å¤šä¸ªçš„æƒ…å†µä¸‹ï¼Œä¼šæŒ‰ç…§æ¨¡æ¿å‡ºçŽ°çš„é¡ºåºä¾æ­¤å¤„ç† *(åŽé¢çš„è¦†ç›–å…ˆå‡ºçŽ°çš„)*ã€‚\nå¦‚æžœè¢«å¼•ç”¨çš„æ¨¡æ¿æ²¡æœ‰è¢«æ‰¾åˆ°çš„è¯ï¼Œå°±ä¼šè¢«å¿½ç•¥ã€‚\n\n#### Pod æ¨¡æ¿åµŒå¥—\n\nå­—æ®µ `inheritFrom` æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•æ¥ç»„åˆå·²æœ‰çš„ podTemplateã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç›´æŽ¥åœ¨æµæ°´çº¿ä¸­ä½¿ç”¨ groovy æ¥å®šä¹‰å’Œç»„åˆ podTemplate ä¼šå¾ˆæœ‰ç”¨ã€‚\nåµŒå¥—çš„æ–¹å¼ä½¿ä¹‹å˜çš„å¯èƒ½ã€‚ä½ å¯ä»¥æŠŠå¤šä¸ª podTemplate åµŒå¥—èµ·æ¥ï¼Œç»„åˆæˆä¸€ä¸ªã€‚\n\nä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒæŠŠä¸¤ä¸ªä¸åŒçš„ podTemplate ç»„åˆèµ·æ¥ï¼Œå˜æˆä¸€ä¸ªå…·æœ‰ maven å’Œ docker èƒ½åŠ›çš„æ¨¡æ¿ã€‚\n\n```groovy\npodTemplate(label: 'docker', containers: [containerTemplate(image: 'docker', name: 'docker', command: 'cat', ttyEnabled: true)]) {\n    podTemplate(label: 'maven', containers: [containerTemplate(image: 'maven', name: 'maven', command: 'cat', ttyEnabled: true)]) {\n        // do stuff\n    }\n}\n```\n\nè¿™ä¸ªç‰¹æ€§éžå¸¸æœ‰ç”¨ï¼Œæµæ°´çº¿åº“çš„å¼€å‘äººå‘˜å¯ä»¥æŠŠ podTemplate åŒ…è£…æˆå‡½æ•°ï¼Œç„¶åŽè®©ç”¨æˆ·æ ¹æ®å®žé™…éœ€è¦æ¥è°ƒç”¨è¿™äº›å‡½æ•°ã€‚\n\nä¾‹å¦‚ï¼Œä¸º podTemplate åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å¯¼å…¥åŽä½¿ç”¨ã€‚æˆ‘ä»¬çš„æ–‡ä»¶ä½äºŽ `src/com/foo/utils/PodTemplates.groovy`:\n\n```groovy\npackage com.foo.utils\n\npublic void dockerTemplate(body) {\n  def label = \"worker-${UUID.randomUUID().toString()}\"\n  podTemplate(label: label,\n        containers: [containerTemplate(name: 'docker', image: 'docker', command: 'cat', ttyEnabled: true)],\n        volumes: [hostPathVolume(hostPath: '/var/run/docker.sock', mountPath: '/var/run/docker.sock')]) {\n    body.call(label)\n  }\n}\n\npublic void mavenTemplate(body) {\n  def label = \"worker-${UUID.randomUUID().toString()}\"\n  podTemplate(label: label,\n        containers: [containerTemplate(name: 'maven', image: 'maven', command: 'cat', ttyEnabled: true)],\n        volumes: [secretVolume(secretName: 'maven-settings', mountPath: '/root/.m2'),\n                  persistentVolumeClaim(claimName: 'maven-local-repo', mountPath: '/root/.m2nrepo')]) {\n    body.call(label)\n  }\n}\n\nreturn this\n```\n\nè¯¥åº“çš„ä½¿ç”¨è€…åªéœ€è¦æŠŠä¸¤ä¸ªå‡½æ•°ç»„åˆèµ·æ¥å°±å¯ä»¥åŒæ—¶æ»¡è¶³å¯¹ maven å’Œ docker çš„éœ€æ±‚ã€‚ç„¶è€Œï¼Œä½ éœ€è¦æŒ‡å®šå‘½ä»¤æ‰§è¡Œæ—¶æ‰€ç”¨çš„å®¹å™¨ã€‚å¦å¤–ï¼Œä½  **ä¸** å¯ä»¥å¿½ç•¥ `node` è¯­å¥ã€‚\n\næ³¨æ„ï¼Œä½  **å¿…é¡»** ä½¿ç”¨æœ€é‡Œå±‚ç”Ÿæˆçš„æ ‡ç­¾æ¥èŽ·å–èŠ‚ç‚¹ï¼Œåœ¨è¯¥èŠ‚ç‚¹ä¸ŠåŒ…å«æ‰€æœ‰çš„å¤–éƒ¨ podï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```groovy\nimport com.foo.utils.PodTemplates\n\nslaveTemplates = new PodTemplates()\n\nslaveTemplates.dockerTemplate {\n  slaveTemplates.mavenTemplate { label ->\n    node(label) {\n      container('docker') {\n        sh 'echo hello from docker'\n      }\n      container('maven') {\n        sh 'echo hello from maven'\n      }\n     }\n  }\n}\n```\n\n#### ä½¿ç”¨ä¸åŒçš„å‘½åç©ºé—´\n\næœ‰äº›æƒ…å†µï¼Œä½ éœ€è¦è®©èŠ‚ç‚¹è¿è¡Œåœ¨ä¸€ä¸ªä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œè€Œä¸æ˜¯å®šä¹‰åœ¨\"äº‘\"é…ç½®ä¸­çš„é‚£ä¸ªã€‚ä¾‹å¦‚ï¼šä¸ºäº†æµ‹è¯•ä½ å¯èƒ½éœ€è¦è®©èŠ‚ç‚¹è¿è¡Œåœ¨å‘½åç©ºé—´ `ephemeral` ä¸­ã€‚\nè¿™äº›æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡ç•Œé¢æˆ–è€…æµæ°´çº¿æ¥æŒ‡å®šä¸€ä¸ªå‘½åç©ºé—´ã€‚\n\n#### è®¾ç½®ä¸åŒ `shell` å‘½ä»¤æ›¿æ¢ `/bin/sh`\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œ `shell` å‘½ä»¤æ˜¯ `/bin/sh`ã€‚åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³ä½¿ç”¨ä¾‹å¦‚ `/bin/bash` è¿™æ ·å…¶ä»–çš„å‘½ä»¤ã€‚\n\n```groovy\npodTemplate(label: my-label) {\n  node(my-label) {\n    stage('Run specific shell') {\n      container(name:'mycontainer', shell:'/bin/bash') {\n        sh 'echo hello world'\n      }\n    }\n  }\n}\n```\n\n## å®¹å™¨é…ç½®\n\nåœ¨æµæ°´çº¿ä¸­çš„ podTemplate é‡Œé…ç½®ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œæœ‰å¦‚ä¸‹çš„å¯é€‰é¡¹ï¼š\n\n```groovy\npodTemplate(label: 'mypod', cloud: 'kubernetes', containers: [\n    containerTemplate(\n        name: 'mariadb',\n        image: 'mariadb:10.1',\n        ttyEnabled: true,\n        privileged: false,\n        alwaysPullImage: false,\n        workingDir: '/home/jenkins',\n        resourceRequestCpu: '50m',\n        resourceLimitCpu: '100m',\n        resourceRequestMemory: '100Mi',\n        resourceLimitMemory: '200Mi',\n        envVars: [\n            envVar(key: 'MYSQL_ALLOW_EMPTY_PASSWORD', value: 'true'),\n            secretEnvVar(key: 'MYSQL_PASSWORD', secretName: 'mysql-secret', secretKey: 'password'),\n            ...\n        ],\n        ports: [portMapping(name: 'mysql', containerPort: 3306, hostPort: 3306)]\n    ),\n    ...\n],\nvolumes: [\n    emptyDirVolume(mountPath: '/etc/mount1', memory: false),\n    secretVolume(mountPath: '/etc/mount2', secretName: 'my-secret'),\n    configMapVolume(mountPath: '/etc/mount3', configMapName: 'my-config'),\n    hostPathVolume(mountPath: '/etc/mount4', hostPath: '/mnt/my-mount'),\n    nfsVolume(mountPath: '/etc/mount5', serverAddress: '127.0.0.1', serverPath: '/', readOnly: true),\n    persistentVolumeClaim(mountPath: '/etc/mount6', claimName: 'myClaim', readOnly: true)\n],\nimagePullSecrets: [ 'pull-secret' ],\nannotations: [\n    podAnnotation(key: \"my-key\", value: \"my-value\")\n    ...\n]) {\n   ...\n}\n```\n\n## ç”³æ˜Žå¼æµæ°´çº¿\n\nJenkins 2.66+ å¼€å§‹æ”¯æŒç”³æ˜Žå¼æµæ°´çº¿ã€‚ç”³æ˜Žå¼çš„èŠ‚ç‚¹å¯ä»¥ç”¨ yaml çš„æ–¹å¼æ¥å®šä¹‰ï¼š\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      label 'mypod'\n      yaml \"\"\"\napiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    some-label: some-label-value\nspec:\n  containers:\n  - name: maven\n    image: maven:alpine\n    command:\n    - cat\n    tty: true\n  - name: busybox\n    image: busybox\n    command:\n    - cat\n    tty: true\n\"\"\"\n    }\n  }\n  stages {\n    stage('Run maven') {\n      steps {\n        container('maven') {\n          sh 'mvn -version'\n        }\n        container('busybox') {\n          sh '/bin/busybox'\n        }\n      }\n    }\n  }\n}\n```\n\næˆ–è€…ï¼Œä½¿ç”¨ `yamlFile` è®© pod æ¨¡æ¿å†™åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ `KubernetesPod.yaml` é‡Œã€‚\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      label 'mypod'\n      yamlFile 'KubernetesPod.yaml'\n    }\n  }\n  stages {\n      //...\n  }\n}\n```\n\næ³¨æ„ï¼Œä¹‹å‰æ˜¯å¯ä»¥å®šä¹‰ `containerTemplate` ï¼Œä½†ç›®å‰å·²ç»åœ¨ yaml æ ¼å¼ä¸­è¢«å¼ƒç”¨ã€‚\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      //cloud 'kubernetes'\n      label 'mypod'\n      containerTemplate {\n        name 'maven'\n        image 'maven:3.3.9-jdk-8-alpine'\n        ttyEnabled true\n        command 'cat'\n      }\n    }\n  }\n  stages { ... }\n}\n```\n\nåœ¨è‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´é‡Œè¿è¡Œæµæ°´çº¿æˆ–è€…å•ä¸ªé˜¶æ®µï¼ˆstageï¼‰â€”â€”é™¤éžæ˜Žç¡®è¯´æ˜Žï¼Œå¦åˆ™æ˜¯ä¸éœ€è¦çš„ã€‚\n\n```groovy\npipeline {\n  agent {\n    kubernetes {\n      label 'mypod'\n      customWorkspace 'some/other/path'\n      defaultContainer 'maven'\n      yamlFile 'KubernetesPod.yaml'\n    }\n  }\n\n  stages {\n    stage('Run maven') {\n      steps {\n        sh 'mvn -version'\n        sh \"echo Workspace dir is ${pwd()}\"\n      }\n    }\n  }\n}\n```\n\n## ä»Žæµæ°´çº¿ä¸­è®¿é—®å®¹å™¨æ—¥å¿—\n\nå¦‚æžœä½ ä½¿ç”¨ `containerTemplate` åœ¨åŽå°è¿è¡Œä¸€äº›æœåŠ¡ï¼ˆä¾‹å¦‚ï¼šé›†æˆæµ‹è¯•ç”¨çš„æ•°æ®åº“ï¼‰ï¼Œä½ å¯èƒ½æƒ³åœ¨æµæ°´çº¿ä¸­è®¿é—®å®ƒçš„æ—¥å¿—ã€‚\nè¿™å¯ä»¥é€šè¿‡ `containerLog` è¿™ä¸ªæ­¥éª¤ï¼ˆstepï¼‰æ¥å®Œæˆï¼Œå®ƒä¼šæ‰“å°ä½ æ‰€è¯·æ±‚çš„å®¹å™¨çš„æ—¥å¿—åˆ°æž„å»ºæ—¥å¿—ä¸­ã€‚\n\n#### å¿…è¦å‚æ•°\n\n* **åç§°** è¦èŽ·å–æ—¥å¿—çš„å®¹å™¨çš„åç§°ï¼Œå®šä¹‰åœ¨ `podTemplate` ä¸­ã€‚ç®€å•ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥å¿½ç•¥å‚æ•°åï¼š\n\n```groovy\ncontainerLog 'mongodb'\n```\n\n#### å¯é€‰å‚æ•°\n\n* **returnLog** è¿”å›žè€Œä¸æ˜¯æ‰“å°åˆ°æž„å»ºæ—¥å¿—ä¸­ï¼ˆé»˜è®¤å€¼ï¼š`false`ï¼‰\n* **tailingLines** åªè¿”å›žæœ€åŽå‡ è¡Œçš„æ—¥å¿—ï¼ˆå¯é€‰ï¼‰\n* **sinceSeconds** åªè¿”å›žæœ€åŽå‡ ç§’çš„æ—¥å¿—ï¼ˆå¯é€‰ï¼‰\n* **limitBytes** é™åˆ¶è¾“å‡ºçš„å­—èŠ‚æ•°ï¼ˆä»Žæ—¥å¿—çš„å¼€å¤´ç®—èµ·ï¼Œä¸å‡†ç¡®ï¼‰\n\nå‚ç…§åœ¨çº¿å¸®åŠ©å’Œ [examples/containerLog.groovy](examples/containerLog.groovy).\n\n# çº¦æŸ\n\nåœ¨ pod ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªå®¹å™¨ã€‚å…¶ä¸­çš„åç§°ä¸º `jnlp` çš„å®¹å™¨æ˜¯è‡ªåŠ¨åˆ›å»ºçš„ï¼Œä¼šä½œä¸º Jenkins JNLP èŠ‚ç‚¹æœåŠ¡ï¼Œå¹¶å¸¦æœ‰å‚æ•° `${computer.jnlpmac} ${computer.name}`ã€‚\n\nå…¶ä»–å®¹å™¨å¿…é¡»æœ‰ä¸€ç›´è¿è¡Œçš„è¿›ç¨‹ï¼Œè¿™æ ·å®¹å™¨æ‰ä¸ä¼šé€€å‡ºã€‚å¦‚æžœé»˜è®¤çš„ entrypoint æˆ–å‘½ä»¤è¿è¡ŒåŽå°±é€€å‡ºçš„è¯ï¼Œå®ƒåº”è¯¥ä½¿ç”¨ `cat` ä»¥åŠ `ttyEnabled: true` æ¥è¦†ç›–ã€‚\n\n**è­¦å‘Š**\n\nå¦‚æžœä½ è¦ä¸º JNLP èŠ‚ç‚¹æä¾›è‡ªå·±çš„ Docker é•œåƒï¼Œä½  **å¿…é¡»** æŠŠå®¹å™¨å‘½åä¸º `jnlp`ï¼Œæ‰ä¼šè¦†ç›–é»˜è®¤çš„ã€‚å¦‚æžœä¸è¿™ä¹ˆåšçš„è¯ï¼Œå°±ä¼šå¯¼è‡´æœ‰ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶åŽ»è¿žæŽ¥ maser.\n\n# è¦†ç›–é¢„å®šä¹‰å‚æ•°\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒJenkins åœ¨è°ƒç”¨èŠ‚ç‚¹æ—¶ä¼šæ¯”è¾ƒä¿å®ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœé˜Ÿåˆ—ä¸­æœ‰ä¸¤ä¸ªæž„å»ºä»»åŠ¡ï¼Œå®ƒä¸ä¼šç«‹åˆ»è°ƒåº¦ä¸¤ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ã€‚\nBy default, Jenkins spawns agents conservatively. Say, if there are 2 builds in queue, it won't spawn 2 executors immediately.\nIt will spawn one executor and wait for sometime for the first executor to be freed before deciding to spawn the second executor.\nJenkins makes sure every executor it spawns is utilized to the maximum.\nIf you want to override this behaviour and spawn an executor for each build in queue immediately without waiting,\nyou can use these flags during Jenkins startup:\n\n```\n-Dhudson.slaves.NodeProvisioner.initialDelay=0\n-Dhudson.slaves.NodeProvisioner.MARGIN=50\n-Dhudson.slaves.NodeProvisioner.MARGIN0=0.85\n```\n\n# åœ¨ minikube ä¸Šé…ç½®\n\nåˆ›å»ºå¹¶å¯åŠ¨ [minikube](https://github.com/kubernetes/minikube)\n\nå®¢æˆ·ç«¯è¯ä¹¦éœ€è¦è½¬æ¢ä¸º PKCSï¼Œå¹¶éœ€è¦å¯†ç \n\n    openssl pkcs12 -export -out ~/.minikube/minikube.pfx -inkey ~/.minikube/apiserver.key -in ~/.minikube/apiserver.crt -certfile ~/.minikube/ca.crt -passout pass:secret\n\nç„¶åŽï¼ŒéªŒè¯è¯ä¹¦å¯ç”¨\n\n    curl --cacert ~/.minikube/ca.crt --cert ~/.minikube/minikube.pfx:secret --cert-type P12 https://$(minikube ip):8443\n\nå¢žåŠ ä¸€ä¸ªè¯ä¹¦ç±»åž‹çš„ Jenkins å‡­æ®ï¼Œä»Ž `~/.minikube/minikube.pfx` ä¸Šä¼ ï¼Œå¯†ç ä¸º `secret`\n\nç”¨æ–‡ä»¶ `~/.minikube/ca.crt` çš„å†…å®¹æ¥å¡«å†™ *Kubernetes æœåŠ¡è¯ä¹¦ key*\n\n# åœ¨ Google Container Engine ä¸Šé…ç½®\n\nåˆ›å»ºä¸€ä¸ªé›†ç¾¤\n\n    `gcloud container clusters create jenkins --num-nodes 1 --machine-type g1-small`\n\nå¹¶è®°ä¸‹ç®¡ç†å‘˜å¯†ç å’ŒæœåŠ¡è¯ä¹¦ã€‚\n\næˆ–åªæ˜¯ç”¨ Google å¼€å‘è€…æŽ§åˆ¶å°æ¥åˆ›å»ºä¸€ä¸ªå®¹å™¨å¼•æ“Žé›†ç¾¤ï¼Œç„¶åŽè¿è¡Œå¦‚ä¸‹å‘½ä»¤\n\n    gcloud container clusters get-credentials jenkins\n    kubectl config view --raw\n\næœ€åŽçš„å‘½ä»¤ä¼šè¾“å‡º kubernetes é›†ç¾¤é…ç½®ï¼ŒåŒ…æ‹¬ï¼šAPI æœåŠ¡åœ°å€ã€ç®¡ç†å‘˜å¯†ç å’Œæ ¹è¯ä¹¦ã€‚\n\n# è°ƒè¯•\n\né¦–å…ˆï¼Œç¡®ä¿ä½ åœ¨æ­£ç¡®çš„é›†ç¾¤å’Œå‘½åç©ºé—´ä¸­ï¼Œè§‚å¯Ÿ Jenkins èŠ‚ç‚¹æ˜¯å¦å¯åŠ¨ã€‚\n\n    kubectl get -a pods --watch\n\nå¦‚æžœä»–ä»¬çš„çŠ¶æ€ä¸æ˜¯ `Running`ï¼Œä½¿ç”¨ `describe` èŽ·å–äº‹ä»¶ä¿¡æ¯\n\n    kubectl describe pods/my-jenkins-agent\n\nå¦‚æžœä»–ä»¬å¤„äºŽ `Running`ï¼Œä½¿ç”¨ `logs` èŽ·å–è¾“å‡ºçš„æ—¥å¿—\n\n    kubectl logs -f pods/my-jenkins-agent jnlp\n\nå¦‚æžœ pod è¿˜æ²¡æœ‰å¯åŠ¨ï¼Œæˆ–æ²¡æœ‰å…¶ä»–ä»»ä½•é”™è¯¯ï¼Œè¯·æ£€æŸ¥ master ä¸Šçš„æ—¥å¿—ã€‚\n\næƒ³è¦æ›´å¤šçš„ç»†èŠ‚çš„è¯ï¼Œé…ç½®ä¸€ä¸ªæ–°çš„ [Jenkins æ—¥å¿—è®°å½•å™¨](https://wiki.jenkins-ci.org/display/JENKINS/Logging)ï¼Œ\nè®¾ç½® `org.csanchez.jenkins.plugins.kubernetes` çš„çº§åˆ«ä¸º `ALL`.\n\nä¸ºäº†æ£€æŸ¥å‘é€åˆ° Kubernetes API æœåŠ¡çš„ json æ•°æ®ï¼Œä½ å¯ä»¥é…ç½®ä¸€ä¸ªæ–°çš„ [Jenkins æ—¥å¿—è®°å½•å™¨](https://wiki.jenkins-ci.org/display/JENKINS/Logging)ï¼Œ\nè®¾ç½® `okhttp3` çš„çº§åˆ«ä¸º `ALL`.\n\n## åˆ é™¤é”™è¯¯çŠ¶æ€çš„ pod\n\n    kubectl get pods -o name --selector=jenkins=slave --all-namespaces  | xargs -I {} kubectl delete {}\n\n# æž„å»ºä¸Žæµ‹è¯•\n\né›†æˆæµ‹è¯•ä¼šä½¿ç”¨ä»Ž kube config æ–‡ä»¶æˆ– service account ä¸­è‡ªåŠ¨æ£€æµ‹åˆ°çš„é…ç½®ã€‚\n\n## æ‰‹å·¥æµ‹è¯•\n\nè¿è¡Œ `mvn clean install` å¹¶æ‹·è´ `target/kubernetes.hpi` åˆ° Jenkins çš„æ’ä»¶ç›®å½•ä¸­ã€‚\n\n## åœ¨ Kubernetes ä¸­è¿è¡Œé›†æˆæµ‹è¯•\n\nè¯·æ³¨æ„ï¼Œä½ è¿è¡Œ `mvn` çš„ç³»ç»Ÿéœ€è¦èƒ½å¤Ÿä»Žé›†ç¾¤è®¿é—®åˆ°ã€‚å¦‚æžœä½ çœ‹åˆ°èŠ‚ç‚¹è¿žæŽ¥äº†é”™è¯¯çš„ä¸»æœºï¼Œé‚£ä¹ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„ `jenkins.host.address` æ¥æ›¿ä»£ã€‚\n\n### åœ¨ Minikube ä¸­è¿è¡Œé›†æˆæµ‹è¯•\n\nä¸ºäº†é›†æˆæµ‹è¯•ï¼Œéœ€è¦å®‰è£…å’Œå¯åŠ¨ [minikube](https://github.com/kubernetes/minikube).æµ‹è¯•ç¨‹åºä¼šæ£€æµ‹å¹¶åœ¨ä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ä¸­è¿è¡Œã€‚\n\næœ‰äº›é›†æˆæµ‹è¯•è¿è¡Œä¸€ä¸ªæœ¬åœ° Jenkinsï¼Œå› æ­¤ï¼Œä½ è¿è¡Œçš„ä¸»æœºéœ€è¦èƒ½ä»Ž Kubernetes é›†ç¾¤è®¿é—®åˆ°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤„äºŽå®‰å…¨çš„è€ƒè™‘ï¼ŒJenkins åªä¼šç›‘å¬ `192.168.64.1`ã€‚\nå¦‚æžœä½ çš„ minikube æ²¡æœ‰è¿è¡Œåœ¨é‚£ä¸ªç½‘ç»œä¸Šï¼Œå¯ä»¥ç»™ maven ä¼ é€’å‚æ•° `connectorHost`.\n\n    mvn clean install -DconnectorHost=$(minikube ip | sed -e 's/\\([0-9]*\\.[0-9]*\\.[0-9]*\\).*/\\1.1/')\n\nå¦‚æžœä½ ä¸åœ¨æ„ä½ çš„ç½‘ç»œä¸­å…¶ä»–äººä¹Ÿå¯ä»¥ä½¿ç”¨ä½ æµ‹è¯•çš„ Jenkinsï¼Œé‚£ä¹ˆï¼Œä½ å¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š\n\n    mvn clean install -DconnectorHost=0.0.0.0\n\nç„¶åŽï¼Œä½ æµ‹è¯•ç”¨çš„ Jenkins å°†ä¼šç›‘å¬æ‰€æœ‰çš„ ip åœ°å€ã€‚å› æ­¤ï¼Œä½ æž„å»ºç”¨çš„ pod å¯ä»¥å®¹ä½ çš„ minikube è™šæ‹Ÿæœºä¸­è®¿é—®åˆ°ä½ çš„ä¸»æœºã€‚\n\nå¦‚æžœä½ çš„ minikube æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªè™šæ‹Ÿæœºä¸­ï¼ˆä¾‹å¦‚ï¼švirtualboxï¼‰ï¼Œè€Œä¸”è¿è¡Œ `mvn` çš„ä¸»æœºæ²¡æœ‰ä¸€ä¸ªå…¬å…±çš„ä¸»æœºåå¯ä»¥è®©è™šæ‹Ÿæœºè®¿é—®åˆ°ï¼Œä½ å¯ä»¥è®¾ç½®\nç³»ç»Ÿå±žæ€§ `jenkins.host.address` ä¸ºä½ çš„ä¸»æœºï¼ˆä¸»æœºæ¨¡å¼æˆ– NATï¼‰çš„ IPï¼š\n\n    mvn clean install -Djenkins.host.address=192.168.99.1\n\n### åœ¨ä¸åŒçš„é›†ç¾¤ä¸­è¿è¡Œé›†æˆæµ‹è¯•\n\nç¡®ä¿ä½ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºå‘½åç©ºé—´å’Œè§’è‰²ï¼Œç„¶åŽï¼Œåœ¨å‘½åç©ºé—´ `kubernetes-plugin` ä»¥åŠ service account `jenkins`\n(è¦ä½¿ç”¨ä¸åŒçš„å‘½åç©ºé—´çš„è¯ï¼Œè¯·ç¼–è¾‘ `src/test/kubernetes/service-account.yml` æ–‡ä»¶)ä¸‹è¿è¡Œ\n\n```\nkubectl create namespace kubernetes-plugin-test\nkubectl create namespace kubernetes-plugin-test-overridden-namespace\nkubectl create namespace kubernetes-plugin-test-overridden-namespace2\nkubectl apply -n kubernetes-plugin-test -f src/main/kubernetes/service-account.yml\nkubectl apply -n kubernetes-plugin-test-overridden-namespace -f src/main/kubernetes/service-account.yml\nkubectl apply -n kubernetes-plugin-test-overridden-namespace2 -f src/main/kubernetes/service-account.yml\nkubectl apply -n kubernetes-plugin-test -f src/test/kubernetes/service-account.yml\nkubectl apply -n kubernetes-plugin-test-overridden-namespace -f src/test/kubernetes/service-account.yml\nkubectl apply -n kubernetes-plugin-test-overridden-namespace2 -f src/test/kubernetes/service-account.yml\n```\n\n# Docker é•œåƒ\n\nJenkins çš„ Docker é•œåƒï¼Œå¹¶å®‰è£…å¥½æ’ä»¶ã€‚åŸºäºŽ[å®˜æ–¹é•œåƒ](https://hub.docker.com/r/jenkins/jenkins/)ã€‚\n\n## è¿è¡Œ Docker é•œåƒ\n\n    docker run --rm --name jenkins -p 8080:8080 -p 50000:50000 -v /var/jenkins_home csanchez/jenkins-kubernetes\n\n# åœ¨ Kubernetes ä¸­è¿è¡Œ\n\nç¤ºä¾‹çš„é…ç½®ä¼šåˆ›å»ºä¸€ä¸ªå¸¦æœ‰æŒä¹…å·çš„ stateful set è¿è¡Œ Jenkinsï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ª service account æ¥é€šè¿‡ Kubernetes API çš„è®¤è¯ã€‚\n\n## åœ¨æœ¬åœ°çš„ minikube ä¸­è¿è¡Œ\n\nä½¿ç”¨ [minikube](https://github.com/kubernetes/minikube) å¯ä»¥åˆ›å»ºåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æœ¬åœ°æµ‹è¯•é›†ç¾¤\n\n    minikube start\n\nä½ å¯èƒ½éœ€è¦ä¸ºä¸»æœºæŒ‚è½½å·è®¾ç½®æ­£ç¡®çš„æƒé™\n\n    minikube ssh\n    sudo chown 1000:1000 /tmp/hostpath-provisioner/pvc-*\n\nç„¶åŽï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»º Jenkins çš„å‘½åç©ºé—´ï¼Œcontroller ä»¥åŠ service\n\n    kubectl create namespace kubernetes-plugin\n    kubectl config set-context $(kubectl config current-context) --namespace=kubernetes-plugin\n    kubectl create -f src/main/kubernetes/service-account.yml\n    kubectl create -f src/main/kubernetes/jenkins.yml\n\né€šè¿‡ä¸‹é¢çš„å‘½ä»¤èŽ·å–è¿žæŽ¥ç”¨çš„åœ°å€\n\n    minikube service jenkins --namespace kubernetes-plugin --url\n\n## åœ¨ Google Container Engine GKE ä¸­è¿è¡Œ\n\nå‡è®¾ï¼Œä½ å·²ç»åˆ›å»ºæ¥ä¸€ä¸ªåä¸º `jenkins` çš„ Kubernetes é›†ç¾¤ï¼Œç”¨æ¥è¿è¡Œ Jenkins ä»¥åŠèŠ‚ç‚¹ã€‚\n\nåˆ›å»ºæ‰€æœ‰çš„å…ƒç´ ï¼Œå¹¶è®¾ç½®é»˜è®¤çš„å‘½åç©ºé—´\n\n    kubectl create namespace kubernetes-plugin\n    kubectl config set-context $(kubectl config current-context) --namespace=kubernetes-plugin\n    kubectl create -f src/main/kubernetes/service-account.yml\n    kubectl create -f src/main/kubernetes/jenkins.yml\n\nè¿žæŽ¥ç”± Kubernetes åˆ›å»ºçš„ç½‘ç»œè´Ÿè½½å‡è¡¡çš„ ipï¼Œç«¯å£ä¸º 80ã€‚ä½¿ç”¨å‘½ä»¤ `kubectl describe services/jenkins` ï¼ˆè¿™å¯èƒ½éœ€è¦ç‚¹æ—¶é—´ï¼‰èŽ·å– ipï¼ˆåœ¨è¿™é‡Œæ˜¯ `104.197.19.100`ï¼‰\n\n    $ kubectl describe services/jenkins\n    Name:           jenkins\n    Namespace:      default\n    Labels:         <none>\n    Selector:       name=jenkins\n    Type:           LoadBalancer\n    IP:         10.175.244.232\n    LoadBalancer Ingress:   104.197.19.100\n    Port:           http    80/TCP\n    NodePort:       http    30080/TCP\n    Endpoints:      10.172.1.5:8080\n    Port:           agent   50000/TCP\n    NodePort:       agent   32081/TCP\n    Endpoints:      10.172.1.5:50000\n    Session Affinity:   None\n    No events.\n\nThis can be done checking _Enable proxy compatibility_ under Manage Jenkins -> Configure Global Security\nç›´åˆ° Kubernetes 1.4 ç§»é™¤äº†æº ip çš„ SNATï¼Œä¼¼ä¹Žéœ€è¦é…ç½® CSRF(åœ¨ Jenkins 2 ä¸­é»˜è®¤å¯ç”¨) ä»¥é¿å… `WARNING: No valid crumb was included in request` é”™è¯¯ã€‚\nå¯ä»¥åœ¨\"ç®¡ç† Jenkins\" -> \"å…¨å±€å®‰å…¨é…ç½®\"ä¸‹çš„ _å¯ç”¨ä»£ç†å…¼å®¹æ€§_ã€‚\n\né…ç½® Jenkinsï¼Œåœ¨é…ç½®ä¸­æ·»åŠ  `Kubernetes` äº‘ï¼Œè®¾ç½®å®¹å™¨å¼•æ“Žé›†ç¾¤çš„ Kubernetes åœ°å€ï¼Œæˆ–åªæ˜¯ç®€å•çš„ä¸º `https://kubernetes.default.svc.cluster.local`.\nåœ¨å‡­æ®ä½ç½®ï¼Œç‚¹å‡»`æ·»åŠ `å¹¶é€‰æ‹© `Kubernetes Service Account`,æˆ–ä½¿ç”¨ Kubernetes API çš„ç”¨æˆ·åå’Œå¯†ç ã€‚\næˆ–è€…é›†ç¾¤é…ç½®ä¸ºä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦æ¥è®¤è¯çš„è¯ï¼Œé€‰æ‹©`è¯ä¹¦`ä½œä¸ºå‡­æ®çš„ç±»åž‹ã€‚\n\nä½¿ç”¨ `Kubernetes Service Account` ä¼šå¯¼è‡´æ’ä»¶ä½¿ç”¨æŒ‚è½½åˆ° Jenkins pod ä¸­çš„é»˜è®¤ tokenã€‚ \næƒ³è¦äº†è§£æ›´å¤šè¯¦æƒ…çš„è¯ï¼Œè¯·æŸ¥çœ‹ [ä¸º pod é…ç½® Service Accounts](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/)ã€‚\n\n![image](credentials.png)\n\nä½ å¯èƒ½æƒ³æŠŠ `Jenkins URL` è®¾ç½®ä¸ºå†…éƒ¨çš„æœåŠ¡ IPï¼Œé€šè¿‡å†…éƒ¨ç½‘ç»œæ¥è¿žæŽ¥ã€‚å½“å‰ç¤ºä¾‹ä¸­æ˜¯ `http://10.175.244.232`ã€‚\n\nä¸ºæµ‹è¯•è®¾ç½®åˆç†çš„å€¼åˆ° `Container Cap`ï¼Œä¾‹å¦‚ï¼š3ã€‚\n\nä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ·»åŠ ä¸€ä¸ªé•œåƒï¼š\n\n* Docker é•œåƒï¼š`jenkins/inbound-agent`\n* Jenkins èŠ‚ç‚¹æ ¹ç›®å½•ï¼š`/home/jenkins`\n\n![image](configuration.png)\n\nçŽ°åœ¨ï¼Œå·²ç»å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ã€‚\n\nè¦åœæ­¢çš„è¯ï¼Œè¯·ä½¿ç”¨å‘½ä»¤ï¼š\n\n    kubectl delete namespace/kubernetes-plugin\n\n## è‡ªå®šä¹‰ deployment\n\n### ä¿®æ”¹ CPU å’Œå†…å­˜è¯·æ±‚æˆ–é™åˆ¶ (Kubernetes èµ„æº API)\n\nä¿®æ”¹æ–‡ä»¶ `./src/main/kubernetes/jenkins.yml` ä¸ºæ‰€éœ€è¦çš„é™åˆ¶\n\n```yaml\nresources:\n      limits:\n        cpu: 1\n        memory: 1Gi\n      requests:\n        cpu: 0.5\n        memory: 500Mi\n```\n\næ³¨æ„ï¼šè™šæ‹Ÿæœºä¼šä½¿ç”¨ `requests` çš„å†…å­˜ä½œä¸ºå †çš„é™åˆ¶(-Xmx)\n\n## æž„å»º\n\n    docker build -t csanchez/jenkins-kubernetes .\n\n# ç›¸å…³é¡¹ç›®\n\n* [Kubernetes Pipeline plugin](https://github.com/jenkinsci/kubernetes-pipeline-plugin): æµæ°´çº¿æ‰©å±•ï¼Œä¸ºæž„å»ºæä¾›äº†å¯¹ Kubernetes pods, secrets å’Œå·çš„ç›´æŽ¥æ”¯æŒ\n* [kubernetes-credentials](https://github.com/jenkinsci/kubernetes-credentials-plugin): å‡­æ®æä¾›è€…ï¼Œç”¨äºŽè¯»å– Kubernetes secrets\n"
        },
        {
          "name": "configuration.png",
          "type": "blob",
          "size": 100.7275390625,
          "content": null
        },
        {
          "name": "credentials.png",
          "type": "blob",
          "size": 36.4482421875,
          "content": null
        },
        {
          "name": "examples",
          "type": "tree",
          "content": null
        },
        {
          "name": "images",
          "type": "tree",
          "content": null
        },
        {
          "name": "kind-preload.sh",
          "type": "blob",
          "size": 0.6298828125,
          "content": "#!/usr/bin/env bash\nset -euxo pipefail\ncd $(dirname $0)\n\nPRE_LOAD_IMAGES=()\nPRE_LOAD_IMAGES+=(omrieival/ktunnel:v1.6.1)\nPRE_LOAD_IMAGES+=($(grep -h --include=\"*.groovy\" -e \"^\\s*image: .*$\" -R src/test/resources | sed -e \"s/^[[:space:]]*image: //\" | sort | uniq | grep -v \"windows\" | grep -v \"nonexistent\" | grep -v \"invalid\" | xargs))\nPRE_LOAD_IMAGES+=($(grep -e FROM src/main/resources/org/csanchez/jenkins/plugins/kubernetes/Dockerfile | cut -d ' ' -f 2-))\nif [[ -v cluster ]]\nthen\n  name_arg=\"--name $cluster\"\nelse\n  name_arg=\nfi\nfor image in \"${PRE_LOAD_IMAGES[@]}\"\ndo\n  docker pull \"$image\"\n  kind load docker-image \"$image\" $name_arg\ndone\n"
        },
        {
          "name": "kind.sh",
          "type": "blob",
          "size": 1.4365234375,
          "content": "#!/usr/bin/env bash\nset -euxo pipefail\ncd $(dirname $0)\n\n: ${WORKSPACE_TMP:=/tmp}\n\nexport PATH=$WORKSPACE_TMP:$PATH\nif [ \\! -x \"$WORKSPACE_TMP/kind\" ]\nthen\n    curl -sLo \"$WORKSPACE_TMP/kind\" https://github.com/kubernetes-sigs/kind/releases/download/v0.23.0/kind-$(uname | tr '[:upper:]' '[:lower:]')-amd64\n    chmod +x \"$WORKSPACE_TMP/kind\"\nfi\nif [ \\! -x \"$WORKSPACE_TMP/kubectl\" ]\nthen\n    curl -sLo \"$WORKSPACE_TMP/kubectl\" https://storage.googleapis.com/kubernetes-release/release/v1.30.1/bin/$(uname | tr '[:upper:]' '[:lower:]')/amd64/kubectl\n    chmod +x \"$WORKSPACE_TMP/kubectl\"\nfi\nif [ \\! -x \"$WORKSPACE_TMP/ktunnel\" ]\nthen\n    (cd \"$WORKSPACE_TMP\"; curl -sL https://github.com/omrikiei/ktunnel/releases/download/v1.6.1/ktunnel_1.6.1_Linux_x86_64.tar.gz | tar xvfz - ktunnel)\nfi\n\nexport cluster=ci$RANDOM\nexport KUBECONFIG=\"$WORKSPACE_TMP/kubeconfig-$cluster\"\nkind create cluster --name $cluster --wait 5m\nfunction cleanup() {\n    set +e\n    if [ -v ktunnel_pid ]\n    then\n        kill $ktunnel_pid\n    fi\n    kind export logs --name $cluster \"$WORKSPACE_TMP/kindlogs\"\n    kind delete cluster --name $cluster\n    rm \"$KUBECONFIG\"\n}\ntrap cleanup EXIT\nkubectl cluster-info\n\nif ${KIND_PRELOAD:-false}\nthen\n   ./kind-preload.sh\nfi\n\nktunnel expose jenkins 8000:8000 8001:8001 &\nktunnel_pid=$!\n\nmvn \\\n    -B \\\n    -ntp \\\n    -Djenkins.host.address=jenkins.default \\\n    -Dport=8000 \\\n    -DslaveAgentPort=8001 \\\n    -Dmaven.test.failure.ignore \\\n    verify \\\n    \"$@\"\n"
        },
        {
          "name": "pom.xml",
          "type": "blob",
          "size": 12.9208984375,
          "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n  <modelVersion>4.0.0</modelVersion>\n  <parent>\n    <groupId>org.jenkins-ci.plugins</groupId>\n    <artifactId>plugin</artifactId>\n    <version>4.88</version>\n    <relativePath />\n  </parent>\n\n  <groupId>org.csanchez.jenkins.plugins</groupId>\n  <artifactId>kubernetes</artifactId>\n  <version>${changelist}</version>\n  <packaging>hpi</packaging>\n  <name>Kubernetes plugin</name>\n  <description>Jenkins plugin to run dynamic agents in a Kubernetes cluster</description>\n  <url>https://github.com/jenkinsci/${project.artifactId}-plugin</url>\n\n  <licenses>\n    <license>\n      <name>Apache License 2.0</name>\n      <url>https://www.apache.org/licenses/LICENSE-2.0</url>\n      <distribution>repo</distribution>\n    </license>\n  </licenses>\n\n  <developers>\n    <developer>\n      <id>carlos</id>\n      <name>Carlos Sanchez</name>\n      <email>carlos@apache.org</email>\n    </developer>\n  </developers>\n\n  <scm>\n    <connection>scm:git:https://github.com/${gitHubRepo}.git</connection>\n    <developerConnection>scm:git:https://github.com/${gitHubRepo}.git</developerConnection>\n    <tag>${scmTag}</tag>\n    <url>https://github.com/${gitHubRepo}</url>\n  </scm>\n\n  <properties>\n    <changelist>999999-SNAPSHOT</changelist>\n    <jenkins.host.address />\n    <slaveAgentPort />\n    <jenkins.baseline>2.426</jenkins.baseline>\n    <jenkins.version>${jenkins.baseline}.3</jenkins.version>\n    <no-test-jar>false</no-test-jar>\n    <useBeta>true</useBeta>\n    <gitHubRepo>jenkinsci/${project.artifactId}-plugin</gitHubRepo>\n    <spotbugs.effort>Max</spotbugs.effort>\n    <spotbugs.threshold>Low</spotbugs.threshold>\n    <spotless.check.skip>false</spotless.check.skip>\n  </properties>\n\n  <dependencyManagement>\n    <dependencies>\n      <dependency>\n        <groupId>io.jenkins.tools.bom</groupId>\n        <artifactId>bom-${jenkins.baseline}.x</artifactId>\n        <version>2857.v01a_0144eb_20b_</version>\n        <type>pom</type>\n        <scope>import</scope>\n      </dependency>\n      <dependency>\n        <groupId>com.squareup.okhttp3</groupId>\n        <artifactId>mockwebserver</artifactId>\n        <!-- transitive dep of io.fabric8:kubernetes-server-mock, needs alignment with okhttp-api -->\n        <version>4.11.0</version>\n      </dependency>\n    </dependencies>\n  </dependencyManagement>\n\n  <dependencies>\n    <dependency>\n      <groupId>io.jenkins.plugins</groupId>\n      <artifactId>caffeine-api</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>authentication-tokens</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>bouncycastle-api</artifactId>\n    </dependency>\n\n    <dependency>\n      <!-- Requires Permission -->\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>cloudbees-folder</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>credentials</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>credentials-binding</artifactId>\n    </dependency>\n\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>durable-task</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>jackson2-api</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>kubernetes-client-api</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>metrics</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>plain-credentials</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>structs</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>variant</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins.workflow</groupId>\n      <artifactId>workflow-api</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins.workflow</groupId>\n      <artifactId>workflow-cps</artifactId>\n      <optional>true</optional>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins.workflow</groupId>\n      <artifactId>workflow-durable-task-step</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins.workflow</groupId>\n      <artifactId>workflow-step-api</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkinsci.plugins</groupId>\n      <artifactId>kubernetes-credentials</artifactId>\n    </dependency>\n    <dependency>\n      <!-- DeclarativeAgent -->\n      <groupId>org.jenkinsci.plugins</groupId>\n      <artifactId>pipeline-model-extensions</artifactId>\n      <optional>true</optional>\n    </dependency>\n    <dependency>\n      <groupId>io.fabric8</groupId>\n      <artifactId>kubernetes-server-mock</artifactId>\n      <version>6.10.0</version>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>io.jenkins</groupId>\n      <artifactId>configuration-as-code</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>io.jenkins.configuration-as-code</groupId>\n      <artifactId>test-harness</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.awaitility</groupId>\n      <artifactId>awaitility</artifactId>\n      <version>4.2.2</version>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>docker-workflow</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>git</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>git</artifactId>\n      <classifier>tests</classifier>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <!-- Required to test run src/main/resources/org/csanchez/jenkins/plugins/kubernetes/pipeline/samples/maven.groovy -->\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>junit</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>scm-api</artifactId>\n      <classifier>tests</classifier>\n      <scope>test</scope>\n    </dependency>\n    <!-- for ContainerExecDecoratorPipelineTest -->\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>ssh-agent</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins</groupId>\n      <artifactId>ssh-credentials</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkins-ci.plugins.workflow</groupId>\n      <artifactId>workflow-basic-steps</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <!-- SnippetizerTest -->\n      <groupId>org.jenkins-ci.plugins.workflow</groupId>\n      <artifactId>workflow-cps</artifactId>\n      <classifier>tests</classifier>\n      <scope>test</scope>\n    </dependency>\n\n    <!-- for testing -->\n    <dependency>\n      <groupId>org.jenkins-ci.plugins.workflow</groupId>\n      <artifactId>workflow-job</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <!-- SemaphoreStep -->\n      <groupId>org.jenkins-ci.plugins.workflow</groupId>\n      <artifactId>workflow-support</artifactId>\n      <classifier>tests</classifier>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <!-- DeclarativeGeneratorTester -->\n      <groupId>org.jenkinsci.plugins</groupId>\n      <artifactId>pipeline-model-definition</artifactId>\n      <classifier>tests</classifier>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.jenkinsci.plugins</groupId>\n      <artifactId>pipeline-model-definition</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.mockito</groupId>\n      <artifactId>mockito-core</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>pl.pragmatists</groupId>\n      <artifactId>JUnitParams</artifactId>\n      <version>1.1.1</version>\n      <scope>test</scope>\n    </dependency>\n  </dependencies>\n\n  <!-- get every artifact through repo.jenkins-ci.org, which proxies all the artifacts that we need -->\n  <repositories>\n    <repository>\n      <id>repo.jenkins-ci.org</id>\n      <url>https://repo.jenkins-ci.org/public/</url>\n    </repository>\n  </repositories>\n\n  <pluginRepositories>\n    <pluginRepository>\n      <id>repo.jenkins-ci.org</id>\n      <url>https://repo.jenkins-ci.org/public/</url>\n    </pluginRepository>\n  </pluginRepositories>\n\n  <build>\n    <plugins>\n      <plugin>\n        <groupId>org.apache.maven.plugins</groupId>\n        <artifactId>maven-surefire-plugin</artifactId>\n        <configuration>\n          <systemPropertyVariables>\n            <hudson.slaves.NodeProvisioner.initialDelay>0</hudson.slaves.NodeProvisioner.initialDelay>\n            <hudson.slaves.NodeProvisioner.recurrencePeriod>3000</hudson.slaves.NodeProvisioner.recurrencePeriod>\n            <org.jenkinsci.plugins.workflow.support.pickles.ExecutorPickle.timeoutForNodeMillis>60000</org.jenkinsci.plugins.workflow.support.pickles.ExecutorPickle.timeoutForNodeMillis>\n            <!-- have pods connect to this address for Jenkins -->\n            <jenkins.host.address>${jenkins.host.address}</jenkins.host.address>\n            <slaveAgentPort>${slaveAgentPort}</slaveAgentPort>\n          </systemPropertyVariables>\n        </configuration>\n      </plugin>\n      <plugin>\n        <groupId>org.jenkins-ci.tools</groupId>\n        <artifactId>maven-hpi-plugin</artifactId>\n        <configuration>\n          <systemProperties>\n            <hudson.slaves.NodeProvisioner.initialDelay>0</hudson.slaves.NodeProvisioner.initialDelay>\n            <hudson.slaves.NodeProvisioner.MARGIN>50</hudson.slaves.NodeProvisioner.MARGIN>\n            <hudson.slaves.NodeProvisioner.MARGIN0>0.85</hudson.slaves.NodeProvisioner.MARGIN0>\n            <jenkins.host.address>${jenkins.host.address}</jenkins.host.address>\n            <port>${port}</port>\n            <org.csanchez.jenkins.plugins.kubernetes.pipeline.PodTemplateStepExecution.verbose>true</org.csanchez.jenkins.plugins.kubernetes.pipeline.PodTemplateStepExecution.verbose>\n          </systemProperties>\n        </configuration>\n      </plugin>\n      <plugin>\n        <artifactId>maven-enforcer-plugin</artifactId>\n        <executions>\n          <execution>\n            <id>enforce-okhttp-consistency</id>\n            <goals>\n              <goal>enforce</goal>\n            </goals>\n            <configuration>\n              <rules>\n                <requireSameVersions>\n                  <dependencies>\n                    <dependency>com.squareup.okhttp3:mockwebserver</dependency>\n                    <dependency>com.squareup.okhttp3:okhttp:jar</dependency>\n                    <dependency>com.squareup.okhttp3:logging-interceptor</dependency>\n                  </dependencies>\n                </requireSameVersions>\n                <requireSameVersions>\n                  <dependencies>\n                    <dependency>io.fabric8:kubernetes-server-mock</dependency>\n                    <dependency>io.fabric8:kubernetes-client</dependency>\n                  </dependencies>\n                </requireSameVersions>\n              </rules>\n            </configuration>\n          </execution>\n        </executions>\n      </plugin>\n    </plugins>\n  </build>\n\n  <profiles>\n    <profile>\n      <id>merge-jacoco-reports</id>\n      <build>\n        <plugins>\n          <plugin>\n            <groupId>org.jacoco</groupId>\n            <artifactId>jacoco-maven-plugin</artifactId>\n            <executions>\n              <execution>\n                <goals>\n                  <goal>merge</goal>\n                </goals>\n                <phase>validate</phase>\n                <configuration>\n                  <fileSets>\n                    <fileSet>\n                      <directory>${project.build.directory}</directory>\n                      <includes>\n                        <include>jacoco-*.exec</include>\n                      </includes>\n                    </fileSet>\n                  </fileSets>\n                </configuration>\n              </execution>\n              <execution>\n                <id>build-report</id>\n                <goals>\n                  <goal>report</goal>\n                </goals>\n                <phase>validate</phase>\n                <configuration>\n                  <formats>XML</formats>\n                </configuration>\n              </execution>\n            </executions>\n          </plugin>\n        </plugins>\n      </build>\n    </profile>\n  </profiles>\n\n</project>\n"
        },
        {
          "name": "src",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}