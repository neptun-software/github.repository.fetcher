{
  "metadata": {
    "timestamp": 1736568929764,
    "page": 21,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjMw",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "docker-mailserver/docker-mailserver",
      "stars": 15060,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".dockerignore",
          "type": "blob",
          "size": 0.0185546875,
          "content": "*\n!target\n!VERSION\n"
        },
        {
          "name": ".editorconfig",
          "type": "blob",
          "size": 0.5869140625,
          "content": "# -----------------------------------------------\n# --- General -----------------------------------\n# --- https://editorconfig.org ------------------\n# -----------------------------------------------\n\nroot = true\n\n[*]\ncharset = utf-8\nend_of_line = lf\nindent_size = 2\nindent_style = space\ninsert_final_newline = true\ntrim_trailing_whitespace = true\n\n# -----------------------------------------------\n# --- Specific ----------------------------------\n# -----------------------------------------------\n\n[{Makefile,.gitmodules}]\nindent_style = tab\nindent_size = 4\n\n[*.md]\ntrim_trailing_whitespace = false\n"
        },
        {
          "name": ".gitattributes",
          "type": "blob",
          "size": 5.181640625,
          "content": "# Normalize line endings of all non-binary files to LF upon check-in (`git add` / `git commit`):\n* text=auto\n\n#################################################\n###  General  ###################################\n#################################################\n\n## GENERIC\n### CI + docs/mkdocs.yml\n*.yml               text\n### Documentation (Project, Tests, Docs site)\n*.md                text\n### TLS certs (test/files/) + DHE params (target/shared/)\n*.pem               text\n*.pem.sha512sum     text\n\n#################################################\n###  Project  ###################################\n#################################################\n\n## BUILD:\n.dockerignore       text\nDockerfile          text eol=lf\nMakefile\n\n## EXAMPLE (RUNTIME):\n*.env               text\n*.yaml              text\n\n## PROJECT\n.editorconfig       text export-ignore\n.gitattributes      text export-ignore\n.gitignore          text export-ignore\n.gitkeep            text export-ignore\n.gitmodules         text export-ignore\nLICENSE             text\n\n## SOURCE CODE\n*.sh                text eol=lf\n### acme.json extractor (target/bin/)\n*.py                text eol=lf\n### Only contain scripts (glob for extensionless)\ntarget/bin/**       text eol=lf\n\n#################################################\n###  Config  ####################################\n#################################################\n\n## CONFIG\n### Contains all text files (glob for extensionless)\ntarget/amavis/**    text\ntarget/fetchmail/** text\ntarget/getmail/**   text\ntarget/opendkim/**  text\ntarget/opendmarc/** text\ntarget/postgrey/**  text\ntarget/postsrsd/**  text\n### Generic target/ + test/config/\n*.cf                text\n*.conf              text\n### Dovecot\n*.ext               text\n*.sieve             text\n### Dovecot + Rspamd\n*.inc               text\n### Fail2Ban + Postgrey (test/config/)\n*.local             text\n### Postfix\n*.pcre              text\n\n#################################################\n###  Tests  #####################################\n#################################################\n\n## BATS\n*.bash              text eol=lf\n*.bats              text eol=lf\n\n## CONFIG (test/config/)\n### OpenLDAP image\n*.ldif              text\n### OpenDKIM\n*.private           text\nKeyTable            text\nSigningTable        text\nTrustedHosts        text\n### Postgrey\nwhitelist_recipients text\n\n## MISC\n### test/config/ + test/files/\n*.txt               text\n### test/linting/ (.ecrc.json) + test/files/ (*.acme.json):\n*.json              text\n\n#################################################\n###  Documentation  Website #####################\n#################################################\n\n## DOCUMENTATION\n### docs/content/assets/\n*.css               text\n*.png               binary\n*.svg               text -diff\n*.woff              binary\n### docs/overrides/\n*.html              text\n*.ico               binary\n*.webp              binary\n\n#################################################\n###  Info # #####################################\n#################################################\n\n### WHAT IS THIS FILE?\n# `.gitattributes` - Pattern-based overrides (Project specific)\n# Documentation: https://git-scm.com/docs/gitattributes\n#\n# Travels with the project and can override the defaults from `.gitconfig`.\n# This helps to enforce consistent line endings (CRLF / LF) where needed via\n# patterns (_when the git client supports `.gitattributes`_).\n\n# `.gitconfig` - Global Git defaults (Dev environment)\n# Documentation: https://git-scm.com/docs/git-config\n#\n# Git settings `core.autocrlf` and `core.eol` can vary across dev environments.\n# Those defaults can introduce subtle bugs due to incompatible line endings.\n\n\n### WHY SHOULD I CARE?\n# The desired result is to ensure the repo contains normalized LF line endings,\n# notably avoiding unhelpful noise in diffs or issues incurred from mixed line\n# endings. Storing as LF ensures no surprises for line endings during checkout.\n# Additionally for checkout to the local working directory, line endings can be\n# forced to CRLF or LF per file where appropriate, which ensures the files have\n# compatible line endings where software expects a specific kind.\n#\n# Examples:\n# Diffs with nothing visual changed. Line endings appear invisible.\n# Tests that compare text from two sources where only line endings differ fail.\n# /bin/sh with a shebang fails to run a binary at the given path due to a CRLF.\n\n\n### ATTRIBUTES\n# `text` normalizes the line endings of a file to LF upon commit (CRLF -> LF).\n# `text=auto` sets `text` if Git doesn't consider the file as binary data.\n\n# `eol` sets an explicit line ending to write files to the working directory.\n# `core.eol` is used for any files not explicitly set with an `eol` attr value.\n# `core.eol` uses the native line endings for your platform by default.\n# `core.autocrlf` (if set to `true` or `input`) overrides the `core.eol` value.\n\n# `binary` is an alias for `-text -diff`. The file won't be normalized (-text).\n# `-diff` indicates to avoid creating a diff. Useful when diffs are unlikely\n# to be meaningful, such as generated content (SVG, Source Maps, Lockfiles).\n\n# `export-ignore` excludes matched files and directories during `git archive`,\n# which services like Github use to create releases with archived source files.\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.5947265625,
          "content": "#################################################\n###  General  ###################################\n#################################################\n\n.env\ncompose.override.yaml\ndocs/site/\ndocker-data/\n\n#################################################\n###  IDEs  ######################################\n#################################################\n\n.idea/\n.vscode/\n\n#################################################\n###  Tests  #####################################\n#################################################\n\ntest/duplicate_configs/\ntest/config/dovecot-masters.cf\ntest/config/postfix-accounts.cf\n"
        },
        {
          "name": ".gitmodules",
          "type": "blob",
          "size": 0.3427734375,
          "content": "[submodule \"test/bats\"]\n\tpath = test/bats\n\turl = https://github.com/bats-core/bats-core.git\n[submodule \"test/test_helper/bats-support\"]\n\tpath = test/test_helper/bats-support\n\turl = https://github.com/bats-core/bats-support\n[submodule \"test/test_helper/bats-assert\"]\n\tpath = test/test_helper/bats-assert\n\turl = https://github.com/bats-core/bats-assert\n"
        },
        {
          "name": "CHANGELOG.md",
          "type": "blob",
          "size": 105.703125,
          "content": "# Changelog\n\nAll notable changes to this project will be documented in this file. The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/), and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n## [Unreleased](https://github.com/docker-mailserver/docker-mailserver/compare/v14.0.0...HEAD)\n\n> **Note**: Changes and additions listed here are contained in the `:edge` image tag. These changes may not be as stable as released changes.\n\n### Breaking\n\n- **saslauthd** mechanism support via ENV `SASLAUTHD_MECHANISMS` with `pam`, `shadow`, `mysql` values has been removed. Only `ldap` and `rimap` remain supported ([#4259](https://github.com/docker-mailserver/docker-mailserver/pull/4259))\n- **getmail6** has been refactored: ([#4156](https://github.com/docker-mailserver/docker-mailserver/pull/4156))\n  - The [DMS config volume](https://docker-mailserver.github.io/docker-mailserver/v15.0/config/advanced/optional-config/#volumes) now has support for `getmailrc_general.cf` for overriding [common default settings](https://docker-mailserver.github.io/docker-mailserver/v15.0/config/advanced/mail-getmail/#common-options). If you previously mounted this config file directly to `/etc/getmailrc_general` you should switch to our config volume support.\n  - IMAP/POP3 example configs added to our [`config-examples`](https://github.com/docker-mailserver/docker-mailserver/tree/v15.0.0/config-examples/getmail).\n  - ENV [`GETMAIL_POLL`](https://docker-mailserver.github.io/docker-mailserver/v15.0/config/environment/#getmail_poll) now supports values above 30 minutes.\n  - Added `getmail` as a new service for `supervisor` to manage, replacing cron for periodic polling.\n  - Generated getmail configuration files no longer set the `message_log` option. Instead of individual log files per config, the [default base settings DMS configures](https://github.com/docker-mailserver/docker-mailserver/tree/v15.0.0/target/getmail/getmailrc_general) now enables `message_log_syslog`. This aligns with how other services in DMS log to syslog where it is captured in `mail.log`.\n  - Getmail configurations have changed location from the base of the DMS Config Volume, to the `getmail/` subdirectory. Any existing configurations **must be migrated manually.**\n  - DMS v14 mistakenly relocated the _getmail state directory_ to the _DMS Config Volume_ as a `getmail/` subdirectory.\n    - This has been corrected to `/var/lib/getmail` (_if you have mounted a DMS State Volume to `/var/mail-state`, `/var/lib/getmail` will be symlinked to `/var/mail-state/lib-getmail`_).\n    - To preserve this state when upgrading to DMS v15, **you must manually migrate `getmail/` from the _DMS Config Volume_ to `lib-getmail/` in the _DMS State Volume_.**\n\n### Security\n\n- **Fail2ban:**\n  - Ensure a secure connection, when downloading the fail2ban package ([#4080](https://github.com/docker-mailserver/docker-mailserver/pull/4080))\n\n### Added\n\n- **Internal:**\n  - Add password confirmation to several `setup` CLI subcommands ([#4072](https://github.com/docker-mailserver/docker-mailserver/pull/4072))\n\n### Updates\n\n- **Fail2ban:**\n  - Updated to version [`1.1.0`](https://github.com/fail2ban/fail2ban/releases/tag/1.1.0) ([#4045](https://github.com/docker-mailserver/docker-mailserver/pull/4045))\n- **Documentation:**\n  - Account Management and Authentication pages have been rewritten and better organized ([#4122](https://github.com/docker-mailserver/docker-mailserver/pull/4122))\n  - Add a caveat for `DMS_VMAIL_UID` not being compatible with `0` / root ([#4143](https://github.com/docker-mailserver/docker-mailserver/pull/4143))\n- **Postfix:**\n  - By default opt-out from _Microsoft reactions_ for outbound mail ([#4120](https://github.com/docker-mailserver/docker-mailserver/pull/4120))\n- Updated `jaq` version from `1.3.0` to `2.0.0` ([#4190](https://github.com/docker-mailserver/docker-mailserver/pull/4190))\n- Updated Rspamd GTube settings and tests ([#4191](https://github.com/docker-mailserver/docker-mailserver/pull/4191))\n\n### Fixes\n\n- **Dovecot:**\n  - The logwatch `ignore.conf` now also excludes Xapian messages about pending documents ([#4060](https://github.com/docker-mailserver/docker-mailserver/pull/4060))\n  - `dovecot-fts-xapian` plugin was updated to `1.7.13`, fixing a regression with indexing ([#4095](https://github.com/docker-mailserver/docker-mailserver/pull/4095))\n  - The \"dummy account\" workaround for _Dovecot Quota_ feature support no longer treats the alias as a regex when checking the Dovecot UserDB ([#4222](https://github.com/docker-mailserver/docker-mailserver/pull/4222))\n- **LDAP:**\n  - Correctly apply a compatibility fix for OAuth2 introduced in DMS v13.3.1 which had not been applied to the actual LDAP config changes ([#4175](https://github.com/docker-mailserver/docker-mailserver/pull/4175))\n- **Internal:**\n  - The main `mail.log` (_which is piped to stdout via `tail`_) now correctly begins from the first log line of the active container run. Previously some daemon logs and potential warnings/errors were omitted ([#4146](https://github.com/docker-mailserver/docker-mailserver/pull/4146))\n  - Fixed a regression introduced in v14 where `postfix-main.cf` appended `stderr` output into `/etc/postfix/main.cf`, causing Postfix startup to fail ([#4147](https://github.com/docker-mailserver/docker-mailserver/pull/4147))\n  - `start-mailserver.sh` removed unused `shopt -s inherit_errexit` ([#4161](https://github.com/docker-mailserver/docker-mailserver/pull/4161))\n- **Rspamd:**\n  - DKIM private key path checking is now performed only on paths that do not contain `$` ([#4201](https://github.com/docker-mailserver/docker-mailserver/pull/4201))\n- The command `swaks --help` is now functional ([#4282](https://github.com/docker-mailserver/docker-mailserver/pull/4282))\n\n### CI\n\n- Removed `CONTRIBUTORS.md`, `.all-contributorsrc`, and workflow ([#4141](https://github.com/docker-mailserver/docker-mailserver/pull/4141))\n- Refactored the workflows to be more secure for generating documentation previews on PRs ([#4267](https://github.com/docker-mailserver/docker-mailserver/pull/4267), [#4264](https://github.com/docker-mailserver/docker-mailserver/pull/4264), [#4262](https://github.com/docker-mailserver/docker-mailserver/pull/4262), [#4247](https://github.com/docker-mailserver/docker-mailserver/pull/4247), [#4244](https://github.com/docker-mailserver/docker-mailserver/pull/4244))\n\n## [v14.0.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v14.0.0)\n\nThe most noteworthy change of this release is the update of the container's base image from Debian 11 (\"Bullseye\") to Debian 12 (\"Bookworm\"). This update alone involves breaking changes and requires a careful update!\n\n### Breaking\n\n- **Updated base image to Debian 12** ([#3403](https://github.com/docker-mailserver/docker-mailserver/pull/3403))\n  - Changed the default of `DOVECOT_COMMUNITY_REPO` to `0` (disabled) - the Dovecot community repo will (for now) not be the default when building the DMS.\n    - While Debian 12 (Bookworm) was released in June 2023 and the latest Dovecot `2.3.21` in Sep 2023, as of Jan 2024 there is no [Dovecot community repo available for Debian 12](https://repo.dovecot.org).\n    - This results in the Dovecot version being downgraded from `2.3.21` (DMS v13.3) to `2.3.19`, which [may affect functionality when you've explicitly configured for these features](https://github.com/dovecot/core/blob/30cde20f63650d8dcc4c7ad45418986f03159946/NEWS#L1-L158):\n      - OAuth2 (_mostly regarding JWT usage, or POST requests (`introspection_mode = post`) with `client_id` + `client_secret`_).\n      - Lua HTTP client (_DNS related_).\n  - Updated packages. For an overview, [we have a review comment on the PR that introduces Debian 12](https://github.com/docker-mailserver/docker-mailserver/pull/3403#issuecomment-1694563615)\n    - Notable major version bump: `openssl 3`, `clamav 1`, `spamassassin 4`, `redis-server 7`.\n    - Notable minor version bump: `postfix 3.5.23 => 3.7.9`\n    - Notable minor version bump + downgrade: `dovecot 2.3.13 => 2.3.19` (_Previous release provided `2.3.21` via community repo, `2.3.19` is now the default_)\n  - Updates to `packages.sh`:\n    - Removed custom installations of Fail2Ban, getmail6 and Rspamd\n    - Updated packages lists and added comments for maintainability\n- OpenDMARC upgrade: `v1.4.0` => `v1.4.2` ([#3841](https://github.com/docker-mailserver/docker-mailserver/pull/3841))\n  - Previous versions of OpenDMARC would place incoming mail from domains announcing `p=quarantaine` (_that fail the DMARC check_) into the [Postfix \"hold\" queue](https://www.postfix.org/QSHAPE_README.html#hold_queue) until administrative intervention.\n  - [OpenDMARC v1.4.2 has disabled that feature by default](https://github.com/trusteddomainproject/OpenDMARC/issues/105), but it can be enabled again by adding the setting `HoldQuarantinedMessages true` to [`/etc/opendmarc.conf`](https://github.com/docker-mailserver/docker-mailserver/blob/v13.3.1/target/opendmarc/opendmarc.conf) (_provided from DMS_).\n    - [Our `user-patches.sh` feature](https://docker-mailserver.github.io/docker-mailserver/latest/config/advanced/override-defaults/user-patches/) provides a convenient approach to updating that config file.\n    - Please let us know if you disagree with the upstream default being carried with DMS, or the value of providing alternative configuration support within DMS.\n- **Postfix:**\n  - Postfix upgrade from 3.5 to 3.7 ([#3403](https://github.com/docker-mailserver/docker-mailserver/pull/3403))\n    - `compatibility_level` was raised from `2` to `3.6`\n    - Postfix has deprecated the usage of `whitelist` / `blacklist` in config parameters and logging in favor of `allowlist` / `denylist` and similar variations. ([#3403](https://github.com/docker-mailserver/docker-mailserver/pull/3403/files#r1306356328))\n      - This [may affect monitoring / analysis of logs output from Postfix](https://www.postfix.org/COMPATIBILITY_README.html#respectful_logging) that expects to match patterns on the prior terminology used.\n      - DMS `main.cf` has renamed `postscreen_dnsbl_whitelist_threshold` to `postscreen_dnsbl_allowlist_threshold` as part of this change.\n    - `smtpd_relay_restrictions` (relay policy) is now evaluated after `smtpd_recipient_restrictions` (spam policy). Previously it was evaluated before `smtpd_recipient_restrictions`. Mail to be relayed via DMS must now pass through the spam policy first.\n    - The TLS fingerprint policy has changed the default from MD5 to SHA256 (_DMS does not modify this Postfix parameter, but may affect any user customizations that do_).\n- **Dovecot**\n  - The \"Junk\" mailbox (folder) is now referenced by it's [special-use flag `\\Junk`](https://docker-mailserver.github.io/docker-mailserver/v13.3/examples/use-cases/imap-folders/) instead of an explicit mailbox. ([#3925](https://github.com/docker-mailserver/docker-mailserver/pull/3925))\n    - This provides compatibility for the Junk mailbox when it's folder name differs (_eg: Renamed to \"Spam\"_).\n    - Potential breakage if your deployment modifies our `spam_to_junk.sieve` sieve script (_which is created during container startup when ENV `MOVE_SPAM_TO_JUNK=1`_) that handles storing spam mail into a users \"Junk\" mailbox folder.\n  - **Removed support for Solr integration:** ([#4025](https://github.com/docker-mailserver/docker-mailserver/pull/4025))\n    - This was a community contributed feature for FTS (Full Text Search), the docs advise using an image that has not been maintained for over 2 years and lacks ARM64 support. Based on user engagement over the years this feature has very niche value to continue to support, thus is being removed.\n    - If you use Solr, support can be restored if you're willing to contribute docs for the feature that resolves the concerns raised\n- **Log:**\n  - The format of DMS specific logs (_from our scripts, not running services_) has been changed. The new format is `<RFC 3339 TIMESTAMP> <LOG LEVEL> <LOG EVENT SRC>: <MESSAGE>` ([#4035](https://github.com/docker-mailserver/docker-mailserver/pull/4035))\n- **rsyslog:**\n  - Debian 12 adjusted the `rsyslog` configuration for the default file template from `RSYSLOG_TraditionalFileFormat` to `RSYSLOG_FileFormat` (_upstream default since 2012_). This change may affect you if you have any monitoring / analysis of log output (_eg: `mail.log` / `docker logs`_).\n    - The two formats are roughly equivalent to [RFC 3164](https://www.rfc-editor.org/rfc/rfc3164)) and [RFC 5424](https://datatracker.ietf.org/doc/html/rfc5424#section-1) respectively.\n    - A notable difference is the change to [RFC 3339](https://www.rfc-editor.org/rfc/rfc3339.html#appendix-A) timestamps (_a strict subset of ISO 8601_). The [previous non-standardized timestamp format was defined in RFC 3164](https://www.rfc-editor.org/rfc/rfc3164.html#section-4.1.2) as `Mmm dd hh:mm:ss`.\n    - To revert this change you can add `sedfile -i '1i module(load=\"builtin:omfile\" template=\"RSYSLOG_TraditionalFileFormat\")' /etc/rsyslog.conf` via [our `user-patches.sh` feature](https://docker-mailserver.github.io/docker-mailserver/v14.0/config/advanced/override-defaults/user-patches/).\n  - Rsyslog now creates fewer log files:\n    - The files `/var/log/mail/mail.{info,warn,err}` are no longer created. These files represented `/var/log/mail.log` filtered into separate priority levels. As `/var/log/mail.log` contains all mail related messages, these files (_and their rotated counterparts_) can be deleted safely.\n    - `/var/log/messages`, `/var/log/debug` and several other log files not relevant to DMS were configured by default by Debian previously. These are not part of the `/var/log/mail/` volume mount, so should not impact anyone.\n- **Features:**\n  - The relay host feature was refactored ([#3845](https://github.com/docker-mailserver/docker-mailserver/pull/3845))\n    - The only breaking change this should introduce is with the Change Detection service (`check-for-changes.sh`).\n    - When credentials are configured for relays, change events that trigger the relayhost logic now reapply the relevant Postfix settings:\n      - `smtp_sasl_auth_enable = yes` (_SASL auth to outbound MTA connections is enabled_)\n      - `smtp_sasl_security_options = noanonymous` (_credentials are mandatory for outbound mail delivery_)\n      - `smtp_tls_security_level = encrypt` (_the outbound MTA connection must always be secure due to credentials sent_)\n- **Environment Variables:**\n  - `SA_SPAM_SUBJECT` has been renamed into `SPAM_SUBJECT` to become anti-spam service agnostic. ([#3820](https://github.com/docker-mailserver/docker-mailserver/pull/3820))\n    - As this functionality is now handled in Dovecot via a Sieve script instead of the respective anti-spam service during Postfix processing, this feature will only apply to mail stored in Dovecot. If you have relied on this feature in a different context, it will no longer be available.\n    - Rspamd previously handled this functionality via the `rewrite_subject` action which as now been disabled by default in favor of the new approach with `SPAM_SUBJECT`.\n    - `SA_SPAM_SUBJECT` is now deprecated and will log a warning if used. The value is copied as a fallback to `SPAM_SUBJECT`.\n    - The default has changed to not prepend any prefix to the subject unless configured to do so. If you relied on the implicit prefix, you will now need to provide one explicitly.\n    - `undef` was previously supported as an opt-out with `SA_SPAM_SUBJECT`. This is no longer valid, the equivalent opt-out value is now an empty value (_or rather the omission of this ENV being configured_).\n    - The feature to include [`_SCORE_` tag](https://spamassassin.apache.org/full/4.0.x/doc/Mail_SpamAssassin_Conf.html#rewrite_header-subject-from-to-STRING) in your value to be replaced by the associated spam score is no longer available.\n- **Supervisord:**\n  - `supervisor-app.conf` renamed to `dms-services.conf` ([#3908](https://github.com/docker-mailserver/docker-mailserver/pull/3908))\n- **Rspamd:**\n  - The Redis history key has been changed in order to not incorporate the hostname of the container (which is desirable in Kubernetes environments) ([#3927](https://github.com/docker-mailserver/docker-mailserver/pull/3927))\n- **Account Management:**\n  - Addresses (accounts) are now normalized to lowercase automatically and a warning is logged in case uppercase letters are supplied ([#4033](https://github.com/docker-mailserver/docker-mailserver/pull/4033))\n\n### Added\n\n- **Documentation:**\n  - A guide for configuring a public server to relay inbound and outbound mail from DMS on a private server ([#3973](https://github.com/docker-mailserver/docker-mailserver/pull/3973))\n- **Environment Variables:**\n  - `LOGROTATE_COUNT` defines the number of files kept by logrotate ([#3907](https://github.com/docker-mailserver/docker-mailserver/pull/3907))\n    - The fail2ban log file is now also taken into account by `LOGROTATE_COUNT` and `LOGROTATE_INTERVAL` ([#3915](https://github.com/docker-mailserver/docker-mailserver/pull/3915), [#3919](https://github.com/docker-mailserver/docker-mailserver/pull/3919))\n\n- **Internal:**\n  - Regular container restarts are now better supported. Setup scripts that ran previously will now be skipped ([#3929](https://github.com/docker-mailserver/docker-mailserver/pull/3929))\n\n### Updates\n\n- **Environment Variables:**\n  - `ONE_DIR` has been removed (legacy ENV) ([#3840](https://github.com/docker-mailserver/docker-mailserver/pull/3840))\n    - It's only functionality remaining was to opt-out of run-time state consolidation with `ONE_DIR=0` (_when a volume was already mounted to `/var/mail-state`_).\n- **Internal:**\n  - Changed the Postgrey whitelist retrieved during build to  [source directly from Github](https://github.com/schweikert/postgrey/blob/master/postgrey_whitelist_clients) as the list is updated more frequently than the [author publishes at their website](https://postgrey.schweikert.ch) ([#3879](https://github.com/docker-mailserver/docker-mailserver/pull/3879))\n  - Enable spamassassin only, when amavis is enabled too. ([#3943](https://github.com/docker-mailserver/docker-mailserver/pull/3943))\n- **Tests:**\n  - Refactored helper methods for sending e-mails with specific `Message-ID` headers and the helpers for retrieving + filtering logs, which together help isolate logs relevant to specific mail when multiple mails have been processed within a single test. ([#3786](https://github.com/docker-mailserver/docker-mailserver/pull/3786))\n- **Rspamd:**\n  - The `rewrite_subject` action, is now disabled by default. It has been replaced with the new `SPAM_SUBJECT` environment variable, which implements the functionality via a Sieve script instead which is anti-spam service agnostic ([#3820](https://github.com/docker-mailserver/docker-mailserver/pull/3820))\n  - `RSPAMD_NEURAL` was added and is disabled by default. If switched on it will enable the experimental Rspamd \"Neural network\" module to add a layer of analysis to spam detection ([#3833](https://github.com/docker-mailserver/docker-mailserver/pull/3833))\n  - The symbol weights of SPF, DKIM and DMARC have been adjusted again. Fixes a bug and includes more appropriate combinations of symbols ([#3913](https://github.com/docker-mailserver/docker-mailserver/pull/3913), [#3923](https://github.com/docker-mailserver/docker-mailserver/pull/3923))\n- **Dovecot:**\n  - `logwatch` now filters out non-error logs related to the status of the `index-worker` process for FTS indexing. ([#4012](https://github.com/docker-mailserver/docker-mailserver/pull/4012))\n  - updated FTS Xapian from version 1.5.5 to 1.7.12\n\n### Fixes\n\n- DMS config:\n  - Files that are parsed line by line are now more robust to parse by detecting and fixing line-endings ([#3819](https://github.com/docker-mailserver/docker-mailserver/pull/3819))\n  - The override config `postfix-main.cf` now retains custom parameters intended for use with `postfix-master.cf` ([#3880](https://github.com/docker-mailserver/docker-mailserver/pull/3880))\n- Variables related to Rspamd are declared as `readonly`, which would cause warnings in the log when being re-declared; we now guard against this issue ([#3837](https://github.com/docker-mailserver/docker-mailserver/pull/3837))\n- Relay host feature refactored ([#3845](https://github.com/docker-mailserver/docker-mailserver/pull/3845))\n  - `DEFAULT_RELAY_HOST` ENV can now also use the `RELAY_USER` + `RELAY_PASSWORD` ENV for supplying credentials.\n  - `RELAY_HOST` ENV no longer enforces configuring outbound SMTP to require credentials. Like `DEFAULT_RELAY_HOST` it can now configure a relay where credentials are optional.\n  - Restarting DMS should not be required when configuring relay hosts without these ENV, but solely via `setup relay ...`, as change detection events now apply relevant Postfix setting changes for supporting credentials too.\n- Rspamd configuration: Add a missing comma in `local_networks` so that all internal IP addresses are actually considered as internal ([#3862](https://github.com/docker-mailserver/docker-mailserver/pull/3862))\n- Ensure correct SELinux security context labels for files and directories moved to the mail-state volume during setup ([#3890](https://github.com/docker-mailserver/docker-mailserver/pull/3890))\n- Use correct environment variable for fetchmail ([#3901](https://github.com/docker-mailserver/docker-mailserver/pull/3901))\n- When using `ENABLE_GETMAIL=1` the undocumented internal location `/var/lib/getmail/` usage has been removed. Only the config volume `/tmp/docker-mailserver/getmail/` location is supported when Getmail has not been configured to deliver mail to Dovecot as advised in the DMS docs ([#4018](https://github.com/docker-mailserver/docker-mailserver/pull/4018))\n- Dovecot dummy accounts (_virtual alias workaround for dovecot feature `ENABLE_QUOTAS=1`_) now correctly matches the home location of the user for that alias ([#3997](https://github.com/docker-mailserver/docker-mailserver/pull/3997))\n\n## [v13.3.1](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v13.3.1)\n\n### Fixes\n\n- **Dovecot:**\n  - Restrict the auth mechanisms for PassDB configs we manage (oauth2, passwd-file, ldap) ([#3812](https://github.com/docker-mailserver/docker-mailserver/pull/3812))\n    - Prevents misleading auth failures from attempting to authenticate against a PassDB with incompatible auth mechanisms.\n    - When the new OAuth2 feature was enabled, it introduced false-positives with logged auth failures which triggered Fail2Ban to ban the IP.\n- **Rspamd:**\n  - Ensure correct ownership (`_rspamd:_rspamd`) for the Rspamd DKIM directory + files `/tmp/docker-mailserver/rspamd/dkim/` ([#3813](https://github.com/docker-mailserver/docker-mailserver/pull/3813))\n\n## [v13.3.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v13.3.0)\n\n### Features\n\n- **Authentication with OIDC / OAuth 2.0** üéâ\n  - DMS now supports authentication via OAuth2 (_via `XOAUTH2` or `OAUTHBEARER` SASL mechanisms_) from capable services (_like Roundcube_).\n    - This does not replace the need for an `ACCOUNT_PROVISIONER` (`FILE` / `LDAP`), which is required for an account to receive or send mail.\n    - Successful authentication (_via Dovecot PassDB_) still requires an existing account (_lookup via Dovecot UserDB_).\n- **MTA-STS** (_Optional support for mandatory outgoing TLS encryption_)\n  - If enabled and the outbound recipient has an MTA-STS policy set, TLS is mandatory for delivering to that recipient.\n    - Enable via the ENV `ENABLE_MTA_STS=1`\n    - Supported by major email service providers like Gmail, Yahoo and Outlook.\n\n### Added\n\n- **Documentation:**\n  - An example for how to bind outbound SMTP connections to a specific network interface ([#3465](https://github.com/docker-mailserver/docker-mailserver/pull/3465))\n\n### Updates\n\n- **Tests:**\n  - Revised OAuth2 test ([#3795](https://github.com/docker-mailserver/docker-mailserver/pull/3795))\n  - Replace `wc -l` with `grep -c` ([#3752](https://github.com/docker-mailserver/docker-mailserver/pull/3752))\n  - Revised testing of service process management (supervisord) to be more robust ([#3780](https://github.com/docker-mailserver/docker-mailserver/pull/3780))\n  - Refactored mail sending ([#3747](https://github.com/docker-mailserver/docker-mailserver/pull/3747) & [#3772](https://github.com/docker-mailserver/docker-mailserver/pull/3772)):\n    - This change is a follow-up to [#3732](https://github.com/docker-mailserver/docker-mailserver/pull/3732) from DMS v13.2.\n    - `swaks` version is now the latest from Github releases instead of the Debian package.\n    - `_nc_wrapper`, `_send_mail` and related helpers expect the `.txt` filepath extension again.\n    - `sending.bash` helper methods were refactored to better integrate `swaks` and accommodate different usage contexts.\n    - `test/files/emails/existing/` files were removed similar to previous removal of SMTP auth files as they became redundant with `swaks`.\n- **Internal:**\n  - Postfix is now configured with `smtputf8_enable = no` in our default `main.cf` config (_instead of during container startup_). ([#3750](https://github.com/docker-mailserver/docker-mailserver/pull/3750))\n- **Rspamd:** ([#3726](https://github.com/docker-mailserver/docker-mailserver/pull/3726)):\n  - Symbol scores for SPF, DKIM & DMARC were updated to more closely align with [RFC7489](https://www.rfc-editor.org/rfc/rfc7489#page-24). Please note that complete alignment is undesirable as other symbols may be added as well, which changes the overall score calculation again, see [this issue](https://github.com/docker-mailserver/docker-mailserver/issues/3690#issuecomment-1866871996)\n- **Documentation:**\n  - Revised the SpamAssassin ENV docs to better communicate configuration and their relation to other ENV settings. ([#3756](https://github.com/docker-mailserver/docker-mailserver/pull/3756))\n  - Detailed how mail received is assigned a spam score by Rspamd and processed accordingly ([#3773](https://github.com/docker-mailserver/docker-mailserver/pull/3773))\n\n### Fixes\n\n- **Setup:**\n  - `setup` CLI - `setup dkim domain` now creates the keys files with the user owning the key directory ([#3783](https://github.com/docker-mailserver/docker-mailserver/pull/3783))\n- **Dovecot:**\n  - During container startup for Dovecot Sieve, `.sievec` source files compiled to `.svbin` now have their `mtime` adjusted post setup to ensure it is always older than the associated `.svbin` file. This avoids superfluous error logs for sieve scripts that don't actually need to be compiled again ([#3779](https://github.com/docker-mailserver/docker-mailserver/pull/3779))\n- **Internal:**\n  - `.gitattributes`: Always use LF line endings on checkout for files with shell script content ([#3755](https://github.com/docker-mailserver/docker-mailserver/pull/3755))\n  - Fix missing 'jaq' binary for ARM architecture ([#3766](https://github.com/docker-mailserver/docker-mailserver/pull/3766))\n\n## [v13.2.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v13.2.0)\n\n### Security\n\nDMS is now secured against the [recently published spoofing attack \"SMTP Smuggling\"](https://www.postfix.org/smtp-smuggling.html) that affected Postfix ([#3727](https://github.com/docker-mailserver/docker-mailserver/pull/3727)):\n\n- Postfix upgraded from `3.5.18` to `3.5.23` which provides the [long-term fix with `smtpd_forbid_bare_newline = yes`](https://www.postfix.org/smtp-smuggling.html#long)\n- If you are unable to upgrade to this release of DMS, you may follow [these instructions](https://github.com/docker-mailserver/docker-mailserver/issues/3719#issuecomment-1870865118) for applying the [short-term workaround](https://www.postfix.org/smtp-smuggling.html#short).\n- This change should not cause compatibility concerns for legitimate mail clients, however if you use software like `netcat` to send mail to DMS (_like our test-suite previously did_) it may now be rejected (_especially with the the short-term workaround `smtpd_data_restrictions = reject_unauth_pipelining`_).\n- **NOTE:** This Postfix update also includes the new parameter [`smtpd_forbid_bare_newline_exclusions`](https://www.postfix.org/postconf.5.html#smtpd_forbid_bare_newline_exclusions) which defaults to `$mynetworks` for excluding trusted mail clients excluded from the restriction.\n  - With our default `PERMIT_DOCKER=none` this is not a concern.\n  - Presently the Docker daemon config has `user-proxy: true` enabled by default.\n    - On a host that can be reached by IPv6, this will route to a DMS IPv4 only container implicitly through the Docker network bridge gateway which rewrites the source address.\n    - If your `PERMIT_DOCKER` setting allows that gateway IP, then it is part of `$mynetworks` and this attack would not be prevented from such connections.\n    - If this affects your deployment, refer to [our IPv6 docs](https://docker-mailserver.github.io/docker-mailserver/v13.2/config/advanced/ipv6/) for advice on handling IPv6 correctly in Docker. Alternatively [use our `postfix-main.cf`](https://docker-mailserver.github.io/docker-mailserver/v13.2/config/advanced/override-defaults/postfix/) to set `smtpd_forbid_bare_newline_exclusions=` as empty.\n\n### Updates\n\n- The test suite now uses `swaks` instead of `nc`, which has multiple benefits ([#3732](https://github.com/docker-mailserver/docker-mailserver/pull/3732)):\n  - `swaks` handles pipelining correctly, hence we can now use `reject_unauth_pipelining` in Postfix's configuration.\n  - `swaks` provides better CLI options that make many files superflous.\n  - `swaks` can also replace `openssl s_client` and handles authentication on submission ports better.\n- **Postfix:**\n  - We now defer rejection from unauthorized pipelining until the SMTP `DATA` command via `smtpd_data_restrictions` (_i.e. at the end of the mail transfer transaction_) ([#3744](https://github.com/docker-mailserver/docker-mailserver/pull/3744))\n    - Prevously our configuration only handled this during the client and recipient restriction stages. Postfix will flag this activity when encountered, but the rejection now is handled at `DATA` where unauthorized pipelining would have been valid from this point.\n    - If you had the Amavis service enabled (default), this restriction was already in place. Otherwise the concerns expressed with `smtpd_data_restrictions = reject_unauth_pipelining` from the security section above apply. We have permitted trusted clients (_`$mynetworks` or authenticated_) to bypass this restriction.\n\n## [v13.1.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v13.1.0)\n\n### Added\n\n- **Dovecot:**\n  - ENV `ENABLE_IMAP` ([#3703](https://github.com/docker-mailserver/docker-mailserver/pull/3703))\n- **Tests:**\n  - You can now use `make run-local-instance` to run a DMS image that was built locally to test changes ([#3663](https://github.com/docker-mailserver/docker-mailserver/pull/3663))\n- **Internal:**\n  - Log a warning when update-check is enabled, but no stable release image is used ([#3684](https://github.com/docker-mailserver/docker-mailserver/pull/3684))\n\n### Updates\n\n- **Documentation:**\n  - Debugging - Raise awareness in the troubleshooting page for a common misconfiguration when deviating from our advice by using a bare domain ([#3680](https://github.com/docker-mailserver/docker-mailserver/pull/3680))\n  - Debugging - Raise awareness of temporary downtime during certificate renewal that can cause a failure to deliver local mail ([#3718](https://github.com/docker-mailserver/docker-mailserver/pull/3718))\n- **Internal:**\n  - Postfix configures `virtual_mailbox_maps` and `virtual_transport` during startup instead of using defaults (configured for Dovecot) via our `main.cf` ([#3681](https://github.com/docker-mailserver/docker-mailserver/pull/3681))\n- **Rspamd:**\n  - Upgraded to version `3.7.5`. This was previously inconsistent between our AMD64 (`3.5`) and ARM64 (`3.4`) images ([#3686](https://github.com/docker-mailserver/docker-mailserver/pull/3686))\n\n### Fixed\n\n- **Internal:**\n  - The container startup welcome log message now references `DMS_RELEASE` ([#3676](https://github.com/docker-mailserver/docker-mailserver/pull/3676))\n  - `VERSION` was incremented for prior releases to be notified of the v13.0.1 patch release ([#3676](https://github.com/docker-mailserver/docker-mailserver/pull/3676))\n  - `VERSION` is no longer included in the image ([#3711](https://github.com/docker-mailserver/docker-mailserver/pull/3711))\n  - Update-check: fix 'read' exit status ([#3688](https://github.com/docker-mailserver/docker-mailserver/pull/3688))\n  - `ENABLE_QUOTAS=0` no longer tries to remove non-existent config ([#3715](https://github.com/docker-mailserver/docker-mailserver/pull/3715))\n  - The `postgrey` service now writes logs to the supervisor directory like all other services. Previously this was `/var/log/mail/mail.log` ([#3724](https://github.com/docker-mailserver/docker-mailserver/pull/3724))\n- **Rspamd:**\n  - Switch to official arm64 packages to avoid segfaults ([#3686](https://github.com/docker-mailserver/docker-mailserver/pull/3686))\n- **CI / Automation:**\n  - The lint workflow can now be manually triggered by maintainers ([#3714]https://github.com/docker-mailserver/docker-mailserver/pull/3714)\n\n## [v13.0.1](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v13.0.1)\n\nThis patch release fixes two bugs that Rspamd users encountered with the `v13.0.0` release. Big thanks to the those that helped to identify these issues! ‚ù§Ô∏è\n\n### Fixed\n\n- **Internal:**\n  - The update check service now queries the latest GH release for a version tag (_instead of from a `VERSION` file at the GH repo_). This should provide more reliable update notifications ([#3666](https://github.com/docker-mailserver/docker-mailserver/pull/3666))\n- **Rspamd:**\n  - The check for correct permission on the private key when signing e-mails with DKIM was flawed. The result was that a false warning was emitted ([#3669](https://github.com/docker-mailserver/docker-mailserver/pull/3669))\n  - When [`RSPAMD_CHECK_AUTHENTICATED=0`][docs::env-rspamd-check-auth], DKIM signing for outbound e-mail was disabled, which is undesirable ([#3669](https://github.com/docker-mailserver/docker-mailserver/pull/3669)). **Make sure to check the documentation of [`RSPAMD_CHECK_AUTHENTICATED`][docs::env-rspamd-check-auth]**!\n\n[docs::env-rspamd-check-auth]: https://docker-mailserver.github.io/docker-mailserver/v13.0/config/environment/#rspamd_check_authenticated\n\n## [v13.0.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v13.0.0)\n\n### Breaking\n\n- **LDAP:**\n  - ENV `LDAP_SERVER_HOST`, `DOVECOT_URIS`, and `SASLAUTHD_LDAP_SERVER` will now log an error if the LDAP URI scheme is missing. Previously there was an implicit fallback to `ldap://` ([#3522](https://github.com/docker-mailserver/docker-mailserver/pull/3522))\n  - `ENABLE_LDAP=1` is no longer supported, please use `ACCOUNT_PROVISIONER=LDAP` ([#3507](https://github.com/docker-mailserver/docker-mailserver/pull/3507))\n- **Rspamd:**\n  - The deprecated path for the Rspamd custom commands file (`/tmp/docker-mailserver/rspamd-modules.conf`) now prevents successful startup. The correct path is `/tmp/docker-mailserver/rspamd/custom-commands.conf`.\n- **Dovecot:**\n  - Dovecot mail storage per account in `/var/mail` previously shared the same path for the accounts home directory ([#3335](https://github.com/docker-mailserver/docker-mailserver/pull/3335))\n    - The home directory now is a subdirectory `home/`. This change better supports sieve scripts.\n    - **NOTE:** The change has not yet been implemented for `ACCOUNT_PROVISIONER=LDAP`.\n- **Postfix:**\n  - `/etc/postfix/master.cf` has renamed the \"smtps\" service to \"submissions\" ([#3235](https://github.com/docker-mailserver/docker-mailserver/pull/3235))\n    - This is the modern `/etc/services` name for port 465, aligning with the similar \"submission\" port 587.\n    - If you have configured Proxy Protocol support with a reverse proxy via `postfix-master.cf` (_as [per our docs guide](https://docker-mailserver.github.io/docker-mailserver/v13.0/examples/tutorials/mailserver-behind-proxy/)_), you will want to update `smtps` to `submissions` there.\n  - Postfix now defaults to supporting DSNs (_[Delivery Status Notifications](https://github.com/docker-mailserver/docker-mailserver/pull/3572#issuecomment-1751880574)_) only for authenticated users (_via ports 465 + 587_). This is a security measure to reduce spammer abuse of your DMS instance as a backscatter source. ([#3572](https://github.com/docker-mailserver/docker-mailserver/pull/3572))\n    - If you need to modify this change, please let us know by opening an issue / discussion.\n    - You can [opt out (_enable DSNs_) via the `postfix-main.cf` override support](https://docker-mailserver.github.io/docker-mailserver/v12.1/config/advanced/override-defaults/postfix/) using the contents: `smtpd_discard_ehlo_keywords =`.\n    - Likewise for authenticated users, the submission(s) ports (465 + 587) are configured internally via `master.cf` to keep DSNs enabled (_since authentication protects from abuse_).\n\n      If necessary, DSNs for authenticated users can be disabled via the `postfix-master.cf` override with the following contents:\n\n      ```cf\n      submission/inet/smtpd_discard_ehlo_keywords=silent-discard,dsn\n      submissions/inet/smtpd_discard_ehlo_keywords=silent-discard,dsn\n      ```\n\n### Added\n\n- **Features:**\n  - `getmail` as an alternative to `fetchmail` ([#2803](https://github.com/docker-mailserver/docker-mailserver/pull/2803))\n  - `setup` CLI - `setup fail2ban` gained a new `status <JAIL>` subcommand ([#3455](https://github.com/docker-mailserver/docker-mailserver/pull/3455))\n- **Environment Variables:**\n  - `MARK_SPAM_AS_READ`. When set to `1`, marks incoming spam as \"read\" to avoid unwanted \"new mail\" notifications for junk mail ([#3489](https://github.com/docker-mailserver/docker-mailserver/pull/3489))\n  - `DMS_VMAIL_UID` and `DMS_VMAIL_GID` allow changing the default ID values (`5000:5000`) for the Dovecot vmail user and group ([#3550](https://github.com/docker-mailserver/docker-mailserver/pull/3550))\n  - `RSPAMD_CHECK_AUTHENTICATED` allows authenticated users to avoid additional security checks by Rspamd ([#3440](https://github.com/docker-mailserver/docker-mailserver/pull/3440))\n- **Documentation:**\n  - Use-case examples / tutorials:\n    - iOS mail push support ([#3513](https://github.com/docker-mailserver/docker-mailserver/pull/3513))\n    - Guide for setting up Dovecot Authentication via Lua ([#3579](https://github.com/docker-mailserver/docker-mailserver/pull/3579))\n    - Guide for integrating with the Crowdsec service ([#3651](https://github.com/docker-mailserver/docker-mailserver/pull/3651))\n  - Debugging page:\n    - New compatibility section ([#3404](https://github.com/docker-mailserver/docker-mailserver/pull/3404))\n    - Now advises how to (re)start DMS correctly ([#3654](https://github.com/docker-mailserver/docker-mailserver/pull/3654))\n  - Better communicate distinction between DMS FQDN and DMS mail accounts ([#3372](https://github.com/docker-mailserver/docker-mailserver/pull/3372))\n  - Traefik example now includes `passthrough=true` on implicit ports ([#3568](https://github.com/docker-mailserver/docker-mailserver/pull/3568))\n  - Rspamd docs have received a variety of revisions ([#3318](https://github.com/docker-mailserver/docker-mailserver/pull/3318), [#3325](https://github.com/docker-mailserver/docker-mailserver/pull/3325), [#3329](https://github.com/docker-mailserver/docker-mailserver/pull/3329))\n  - IPv6 config examples with content tabs ([#3436](https://github.com/docker-mailserver/docker-mailserver/pull/3436))\n  - Mention [internet.nl](https://internet.nl/test-mail/) as another testing service ([#3445](https://github.com/docker-mailserver/docker-mailserver/pull/3445))\n  - `setup alias add ...` CLI help message now includes an example for aliasing to multiple recipients ([#3600](https://github.com/docker-mailserver/docker-mailserver/pull/3600))\n  - `SPAMASSASSIN_SPAM_TO_INBOX=1`, now emits a debug log to raise awareness that `SA_KILL` will be ignored ([#3360](https://github.com/docker-mailserver/docker-mailserver/pull/3360))\n  - `CLAMAV_MESSAGE_SIZE_LIMIT` now logs a warning when the value exceeds what ClamAV is capable of supporting (4GiB max scan size [#3332](https://github.com/docker-mailserver/docker-mailserver/pull/3332), 2GiB max file size [#3341](https://github.com/docker-mailserver/docker-mailserver/pull/3341))\n  - Added note to caution against changing `mydestination` in Postfix's `main.cf` ([#3316](https://github.com/docker-mailserver/docker-mailserver/pull/3316))\n- **Internal:**\n  - Added a wrapper to update Postfix configuration safely ([#3484](https://github.com/docker-mailserver/docker-mailserver/pull/3484), [#3503](https://github.com/docker-mailserver/docker-mailserver/pull/3503))\n  - Add debug group to `packages.sh` ([#3578](https://github.com/docker-mailserver/docker-mailserver/pull/3578))\n- **Tests:**\n  - Additional linting check for BASH syntax ([#3369](https://github.com/docker-mailserver/docker-mailserver/pull/3369))\n\n### Updates\n\n- **Misc:**\n  - Changed `setup config dkim` default key size to `2048` (`open-dkim`) ([#3508](https://github.com/docker-mailserver/docker-mailserver/pull/3508))\n- **Postfix:**\n  - Dropped special bits from `maildrop/` and `public/` directory permissions ([#3625](https://github.com/docker-mailserver/docker-mailserver/pull/3625))\n- **Rspamd:**\n  - Adjusted learning of ham ([#3334](https://github.com/docker-mailserver/docker-mailserver/pull/3334))\n  - Adjusted `antivirus.conf` ([#3331](https://github.com/docker-mailserver/docker-mailserver/pull/3331))\n  - `logrotate` setup + Rspamd log path + tests log helper fallback path ([#3576](https://github.com/docker-mailserver/docker-mailserver/pull/3576))\n  - Setup during container startup is now more resilient ([#3578](https://github.com/docker-mailserver/docker-mailserver/pull/3578))\n  - Changed DKIM default config location ([#3597](https://github.com/docker-mailserver/docker-mailserver/pull/3597))\n  - Removed the symlink for the `override.d/` directory in favor of using `cp`, integrated into the changedetector service, added a `--force` option for the Rspamd DKIM management, and provided a dedicated helper script for common ENV variables ([#3599](https://github.com/docker-mailserver/docker-mailserver/pull/3599))\n  - Required permissions are now verified for DKIM private key files ([#3627](https://github.com/docker-mailserver/docker-mailserver/pull/3627))\n- **Documentation:**\n  - Documentation aligned to Compose v2 conventions, `docker-compose` command changed to `docker compose`, `docker-compose.yaml` to `compose.yaml` ([#3295](https://github.com/docker-mailserver/docker-mailserver/pull/3295))\n  - Restored missing edit button ([#3338](https://github.com/docker-mailserver/docker-mailserver/pull/3338))\n  - Complete rewrite of the IPv6 page ([#3244](https://github.com/docker-mailserver/docker-mailserver/pull/3244), [#3531](https://github.com/docker-mailserver/docker-mailserver/pull/3531))\n  - Complete rewrite of the \"Update and Cleanup\" maintenance page ([#3539](https://github.com/docker-mailserver/docker-mailserver/pull/3539), [#3583](https://github.com/docker-mailserver/docker-mailserver/pull/3583))\n  - Improved debugging page advice on working with logs ([#3626](https://github.com/docker-mailserver/docker-mailserver/pull/3626), [#3640](https://github.com/docker-mailserver/docker-mailserver/pull/3640))\n  - Clarified the default for ENV `FETCHMAIL_PARALLEL` ([#3603](https://github.com/docker-mailserver/docker-mailserver/pull/3603))\n  - Removed port 25 from FAQ entry for mail client ports supporting authenticated submission ([#3496](https://github.com/docker-mailserver/docker-mailserver/pull/3496))\n  - Updated home path in docs for Dovecot Sieve ([#3370](https://github.com/docker-mailserver/docker-mailserver/pull/3370), [#3650](https://github.com/docker-mailserver/docker-mailserver/pull/3650))\n  - Fixed path to `rspamd.log` ([#3585](https://github.com/docker-mailserver/docker-mailserver/pull/3585))\n  - \"Optional Config\" page now uses consistent lowercase convention for directory names ([#3629](https://github.com/docker-mailserver/docker-mailserver/pull/3629))\n  - `CONTRIBUTORS.md`: Removed redundant \"All Contributors\" section ([#3638](https://github.com/docker-mailserver/docker-mailserver/pull/3638))\n- **Internal:**\n  - LDAP config improvements (Removed implicit `ldap://` LDAP URI scheme fallback) ([#3522](https://github.com/docker-mailserver/docker-mailserver/pull/3522))\n  - Changed style conventions for internal scripts ([#3361](https://github.com/docker-mailserver/docker-mailserver/pull/3361), [#3364](https://github.com/docker-mailserver/docker-mailserver/pull/3364), [#3365](https://github.com/docker-mailserver/docker-mailserver/pull/3365), [#3366](https://github.com/docker-mailserver/docker-mailserver/pull/3366), [#3368](https://github.com/docker-mailserver/docker-mailserver/pull/3368), [#3464](https://github.com/docker-mailserver/docker-mailserver/pull/3464))\n- **CI / Automation:**\n  - `.gitattributes` now ensures files are committed with `eol=lf` ([#3527](https://github.com/docker-mailserver/docker-mailserver/pull/3527))\n  - Revised the GitHub issue bug report template ([#3317](https://github.com/docker-mailserver/docker-mailserver/pull/3317), [#3381](https://github.com/docker-mailserver/docker-mailserver/pull/3381), [#3435](https://github.com/docker-mailserver/docker-mailserver/pull/3435))\n  - Clarified that the issue tracker is not for personal support ([#3498](https://github.com/docker-mailserver/docker-mailserver/pull/3498), [#3502](https://github.com/docker-mailserver/docker-mailserver/pull/3502))\n  - Bumped versions of miscellaneous software (also shoutout to @dependabot) ([#3371](https://github.com/docker-mailserver/docker-mailserver/pull/3371), [#3584](https://github.com/docker-mailserver/docker-mailserver/pull/3584), [#3504](https://github.com/docker-mailserver/docker-mailserver/pull/3504), [#3516](https://github.com/docker-mailserver/docker-mailserver/pull/3516))\n- **Tests:**\n  - Refactored LDAP tests to current conventions ([#3483](https://github.com/docker-mailserver/docker-mailserver/pull/3483))\n  - Changed OpenLDAP image to `bitnami/openldap` ([#3494](https://github.com/docker-mailserver/docker-mailserver/pull/3494))\n  - Revised LDAP config + setup ([#3514](https://github.com/docker-mailserver/docker-mailserver/pull/3514))\n  - Added tests for the helper function `_add_to_or_update_postfix_main()` ([#3505](https://github.com/docker-mailserver/docker-mailserver/pull/3505))\n  - EditorConfig Checker lint now uses a mount path to `/check` instead of `/ci` ([#3655](https://github.com/docker-mailserver/docker-mailserver/pull/3655))\n\n### Fixed\n\n- **Security:**\n  - Fixed issue with concatenating `$dmarc_milter` and `$dkim_milter` in `main.cf` ([#3380](https://github.com/docker-mailserver/docker-mailserver/pull/3380))\n  - Fixed Rspamd DKIM signing for inbound emails ([#3439](https://github.com/docker-mailserver/docker-mailserver/pull/3439), [#3453](https://github.com/docker-mailserver/docker-mailserver/pull/3453))\n  - OpenDKIM key generation is no longer broken when Rspamd is also enabled ([#3535](https://github.com/docker-mailserver/docker-mailserver/pull/3535))\n- **Internal:**\n  - The \"database\" files (_for managing users and aliases_) now correctly filters within lookup query ([#3359](https://github.com/docker-mailserver/docker-mailserver/pull/3359))\n  - `_setup_spam_to_junk()` no longer registered when `SMTP_ONLY=1` ([#3385](https://github.com/docker-mailserver/docker-mailserver/pull/3385))\n  - Dovecot `fts_xapian` is now compiled from source to match the Dovecot package ABI ([#3373](https://github.com/docker-mailserver/docker-mailserver/pull/3373))\n- **CI:**\n  - Scheduled build now have the correct permissions to run successfully ([#3345](https://github.com/docker-mailserver/docker-mailserver/pull/3345))\n- **Documentation:**\n  - Miscellaneous spelling and wording improvements ([#3324](https://github.com/docker-mailserver/docker-mailserver/pull/3324), [#3330](https://github.com/docker-mailserver/docker-mailserver/pull/3330), [#3337](https://github.com/docker-mailserver/docker-mailserver/pull/3337), [#3339](https://github.com/docker-mailserver/docker-mailserver/pull/3339), [#3344](https://github.com/docker-mailserver/docker-mailserver/pull/3344), [#3367](https://github.com/docker-mailserver/docker-mailserver/pull/3367), [#3411](https://github.com/docker-mailserver/docker-mailserver/pull/3411), [#3443](https://github.com/docker-mailserver/docker-mailserver/pull/3443))\n- **Tests:**\n  - Run `pgrep` within the actual container ([#3553](https://github.com/docker-mailserver/docker-mailserver/pull/3553))\n  - `lmtp_ip.bats` improved partial failure output ([#3552](https://github.com/docker-mailserver/docker-mailserver/pull/3552))\n  - Improvements to LDIF test data ([#3506](https://github.com/docker-mailserver/docker-mailserver/pull/3506))\n  - Normalized for `.gitattributes` + improved `eclint` coverage ([#3566](https://github.com/docker-mailserver/docker-mailserver/pull/3566))\n  - Fixed ShellCheck linting for BATS tests ([#3347](https://github.com/docker-mailserver/docker-mailserver/pull/3347))\n\n## [v12.1.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v12.1.0)\n\n### Added\n\n- Rspamd:\n  - note about Rspamd's web interface ([#3245](https://github.com/docker-mailserver/docker-mailserver/pull/3245))\n  - add greylisting option & code refactoring ([#3206](https://github.com/docker-mailserver/docker-mailserver/pull/3206))\n  - added `HFILTER_HOSTNAME_UNKNOWN` and make it configurable ([#3248](https://github.com/docker-mailserver/docker-mailserver/pull/3248))\n  - add option to re-enable `reject_unknown_client_hostname` after #3248 ([#3255](https://github.com/docker-mailserver/docker-mailserver/pull/3255))\n  - add DKIM helper script ([#3286](https://github.com/docker-mailserver/docker-mailserver/pull/3286))\n- make `policyd-spf` configurable ([#3246](https://github.com/docker-mailserver/docker-mailserver/pull/3246))\n- add 'log' command to set up for Fail2Ban ([#3299](https://github.com/docker-mailserver/docker-mailserver/pull/3299))\n- `setup` command now expects accounts and aliases to be mutually exclusive ([#3270](https://github.com/docker-mailserver/docker-mailserver/pull/3270))\n\n### Updated\n\n- update DKIM/DMARC/SPF docs ([#3231](https://github.com/docker-mailserver/docker-mailserver/pull/3231))\n- Fail2Ban:\n  - made config more aggressive ([#3243](https://github.com/docker-mailserver/docker-mailserver/pull/3243) & [#3288](https://github.com/docker-mailserver/docker-mailserver/pull/3288))\n  - update fail2ban config examples with current DMS default values ([#3258](https://github.com/docker-mailserver/docker-mailserver/pull/3258))\n  - make Fail2Ban log persistent ([#3269](https://github.com/docker-mailserver/docker-mailserver/pull/3269))\n  - update F2B docs & bind mount links ([#3293](https://github.com/docker-mailserver/docker-mailserver/pull/3293))\n- Rspamd:\n  - improve Rspamd docs ([#3257](https://github.com/docker-mailserver/docker-mailserver/pull/3257))\n  - script stabilization ([#3261](https://github.com/docker-mailserver/docker-mailserver/pull/3261) & [#3282](https://github.com/docker-mailserver/docker-mailserver/pull/3282))\n  - remove WIP warnings ([#3283](https://github.com/docker-mailserver/docker-mailserver/pull/3283))\n- improve shutdown function by making PANIC_STRATEGY obsolete ([#3265](https://github.com/docker-mailserver/docker-mailserver/pull/3265))\n- update `bug_report.yml` ([#3275](https://github.com/docker-mailserver/docker-mailserver/pull/3275))\n- simplify `bug_report.yml` ([#3276](https://github.com/docker-mailserver/docker-mailserver/pull/3276))\n- revised the contributor workflow ([#2227](https://github.com/docker-mailserver/docker-mailserver/pull/2227))\n\n### Changed\n\n- default registry changed from DockerHub (`docker.io`) to GHCR (`ghcr.io`) ([#3233](https://github.com/docker-mailserver/docker-mailserver/pull/3233))\n- consistent namings in docs ([#3242](https://github.com/docker-mailserver/docker-mailserver/pull/3242))\n- get all `policyd-spf` setup in one place ([#3263](https://github.com/docker-mailserver/docker-mailserver/pull/3263))\n- miscellaneous script improvements ([#3281](https://github.com/docker-mailserver/docker-mailserver/pull/3281))\n- update FAQ entries ([#3294](https://github.com/docker-mailserver/docker-mailserver/pull/3294))\n\n### Fixed\n\n- GitHub Actions docs update workflow ([#3241](https://github.com/docker-mailserver/docker-mailserver/pull/3241))\n- fix dovecot: ldap mail delivery works ([#3252](https://github.com/docker-mailserver/docker-mailserver/pull/3252))\n- shellcheck: do not check .git folder ([#3267](https://github.com/docker-mailserver/docker-mailserver/pull/3267))\n- add missing -E for extended regexes in `smtpd_sender_restrictions` ([#3272](https://github.com/docker-mailserver/docker-mailserver/pull/3272))\n- fix setting `SRS_EXCLUDE_DOMAINS` during startup ([#3271](https://github.com/docker-mailserver/docker-mailserver/pull/3271))\n- remove superfluous `EOF` in `dmarc_dkim_spf.sh` ([#3266](https://github.com/docker-mailserver/docker-mailserver/pull/3266))\n- apply fixes to helpers when using `set -eE` ([#3285](https://github.com/docker-mailserver/docker-mailserver/pull/3285))\n\n## [12.0.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v12.0.0)\n\nNotable changes are:\n\n- Rspamd feature is promoted from preview status\n- Services no longer use `chroot`\n- Fail2Ban major version upgrade\n- ARMv7 platform is no longer suppoted\n- TLS 1.2 is the minimum supported protocol\n- SMTP authentication on port 25 disabled\n- The value of `smtpd_sender_restrictions` for Postfix has replaced the value ([#3127](https://github.com/docker-mailserver/docker-mailserver/pull/3127)):\n  - In `main.cf` with `$dms_smtpd_sender_restrictions`\n  - In `master.cf` inbound submissions ports 465 + 587 extend this inherited `smtpd` restriction with `$mua_sender_restrictions`\n\n### Added\n\n- **security**: Rspamd support:\n  - integration into scripts, provisioning of configuration & documentation ([#2902](https://github.com/docker-mailserver/docker-mailserver/pull/2902),[#3016](https://github.com/docker-mailserver/docker-mailserver/pull/3016),[#3039](https://github.com/docker-mailserver/docker-mailserver/pull/3039))\n  - easily adjust options & modules ([#3059](https://github.com/docker-mailserver/docker-mailserver/pull/3059))\n  - advanced documentation ([#3104](https://github.com/docker-mailserver/docker-mailserver/pull/3104))\n  - make disabling Redis possible ([#3132](https://github.com/docker-mailserver/docker-mailserver/pull/3132))\n  - persistence for Redis ([#3143](https://github.com/docker-mailserver/docker-mailserver/pull/3143))\n  - integrate into `MOVE_SPAM_TO_JUNK` ([#3159](https://github.com/docker-mailserver/docker-mailserver/pull/3159))\n  - make it possible to learn from user actions ([#3159](https://github.com/docker-mailserver/docker-mailserver/pull/3159))\n- heavily updated CI & tests:\n  - added functionality to send mail with a helper function ([#3026](https://github.com/docker-mailserver/docker-mailserver/pull/3026),[#3103](https://github.com/docker-mailserver/docker-mailserver/pull/3103),[#3105](https://github.com/docker-mailserver/docker-mailserver/pull/3105))\n  - add a dedicated page for tests with more information ([#3019](https://github.com/docker-mailserver/docker-mailserver/pull/3019))\n- add information to Logwatch's mailer so `Envelope From` is properly set ([#3081](https://github.com/docker-mailserver/docker-mailserver/pull/3081))\n- add vulnerability scanning workflow & security policy ([#3106](https://github.com/docker-mailserver/docker-mailserver/pull/3106))\n- Add tools (ping & dig) to the image ([2989](https://github.com/docker-mailserver/docker-mailserver/pull/2989))\n\n### Updates\n\n- Fail2Ban major version updated to v1.0.2 ([#2959](https://github.com/docker-mailserver/docker-mailserver/pull/2959))\n- heavily updated CI & tests:\n  - we now run more tests in parallel bringing down overall time to build and test AMD64 to 6 minutes ([#2938](https://github.com/docker-mailserver/docker-mailserver/pull/2938),[#3038](https://github.com/docker-mailserver/docker-mailserver/pull/3038),[#3018](https://github.com/docker-mailserver/docker-mailserver/pull/3018),[#3062](https://github.com/docker-mailserver/docker-mailserver/pull/3062))\n  - remove CI ENV & disable fail-fast strategy ([#3065](https://github.com/docker-mailserver/docker-mailserver/pull/3065))\n  - streamlined GH Actions runners ([#3025](https://github.com/docker-mailserver/docker-mailserver/pull/3025))\n  - updated BATS & helper + minor updates to BATS variables ([#2988](https://github.com/docker-mailserver/docker-mailserver/pull/2988))\n  - improved consistency and documentation for test helpers ([#3012](https://github.com/docker-mailserver/docker-mailserver/pull/3012))\n- improve the `clean` recipe (don't require `sudo` anymore) ([#3020](https://github.com/docker-mailserver/docker-mailserver/pull/3020))\n- improve Amavis setup routine ([#3079](https://github.com/docker-mailserver/docker-mailserver/pull/3079))\n- completely refactor README & parts of docs ([#3097](https://github.com/docker-mailserver/docker-mailserver/pull/3097))\n- TLS setup (self-signed) error message now includes `SS_CA_CERT` ([#3168](https://github.com/docker-mailserver/docker-mailserver/pull/3168))\n- Better default value for SA_KILL variable ([#3058](https://github.com/docker-mailserver/docker-mailserver/pull/3058))\n\n### Fixed\n\n- `restrict-access` avoid inserting duplicates ([#3067](https://github.com/docker-mailserver/docker-mailserver/pull/3067))\n- correct the casing for Mime vs. MIME ([#3040](https://github.com/docker-mailserver/docker-mailserver/pull/3040))\n- Dovecot:\n  - Quota plugin is now properly configured via `mail_plugins` at setup ([#2958](https://github.com/docker-mailserver/docker-mailserver/pull/2958))\n  - `quota-status` service (port 65265) now only binds to `127.0.0.1` ([#3057](https://github.com/docker-mailserver/docker-mailserver/pull/3057))\n- OpenDMARC - Change default policy to reject ([#2933](https://github.com/docker-mailserver/docker-mailserver/pull/2933))\n- Change Detection service - Use service `reload` instead of restarting process to minimize downtime ([#2947](https://github.com/docker-mailserver/docker-mailserver/pull/2947))\n- Slightly faster container startup via `postconf` workaround ([#2998](https://github.com/docker-mailserver/docker-mailserver/pull/2998))\n- Better group ownership to `/var/mail-state` + ClamAV in `Dockerfile` ([#3011](https://github.com/docker-mailserver/docker-mailserver/pull/3011))\n- Dropping Postfix `chroot` mode:\n  - Remove syslog socket created by Debian ([#3134](https://github.com/docker-mailserver/docker-mailserver/pull/3134))\n  - Supervisor proxy signals for `postfix start-fg` via PID ([#3118](https://github.com/docker-mailserver/docker-mailserver/pull/3118))\n- Fixed several typos ([#2990](https://github.com/docker-mailserver/docker-mailserver/pull/2990)) ([#2993](https://github.com/docker-mailserver/docker-mailserver/pull/2993))\n- SRS setup fixed ([#3158](https://github.com/docker-mailserver/docker-mailserver/pull/3158))\n- Postsrsd restart loop fixed ([#3160](https://github.com/docker-mailserver/docker-mailserver/pull/3160))\n- Order of DKIM/DMARC milters matters ([#3082](https://github.com/docker-mailserver/docker-mailserver/pull/3082))\n- Make logrotate state persistant ([#3077](https://github.com/docker-mailserver/docker-mailserver/pull/3077))\n\n### Changed\n\n- the Dovecot community repository is now the default ([#2901](https://github.com/docker-mailserver/docker-mailserver/pull/2901))\n- moved SASL authentication socket location ([#3131](https://github.com/docker-mailserver/docker-mailserver/pull/3131))\n- only add Amavis configuration to Postfix when enabled ([#3046](https://github.com/docker-mailserver/docker-mailserver/pull/3046))\n- improve bug report template ([#3080](https://github.com/docker-mailserver/docker-mailserver/pull/3080))\n- remove Postfix DNSBLs ([#3069](https://github.com/docker-mailserver/docker-mailserver/pull/3069))\n- bigger script updates:\n  - split `setup-stack.sh` ([#3115](https://github.com/docker-mailserver/docker-mailserver/pull/3115))\n  - housekeeping & cleanup setup ([#3121](https://github.com/docker-mailserver/docker-mailserver/pull/3121),[#3123](https://github.com/docker-mailserver/docker-mailserver/pull/3123))\n  - issue warning in case of improper restart ([#3129](https://github.com/docker-mailserver/docker-mailserver/pull/3129))\n  - remove PostSRSD wrapper ([#3128](https://github.com/docker-mailserver/docker-mailserver/pull/3128))\n  - miscellaneous small improvements ([#3144](https://github.com/docker-mailserver/docker-mailserver/pull/3144))\n- improve Postfix config for spoof protection ([#3127](https://github.com/docker-mailserver/docker-mailserver/pull/3127))\n- Change Detection service - Remove 10 sec start-up delay ([#3064](https://github.com/docker-mailserver/docker-mailserver/pull/3064))\n- Postfix:\n  - Stop using `chroot` + remove wrapper script ([#3033](https://github.com/docker-mailserver/docker-mailserver/pull/3033))\n  - SMTP Authentication via port 25 disabled ([#3006](https://github.com/docker-mailserver/docker-mailserver/pull/3006))\n- Fail2Ban - Added support packages + remove wrapper script ([#3032](https://github.com/docker-mailserver/docker-mailserver/pull/3032))\n- Replace path with variable in mail_state.sh ([#3153](https://github.com/docker-mailserver/docker-mailserver/pull/3153))\n\n### Removed\n\n- configomat (submodule) ([#3045](https://github.com/docker-mailserver/docker-mailserver/pull/3045))\n- Due to deprecation:\n  - ARMv7 image support ([#2943](https://github.com/docker-mailserver/docker-mailserver/pull/2943))\n  - TLS 1.2 is now the minimum supported protocol ([#2945](https://github.com/docker-mailserver/docker-mailserver/pull/2945))\n  - ENV `SASL_PASSWD` ([#2946](https://github.com/docker-mailserver/docker-mailserver/pull/2946))\n- Redundant:\n  - Makefile `backup` target ([#3000](https://github.com/docker-mailserver/docker-mailserver/pull/3000))\n  - ENV `ENABLE_POSTFIX_VIRTUAL_TRANSPORT` ([#3004](https://github.com/docker-mailserver/docker-mailserver/pull/3004))\n  - `gamin` package ([#3030](https://github.com/docker-mailserver/docker-mailserver/pull/3030))\n\n## [11.3.1](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v11.3.1)\n\n### Fixed\n\n- **build**:  Fix dovecot-fts-xapian dependency, when using dovecot community repository ([#2937](https://github.com/docker-mailserver/docker-mailserver/pull/2937))\n\n## [11.3.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v11.3.0)\n\n### Added\n\n- **scripts**: Fail2ban - Enable network bans ([#2818](https://github.com/docker-mailserver/docker-mailserver/pull/2818))\n- **ci**: run tests in parallel ([#2857](https://github.com/docker-mailserver/docker-mailserver/pull/2857))\n- **docs**: added note about Docker version to documentation ([#2799](https://github.com/docker-mailserver/docker-mailserver/pull/2799))\n\n### Changed\n\n- **configuration**: Run fetchmail not in verbose mode ([#2859](https://github.com/docker-mailserver/docker-mailserver/pull/2859))\n- **build**: cleaned up `Makefile` and its targets ([#2833](https://github.com/docker-mailserver/docker-mailserver/pull/2833))\n- **configuration**: adjust handling of DNSBL return codes ([#2890](https://github.com/docker-mailserver/docker-mailserver/pull/2890))\n\n### Updates\n\n- **ci**: change to new output format in GH actions ([#2892](https://github.com/docker-mailserver/docker-mailserver/pull/2892))\n- **build**: cleaned up Makefile ([#2833](https://github.com/docker-mailserver/docker-mailserver/pull/2833))\n- **tests**: miscellaneous enhancements ([#2815](https://github.com/docker-mailserver/docker-mailserver/pull/2815))\n\n### Fixed\n\n- **scripts**: `./setup.sh email list` did not display aliases correctly ([#2877](https://github.com/docker-mailserver/docker-mailserver/issues/2877))\n- **scripts**: Improve error handling, when parameters are missing ([#2854](https://github.com/docker-mailserver/docker-mailserver/pull/2854))\n- **scripts**: Fix unbound variable error ([#2849](https://github.com/docker-mailserver/docker-mailserver/pull/2849), [#2853](https://github.com/docker-mailserver/docker-mailserver/pull/2853))\n- **scripts**: Make fetchmail data persistent ([#2851](https://github.com/docker-mailserver/docker-mailserver/pull/2851))\n- **scripts**: Run `user-patches.sh` right before starting daemons ([#2817](https://github.com/docker-mailserver/docker-mailserver/pull/2817))\n- **scripts**: Run Amavis cron job only when Amavis is enabled ([#2831](https://github.com/docker-mailserver/docker-mailserver/pull/2831))\n- **config**: `opendmarc.conf` - Change the default OpenDMARC policy to reject ([#2933](https://github.com/docker-mailserver/docker-mailserver/pull/2933))\n\n### Deprecation Notice\n\n- **Removing TLS 1.0 and TLS 1.1 ciphersuites from `TLS_LEVEL=intermediate`**\n  You should not realistically need support for TLS 1.0 or TLS 1.1, except in niche scenarios such as an old printer/scanner device that refuses to negotiate a compatible non-vulnerable cipher. [More details covered here](https://github.com/docker-mailserver/docker-mailserver/issues/2679).\n- **`SASL_PASSWD` ENV**\n  An old ENV `SASL_PASSWD` has been around for supporting relay-host authentication, but since superceded by the `postfix-sasl-password.cf` config file. It will be removed in a future major release as detailed [here](https://github.com/docker-mailserver/docker-mailserver/pull/2605).\n- **Platform Support - ARMv7**\n  This is a very old platform, superceded by ARMv8 and newer with broad product availability around 2016 onwards.\n  Support was introduced primarily for users of the older generations of Raspberry Pi. ARM64 is the modern target for ARM devices.\n\n  If you require ARMv7 support, [please let us know](https://github.com/docker-mailserver/docker-mailserver/issues/2642).\n\n## [11.2.0](https://github.com/docker-mailserver/docker-mailserver/releases/tag/v11.2.0)\n\n### Summary\n\nThis release features a lot of small and medium-sized changes, many related to how the image is build and tested during CI. The build now multi-stage based and requires Docker Buildkit, as the ClamAV Signatures are added via `COPY --link ...` during build-time.\n\n### Deprecated\n\n- The environment variable `ENABLE_LDAP` is deprecated and will be removed in [13.0.0]. Use `ACCOUNT_PROVISIONER=LDAP` now.\n\n### Added\n\n- **documentation**: improve cron tasks documentation and fix link in documentation\n- **documentation**: added link to brakkee.org for setup of docker-mailserver on Kubernetes\n- **CI**: better build caching for CI\n- **CI**: improve GitHub Action CI with re-usable workflows\n- **tests**: ensure excessive FD limits are avoided\n- **configuration**: added `reject_unknown_client_hostname` to main.cf\n\n### Changed\n\n- **documentation**: update and improve K8s documentation\n- **scripts**: set configomat output to loglevel debug\n- **scripts**: refactor CLI commands for database management\n- **scripts**: simplify Fail2Ban output\n- **tests**: update submodules for BATS\n- **scripts**: rework environment variables setup\n- **scripts**: revised linting script\n- **scripts**: `addmailuser` - remove delaying completion until `/var/mail` is ready\n- **configuration**: remove unnecessary postconf switch '-e' and use single quotes where possible\n- **build**: streamline COPY statements in Dockerfile\n- **scripts**: improve `helpers/log.sh`\n- **build**: adjust build arguments\n- **build**: enhance build process\n\n### Removed\n\n- **configuration**: remove unnecessary configuration files\n\n### Fixed\n\n- **documentation**: update documentation to fix regression causing broken links\n- **scripts**: `_create_accounts()` should run after waiting\n- **scripts**: only calculate checksums, when there are files to monitor.\n- **tests**: wait at least 30 seconds before checking the health state of the container\n- **CI**: add `outputs` to `workflow_call` on `generic_build`\n\n### Security\n\nThere are no security-related changes in this release.\n\n---\n\n> **Note**: This part of the changelog was created before switching to the \"Keep a Changelog\"-format.\n\n## `v11.1.0`\n\nIn this release the relay-host support saw [significant internal refactoring](https://github.com/docker-mailserver/docker-mailserver/pull/2604) in preparation for a future breaking change. Similar extensive restructuring through the codebase also occurred, where [each PR provides more details](https://github.com/docker-mailserver/docker-mailserver/milestone/17?closed=1). Care was taken to avoid breakage, but there may be some risk affecting unsupported third-party customizations which our test suite is unaware of.\n\n### Features\n\n- There is now support for [Dovecot-Master accounts](https://docker-mailserver.github.io/docker-mailserver/v11.1/config/advanced/dovecot-master-accounts/) that provide admin access to all mail accounts ([#2535](https://github.com/docker-mailserver/docker-mailserver/pull/2535))\n\n### Fixes\n\n- Using Port 465 to authenticate with a relay-host no longer breaks the Amavis transport for Postfix ([#2607](https://github.com/docker-mailserver/docker-mailserver/pull/2607))\n- When mounting `/var/mail-state`, disabled services will no longer copy over data redundantly ([#2608](https://github.com/docker-mailserver/docker-mailserver/pull/2608))\n- Amavis is now aware of new domains detected during Change Detection, no longer skipping virus and spam filtering ([#2616](https://github.com/docker-mailserver/docker-mailserver/pull/2616))\n- `setup.sh -c <container name>` no longer ignores `<container name>` when more than 1 `docker-mailserver` container is running ([#2622](https://github.com/docker-mailserver/docker-mailserver/pull/2622))\n\n### Improvements\n\n- The Change Detector service will now only process relevant changes ([#2615](https://github.com/docker-mailserver/docker-mailserver/pull/2615)), in addition to now monitoring `postfix-sasl-password.cf`, `postfix-relaymap.cf`, and `postfix-regexp.cf` ([#2623](https://github.com/docker-mailserver/docker-mailserver/pull/2623))\n- For LDAP users that only need to support a single mail domain, `setup config dkim` should now detect the domain implicitly ([#2620](https://github.com/docker-mailserver/docker-mailserver/pull/2620))\n- The container capability `SYS_PTRACE` is no longer necessary ([#2624](https://github.com/docker-mailserver/docker-mailserver/pull/2624))\n- Added an example for configuring a basic container `healthcheck` command ([#2625](https://github.com/docker-mailserver/docker-mailserver/pull/2625))\n- Postfix `main.cf` setting `compatibility_level` was set to `2` during our startup scripts. This is now part of our default shipped `main.cf` config ([#2597](https://github.com/docker-mailserver/docker-mailserver/pull/2597))\n- The Postfix `main.cf` override/extension support via `postfix-main.cf` has been improved to support multi-line values, instead of the previous single-line only support ([#2598](https://github.com/docker-mailserver/docker-mailserver/pull/2598))\n\n### Deprecation Notice\n\n- **`SASL_PASSWD` ENV**\n  An old ENV `SASL_PASSWD` has been around for supporting relay-host authentication, but since superceded by the `postfix-sasl-password.cf` config file. It will be removed in a future major release as detailed [here](https://github.com/docker-mailserver/docker-mailserver/pull/2605).\n- **Platform Support - ARMv7**\n  This is a very old platform, superceded by ARMv8 and newer with broad product availability around 2016 onwards.\n  Support was introduced primarily for users the older generations of Raspberry Pi. ARM64 is the modern target for ARM devices.\n\n  If you require ARMv7 support, [please let us know](https://github.com/docker-mailserver/docker-mailserver/issues/2642).\n\n## `v11.0.0`\n\n### Major Changes\n\n1. [**Internal logging has been refactored**](https://github.com/docker-mailserver/docker-mailserver/pull/2493). The environment variable `DMS_DEBUG` has been replaced by [`LOG_LEVEL`](https://docker-mailserver.github.io/docker-mailserver/v11.0/config/environment/#log_level) to better control the verbosity of logs we output. The new logger is more structured and follows standard log conventions. `LOG_LEVEL` can be set to: `error`, `warn`, `info` (default), `debug` and `trace`.\n2. [**`iptables` has been replaced by `nftables`**](https://github.com/docker-mailserver/docker-mailserver/pull/2505). The Fail2Ban configuration was adjusted accordingly. If you use `iptables` yourself (e.g. in `user-patches.sh`), make sure to update the scripts.\n3. **[`PERMIT_DOCKER`](https://docker-mailserver.github.io/docker-mailserver/v11.0/config/environment/#permit_docker) has a new default value of `none`**. This change [better secures Podman](https://github.com/docker-mailserver/docker-mailserver/pull/2424); to keep the old behaviour (_adding the container IP address to Postfix's `mynetworks`_), use `PERMIT_DOCKER=container`.\n\n### Minor Changes\n\n1. **Many** minor improvements were made (cleanup & refactoring). Please refer to the section below to get an overview over all improvements. Moreover, there was a lot of cleanup in the scripts and in the tests. The documentation was adjusted accordingly.\n2. New environment variables were added:\n    1. [`CLAMAV_MESSAGE_SIZE_LIMIT`](https://docker-mailserver.github.io/docker-mailserver/v11.0/config/environment/#clamav_message_size_limit)\n    2. [`TZ`](https://docker-mailserver.github.io/docker-mailserver/v11.0/config/environment/#tz)\n3. SpamAssassin KAM was added with [`ENABLE_SPAMASSASSIN_KAM`](https://docker-mailserver.github.io/docker-mailserver/v11.0/config/environment/#enable_spamassassin_kam).\n4. The `fail2ban` command was reworked and can now ban IP addresses as well.\n5. There were a few small fixes, especially when it comes to bugs in scripts and service restart loops (no functionality changes, only fixes of existing functionality). When building an image from the Dockerfile - Installation of Postfix on modern Linux distributions should now always succeed.\n6. Some default values for environment values changed: these are mostly non-critical, please refer to [#2428](https://github.com/docker-mailserver/docker-mailserver/pull/2428) and [#2487](https://github.com/docker-mailserver/docker-mailserver/pull/2487).\n\n### Merged Pull Requests\n\n- **[improvement]** tests: remove legacy functions / tests [#2434](https://github.com/docker-mailserver/docker-mailserver/pull/2434)\n- **[improvement]** `PERMIT_DOCKER=none` as new default value [#2424](https://github.com/docker-mailserver/docker-mailserver/pull/2424)\n- **[improvement]** Adjust environment variables to more sensible defaults [#2428](https://github.com/docker-mailserver/docker-mailserver/pull/2428)\n- **[fix]** macOS linting support [#2448](https://github.com/docker-mailserver/docker-mailserver/pull/2448)\n- **[improvement]** Rename config examples directory [#2438](https://github.com/docker-mailserver/docker-mailserver/pull/2438)\n- **[docs]** FAQ - Update naked/bare domain section [#2446](https://github.com/docker-mailserver/docker-mailserver/pull/2446)\n- **[improvement]** Remove obsolete `setup.sh debug inspect` command from usage description [#2454](https://github.com/docker-mailserver/docker-mailserver/pull/2454)\n- **[feature]** Introduce `CLAMAV_MESSAGE_SIZE_LIMIT` env [#2453](https://github.com/docker-mailserver/docker-mailserver/pull/2453)\n- **[fix]** remove SA reload for KAM [#2456](https://github.com/docker-mailserver/docker-mailserver/pull/2456)\n- **[docs]** Enhance logrotate description [#2469](https://github.com/docker-mailserver/docker-mailserver/pull/2469)\n- **[improvement]** Remove macOS specific code / support + shellcheck should avoid python, regardless of permissions [#2466](https://github.com/docker-mailserver/docker-mailserver/pull/2466)\n- **[docs]** Update fail2ban.md [#2484](https://github.com/docker-mailserver/docker-mailserver/pull/2484)\n- **[fix]** Makefile: Remove backup/restore of obsolete config directory [#2479](https://github.com/docker-mailserver/docker-mailserver/pull/2479)\n- **[improvement]** scripts: small refactorings [#2485](https://github.com/docker-mailserver/docker-mailserver/pull/2485)\n- **[fix]** Building on Ubuntu 21.10 failing to install postfix [#2468](https://github.com/docker-mailserver/docker-mailserver/pull/2468)\n- **[improvement]** Use FQDN as `REPORT_SENDER` default value [#2487](https://github.com/docker-mailserver/docker-mailserver/pull/2487)\n- **[improvement]** Improve test, get rid of sleep [#2492](https://github.com/docker-mailserver/docker-mailserver/pull/2492)\n- **[feature]** scripts: new log [#2493](https://github.com/docker-mailserver/docker-mailserver/pull/2493)\n- **[fix]** Restart supervisord early [#2494](https://github.com/docker-mailserver/docker-mailserver/pull/2494)\n- **[improvement]** scripts: renamed function `_errex` -> `_exit_with_error` [#2497](https://github.com/docker-mailserver/docker-mailserver/pull/2497)\n- **[improvement]** Remove invalid URL from SPF message [#2503](https://github.com/docker-mailserver/docker-mailserver/pull/2503)\n- **[improvement]** scripts: refactored scripts located under `target/bin/` [#2500](https://github.com/docker-mailserver/docker-mailserver/pull/2500)\n- **[improvement]** scripts: refactoring & miscellaneous small changes [#2499](https://github.com/docker-mailserver/docker-mailserver/pull/2499)\n- **[improvement]** scripts: refactored `daemon-stack.sh` [#2496](https://github.com/docker-mailserver/docker-mailserver/pull/2496)\n- **[fix]** add compatibility for Bash 4 to setup.sh [#2519](https://github.com/docker-mailserver/docker-mailserver/pull/2519)\n- **[fix]** tests: disabled \"quota exceeded\" test [#2511](https://github.com/docker-mailserver/docker-mailserver/pull/2511)\n- **[fix]** typo in setup-stack.sh [#2521](https://github.com/docker-mailserver/docker-mailserver/pull/2521)\n- **[improvement]** scripts: introduce `_log` to `sedfile` [#2507](https://github.com/docker-mailserver/docker-mailserver/pull/2507)\n- **[feature]** create `.github/FUNDING.yml` [#2512](https://github.com/docker-mailserver/docker-mailserver/pull/2512)\n- **[improvement]** scripts: refactored `check-for-changes.sh` [#2498](https://github.com/docker-mailserver/docker-mailserver/pull/2498)\n- **[improvement]** scripts: remove `DMS_DEBUG` [#2523](https://github.com/docker-mailserver/docker-mailserver/pull/2523)\n- **[feature]** firewall: replace `iptables` with `nftables` [#2505](https://github.com/docker-mailserver/docker-mailserver/pull/2505)\n- **[improvement]** log: adjust level and message(s) slightly for four messages [#2532](https://github.com/docker-mailserver/docker-mailserver/pull/2532)\n- **[improvement]** log: introduce proper log level fallback and env getter function [#2506](https://github.com/docker-mailserver/docker-mailserver/pull/2506)\n- **[feature]** scripts: added `TZ` environment variable to set timezone [#2530](https://github.com/docker-mailserver/docker-mailserver/pull/2530)\n- **[improvement]** setup: added grace period for account creation [#2531](https://github.com/docker-mailserver/docker-mailserver/pull/2531)\n- **[improvement]** refactor: letsencrypt implicit location discovery [#2525](https://github.com/docker-mailserver/docker-mailserver/pull/2525)\n- **[improvement]** setup.sh/setup: show usage when no argument is given [#2540](https://github.com/docker-mailserver/docker-mailserver/pull/2540)\n- **[improvement]** Dockerfile: Remove not needed ENVs and add comment [#2541](https://github.com/docker-mailserver/docker-mailserver/pull/2541)\n- **[improvement]** chore: (setup-stack.sh) Fix a small typo [#2552](https://github.com/docker-mailserver/docker-mailserver/pull/2552)\n- **[feature]** Add ban feature to fail2ban script [#2538](https://github.com/docker-mailserver/docker-mailserver/pull/2538)\n- **[fix]** Fix changedetector restart loop [#2548](https://github.com/docker-mailserver/docker-mailserver/pull/2548)\n- **[improvement]** chore: Drop `setup.sh` DATABASE fallback ENV [#2556](https://github.com/docker-mailserver/docker-mailserver/pull/2556)\n\n## `v10.5.0`\n\n### Critical Changes\n\n1. This release fixes a critical issue for LDAP users, installing a needed package on Debian 11 on build-time. Moreover, a race-condition was eliminated ([#2341](https://github.com/docker-mailserver/docker-mailserver/pull/2341)).\n2. A resource leak in `check-for-changes.sh` was fixed ([#2401](https://github.com/docker-mailserver/docker-mailserver/pull/2401))\n\n### Other Minor Changes\n\n1. `SPAMASSASSIN_SPAM_TO_INBOX`'s default changed to `1`. ([#2361](https://github.com/docker-mailserver/docker-mailserver/pull/2361))\n2. Changedetector functionality was added to `SSL_TYPE=manual`-setups. ([#2404](https://github.com/docker-mailserver/docker-mailserver/pull/2404))\n3. Four new environment variables were introduced: `LOGWATCH_SENDER`, `ENABLE_DNSBL`, `DOVECOT_INET_PROTOCOLS` and `ENABLE_SPAMASSASSIN_KAM`. ([#2362](https://github.com/docker-mailserver/docker-mailserver/pull/2362), [#2342](https://github.com/docker-mailserver/docker-mailserver/pull/2342), [#2358](https://github.com/docker-mailserver/docker-mailserver/pull/2358), [#2418](https://github.com/docker-mailserver/docker-mailserver/pull/2418))\n4. There are plenty of bug fixes and documentation enhancements with this release.\n\n### Merged Pull Requests\n\n- **[fix]** added `libldap-common` to packages in Dockerfile in [#2341](https://github.com/docker-mailserver/docker-mailserver/pull/2341)\n- **[fix]** Prevent race condition on supervisorctl reload in [#2343](https://github.com/docker-mailserver/docker-mailserver/pull/2343)\n- **[docs]** Update links to dovecot docs in [#2351](https://github.com/docker-mailserver/docker-mailserver/pull/2351)\n- **[fix]** tests(fix): Align with upstream `testssl` field name change in [#2353](https://github.com/docker-mailserver/docker-mailserver/pull/2353)\n- **[improvement]** Make TLS tests more reliable in [#2354](https://github.com/docker-mailserver/docker-mailserver/pull/2354)\n- **[feature]** Introduce ENABLE_DNSBL env in [#2342](https://github.com/docker-mailserver/docker-mailserver/pull/2342)\n- **[feature]** Introduce DOVECOT_INET_PROTOCOLS env in [#2358](https://github.com/docker-mailserver/docker-mailserver/pull/2358)\n- **[fix]** Fix harmless startup errors in [#2357](https://github.com/docker-mailserver/docker-mailserver/pull/2357)\n- **[improvement]** Add tests for sedfile wrapper in [#2363](https://github.com/docker-mailserver/docker-mailserver/pull/2363)\n- **[feature]** add env var `LOGWATCH_SENDER` in [#2362](https://github.com/docker-mailserver/docker-mailserver/pull/2362)\n- **[fix]** Fixed non-number-argument in `listmailuser` in [#2382](https://github.com/docker-mailserver/docker-mailserver/pull/2382)\n- **[fix]** docs: Fail2Ban - Fix links for rootless podman in [#2384](https://github.com/docker-mailserver/docker-mailserver/pull/2384)\n- **[fix]** docs(kubernetes): fix image name in example in [#2385](https://github.com/docker-mailserver/docker-mailserver/pull/2385)\n- **[fix]** SSL documentation contains a small bug #2381 [#2383](https://github.com/docker-mailserver/docker-mailserver/pull/2383)\n- **[fix]** get rid of subshell + `exec` in `helper-functions.sh` in [#2401](https://github.com/docker-mailserver/docker-mailserver/pull/2401)\n- **[docs]** Rootless Podman security update [#2393](https://github.com/docker-mailserver/docker-mailserver/pull/2393)\n- **[fix]** fix: double occurrence of `/etc/postfix/regexp` in [#2397](https://github.com/docker-mailserver/docker-mailserver/pull/2397)\n- **[improvement]** consistently make 1 the default value for `SPAMASSASSIN_SPAM_TO_INBOX` in [#2361](https://github.com/docker-mailserver/docker-mailserver/pull/2361)\n- **[docs]** added sieve example for subaddress sorting in [#2410](https://github.com/docker-mailserver/docker-mailserver/pull/2410)\n- **[feature]** Add changedetector functionality for `${SSL_TYPE} == manual` in [#2404](https://github.com/docker-mailserver/docker-mailserver/pull/2404)\n- **[docs]** docs(deps): bump mkdocs-material to v8.2.1 in [#2422](https://github.com/docker-mailserver/docker-mailserver/pull/2422)\n- **[feature]** Add SpamAssassin KAM in [#2418](https://github.com/docker-mailserver/docker-mailserver/pull/2418)\n- **[improvement]** refactoring: split helper functions into smaller scripts in [#2420](https://github.com/docker-mailserver/docker-mailserver/pull/2420)\n- **[fix]** fix: do not add accounts that already exists to account files in [#2419](https://github.com/docker-mailserver/docker-mailserver/pull/2419)\n\n## `v10.4.0`\n\nThis release upgrades our base image from Debian 10 to Debian 11.\nThere is also an important regression fixed for `SSL_TYPE=letsencrypt` users.\n\n- **[fix]** A regression with `check-for-changes.sh` introduced in `v10.3.0` affected `SSL_TYPE=letsencrypt`, preventing detection of cert renewals to restart services (_unless using `acme.json`_) [#2326](https://github.com/docker-mailserver/docker-mailserver/pull/2326)\n- **[improvement]** Base image upgraded from Debian 10 Buster to Debian 11 Bullseye [#2116](https://github.com/docker-mailserver/docker-mailserver/pull/2116)\n  - Postfix upgraded from `3.4` to `3.5`. Dovecot upgraded from `2.3.4` to `2.3.13`. Python 2 is no longer included in the image, Python 3 remains (_[more information](https://github.com/docker-mailserver/docker-mailserver/pull/2116#issuecomment-955615529)_).\n  - `yescrypt` is now supported upstream as a password hash algorithm, `docker-mailserver` continues to use `SHA512-CRYPT` (_[more information](https://github.com/docker-mailserver/docker-mailserver/pull/2116#issuecomment-955800544)_).\n- **[chore]** Dovecot statistics service disabled [#2292](https://github.com/docker-mailserver/docker-mailserver/pull/2292)\n\n## `v10.3.0`\n\n**WARNING:** This release had a small regression affecting the detection of changes for certificates provisioned in `/etc/letsencrypt` with the config ENV `SSL_TYPE=letsencrypt`, unless you use Traefik's `acme.json`. If you rely on this functionality to restart Postfix and Dovecot when updating your cert files, this will not work and it is advised to upgrade to `v10.4.0` or newer prior to renewal of your certificates.\n\n- **[fix]** The Dovecot `userdb` will now additionally create \"dummy\" accounts for basic alias maps (_alias maps to a single real account managed by Dovecot, relaying to external providers aren't affected_) when `ENABLE_QUOTAS=1` (default) as a workaround for Postfix `quota-status` plugin querying Dovecot with inbound mail for a user, which Postfix uses to reject mail if quota has been exceeded (_to avoid risk of blacklisting from spammers abusing backscatter_) [#2248](https://github.com/docker-mailserver/docker-mailserver/pull/2248)\n  - **NOTE:** If using aliases that map to another alias or multiple addresses, _this remains a risk_.\n- **[fix]** `setup email list` command will no longer attempt to query Dovecot quota status when `ENABLE_QUOTAS` is disabled [#2264](https://github.com/docker-mailserver/docker-mailserver/pull/2264)\n- **[fix]** `SSL_DOMAIN` ENV should now work much more reliably [#2274](https://github.com/docker-mailserver/docker-mailserver/pull/2274), [#2278](https://github.com/docker-mailserver/docker-mailserver/pull/2278), [#2279](https://github.com/docker-mailserver/docker-mailserver/pull/2279)\n- **[fix]** DKIM - Removed `refile:` (_regex type_) from KeyTable entry in `opendkim.conf`, fixes validation error output from `opendkim-testkey` [#2249](https://github.com/docker-mailserver/docker-mailserver/pull/2249)\n- **[fix]** DMARC - Removed quotes around the hostname value in `opendmarc.conf`. This avoids an authentication failure where an OpenDKIM header was previously ignored [#2291](https://github.com/docker-mailserver/docker-mailserver/pull/2291)\n- **[fix]** When using `ONE_DIR=1` (default), the `spool-postfix` folder now has the correct permissions carried over. This resolves some failures notably with sieve filters [#2273](https://github.com/docker-mailserver/docker-mailserver/pull/2273)\n- **[improvement]** Warnings are now logged for ClamAV and SpamAssassin if they are enabled but Amavis is disabled (_which is required for them to work correctly_) [#2251](https://github.com/docker-mailserver/docker-mailserver/pull/2251)\n- **[improvement]** `user-patches.sh` is now invoked via `bash` to assist Kubernetes deployments with `ConfigMap` [#2295](https://github.com/docker-mailserver/docker-mailserver/pull/2295)\n\n### Internal\n\nThese changes are primarily internal and are only likely relevant to users that maintain their own modifications related to the changed files.\n\n- **[chore]** Redundant config from Postfix `master.cf` has been removed, it should not affect any users as our images have not included any of the related processes [#2272](https://github.com/docker-mailserver/docker-mailserver/pull/2272)\n- **[refactor]** `check-for-changes.sh` was carrying some duplicate code from `setup-stack.sh` that was falling out of sync, they now share common code [#2260](https://github.com/docker-mailserver/docker-mailserver/pull/2260)\n- **[refactor]** `acme.json` extraction was refactored into a CLI utility and updated to Python 3 (_required for future upgrade to Debian 11 Bullseye base image_) [#2274](https://github.com/docker-mailserver/docker-mailserver/pull/2274)\n- **[refactor]** As part of the Traefik `acme.json` and `SSL_DOMAIN` work, logic for `SSL_TYPE=letsencrypt` was also revised [#2278](https://github.com/docker-mailserver/docker-mailserver/pull/2278)\n- **[improvement]** Some minor tweaks to how we derive the internal `HOSTNAME` and `DOMAINNAME` from user configured `hostname` and `domainname` settings [#2280](https://github.com/docker-mailserver/docker-mailserver/pull/2280)\n\n## `v10.2.0`\n\n- You no longer need to maintain a copy of `setup.sh` matching your version release from v10.2 of `docker-mailserver` onwards. Version specific functionality of `setup.sh` has moved into the container itself, while `setup.sh` remains as a convenient wrapper to: `docker exec -it <container name> setup <command>`.\n- [`ONE_DIR`](https://docker-mailserver.github.io/docker-mailserver/v10.2/config/environment/#one_dir) now defaults to enabled (`1`).\n- For anyone relying on internal location of certificates (_internal copy of mounted files at startup_), the Postfix and Dovecot location of `/etc/postfix/ssl` has changed to `/etc/dms/tls`. This may affect any third-party `user-patches.sh` scripts that depended on this path to update certs.\n- The [_Let's Encrypt_ section of our SSL / TLS docs](https://docker-mailserver.github.io/docker-mailserver/v10.2/config/security/ssl#lets-encrypt-recommended) has been brought up to date.\n\n### Bigger scripts-related improvements\n\n- **[scripts]** update `setup.sh` to now use a running container first if one exists [#2134](https://github.com/docker-mailserver/docker-mailserver/pull/2134)\n- **[scripts]** included `setup.sh` functionality inside the container to be version independent again [#2174](https://github.com/docker-mailserver/docker-mailserver/pull/2174)\n- **[scripts]** `HOSTNAME` and `DOMAINNAME` setup improved [#2175](https://github.com/docker-mailserver/docker-mailserver/pull/2175)\n- **[scripts]** `delmailuser` can now delete mailboxed without TLD [#2172](https://github.com/docker-mailserver/docker-mailserver/pull/2172)\n- **[scripts]** properly exit on failure ([#2199](https://github.com/docker-mailserver/docker-mailserver/pull/2199) in conjunction with [#2196](https://github.com/docker-mailserver/docker-mailserver/pull/2196))\n- **[scripts]** make `setup.sh` completely non-interactive for Podman users [#2201](https://github.com/docker-mailserver/docker-mailserver/pull/2201)\n\n### Security\n\nSome internal refactoring and fixes happened this release cycle in [#2196](https://github.com/docker-mailserver/docker-mailserver/pull/2196):\n\n- **[improve]** The Postfix and Dovecot location of `/etc/postfix/ssl` has changed to `/etc/dms/tls`\n- **[improve]** An invalid `SSL_TYPE` or a valid value with an invalid configuration will now panic, exiting the container and emitting a fatal error to the logs\n- **[fix]** An unconfigured/empty `SSL_TYPE` ENV now correctly disables SSL support for Dovecot and general Postfix configurations. A reminder that this is unsupported officially, and is only intended for tests and troubleshooting. Use only [a valid `SSL_TYPE`](https://docker-mailserver.github.io/docker-mailserver/v10.2/config/environment/#ssl_type) (_`letsencrypt` and `manual` are recommended_) for production deployments\n- **[fix]** `TLS_LEVEL=intermediate` now modifies the system (container) `openssl.cnf` config to set the minimum protocol to TLS 1.0 (_from 1.2_) and cipher-suite support to `DEFAULT@SECLEVEL=1` (_from `2`_). This change is required for Dovecot in upcoming Debian Bullseye upgrade, to be compatible with the `TLS_LEVEL=intermediate` cipher-suite profile. It may affect other software within the container that relies on this openssl config, should you extend the Docker image [#2193](https://github.com/docker-mailserver/docker-mailserver/pull/2193)\n- **[fix]** Provide DH parameters (_default: RFC 7919 group `ffdhe406.pem`_) at build-time, instead of during startup. Custom DH parameters regardless of `ONE_DIR` are now only detected when mounted to `/tmp/docker-mailserver/dhparams.pem` [#2192](https://github.com/docker-mailserver/docker-mailserver/pull/2192)\n- **[docs]** Revise the _Let's Encrypt_ section of our SSL / TLS docs [#2209](https://github.com/docker-mailserver/docker-mailserver/pull/2209)\n\n### Miscellaneous small additions and changes\n\n- **[ci]** improved caching [#2197](https://github.com/docker-mailserver/docker-mailserver/pull/2197)\n- **[ci]** refactored spam tests and introduced common container setup template [#2198](https://github.com/docker-mailserver/docker-mailserver/pull/2198)\n- **[fix]** update Fail2Ban wrapper to propagate errors to user [#2170](https://github.com/docker-mailserver/docker-mailserver/pull/2170)\n- **[fix]** Dockerfile `sed`'s are now checked [#2158](https://github.com/docker-mailserver/docker-mailserver/pull/2158)\n- **[general]** Updated default value of `ONE_DIR` to `1` [#2148](https://github.com/docker-mailserver/docker-mailserver/pull/2148)\n- **[docs]** updated Kubernetes documentation [#2111](https://github.com/docker-mailserver/docker-mailserver/pull/2111)\n- **[docs]** introduced dedicated Podman documentation [#2179](https://github.com/docker-mailserver/docker-mailserver/pull/2179)\n- **[docs]** miscellaneous documentation improvements\n- **[misc]** introduced GitHub issue forms for issue templates [#2160](https://github.com/docker-mailserver/docker-mailserver/pull/2160)\n- **[misc]** Removed the internal `mkcert.sh` script for Dovecot as it is no longer needed [#2196](https://github.com/docker-mailserver/docker-mailserver/pull/2196)\n\n## `v10.1.2`\n\nThis is bug fix release. It reverts [a regression](https://github.com/docker-mailserver/docker-mailserver/issues/2154) introduced with [#2104](https://github.com/docker-mailserver/docker-mailserver/pull/2104).\n\n## `v10.1.1`\n\nThis release mainly improves on `v10.1.0` with small bugfixes/improvements and dependency updates\n\n- **[feat]** Add logwatch maillog.conf file to support /var/log/mail/ ([#2112](https://github.com/docker-mailserver/docker-mailserver/pull/2112))\n- **[docs]** `CONTRIBUTORS.md` now also shows every code contributor from the past ([#2143](https://github.com/docker-mailserver/docker-mailserver/pull/2143))\n- **[improve]** Avoid chmod +x when not needed ([#2127](https://github.com/docker-mailserver/docker-mailserver/pull/2127))\n- **[improve]** check-for-changes: performance improvements ([#2104](https://github.com/docker-mailserver/docker-mailserver/pull/2104))\n- **[dependency]** Update various dependencies through docs and base image\n- **[security]** This release contains also [security fixes for OpenSSL](https://www.openssl.org/news/secadv/20210824.txt)\n\n## `v10.1.0`\n\nThis release mainly improves on `v10.0.0` with many bugfixes.\n\n- **[docs]** Various documentation updates ([#2105](https://github.com/docker-mailserver/docker-mailserver/pull/2105), [#2045](https://github.com/docker-mailserver/docker-mailserver/pull/2045), [#2043](https://github.com/docker-mailserver/docker-mailserver/pull/2043), [#2035](https://github.com/docker-mailserver/docker-mailserver/pull/2035), [#2001](https://github.com/docker-mailserver/docker-mailserver/pull/2001))\n- **[misc]** Fixed a lot of small bugs, updated dependencies and improved functionality ([#2095](https://github.com/docker-mailserver/docker-mailserver/pull/2095), [#2047](https://github.com/docker-mailserver/docker-mailserver/pull/2047), [#2046](https://github.com/docker-mailserver/docker-mailserver/pull/2046), [#2041](https://github.com/docker-mailserver/docker-mailserver/pull/2041), [#1980](https://github.com/docker-mailserver/docker-mailserver/pull/1980), [#2030](https://github.com/docker-mailserver/docker-mailserver/pull/2030), [#2024](https://github.com/docker-mailserver/docker-mailserver/pull/2024), [#2001](https://github.com/docker-mailserver/docker-mailserver/pull/2001), [#2000](https://github.com/docker-mailserver/docker-mailserver/pull/2000), [#2059](https://github.com/docker-mailserver/docker-mailserver/pull/2059))\n- **[feat]** Added dovecot-fts-xapian ([#2064](https://github.com/docker-mailserver/docker-mailserver/pull/2064))\n- **[security]** Switch GPG keyserver ([#2051](https://github.com/docker-mailserver/docker-mailserver/pull/2051))\n\n## `v10.0.0`\n\nThis release improves on `9.1.0` in many aspect, including general fixes, Fail2Ban, LDAP and documentation. This release contains breaking changes.\n\n- **[general]** Fixed many prose errors (spelling, grammar, indentation).\n- **[general]** Documentation is better integrated into the development process and it's visibility within the project increased ([#1878](https://github.com/docker-mailserver/docker-mailserver/pull/1878)).\n- **[general]** Added `stop_grace_period:` to example Compose file and supervisord ([#1896](https://github.com/docker-mailserver/docker-mailserver/pull/1896) [#1945](https://github.com/docker-mailserver/docker-mailserver/pull/1945))\n- **[general]** `./setup.sh email list` was enhanced, now showing information neatly ([#1898](https://github.com/docker-mailserver/docker-mailserver/pull/1898))\n- **[general]** Added update check and notification ([#1976](https://github.com/docker-mailserver/docker-mailserver/pull/1976), [#1951](https://github.com/docker-mailserver/docker-mailserver/pull/1951))\n- **[general]** Moved environment variables to the documentation and improvements ([#1948](https://github.com/docker-mailserver/docker-mailserver/pull/1948), [#1947](https://github.com/docker-mailserver/docker-mailserver/pull/1947), [#1931](https://github.com/docker-mailserver/docker-mailserver/pull/1931))\n- **[security]** Major Fail2Ban improvements (cleanup, update and breaking changes, see below)\n- **[fix]** `./setup.sh email del ...` now works properly\n- **[code]** Added color variables to `setup.sh` and improved the script as a whole ([#1879](https://github.com/docker-mailserver/docker-mailserver/pull/1879), [#1886](https://github.com/docker-mailserver/docker-mailserver/pull/1886))\n- **[ldap]** Added `LDAP_QUERY_FILTER_SENDERS` ([#1902](https://github.com/docker-mailserver/docker-mailserver/pull/1902))\n- **[ldap]** Use dovecots LDAP `uris` connect option instead of `hosts` ([#1901](https://github.com/docker-mailserver/docker-mailserver/pull/1901))\n- **[ldap]** Complete rework of LDAP documentation ([#1921](https://github.com/docker-mailserver/docker-mailserver/pull/1921))\n- **[docs]** PRs that contain changes to docs will now be commented with a preview link ([#1988](https://github.com/docker-mailserver/docker-mailserver/pull/1988))\n\n### Breaking Changes\n\n- **[security]** Fail2Ban adjustments:\n  - Fail2ban v0.11.2 is now used ([#1965](https://github.com/docker-mailserver/docker-mailserver/pull/1965)).\n  - The previous F2B config (from an old Debian release) has been replaced with the latest default config for F2B shipped by Debian 10.\n  - The new default blocktype is now `DROP`, not `REJECT` ([#1914](https://github.com/docker-mailserver/docker-mailserver/pull/1914)).\n  - A ban now applies to all ports (`iptables-allports`), not just the ones that were \"attacked\" ([#1914](https://github.com/docker-mailserver/docker-mailserver/pull/1914)).\n  - Fail2ban 0.11 is totally compatible to 0.10, but the database got some new tables and fields (auto-converted during the first start), so once updated to DMS 10.0.0, you have to remove the database `mailstate:/lib-fail2ban/fail2ban.sqlite3` if you would need to downgrade to DMS 9.1.0 for some reason.\n- **[ldap]** Removed `SASLAUTHD_LDAP_SSL`. Instead provide a protocol in `SASLAUTHD_LDAP_SERVER` and adjust `SASLAUTHD_LDAP_` default values ([#1989](https://github.com/docker-mailserver/docker-mailserver/pull/1989)).\n- **[general]** Removed `stable` release tag ([#1975](https://github.com/docker-mailserver/docker-mailserver/pull/1975)):\n  - Scheduled builds are now based off `edge`.\n  - Instead of `stable`, please use the latest version tag available (_or the `latest` tag_).\n  - The `stable` image tag will be removed from DockerHub in the near future.\n- **[setup]** Removed `./setup config ssl` command (_deprecated since v9_). `SSL_TYPE=self-signed` remains supported however. ([`dc8f49de`](https://github.com/docker-mailserver/docker-mailserver/commit/dc8f49de548e2c2e2aa321841585153a99cd3858), [#2021](https://github.com/docker-mailserver/docker-mailserver/pull/2021))\n\n## `v9.1.0`\n\nThis release marks the breakpoint where the wiki was transferred to a [reworked documentation](https://docker-mailserver.github.io/docker-mailserver/latest/)\n\n- **[feat]** Introduce ENABLE_AMAVIS env ([#1866](https://github.com/docker-mailserver/docker-mailserver/pull/1866))\n- **[docs]** Move wiki to gh-pages ([#1826](https://github.com/docker-mailserver/docker-mailserver/pull/1826)) - Special thanks to @polarathene üë®üèª‚Äçüíª\n  - You can [edit the docs](https://github.com/docker-mailserver/docker-mailserver/tree/master/docs/content) now directly with your code changes\n  - Documentation is now versioned related to docker image versions and viewable here: <https://docker-mailserver.github.io/docker-mailserver/latest/>\n\n## `v9.0.1`\n\nA small update on the notification function which was made more stable as well as minor fixes.\n\n- **[fix]** `_notify` cannot fail anymore - non-zero returns lead to unintended behavior in the past when `DMS_DEBUG` was not set or `0`\n- **[refactor]** `check-for-changes.sh` now uses `_notify`\n\n## `v9.0.0`\n\n- **[feat]** Support extra `user_attributes` in accounts configuration ([#1792](https://github.com/docker-mailserver/docker-mailserver/pull/1792))\n- **[feat]** Add possibility to use a custom dkim selector ([#1811](https://github.com/docker-mailserver/docker-mailserver/pull/1811))\n- **[feat]** TLS: Dual (aka hybrid) certificate support! (eg ECDSA certificate with an RSA fallback for broader compatibility) ([#1801](https://github.com/docker-mailserver/docker-mailserver/pull/1801)).\n  - This feature is presently only for `SSL_TYPE=manual`, all you need to do is provide your fallback certificate to the `SSL_ALT_CERT_PATH` and `SSL_ALT_KEY_PATH` ENV vars, just like your primary certificate would be setup for manual mode.\n- **[security]** TLS: You can now use ECDSA certificates! ([#1802](https://github.com/docker-mailserver/docker-mailserver/pull/1802))\n  - Warning: ECDSA may not be supported by legacy systems (most pre-2014). You can provide an RSA certificate as a fallback.\n- **[fix]** TLS: For some docker-compose setups when restarting the docker-mailserver container, internal config state may have been persisted despite making changes that should reconfigure TLS (eg changing `SSL_TYPE` or replacing the certificate file) ([#1801](https://github.com/docker-mailserver/docker-mailserver/pull/1801)).\n- **[refactor]** Split `start-mailserver.sh` ([#1820](https://github.com/docker-mailserver/docker-mailserver/pull/1820))\n- **[fix]** Linting now uses local path to remove the sudo dependency ([#1831](https://github.com/docker-mailserver/docker-mailserver/pull/1831)).\n\n### Breaking Changes\n\n- **[security]** TLS: `TLS_LEVEL=modern` has changed the server-side preference order to 128-bit before 256-bit encryption ([#1802](https://github.com/docker-mailserver/docker-mailserver/pull/1802)).\n  - NOTE: This is still very secure but may result in misleading lower scores/grades from security audit websites.\n- **[security]** TLS: `TLS_LEVEL=modern` removed support for AES-CBC cipher suites and follows best practices by supporting only AEAD cipher suites ([#1802](https://github.com/docker-mailserver/docker-mailserver/pull/1802)).\n  - NOTE: As TLS 1.2 is the minimum required for modern already, AEAD cipher suites should already be supported and preferred.\n- **[security]** TLS: `TLS_LEVEL=intermediate` has removed support for cipher suites using RSA for key exchange (only available with an RSA certificate) ([#1802](https://github.com/docker-mailserver/docker-mailserver/pull/1802)).\n  - NOTE: This only affects Dovecot which supported 5 extra cipher suites using AES-CBC and AES-GCM. Your users MUA clients should be unaffected, preferring ECDHE or DHE for key exchange.\n- **[refactor]** Complete refactoring of opendkim script ([#1812](https://github.com/docker-mailserver/docker-mailserver/pull/1812)).\n  - NOTE: Use `./setup.sh config dkim help` to see the new syntax.\n\n## `v8.0.1`\n\nThis release is a hotfix for #1781.\n\n- **[spam]** `bl.spamcop.net` was removed from the list of spam lists since the domain expired and became unusable\n\n## `v8.0.0`\n\nThe transfer of the old repository to the new organization has completed. This release marks the new starting point for `docker-mailserver` in the `docker-mailserver` organization. Various improvements were made, small bugs fixed and the complete CI was transferred.\n\n- **[general]** transferred the whole repository to `docker-mailserver/docker-mailserver`\n- **[general]** adjusted `README.md` and split off `ENVIRONMENT.md`\n- **[ci]** usage of the GitHub Container Registry\n- **[ci]** switched from TravisCI to **GitHub Actions for CI/CD**\n  - now building images for `amd64` and `arm/v7` and `arm/64`\n  - integrated stale issues action to automatically close stale issues\n  - adjusted issue templates\n- **[build]** completely refactored and improved the `Dockerfile`\n- **[build]** improved the `Makefile`\n- **[image improvement]** added a proper init process\n- **[image improvement]** improved logging significantly\n- **[image improvement]** major LDAP improvements\n- **[bugfixes]** miscellaneous bug fixes and improvements\n\n### Breaking changes of release `8.0.0`\n\n- **[image improvement]** log-level now defaults to `warn`\n- **[image improvement]** DKIM default key size now 4096\n- **[general]** the `:latest` tag is now the latest release and `:edge` represents the latest push on `master`\n- **[general]** URL changed from `tomav/...` to `docker-mailserver/...`\n\n## `v7.2.0`\n\n- **[scripts]** refactored `target/bin/`\n- **[scripts]** redesigned environment variable use\n- **[general]** added Code of Conduct\n- **[general]** added missing Dovecot descriptions\n- **[tests]** enhanced and refactored all tests\n\n## `v7.1.0`\n\n- **[scripts]** use of default variables has changed slightly (consult [environment variables](./ENVIRONMENT.md))\n- **[scripts]** Added coherent coding style and linting\n- **[scripts]** Added option to use non-default network interface\n- **[general]** new contributing guidelines were added\n- **[general]** SELinux is now supported\n"
        },
        {
          "name": "CODE_OF_CONDUCT.md",
          "type": "blob",
          "size": 4.8935546875,
          "content": "# Contributor Covenant Code of Conduct\n\n## Our Pledge\n\nWe as members, contributors, and leaders pledge to make participation in our community a harassment-free experience for everyone, regardless of age, body size, visible or invisible disability, ethnicity, sex characteristics, gender identity and expression, level of experience, education, socio-economic status, nationality, personal appearance, race, religion, or sexual identity and orientation.\n\nWe pledge to act and interact in ways that contribute to an open, welcoming, diverse, inclusive, and healthy community.\n\n## Our Standards\n\nExamples of behavior that contributes to a positive environment for our community include:\n\n- Demonstrating empathy and kindness toward other people\n- Being respectful of differing opinions, viewpoints, and experiences\n- Giving and gracefully accepting constructive feedback\n- Accepting responsibility and apologizing to those affected by our mistakes, and learning from the experience\n- Focusing on what is best not just for us as individuals, but for the\n  overall community\n\nExamples of unacceptable behavior include:\n\n- The use of sexualized language or imagery, and sexual attention or advances of any kind\n- Trolling, insulting or derogatory comments, and personal or political attacks\n- Public or private harassment\n- Publishing others' private information, such as a physical or email address, without their explicit permission\n- Other conduct which could reasonably be considered inappropriate in a professional setting\n\n## Enforcement Responsibilities\n\nCommunity leaders are responsible for clarifying and enforcing our standards of acceptable behavior and will take appropriate and fair corrective action in response to any behavior that they deem inappropriate, threatening, offensive, or harmful.\n\nCommunity leaders have the right and responsibility to remove, edit, or reject comments, commits, code, documentation edits, issues, and other contributions that are not aligned to this Code of Conduct, and will communicate reasons for moderation decisions when appropriate.\n\n## Scope\n\nThis Code of Conduct applies within all community spaces, and also applies when an individual is officially representing the community in public spaces. Examples of representing our community include using an official e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event.\n\n## Enforcement\n\nInstances of abusive, harassing, or otherwise unacceptable behavior may be reported to the community leaders responsible for enforcement via issue. All complaints will be reviewed and investigated promptly and fairly.\n\nAll community leaders are obligated to respect the privacy and security of the reporter of any incident.\n\n## Enforcement Guidelines\n\nCommunity leaders will follow these Community Impact Guidelines in determining the consequences for any action they deem in violation of this Code of Conduct:\n\n### 1. Correction\n\n**Community Impact**: Use of inappropriate language or other behavior deemed unprofessional or unwelcome in the community.\n\n**Consequence**: A private, written warning from community leaders, providing clarity around the nature of the violation and an explanation of why the behavior was inappropriate. A public apology may be requested.\n\n### 2. Warning\n\n**Community Impact**: A violation through a single incident or series of actions.\n\n**Consequence**: A warning with consequences for continued behavior. No interaction with the people involved, including unsolicited interaction with those enforcing the Code of Conduct, for a specified period of time. This includes avoiding interactions in community spaces as well as external channels like social media. Violating these terms may lead to a temporary or permanent ban.\n\n### 3. Temporary Ban\n\n**Community Impact**: A serious violation of community standards, including sustained inappropriate behavior.\n\n**Consequence**: A temporary ban from any sort of interaction or public communication with the community for a specified period of time. No public or private interaction with the people involved, including unsolicited interaction with those enforcing the Code of Conduct, is allowed during this period. Violating these terms may lead to a permanent ban.\n\n### 4. Permanent Ban\n\n**Community Impact**: Demonstrating a pattern of violation of community standards, including sustained inappropriate behavior,  harassment of an individual, or aggression toward or disparagement of classes of individuals.\n\n**Consequence**: A permanent ban from any sort of public interaction within the community.\n\n## Attribution\n\nThis Code of Conduct is adapted from the [Contributor Covenant][homepage], version 2.0, available at <https://www.contributor-covenant.org/version/2/0/code_of_conduct.html>. Community Impact Guidelines were inspired by [Mozilla's code of conduct enforcement ladder](https://github.com/mozilla/diversity).\n\n[homepage]: https://www.contributor-covenant.org\n"
        },
        {
          "name": "Dockerfile",
          "type": "blob",
          "size": 13.5068359375,
          "content": "# syntax=docker.io/docker/dockerfile:1\n\n# This Dockerfile provides four stages: stage-base, stage-compile, stage-main and stage-final\n# This is in preparation for more granular stages (eg ClamAV and Fail2Ban split into their own)\n\nARG DEBIAN_FRONTEND=noninteractive\nARG DOVECOT_COMMUNITY_REPO=0\nARG LOG_LEVEL=trace\n\nFROM docker.io/debian:12-slim AS stage-base\n\nARG DEBIAN_FRONTEND\nARG DOVECOT_COMMUNITY_REPO\nARG LOG_LEVEL\n\nSHELL [\"/bin/bash\", \"-e\", \"-o\", \"pipefail\", \"-c\"]\n\n# -----------------------------------------------\n# --- Install Basic Software --------------------\n# -----------------------------------------------\n\nCOPY target/bin/sedfile /usr/local/bin/sedfile\nRUN <<EOF\n  chmod +x /usr/local/bin/sedfile\n  adduser --quiet --system --group --disabled-password --home /var/lib/clamav --no-create-home --uid 200 clamav\nEOF\n\nCOPY target/scripts/build/packages.sh /build/\nCOPY target/scripts/helpers/log.sh /usr/local/bin/helpers/log.sh\n\nRUN /bin/bash /build/packages.sh && rm -r /build\n\n# -----------------------------------------------\n# --- Compile deb packages ----------------------\n# -----------------------------------------------\n\nFROM stage-base AS stage-compile\n\nARG LOG_LEVEL\nARG DEBIAN_FRONTEND\n\nCOPY target/scripts/build/compile.sh /build/\nRUN /bin/bash /build/compile.sh\n\n#\n# main stage provides all packages, config, and adds scripts\n#\n\nFROM stage-base AS stage-main\n\nARG DEBIAN_FRONTEND\nARG LOG_LEVEL\n\nSHELL [\"/bin/bash\", \"-e\", \"-o\", \"pipefail\", \"-c\"]\n\n\n# -----------------------------------------------\n# --- ClamAV & FeshClam -------------------------\n# -----------------------------------------------\n\n# Copy over latest DB updates from official ClamAV image. This is better than running `freshclam`,\n# which would require an extra memory of 500MB+ during an image build.\n# When using `COPY --link`, the `--chown` option is only compatible with numeric ID values.\n# hadolint ignore=DL3021\nCOPY --link --chown=200 --from=docker.io/clamav/clamav-debian:latest /var/lib/clamav /var/lib/clamav\n\nRUN <<EOF\n  # `COPY --link --chown=200` has a bug when built by the buildx docker-container driver.\n  # Restore ownership of parent dirs (Bug: https://github.com/moby/buildkit/issues/3912)\n  chown root:root /var /var/lib\n  echo '0 */6 * * * clamav /usr/bin/freshclam --quiet' >/etc/cron.d/clamav-freshclam\n  chmod 644 /etc/clamav/freshclam.conf\n  sedfile -i 's/Foreground false/Foreground true/g' /etc/clamav/clamd.conf\n  mkdir /var/run/clamav\n  chown -R clamav:root /var/run/clamav\n  rm -rf /var/log/clamav/\nEOF\n\n# -----------------------------------------------\n# --- Dovecot -----------------------------------\n# -----------------------------------------------\n\n# install fts_xapian plugin\n\nCOPY --from=stage-compile dovecot-fts-xapian-*.deb /\nRUN dpkg -i /dovecot-fts-xapian-*.deb && rm /dovecot-fts-xapian-*.deb\n\nCOPY target/dovecot/*.inc target/dovecot/*.conf /etc/dovecot/conf.d/\nCOPY target/dovecot/dovecot-purge.cron /etc/cron.d/dovecot-purge.disabled\nRUN chmod 0 /etc/cron.d/dovecot-purge.disabled\nWORKDIR /usr/share/dovecot\n\n# hadolint ignore=SC2016,SC2086,SC2069\nRUN <<EOF\n  sedfile -i -e 's/include_try \\/usr\\/share\\/dovecot\\/protocols\\.d/include_try \\/etc\\/dovecot\\/protocols\\.d/g' /etc/dovecot/dovecot.conf\n  sedfile -i -e 's/#mail_plugins = \\$mail_plugins/mail_plugins = \\$mail_plugins sieve/g' /etc/dovecot/conf.d/15-lda.conf\n  sedfile -i -e 's/^.*lda_mailbox_autocreate.*/lda_mailbox_autocreate = yes/g' /etc/dovecot/conf.d/15-lda.conf\n  sedfile -i -e 's/^.*lda_mailbox_autosubscribe.*/lda_mailbox_autosubscribe = yes/g' /etc/dovecot/conf.d/15-lda.conf\n  sedfile -i -e 's/^.*postmaster_address.*/postmaster_address = '${POSTMASTER_ADDRESS:=\"postmaster@domain.com\"}'/g' /etc/dovecot/conf.d/15-lda.conf\nEOF\n\n# -----------------------------------------------\n# --- Rspamd ------------------------------------\n# -----------------------------------------------\n\nCOPY target/rspamd/local.d/ /etc/rspamd/local.d/\n\n# -----------------------------------------------\n# --- OAUTH2 ------------------------------------\n# -----------------------------------------------\n\nCOPY target/dovecot/dovecot-oauth2.conf.ext /etc/dovecot\nCOPY target/dovecot/auth-oauth2.conf.ext /etc/dovecot/conf.d\n\n# -----------------------------------------------\n# --- LDAP & SpamAssassin's Cron ----------------\n# -----------------------------------------------\n\nCOPY target/dovecot/dovecot-ldap.conf.ext /etc/dovecot\nCOPY target/dovecot/auth-ldap.conf.ext /etc/dovecot/conf.d\nCOPY \\\n  target/postfix/ldap-users.cf \\\n  target/postfix/ldap-groups.cf \\\n  target/postfix/ldap-aliases.cf \\\n  target/postfix/ldap-domains.cf \\\n  target/postfix/ldap-senders.cf \\\n  /etc/postfix/\n\n# hadolint ignore=SC2016\nRUN <<EOF\n  # ref: https://github.com/docker-mailserver/docker-mailserver/pull/3403#discussion_r1306282387\n  echo 'CRON=1' >/etc/default/spamassassin\n  sedfile -i -r 's/^\\$INIT restart/supervisorctl restart amavis/g' /etc/spamassassin/sa-update-hooks.d/amavisd-new\n  mkdir /etc/spamassassin/kam/\n  curl -sSfLo /etc/spamassassin/kam/kam.sa-channels.mcgrail.com.key https://mcgrail.com/downloads/kam.sa-channels.mcgrail.com.key\nEOF\n\n# -----------------------------------------------\n# --- PostSRSD, Postgrey & Amavis ---------------\n# -----------------------------------------------\n\nCOPY target/postsrsd/postsrsd /etc/default/postsrsd\nCOPY target/postgrey/postgrey /etc/default/postgrey\nRUN <<EOF\n  mkdir /var/run/postgrey\n  chown postgrey:postgrey /var/run/postgrey\n  curl -Lsfo /etc/postgrey/whitelist_clients https://raw.githubusercontent.com/schweikert/postgrey/master/postgrey_whitelist_clients\nEOF\n\nCOPY target/amavis/conf.d/* /etc/amavis/conf.d/\nCOPY target/amavis/postfix-amavis.cf /etc/dms/postfix/master.d/\nRUN <<EOF\n  sedfile -i -r 's/#(@|   \\\\%)bypass/\\1bypass/g' /etc/amavis/conf.d/15-content_filter_mode\n  # add users clamav and amavis to each others group\n  adduser clamav amavis\n  adduser amavis clamav\n  # no syslog user in Debian compared to Ubuntu\n  adduser --system syslog\n  useradd -u 5000 -d /home/docker -s /bin/bash -p \"$(echo docker | openssl passwd -1 -stdin)\" docker\n  echo \"0 4 * * * /usr/local/bin/virus-wiper\" | crontab -\n  chmod 644 /etc/amavis/conf.d/*\nEOF\n\n# overcomplication necessary for CI\n# hadolint ignore=SC2086\nRUN <<EOF\n  for _ in {1..10}; do\n    su - amavis -c \"razor-admin -create\"\n    sleep 3\n    if su - amavis -c \"razor-admin -register\"; then\n      EC=0\n      break\n    else\n      EC=${?}\n    fi\n  done\n  exit ${EC}\nEOF\n\n# -----------------------------------------------\n# --- Fail2Ban, DKIM & DMARC --------------------\n# -----------------------------------------------\n\nCOPY target/fail2ban/jail.local /etc/fail2ban/jail.local\nCOPY target/fail2ban/fail2ban.d/fixes.local /etc/fail2ban/fail2ban.d/fixes.local\nRUN <<EOF\n  ln -s  /var/log/mail/mail.log     /var/log/mail.log\n  ln -sf /var/log/mail/fail2ban.log /var/log/fail2ban.log\nEOF\n\nCOPY target/opendkim/opendkim.conf /etc/opendkim.conf\nCOPY target/opendkim/default-opendkim /etc/default/opendkim\n\nCOPY target/opendmarc/opendmarc.conf /etc/opendmarc.conf\nCOPY target/opendmarc/default-opendmarc /etc/default/opendmarc\nCOPY target/opendmarc/ignore.hosts /etc/opendmarc/ignore.hosts\n\n# --------------------------------------------------\n# --- postfix-mta-sts-daemon -----------------------\n# --------------------------------------------------\nCOPY target/mta-sts-daemon/mta-sts-daemon.yml /etc/mta-sts-daemon.yml\nRUN <<EOF\n  mkdir /var/run/mta-sts\n  chown -R _mta-sts:root /var/run/mta-sts\nEOF\n\n# --------------------------------------------------\n# --- Fetchmail, Getmail, Postfix & Let'sEncrypt ---\n# --------------------------------------------------\n\n# Remove invalid URL from SPF message\n# https://bugs.launchpad.net/spf-engine/+bug/1896912\nRUN echo 'Reason_Message = Message {rejectdefer} due to: {spf}.' >>/etc/postfix-policyd-spf-python/policyd-spf.conf\n\nCOPY target/fetchmail/fetchmailrc /etc/fetchmailrc_general\nCOPY target/getmail/getmailrc_general /etc/getmailrc_general\nCOPY target/getmail/getmail-service.sh /usr/local/bin/\nCOPY target/postfix/main.cf target/postfix/master.cf /etc/postfix/\n\n# DH parameters for DHE cipher suites, ffdhe4096 is the official standard 4096-bit DH params now part of TLS 1.3\n# This file is for TLS <1.3 handshakes that rely on DHE cipher suites\n# Handled at build to avoid failures by doveadm validating ssl_dh filepath in 10-ssl.auth (eg generate-accounts)\nCOPY target/shared/ffdhe4096.pem /etc/postfix/dhparams.pem\nCOPY target/shared/ffdhe4096.pem /etc/dovecot/dh.pem\n\nCOPY \\\n  target/postfix/header_checks.pcre \\\n  target/postfix/sender_header_filter.pcre \\\n  target/postfix/sender_login_maps.pcre \\\n  /etc/postfix/maps/\n\nRUN <<EOF\n  : >/etc/aliases\n  sedfile -i 's/START_DAEMON=no/START_DAEMON=yes/g' /etc/default/fetchmail\n  mkdir /var/run/fetchmail && chown fetchmail /var/run/fetchmail\nEOF\n\n# -----------------------------------------------\n# --- Logs --------------------------------------\n# -----------------------------------------------\n\nRUN <<EOF\n  sedfile -i -r \"/^#?compress/c\\compress\\ncopytruncate\" /etc/logrotate.conf\n  mkdir /var/log/mail\n  chown syslog:root /var/log/mail\n  touch /var/log/mail/clamav.log\n  chown -R clamav:root /var/log/mail/clamav.log\n  touch /var/log/mail/freshclam.log\n  chown -R clamav:root /var/log/mail/freshclam.log\n  sedfile -i -r 's|/var/log/mail|/var/log/mail/mail|g' /etc/rsyslog.conf\n  sedfile -i -r 's|;auth,authpriv.none|;mail.none;mail.error;auth,authpriv.none|g' /etc/rsyslog.conf\n  sedfile -i -r 's|LogFile /var/log/clamav/|LogFile /var/log/mail/|g' /etc/clamav/clamd.conf\n  sedfile -i -r 's|UpdateLogFile /var/log/clamav/|UpdateLogFile /var/log/mail/|g' /etc/clamav/freshclam.conf\n  sedfile -i -r 's|/var/log/clamav|/var/log/mail|g' /etc/logrotate.d/clamav-daemon\n  sedfile -i -r 's|invoke-rc.d.*|/usr/bin/supervisorctl signal hup clamav >/dev/null \\|\\| true|g' /etc/logrotate.d/clamav-daemon\n  sedfile -i -r 's|/var/log/clamav|/var/log/mail|g' /etc/logrotate.d/clamav-freshclam\n  sedfile -i -r '/postrotate/,/endscript/d' /etc/logrotate.d/clamav-freshclam\n  sedfile -i -r 's|/var/log/mail|/var/log/mail/mail|g' /etc/logrotate.d/rsyslog\n  sedfile -i -r '/\\/var\\/log\\/mail\\/mail.log/d' /etc/logrotate.d/rsyslog\n  sedfile -i    's|^/var/log/fail2ban.log {$|/var/log/mail/fail2ban.log {|' /etc/logrotate.d/fail2ban\n  # prevent syslog logrotate warnings\n  sedfile -i -e 's/\\(printerror \"could not determine current runlevel\"\\)/#\\1/' /usr/sbin/invoke-rc.d\n  sedfile -i -e 's/^\\(POLICYHELPER=\\).*/\\1/' /usr/sbin/invoke-rc.d\n  # prevent syslog warning about imklog permissions\n  sedfile -i -e 's/^module(load=\\\"imklog\\\")/#module(load=\\\"imklog\\\")/' /etc/rsyslog.conf\n  # this change is for our alternative process manager rather than part of\n  # a fix related to the change preceding it.\n  echo -e '\\n/usr/bin/supervisorctl signal hup rsyslog >/dev/null' >>/usr/lib/rsyslog/rsyslog-rotate\nEOF\n\n# -----------------------------------------------\n# --- Logwatch ----------------------------------\n# -----------------------------------------------\n\nCOPY target/logwatch/maillog.conf /etc/logwatch/conf/logfiles/maillog.conf\nCOPY target/logwatch/ignore.conf /etc/logwatch/conf/ignore.conf\n\n# -----------------------------------------------\n# --- Supervisord & Start -----------------------\n# -----------------------------------------------\n\nCOPY target/supervisor/supervisord.conf /etc/supervisor/supervisord.conf\nCOPY target/supervisor/conf.d/* /etc/supervisor/conf.d/\n\n# -----------------------------------------------\n# --- Scripts & Miscellaneous--------------------\n# -----------------------------------------------\n\nRUN <<EOF\n  rm -rf /usr/share/locale/*\n  rm -rf /usr/share/man/*\n  rm -rf /usr/share/doc/*\n  update-locale\nEOF\n\nCOPY \\\n  target/bin/* \\\n  target/scripts/*.sh \\\n  target/scripts/startup/*.sh \\\n  /usr/local/bin/\n\nRUN chmod +x /usr/local/bin/*\n\nCOPY target/scripts/helpers /usr/local/bin/helpers\nCOPY target/scripts/startup/setup.d /usr/local/bin/setup.d\n\n#\n# Final stage focuses only on image config\n#\n\nFROM stage-main AS stage-final\nARG DMS_RELEASE=edge\nARG VCS_REVISION=unknown\n\nWORKDIR /\nEXPOSE 25 587 143 465 993 110 995 4190\nENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\nCMD [\"supervisord\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\n\n# These ENVs are referenced in target/supervisor/conf.d/saslauth.conf\n# and must be present when supervisord starts. Introduced by PR:\n# https://github.com/docker-mailserver/docker-mailserver/pull/676\n# These ENV are also configured with the same defaults at:\n# https://github.com/docker-mailserver/docker-mailserver/blob/672e9cf19a3bb1da309e8cea6ee728e58f905366/target/scripts/helpers/variables.sh\nENV FETCHMAIL_POLL=300\nENV POSTGREY_AUTO_WHITELIST_CLIENTS=5\nENV POSTGREY_DELAY=300\nENV POSTGREY_MAX_AGE=35\nENV POSTGREY_TEXT=\"Delayed by Postgrey\"\nENV SASLAUTHD_MECH_OPTIONS=\"\"\n\n# Add metadata to image:\nLABEL org.opencontainers.image.title=\"docker-mailserver\"\nLABEL org.opencontainers.image.vendor=\"The Docker Mailserver Organization\"\nLABEL org.opencontainers.image.authors=\"The Docker Mailserver Organization on GitHub\"\nLABEL org.opencontainers.image.licenses=\"MIT\"\nLABEL org.opencontainers.image.description=\"A fullstack but simple mail server (SMTP, IMAP, LDAP, Anti-spam, Anti-virus, etc.). Only configuration files, no SQL database.\"\nLABEL org.opencontainers.image.url=\"https://github.com/docker-mailserver\"\nLABEL org.opencontainers.image.documentation=\"https://github.com/docker-mailserver/docker-mailserver/blob/master/README.md\"\nLABEL org.opencontainers.image.source=\"https://github.com/docker-mailserver/docker-mailserver\"\n# ARG invalidates cache when it is used by a layer (implicitly affects RUN)\n# Thus to maximize cache, keep these lines last:\nLABEL org.opencontainers.image.revision=${VCS_REVISION}\nLABEL org.opencontainers.image.version=${DMS_RELEASE}\nENV DMS_RELEASE=${DMS_RELEASE}\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.21484375,
          "content": "The MIT License (MIT)\n\nCopyright ¬© 2016 & 2017    Thomas Vial & Contributors\nCopyright ¬© 2016 - 2020    The GitHub Community & Contributors\nCopyright ¬© 2021 - PRESENT The Docker Mailserver Organization & Contributors\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n"
        },
        {
          "name": "Makefile",
          "type": "blob",
          "size": 3.03515625,
          "content": "SHELL       := /bin/bash\n.SHELLFLAGS += -e -u -o pipefail\n\nexport REPOSITORY_ROOT := $(CURDIR)\nexport IMAGE_NAME      ?= mailserver-testing:ci\nexport NAME            ?= $(IMAGE_NAME)\n\nMAKEFLAGS              += --no-print-directory\nBATS_FLAGS             ?= --timing\nBATS_PARALLEL_JOBS     ?= 2\n\n.PHONY: ALWAYS_RUN\n\n# -----------------------------------------------\n# --- Generic Targets ---------------------------\n# -----------------------------------------------\n\nall: lint build generate-accounts tests clean\n\nbuild: ALWAYS_RUN\n\t@ docker build --tag $(IMAGE_NAME) .\n\ngenerate-accounts: ALWAYS_RUN\n\t@ cp test/config/templates/postfix-accounts.cf test/config/postfix-accounts.cf\n\t@ cp test/config/templates/dovecot-masters.cf test/config/dovecot-masters.cf\n\n# `docker ps`:  Remove any lingering test containers\n# `.gitignore`: Remove `test/duplicate_configs` and files copied via `make generate-accounts`\nclean: ALWAYS_RUN\n\t-@ while read -r LINE; do CONTAINERS+=(\"$${LINE}\"); done < <(docker ps -qaf name='^(dms-test|mail)_.*') ; \\\n\t\tfor CONTAINER in \"$${CONTAINERS[@]}\"; do docker rm -f \"$${CONTAINER}\"; done\n\t-@ while read -r LINE; do [[ $${LINE} =~ test/.+ ]] && FILES+=(\"/mnt$${LINE#test}\"); done < .gitignore ; \\\n\t\tdocker run --rm -v \"$(REPOSITORY_ROOT)/test/:/mnt\" alpine ash -c \"rm -rf $${FILES[@]}\"\n\nrun-local-instance: ALWAYS_RUN\n\tbash -c 'sleep 8 ; ./setup.sh email add postmaster@example.test 123' &\n\tdocker run --rm --interactive --tty --name dms-test_example \\\n\t\t--env OVERRIDE_HOSTNAME=mail.example.test \\\n\t\t--env POSTFIX_INET_PROTOCOLS=ipv4 \\\n\t\t--env DOVECOT_INET_PROTOCOLS=ipv4 \\\n\t\t--env ENABLE_CLAMAV=0 \\\n\t\t--env ENABLE_AMAVIS=0 \\\n\t\t--env ENABLE_RSPAMD=0 \\\n\t\t--env ENABLE_OPENDKIM=0 \\\n\t\t--env ENABLE_OPENDMARC=0 \\\n\t\t--env ENABLE_POLICYD_SPF=0 \\\n\t\t--env ENABLE_SPAMASSASSIN=0 \\\n\t\t--env LOG_LEVEL=trace \\\n\t\t$(IMAGE_NAME)\n\n# -----------------------------------------------\n# --- Tests  ------------------------------------\n# -----------------------------------------------\n\ntests: ALWAYS_RUN\n# See https://github.com/docker-mailserver/docker-mailserver/pull/2857#issuecomment-1312724303\n# on why `generate-accounts` is run before each set (TODO/FIXME)\n\t@ for DIR in tests/{serial,parallel/set{1,2,3}} ; do $(MAKE) generate-accounts \"$${DIR}\" ; done\n\ntests/serial: ALWAYS_RUN\n\t@ shopt -s globstar ; ./test/bats/bin/bats $(BATS_FLAGS) test/$@/*.bats\n\ntests/parallel/set%: ALWAYS_RUN\n\t@ shopt -s globstar ; $(REPOSITORY_ROOT)/test/bats/bin/bats $(BATS_FLAGS) \\\n\t\t--no-parallelize-within-files \\\n\t\t--jobs $(BATS_PARALLEL_JOBS) \\\n\t\ttest/$@/**/*.bats\n\ntest/%: ALWAYS_RUN\n\t@ shopt -s globstar nullglob ; ./test/bats/bin/bats $(BATS_FLAGS) test/tests/**/{$*,}.bats\n\n# -----------------------------------------------\n# --- Lints -------------------------------------\n# -----------------------------------------------\n\nlint: ALWAYS_RUN eclint hadolint bashcheck shellcheck\n\nhadolint: ALWAYS_RUN\n\t@ ./test/linting/lint.sh hadolint\n\nbashcheck: ALWAYS_RUN\n\t@ ./test/linting/lint.sh bashcheck\n\nshellcheck: ALWAYS_RUN\n\t@ ./test/linting/lint.sh shellcheck\n\neclint: ALWAYS_RUN\n\t@ ./test/linting/lint.sh eclint\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 3.748046875,
          "content": "# Docker Mailserver\n\n[![ci::status]][ci::github] [![docker::pulls]][docker::hub] [![documentation::badge]][documentation::web]\n\n[ci::status]: https://img.shields.io/github/actions/workflow/status/docker-mailserver/docker-mailserver/default_on_push.yml?branch=master&color=blue&label=CI&logo=github&logoColor=white&style=for-the-badge\n[ci::github]: https://github.com/docker-mailserver/docker-mailserver/actions\n[docker::pulls]: https://img.shields.io/docker/pulls/mailserver/docker-mailserver.svg?style=for-the-badge&logo=docker&logoColor=white&color=blue\n[docker::hub]: https://hub.docker.com/r/mailserver/docker-mailserver/\n[documentation::badge]: https://img.shields.io/badge/DOCUMENTATION-GH%20PAGES-0078D4?style=for-the-badge&logo=googledocs&logoColor=white\n[documentation::web]: https://docker-mailserver.github.io/docker-mailserver/latest/\n\n## :page_with_curl: About\n\nA production-ready fullstack but simple containerized mail server (SMTP, IMAP, LDAP, Anti-spam, Anti-virus, etc.).\n- Only configuration files, no SQL database. Keep it simple and versioned. Easy to deploy and upgrade.\n- Originally created by [@tomav](https://github.com/tomav), this project is now maintained by volunteers since January 2021.\n\n## <!-- Adds a thin line break separator style -->\n\n> [!TIP]\n> Be sure to read [our documentation][documentation::web]. It provides guidance on initial setup of your mail server.\n\n> [!IMPORTANT]\n> If you have issues, please search through [the documentation][documentation::web] **for your version** before opening an issue.\n> \n> The issue tracker is for issues, not for personal support.  \n> Make sure the version of the documentation matches the image version you're using!\n\n## :link: Links to Useful Resources\n\n1. [FAQ](https://docker-mailserver.github.io/docker-mailserver/latest/faq/)\n2. [Usage](https://docker-mailserver.github.io/docker-mailserver/latest/usage/)\n3. [Examples](https://docker-mailserver.github.io/docker-mailserver/latest/examples/tutorials/basic-installation/)\n4. [Issues and Contributing](https://docker-mailserver.github.io/docker-mailserver/latest/contributing/issues-and-pull-requests/)\n5. [Release Notes](./CHANGELOG.md)\n6. [Environment Variables](https://docker-mailserver.github.io/docker-mailserver/latest/config/environment/)\n7. [Updating](https://docker-mailserver.github.io/docker-mailserver/latest/faq/#how-do-i-update-dms)\n\n## :package: Included Services\n\n- [Postfix](http://www.postfix.org) with SMTP or LDAP authentication and support for [extension delimiters](https://docker-mailserver.github.io/docker-mailserver/latest/config/account-management/overview/#aliases)\n- [Dovecot](https://www.dovecot.org) with SASL, IMAP, POP3, LDAP, [basic Sieve support](https://docker-mailserver.github.io/docker-mailserver/latest/config/advanced/mail-sieve) and [quotas](https://docker-mailserver.github.io/docker-mailserver/latest/config/user-management/#quotas)\n- [Rspamd](https://rspamd.com/)\n- [Amavis](https://www.amavis.org/)\n- [SpamAssassin](http://spamassassin.apache.org/) supporting custom rules\n- [ClamAV](https://www.clamav.net/) with automatic updates\n- [OpenDKIM](http://www.opendkim.org) & [OpenDMARC](https://github.com/trusteddomainproject/OpenDMARC)\n- [Fail2ban](https://www.fail2ban.org/wiki/index.php/Main_Page)\n- [Fetchmail](http://www.fetchmail.info/fetchmail-man.html)\n- [Getmail6](https://getmail6.org/documentation.html)\n- [Postscreen](http://www.postfix.org/POSTSCREEN_README.html)\n- [Postgrey](https://postgrey.schweikert.ch/)\n- Support for [LetsEncrypt](https://letsencrypt.org/), manual and self-signed certificates\n- A [setup script](https://docker-mailserver.github.io/docker-mailserver/latest/config/setup.sh) for easy configuration and maintenance\n- SASLauthd with LDAP authentication\n- OAuth2 authentication (_via `XOAUTH2` or `OAUTHBEARER` SASL mechanisms_)\n"
        },
        {
          "name": "SECURITY.md",
          "type": "blob",
          "size": 0.99609375,
          "content": "# Security Policy\n\n## Supported Versions\n\nDue to the way DMS is released, the most recent patches and the most current software is published on the `:edge` tag of the container image. Hence, security updates will land on this \"rolling release tag\". Older tags need manual updating, as we do not usually release an updated image for an existing tag; this will only be done in case of _severe_ vulnerabilities.\n\n| Image Tags  | Latest Packages & Patches |\n|-------------|:-------------------------:|\n| `:edge`     | :white_check_mark:        |\n| not `:edge` | :x:                       |\n\n## Reporting a Vulnerability\n\nWhen reporting a vulnerability, you can use GitHub's \"Private Vulnerability Reporting\". Just navigate to the [Open an Issue](https://github.com/docker-mailserver/docker-mailserver/issues/new/choose) page and choose \"Report a security vulnerability\". This way, maintainers will privately notified first. Afterwards, in a best-case scenario, if the vulnerability is fixed, the report will be made public.\n"
        },
        {
          "name": "VERSION",
          "type": "blob",
          "size": 0.0068359375,
          "content": "14.0.0\n"
        },
        {
          "name": "compose.yaml",
          "type": "blob",
          "size": 1.2333984375,
          "content": "services:\n  mailserver:\n    image: ghcr.io/docker-mailserver/docker-mailserver:latest\n    container_name: mailserver\n    # Provide the FQDN of your mail server here (Your DNS MX record should point to this value)\n    hostname: mail.example.com\n    env_file: mailserver.env\n    # More information about the mail-server ports:\n    # https://docker-mailserver.github.io/docker-mailserver/latest/config/security/understanding-the-ports/\n    ports:\n      - \"25:25\"    # SMTP  (explicit TLS => STARTTLS, Authentication is DISABLED => use port 465/587 instead)\n      - \"143:143\"  # IMAP4 (explicit TLS => STARTTLS)\n      - \"465:465\"  # ESMTP (implicit TLS)\n      - \"587:587\"  # ESMTP (explicit TLS => STARTTLS)\n      - \"993:993\"  # IMAP4 (implicit TLS)\n    volumes:\n      - ./docker-data/dms/mail-data/:/var/mail/\n      - ./docker-data/dms/mail-state/:/var/mail-state/\n      - ./docker-data/dms/mail-logs/:/var/log/mail/\n      - ./docker-data/dms/config/:/tmp/docker-mailserver/\n      - /etc/localtime:/etc/localtime:ro\n    restart: always\n    stop_grace_period: 1m\n    # Uncomment if using `ENABLE_FAIL2BAN=1`:\n    # cap_add:\n    #   - NET_ADMIN\n    healthcheck:\n      test: \"ss --listening --tcp | grep -P 'LISTEN.+:smtp' || exit 1\"\n      timeout: 3s\n      retries: 0\n"
        },
        {
          "name": "config-examples",
          "type": "tree",
          "content": null
        },
        {
          "name": "demo-setups",
          "type": "tree",
          "content": null
        },
        {
          "name": "docs",
          "type": "tree",
          "content": null
        },
        {
          "name": "mailserver.env",
          "type": "blob",
          "size": 23.43359375,
          "content": "# -----------------------------------------------\n# --- Mailserver Environment Variables ----------\n# -----------------------------------------------\n\n# DOCUMENTATION FOR THESE VARIABLES IS FOUND UNDER\n# https://docker-mailserver.github.io/docker-mailserver/latest/config/environment/\n\n# -----------------------------------------------\n# --- General Section ---------------------------\n# -----------------------------------------------\n\n# empty => uses the `hostname` command to get the mail server's canonical hostname\n# => Specify a fully-qualified domainname to serve mail for.  This is used for many of the config features so if you can't set your hostname (e.g. you're in a container platform that doesn't let you) specify it in this environment variable.\nOVERRIDE_HOSTNAME=\n\n# REMOVED in version v11.0.0! Use LOG_LEVEL instead.\nDMS_DEBUG=0\n\n# Set the log level for DMS.\n# This is mostly relevant for container startup scripts and change detection event feedback.\n#\n# Valid values (in order of increasing verbosity) are: `error`, `warn`, `info`, `debug` and `trace`.\n# The default log level is `info`.\nLOG_LEVEL=info\n\n# critical => Only show critical messages\n# error => Only show erroneous output\n# **warn** => Show warnings\n# info => Normal informational output\n# debug => Also show debug messages\nSUPERVISOR_LOGLEVEL=\n\n# Support for deployment where these defaults are not compatible (eg: some NAS appliances):\n# /var/mail vmail User ID (default: 5000)\nDMS_VMAIL_UID=\n# /var/mail vmail Group ID (default: 5000)\nDMS_VMAIL_GID=\n\n# **empty** => use FILE\n# LDAP => use LDAP authentication\n# OIDC => use OIDC authentication (not yet implemented)\n# FILE => use local files (this is used as the default)\nACCOUNT_PROVISIONER=\n\n# empty => postmaster@domain.com\n# => Specify the postmaster address\nPOSTMASTER_ADDRESS=\n\n# Check for updates on container start and then once a day\n# If an update is available, a mail is sent to POSTMASTER_ADDRESS\n# 0 => Update check disabled\n# 1 => Update check enabled\nENABLE_UPDATE_CHECK=1\n\n# Customize the update check interval.\n# Number + Suffix. Suffix must be 's' for seconds, 'm' for minutes, 'h' for hours or 'd' for days.\nUPDATE_CHECK_INTERVAL=1d\n\n# Set different options for mynetworks option (can be overwrite in postfix-main.cf)\n# **WARNING**: Adding the docker network's gateway to the list of trusted hosts, e.g. using the `network` or\n# `connected-networks` option, can create an open relay\n# https://github.com/docker-mailserver/docker-mailserver/issues/1405#issuecomment-590106498\n# The same can happen for rootless podman. To prevent this, set the value to \"none\" or configure slirp4netns\n# https://github.com/docker-mailserver/docker-mailserver/issues/2377\n#\n# none => Explicitly force authentication\n# container => Container IP address only\n# host => Add docker container network (ipv4 only)\n# network => Add all docker container networks (ipv4 only)\n# connected-networks => Add all connected docker networks (ipv4 only)\nPERMIT_DOCKER=none\n\n# Set the timezone. If this variable is unset, the container runtime will try to detect the time using\n# `/etc/localtime`, which you can alternatively mount into the container. The value of this variable\n# must follow the pattern `AREA/ZONE`, i.e. of you want to use Germany's time zone, use `Europe/Berlin`.\n# You can lookup all available timezones here: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones#List\nTZ=\n\n# In case you network interface differs from 'eth0', e.g. when you are using HostNetworking in Kubernetes,\n# you can set NETWORK_INTERFACE to whatever interface you want. This interface will then be used.\n#  - **empty** => eth0\nNETWORK_INTERFACE=\n\n# empty => modern\n# modern => Enables TLSv1.2 and modern ciphers only. (default)\n# intermediate => Enables TLSv1, TLSv1.1 and TLSv1.2 and broad compatibility ciphers.\nTLS_LEVEL=\n\n# Configures the handling of creating mails with forged sender addresses.\n#\n# **0** => (not recommended) Mail address spoofing allowed. Any logged in user may create email messages with a forged sender address (see also https://en.wikipedia.org/wiki/Email_spoofing).\n# 1 => Mail spoofing denied. Each user may only send with his own or his alias addresses. Addresses with extension delimiters(http://www.postfix.org/postconf.5.html#recipient_delimiter) are not able to send messages.\nSPOOF_PROTECTION=\n\n# Enables the Sender Rewriting Scheme. SRS is needed if your mail server acts as forwarder. See [postsrsd](https://github.com/roehling/postsrsd/blob/master/README.md#sender-rewriting-scheme-crash-course) for further explanation.\n#  - **0** => Disabled\n#  - 1 => Enabled\nENABLE_SRS=0\n\n# Enables the OpenDKIM service.\n# **1** => Enabled\n#   0   => Disabled\nENABLE_OPENDKIM=1\n\n# Enables the OpenDMARC service.\n# **1** => Enabled\n#   0   => Disabled\nENABLE_OPENDMARC=1\n\n\n# Enabled `policyd-spf` in Postfix's configuration. You will likely want to set this\n# to `0` in case you're using Rspamd (`ENABLE_RSPAMD=1`).\n#\n# - 0     => Disabled\n# - **1** => Enabled\nENABLE_POLICYD_SPF=1\n\n# Enables POP3 service\n# - **0** => Disabled\n# - 1     => Enabled\nENABLE_POP3=\n\n# Enables IMAP service\n# - 0     => Disabled\n# - **1** => Enabled\nENABLE_IMAP=1\n\n# Enables ClamAV, and anti-virus scanner.\n#   1   => Enabled\n# **0** => Disabled\nENABLE_CLAMAV=0\n\n# Add the value of this ENV as a prefix to the mail subject when spam is detected.\n# NOTE: This subject prefix may be redundant (by default spam is delivered to a junk folder).\n#       It provides value when your junk mail is stored alongside legitimate mail instead of a separate location (like with `SPAMASSASSIN_SPAM_TO_INBOX=1` or `MOVE_SPAM_TO_JUNK=0` or a POP3 only setup, without IMAP).\n# NOTE: When not using Docker Compose, other CRI may not support quote-wrapping the value here to preserve any trailing white-space.\nSPAM_SUBJECT=\n\n# Enables Rspamd\n# **0** => Disabled\n#   1   => Enabled\nENABLE_RSPAMD=0\n\n# When `ENABLE_RSPAMD=1`, an internal Redis instance is enabled implicitly.\n# This setting provides an opt-out to allow using an external instance instead.\n# 0 => Disabled\n# 1 => Enabled\nENABLE_RSPAMD_REDIS=\n\n# When enabled,\n#\n# 1. the \"[autolearning][rspamd-autolearn]\" feature is turned on;\n# 2. the Bayes classifier will be trained when moving mails from or to the Junk folder (with the help of Sieve scripts).\n#\n# **0** => disabled\n# 1     => enabled\nRSPAMD_LEARN=0\n\n# This settings controls whether checks should be performed on emails coming\n# from authenticated users (i.e. most likely outgoing emails). The default value\n# is `0` in order to align better with SpamAssassin. We recommend reading\n# through https://rspamd.com/doc/tutorials/scanning_outbound.html though to\n# decide for yourself whether you need and want this feature.\n#\n# Note that DKIM signing of e-mails will still happen.\nRSPAMD_CHECK_AUTHENTICATED=0\n\n# Controls whether the Rspamd Greylisting module is enabled.\n# This module can further assist in avoiding spam emails by greylisting\n# e-mails with a certain spam score.\n#\n# **0** => disabled\n# 1     => enabled\nRSPAMD_GREYLISTING=0\n\n# Can be used to enable or disable the Hfilter group module.\n#\n# - 0     => Disabled\n# - **1** => Enabled\nRSPAMD_HFILTER=1\n\n# Can be used to control the score when the HFILTER_HOSTNAME_UNKNOWN symbol applies. A higher score is more punishing. Setting it to 15 is equivalent to rejecting the email when the check fails.\n#\n# Default: 6\nRSPAMD_HFILTER_HOSTNAME_UNKNOWN_SCORE=6\n\n# Can be used to enable or disable the (still experimental) neural module.\n#\n# - **0** => Disabled\n# - 1     => Enabled\nRSPAMD_NEURAL=0\n\n# Amavis content filter (used for ClamAV & SpamAssassin)\n# 0 => Disabled\n# 1 => Enabled\nENABLE_AMAVIS=1\n\n# -1/-2/-3 => Only show errors\n# **0**    => Show warnings\n# 1/2      => Show default informational output\n# 3/4/5    => log debug information (very verbose)\nAMAVIS_LOGLEVEL=0\n\n# This enables DNS block lists in Postscreen.\n# Note: Emails will be rejected, if they don't pass the block list checks!\n# **0** => DNS block lists are disabled\n# 1     => DNS block lists are enabled\nENABLE_DNSBL=0\n\n# If you enable Fail2Ban, don't forget to add the following lines to your `compose.yaml`:\n#    cap_add:\n#      - NET_ADMIN\n# Otherwise, `nftables` won't be able to ban IPs.\nENABLE_FAIL2BAN=0\n\n# Fail2Ban blocktype\n# drop   => drop packet (send NO reply)\n# reject => reject packet (send ICMP unreachable)\nFAIL2BAN_BLOCKTYPE=drop\n\n# 1 => Enables Managesieve on port 4190\n# empty => disables Managesieve\nENABLE_MANAGESIEVE=\n\n# **enforce** => Allow other tests to complete. Reject attempts to deliver mail with a 550 SMTP reply, and log the helo/sender/recipient information. Repeat this test the next time the client connects.\n# drop => Drop the connection immediately with a 521 SMTP reply. Repeat this test the next time the client connects.\n# ignore => Ignore the failure of this test. Allow other tests to complete. Repeat this test the next time the client connects. This option is useful for testing and collecting statistics without blocking mail.\nPOSTSCREEN_ACTION=enforce\n\n# empty => all daemons start\n# 1 => only launch postfix smtp\nSMTP_ONLY=\n\n# Please read [the SSL page in the documentation](https://docker-mailserver.github.io/docker-mailserver/latest/config/security/ssl) for more information.\n#\n# empty => SSL disabled\n# letsencrypt => Enables Let's Encrypt certificates\n# custom => Enables custom certificates\n# manual => Let's you manually specify locations of your SSL certificates for non-standard cases\n# self-signed => Enables self-signed certificates\nSSL_TYPE=\n\n# These are only supported with `SSL_TYPE=manual`.\n# Provide the path to your cert and key files that you've mounted access to within the container.\nSSL_CERT_PATH=\nSSL_KEY_PATH=\n# Optional: A 2nd certificate can be supported as fallback (dual cert support), eg ECDSA with an RSA fallback.\n# Useful for additional compatibility with older MTA and MUA (eg pre-2015).\nSSL_ALT_CERT_PATH=\nSSL_ALT_KEY_PATH=\n\n# Set how many days a virusmail will stay on the server before being deleted\n# empty => 7 days\nVIRUSMAILS_DELETE_DELAY=\n\n# Configure Postfix `virtual_transport` to deliver mail to a different LMTP client (default is a dovecot socket).\n# Provide any valid URI. Examples:\n#\n# empty => `lmtp:unix:/var/run/dovecot/lmtp` (default, configured in Postfix main.cf)\n# `lmtp:unix:private/dovecot-lmtp` (use socket)\n# `lmtps:inet:<host>:<port>` (secure lmtp with starttls)\n# `lmtp:<kopano-host>:2003` (use kopano as mailstore)\nPOSTFIX_DAGENT=\n\n# Set the mailbox size limit for all users. If set to zero, the size will be unlimited (default). Size is in bytes.\n#\n# empty => 0\nPOSTFIX_MAILBOX_SIZE_LIMIT=\n\n# See https://docker-mailserver.github.io/docker-mailserver/latest/config/account-management/overview/#quotas\n# 0 => Dovecot quota is disabled\n# 1 => Dovecot quota is enabled\nENABLE_QUOTAS=1\n\n# Set the message size limit for all users. If set to zero, the size will be unlimited (not recommended!). Size is in bytes.\n#\n# empty => 10240000 (~10 MB)\nPOSTFIX_MESSAGE_SIZE_LIMIT=\n\n# Mails larger than this limit won't be scanned.\n# ClamAV must be enabled (ENABLE_CLAMAV=1) for this.\n#\n# empty => 25M (25 MB)\nCLAMAV_MESSAGE_SIZE_LIMIT=\n\n# Enables regular pflogsumm mail reports.\n# This is a new option. The old REPORT options are still supported for backwards compatibility. If this is not set and reports are enabled with the old options, logrotate will be used.\n#\n# not set => No report\n# daily_cron => Daily report for the previous day\n# logrotate => Full report based on the mail log when it is rotated\nPFLOGSUMM_TRIGGER=\n\n# Recipient address for pflogsumm reports.\n#\n# not set => Use REPORT_RECIPIENT or POSTMASTER_ADDRESS\n# => Specify the recipient address(es)\nPFLOGSUMM_RECIPIENT=\n\n# Sender address (`FROM`) for pflogsumm reports if pflogsumm reports are enabled.\n#\n# not set => Use REPORT_SENDER\n# => Specify the sender address\nPFLOGSUMM_SENDER=\n\n# Interval for logwatch report.\n#\n# none => No report is generated\n# daily => Send a daily report\n# weekly => Send a report every week\nLOGWATCH_INTERVAL=\n\n# Recipient address for logwatch reports if they are enabled.\n#\n# not set => Use REPORT_RECIPIENT or POSTMASTER_ADDRESS\n# => Specify the recipient address(es)\nLOGWATCH_RECIPIENT=\n\n# Sender address (`FROM`) for logwatch reports if logwatch reports are enabled.\n#\n# not set => Use REPORT_SENDER\n# => Specify the sender address\nLOGWATCH_SENDER=\n\n# Defines who receives reports if they are enabled.\n# **empty** => ${POSTMASTER_ADDRESS}\n# => Specify the recipient address\nREPORT_RECIPIENT=\n\n# Defines who sends reports if they are enabled.\n# **empty** => mailserver-report@${DOMAINNAME}\n# => Specify the sender address\nREPORT_SENDER=\n\n# Changes the interval in which log files are rotated\n# **weekly** => Rotate log files weekly\n# daily => Rotate log files daily\n# monthly => Rotate log files monthly\n#\n# Note: This Variable actually controls logrotate inside the container\n# and rotates the log files depending on this setting. The main log output is\n# still available in its entirety via `docker logs mail` (Or your\n# respective container name). If you want to control logrotation for\n# the Docker-generated logfile see:\n# https://docs.docker.com/config/containers/logging/configure/\n#\n# Note: This variable can also determine the interval for Postfix's log summary reports, see [`PFLOGSUMM_TRIGGER`](#pflogsumm_trigger).\nLOGROTATE_INTERVAL=weekly\n\n# Defines how many log files are kept by logrorate\nLOGROTATE_COUNT=4\n\n\n# If enabled, employs `reject_unknown_client_hostname` to sender restrictions in Postfix's configuration.\n#\n# - **0** => Disabled\n# - 1 => Enabled\nPOSTFIX_REJECT_UNKNOWN_CLIENT_HOSTNAME=0\n\n# Choose TCP/IP protocols for postfix to use\n# **all** => All possible protocols.\n# ipv4 => Use only IPv4 traffic. Most likely you want this behind Docker.\n# ipv6 => Use only IPv6 traffic.\n#\n# Note: More details at http://www.postfix.org/postconf.5.html#inet_protocols\nPOSTFIX_INET_PROTOCOLS=all\n\n# Enables MTA-STS support for outbound mail.\n# More details: https://docker-mailserver.github.io/docker-mailserver/v13.3/config/best-practices/mta-sts/\n# - **0** ==> MTA-STS disabled\n# - 1 => MTA-STS enabled\nENABLE_MTA_STS=0\n\n# Choose TCP/IP protocols for dovecot to use\n# **all** => Listen on all interfaces\n# ipv4 => Listen only on IPv4 interfaces. Most likely you want this behind Docker.\n# ipv6 => Listen only on IPv6 interfaces.\n#\n# Note: More information at https://dovecot.org/doc/dovecot-example.conf\nDOVECOT_INET_PROTOCOLS=all\n\n# -----------------------------------------------\n# --- SpamAssassin Section ----------------------\n# -----------------------------------------------\n\nENABLE_SPAMASSASSIN=0\n\n# KAM is a 3rd party SpamAssassin ruleset, provided by the McGrail Foundation.\n# If SpamAssassin is enabled, KAM can be used in addition to the default ruleset.\n# - **0** => KAM disabled\n# - 1 => KAM enabled\n#\n# Note: only has an effect if `ENABLE_SPAMASSASSIN=1`\nENABLE_SPAMASSASSIN_KAM=0\n\n# deliver spam messages to the inbox (tagged using SPAM_SUBJECT)\nSPAMASSASSIN_SPAM_TO_INBOX=1\n\n# spam messages will be moved in the Junk folder (SPAMASSASSIN_SPAM_TO_INBOX=1 required)\nMOVE_SPAM_TO_JUNK=1\n\n# spam messages will be marked as read\nMARK_SPAM_AS_READ=0\n\n# add 'spam info' headers at, or above this level\nSA_TAG=2.0\n\n# add 'spam detected' headers at, or above this level\nSA_TAG2=6.31\n\n# triggers spam evasive actions\nSA_KILL=10.0\n\n# -----------------------------------------------\n# --- Fetchmail Section -------------------------\n# -----------------------------------------------\n\nENABLE_FETCHMAIL=0\n\n# The interval to fetch mail in seconds\nFETCHMAIL_POLL=300\n# Use multiple fetchmail instances (1 per poll entry in fetchmail.cf)\n# Supports multiple IMAP IDLE connections when a server is used across multiple poll entries\n# https://otremba.net/wiki/Fetchmail_(Debian)#Immediate_Download_via_IMAP_IDLE\nFETCHMAIL_PARALLEL=0\n\n# Enable or disable `getmail`.\n#\n# - **0** => Disabled\n# - 1 => Enabled\nENABLE_GETMAIL=0\n\n# The number of minutes for the interval. Min: 1; Default: 5.\nGETMAIL_POLL=5\n\n# -----------------------------------------------\n# --- OAUTH2 Section ----------------------------\n# -----------------------------------------------\n\n# empty => OAUTH2 authentication is disabled\n# 1 => OAUTH2 authentication is enabled\nENABLE_OAUTH2=\n\n# Specify the user info endpoint URL of the oauth2 provider\n# Example: https://oauth2.example.com/userinfo/\nOAUTH2_INTROSPECTION_URL=\n\n# -----------------------------------------------\n# --- LDAP Section ------------------------------\n# -----------------------------------------------\n\n# A second container for the ldap service is necessary (i.e. https://hub.docker.com/r/bitnami/openldap/)\n\n# empty => no\n# yes => LDAP over TLS enabled for Postfix\nLDAP_START_TLS=\n\n# empty => mail.example.com\n# Specify the `<dns-name>` / `<ip-address>` where the LDAP server is reachable via a URI like: `ldaps://mail.example.com`.\n# Note: You must include the desired URI scheme (`ldap://`, `ldaps://`, `ldapi://`).\nLDAP_SERVER_HOST=\n\n# empty => ou=people,dc=domain,dc=com\n# => e.g. LDAP_SEARCH_BASE=dc=mydomain,dc=local\nLDAP_SEARCH_BASE=\n\n# empty => cn=admin,dc=domain,dc=com\n# => take a look at examples of SASL_LDAP_BIND_DN\nLDAP_BIND_DN=\n\n# empty** => admin\n# => Specify the password to bind against ldap\nLDAP_BIND_PW=\n\n# e.g. `\"(&(mail=%s)(mailEnabled=TRUE))\"`\n# => Specify how ldap should be asked for users\nLDAP_QUERY_FILTER_USER=\n\n# e.g. `\"(&(mailGroupMember=%s)(mailEnabled=TRUE))\"`\n# => Specify how ldap should be asked for groups\nLDAP_QUERY_FILTER_GROUP=\n\n# e.g. `\"(&(mailAlias=%s)(mailEnabled=TRUE))\"`\n# => Specify how ldap should be asked for aliases\nLDAP_QUERY_FILTER_ALIAS=\n\n# e.g. `\"(&(|(mail=*@%s)(mailalias=*@%s)(mailGroupMember=*@%s))(mailEnabled=TRUE))\"`\n# => Specify how ldap should be asked for domains\nLDAP_QUERY_FILTER_DOMAIN=\n\n# -----------------------------------------------\n# --- Dovecot Section ---------------------------\n# -----------------------------------------------\n\n# empty => no\n# yes => LDAP over TLS enabled for Dovecot\nDOVECOT_TLS=\n\n# e.g. `\"(&(objectClass=PostfixBookMailAccount)(uniqueIdentifier=%n))\"`\nDOVECOT_USER_FILTER=\n\n# e.g. `\"(&(objectClass=PostfixBookMailAccount)(uniqueIdentifier=%n))\"`\nDOVECOT_PASS_FILTER=\n\n# Define the mailbox format to be used\n# default is maildir, supported values are: sdbox, mdbox, maildir\nDOVECOT_MAILBOX_FORMAT=maildir\n\n# empty => no\n# yes => Allow bind authentication for LDAP\n# https://wiki.dovecot.org/AuthDatabase/LDAP/AuthBinds\nDOVECOT_AUTH_BIND=\n\n# -----------------------------------------------\n# --- Postgrey Section --------------------------\n# -----------------------------------------------\n\nENABLE_POSTGREY=0\n# greylist for N seconds\nPOSTGREY_DELAY=300\n# delete entries older than N days since the last time that they have been seen\nPOSTGREY_MAX_AGE=35\n# response when a mail is greylisted\nPOSTGREY_TEXT=\"Delayed by Postgrey\"\n# whitelist host after N successful deliveries (N=0 to disable whitelisting)\nPOSTGREY_AUTO_WHITELIST_CLIENTS=5\n\n# -----------------------------------------------\n# --- SASL Section ------------------------------\n# -----------------------------------------------\n\nENABLE_SASLAUTHD=0\n\n# empty => pam\n# `ldap` => authenticate against ldap server\n# `shadow` => authenticate against local user db\n# `mysql` => authenticate against mysql db\n# `rimap` => authenticate against imap server\n# Note: can be a list of mechanisms like pam ldap shadow\nSASLAUTHD_MECHANISMS=\n\n# empty => None\n# e.g. with SASLAUTHD_MECHANISMS rimap you need to specify the ip-address/servername of the imap server  ==> xxx.xxx.xxx.xxx\nSASLAUTHD_MECH_OPTIONS=\n\n# empty => Use value of LDAP_SERVER_HOST\n# Note: You must include the desired URI scheme (`ldap://`, `ldaps://`, `ldapi://`).\nSASLAUTHD_LDAP_SERVER=\n\n# empty => Use value of LDAP_BIND_DN\n# specify an object with privileges to search the directory tree\n# e.g. active directory: SASLAUTHD_LDAP_BIND_DN=cn=Administrator,cn=Users,dc=mydomain,dc=net\n# e.g. openldap: SASLAUTHD_LDAP_BIND_DN=cn=admin,dc=mydomain,dc=net\nSASLAUTHD_LDAP_BIND_DN=\n\n# empty => Use value of LDAP_BIND_PW\nSASLAUTHD_LDAP_PASSWORD=\n\n# empty => Use value of LDAP_SEARCH_BASE\n# specify the search base\nSASLAUTHD_LDAP_SEARCH_BASE=\n\n# empty => default filter `(&(uniqueIdentifier=%u)(mailEnabled=TRUE))`\n# e.g. for active directory: `(&(sAMAccountName=%U)(objectClass=person))`\n# e.g. for openldap: `(&(uid=%U)(objectClass=person))`\nSASLAUTHD_LDAP_FILTER=\n\n# empty => no\n# yes => LDAP over TLS enabled for SASL\n# If set to yes, the protocol in SASLAUTHD_LDAP_SERVER must be ldap:// or missing.\nSASLAUTHD_LDAP_START_TLS=\n\n# empty => no\n# yes => Require and verify server certificate\n# If yes you must/could specify SASLAUTHD_LDAP_TLS_CACERT_FILE or SASLAUTHD_LDAP_TLS_CACERT_DIR.\nSASLAUTHD_LDAP_TLS_CHECK_PEER=\n\n# File containing CA (Certificate Authority) certificate(s).\n# empty => Nothing is added to the configuration\n# Any value => Fills the `ldap_tls_cacert_file` option\nSASLAUTHD_LDAP_TLS_CACERT_FILE=\n\n# Path to directory with CA (Certificate Authority) certificates.\n# empty => Nothing is added to the configuration\n# Any value => Fills the `ldap_tls_cacert_dir` option\nSASLAUTHD_LDAP_TLS_CACERT_DIR=\n\n# Specify what password attribute to use for password verification.\n# empty => Nothing is added to the configuration but the documentation says it is `userPassword` by default.\n# Any value => Fills the `ldap_password_attr` option\nSASLAUTHD_LDAP_PASSWORD_ATTR=\n\n# empty => `bind` will be used as a default value\n# `fastbind` => The fastbind method is used\n# `custom` => The custom method uses userPassword attribute to verify the password\nSASLAUTHD_LDAP_AUTH_METHOD=\n\n# Specify the authentication mechanism for SASL bind\n# empty => Nothing is added to the configuration\n#¬†Any value => Fills the `ldap_mech` option\nSASLAUTHD_LDAP_MECH=\n\n# -----------------------------------------------\n# --- SRS Section -------------------------------\n# -----------------------------------------------\n\n# envelope_sender => Rewrite only envelope sender address (default)\n# header_sender => Rewrite only header sender (not recommended)\n# envelope_sender,header_sender => Rewrite both senders\n# An email has an \"envelope\" sender (indicating the sending server) and a\n# \"header\" sender (indicating who sent it). More strict SPF policies may require\n# you to replace both instead of just the envelope sender.\nSRS_SENDER_CLASSES=envelope_sender\n\n# empty => Envelope sender will be rewritten for all domains\n# provide comma separated list of domains to exclude from rewriting\nSRS_EXCLUDE_DOMAINS=\n\n# empty => generated when the image is built\n# provide a secret to use in base64\n# you may specify multiple keys, comma separated. the first one is used for\n# signing and the remaining will be used for verification. this is how you\n# rotate and expire keys\nSRS_SECRET=\n\n# -----------------------------------------------\n# --- Default Relay Host Section ----------------\n# -----------------------------------------------\n\n# Setup relaying all mail through a default relay host\n#\n# Set a default host to relay all mail through (optionally include a port)\n# Example: [mail.example.com]:587\nDEFAULT_RELAY_HOST=\n\n# -----------------------------------------------\n# --- Multi-Domain Relay Section ----------------\n# -----------------------------------------------\n\n# Setup relaying for multiple domains based on the domain name of the sender\n# optionally uses usernames and passwords in postfix-sasl-password.cf and relay host mappings in postfix-relaymap.cf\n#\n# Set a default host to relay mail through\n# Example: mail.example.com\nRELAY_HOST=\n\n# empty => 25\n# default port to relay mail\nRELAY_PORT=25\n\n# -----------------------------------------------\n# --- Relay Host Credentials Section ------------\n# -----------------------------------------------\n\n# Configure a relay user and password to use with RELAY_HOST / DEFAULT_RELAY_HOST\n\n# empty => no default\nRELAY_USER=\n\n# empty => no default\nRELAY_PASSWORD=\n"
        },
        {
          "name": "setup.sh",
          "type": "blob",
          "size": 5.4208984375,
          "content": "#!/bin/bash\n\n# version   v1.0.0\n# executed  manually / via Make\n# task      wrapper for various setup scripts\n\nCONFIG_PATH=\nCONTAINER_NAME=\nCRI=\nDEFAULT_CONFIG_PATH=\nDESIRED_CONFIG_PATH=\nDIR=$(pwd)\nDMS_CONFIG='/tmp/docker-mailserver'\nIMAGE_NAME=\nDEFAULT_IMAGE_NAME='ghcr.io/docker-mailserver/docker-mailserver:latest'\nINFO=\nPODMAN_ROOTLESS=false\nUSE_SELINUX=\nUSE_TTY=\nVOLUME=\n\nWHITE=$(echo -ne '\\e[37m')\nORANGE=$(echo -ne '\\e[38;5;214m')\nLBLUE=$(echo -ne '\\e[94m')\nRESET=$(echo -ne '\\e[0m')\n\nset -euEo pipefail\nshopt -s inherit_errexit 2>/dev/null || true\n\nfunction _show_local_usage() {\n  # shellcheck disable=SC2059\n  printf '%s' \"${ORANGE}OPTIONS${RESET}\n    ${LBLUE}Config path, container or image adjustments${RESET}\n        -i IMAGE_NAME\n            Provides the name of the 'docker-mailserver' image. The default value is\n            '${WHITE}${DEFAULT_IMAGE_NAME}${RESET}'\n\n        -c CONTAINER_NAME\n            Provides the name of the running container.\n\n        -p PATH\n            Provides the local path of the config folder to the temporary container instance.\n            Does not work if an existing a 'docker-mailserver' container is already running.\n\n    ${LBLUE}SELinux${RESET}\n        -z\n            Allows container access to the bind mount content that is shared among\n            multiple containers on a SELinux-enabled host.\n\n        -Z\n            Allows container access to the bind mount content that is private and\n            unshared with other containers on a SELinux-enabled host.\n\n    ${LBLUE}Podman${RESET}\n        -R\n            Accept running in Podman rootless mode. Ignored when using Docker / Docker Compose.\n\n\"\n\n  [[ ${1:-} == 'no-exit' ]] && return 0\n\n  # shellcheck disable=SC2059\n  printf '%s' \"${ORANGE}EXIT STATUS${RESET}\n    Exit status is 0 if the command was successful. If there was an unexpected error, an error\n    message is shown describing the error. In case of an error, the script will exit with exit\n    status 1.\n\n\"\n}\n\nfunction _get_absolute_script_directory() {\n  if dirname \"$(readlink -f \"${0}\")\" &>/dev/null; then\n    DIR=$(dirname \"$(readlink -f \"${0}\")\")\n  elif realpath -e -L \"${0}\" &>/dev/null; then\n    DIR=$(realpath -e -L \"${0}\")\n    DIR=\"${DIR%/setup.sh}\"\n  fi\n}\n\nfunction _set_default_config_path() {\n  if [[ -d \"${DIR}/config\" ]]; then\n    # legacy path (pre v10.2.0)\n    DEFAULT_CONFIG_PATH=\"${DIR}/config\"\n  else\n    DEFAULT_CONFIG_PATH=\"${DIR}/docker-data/dms/config\"\n  fi\n}\n\nfunction _handle_config_path() {\n  if [[ -z ${DESIRED_CONFIG_PATH} ]]; then\n    # no desired config path\n    if [[ -n ${CONTAINER_NAME} ]]; then\n      VOLUME=$(${CRI} inspect \"${CONTAINER_NAME}\" \\\n        --format=\"{{range .Mounts}}{{ println .Source .Destination}}{{end}}\" | \\\n        grep \"${DMS_CONFIG}$\" 2>/dev/null || :)\n    fi\n\n    if [[ -n ${VOLUME} ]]; then\n      CONFIG_PATH=$(echo \"${VOLUME}\" | awk '{print $1}')\n    fi\n\n    if [[ -z ${CONFIG_PATH} ]]; then\n      CONFIG_PATH=${DEFAULT_CONFIG_PATH}\n    fi\n  else\n    CONFIG_PATH=${DESIRED_CONFIG_PATH}\n  fi\n}\n\nfunction _run_in_new_container() {\n  # start temporary container with specified image\n  if ! ${CRI} history -q \"${IMAGE_NAME}\" &>/dev/null; then\n    echo \"Image '${IMAGE_NAME}' not found. Pulling ...\"\n    ${CRI} pull \"${IMAGE_NAME}\"\n  fi\n\n  ${CRI} run --rm \"${USE_TTY}\" \\\n    -v \"${CONFIG_PATH}:${DMS_CONFIG}${USE_SELINUX}\" \\\n    \"${IMAGE_NAME}\" \"${@}\"\n}\n\nfunction _main() {\n  _get_absolute_script_directory\n  _set_default_config_path\n\n  local OPTIND\n  while getopts \":c:i:p:zZR\" OPT; do\n    case ${OPT} in\n      ( i )     IMAGE_NAME=\"${OPTARG}\"     ;;\n      ( z | Z ) USE_SELINUX=\":${OPT}\"      ;;\n      ( c )     CONTAINER_NAME=\"${OPTARG}\" ;;\n      ( R )     PODMAN_ROOTLESS=true       ;;\n      ( p )\n        case \"${OPTARG}\" in\n          ( /* ) DESIRED_CONFIG_PATH=\"${OPTARG}\"        ;;\n          ( *  ) DESIRED_CONFIG_PATH=\"${DIR}/${OPTARG}\" ;;\n        esac\n\n        if [[ ! -d ${DESIRED_CONFIG_PATH} ]]; then\n          echo \"Specified directory '${DESIRED_CONFIG_PATH}' doesn't exist\" >&2\n          exit 1\n        fi\n        ;;\n\n      ( * )\n        echo \"Invalid option: '-${OPTARG}'\" >&2\n        echo -e \"Use './setup.sh help' to get a complete overview.\\n\" >&2\n        _show_local_usage 'no-exit'\n        exit 1\n        ;;\n\n    esac\n  done\n  shift $(( OPTIND - 1 ))\n\n  if command -v docker &>/dev/null; then\n    CRI=docker\n  elif command -v podman &>/dev/null; then\n    CRI=podman\n    if ! ${PODMAN_ROOTLESS} && [[ ${EUID} -ne 0 ]]; then\n      read -r -p \"You are running Podman in rootless mode. Continue? [Y/n] \"\n      [[ -n ${REPLY} ]] && [[ ${REPLY} =~ (n|N) ]] && exit 0\n    fi\n  else\n    echo 'No supported Container Runtime Interface detected.'\n    exit 1\n  fi\n\n  INFO=$(${CRI} ps --no-trunc --format \"{{.Image}};{{.Names}}\" --filter \\\n    label=org.opencontainers.image.title=\"docker-mailserver\" | tail -1)\n\n  [[ -z ${CONTAINER_NAME} ]] && CONTAINER_NAME=${INFO#*;}\n  [[ -z ${IMAGE_NAME} ]] && IMAGE_NAME=${INFO%;*}\n  if [[ -z ${IMAGE_NAME} ]]; then\n    IMAGE_NAME=${NAME:-${DEFAULT_IMAGE_NAME}}\n  fi\n\n  if test -t 0; then\n    USE_TTY=\"-it\"\n  else\n    # GitHub Actions will fail (or really anything else\n    #   lacking an interactive tty) if we don't set a\n    #   value here; \"-t\" alone works for these cases.\n    USE_TTY=\"-t\"\n  fi\n\n  _handle_config_path\n\n  if [[ -n ${CONTAINER_NAME} ]]; then\n    ${CRI} exec \"${USE_TTY}\" \"${CONTAINER_NAME}\" setup \"${@}\"\n  else\n    _run_in_new_container setup \"${@}\"\n  fi\n\n  [[ ${1:-} == 'help' ]] && _show_local_usage\n\n  return 0\n}\n\n[[ -z ${1:-} ]] && set 'help'\n_main \"${@}\"\n"
        },
        {
          "name": "target",
          "type": "tree",
          "content": null
        },
        {
          "name": "test",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}