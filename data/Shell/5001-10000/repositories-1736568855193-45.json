{
  "metadata": {
    "timestamp": 1736568855193,
    "page": 45,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjUw",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "getsentry/self-hosted",
      "stars": 8084,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".craft.yml",
          "type": "blob",
          "size": 0.09765625,
          "content": "minVersion: \"0.23.1\"\nchangelogPolicy: auto\nartifactProvider:\n  name: none\ntargets:\n  - name: github\n"
        },
        {
          "name": ".editorconfig",
          "type": "blob",
          "size": 0.1787109375,
          "content": "root = true\n\n[*]\ncharset = utf-8\nend_of_line = lf\nindent_style = space\ninsert_final_newline = true\n\n[*.sh]\nindent_size = 2\n\n[*.yml]\nindent_size = 2\n\n[nginx/*.conf]\nindent_style = tab\n"
        },
        {
          "name": ".env",
          "type": "blob",
          "size": 1.1015625,
          "content": "COMPOSE_PROJECT_NAME=sentry-self-hosted\n# Set COMPOSE_PROFILES to \"feature-complete\" to enable all features\n# To enable errors monitoring only, set COMPOSE_PROFILES=errors-only\n# See https://develop.sentry.dev/self-hosted/experimental/errors-only/\nCOMPOSE_PROFILES=feature-complete\nSENTRY_EVENT_RETENTION_DAYS=90\n# You can either use a port number or an IP:PORT combo for SENTRY_BIND\n# See https://docs.docker.com/compose/compose-file/#ports for more\nSENTRY_BIND=9000\n# Set SENTRY_MAIL_HOST to a valid FQDN (host/domain name) to be able to send emails!\n# SENTRY_MAIL_HOST=example.com\nSENTRY_IMAGE=getsentry/sentry:nightly\nSNUBA_IMAGE=getsentry/snuba:nightly\nRELAY_IMAGE=getsentry/relay:nightly\nSYMBOLICATOR_IMAGE=getsentry/symbolicator:nightly\nVROOM_IMAGE=getsentry/vroom:nightly\nHEALTHCHECK_INTERVAL=30s\nHEALTHCHECK_TIMEOUT=1m30s\nHEALTHCHECK_RETRIES=10\n# Caution: Raising max connections of postgres increases CPU and RAM usage\n# see https://github.com/getsentry/self-hosted/pull/2740 for more information\nPOSTGRES_MAX_CONNECTIONS=100\n# Set SETUP_JS_SDK_ASSETS to 1 to enable the setup of JS SDK assets\n# SETUP_JS_SDK_ASSETS=1\n"
        },
        {
          "name": ".gitattributes",
          "type": "blob",
          "size": 0.130859375,
          "content": "/.gitattributes export-ignore\n/.gitignore export-ignore\n/.github export-ignore\n/.editorconfig export-ignore\n/.craft.yml export-ignore\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 1.5126953125,
          "content": "# Error reporting choice cache\n.reporterrors\n\n# Byte-compiled / optimized / DLL files\n__pycache__/\n*.py[cod]\n*$py.class\n\n# C extensions\n*.so\n\n# Distribution / packaging\n.Python\nenv/\nbuild/\ndevelop-eggs/\ndist/\ndownloads/\neggs/\n.eggs/\nlib/\nlib64/\nparts/\nsdist/\nvar/\n*.egg-info/\n.installed.cfg\n*.egg\n\n# PyInstaller\n#  Usually these files are written by a python script from a template\n#  before PyInstaller builds the exe, so as to inject date/other infos into it.\n*.manifest\n*.spec\n\n# Installer logs\npip-log.txt\npip-delete-this-directory.txt\nsentry_install_log*.txt\nsentry_reset_log*.txt\nsentry_restore_log*.txt\nsentry_backup_log*.txt\n\n# Unit test / coverage reports\nhtmlcov/\n.tox/\n.coverage\n.coverage.*\n.cache\nnosetests.xml\ncoverage.xml\n*.cover\n.hypothesis/\n\n# Translations\n*.mo\n*.pot\n\n# Django stuff:\n*.log\nlocal_settings.py\n\n# Sphinx documentation\ndocs/_build/\n\n# PyBuilder\ntarget/\n\n# Ipython Notebook\n.ipynb_checkpoints\n\n# pyenv\n.python-version\n\n# https://docs.docker.com/compose/extends/\ndocker-compose.override.yml\n\n# https://docs.docker.com/compose/environment-variables/#using-the---env-file--option\n.env.custom\n\n*.tar\ndata/\n\n# Editor / IDE\n.vscode/tags\n.idea\n\n# custom Sentry config\nsentry/sentry.conf.py\nsentry/config.yml\nsentry/*.bak\nsentry/backup.json\nsentry/enhance-image.sh\nsentry/requirements.txt\nrelay/credentials.json\nrelay/config.yml\nsymbolicator/config.yml\ngeoip/GeoIP.conf\ngeoip/*.mmdb\ngeoip/.geoipupdate.lock\n\n# integration testing\n_integration-test/custom-ca-roots/nginx/*\nsentry/test-custom-ca-roots.py\n\n# OSX minutia\n.DS_Store\n"
        },
        {
          "name": ".pre-commit-config.yaml",
          "type": "blob",
          "size": 0.6875,
          "content": "repos:\n- repo: local\n  hooks:\n    # Based on https://github.com/scop/pre-commit-shfmt/blob/main/.pre-commit-hooks.yaml\n    # Customized to also work on ARM, and give diff for CI on failure.\n    - id: shfmt\n      name: shfmt\n      description: Format shell source code\n      language: docker_image\n      entry: --net none mvdan/shfmt:v3.5.1\n      args: [-w, -d]\n      files: .*\\.sh\n      stages: [commit, merge-commit, push, manual]\n\n- repo: https://github.com/pre-commit/pre-commit-hooks\n  rev: v4.3.0\n  hooks:\n  - id: check-case-conflict\n  - id: check-executables-have-shebangs\n  - id: check-merge-conflict\n  - id: check-symlinks\n  - id: end-of-file-fixer\n  - id: trailing-whitespace\n  - id: check-yaml\n"
        },
        {
          "name": "CHANGELOG.md",
          "type": "blob",
          "size": 27.4189453125,
          "content": "# Changelog\n\n## 24.12.1\n\n### Various fixes & improvements\n\n- chore: clearer message for errors-only mode (#3487) by @aldy505\n- chore(relay): provide opt-in max_memory_percent config as workaround for failing healthcheck (#3486) by @aldy505\n- fix(nginx): _assets should rewrite to _static/sentry/dist (#3483) by @BYK\n\n## 24.12.0\n\n- No documented changes.\n\n## 24.11.2\n\n### Various fixes & improvements\n\n- fix(redis): Actually use custom config (#3459) by @BYK\n- feat(release): Replace release bot with GH app (#3458) by @Jeffreyhung\n- chore(issue-template): ask for machine specification and provide link to security policy (#3447) by @aldy505\n- add sentry/backup.json to gitignore (#3450) by @niklassc7\n- ref: remove suggested fix (#3446) by @aldy505\n\n## 24.11.1\n\n### Various fixes & improvements\n\n- fix(redis): Use a safer eviction rule (#3432) by @BYK\n- feat: add Redis configuration for improved memory management (#3427) by @Hassanzadeh-sd\n- build(deps): bump codecov/codecov-action from 4 to 5 (#3429) by @dependabot\n\n## 24.11.0\n\n### Various fixes & improvements\n\n- feat(healthcheck): Improve redis healthcheck (#3422) by @hubertdeng123\n- fix: missing mime types and turning off autoindex for js-sdk endpoint (#3395) by @aldy505\n- fix: Use js.sentry-cdn.com for JS SDK downloads (#3417) by @BYK\n- fix(loader): provide js sdk assets from 4.x (#3415) by @aldy505\n- Revert \"Revert \"ref(feedback): remove issue platform flags after releasing issue types\"\" (#3403) by @BYK\n- Revert \"ref(feedback): remove issue platform flags after releasing issue types\" (#3402) by @BYK\n- ref(feedback): remove issue platform flags after releasing issue types (#3397) by @aliu39\n- fix(sentry-admin): Do not wait for command finish to display output (#3390) by @Makhonya\n\n## 24.10.0\n\n### Various fixes & improvements\n\n- chore: Disable codecov for master/release branches (#3384) by @hubertdeng123\n- chore: replace old URLs of the repo with the new docs (#3375) by @victorelec14\n- ref: span normalization allowed host config (#3245) by @aldy505\n- docs: explicitly specify `mail.use-{tls,ssl}` is mutually exclusive (#3368) by @aldy505\n- ref: allow hosted js sdk bundles (#3365) by @aldy505\n- fix(clickhouse): Allow nullable key (#3354) by @nikhars\n\n## 24.9.0\n\n### Various fixes & improvements\n\n- docs: link to develop docs (#3307) by @joshuarli\n- fix: more leeway for minimum RAM (#3290) by @joshuarli\n- Mandate minimum requirements for ram/cpu (#3275) by @hubertdeng123\n- ref(feedback): cleanup topic rollout option (#3276) by @aliu39\n- Update release template (#3270) by @hubertdeng123\n\n## 24.8.0\n\n### Various fixes & improvements\n\n- Migrate to zookeeper-less kafka  (#3263) by @hubertdeng123\n- Revert \"ref(feedback): cleanup topic rollout option\" (#3262) by @aliu39\n- ref(feedback): cleanup topic rollout option (#3256) by @aliu39\n- Remove cdc and wal2json and use the default postgres entrypoint (#3260) by @beezz\n- add `-euo pipefail` to enhance-image.example.sh (#3246) by @asottile-sentry\n- remove python-dev (#3242) by @asottile-sentry\n- feat: enable user feedback feature (#3193) by @aldy505\n- Use CDN by default for JS SDK Loader (#3213) by @stayallive\n\n## 24.7.1\n\n### Various fixes & improvements\n\n- Fix: errors only config flag (#3220) by @hubertdeng123\n- Add errors only self-hosted infrastructure (#3190) by @hubertdeng123\n- feat(generic-metrics): Add gauges to docker compose, re-try (#3177) by @ayirr7\n\n## 24.7.0\n\n### Various fixes & improvements\n\n- Check postgres os before proceeding with install (#3197) by @hubertdeng123\n- Update sentry-admin.sh to select its own working directory (#3184) by @theoriginalgri\n- feat: add insights feature flags (#3152) by @aldy505\n- feat(relay): Forward /api/0/relays/* to inner relays (#3144) by @iambriccardo\n\n## 24.6.0\n\n### Various fixes & improvements\n\n- Use general kafka topic creation in self-hosted (#3121) by @hubertdeng123\n- Use non-alpine postgres (#3116) by @hubertdeng123\n- Bump Python SDK version used in tests (#3108) by @sentrivana\n\n## 24.5.1\n\n### Various fixes & improvements\n\n- Update consumer flags (#3112) by @hubertdeng123\n- feat: Add crons task consumers  (#3106) by @wedamija\n- Update minimum docker compose requirement (#3078) by @JannKleen\n- Different approach to editing permissions of docker volumes (#3084) by @hubertdeng123\n- ref(spans): Add new feature flags needed (#3092) by @phacops\n- chore: Add comment explaining the one liner in clickhouse config (#3085) by @hubertdeng123\n- Fix install: use dynamic docker root dir instead of hardcoded one (#3064) by @boutetnico\n- Typo in config.example.yml (#3063) by @luchaninov\n\n## 24.5.0\n\n### Various fixes & improvements\n\n- fix: Make docker volume script respect compose project name (#3039) by @hubertdeng123\n- remove ref to skip writes (#3041) by @john-z-yang\n- Add clickhouse healthchecks to upgrade (#3024) by @hubertdeng123\n- Upgrade clickhouse to 23.8 (#3009) by @hubertdeng123\n- fix: use nginx realip module (#2977) by @oioki\n- Add upgrade test (#3012) by @hubertdeng123\n- Bump kafka and zookeeper versions (#2988) by @hubertdeng123\n\n## 24.4.2\n\n### Various fixes & improvements\n\n- Edit test file name (#3002) by @hubertdeng123\n- Revert \"Sampling: Run e2e tests every 5 minutes\" (#2999) by @hubertdeng123\n- Fix master test failures (#3000) by @hubertdeng123\n- Sampling: Run e2e tests every 5 minutes (#2994) by @hubertdeng123\n- Tweak e2e test github action (#2987) by @hubertdeng123\n- fix(performance): Add spans-first-ui flag to enable starfish/performance module views in ui (#2993) by @edwardgou-sentry\n- Bump docker compose version in CI (#2980) by @hubertdeng123\n- Upgrade postgres to 14.11 (#2975) by @mdtro\n- Add workstation configuration (#2968) by @azaslavsky\n\n## 24.4.1\n\n### Various fixes & improvements\n\n- chore(deps): bump memcached and redis to latest patch versions (#2973) by @mdtro\n- Use docker compose exec to create additional kafka topics (#2904) by @saz\n- Add example to docker compose version in problem report (#2959) by @edgariscoding\n- Port last integration tests to python (#2966) by @hubertdeng123\n\n## 24.4.0\n\n### Various fixes & improvements\n\n- Use python for e2e tests (#2953) by @hubertdeng123\n- feat: adds group attributes consumer (#2927) by @scefali\n- fix(spans): Adds organizations:standalone-span-ingestion flag to default config (#2936) by @edwardgou-sentry\n- Bump ubuntu version for tests (#2923) by @hubertdeng123\n- Write Customization tests in python (#2918) by @hubertdeng123\n- feat(clickhouse): Added max_suspicious_broken_parts to the config.xml (#2853) by @victorelec14\n- Port backup tests to python (#2907) by @hubertdeng123\n- Fix defunct java processes (#2914) by @hubertdeng123\n- Integration tests in python (#2892) by @hubertdeng123\n- feat: run outcomes-billing consumer (#2909) by @lynnagara\n- Remove duplicate feature flags (#2899) by @JannKleen\n\n## 24.3.0\n\n### Various fixes & improvements\n\n- feat(spans): Ingest spans (#2861) by @phacops\n- Integration test improvements (#2858) by @hubertdeng123\n- increase postgres max_connections above 100 connections (#2740) by @erfantkerfan\n- deps: bump maxmind/geoipupdate to 6.1.0 (#2859) by @victorelec14\n- Enable proxy buffering in nginx (#2844) by @RexTim\n- Add snuba rust consumers (#2831) by @hubertdeng123\n- simplify if for open-ai-suggestion (#2732) by @LvckyAPI\n- Upgrade to FSL-1.1 (#2835) by @chadwhitacre\n- chore: provide clearer csrf url example (#2833) by @aldy505\n- chore: Use django ORM to perform sql commands (#2827) by @hubertdeng123\n- revert changes in 3067683f6c0e1c6dd9ceb72cb5155c1dbf3bf501 (#2829) by @hubertdeng123\n- use rust consumers in self-hosted (3067683f) by @hubertdeng123\n\n## 24.2.0\n\n### Various fixes & improvements\n\n- Bump nginx version (#2797) by @hubertdeng123\n- build(deps): bump pre-commit/action from 3.0.0 to 3.0.1 (#2788) by @dependabot\n- Tweak postgres indexing fix (#2792) by @hubertdeng123\n- fix: DB migration script (#2779) by @hubertdeng123\n\n## 24.1.2\n\n### Various fixes & improvements\n\n- Check memcached backend in Django (#2778) by @chadwhitacre\n- Fix groupedmessage indexing error (#2777) by @hubertdeng123\n- build(deps): bump actions/setup-python from 4 to 5 (#2644) by @dependabot\n- feat: provide csrf settings information for sentry config (#2762) by @aldy505\n- Fix apt config generation when http_proxy is set (#2725) (#2734) by @lemrouch\n\n## 24.1.1\n\n### Various fixes & improvements\n\n- Revert \"Move open ai key from env variables\" (#2724) by @hubertdeng123\n- Fix cache error self hosted (#2722) by @hubertdeng123\n\n## 24.1.0\n\n### Various fixes & improvements\n\n- Enable crons (#2712) by @hubertdeng123\n- Parameterize backup restore script (#2412) by @hubertdeng123\n- Run tests only on getsentry repository (#2681) by @aminvakil\n- Tweak the template now that we can see it (#2670) by @chadwhitacre\n- Nginx client request body is buffered to a temporary file (#2630) by @zKoz210\n\n## 23.12.1\n\n### Various fixes & improvements\n\n- Make a release issue template (#2666) by @chadwhitacre\n\n## 23.12.0\n\n### Various fixes & improvements\n\n- test(backup): Use --no-prompt for backup tests (#2618) by @azaslavsky\n\n## 23.11.2\n\n- No documented changes.\n\n## 23.11.1\n\n### Various fixes & improvements\n\n- feat: Add sentry-admin.sh tool (#2594) by @azaslavsky\n- Patch for dev self-hosted environments (#2592) by @hubertdeng123\n- Relicense under FSL-1.0-Apache-2.0 (#2586) by @chadwhitacre\n- Bump minimum ram usage (#2585) by @hubertdeng123\n\n## 23.11.0\n\n### Various fixes & improvements\n\n- feat: provide a toggle to enable discord integration (#2548) by @aldy505\n- ref: fix a typo (#2556) by @asottile-sentry\n- ref: use `git branch --show-current` instead of sed (#2550) by @asottile-sentry\n- Remove sessions infra (#2514) by @hubertdeng123\n- Upgrade Clickhouse to 21.8 (#2536) by @hubertdeng123\n- [Snyk] Security upgrade debian from bullseye-slim to bookworm-20231009-slim (#2511) by @Indigi-managed\n- snuba: Remove deprecated CLI arg (#2515) by @lynnagara\n\n## 23.10.1\n\n### Various fixes & improvements\n\n- Revert \"feat: upgrade to zookeeper-less kafka (#2445)\" (#2500) by @hubertdeng123\n- Add fast revert GH workflow (#2499) by @hubertdeng123\n- build(deps): bump actions/checkout from 3 to 4 (#2493) by @dependabot\n- configure dependabot (#2491) by @mdtro\n- deps: bump nginx to 1.25.2 (#2490) by @mdtro\n- feat: upgrade to zookeeper-less kafka (#2445) by @joshuarli\n- Update outdated install option in README (#2440) by @hubertdeng123\n\n## 23.10.0\n\n### Various fixes & improvements\n\n- Switch geoipupdate image to ghcr.io (#2442) by @hkraal\n- Add system.url-prefix to config for visibility (#2426) by @hubertdeng123\n- Remove CSPMiddleware since it is enabled by default in the upstream sentry (#2434) by @oioki\n- Update nginx.conf (#2455) by @mwarkentin\n- Update Redis container image to 6.2.13 (#2432) by @mencarellic\n\n## 23.9.1\n\n### Various fixes & improvements\n\n- fix: e2e test jq bug (#2410) by @azaslavsky\n- feat(backup): Support new backup script (#2407) by @azaslavsky\n- Decrease frequency of e2e tests (#2383) by @hubertdeng123\n- Reduce logs coming from clickhouse (#2382) by @hubertdeng123\n- Increase frequency of e2e test runs (#2375) by @hubertdeng123\n- Remove nginx content-disposition hack for safari (#2381) by @hubertdeng123\n- Attempt to fix integration test flakiness (#2372) by @hubertdeng123\n- change health check for kafka service (#2371) by @johnatannvmd\n- Add metrics and generic metrics backend (#2355) by @hubertdeng123\n- Bump self-hosted e2e action commit sha (#2369) by @hubertdeng123\n\n## 23.8.0\n\n### Various fixes & improvements\n\n- Add issue platform infra (#2309) by @hubertdeng123\n\n## 23.7.2\n\n### Various fixes & improvements\n\n- Ignore fixture-custom-ca-roots service in integration test (#2321) by @hubertdeng123\n- Update GeoIpUpdate to v6.0.0 (#2287) by @victorelec14\n- Bump healthcheck timeout (#2300) by @hubertdeng123\n\n## 23.7.1\n\n### Various fixes & improvements\n\n- Resolve Safari Content-Disposition header bug (#2297) by @azaslavsky\n- feat: vroom cleanup script that respects default retention days (#2211) by @aldy505\n\n## 23.7.0\n\n### Various fixes & improvements\n\n- Remove nc -q option (#2275) by @hubertdeng123\n- Move open ai key from env variables (#2274) by @hubertdeng123\n- Fix command called in reset script (#2254) by @stayallive\n- Remove stale-bot in self-hosted (#2255) by @hubertdeng123\n- Update geoipupdate to 5.1.1 (#2236) by @williamdes\n\n## 23.6.2\n\n### Various fixes & improvements\n\n- Update nginx to 1.25.1 (#2235) by @williamdes\n- Fix error fingerprinting (#2237) by @chadwhitacre\n- A couple unit testing improvements (#2238) by @chadwhitacre\n- Fix #1684 (#2234) by @azaslavsky\n- Update memcached to 1.6.21 (#2231) by @williamdes\n- Update redis to 6.2.12 (#2230) by @williamdes\n- ref: Move all consumers to unified consumer CLI (#2224) by @hubertdeng123\n- Revert \"ref: Move most consumers to unified consumer CLI\" (#2223) by @hubertdeng123\n- ref: Move most consumers to unified consumer CLI (#2203) by @untitaker\n- Release 23.6.1 cleanup (#2209) by @hubertdeng123\n\n## 23.6.1\n\n### Various fixes & improvements\n\n- Fix bump version script (#2207) by @hubertdeng123\n\n## 23.6.0\n\n### Various fixes & improvements\n\n- Remove docker compose v1 (#2187) by @hubertdeng123\n- ref(compose): Separate ingest consumers (#2193) by @jan-auer\n- feat(profiling): Run profiling on self-hosted (#2154) by @phacops\n\n## 23.5.2\n\n- No documented changes.\n\n## 23.5.1\n\n### Various fixes & improvements\n\n- fix(suggested-fix): key should be 'key', not 'token' (#2146) by @aldy505\n\n## 23.5.0\n\n### Various fixes & improvements\n\n- Add no strict offset reset options to consumers (#2144) by @hubertdeng123\n- Add settings for enabling CSP to config file (#2134) by @hubertdeng123\n- feat: add suggested fix feature (#2115) by @aldy505\n- adding ulimits for zookeeper, kafka, and web (#2123) by @jamincollins\n- Uninstall Docker Compose v1 from CI so it's not used for tests (#2114) by @hubertdeng123\n- Fixed docker compose issue in backup/restore (#2110) by @montaniasystemab\n- Enable upstream keepalive (#2099) by @otbutz\n- Bump commit sha for e2e test action (#2104) by @hubertdeng123\n- Use docker compose exec to account for differences in container names for Postgres upgrade (#2096) by @hubertdeng123\n- Change symbolicator to use CalVer for release (#2091) by @hubertdeng123\n\n## 23.4.0\n\n### Postgres 14 Upgrade\n\nWe've now included an upgrade from Postgres 9.6 to 14.5 that will automatically be run via the `./install.sh` script.\n\nBy: @hubertdeng123 (#2074)\n\n### Various fixes & improvements\n\n- Remove clean function testing line (#2082) by @hubertdeng123\n- Fix command to get docker compose version in problem report template (#2080) by @hubertdeng123\n- Tweak permissioning of backup file in backup script to read/write for all users (#2043) by @hubertdeng123\n- Remove commit-batch-size parameter (#2058) by @hubertdeng123\n- Support external sourcemaps bigger, than 1Mb (#2050) by @le0pard\n- Add github setup instructions to config.example.yml (#2051) by @tm1000\n- ref(snuba): Use snuba self-hosted settings (#2039) by @enochtangg\n\n## 23.3.1\n\n### Various fixes & improvements\n\n- Bump Kafka version to keep up with SaaS (#2037) by @chadwhitacre\n- Add Backup/restore scripts (#2029) by @hubertdeng123\n- Add opt in error monitoring to reset and clean scripts (#2021) by @hubertdeng123\n\n## 23.3.0\n\n### Various fixes & improvements\n\n- Remove ZooKeeper snapshot (#2020) by @dereckson\n- feat(snuba): Add snuba sessions subscription service (#2006) by @klboke\n- Add backup/restore integration tests (#2012) by @hubertdeng123\n- ref(snuba): Remove snuba-cleanup, snuba-transactions-cleanup jobs (#2003) by @klboke\n- ref(replays): Remove the session-replay-ui flag (#2010) by @ryan953\n- Remove broken replay integration test (#2011) by @hubertdeng123\n- Bump self-hosted-e2e-tests action commit sha (#2008) by @hubertdeng123\n- Revert symbolicator tests (#2004) by @hubertdeng123\n- post-process-forwarder: Update CLI command (#1999) by @lynnagara\n- feat(replays): add replays to self hosted (#1990) by @JoshFerge\n- Remove issue status helper automation (#1989) by @hubertdeng123\n- Add proxy buffer size config to fix Bad Gateway (#1984) by @SCjona\n- Reference paths relative to project root (#1800) by @spawnia\n- Run close stale issues/PRs only on getsentry (#1969) by @aminvakil\n\n## 23.2.0\n\n### Various fixes & improvements\n\n- Run lock issues/PRs only on getsentry (#1966) by @aminvakil\n- Updates Redis to 6.2.10 (#1937) by @danielhartnell\n- Handle missing example files gracefully (#1950) by @chadwhitacre\n- Fix post-release.sh for `git pull` (#1938) by @BYK\n- Manually change 23.1.1 to nightly (#1936) by @hubertdeng123\n\n## 23.1.1\n\n### Various fixes & improvements\n\n- ci: Add test for symbolicator pipeline (#1916) by @ethanhs\n\n## 23.1.0\n\n### Various fixes & improvements\n\n- ci: Check health of services after running integration tests and fix snuba-replacer (#1897) by @ethanhs\n- Add wal2json debugging (#1906) by @chadwhitacre\n- Pick up CI bugfix (#1905) by @chadwhitacre\n- ref: Move jq build to error-handling.sh, and use proxy config (#1895) by @ethanhs\n- fix(CI): use default curl retry mechanism for wal2json install (#1890) by @volokluev\n- ref: Retry wal2json download in installer (#1881) by @ethanhs\n- ci: Remove GCB and update Github Action SHA (#1880) by @ethanhs\n\n## 22.12.0\n\n### Various fixes & improvements\n\n- Build each service image individually (#1858) by @ethanhs\n- Set higher kafka healthcheck timeout and fix clickhouse timeout (#1855) by @ethanhs\n- Add --skip-sse42-requirements to install.sh and enable SKIP_SSE42_REQUIREMENTS override (#1790) by @erinaceous\n- Fix commit-log-topic parameter configuration problem (#1817) by @klboke\n- Add .idea to .gitignore (#1803) by @spawnia\n- Add USE_X_FORWARDED_HOST to example config (#1804) by @crinjes\n- (fix): Fix contributor PR e2e tests (#1820) by @hubertdeng123\n\n## 22.11.0\n\n### Various fixes & improvements\n\n- Fix jq usage (#1814) by @ethanhs\n- Try adding end to end tests using new action (#1806) by @ethanhs\n- Add context line, error msg to envelope (#1784) by @hubertdeng123\n- Update to actions/checkoutv3 to address upcoming github deprecations (#1792) by @mattgauntseo-sentry\n- ref: upgrade actions/setup-python to avoid set-output deprecation (#1789) by @asottile-sentry\n- Enforce error reporting (#1777) by @hubertdeng123\n- Upload end of log as breadcrumbs, use exceptions and stacktrace (#1775) by @ethanhs\n- Fix sentry release for dogfood instance (#1768) by @hubertdeng123\n- Add pre-commit config (#1738) by @ethanhs\n- Do not send event on INT signal (#1773) by @hubertdeng123\n\n## 22.10.0\n\n### Various fixes & improvements\n\n- Split post process forwarders (#1759) by @chadwhitacre\n- Revert \"Enforce error reporting for self-hosted\" (#1755) by @hubertdeng123\n- Enforce error reporting for self-hosted (#1753) by @hubertdeng123\n- ref: Remove unused scripts and code (#1710) by @BYK\n- Check to see if docker compose exists, else error out (#1733) by @hubertdeng123\n- Fix minimum version requirements for docker and docker compose (#1732) by @hubertdeng123\n- Factor out clean and use it in unit-test (#1731) by @chadwhitacre\n- Reorganize unit test layout (#1729) by @hubertdeng123\n- Request event ID in issue template (#1723) by @ethanhs\n- Tag releases with sentry-cli (#1718) by @hubertdeng123\n- Send full logs as an attachment to our dogfood instance (#1715) by @hubertdeng123\n\n## 22.9.0\n\n### Various fixes & improvements\n\n- Fix traceback hash for error monitoring (#1700) by @hubertdeng123\n- Add section about error monitoring to the README (#1699) by @ethanhs\n- Switch from .reporterrors file to flag + envvar (#1697) by @chadwhitacre\n- Rename flag to --skip-user-creation (#1696) by @chadwhitacre\n- Default to not sending data to Sentry for now (#1695) by @chadwhitacre\n- fix(e2e tests): Pull branch that initially triggers gcp build for PRs (#1694) by @hubertdeng123\n- fix(e2e tests): Add .reporterrors file for GCP run of e2e tests (#1691) by @hubertdeng123\n- Error monitoring of the self-hosted installer (#1679) by @ethanhs\n- added docker commands in the description (#1673) by @victorelec14\n- Use docker-compose 2.7.0 instead of 2.2.3 in CI (#1591) by @aminvakil\n\n## 22.8.0\n\n- No documented changes.\n\n## 22.7.0\n\n### Various fixes & improvements\n\n- ref: use sort -V to check minimum versions (#1553) by @ethanhs\n- Get more data from users in issue templates (#1497) by @aminvakil\n- Add ARM support (#1538) by @chadwhitacre\n- do not use gosu for snuba-transactions-cleanup and snuba-cleanup (#1564) by @goganchic\n- ref: Replace regex with --short flag to get compose version (#1551) by @ethanhs\n- Improve installation through proxy (#1543) by @goganchic\n- Cleanup .env{,.custom} handling (#1539) by @chadwhitacre\n- Bump nginx:1.22.0-alpine (#1506) by @aminvakil\n- Run release a new version job only on getsentry (#1529) by @aminvakil\n\n## 22.6.0\n\n### Various fixes & improvements\n\n- fix \"services.web.healthcheck.retries must be a number\" (#1482) by @yuval1986\n- Add volume for nginx cache (#1511) by @glensc\n- snuba: New subscriptions infrastructure rollout (#1507) by @lynnagara\n- Ease modification of base image (#1479) by @spawnia\n\n## 22.5.0\n\n### Various fixes & improvements\n\n- ref: reset user to root for installation (#1469) by @asottile-sentry\n- Document From email display name (#1446) by @chadwhitacre\n- Bring in CLA Lite (#1439) by @chadwhitacre\n- fix: replace git.io links with redirect targets (#1430) by @asottile-sentry\n\n## 22.4.0\n\n### Various fixes & improvements\n\n- Use better API key when available (#1408) by @chadwhitacre\n- Use a custom action (#1407) by @chadwhitacre\n- Add some debug logging (#1340) by @chadwhitacre\n- meta(gha): Deploy workflow enforce-license-compliance.yml (#1388) by @chadwhitacre\n- Turn off containers under old name as well (#1384) by @chadwhitacre\n\n## 22.3.0\n\n### Various fixes & improvements\n\n- Run CI every night (#1334) by @aminvakil\n- Docker-Compose: Avoid setting hostname to '' (#1365) by @glensc\n- meta(gha): Deploy workflow enforce-license-compliance.yml (#1375) by @chadwhitacre\n- ci: Change stale GitHub workflow to run once a day (#1371) by @kamilogorek\n- ci: Temporary fix for interactive prompt on createuser (#1370) by @BYK\n- meta(gha): Deploy workflow enforce-license-compliance.yml (#1347) by @chadwhitacre\n- Add SaaS nudge to README (#1327) by @chadwhitacre\n\n## 22.2.0\n\n### Various fixes & improvements\n\n- fix: unbound variable _group in reset/dc-detect-version script (#1283) (#1284) by @lovetodream\n- Remove routing helper (#1323) by @chadwhitacre\n- Bump nginx:1.21.6-alpine (#1319) by @aminvakil\n- Add a cloudbuild.yaml for GCB (#1315) by @chadwhitacre\n- Update set-up-and-migrate-database.sh (#1308) by @drmrbrewer\n- Pull relay explicitly to avoid garbage in creds (#1301) by @chadwhitacre\n- Improve logging of docker versions and relay creds (#1298) by @chadwhitacre\n- Remove file again (#1299) by @chadwhitacre\n- Clean up relay credentials generation (#1289) by @chadwhitacre\n- Add CI compose version 1.29.2 / 2.0.1 / 2.2.3 (#1290) by @chadwhitacre\n- Revert \"Add CI compose version 1.29.2 / 2.0.1 / 2.2.3 (#1251)\" (#1272) by @chadwhitacre\n- Add CI compose version 1.29.2 / 2.0.1 / 2.2.3 (#1251) by @aminvakil\n\n## 22.1.0\n\n### Various fixes & improvements\n\n- Make healthcheck variables configurable in .env (#1248) by @aminvakil\n- Take some actions to avoid unhealthy containers (#1241) by @chadwhitacre\n- Install: setup umask (#1222) by @glensc\n- Deprecated /docker-entrypoint.sh call (#1218) by @marcinroman\n- Bump nginx:1.21.5-alpine (#1230) by @aminvakil\n- Fix reset.sh docker-compose call (#1215) by @aminvakil\n- Set worker_processes to auto (#1207) by @aminvakil\n\n## 21.12.0\n\n### Support Docker Compose v2 (ongoing)\n\nSelf-hosted Sentry mostly works with Docker Compose v2 (in addition to v1 >= 1.28.0). There is [one more bug](https://github.com/getsentry/self-hosted/issues/1133) we are trying to squash.\n\nBy: @chadwhitacre (#1179)\n\n### Prevent Component Drift\n\nWhen a user runs the `install.sh` script, they get the latest version of the Sentry, Snuba, Relay and Symbolicator projects. However there is no guarantee they have pulled the latest `self-hosted` version first, and running an old one may cause problems. To mitigate this, we now perform a check during installation that the user is on the latest commit if they are on the `master` branch. You can disable this check with `--skip-commit-check`.\n\nBy: @chadwhitacre (#1191), @aminvakil (#1186)\n\n### React to log4shell\n\nSelf-hosted Sentry is [not vulnerable](https://github.com/getsentry/self-hosted/issues/1196) to the [log4shell](https://log4shell.com/) vulnerability.\n\nBy: @chadwhitacre (#1203)\n\n### Forum → Issues\n\nIn the interest of reducing sources of truth, providing better support, and restarting the fire of the self-hosted Sentry community, we [deprecated the Discourse forum in favor of GitHub Issues](https://github.com/getsentry/self-hosted/issues/1151).\n\nBy: @chadwhitacre (#1167, #1160, #1159)\n\n### Rename onpremise to self-hosted (ongoing)\n\nIn the beginning we used the term \"on-premise\" and over time we introduced the term \"self-hosted.\" In an effort to regain some consistency for both branding and developer mental overhead purposes, we are standardizing on the term \"self-hosted.\" This release includes a fair portion of the work towards this across multiple repos, hopefully a future release will include the remainder. Some orphaned containers / volumes / networks are [expected](https://github.com/getsentry/self-hosted/pull/1169&#35;discussion_r756401917). You may clean them up with `docker-compose down --remove-orphans`.\n\nBy: @chadwhitacre (#1169)\n\n### Add support for custom DotEnv file\n\nThere are several ways to [configure self-hosted Sentry](https://develop.sentry.dev/self-hosted/&#35;configuration) and one of them is the `.env` file. In this release we add support for a `.env.custom` file that is git-ignored to make it easier for you to override keys configured this way with custom values. Thanks to @Sebi94nbg for the contribution!\n\nBy: @Sebi94nbg (#1113)\n\n### Various fixes & improvements\n\n- Revert \"Rename onpremise to self-hosted\" (5495fe2e) by @chadwhitacre\n- Rename onpremise to self-hosted (9ad05d87) by @chadwhitacre\n\n## 21.11.0\n\n### Various fixes & improvements\n\n- Fix #1079 - bug in reset.sh (#1134) by @chadwhitacre\n- ci: Enable parallel tests again, increase timeouts (#1125) by @BYK\n- fix: Hide compose errors during version check (#1124) by @BYK\n- build: Omit nightly bump commit from changelog (#1120) by @BYK\n- build: Set master version to nightly (d3e77857)\n\n## 21.10.0\n\n### Support for Docker Compose v2 (ongoing)\n\nYou asked for it and you did it! Sentry self-hosted now can work with Docker Compose v2 thanks to our community's contributions.\n\nPRs: #1116\n\n### Various fixes & improvements\n\n- docs: simplify Linux `sudo` instructions in README (#1096)\n- build: Set master version to nightly (58874cf9)\n\n## 21.9.0\n\n- fix(healthcheck): Increase retries to 5 (#1072)\n- fix(requirements): Make compose version check bw-compatible (#1068)\n- ci: Test with the required minimum docker-compose (#1066)\n  Run tests using docker-compose `1.28.0` instead of latest\n- fix(clickhouse): Use correct HTTP port for healthcheck (#1069)\n  Fixes the regular `Unexpected packet` errors in Clickhouse\n\n## 21.8.0\n\n- feat: Support custom CA roots ([#27062](https://github.com/getsentry/sentry/pull/27062)), see the [docs](https://develop.sentry.dev/self-hosted/custom-ca-roots/) for more details.\n- fix: Fix `curl` image to version 7.77.0\n- upgrade: docker-compose version to 1.29.2\n- feat: Leverage health checks for depends_on\n\n## 21.7.0\n\n- No documented changes.\n\n## 21.6.3\n\n- No documented changes.\n\n## 21.6.2\n\n- BREAKING CHANGE: The frontend bundle will be loaded asynchronously (via [#25744](https://github.com/getsentry/sentry/pull/25744)). This is a breaking change that can affect custom plugins that access certain globals in the django template. Please see https://forum.sentry.io/t/breaking-frontend-changes-for-custom-plugins/14184 for more information.\n\n## 21.6.1\n\n- No documented changes.\n\n## 21.6.0\n\n- feat: Add healthchecks for redis, memcached and postgres (#975)\n"
        },
        {
          "name": "CONTRIBUTING.md",
          "type": "blob",
          "size": 0.271484375,
          "content": "## Testing\n\n### Running Tests with Pytest\n\nWe use pytest for running tests. To run the tests:\n\n1) Ensure that you are in the root directory of the project.\n2) Run the following command:\n```bash\npytest\n```\n\nThis will automatically discover and run all test cases in the project.\n"
        },
        {
          "name": "LICENSE.md",
          "type": "blob",
          "size": 3.6962890625,
          "content": "# Functional Source License, Version 1.1, Apache 2.0 Future License\n\n## Abbreviation\n\nFSL-1.1-Apache-2.0\n\n## Notice\n\nCopyright 2016-2024 Functional Software, Inc. dba Sentry\n\n## Terms and Conditions\n\n### Licensor (\"We\")\n\nThe party offering the Software under these Terms and Conditions.\n\n### The Software\n\nThe \"Software\" is each version of the software that we make available under\nthese Terms and Conditions, as indicated by our inclusion of these Terms and\nConditions with the Software.\n\n### License Grant\n\nSubject to your compliance with this License Grant and the Patents,\nRedistribution and Trademark clauses below, we hereby grant you the right to\nuse, copy, modify, create derivative works, publicly perform, publicly display\nand redistribute the Software for any Permitted Purpose identified below.\n\n### Permitted Purpose\n\nA Permitted Purpose is any purpose other than a Competing Use. A Competing Use\nmeans making the Software available to others in a commercial product or\nservice that:\n\n1. substitutes for the Software;\n\n2. substitutes for any other product or service we offer using the Software\n   that exists as of the date we make the Software available; or\n\n3. offers the same or substantially similar functionality as the Software.\n\nPermitted Purposes specifically include using the Software:\n\n1. for your internal use and access;\n\n2. for non-commercial education;\n\n3. for non-commercial research; and\n\n4. in connection with professional services that you provide to a licensee\n   using the Software in accordance with these Terms and Conditions.\n\n### Patents\n\nTo the extent your use for a Permitted Purpose would necessarily infringe our\npatents, the license grant above includes a license under our patents. If you\nmake a claim against any party that the Software infringes or contributes to\nthe infringement of any patent, then your patent license to the Software ends\nimmediately.\n\n### Redistribution\n\nThe Terms and Conditions apply to all copies, modifications and derivatives of\nthe Software.\n\nIf you redistribute any copies, modifications or derivatives of the Software,\nyou must include a copy of or a link to these Terms and Conditions and not\nremove any copyright notices provided in or with the Software.\n\n### Disclaimer\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND WITHOUT WARRANTIES OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING WITHOUT LIMITATION WARRANTIES OF FITNESS FOR A PARTICULAR\nPURPOSE, MERCHANTABILITY, TITLE OR NON-INFRINGEMENT.\n\nIN NO EVENT WILL WE HAVE ANY LIABILITY TO YOU ARISING OUT OF OR RELATED TO THE\nSOFTWARE, INCLUDING INDIRECT, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES,\nEVEN IF WE HAVE BEEN INFORMED OF THEIR POSSIBILITY IN ADVANCE.\n\n### Trademarks\n\nExcept for displaying the License Details and identifying us as the origin of\nthe Software, you have no right under these Terms and Conditions to use our\ntrademarks, trade names, service marks or product names.\n\n## Grant of Future License\n\nWe hereby irrevocably grant you an additional license to use the Software under\nthe Apache License, Version 2.0 that is effective on the second anniversary of\nthe date we make the Software available. On or after that date, you may use the\nSoftware under the Apache License, Version 2.0, in which case the following\nwill apply:\n\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License.\n\nYou may obtain a copy of the License at\n\nhttp://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed\nunder the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\nCONDITIONS OF ANY KIND, either express or implied. See the License for the\nspecific language governing permissions and limitations under the License.\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 0.1943359375,
          "content": "# Self-Hosted Sentry\n\n[Sentry](https://sentry.io/), feature-complete and packaged up for low-volume deployments and proofs-of-concept.\n\nDocumentation [here](https://develop.sentry.dev/self-hosted/).\n"
        },
        {
          "name": "_integration-test",
          "type": "tree",
          "content": null
        },
        {
          "name": "_unit-test",
          "type": "tree",
          "content": null
        },
        {
          "name": "action.yaml",
          "type": "blob",
          "size": 6.0419921875,
          "content": "name: \"Sentry self-hosted end-to-end tests\"\ninputs:\n  project_name:\n    required: false\n    description: \"e.g. snuba, sentry, relay, self-hosted\"\n  image_url:\n    required: false\n    description: \"The URL to the built relay, snuba, sentry image to test against.\"\n  CODECOV_TOKEN:\n    required: false\n    description: \"The Codecov token to upload coverage.\"\n\nruns:\n  using: \"composite\"\n  steps:\n    - name: Configure to use the test image\n      if: inputs.project_name && inputs.image_url\n      shell: bash\n      run: |\n        image_var=$(echo ${{ inputs.project_name }}_IMAGE | tr '[:lower:]' '[:upper:]')\n        echo \"${image_var}=${{ inputs.image_url }}\" >> ${{ github.action_path }}/.env\n\n    - name: Setup dev environment\n      shell: bash\n      run: |\n        cd ${{ github.action_path }}\n        pip install -r requirements-dev.txt\n        echo \"PY_COLORS=1\" >> \"$GITHUB_ENV\"\n        ### pytest-sentry configuration ###\n        if [ \"$GITHUB_REPOSITORY\" = \"getsentry/self-hosted\" ]; then\n          echo \"PYTEST_SENTRY_DSN=$SELF_HOSTED_TESTING_DSN\" >> $GITHUB_ENV\n          echo \"PYTEST_SENTRY_TRACES_SAMPLE_RATE=0\" >> $GITHUB_ENV\n\n          # This records failures on master to sentry in order to detect flakey tests, as it's\n          # expected that people have failing tests on their PRs\n          if [ \"$GITHUB_REF\" = \"refs/heads/master\" ]; then\n            echo \"PYTEST_SENTRY_ALWAYS_REPORT=1\" >> $GITHUB_ENV\n          fi\n        fi\n\n    - name: Get Compose\n      env:\n        COMPOSE_PATH: /usr/local/lib/docker/cli-plugins\n        COMPOSE_VERSION: \"v2.26.0\"\n      shell: bash\n      run: |\n        # Always remove `docker compose` support as that's the newer version\n        # and comes installed by default nowadays.\n        sudo rm -f \"/usr/local/lib/docker/cli-plugins/docker-compose\"\n        # Docker Compose v1 is installed here, remove it\n        sudo rm -f \"/usr/local/bin/docker-compose\"\n        sudo rm -f \"${{ env.COMPOSE_PATH }}/docker-compose\"\n        sudo mkdir -p \"${{ env.COMPOSE_PATH }}\"\n        sudo curl -L https://github.com/docker/compose/releases/download/${{ env.COMPOSE_VERSION }}/docker-compose-`uname -s`-`uname -m` -o \"${{ env.COMPOSE_PATH }}/docker-compose\"\n        sudo chmod +x \"${{ env.COMPOSE_PATH }}/docker-compose\"\n\n    - name: Prepare Docker Volume Caching\n      id: cache_key\n      shell: bash\n      run: |\n        # Set permissions for docker volumes so we can cache and restore\n        sudo chmod o+x /var/lib/docker\n        sudo chmod -R o+rwx /var/lib/docker/volumes\n        source ${{ github.action_path }}/.env\n        SENTRY_IMAGE_SHA=$(docker buildx imagetools inspect $SENTRY_IMAGE --format \"{{println .Manifest.Digest}}\")\n        echo \"SENTRY_IMAGE_SHA=$SENTRY_IMAGE_SHA\" >> $GITHUB_OUTPUT\n        SNUBA_IMAGE_SHA=$(docker buildx imagetools inspect $SNUBA_IMAGE --format \"{{println .Manifest.Digest}}\")\n        echo \"SNUBA_IMAGE_SHA=$SNUBA_IMAGE_SHA\" >> $GITHUB_OUTPUT\n\n    - name: Restore DB Volumes Cache\n      id: restore_cache\n      uses: actions/cache/restore@v4\n      with:\n        key: db-volumes-v4-${{ steps.cache_key.outputs.SENTRY_IMAGE_SHA }}-${{ steps.cache_key.outputs.SNUBA_IMAGE_SHA }}\n        restore-keys: |\n          db-volumes-v4-${{ steps.cache_key.outputs.SENTRY_IMAGE_SHA }}\n          db-volumes-v4-\n        path: |\n          /var/lib/docker/volumes/sentry-postgres/_data\n          /var/lib/docker/volumes/sentry-clickhouse/_data\n          /var/lib/docker/volumes/sentry-kafka/_data\n\n    - name: Install self-hosted\n      env:\n        SKIP_DB_MIGRATIONS: ${{ steps.restore_cache.outputs.cache-hit == 'true' && '1' || '' }}\n      shell: bash\n      run: |\n        cd ${{ github.action_path }}\n        # This is for the cache restore on Kafka to work in older releases\n        docker run --rm -v \"sentry-kafka:/data\" busybox chown -R 1000:1000 /data\n        # Add some customizations to test that path\n        cat <<EOT >> sentry/enhance-image.sh\n        #!/bin/bash\n        touch /created-by-enhance-image\n        apt-get update\n        apt-get install -y gcc libsasl2-dev python-dev-is-python3 libldap2-dev libssl-dev\n        EOT\n        chmod 755 sentry/enhance-image.sh\n        echo \"python-ldap\" > sentry/requirements.txt\n\n        ./install.sh --no-report-self-hosted-issues --skip-commit-check\n\n    - name: Prepare Docker Volume Caching\n      shell: bash\n      run: |\n        # Set permissions for docker volumes so we can cache and restore\n        # We need these for the backup/restore test snapshotting too\n        sudo chmod o+x /var/lib/docker\n        sudo chmod -R o+rx /var/lib/docker/volumes\n        # Set tar ownership for it to be able to read\n        # From: https://github.com/actions/toolkit/issues/946#issuecomment-1726311681\n        sudo chown root /usr/bin/tar && sudo chmod u+s /usr/bin/tar\n        sudo chown root /usr/bin/rsync && sudo chmod u+s /usr/bin/rsync\n\n    - name: Save DB Volumes Cache\n      if: steps.restore_cache.outputs.cache-hit != 'true'\n      uses: actions/cache/save@v4\n      with:\n        key: ${{ steps.restore_cache.outputs.cache-primary-key }}\n        path: |\n          /var/lib/docker/volumes/sentry-postgres/_data\n          /var/lib/docker/volumes/sentry-clickhouse/_data\n          /var/lib/docker/volumes/sentry-kafka/_data\n\n    - name: Integration Test\n      shell: bash\n      run: |\n        rsync -aW --no-compress --mkpath \\\n          /var/lib/docker/volumes/sentry-postgres \\\n          /var/lib/docker/volumes/sentry-clickhouse \\\n          /var/lib/docker/volumes/sentry-kafka \\\n          \"$RUNNER_TEMP/volumes/\"\n        cd ${{ github.action_path }}\n        docker compose up --wait\n        TEST_CUSTOMIZATIONS=enabled pytest -x --cov --junitxml=junit.xml _integration-test/\n\n    - name: Upload coverage to Codecov\n      uses: codecov/codecov-action@v5\n      if: inputs.CODECOV_TOKEN\n      with:\n        directory: ${{ github.action_path }}\n        token: ${{ inputs.CODECOV_TOKEN }}\n        slug: getsentry/self-hosted\n\n    - name: Upload test results to Codecov\n      if: inputs.CODECOV_TOKEN && !cancelled()\n      uses: codecov/test-results-action@v1\n      with:\n        directory: ${{ github.action_path }}\n        token: ${{ inputs.CODECOV_TOKEN }}\n"
        },
        {
          "name": "certificates",
          "type": "tree",
          "content": null
        },
        {
          "name": "clickhouse",
          "type": "tree",
          "content": null
        },
        {
          "name": "codecov.yml",
          "type": "blob",
          "size": 0.12109375,
          "content": "coverage:\n  status:\n    project:\n      default:\n        only_pulls: true\n    patch:\n      default:\n        only_pulls: true\n"
        },
        {
          "name": "cron",
          "type": "tree",
          "content": null
        },
        {
          "name": "docker-compose.yml",
          "type": "blob",
          "size": 20.630859375,
          "content": "x-restart-policy: &restart_policy\n  restart: unless-stopped\nx-depends_on-healthy: &depends_on-healthy\n  condition: service_healthy\nx-depends_on-default: &depends_on-default\n  condition: service_started\nx-healthcheck-defaults: &healthcheck_defaults\n  # Avoid setting the interval too small, as docker uses much more CPU than one would expect.\n  # Related issues:\n  # https://github.com/moby/moby/issues/39102\n  # https://github.com/moby/moby/issues/39388\n  # https://github.com/getsentry/self-hosted/issues/1000\n  interval: \"$HEALTHCHECK_INTERVAL\"\n  timeout: \"$HEALTHCHECK_TIMEOUT\"\n  retries: $HEALTHCHECK_RETRIES\n  start_period: 10s\nx-sentry-defaults: &sentry_defaults\n  <<: *restart_policy\n  image: sentry-self-hosted-local\n  # Set the platform to build for linux/arm64 when needed on Apple silicon Macs.\n  platform: ${DOCKER_PLATFORM:-}\n  build:\n    context: ./sentry\n    args:\n      - SENTRY_IMAGE\n  depends_on:\n    redis:\n      <<: *depends_on-healthy\n    kafka:\n      <<: *depends_on-healthy\n    postgres:\n      <<: *depends_on-healthy\n    memcached:\n      <<: *depends_on-default\n    smtp:\n      <<: *depends_on-default\n    snuba-api:\n      <<: *depends_on-default\n    symbolicator:\n      <<: *depends_on-default\n  entrypoint: \"/etc/sentry/entrypoint.sh\"\n  command: [\"run\", \"web\"]\n  environment:\n    PYTHONUSERBASE: \"/data/custom-packages\"\n    SENTRY_CONF: \"/etc/sentry\"\n    SNUBA: \"http://snuba-api:1218\"\n    VROOM: \"http://vroom:8085\"\n    # Force everything to use the system CA bundle\n    # This is mostly needed to support installing custom CA certs\n    # This one is used by botocore\n    DEFAULT_CA_BUNDLE: &ca_bundle \"/etc/ssl/certs/ca-certificates.crt\"\n    # This one is used by requests\n    REQUESTS_CA_BUNDLE: *ca_bundle\n    # This one is used by grpc/google modules\n    GRPC_DEFAULT_SSL_ROOTS_FILE_PATH_ENV_VAR: *ca_bundle\n    # Leaving the value empty to just pass whatever is set\n    # on the host system (or in the .env file)\n    COMPOSE_PROFILES:\n    SENTRY_EVENT_RETENTION_DAYS:\n    SENTRY_MAIL_HOST:\n    SENTRY_MAX_EXTERNAL_SOURCEMAP_SIZE:\n  volumes:\n    - \"sentry-data:/data\"\n    - \"./sentry:/etc/sentry\"\n    - \"./geoip:/geoip:ro\"\n    - \"./certificates:/usr/local/share/ca-certificates:ro\"\nx-snuba-defaults: &snuba_defaults\n  <<: *restart_policy\n  depends_on:\n    clickhouse:\n      <<: *depends_on-healthy\n    kafka:\n      <<: *depends_on-healthy\n    redis:\n      <<: *depends_on-healthy\n  image: \"$SNUBA_IMAGE\"\n  environment:\n    SNUBA_SETTINGS: self_hosted\n    CLICKHOUSE_HOST: clickhouse\n    DEFAULT_BROKERS: \"kafka:9092\"\n    REDIS_HOST: redis\n    UWSGI_MAX_REQUESTS: \"10000\"\n    UWSGI_DISABLE_LOGGING: \"true\"\n    # Leaving the value empty to just pass whatever is set\n    # on the host system (or in the .env file)\n    SENTRY_EVENT_RETENTION_DAYS:\nservices:\n  smtp:\n    <<: *restart_policy\n    platform: linux/amd64\n    image: tianon/exim4\n    hostname: \"${SENTRY_MAIL_HOST:-}\"\n    volumes:\n      - \"sentry-smtp:/var/spool/exim4\"\n      - \"sentry-smtp-log:/var/log/exim4\"\n  memcached:\n    <<: *restart_policy\n    image: \"memcached:1.6.26-alpine\"\n    command: [\"-I\", \"${SENTRY_MAX_EXTERNAL_SOURCEMAP_SIZE:-1M}\"]\n    healthcheck:\n      <<: *healthcheck_defaults\n      # From: https://stackoverflow.com/a/31877626/5155484\n      test: echo stats | nc 127.0.0.1 11211\n  redis:\n    <<: *restart_policy\n    image: \"redis:6.2.14-alpine\"\n    healthcheck:\n      <<: *healthcheck_defaults\n      test: redis-cli ping | grep PONG\n    volumes:\n      - \"sentry-redis:/data\"\n      - type: bind\n        read_only: true\n        source: ./redis.conf\n        target: /usr/local/etc/redis/redis.conf\n    ulimits:\n      nofile:\n        soft: 10032\n        hard: 10032\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n  postgres:\n    <<: *restart_policy\n    # Using the same postgres version as Sentry dev for consistency purposes\n    image: \"postgres:14.11\"\n    healthcheck:\n      <<: *healthcheck_defaults\n      # Using default user \"postgres\" from sentry/sentry.conf.example.py or value of POSTGRES_USER if provided\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER:-postgres}\"]\n    command:\n      [\n        \"postgres\",\n        \"-c\",\n        \"max_connections=${POSTGRES_MAX_CONNECTIONS:-100}\",\n      ]\n    environment:\n      POSTGRES_HOST_AUTH_METHOD: \"trust\"\n    volumes:\n      - \"sentry-postgres:/var/lib/postgresql/data\"\n  kafka:\n    <<: *restart_policy\n    image: \"confluentinc/cp-kafka:7.6.1\"\n    environment:\n      # https://docs.confluent.io/platform/current/installation/docker/config-reference.html#cp-kakfa-example\n      KAFKA_PROCESS_ROLES: \"broker,controller\"\n      KAFKA_CONTROLLER_QUORUM_VOTERS: \"1001@127.0.0.1:29093\"\n      KAFKA_CONTROLLER_LISTENER_NAMES: \"CONTROLLER\"\n      KAFKA_NODE_ID: \"1001\"\n      CLUSTER_ID: \"MkU3OEVBNTcwNTJENDM2Qk\"\n      KAFKA_LISTENERS: \"PLAINTEXT://0.0.0.0:29092,INTERNAL://0.0.0.0:9093,EXTERNAL://0.0.0.0:9092,CONTROLLER://0.0.0.0:29093\"\n      KAFKA_ADVERTISED_LISTENERS: \"PLAINTEXT://127.0.0.1:29092,INTERNAL://kafka:9093,EXTERNAL://kafka:9092\"\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: \"PLAINTEXT:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT,CONTROLLER:PLAINTEXT\"\n      KAFKA_INTER_BROKER_LISTENER_NAME: \"PLAINTEXT\"\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: \"1\"\n      KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS: \"1\"\n      KAFKA_LOG_RETENTION_HOURS: \"24\"\n      KAFKA_MESSAGE_MAX_BYTES: \"50000000\" #50MB or bust\n      KAFKA_MAX_REQUEST_SIZE: \"50000000\" #50MB on requests apparently too\n      CONFLUENT_SUPPORT_METRICS_ENABLE: \"false\"\n      KAFKA_LOG4J_LOGGERS: \"kafka.cluster=WARN,kafka.controller=WARN,kafka.coordinator=WARN,kafka.log=WARN,kafka.server=WARN,state.change.logger=WARN\"\n      KAFKA_LOG4J_ROOT_LOGLEVEL: \"WARN\"\n      KAFKA_TOOLS_LOG4J_LOGLEVEL: \"WARN\"\n    ulimits:\n      nofile:\n        soft: 4096\n        hard: 4096\n    volumes:\n      - \"sentry-kafka:/var/lib/kafka/data\"\n      - \"sentry-kafka-log:/var/lib/kafka/log\"\n      - \"sentry-secrets:/etc/kafka/secrets\"\n    healthcheck:\n      <<: *healthcheck_defaults\n      test: [\"CMD-SHELL\", \"nc -z localhost 9092\"]\n      interval: 10s\n      timeout: 10s\n      retries: 30\n  clickhouse:\n    <<: *restart_policy\n    image: clickhouse-self-hosted-local\n    build:\n      context: ./clickhouse\n      args:\n        BASE_IMAGE: \"altinity/clickhouse-server:23.8.11.29.altinitystable\"\n    ulimits:\n      nofile:\n        soft: 262144\n        hard: 262144\n    volumes:\n      - \"sentry-clickhouse:/var/lib/clickhouse\"\n      - \"sentry-clickhouse-log:/var/log/clickhouse-server\"\n      - type: bind\n        read_only: true\n        source: ./clickhouse/config.xml\n        target: /etc/clickhouse-server/config.d/sentry.xml\n    environment:\n      # This limits Clickhouse's memory to 30% of the host memory\n      # If you have high volume and your search return incomplete results\n      # You might want to change this to a higher value (and ensure your host has enough memory)\n      MAX_MEMORY_USAGE_RATIO: 0.3\n    healthcheck:\n      test: [\n          \"CMD-SHELL\",\n          # Manually override any http_proxy envvar that might be set, because\n          # this wget does not support no_proxy. See:\n          # https://github.com/getsentry/self-hosted/issues/1537\n          \"http_proxy='' wget -nv -t1 --spider 'http://localhost:8123/' || exit 1\",\n        ]\n      interval: 10s\n      timeout: 10s\n      retries: 30\n  snuba-api:\n    <<: *snuba_defaults\n  # Kafka consumer responsible for feeding events into Clickhouse\n  snuba-errors-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage errors --consumer-group snuba-consumers --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n  # Kafka consumer responsible for feeding outcomes into Clickhouse\n  # Use --auto-offset-reset=earliest to recover up to 7 days of TSDB data\n  # since we did not do a proper migration\n  snuba-outcomes-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage outcomes_raw --consumer-group snuba-consumers --auto-offset-reset=earliest --max-batch-time-ms 750 --no-strict-offset-reset\n  snuba-outcomes-billing-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage outcomes_raw --consumer-group snuba-consumers --auto-offset-reset=earliest --max-batch-time-ms 750 --no-strict-offset-reset --raw-events-topic outcomes-billing\n  snuba-group-attributes-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage group_attributes --consumer-group snuba-group-attributes-consumers --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n  snuba-replacer:\n    <<: *snuba_defaults\n    command: replacer --storage errors --auto-offset-reset=latest --no-strict-offset-reset\n  snuba-subscription-consumer-events:\n    <<: *snuba_defaults\n    command: subscriptions-scheduler-executor --dataset events --entity events --auto-offset-reset=latest --no-strict-offset-reset --consumer-group=snuba-events-subscriptions-consumers --followed-consumer-group=snuba-consumers --schedule-ttl=60 --stale-threshold-seconds=900\n  #############################################\n  ## Feature Complete Sentry Snuba Consumers ##\n  #############################################\n  # Kafka consumer responsible for feeding transactions data into Clickhouse\n  snuba-transactions-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage transactions --consumer-group transactions_group --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-replays-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage replays --consumer-group snuba-consumers --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-issue-occurrence-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage search_issues --consumer-group generic_events_group --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-metrics-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage metrics_raw --consumer-group snuba-metrics-consumers --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-subscription-consumer-transactions:\n    <<: *snuba_defaults\n    command: subscriptions-scheduler-executor --dataset transactions --entity transactions --auto-offset-reset=latest --no-strict-offset-reset --consumer-group=snuba-transactions-subscriptions-consumers --followed-consumer-group=transactions_group --schedule-ttl=60 --stale-threshold-seconds=900\n    profiles:\n      - feature-complete\n  snuba-subscription-consumer-metrics:\n    <<: *snuba_defaults\n    command: subscriptions-scheduler-executor --dataset metrics --entity metrics_sets --entity metrics_counters --auto-offset-reset=latest --no-strict-offset-reset --consumer-group=snuba-metrics-subscriptions-consumers --followed-consumer-group=snuba-metrics-consumers --schedule-ttl=60 --stale-threshold-seconds=900\n    profiles:\n      - feature-complete\n  snuba-generic-metrics-distributions-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage generic_metrics_distributions_raw --consumer-group snuba-gen-metrics-distributions-consumers --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-generic-metrics-sets-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage generic_metrics_sets_raw --consumer-group snuba-gen-metrics-sets-consumers --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-generic-metrics-counters-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage generic_metrics_counters_raw --consumer-group snuba-gen-metrics-counters-consumers --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-generic-metrics-gauges-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage generic_metrics_gauges_raw --consumer-group snuba-gen-metrics-gauges-consumers --auto-offset-reset=latest --max-batch-time-ms 750 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-profiling-profiles-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage profiles --consumer-group snuba-consumers --auto-offset-reset=latest --max-batch-time-ms 1000 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-profiling-functions-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage functions_raw --consumer-group snuba-consumers --auto-offset-reset=latest --max-batch-time-ms 1000 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  snuba-spans-consumer:\n    <<: *snuba_defaults\n    command: rust-consumer --storage spans --consumer-group snuba-spans-consumers --auto-offset-reset=latest --max-batch-time-ms 1000 --no-strict-offset-reset\n    profiles:\n      - feature-complete\n  symbolicator:\n    <<: *restart_policy\n    image: \"$SYMBOLICATOR_IMAGE\"\n    volumes:\n      - \"sentry-symbolicator:/data\"\n      - type: bind\n        read_only: true\n        source: ./symbolicator\n        target: /etc/symbolicator\n    command: run -c /etc/symbolicator/config.yml\n  symbolicator-cleanup:\n    <<: *restart_policy\n    image: symbolicator-cleanup-self-hosted-local\n    build:\n      context: ./cron\n      args:\n        BASE_IMAGE: \"$SYMBOLICATOR_IMAGE\"\n    command: '\"55 23 * * * gosu symbolicator symbolicator cleanup\"'\n    volumes:\n      - \"sentry-symbolicator:/data\"\n  web:\n    <<: *sentry_defaults\n    ulimits:\n      nofile:\n        soft: 4096\n        hard: 4096\n    healthcheck:\n      <<: *healthcheck_defaults\n      test:\n        - \"CMD\"\n        - \"/bin/bash\"\n        - \"-c\"\n        # Courtesy of https://unix.stackexchange.com/a/234089/108960\n        - 'exec 3<>/dev/tcp/127.0.0.1/9000 && echo -e \"GET /_health/ HTTP/1.1\\r\\nhost: 127.0.0.1\\r\\n\\r\\n\" >&3 && grep ok -s -m 1 <&3'\n  cron:\n    <<: *sentry_defaults\n    command: run cron\n  worker:\n    <<: *sentry_defaults\n    command: run worker\n  events-consumer:\n    <<: *sentry_defaults\n    command: run consumer ingest-events --consumer-group ingest-consumer\n  attachments-consumer:\n    <<: *sentry_defaults\n    command: run consumer ingest-attachments --consumer-group ingest-consumer\n  post-process-forwarder-errors:\n    <<: *sentry_defaults\n    command: run consumer --no-strict-offset-reset post-process-forwarder-errors --consumer-group post-process-forwarder --synchronize-commit-log-topic=snuba-commit-log --synchronize-commit-group=snuba-consumers\n  subscription-consumer-events:\n    <<: *sentry_defaults\n    command: run consumer events-subscription-results --consumer-group query-subscription-consumer\n  ##############################################\n  ## Feature Complete Sentry Ingest Consumers ##\n  ##############################################\n  transactions-consumer:\n    <<: *sentry_defaults\n    command: run consumer ingest-transactions --consumer-group ingest-consumer\n    profiles:\n      - feature-complete\n  metrics-consumer:\n    <<: *sentry_defaults\n    command: run consumer ingest-metrics --consumer-group metrics-consumer\n    profiles:\n      - feature-complete\n  generic-metrics-consumer:\n    <<: *sentry_defaults\n    command: run consumer ingest-generic-metrics --consumer-group generic-metrics-consumer\n    profiles:\n      - feature-complete\n  billing-metrics-consumer:\n    <<: *sentry_defaults\n    command: run consumer billing-metrics-consumer --consumer-group billing-metrics-consumer\n    profiles:\n      - feature-complete\n  ingest-replay-recordings:\n    <<: *sentry_defaults\n    command: run consumer ingest-replay-recordings --consumer-group ingest-replay-recordings\n    profiles:\n      - feature-complete\n  ingest-occurrences:\n    <<: *sentry_defaults\n    command: run consumer ingest-occurrences --consumer-group ingest-occurrences\n    profiles:\n      - feature-complete\n  ingest-profiles:\n    <<: *sentry_defaults\n    command: run consumer ingest-profiles --consumer-group ingest-profiles\n    profiles:\n      - feature-complete\n  ingest-monitors:\n    <<: *sentry_defaults\n    command: run consumer ingest-monitors --consumer-group ingest-monitors\n    profiles:\n      - feature-complete\n  ingest-feedback-events:\n    <<: *sentry_defaults\n    command: run consumer ingest-feedback-events --consumer-group ingest-feedback\n    profiles:\n      - feature-complete\n  monitors-clock-tick:\n    <<: *sentry_defaults\n    command: run consumer monitors-clock-tick --consumer-group monitors-clock-tick\n    profiles:\n      - feature-complete\n  monitors-clock-tasks:\n    <<: *sentry_defaults\n    command: run consumer monitors-clock-tasks --consumer-group monitors-clock-tasks\n    profiles:\n      - feature-complete\n  post-process-forwarder-transactions:\n    <<: *sentry_defaults\n    command: run consumer --no-strict-offset-reset post-process-forwarder-transactions --consumer-group post-process-forwarder --synchronize-commit-log-topic=snuba-transactions-commit-log --synchronize-commit-group transactions_group\n    profiles:\n      - feature-complete\n  post-process-forwarder-issue-platform:\n    <<: *sentry_defaults\n    command: run consumer --no-strict-offset-reset post-process-forwarder-issue-platform --consumer-group post-process-forwarder --synchronize-commit-log-topic=snuba-generic-events-commit-log --synchronize-commit-group generic_events_group\n    profiles:\n      - feature-complete\n  subscription-consumer-transactions:\n    <<: *sentry_defaults\n    command: run consumer transactions-subscription-results --consumer-group query-subscription-consumer\n    profiles:\n      - feature-complete\n  subscription-consumer-metrics:\n    <<: *sentry_defaults\n    command: run consumer metrics-subscription-results --consumer-group query-subscription-consumer\n    profiles:\n      - feature-complete\n  subscription-consumer-generic-metrics:\n    <<: *sentry_defaults\n    command: run consumer generic-metrics-subscription-results --consumer-group query-subscription-consumer\n    profiles:\n      - feature-complete\n  sentry-cleanup:\n    <<: *sentry_defaults\n    image: sentry-cleanup-self-hosted-local\n    build:\n      context: ./cron\n      args:\n        BASE_IMAGE: sentry-self-hosted-local\n    entrypoint: \"/entrypoint.sh\"\n    command: '\"0 0 * * * gosu sentry sentry cleanup --days $SENTRY_EVENT_RETENTION_DAYS\"'\n  nginx:\n    <<: *restart_policy\n    ports:\n      - \"$SENTRY_BIND:80/tcp\"\n    image: \"nginx:1.25.4-alpine\"\n    volumes:\n      - type: bind\n        read_only: true\n        source: ./nginx.conf\n        target: /etc/nginx/nginx.conf\n      - sentry-nginx-cache:/var/cache/nginx\n      - sentry-nginx-www:/var/www\n    depends_on:\n      - web\n      - relay\n  relay:\n    <<: *restart_policy\n    image: \"$RELAY_IMAGE\"\n    volumes:\n      - type: bind\n        read_only: true\n        source: ./relay\n        target: /work/.relay\n      - type: bind\n        read_only: true\n        source: ./geoip\n        target: /geoip\n    depends_on:\n      kafka:\n        <<: *depends_on-healthy\n      redis:\n        <<: *depends_on-healthy\n      web:\n        <<: *depends_on-healthy\n  vroom:\n    <<: *restart_policy\n    image: \"$VROOM_IMAGE\"\n    environment:\n      SENTRY_KAFKA_BROKERS_PROFILING: \"kafka:9092\"\n      SENTRY_KAFKA_BROKERS_OCCURRENCES: \"kafka:9092\"\n      SENTRY_BUCKET_PROFILES: file://localhost//var/lib/sentry-profiles\n      SENTRY_SNUBA_HOST: \"http://snuba-api:1218\"\n    volumes:\n      - sentry-vroom:/var/lib/sentry-profiles\n    depends_on:\n      kafka:\n        <<: *depends_on-healthy\n    profiles:\n      - feature-complete\n  vroom-cleanup:\n    <<: *restart_policy\n    image: vroom-cleanup-self-hosted-local\n    build:\n      context: ./cron\n      args:\n        BASE_IMAGE: \"$VROOM_IMAGE\"\n    entrypoint: \"/entrypoint.sh\"\n    environment:\n      # Leaving the value empty to just pass whatever is set\n      # on the host system (or in the .env file)\n      SENTRY_EVENT_RETENTION_DAYS:\n    command: '\"0 0 * * * find /var/lib/sentry-profiles -type f -mtime +$SENTRY_EVENT_RETENTION_DAYS -delete\"'\n    volumes:\n      - sentry-vroom:/var/lib/sentry-profiles\n    profiles:\n      - feature-complete\n\nvolumes:\n  # These store application data that should persist across restarts.\n  sentry-data:\n    external: true\n  sentry-postgres:\n    external: true\n  sentry-redis:\n    external: true\n  sentry-kafka:\n    external: true\n  sentry-clickhouse:\n    external: true\n  sentry-symbolicator:\n    external: true\n  # This volume stores JS SDK assets and the data inside this volume should\n  # be cleaned periodically on upgrades.\n  sentry-nginx-www:\n  # This volume stores profiles and should be persisted.\n  # Not being external will still persist data across restarts.\n  # It won't persist if someone does a docker compose down -v.\n  sentry-vroom:\n  # These store ephemeral data that needn't persist across restarts.\n  # That said, volumes will be persisted across restarts until they are deleted.\n  sentry-secrets:\n  sentry-smtp:\n  sentry-nginx-cache:\n  sentry-kafka-log:\n  sentry-smtp-log:\n  sentry-clickhouse-log:\n"
        },
        {
          "name": "geoip",
          "type": "tree",
          "content": null
        },
        {
          "name": "install.sh",
          "type": "blob",
          "size": 1.349609375,
          "content": "#!/usr/bin/env bash\nset -eE\n\n# Pre-pre-flight? 🤷\nif [[ -n \"$MSYSTEM\" ]]; then\n  echo \"Seems like you are using an MSYS2-based system (such as Git Bash) which is not supported. Please use WSL instead.\"\n  exit 1\nfi\n\nsource install/_lib.sh\n\n# Pre-flight. No impact yet.\nsource install/parse-cli.sh\nsource install/detect-platform.sh\nsource install/dc-detect-version.sh\nsource install/error-handling.sh\n# We set the trap at the top level so that we get better tracebacks.\ntrap_with_arg cleanup ERR INT TERM EXIT\nsource install/check-latest-commit.sh\nsource install/check-minimum-requirements.sh\n\n# Let's go! Start impacting things.\n# Upgrading clickhouse needs to come first before turning things off, since we need the old clickhouse image\n# in order to determine whether or not the clickhouse version needs to be upgraded.\nsource install/upgrade-clickhouse.sh\nsource install/turn-things-off.sh\nsource install/create-docker-volumes.sh\nsource install/ensure-files-from-examples.sh\nsource install/check-memcached-backend.sh\nsource install/ensure-relay-credentials.sh\nsource install/generate-secret-key.sh\nsource install/update-docker-images.sh\nsource install/build-docker-images.sh\nsource install/bootstrap-snuba.sh\nsource install/upgrade-postgres.sh\nsource install/set-up-and-migrate-database.sh\nsource install/geoip.sh\nsource install/setup-js-sdk-assets.sh\nsource install/wrap-up.sh\n"
        },
        {
          "name": "install",
          "type": "tree",
          "content": null
        },
        {
          "name": "jq",
          "type": "tree",
          "content": null
        },
        {
          "name": "nginx.conf",
          "type": "blob",
          "size": 2.623046875,
          "content": "user nginx;\nworker_processes auto;\n\nerror_log /var/log/nginx/error.log warn;\npid /var/run/nginx.pid;\n\n\nevents {\n\tworker_connections 1024;\n}\n\n\nhttp {\n\tinclude /etc/nginx/mime.types;\n\tdefault_type application/octet-stream;\n\n\tlog_format main '$remote_addr - $remote_user [$time_local] \"$request\" '\n\t'$status $body_bytes_sent \"$http_referer\" '\n\t'\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n\taccess_log /var/log/nginx/access.log main;\n\n\tsendfile on;\n\ttcp_nopush on;\n\ttcp_nodelay on;\n\treset_timedout_connection on;\n\n\tkeepalive_timeout 75s;\n\n\tgzip off;\n\tserver_tokens off;\n\n\tserver_names_hash_bucket_size 64;\n\ttypes_hash_max_size 2048;\n\ttypes_hash_bucket_size 64;\n\tclient_body_buffer_size 64k;\n\tclient_max_body_size 100m;\n\n\tproxy_http_version 1.1;\n\tproxy_redirect off;\n\tproxy_buffer_size          128k;\n\tproxy_buffers              4 256k;\n\tproxy_busy_buffers_size    256k;\n\tproxy_next_upstream error timeout invalid_header http_502 http_503 non_idempotent;\n\tproxy_next_upstream_tries 2;\n\n\t# Docker default address pools\n\t# https://github.com/moby/libnetwork/blob/3797618f9a38372e8107d8c06f6ae199e1133ae8/ipamutils/utils.go#L10-L22\n\tset_real_ip_from 172.17.0.0/16;\n\tset_real_ip_from 172.18.0.0/16;\n\tset_real_ip_from 172.19.0.0/16;\n\tset_real_ip_from 172.20.0.0/14;\n\tset_real_ip_from 172.24.0.0/14;\n\tset_real_ip_from 172.28.0.0/14;\n\tset_real_ip_from 192.168.0.0/16;\n\tset_real_ip_from 10.0.0.0/8;\n\treal_ip_header X-Forwarded-For;\n\treal_ip_recursive on;\n\n\t# Remove the Connection header if the client sends it,\n\t# it could be \"close\" to close a keepalive connection\n\tproxy_set_header Connection '';\n\tproxy_set_header Host $host;\n\tproxy_set_header X-Forwarded-For $remote_addr;\n\tproxy_set_header X-Forwarded-Proto $scheme;\n\tproxy_set_header X-Request-Id $request_id;\n\tproxy_read_timeout 30s;\n\tproxy_send_timeout 5s;\n\n\tupstream relay {\n\t\tserver relay:3000;\n\t\tkeepalive 2;\n\t}\n\n\tupstream sentry {\n\t\tserver web:9000;\n\t\tkeepalive 2;\n\t}\n\n\tserver {\n\t\tlisten 80;\n\n\t\tlocation /api/store/ {\n\t\t\tproxy_pass http://relay;\n\t\t}\n\t\tlocation ~ ^/api/[1-9]\\d*/ {\n\t\t\tproxy_pass http://relay;\n\t\t}\n\t\tlocation ^~ /api/0/relays/ {\n\t\t\tproxy_pass http://relay;\n\t\t}\n\t\tlocation ^~ /js-sdk/ {\n\t\t\troot /var/www/;\n\t\t\t# This value is set to mimic the behavior of the upstream Sentry CDN. For security reasons,\n\t\t\t# it is recommended to change this to your Sentry URL (in most cases same as system.url-prefix).\n\t\t\tadd_header Access-Control-Allow-Origin *;\n\t\t}\n\t\tlocation / {\n\t\t\tproxy_pass http://sentry;\n\t\t}\n\t\tlocation /_assets/ {\n\t\t\tproxy_pass http://sentry/_static/dist/sentry/;\n\t\t\tproxy_hide_header Content-Disposition;\n\t\t}\n\t\tlocation /_static/ {\n\t\t\tproxy_pass http://sentry;\n\t\t\tproxy_hide_header Content-Disposition;\n\t\t}\n\t}\n}\n"
        },
        {
          "name": "redis.conf",
          "type": "blob",
          "size": 1.22265625,
          "content": "# redis.conf\n\n# The 'maxmemory' directive controls the maximum amount of memory Redis is allowed to use.\n# Setting 'maxmemory 0' means there is no limit on memory usage, allowing Redis to use as much\n# memory as the operating system allows. This is suitable for environments where memory\n# constraints are not a concern.\n#\n# Alternatively, you can specify a limit, such as 'maxmemory 15gb', to restrict Redis to\n# using a maximum of 15 gigabytes of memory.\n#\n# Example:\n# maxmemory 0         # Unlimited memory usage\n# maxmemory 15gb     # Limit memory usage to 15 GB\n\nmaxmemory 0\n\n# This setting determines how Redis evicts keys when it reaches the memory limit.\n# `allkeys-lru` evicts the least recently used keys from all keys stored in Redis,\n# allowing frequently accessed data to remain in memory while older data is removed.\n# That said we use `volatile-lru` as Redis is used both as a cache and processing\n# queue in self-hosted Sentry.\n# > The volatile-lru and volatile-random policies are mainly useful when you want to\n# > use a single Redis instance for both caching and for a set of persistent keys.\n# > However, you should consider running two separate Redis instances in a case like\n# > this, if possible.\n\nmaxmemory-policy volatile-lru\n"
        },
        {
          "name": "relay",
          "type": "tree",
          "content": null
        },
        {
          "name": "requirements-dev.txt",
          "type": "blob",
          "size": 0.15234375,
          "content": "sentry-sdk>=2.4.0\npytest>=8.0.0\npytest-cov>=4.1.0\npytest-rerunfailures>=11.0\npytest-sentry>=0.1.11\nhttpx>=0.25.2\nbeautifulsoup4>=4.7.1\ncryptography>=43.0.3\n"
        },
        {
          "name": "scripts",
          "type": "tree",
          "content": null
        },
        {
          "name": "sentry-admin.sh",
          "type": "blob",
          "size": 2.2119140625,
          "content": "#!/bin/bash\n\n# Set the script directory as working directory.\ncd $(dirname $0)\n\n# Detect docker and platform state.\nsource install/dc-detect-version.sh\nsource install/detect-platform.sh\n\n# Define the Docker volume mapping.\nVOLUME_MAPPING=\"${SENTRY_DOCKER_IO_DIR:-$HOME/.sentry/sentry-admin}:/sentry-admin\"\n\n# Custom help text paragraphs\nHELP_TEXT_SUFFIX=\"\nAll file paths are relative to the 'web' docker container, not the host environment. To pass files\nto/from the host system for commands that require it ('execfile', 'export', 'import', etc), you may\nspecify a 'SENTRY_DOCKER_IO_DIR' environment variable to mount a volume for file IO operations into\nthe host filesystem. The default value of 'SENTRY_DOCKER_IO_DIR' points to '~/.sentry/sentry-admin'\non the host filesystem. Commands that write files should write them to the '/sentry-admin' in the\n'web' container (ex: './sentry-admin.sh export global /sentry-admin/my-export.json').\n\"\n\n# Actual invocation that runs the command in the container.\ninvocation() {\n  $dcr --quiet-pull -v \"$VOLUME_MAPPING\" -T -e SENTRY_LOG_LEVEL=CRITICAL web \"$@\" 2>&1\n}\n\n# Function to modify lines starting with `Usage: sentry` to say `Usage: ./sentry-admin.sh` instead.\nrename_sentry_bin_in_help_output() {\n  local output=\"$1\"\n  local help_prefix=\"$2\"\n  local usage_seen=false\n\n  output=$(invocation \"$@\")\n\n  echo -e \"\\n\\n\"\n\n  while IFS= read -r line; do\n    if [[ $line == \"Usage: sentry\"* ]] && [ \"$usage_seen\" = false ]; then\n      echo -e \"\\n\\n\"\n      echo \"${line/sentry/./sentry-admin.sh}\"\n      echo \"$help_prefix\"\n      usage_seen=true\n    else\n      if [[ $line == \"Options:\"* ]] && [ -n \"$1\" ]; then\n        echo \"$help_prefix\"\n      fi\n      echo \"$line\"\n    fi\n  done <<<\"$output\"\n}\n\n# Check for the user passing ONLY the '--help' argument - we'll add a special prefix to the output.\nif { [ \"$1\" = \"help\" ] || [ \"$1\" = \"--help\" ]; } && [ \"$#\" -eq 1 ]; then\n  rename_sentry_bin_in_help_output \"$(invocation \"$@\")\" \"$HELP_TEXT_SUFFIX\"\n  exit 0\nfi\n\n# Check for '--help' in other contexts.\nfor arg in \"$@\"; do\n  if [ \"$arg\" = \"--help\" ]; then\n    rename_sentry_bin_in_help_output \"$(invocation \"$@\")\"\n    exit 0\n  fi\ndone\n\n# Help has not been requested - go ahead and execute the command.\necho -e \"\\n\\n\"\ninvocation \"$@\"\n"
        },
        {
          "name": "sentry",
          "type": "tree",
          "content": null
        },
        {
          "name": "symbolicator",
          "type": "tree",
          "content": null
        },
        {
          "name": "unit-test.sh",
          "type": "blob",
          "size": 0.44921875,
          "content": "#!/usr/bin/env bash\n\nexport REPORT_SELF_HOSTED_ISSUES=0 # will be over-ridden in the relevant test\n\nFORCE_CLEAN=1 \"./scripts/reset.sh\"\nfail=0\nfor test_file in _unit-test/*-test.sh; do\n  if [ \"$1\" -a \"$1\" != \"$test_file\" ]; then\n    echo \"🙊 Skipping $test_file ...\"\n    continue\n  fi\n  echo \"🙈 Running $test_file ...\"\n  $test_file\n  exit_code=$?\n  if [ $exit_code != 0 ]; then\n    echo fail 👎 with exit code $exit_code\n    fail=1\n  fi\ndone\n\nexit $fail\n"
        },
        {
          "name": "workstation",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}