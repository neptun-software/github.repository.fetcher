{
  "metadata": {
    "timestamp": 1736568675668,
    "page": 749,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjc1OQ==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "hardware/mailserver",
      "stars": 1288,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".dockerignore",
          "type": "blob",
          "size": 0.01171875,
          "content": ".git/\ntest/\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.072265625,
          "content": "docker-compose.mysql.yml\ndocker-compose.pgsql.yml\ntraefik.toml\n.env\ncerts\n"
        },
        {
          "name": ".gitmodules",
          "type": "blob",
          "size": 0.33203125,
          "content": "[submodule \"test/bats\"]\n\tpath = test/bats\n\turl = https://github.com/sstephenson/bats\n[submodule \"test/test_helper/bats-support\"]\n\tpath = test/test_helper/bats-support\n\turl = https://github.com/ztombol/bats-support\n[submodule \"test/test_helper/bats-assert\"]\n\tpath = test/test_helper/bats-assert\n\turl = https://github.com/ztombol/bats-assert\n"
        },
        {
          "name": ".travis.yml",
          "type": "blob",
          "size": 0.06640625,
          "content": "language: bash\nsudo: required\nservices:\n- docker\nscript:\n- make all\n"
        },
        {
          "name": "CODE_OF_CONDUCT.md",
          "type": "blob",
          "size": 3.130859375,
          "content": "# Contributor Code of Conduct\n\n## Our Pledge\n\nIn the interest of fostering an open and welcoming environment, we as contributors and maintainers pledge to making participation in our project and our community a harassment-free experience for everyone, regardless of age, body size, disability, ethnicity, gender identity and expression, level of experience, nationality, personal appearance, race, religion, or sexual identity and orientation.\n\n## Our Standards\n\nExamples of behavior that contributes to creating a positive environment include:\n\n* Using welcoming and inclusive language\n* Being respectful of differing viewpoints and experiences\n* Gracefully accepting constructive criticism\n* Focusing on what is best for the community\n* Showing empathy towards other community members\n\nExamples of unacceptable behavior by participants include:\n\n* The use of sexualized language or imagery and unwelcome sexual attention or advances\n* Trolling, insulting/derogatory comments, and personal or political attacks\n* Public or private harassment\n* Publishing others' private information, such as a physical or electronic address, without explicit permission\n* Other conduct which could reasonably be considered inappropriate in a professional setting\n\n## Our Responsibilities\n\nProject maintainers are responsible for clarifying the standards of acceptable behavior and are expected to take appropriate and fair corrective action in response to any instances of unacceptable behavior.\n\nProject maintainers have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening, offensive, or harmful.\n\n## Scope\n\nThis Code of Conduct applies both within project spaces and in public spaces when an individual is representing the project or its community. Examples of representing a project or community include using an official project e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event. Representation of a project may be further defined and clarified by project maintainers.\n\n## Enforcement\n\nInstances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project team at contact@meshup.net. The project team will review and investigate all complaints, and will respond in a way that it deems appropriate to the circumstances. The project team is obligated to maintain confidentiality with regard to the reporter of an incident. Further details of specific enforcement policies may be posted separately.\n\nProject maintainers who do not follow or enforce the Code of Conduct in good faith may face temporary or permanent repercussions as determined by other members of the project's leadership.\n\n## Attribution\n\nThis Code of Conduct is adapted from the [Contributor Covenant][homepage], version 1.4, available at [http://contributor-covenant.org/version/1/4][version]\n\n[homepage]: http://contributor-covenant.org\n[version]: http://contributor-covenant.org/version/1/4/\n"
        },
        {
          "name": "CONTRIBUTING.md",
          "type": "blob",
          "size": 0.8427734375,
          "content": "# Contributing\n\nFirst off, thanks for taking the time to contribute. Pull requests are always welcome ! :thumbsup:\n\nThe following is a set of guidelines for contributing to this repository.\nPlease note we have a code of conduct, please follow it in all your interactions with the project.\n\n## How to contribute\n\n- Fork this repository\n- Create a new feature branch for a new functionality or bugfix\n- Code...\n- Add integration tests in test/tests.bats\n- Use `make` to build image locally and run tests\n- Document your improvements\n- Commit your changes\n- Push your code and open a new pull request\n- Use [issues](https://github.com/hardware/mailserver/issues) for any questions\n\n## Licensing\n\nPlease note, this repository is made available under the MIT license, so any contributions must be compatible with that license. If you're not sure about that, just ask.\n"
        },
        {
          "name": "Dockerfile",
          "type": "blob",
          "size": 1.0849609375,
          "content": "FROM hardware/debian-mail-overlay:latest\n\nLABEL description \"Simple and full-featured mail server using Docker\" \\\n      maintainer=\"Hardware <contact@meshup.net>\"\n\nARG DEBIAN_FRONTEND=noninteractive\nENV PYTHONUNBUFFERED=1\n\nRUN apt-get update && apt-get install -y -q --no-install-recommends \\\n    postfix postfix-pgsql postfix-mysql postfix-ldap postfix-pcre libsasl2-modules \\\n    dovecot-core dovecot-imapd dovecot-lmtpd dovecot-pgsql dovecot-mysql dovecot-ldap dovecot-sieve dovecot-managesieved dovecot-pop3d \\\n    fetchmail libdbi-perl libdbd-pg-perl libdbd-mysql-perl liblockfile-simple-perl \\\n    clamav clamav-daemon \\\n    python3-pip python3-setuptools python3-wheel \\\n    rsyslog dnsutils curl unbound jq rsync \\\n    inotify-tools \\\n && rm -rf /var/spool/postfix \\\n && ln -s /var/mail/postfix/spool /var/spool/postfix \\\n && apt-get autoremove -y \\\n && apt-get clean \\\n && rm -rf /tmp/* /var/lib/apt/lists/* /var/cache/debconf/*-old \\\n && pip3 install watchdog\n\nEXPOSE 25 143 465 587 993 4190 11334\nCOPY rootfs /\nRUN chmod +x /usr/local/bin/* /services/*/run /services/.s6-svscan/finish\nCMD [\"run.sh\"]\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.0703125,
          "content": "\nThe MIT License (MIT)\n\nCopyright (c) 2016 Hardware <contact@meshup.net>\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE."
        },
        {
          "name": "Makefile",
          "type": "blob",
          "size": 14.2890625,
          "content": "NAME = hardware/mailserver:testing\n\nall: build-no-cache init fixtures run clean\nall-fast: build init fixtures run clean\nno-build: init fixtures run clean\n\nbuild-no-cache:\n\tdocker build --no-cache -t $(NAME) .\n\nbuild:\n\tdocker build -t $(NAME) .\n\ninit:\n\t-docker rm -f \\\n\t\tmariadb postgres redis openldap \\\n\t\tmailserver_default mailserver_reverse mailserver_ecdsa mailserver_ldap mailserver_ldap2 \\\n\t\tmailserver_traefik_acmev1 mailserver_traefik_acmev2\n\n\tsleep 2\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name mariadb \\\n\t\t-e MYSQL_RANDOM_ROOT_PASSWORD=yes \\\n\t\t-e MYSQL_DATABASE=postfix \\\n\t\t-e MYSQL_USER=postfix \\\n\t\t-e MYSQL_PASSWORD=testpasswd \\\n\t\t-v \"`pwd`/test/config/mariadb/struct.sql\":/docker-entrypoint-initdb.d/struct.sql \\\n\t\t-v \"`pwd`/test/config/mariadb/bind.cnf\":/etc/mysql/conf.d/bind.cnf \\\n\t\t-t mysql:5.7\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name postgres \\\n\t\t-e POSTGRES_DB=postfix \\\n\t\t-e POSTGRES_USER=postfix \\\n\t\t-e POSTGRES_PASSWORD=testpasswd \\\n\t\t-v \"`pwd`/test/config/postgres\":/docker-entrypoint-initdb.d \\\n\t\t-t postgres:10.5-alpine\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name redis \\\n\t\t-t redis:4.0-alpine\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name openldap \\\n\t\t-e LDAP_ORGANISATION=\"Test LDAP\" \\\n\t\t-e LDAP_DOMAIN=\"domain.tld\" \\\n\t\t-e LDAP_ADMIN_PASSWORD=\"testpasswd\" \\\n\t\t-e LDAP_TLS=false \\\n\t\t-v \"`pwd`/test/config/ldap/struct.ldif\":/container/service/slapd/assets/config/bootstrap/ldif/custom/struct.ldif \\\n\t\t-t osixia/openldap:1.2.2 --copy-service\n\n\tsleep 10\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name mailserver_default \\\n\t\t--link mariadb:mariadb \\\n\t\t--link redis:redis \\\n\t\t-e DBPASS=testpasswd \\\n\t\t-e RSPAMD_PASSWORD=testpasswd \\\n\t\t-e VMAILUID=`id -u` \\\n\t\t-e VMAILGID=`id -g` \\\n\t\t-e ADD_DOMAINS=domain2.tld,domain3.tld \\\n\t\t-e RECIPIENT_DELIMITER=: \\\n\t\t-e TESTING=true \\\n\t\t-v \"`pwd`/test/share/tests\":/tmp/tests \\\n\t\t-v \"`pwd`/test/share/ssl/rsa\":/var/mail/ssl \\\n\t\t-v \"`pwd`/test/share/postfix/custom.conf\":/var/mail/postfix/custom.conf \\\n\t\t-v \"`pwd`/test/share/postfix/sender_access\":/var/mail/postfix/sender_access \\\n\t\t-v \"`pwd`/test/share/dovecot/conf.d\":/var/mail/dovecot/conf.d \\\n\t\t-v \"`pwd`/test/share/clamav/unofficial-sigs/user.conf\":/var/mail/clamav-unofficial-sigs/user.conf \\\n\t\t-h mail.domain.tld \\\n\t\t-t $(NAME)\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name mailserver_reverse \\\n\t\t--link postgres:postgres \\\n\t\t--link redis:redis \\\n\t\t-e FQDN=mail.domain.tld \\\n\t\t-e DOMAIN=domain.tld \\\n\t\t-e DBDRIVER=pgsql \\\n\t\t-e DBHOST=postgres \\\n\t\t-e DBPORT=5432 \\\n\t\t-e DBPASS=/tmp/passwd/postgres \\\n\t\t-e REDIS_HOST=redis \\\n\t\t-e REDIS_PORT=6379 \\\n\t\t-e REDIS_PASS=/tmp/passwd/redis \\\n\t\t-e RSPAMD_PASSWORD=/tmp/passwd/rspamd \\\n\t\t-e VMAILUID=`id -u` \\\n\t\t-e VMAILGID=`id -g` \\\n\t\t-e VMAIL_SUBDIR=subdir \\\n\t\t-e RELAY_NETWORKS=\"192.168.0.0/16 172.16.0.0/12 10.0.0.0/8\" \\\n\t\t-e DISABLE_CLAMAV=true \\\n\t\t-e DISABLE_SIEVE=true \\\n\t\t-e DISABLE_SIGNING=true \\\n\t\t-e DISABLE_GREYLISTING=true \\\n\t\t-e DISABLE_RATELIMITING=true \\\n\t\t-e DISABLE_DNS_RESOLVER=true \\\n\t\t-e ENABLE_POP3=true \\\n\t\t-e ENABLE_ENCRYPTION=true \\\n\t\t-e ENABLE_FETCHMAIL=true \\\n\t\t-e OPENDKIM_KEY_LENGTH=4096 \\\n\t\t-e TESTING=true \\\n\t\t-v \"`pwd`/test/share/tests\":/tmp/tests \\\n\t\t-v \"`pwd`/test/share/passwd\":/tmp/passwd \\\n\t\t-v \"`pwd`/test/share/ssl/rsa\":/var/mail/ssl \\\n\t\t-v \"`pwd`/test/share/sieve/custom.sieve\":/var/mail/sieve/custom.sieve \\\n\t\t-v \"`pwd`/test/share/letsencrypt\":/etc/letsencrypt \\\n\t\t-t $(NAME)\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name mailserver_ldap \\\n\t\t--link openldap \\\n\t\t--link redis:redis \\\n\t\t-e DBDRIVER=ldap \\\n\t\t-e DBHOST=openldap \\\n\t\t-e DBPORT=389 \\\n\t\t-e LDAP_BIND_DN=\"cn=admin,dc=domain,dc=tld\" \\\n\t\t-e LDAP_BIND_PW=\"testpasswd\" \\\n\t\t-e LDAP_DEFAULT_SEARCH_BASE=\"o=mx,dc=domain,dc=tld\" \\\n\t\t-e LDAP_DOMAIN_FILTER=\"(&(mail=*@%s)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_DOMAIN_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_DOMAIN_FORMAT=\"%d\" \\\n\t\t-e LDAP_MAILBOX_FILTER=\"(&(mail=%s)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_MAILBOX_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_MAILBOX_FORMAT=\"/var/mail/vhosts/%d/%s/mail/\" \\\n\t\t-e LDAP_ALIAS_FILTER=\"(&(mailalias=%s)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_ALIAS_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_FORWARD_FILTER=\"(&(mailalias=%s)(objectClass=mailAlias))\" \\\n\t\t-e LDAP_FORWARD_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_GROUP_FILTER=\"(&(mail=%s)(objectClass=mailGroup))\" \\\n\t\t-e LDAP_GROUP_ATTRIBUTE=\"uid\" \\\n\t\t-e LDAP_SENDER_FILTER=\"(&(|(mail=%s)(mailalias=%s))(objectClass=mailAccount))\" \\\n\t\t-e LDAP_SENDER_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_DOVECOT_USER_ATTRS=\"=home=/var/mail/vhosts/%d/%n/,=mail=maildir:/var/mail/vhosts/%d/%n/mail/,mailuserquota=quota_rule=*:bytes=%\\$$\" \\\n\t\t-e LDAP_DOVECOT_USER_FILTER=\"(&(mail=%u)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_DOVECOT_PASS_ATTRS=\"mail=user,userPassword=password\" \\\n\t\t-e LDAP_DOVECOT_PASS_FILTER=\"(&(mail=%u)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_DOVECOT_ITERATE_ATTRS=\"mail=user\" \\\n\t\t-e LDAP_DOVECOT_ITERATE_FILTER=\"(objectClass=mailAccount)\" \\\n\t\t-e VMAILUID=`id -u` \\\n\t\t-e VMAILGID=`id -g` \\\n\t\t-e RSPAMD_PASSWORD=testpasswd \\\n\t\t-e ADD_DOMAINS=domain2.tld,domain3.tld \\\n\t\t-e RECIPIENT_DELIMITER=: \\\n\t\t-e TESTING=true \\\n\t\t-v \"`pwd`/test/share/tests\":/tmp/tests \\\n\t\t-v \"`pwd`/test/share/ssl/rsa\":/var/mail/ssl \\\n\t\t-v \"`pwd`/test/share/postfix/custom.conf\":/var/mail/postfix/custom.conf \\\n\t\t-v \"`pwd`/test/share/postfix/sender_access\":/var/mail/postfix/sender_access \\\n\t\t-v \"`pwd`/test/share/dovecot/conf.d\":/var/mail/dovecot/conf.d \\\n\t\t-v \"`pwd`/test/share/clamav/unofficial-sigs/user.conf\":/var/mail/clamav-unofficial-sigs/user.conf \\\n\t\t-h mail.domain.tld \\\n\t\t-t $(NAME)\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name mailserver_ldap2 \\\n\t\t--link openldap \\\n\t\t--link redis:redis \\\n\t\t-e DBDRIVER=ldap \\\n\t\t-e DBHOST=openldap \\\n\t\t-e DBPORT=389 \\\n\t\t-e LDAP_BIND_DN=\"cn=admin,dc=domain,dc=tld\" \\\n\t\t-e LDAP_BIND_PW=\"testpasswd\" \\\n\t\t-e LDAP_DEFAULT_SEARCH_BASE=\"o=mx,dc=domain,dc=tld\" \\\n\t\t-e LDAP_DOMAIN_FILTER=\"(&(mail=*@%s)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_DOMAIN_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_DOMAIN_FORMAT=\"%d\" \\\n\t\t-e LDAP_MAILBOX_FILTER=\"(&(mail=%s)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_MAILBOX_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_MAILBOX_FORMAT=\"/var/mail/vhosts/%d/%s/mail/\" \\\n\t\t-e LDAP_ALIAS_FILTER=\"(&(mailalias=%s)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_ALIAS_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_SENDER_FILTER=\"(&(|(mail=%s)(mailalias=%s))(objectClass=mailAccount))\" \\\n\t\t-e LDAP_SENDER_ATTRIBUTE=\"mail\" \\\n\t\t-e LDAP_DOVECOT_USER_ATTRS=\"=home=/var/mail/vhosts/%d/%n/,=mail=maildir:/var/mail/vhosts/%d/%n/mail/,mailuserquota=quota_rule=*:bytes=%\\$$\" \\\n\t\t-e LDAP_DOVECOT_USER_FILTER=\"(&(mail=%u)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_DOVECOT_PASS_ATTRS=\"mail=user,userPassword=password\" \\\n\t\t-e LDAP_DOVECOT_PASS_FILTER=\"(&(mail=%u)(objectClass=mailAccount))\" \\\n\t\t-e LDAP_DOVECOT_ITERATE_ATTRS=\"mail=user\" \\\n\t\t-e LDAP_DOVECOT_ITERATE_FILTER=\"(objectClass=mailAccount)\" \\\n\t\t-e LDAP_MASTER_USER_ENABLED=true \\\n\t\t-e LDAP_DOVECOT_MASTER_PASS_ATTRS=\"mail=user,userPassword=password\" \\\n\t\t-e LDAP_DOVECOT_MASTER_PASS_FILTER=\"(&(mail=%u)(st=%{login_user})(objectClass=mailAccount))\" \\\n\t\t-e DISABLE_CLAMAV=true \\\n\t\t-e DISABLE_SIEVE=true \\\n\t\t-e DISABLE_SIGNING=true \\\n\t\t-e DISABLE_GREYLISTING=true \\\n\t\t-e DISABLE_RATELIMITING=true \\\n\t\t-e DISABLE_DNS_RESOLVER=true \\\n\t\t-e VMAILUID=`id -u` \\\n\t\t-e VMAILGID=`id -g` \\\n\t\t-e RSPAMD_PASSWORD=testpasswd \\\n\t\t-e ADD_DOMAINS=domain2.tld,domain3.tld \\\n\t\t-e RECIPIENT_DELIMITER=: \\\n\t\t-e TESTING=true \\\n\t\t-v \"`pwd`/test/share/tests\":/tmp/tests \\\n\t\t-v \"`pwd`/test/share/ssl/rsa\":/var/mail/ssl \\\n\t\t-v \"`pwd`/test/share/postfix/custom.conf\":/var/mail/postfix/custom.conf \\\n\t\t-v \"`pwd`/test/share/postfix/sender_access\":/var/mail/postfix/sender_access \\\n\t\t-v \"`pwd`/test/share/dovecot/conf.d\":/var/mail/dovecot/conf.d \\\n\t\t-v \"`pwd`/test/share/clamav/unofficial-sigs/user.conf\":/var/mail/clamav-unofficial-sigs/user.conf \\\n\t\t-h mail.domain.tld \\\n\t\t-t $(NAME)\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name mailserver_ecdsa \\\n\t\t--link mariadb:mariadb \\\n\t\t--link redis:redis \\\n\t\t-e DBPASS=testpasswd \\\n\t\t-e RSPAMD_PASSWORD=testpasswd \\\n\t\t-e VMAILUID=`id -u` \\\n\t\t-e VMAILGID=`id -g` \\\n\t\t-e DISABLE_CLAMAV=true \\\n\t\t-e DISABLE_RSPAMD_MODULE=rbl,mx_check,url_redirector \\\n\t\t-e WHITELIST_SPAM_ADDRESSES=test@example.com,another@domain.tld \\\n\t\t-e TESTING=true \\\n\t\t-v \"`pwd`/test/share/ssl/ecdsa\":/var/mail/ssl \\\n\t\t-v \"`pwd`/test/share/postfix/custom.ecdsa.conf\":/var/mail/postfix/custom.conf \\\n\t\t-h mail.domain.tld \\\n\t\t-t $(NAME)\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name mailserver_traefik_acmev1 \\\n\t\t--link mariadb:mariadb \\\n\t\t--link redis:redis \\\n\t\t-e DEBUG_MODE=dovecot,postfix \\\n\t\t-e DBPASS=testpasswd \\\n\t\t-e RSPAMD_PASSWORD=testpasswd \\\n\t\t-e VMAILUID=`id -u` \\\n\t\t-e VMAILGID=`id -g` \\\n\t\t-e DISABLE_CLAMAV=true \\\n\t\t-e TESTING=true \\\n\t\t-v \"`pwd`/test/share/traefik/acme.v1.json\":/etc/letsencrypt/acme/acme.json \\\n\t\t-h mail.domain.tld \\\n\t\t-t $(NAME)\n\n\tdocker run \\\n\t\t-d \\\n\t\t--name mailserver_traefik_acmev2 \\\n\t\t--link mariadb:mariadb \\\n\t\t--link redis:redis \\\n\t\t-e DEBUG_MODE=true \\\n\t\t-e DBPASS=testpasswd \\\n\t\t-e RSPAMD_PASSWORD=testpasswd \\\n\t\t-e VMAILUID=`id -u` \\\n\t\t-e VMAILGID=`id -g` \\\n\t\t-e DISABLE_CLAMAV=true \\\n\t\t-e TESTING=true \\\n\t\t-v \"`pwd`/test/share/traefik/acme.v2.json\":/etc/letsencrypt/acme/acme.json \\\n\t\t-h mail.domain.tld \\\n\t\t-t $(NAME)\n\nfixtures:\n\n\t# Wait for clamav unofficial sigs database update (default)\n\tdocker exec mailserver_default /bin/sh -c \"while [ -f /var/lib/clamav-unofficial-sigs/pid/clamav-unofficial-sigs.pid ] ; do sleep 1 ; done\"\n\t# Wait for clamav load databases (default)\n\tdocker exec mailserver_default /bin/sh -c \"while ! echo PING | nc -z 0.0.0.0 3310 ; do sleep 1 ; done\"\n\n\t# Wait for clamav unofficial sigs database update (ldap)\n\tdocker exec mailserver_ldap /bin/sh -c \"while [ -f /var/lib/clamav-unofficial-sigs/pid/clamav-unofficial-sigs.pid ] ; do sleep 1 ; done\"\n\t# Wait for clamav load databases (ldap)\n\tdocker exec mailserver_ldap /bin/sh -c \"while ! echo PING | nc -z 0.0.0.0 3310 ; do sleep 1 ; done\"\n\n\tdocker exec mailserver_default /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-user.txt\"\n\tdocker exec mailserver_default /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-user-spam-learning.txt\"\n\tdocker exec mailserver_default /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-valid-user-subaddress.txt\"\n\tdocker exec mailserver_default /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-non-existing-user.txt\"\n\tdocker exec mailserver_default /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-alias.txt\"\n\tdocker exec mailserver_default /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-spam-to-existing-user.txt\"\n\tdocker exec mailserver_default /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-virus-to-existing-user.txt\"\n\tdocker exec mailserver_default /bin/sh -c \"openssl s_client -ign_eof -connect 0.0.0.0:587 -starttls smtp < /tmp/tests/email-templates/internal-user-to-existing-user.txt\"\n\tdocker exec mailserver_default /bin/sh -c \"openssl s_client -ign_eof -connect 0.0.0.0:587 -starttls smtp < /tmp/tests/email-templates/internal-rejected-user-to-existing-user.txt\"\n\n\tdocker exec mailserver_reverse /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-user.txt\"\n\tdocker exec mailserver_reverse /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-valid-user-subaddress-with-default-separator.txt\"\n\tdocker exec mailserver_reverse /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-non-existing-user.txt\"\n\tdocker exec mailserver_reverse /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-alias.txt\"\n\tdocker exec mailserver_reverse /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-spam-to-existing-user.txt\"\n\tdocker exec mailserver_reverse /bin/sh -c \"openssl s_client -ign_eof -connect 0.0.0.0:587 -starttls smtp < /tmp/tests/email-templates/internal-user-to-existing-user.txt\"\n\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-user.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-user-spam-learning.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-valid-user-subaddress.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-non-existing-user.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-alias.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-alias-forward.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-alias-group.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-spam-to-existing-user.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-virus-to-existing-user.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"openssl s_client -ign_eof -connect 0.0.0.0:587 -starttls smtp < /tmp/tests/email-templates/internal-user-to-existing-user.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"openssl s_client -ign_eof -connect 0.0.0.0:587 -starttls smtp < /tmp/tests/email-templates/internal-rejected-user-to-existing-user.txt\"\n\n\tdocker exec mailserver_ldap2 /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-user.txt\"\n\tdocker exec mailserver_ldap2 /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-valid-user-subaddress.txt\"\n\tdocker exec mailserver_ldap2 /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-non-existing-user.txt\"\n\tdocker exec mailserver_ldap2 /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-alias.txt\"\n\tdocker exec mailserver_ldap2 /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-alias-forward.txt\"\n\tdocker exec mailserver_ldap2 /bin/sh -c \"nc 0.0.0.0 25 < /tmp/tests/email-templates/external-to-existing-alias-group.txt\"\n\tdocker exec mailserver_ldap2 /bin/sh -c \"openssl s_client -ign_eof -connect 0.0.0.0:587 -starttls smtp < /tmp/tests/email-templates/internal-user-to-existing-user.txt\"\n\n\tsleep 2\n\tdocker exec mailserver_default /bin/sh -c \"openssl s_client -ign_eof -connect 0.0.0.0:993 < /tmp/tests/sieve/trigger-spam-ham-learning.txt\"\n\tdocker exec mailserver_ldap /bin/sh -c \"openssl s_client -ign_eof -connect 0.0.0.0:993 < /tmp/tests/sieve/trigger-spam-ham-learning.txt\"\n\n\t# Wait until all mails have been processed\n\tsleep 10\n\nrun:\n\t./test/bats/bin/bats test/tests.bats\n\nclean:\n\tdocker images --quiet --filter=dangling=true | xargs --no-run-if-empty docker rmi\n\tdocker volume ls -qf dangling=true | xargs -r docker volume rm\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 52.388671875,
          "content": ":warning:\n\n# This docker image is no longer maintained.\n\n:warning:\n\n## hardware/mailserver\n\n### Chat & questions\n\n[![](https://badges.gitter.im/hardware-mailserver/Lobby.svg)](https://gitter.im/hardware-mailserver/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)\n\n### Build\n\n[![](https://travis-ci.org/hardware/mailserver.svg?branch=master)](https://travis-ci.org/hardware/mailserver) [![](https://images.microbadger.com/badges/version/hardware/mailserver:1.1-latest.svg)](https://microbadger.com/images/hardware/mailserver:1.1-latest)\n\n### Docker image\n\n[![](https://images.microbadger.com/badges/image/hardware/mailserver:1.1-latest.svg)](https://microbadger.com/images/hardware/mailserver:1.1-latest) [![](https://img.shields.io/docker/automated/hardware/mailserver.svg)](https://hub.docker.com/r/hardware/mailserver/builds/) [![](https://img.shields.io/docker/pulls/hardware/mailserver.svg)](https://hub.docker.com/r/hardware/mailserver/) [![](https://img.shields.io/docker/stars/hardware/mailserver.svg)](https://hub.docker.com/r/hardware/mailserver/) [![](https://img.shields.io/badge/bitcoin-donate-green.svg)](https://keybase.io/hardware)\n\n**hardware/mailserver** is a simple and full-featured mail server build as a set of multiple docker images, including:\n\n- **Postfix** : a full-set smtp email server\n- **Dovecot** : secure IMAP and POP3 email server\n- **Rspamd** : anti-spam filter with SPF, DKIM, DMARC, ARC, ratelimit and greylisting capabilities\n- **Clamav** : antivirus with automatic updates and third-party signature databases\n- **Zeyple** : automatic GPG encryption of all your emails\n- **Sieve** : email filtering (vacation auto-responder, auto-forward, etc...)\n- **Fetchmail** : fetch emails from external IMAP/POP3 server into local mailbox\n- **Rainloop** : web based email client\n- **Postfixadmin** : web-based administration interface\n- **Unbound**: recursive caching DNS resolver with DNSSEC support\n- **NSD** : authoritative DNS server with DNSSEC support\n- **Træfik** : modern HTTP reverse proxy\n- **SSL** : _let's encrypt_ with auto-renewal (SAN and wildcard certificates), custom and self-signed certificates support\n- **OpenLDAP** : [BETA] ldap support available (only in `1.1-latest` for now)\n- Supporting multiple virtual domains over MySQL/PostgreSQL backend\n- Integration tests with Travis CI\n- Automated builds on DockerHub\n\n### Summary\n\n- [hardware/mailserver](#hardwaremailserver)\n  - [Chat & questions](#chat--questions)\n  - [Build](#build)\n  - [Docker image](#docker-image)\n  - [Summary](#summary)\n  - [System Requirements](#system-requirements)\n    - [With MariaDB/PostgreSQL and Redis on the same host](#with-mariadbpostgresql-and-redis-on-the-same-host)\n    - [With MariaDB/PostgreSQL and Redis hosted on another server](#with-mariadbpostgresql-and-redis-hosted-on-another-server)\n  - [Prerequisites](#prerequisites)\n    - [Cleaning](#cleaning)\n    - [Ports](#ports)\n    - [DNS setup](#dns-setup)\n    - [DNS records and reverse PTR](#dns-records-and-reverse-ptr)\n    - [Testing](#testing)\n  - [Installation](#installation)\n    - [1 - Prepare your environment](#1---prepare-your-environment)\n    - [2 - Postfixadmin installation](#2---postfixadmin-installation)\n    - [3 - Rainloop installation (optional)](#3---rainloop-installation-optional)\n    - [4 - Done, congratulation ! :tada:](#4---done-congratulation--tada)\n  - [Rancher Catalog](#rancher-catalog)\n  - [Ansible Playbooks](#ansible-playbooks)\n  - [Environment variables](#environment-variables)\n  - [Automatic GPG encryption of all your emails](#automatic-gpg-encryption-of-all-your-emails)\n    - [How does it work ?](#how-does-it-work-)\n    - [Enable automatic GPG encryption](#enable-automatic-gpg-encryption)\n    - [Import your public key](#import-your-public-key)\n    - [Import all recipients public keys](#import-all-recipients-public-keys)\n    - [Specify another gpg keyserver](#specify-another-gpg-keyserver)\n    - [Run other GPG options](#run-other-gpg-options)\n  - [Relaying from other networks](#relaying-from-other-networks)\n  - [SSL certificates](#ssl-certificates)\n    - [Let's Encrypt certificates generated by Traefik](#lets-encrypt-certificates-generated-by-traefik)\n    - [Custom certificates](#custom-certificates)\n    - [Testing](#testing-1)\n  - [MTA-STS](#mta-sts)\n  - [Third-party clamav signature databases](#third-party-clamav-signature-databases)\n    - [Required Ports](#required-ports)\n    - [Enable clamav-unofficial-sigs](#enable-clamav-unofficial-sigs)\n  - [Unbound DNS resolver](#unbound-dns-resolver)\n  - [PostgreSQL support](#postgresql-support)\n  - [LDAP support](#ldap-support)\n  - [IPv6 support](#ipv6-support)\n  - [Persistent files and folders in /mnt/docker/mail Docker volume](#persistent-files-and-folders-in-mntdockermail-docker-volume)\n  - [Override postfix configuration](#override-postfix-configuration)\n  - [Custom configuration for dovecot](#custom-configuration-for-dovecot)\n  - [Postfix blacklist](#postfix-blacklist)\n  - [Email client settings](#email-client-settings)\n  - [Components](#components)\n  - [Migration from 1.0 to 1.1](#migration-from-10-to-11)\n  - [Community projects](#community-projects)\n  - [Some useful Thunderbird extensions](#some-useful-thunderbird-extensions)\n  - [Donation](#donation)\n\n### System Requirements\n\nPlease check, if your system meets the following minimum requirements :\n\n#### With MariaDB/PostgreSQL and Redis on the same host\n\n| Type | Without ClamAV | With ClamAV |\n| ---- | -------------- | ----------- |\n| CPU | 1 GHz | 1 GHz |\n| RAM | 1.5 GiB | 2 GiB |\n\n#### With MariaDB/PostgreSQL and Redis hosted on another server\n\n| Type | Without ClamAV | With ClamAV |\n| ---- | -------------- | ----------- |\n| CPU | 1 GHz | 1 GHz |\n| RAM | 512 MiB | 1 GiB |\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Prerequisites\n\n#### Cleaning\n\nPlease remove any web server and mail services running on your server. I recommend using a clean installation of your prefered distro. If you are using Debian, remember to remove the default MTA **Exim4** :\n\n```\n# apt-get purge exim4*\n```\n\nAlso make sure that no other application is interfering with mail server configuration :\n\n```\n# netstat -tulpn | grep -E -w '25|80|110|143|443|465|587|993|995|4190'\n```\n\nIf this command returns any results please remove or stop the application running on that port.\n\n#### Ports\n\nIf you have a firewall, unblock the following ports, according to your needs :\n\n| Service | Software | Protocol | Port |\n| ------- | -------- | -------- | ---- |\n| SMTP | Postfix | TCP | 25 |\n| HTTP | Nginx | TCP | 80 |\n| POP3 | Dovecot | TCP | 110 |\n| IMAP | Dovecot | TCP | 143 |\n| HTTPS | Nginx | TCP | 443 |\n| SMTPS | Postfix | TCP | 465 |\n| Submission | Postfix | TCP | 587 |\n| IMAPS | Dovecot | TCP | 993 |\n| POP3S | Dovecot | TCP | 995 |\n| ManageSieve | Dovecot | TCP | 4190 |\n\n#### DNS setup\n\nI recommend you to use [hardware/nsd-dnssec](https://github.com/hardware/nsd-dnssec) as an authoritative name server with DNSSEC capabilities. NSD is an authoritative only, high performance, simple and open source name server.\n\n#### DNS records and reverse PTR\n\nA correct DNS setup is required, this step is very important.\n\n| HOSTNAME | CLASS | TYPE | PRIORITY | VALUE |\n| -------- | ----- | ---- | -------- | ----- |\n| mail | IN | A/AAAA | any | 1.2.3.4 |\n| spam | IN | CNAME | any | mail.domain.tld. |\n| webmail | IN | CNAME | any | mail.domain.tld. |\n| postfixadmin | IN | CNAME | any | mail.domain.tld. |\n| @ | IN | MX | 10 | mail.domain.tld. |\n| @ | IN | TXT | any | \"v=spf1 a mx ip4:SERVER_IPV4 ~all\" |\n| mail._domainkey | IN | TXT | any | \"v=DKIM1; k=rsa; p=YOUR DKIM Public Key\" |\n| _dmarc | IN | TXT | any | \"v=DMARC1; p=reject; rua=mailto:postmaster@domain.tld; ruf=mailto:admin@domain.tld; fo=0; adkim=s; aspf=s; pct=100; rf=afrf; sp=reject\" |\n\n**Notes:**\n\n* Make sure that the **PTR record** of your IP matches the FQDN (default : mail.domain.tld) of your mailserver host. This record is usually set in your web hosting interface.\n* DKIM, SPF and DMARC records are recommended to build a good reputation score.\n* The DKIM public key will be available on host after the container startup :\n\n```\n/mnt/docker/mail/dkim/domain.tld/public.key\n```\n\nTo regenerate your public and private keys, remove the `/mnt/docker/mail/dkim/domain.tld` folder. By default a **1024-bit** key is generated, you can increase this size by setting the `OPENDKIM_KEY_LENGTH` environment variable with a higher value. Check your domain registrar support to verify that it supports a TXT record long enough for a key larger than 1024 bits.\n\nThese DNS record will raise your trust reputation score and reduce abuse of your domain name. You can find more information here :\n\n* http://www.openspf.org/\n* http://www.opendkim.org/\n* https://dmarc.org/\n* http://arc-spec.org/\n\n#### Testing\n\nYou can audit your mailserver with the following assessment services :\n\n* https://www.mail-tester.com/\n* https://www.hardenize.com/\n* https://observatory.mozilla.org/\n* https://www.emailprivacytester.com/ (MUA side)\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Installation\n\n#### 1 - Prepare your environment\n\n:bulb: The reverse proxy used in this setup is [Traefik](https://traefik.io/), but you can use the solution of your choice (Nginx, Apache, Haproxy, Caddy, H2O...etc).\n\n:warning: This docker image may not work with some hardened Linux distribution using security-enhancing kernel patches like GrSecurity, please use a [supported platform](https://docs.docker.com/install/#supported-platforms).\n\n```bash\n# Create a new docker network for Traefik (IPv4 only)\ndocker network create http_network\n# If you want to support IPv6, please refer to [IPv6 support]\n\n# Create the required folders and files\nmkdir -p /mnt/docker/traefik/acme && cd /mnt/docker \\\n&& curl https://raw.githubusercontent.com/hardware/mailserver/master/docker-compose.sample.yml -o docker-compose.yml \\\n&& curl https://raw.githubusercontent.com/hardware/mailserver/master/sample.env -o .env \\\n&& curl https://raw.githubusercontent.com/hardware/mailserver/master/traefik.sample.toml -o traefik/traefik.toml \\\n&& touch traefik/acme/acme.json \\\n&& chmod 600 docker-compose.yml .env traefik/traefik.toml traefik/acme/acme.json\n```\n\nEdit the `.env` and `traefik.toml`, adapt to your needs, then start all services :\n\n```\ndocker-compose up -d\n```\n\n#### 2 - Postfixadmin installation\n\nPostfixAdmin is a web based interface used to manage mailboxes, virtual domains and aliases.\n\n* Docker image : https://github.com/hardware/postfixadmin\n* How to setup : [Postfixadmin initial configuration](https://github.com/hardware/mailserver/wiki/Postfixadmin-initial-configuration)\n\n#### 3 - Rainloop installation (optional)\n\nRainloop is a simple, modern and fast webmail with Sieve scripts support (filters and vacation message), GPG and a modern user interface.\n\n* Docker image : https://github.com/hardware/rainloop\n* How to setup : [Rainloop initial configuration](https://github.com/hardware/mailserver/wiki/Rainloop-initial-configuration)\n\n#### 4 - Done, congratulation ! :tada:\n\nAt first launch, the container takes few minutes to generate SSL certificates (if needed), DKIM keypair and update clamav database, all of this takes some time (1/2 minutes). This image comes with a snake-oil self-signed certificate, please use your own trusted certificates. [See below](https://github.com/hardware/mailserver#ssl-certificates) for configuration.\n\n**List of webservices available:**\n\n| Service | URI |\n| ------- | --- |\n| **Traefik dashboard** | https://mail.domain.tld/ |\n| **Rspamd dashboard** | https://spam.domain.tld/ |\n| **Administration** | https://postfixadmin.domain.tld/ |\n| **Webmail** | https://webmail.domain.tld/ |\n\nTraefik dashboard use a basic authentication (user:admin, password:12345), the password can be encoded in MD5, SHA1 and BCrypt. You can use [htpasswd ](https://httpd.apache.org/docs/2.4/programs/htpasswd.html) to generate those ones. Users can be specified directly in the `traefik.toml` file. Rspamd dashboard use the password defined in your `docker-compose.yml`.\n\nYou can check the startup logs with this command :\n\n```\n# docker logs -f mailserver\n\n[INFO] Let's encrypt live directory found\n[INFO] Using /etc/letsencrypt/live/mail.domain.tld folder\n[INFO] Creating DKIM keys for domain domain.tld\n[INFO] Database hostname found in /etc/hosts\n[INFO] Fetchmail forwarding is enabled.\n[INFO] Automatic GPG encryption is enabled.\n[INFO] ManageSieve protocol is enabled.\n[INFO] POP3 protocol is enabled.\n-------------------------------------------------------------------------------------\n2017-08-26T11:06:58.885562+00:00 mail root: s6-supervise : spawning clamd process\n2017-08-26T11:06:59.059077+00:00 mail root: s6-supervise : spawning freshclam process\n2017-08-26T11:06:59.395214+00:00 mail root: s6-supervise : spawning rspamd process\n2017-08-26T11:07:01.615597+00:00 mail root: s6-supervise : spawning unbound process\n2017-08-26T11:07:01.870856+00:00 mail root: s6-supervise : spawning postfix process\n2017-08-26T11:07:03.303536+00:00 mail root: s6-supervise : spawning dovecot process\n...\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Rancher Catalog\n\n![rancher-logo](https://i.imgur.com/R9AArJN.png)\n\nhttps://github.com/hardware/mailserver-rancher\n\nThis catalog provides a basic template to easily deploy an email server based on [hardware/mailserver](https://github.com/hardware/mailserver) very quickly. To use it, just add this repository to your Rancher system as a catalog in `Admin > Settings` page and follow [the readme](https://github.com/hardware/mailserver-rancher/blob/master/README.md). This catalog has been initiated by [@MichelDiz](https://github.com/MichelDiz).\n\n![rancher-ui](https://i.imgur.com/kdJxAiN.png)\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Ansible Playbooks\n\n![logo](https://i.imgur.com/tvTG8pN.png)\n\nIf you use Ansible, I recommend you to go to see [@ksylvan](https://github.com/ksylvan) playbooks here : https://github.com/ksylvan/docker-mail-server\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Environment variables\n\n| Variable | Description | Type | Default value |\n| -------- | ----------- | ---- | ------------- |\n| **VMAILUID** | vmail user id | *optional* | 1024\n| **VMAILGID** | vmail group id | *optional* | 1024\n| **VMAIL_SUBDIR** | Individual mailbox' subdirectory | *optional* | mail\n| **OPENDKIM_KEY_LENGTH** | Size of your DKIM RSA key pair | *optional* | 1024\n| **DEBUG_MODE** | Enable Postfix, Dovecot, Rspamd and Unbound verbose logging | *optional* | false\n| **PASSWORD_SCHEME** | Passwords encryption scheme | *optional* | `SHA512-CRYPT`\n| **DBDRIVER** | Database type: mysql, pgsql, ldap | *optional* | mysql\n| **DBHOST** | Database instance ip/hostname | *optional* | mariadb\n| **DBPORT** | Database instance port | *optional* | 3306 / 389 (sql/ldap)\n| **DBUSER** | Database username | *optional* | postfix\n| **DBNAME** | Database name | *optional* | postfix\n| **DBPASS** | Database password or location of a file containing it | **required** *\\*1)* | null\n| **REDIS_HOST** | Redis instance ip/hostname | *optional*  | redis\n| **REDIS_PORT** | Redis instance port | *optional*  | 6379\n| **REDIS_PASS** | Redis database password or location of a file containing it | *optional* | null\n| **REDIS_NUMB** | Redis database number | *optional* | 0\n| **RSPAMD_PASSWORD** | Rspamd WebUI and controller password or location of a file containing it | **required** | null\n| **ADD_DOMAINS** | Add additional domains to the mailserver separated by commas (needed for dkim keys etc.) | *optional* | null\n| **RELAY_NETWORKS** | Additional IPs or networks the mailserver relays without authentication | *optional* | null\n| **WHITELIST_SPAM_ADDRESSES** | List of whitelisted email addresses separated by commas | *optional* | null\n| **DISABLE_RSPAMD_MODULE** | List of disabled modules separated by commas | *optional* | null\n| **DISABLE_CLAMAV** | Disable virus scanning | *optional* | false\n| **DISABLE_SIEVE** | Disable ManageSieve protocol | *optional* | false\n| **DISABLE_SIGNING** | Disable DKIM/ARC signing | *optional* | false\n| **DISABLE_GREYLISTING** | Disable greylisting policy | *optional* | false\n| **DISABLE_RATELIMITING** | Disable ratelimiting policy | *optional* | true\n| **DISABLE_DNS_RESOLVER** | Disable the local DNS resolver | *optional* | false\n| **DISABLE_SSL_WATCH** | Disable watching of `acme.json` and the Let's Encrypt directory | *optional* | false\n| **ENABLE_POP3** | Enable POP3 protocol | *optional* | false\n| **ENABLE_FETCHMAIL** | Enable fetchmail forwarding | *optional* | false\n| **ENABLE_ENCRYPTION** | Enable automatic GPG encryption | *optional* | false\n| **FETCHMAIL_INTERVAL** | Fetchmail polling interval | *optional* | 10\n| **RECIPIENT_DELIMITER** | RFC 5233 subaddress extension separator (single character only) | *optional* | +\n\n\\*1) **DBPASS** is NOT required when using LDAP authentication\n\n* Use **DEBUG_MODE** to enable the debug mode. Switch to `true` to enable verbose logging for `postfix`, `dovecot`, `rspamd` and `Unbound`. To debug components separately, use this syntax : `DEBUG_MODE=postfix,rspamd`.\n* **VMAIL_SUBDIR** is the mail location subdirectory name `/var/mail/vhosts/%domain/%user/$subdir`. For more information, read this : https://wiki.dovecot.org/VirtualUsers/Home\n* **PASSWORD_SCHEME** for compatible schemes, read this : https://wiki.dovecot.org/Authentication/PasswordSchemes\n* Currently, only a single **RECIPIENT_DELIMITER** is supported. Support for multiple delimiters will arrive with Dovecot v2.3.\n* **FETCHMAIL_INTERVAL** must be a number between **1** and **59** minutes.\n* Use **DISABLE_DNS_RESOLVER** if you have some DNS troubles and DNSSEC lookup issues with the local DNS resolver.\n* Use **DISABLE_RSPAMD_MODULE** to disable any module listed here : https://rspamd.com/doc/modules/\n\n\nWhen using LDAP authentication the following additional variables become available. All *DBUSER*, *DBNAME* and *DBPASS* variables will not be used in this case:\n\n| Variable | Description | Type | Default value |\n| -------- | ----------- | ---- | ------------- |\n| **LDAP_TLS_ENABLED** | Enable TLS on LDAP | *optional* | false\n| **LDAP_TLS_CA_FILE** | The TLS CA File | **required** if **LDAP_TLS_ENABLED** |\n| **LDAP_TLS_FORCE** | Force TLS connections | **required** if **LDAP_TLS_ENABLED** | false\n| **LDAP_BIND** | Bind to LDAP Server | *optional* | true\n| **LDAP_BIND_DN** | The DN to bind to | **required** if **LDAP_BIND** |\n| **LDAP_BIND_PW** | LDAP password or location of a file containing it | **required** if **LDAP_BIND** |\n| **LDAP_DEFAULT_SEARCH_BASE** | The base DN for all lookus | **required** |\n| **LDAP_DEFAULT_SEARCH_SCOPE** | The default scope for all lookups (sub, base or one) | *optional* | sub\n| **LDAP_DOMAIN_SEARCH_BASE** | The search base for domain lookups | *optional* | ${LDAP_DEFAULT_SEARCH_BASE}\n| **LDAP_DOMAIN_SEARCH_SCOPE** | The search scope for domain lookups | *optional* | ${LDAP_DEFAULT_SEARCH_SCOPE}\n| **LDAP_DOMAIN_FILTER** | The search filter for domain lookups | **required** |\n| **LDAP_DOMAIN_ATTRIBUTE** | The attibutes for domain lookup | **required** |\n| **LDAP_DOMAIN_FORMAT** | The format for domain lookups | *optional* |\n| **LDAP_MAILBOX_SEARCH_BASE** | The search base for mailbox lookups | *optional* | ${LDAP_DEFAULT_SEARCH_BASE}\n| **LDAP_MAILBOX_SEARCH_SCOPE** | The search scope for mailbox lookups | *optional* | ${LDAP_DEFAULT_SEARCH_SCOPE}\n| **LDAP_MAILBOX_FILTER** | The search filter for mailbox lookups | **required** |\n| **LDAP_MAILBOX_ATTRIBUTE** | The attibutes for mailbox lookup | **required** |\n| **LDAP_MAILBOX_FORMAT** | The format for domain mailbox | *optional* |\n| **LDAP_ALIAS_SEARCH_BASE** | The search base for domain lookups | *optional* | ${LDAP_DEFAULT_SEARCH_BASE}\n| **LDAP_ALIAS_SEARCH_SCOPE** | The search scope for domain lookups | *optional* | ${LDAP_DEFAULT_SEARCH_SCOPE}\n| **LDAP_ALIAS_FILTER** | The search filter for domain lookups | **required** |\n| **LDAP_ALIAS_ATTRIBUTE** | The attibutes for domain lookup | **required** |\n| **LDAP_ALIAS_FORMAT** | The format for domain lookups | *optional* |\n| **LDAP_FORWARD_SEARCH_BASE** | The search base for forward lookups | *optional* | ${LDAP_DEFAULT_SEARCH_BASE}\n| **LDAP_FORWARD_SEARCH_SCOPE** | The search scope for forward lookups | *optional* | ${LDAP_DEFAULT_SEARCH_SCOPE}\n| **LDAP_FORWARD_FILTER** | The search filter for forward lookups | *optional* |\n| **LDAP_FORWARD_ATTRIBUTE** | The attibutes for forward lookup | *optional* |\n| **LDAP_FORWARD_FORMAT** | The format for forward lookups | *optional* |\n| **LDAP_GROUP_SEARCH_BASE** | The search base for group lookups | *optional* | ${LDAP_DEFAULT_SEARCH_BASE}\n| **LDAP_GROUP_SEARCH_SCOPE** | The search scope for group lookups | *optional* | ${LDAP_DEFAULT_SEARCH_SCOPE}\n| **LDAP_GROUP_FILTER** | The search filter for group lookups | *optional* |\n| **LDAP_GROUP_ATTRIBUTE** | The attibutes for group lookup | *optional* |\n| **LDAP_GROUP_FORMAT** | The format for group lookups | *optional* |\n| **LDAP_SENDER_SEARCH_BASE** | The search base for sender lookups | *optional* | ${LDAP_DEFAULT_SEARCH_BASE}\n| **LDAP_SENDER_SEARCH_SCOPE** | The search scope for sender lookups | *optional* | ${LDAP_DEFAULT_SEARCH_SCOPE}\n| **LDAP_SENDER_FILTER** | The search filter for sender lookups | **required** |\n| **LDAP_SENDER_ATTRIBUTE** | The attibutes for sender lookup | **required** |\n| **LDAP_SENDER_FORMAT** | The format for sender lookups | **required** |\n| **LDAP_DOVECOT_USER_ATTRS** | Dovecot user attribute mapping | **required** |\n| **LDAP_DOVECOT_USER_FILTER** | Dovecot user search filter | **required** |\n| **LDAP_DOVECOT_PASS_ATTRS** | Dovecot user password attribute mapping | **required** |\n| **LDAP_DOVECOT_PASS_FILTER** | Dovecot user password filter | **required** |\n| **LDAP_DOVECOT_ITERATE_ATTRS** | Dovecot user iterate attributes | *optional* |\n| **LDAP_DOVECOT_ITERATE_FILTER** | Dovecot user iterate filters | *optional* |\n| **LDAP_MASTER_USER_ENABLED** | Enable LDAP master users | *optional* | false\n| **LDAP_MASTER_USER_SEPARATOR** | LDAP master user seperator | **required** if **LDAP_MASTER_USER_ENABLED** | \\*\n| **LDAP_MASTER_USER_SEARCH_BASE** | LDAP master user search base | **required** if **LDAP_MASTER_USER_ENABLED** | ${LDAP_DEFAULT_SEARCH_BASE}\n| **LDAP_MASTER_USER_SEARCH_SCOPE** | LDAP master user scope | **required** if **LDAP_MASTER_USER_ENABLED** | ${LDAP_DEFAULT_SEARCH_SCOPE}\n| **LDAP_DOVECOT_MASTER_USER_ATTRS** | LDAP master user dovecot attributes | **required** if **LDAP_MASTER_USER_ENABLED** |\n| **LDAP_DOVECOT_MASTER_USER_FILTER** | LDAP master user dovecot search filter | **required** if **LDAP_MASTER_USER_ENABLED** |\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Automatic GPG encryption of all your emails\n\n#### How does it work ?\n\n[Zeyple](https://infertux.com/labs/zeyple/) catches email from the postfix queue, then encrypts it if a corresponding recipient's GPG public key is found. Finally, it puts it back into the queue.\n\n![zeyple](https://i.imgur.com/gGQZL4V.png)\n\n#### Enable automatic GPG encryption\n\n:heavy_exclamation_mark: **Please enable this option carefully and only if you know what you are doing.**\n\nSwitch `ENABLE_ENCRYPTION` environment variable to `true`. The public keyring will be saved in `/var/mail/zeyple/keys`.\nPlease don't change the default value of `RECIPIENT_DELIMITER` (default = \"+\"). If encryption is enabled with another delimiter, Zeyple could have an unpredictable behavior.\n\n#### Import your public key\n\n:warning: Make sure to send your public key on a gpg keyserver before to run the following command.\n\n```\ndocker exec -ti mailserver encryption.sh import-key YOUR_KEY_ID\n```\n\n#### Import all recipients public keys\n\nThis command browses all `/var/mail/vhosts/*` domains directories and users subdirectories to find all the recipients addresses in the mailserver.\n\n```\ndocker exec -ti mailserver encryption.sh import-all-keys\n```\n\n#### Specify another gpg keyserver\n\n```\ndocker exec -ti mailserver encryption.sh import-key YOUR_KEY_ID hkp://pgp.mit.edu\ndocker exec -ti mailserver encryption.sh import-all-keys hkp://keys.gnupg.net\n```\n\n#### Run other GPG options\n\nYou can use all options of gpg command line except an already assigned parameter called `--homedir`.\n\n\n```bash\ndocker exec -ti mailserver encryption.sh --list-keys\ndocker exec -ti mailserver encryption.sh --fingerprint\ndocker exec -ti mailserver encryption.sh --refresh-keys\ndocker exec -ti mailserver encryption.sh ...\n```\n\nDocumentation : https://www.gnupg.org/documentation/manuals/gnupg/Operational-GPG-Commands.html\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Relaying from other networks\n\nThe **RELAY_NETWORKS** is a space separated list of additional IP addresses and subnets (in CIDR notation) which the mailserver relays without authentication. Hostnames are possible, but generally disadvised. IPv6 addresses must be surrounded by square brackets. You can also specify an absolut path to a file with IPs and networks so you can keep it on a mounted volume. Note that the file is not monitored for changes.\n\nYou can use this variable to allow other local containers to relay via the mailserver. Typically you would set this to the IP range of the default docker bridge (172.17.0.0/16) or the default network of your compose. If you are unable to determine, you might just add all RFC 1918 addresses `192.168.0.0/16 172.16.0.0/12 10.0.0.0/8`\n\n:warning: A value like `0.0.0.0/0` will turn your mailserver into an open relay!\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### SSL certificates\n\n#### Let's Encrypt certificates generated by Traefik\n\nTo use Let's Encrypt certificates generated by Traefik, mount a new docker volume like this :\n\n```yml\nmailserver:\n  image: hardware/mailserver\n  volumes:\n    - /mnt/docker/traefik/acme:/etc/letsencrypt/acme\n    ...\n```\n\nThe startup script read the `acme.json`* file generated by Traefik and split into pem files all appropriate certificates (CN = mail.domain.tld).\n\n:bulb: *Compatible with both Traefik `>=1.5.0` and `1.6+` ACME json format, with **SAN** and **wildcard** certificates support.\n\n```\ndocker logs -f mailserver\n\n[INFO] Search for SSL certificates generated by Traefik\n[INFO] acme.json found with ACME v2 format, dumping into pem files\n[INFO] Let's encrypt live directory found\n[INFO] Using /etc/letsencrypt/live/mail.domain.tld folder\n```\n\nDon't forget to add a new traefik frontend rule somewhere in your docker-compose.yml to generate a certificate for your mailserver FQDN (default : mail.domain.tld) subdomain.\n\n```yml\n# docker-compose.yml\n\nlabels:\n  - traefik.frontend.rule=Host:mail.${DOMAIN}\n```\n\nAlternatively, you can specify your domains in the `traefik.toml` to generate a SAN certificate :\n\n```toml\n[acme]\nonHostRule = false\n\n[[acme.domains]]\nmain = \"domain.tld\"\nsans = [\"mail.domain.tld\", \"spam.domain.tld\", \"postfixadmin.domain.tld\", \"webmail.domain.tld\"]\n```\n\nOr a wildcard certificate :\n\n:warning: ACME wildcard certificates can only be generated thanks to a `DNS-01` challenge.\n\n```toml\n[acme]\nonHostRule = false\n\n# https://docs.traefik.io/v1.6/configuration/acme/#dnschallenge\n[acme.dnsChallenge]\nprovider = \"your_dns_provider\"\ndelayBeforeCheck = 0\n\n[[acme.domains]]\nmain = \"*.domain.tld\"\n```\n\nIf the startup script does not find the appropriate SSL certificate and private key, look at Traefik's logs to see what's going on.\n\n```\ndocker logs -f mailserver\n\n[INFO] Search for SSL certificates generated by Traefik\n[INFO] ...\n[INFO] ...\n[INFO] acme.json found with ACME v2 format, dumping into pem files\n[ERROR] The certificate for mail.domain.tld or the private key was not found !\n[INFO] Don't forget to add a new traefik frontend rule to generate a certificate for mail.domain.tld subdomain\n[INFO] Look /mnt/docker/traefik/acme/dump.log and 'docker logs traefik' for more information\n```\n\n```toml\n# traefik.toml\n\n[acme]\nacmeLogging = true\n```\n\n```\ndocker-compose restart traefik && docker logs -f traefik\n```\n\n#### Custom certificates\n\nYou can use Let's Encrypt or any other certification authority. Setup your `docker-compose.yml` like this :\n\n```yml\nmailserver:\n  image: hardware/mailserver\n  volumes:\n    - /mnt/docker/ssl:/etc/letsencrypt\n    ...\n```\n\nRequest your certificates in `/mnt/docker/ssl/live/mail.domain.tld` with an [ACME client](https://letsencrypt.org/docs/client-options/) if you use Let's Encrypt, otherwise get your SSL certificates with the method provided by your CA and put everything needed in this directory.\n\nRequired files in this folder :\n\n:bulb: If you only have the fullchain.pem and privkey.pem, the startup script extract automatically the cert.pem and chain.pem from fullchain.pem.\n\n| Filename | Description |\n|----------|-------------|\n| privkey.pem | Private key for the certificate |\n| cert.pem | Server certificate only |\n| chain.pem | Root and intermediate certificates only, excluding server certificate |\n| fullchain.pem | All certificates, including server certificate. This is concatenation of cert.pem and chain.pem |\n\nExample with [acme.sh](https://acme.sh) :\n\n```bash\nacme.sh --install-cert -d example.com \\\n--ca-file        ${VOLUMES_ROOT_PATH}/ssl/live/mail.domain.tld/chain.pem  \\\n--cert-file      ${VOLUMES_ROOT_PATH}/ssl/live/mail.domain.tld/cert.pem  \\\n--key-file       ${VOLUMES_ROOT_PATH}/ssl/live/mail.domain.tld/privkey.pem  \\\n--fullchain-file ${VOLUMES_ROOT_PATH}/ssl/live/mail.domain.tld/fullchain.pem \\\n--reloadcmd      \"docker restart mailserver\"\n```\n\n**Notes** :\n\n* Important : When renewing certificates, you must restart the mailserver container.\n\n* If you do not use your own trusted certificates or those generated by Traefik, a default self-signed certificate (RSA 4096 bits SHA2) is added here : `/mnt/docker/mail/ssl/selfsigned/{cert.pem, privkey.pem}`.\n\n* If you have generated a ECDSA certificate with a curve other than `prime256v1` (NIST P-256), you need to change the Postfix TLS configuration because of a change in OpenSSL >= 1.1.0. For example, if you use `secp384r1` elliptic curve with your ECDSA certificate, change the `tls_eecdh_strong_curve` value :\n\n```ini\n# /mnt/docker/mail/postfix/custom.conf\n\ntls_eecdh_strong_curve = secp384r1\n```\n\nAdditional informations about this issue :\n\n* https://github.com/openssl/openssl/issues/2033\n* https://bugzilla.redhat.com/show_bug.cgi?id=1473971\n\n#### Testing\n\n```bash\n# IMAP STARTTLS - 143 port (IMAP)\nopenssl s_client -connect mail.domain.tld:143 -starttls imap -tlsextdebug\n\n# SMTP STARTTLS - 587 port (Submission)\nopenssl s_client -connect mail.domain.tld:587 -starttls smtp -tlsextdebug\n\n# IMAP SSL/TLS - 993 port (IMAPS)\nopenssl s_client -connect mail.domain.tld:993 -tlsextdebug\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### MTA-STS\n\nMTA-STS is a new standard that makes it possible to send downgrade-resistant email over SMTP. In that sense, it is like an alternative to DANE but it does this by piggybacking on the browser Certificate Authority model, not DNSSEC.\n\nTo enable Strict Transport Security on your mailserver configure the following things :\n\n1. Add a TLSRPT DNS TXT record at `_smtp._tls` on your domain, e.g. `_smtp._tls.domain.tld`, with something like `v=TLSRPTv1; rua=mailto:postmaster@domain.tld`.\n2. Add a MTA-STS DNS TXT record at `_mta-sts` on your domain, e.g. `_mta-sts.domain.tld`, with something like `v=STSv1; id=2018072801`.\n3. Add a subdomain `mta-sts` to your domain (note the lack of an underscore) and serve a policy file on `https://mta-sts.domain.tld/.well-known/mta-sts.txt`.\n\nHere is an example policy file:\n\n```\nversion: STSv1\nmode: enforce\nmax_age: 10368000\nmx: mail.domain.tld\n```\n\nTest your mail domain using a MTA-STS validator like [Hardenize](https://www.hardenize.com). You can also add your domain name in the [STARTTLS Policy List](https://starttls-everywhere.org/) maintained by [EFF](https://www.eff.org/).\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Third-party clamav signature databases\n\n[Clamav-unofficial-sigs](https://github.com/extremeshok/clamav-unofficial-sigs) provides a simple way to download and update third-party signature databases provided by Sanesecurity, FOXHOLE, OITC, Scamnailer, BOFHLAND, CRDF, Porcupine, Securiteinfo, MalwarePatrol, Yara-Rules Project, etc.\n\nReadme : https://github.com/extremeshok/clamav-unofficial-sigs\n\n#### Required Ports\n\n| Software | Protocol | Port |\n| -------- | -------- | ---- |\n| Rsync | TCP | 873 |\n| Curl | TCP | 443 |\n\n#### Enable clamav-unofficial-sigs\n\nCreate your `user.conf` file under `/mnt/docker/mail/clamav-unofficial-sigs` directory to configure clamav-unofficial-sigs updater. This file override the default configuration specified in [os.conf](https://github.com/hardware/mailserver/blob/master/rootfs/etc/clamav/unofficial-sigs/os.conf) and [master.conf](https://github.com/hardware/mailserver/blob/master/rootfs/etc/clamav/unofficial-sigs/master.conf). Don't forget, once you have completed the configuration of this file, set the value of `user_configuration_complete` to `yes` otherwise the script will not be able to execute.\nAs [Yara rules are broken with clamav ≥ 0.100](https://github.com/extremeshok/clamav-unofficial-sigs/issues/203), we disable Yara rules for now.\n\n```ini\n# /mnt/docker/mail/clamav-unofficial-sigs/user.conf\n\n# =========================\n# MalwarePatrol : https://www.malwarepatrol.net\n# MalwarePatrol 2016 (free) clamav signatures\n#\n# 1. Sign up for an account : https://www.malwarepatrol.net/signup-free.shtml\n# 2. You will receive an email containing your password/receipt number\n# 3. Login to your account at malwarePatrol\n# 4. In My Accountpage, choose the ClamAV list you will download. Free subscribers only get ClamAV Basic, commercial subscribers have access to ClamAV Extended. Do not use the agressive lists.\n# 5. In the download URL, you will see 3 parameters: receipt, product and list, enter them in the variables below.\n# malwarepatrol_receipt_code=\"YOUR-RECEIPT-NUMBER\"\n# malwarepatrol_product_code=\"8\"\n# malwarepatrol_list=\"clamav_basic\"\n# malwarepatrol_free=\"yes\"\n\n# =========================\n# SecuriteInfo : https://www.SecuriteInfo.com\n# SecuriteInfo 2015 free clamav signatures\n#\n# Usage of SecuriteInfo 2015 free clamav signatures : https://www.securiteinfo.com\n# - 1. Sign up for a free account : https://www.securiteinfo.com/clients/customers/signup\n# - 2. You will receive an email to activate your account and then a followup email with your login name\n# - 3. Login and navigate to your customer account : https://www.securiteinfo.com/clients/customers/account\n# - 4. Click on the Setup tab\n# - 5. You will need to get your unique identifier from one of the download links, they are individual for every user\n# - 5.1. The 128 character string is after the http://www.securiteinfo.com/get/signatures/\n# - 5.2. Example https://www.securiteinfo.com/get/signatures/your_unique_and_very_long_random_string_of_characters/securiteinfo.hdb\n#   Your 128 character authorisation signature would be : your_unique_and_very_long_random_string_of_characters\n# - 6. Enter the authorisation signature into the config securiteinfo_authorisation_signature: replacing YOUR-SIGNATURE-NUMBER with your authorisation signature from the link\n# securiteinfo_authorisation_signature=\"YOUR-SIGNATURE-NUMBER\"\n\n# We disable Yara rules for now because they are broken with clamav releases > 0.100\nyararulesproject_enabled=\"no\"\nenable_yararules=\"no\"\n\n# After you have completed the configuration of this file, set the value to \"yes\"\nuser_configuration_complete=\"yes\"\n```\n\nIf the startup script detects this file, clamav-unofficial-sigs is automatically enabled and third-party databases downloaded under `/mnt/docker/mail/clamav` after clamav startup. Once the databases are downloaded, a SIGUSR2 signal is sent to clamav to reload the signature databases :\n\n```\ndocker logs -f mailserver\n\n[INFO] clamav-unofficial-sigs is enabled (user configuration found)\n[...]\ns6-supervise : clamav unofficial signature update running\ns6-supervise : virus database downloaded, spawning clamd process\n[...]\ns6-supervise : clamav unofficial signature update done\nclamd[xxxxxx]: Reading databases from /var/lib/clamav\nclamd[xxxxxx]: Database correctly reloaded (6812263 signatures)\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Unbound DNS resolver\n\nUnbound is a validating, recursive, and caching DNS resolver inside the container, you can control it with the remote server control utility.\n\nSome examples :\n\n```bash\n# Display server status\ndocker exec -ti mailserver unbound-control status\n\n# Print server statistics\ndocker exec -ti mailserver unbound-control stats_noreset\n\n# Reload the server. This flushes the cache and reads the config file.\ndocker exec -ti mailserver unbound-control reload\n```\n\nDocumentation : https://www.unbound.net/documentation/unbound-control.html\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### PostgreSQL support\n\nPostgreSQL can be used instead of MariaDB. You have to make some changes in the original `docker-compose.yml` file to use this DBMS :\n\n```yml\nmailserver:\n  environment:\n    - DBDRIVER=pgsql\n    - DBHOST=postgres\n    - DBPORT=5432\n  depends_on:\n    - postgres\n\npostfixadmin:\n  environment:\n    - DBDRIVER=pgsql\n    - DBHOST=postgres\n    - DBPORT=5432\n  depends_on:\n    - postgres\n\nrainloop:\n  depends_on:\n    - postgres\n\n# Database\n# https://github.com/docker-library/postgres\n# https://postgresql.org/\npostgres:\n  image: postgres:10.5-alpine\n  container_name: postgres\n  restart: ${RESTART_MODE}\n  stop_signal: SIGINT                 # Fast Shutdown mode\n  # Info : These variables are ignored when the volume already exists (if databases was created before).\n  environment:\n    - POSTGRES_DB=postfix\n    - POSTGRES_USER=postfix\n    - POSTGRES_PASSWORD=${DATABASE_USER_PASSWORD}\n  volumes:\n    - ${VOLUMES_ROOT_PATH}/pgsql/db:/var/lib/postgresql/data\n  networks:\n    - mail_network\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### LDAP support\n\nThis mailserver supports LDAP now aswell. Please keep in mind that LDAP itself is an already complicated system and using this mailserver with LDAP will require you to already have a deeper understanding on how LDAP, postfix and dovecot works. Due to the nature of LDAP there is no \"default\" setup you can or is suggested to be used. This means **a lot** of configuration is **required** to set this mailserver up with your LDAP system and it will definetly not work out of the box.\n\nTo enable LDAP you have to set **DBDRIVER** to *ldap*. *DBHOST* and *DBPORT* must point to the LDAP server used. *DBUSER*, *DBNAME*, *DBPASS* enviroment variables will not be used in this case.\n\nIf you want to use TLS set **LDAP_TLS_ENABLED** to *true* and specify a **LDAP_TLS_CA_FILE**. If you want to require the use of TLS set **LDAP_TLS_FORCE** to true.\n\nIf you want to bind to the LDAP server (default) set **LDAP_BIND** to *true* (default) and give your bind user dn (full path) as **LDAP_BIND_DN** and password as **LDAP_BIND_PW**. If a path to a existing file is given in **LDAP_BIND_PW** the content of the file will be used instead.\n\nAll lookups will by default use **LDAP_DEFAULT_SEARCH_BASE** as base and **LDAP_DEFAULT_SEARCH_SCOPE** as scope. But for any query a specific base and scope can be provided aswell. Valid scopes are: *sub* for subtree meaning all nodes below the base. *one* for all direct child nodes of the base and *one* for only the base node itself.\n\nUnlike with postfixadmin where all tables are fixed, this mailserver is intended to work with existing ldap structures. This requires all lookups to be specified by you.\n\nThere are 4 required and 2 optional lookups for postfix that have to be provided by you. Each consists of 5 variables. The loopups are: Domain, Mailbox, Alias and Sender (all 4 required) and Forward and Group (optional). Each has the enviroment variables **LDAP_XXX_SEARCH_BASE**, **LDAP_XXX_SEARCH_SCOPE**, **LDAP_XXX_FILTER**, **LDAP_XXX_ATTRIBUTE** and **LDAP_XXXN_FORMAT** (*optional*) where **XXX*** must be replaced with **DOMAIN**, **MAILBOX**, **ALIAS**, **SENDER**, **FORWARD** or **GROUP**. E.g. **LDAP_DOMAIN_SEARCH_BASE** or **LDAP_MAILBOX_FILTER**\n\nThe **LDAP_XXX_SEARCH_BASE** is the search base dn. It will default to **LDAP_DEFAULT_SEARCH_BASE** as **LDAP_XXX_SEARCH_SCOPE** will default to **LDAP_DEFAULT_SEARCH_SCOPE** (which defaults to *sub*).\n\nThe **LDAP_XXX_FILTER** must be a valid LDAP query filter. For a documentation of LDAP query filters you can look at https://ldap.com/ldap-filters/. For a list of valid replacement tokens please look at http://www.postfix.org/ldap_table.5.html in the section *query_filter*. Some examples:\n\n```\nLDAP_DOMAIN_FILTER=\"(&(mail=*@%s)(objectClass=mailAccount))\"\n\nLDAP_MAILBOX_FILTER=\"(&(mail=%s)(objectClass=mailAccount))\"\n\nLDAP_SENDER_FILTER=\"(&(|(mail=%s)(mailalias=%s))(objectClass=mailAccount))\"\n```\n\nThe **LDAP_XXX_ATTRIBUTE** specifies which attribute of the found LDAP objects will be used. Usually these are either *mail*, *uid*, *mailalias* or *mailacceptinggeneralid* but may be completly different ones depending on your LDAP setup.\n\n\n**LDAP_XXX_FORMAT** can be used to reformat the result. E.g. you can use `LDAP_MAILBOX_FORMAT=\"/var/mail/vhosts/%d/%s/mail/\"` to set a fixed path for the mailbox location if the path is not stored within LDAP.\n\nThe optional **FORWARD** and **GROUP** lookups are technically identical to the **ALIAS** lookup and could be used interchangeably but are intended for additional alias/group/forward lookups. So you can use aliases using an alias field in your user objects. Forwards as source and destination mapping fields in forwarding objects and group address and group member emails in group objects. But you can also use them in different ways to suit your system.\n\nThen you also have to provide the lookups for dovecot. These will probably be similar to your postfix lookups but may and will differ in some cases. The variables neccessary are **LDAP_DOVECOT_USER_ATTRS**, **LDAP_DOVECOT_USER_FILTER**, **LDAP_DOVECOT_PASS_ATTRS**, **LDAP_DOVECOT_PASS_FILTER**, **LDAP_DOVECOT_ITERATE_ATTRS**, **LDAP_DOVECOT_ITERATE_FILTER**. They correspond directly to the dovecot variables of the same name. While the user and pass attributes and filters are required, the iterate attributes and filters are not. For more detailed information please look at https://wiki.dovecot.org/AuthDatabase/LDAP/Userdb. Note that multiple attribures may be required per query and must be provided in a different form than for postfix! Here are some examples:\n\n```\nLDAP_DOVECOT_USER_ATTRS=\"=home=/var/mail/vhosts/%d/%n/,=mail=maildir:/var/mail/vhosts/%d/%n/mail/,mailuserquota=quota=quota_rule=*:bytes=%\\$$\"\nLDAP_DOVECOT_USER_FILTER=\"(&(mail=%u)(objectClass=mailAccount))\"\nLDAP_DOVECOT_PASS_ATTRS=\"mail=user,userPassword=password\"\nLDAP_DOVECOT_PASS_FILTER=\"(&(mail=%u)(objectClass=mailAccount))\"\nLDAP_DOVECOT_ITERATE_ATTRS=\"mail=user\"\nLDAP_DOVECOT_ITERATE_FILTER=\"(objectClass=mailAccount)\"\n```\n\nThis mailserver also supports the user of master users that are allowed to log into other users mailboxes using their own password. This can be used e.g. for shared mailboxes or external imap services that should be able to connect to all inboxes via imap while not knowing the users passwords. To enable the use of master users set **LDAP_MASTER_USER_ENABLED** to *true*. With **LDAP_MASTER_USER_SEPARATOR** the separator can be specified (default is \\*). So you can log in with the username `normaluser@yoursystem.com*masteruser@yoursystem.com` or `normaluser*masteruser` if you only use usernames as logins. The password then has to be the password of the master user. **LDAP_MASTER_USER_SEARCH_BASE**, **LDAP_MASTER_USER_SEARCH_SCOPE**, **LDAP_DOVECOT_MASTER_USER_ATTRS** and **LDAP_DOVECOT_MASTER_USER_FILTER** work analogous to the dovecot user lookups. For more detailed documentation please look at https://wiki.dovecot.org/Authentication/MasterUsers . Note that `%u` is the master user name in this case and `%{login_user}` can be used to get the user name of the user to be loged in.\n\n```\nLDAP_MASTER_USER_ENABLED=true\nLDAP_DOVECOT_MASTER_PASS_ATTRS=\"mail=user,userPassword=password\"\nLDAP_DOVECOT_MASTER_PASS_FILTER=\"(&(mail=%u)(st=%{login_user})(objectClass=mailAccount))\"\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### IPv6 support\n\nIf you want to support inbound IPv6 connections, you need to create a docker network with IPv6 enabled, otherwise, you may have some issues with docker internal networking.\n\nThe procedure is quite simple:\n\n- Remove your old `http_network` (if you already have created it)\n\n```bash\ndocker network rm http_network\n```\n\n- Choose a private ipv6 address range (/64)\n  - You can easily get a unique private IPv6 address range on [SimpleDNS website](https://simpledns.com/private-ipv6)\n\n- Create a docker network with IPv6 enabled\n\n```bash\n# Replace subnet mask with your own \"Combined/CID\"\ndocker network create http_network --ipv6 --subnet \"fd00:0000:0000:0000::/64\"\n```\n\n- Append this to your `docker-compose.yml`\n\n```yml\n# IPv6NAT\n# https://github.com/robbertkl/docker-ipv6nat\n# https://hub.docker.com/r/robbertkl/ipv6nat/\nipv6nat:\n  image: robbertkl/ipv6nat\n  container_name: ipv6nat\n  restart: ${RESTART_MODE}\n  volumes:\n    - /var/run/docker.sock:/var/run/docker.sock:ro\n    - /lib/modules:/lib/modules:ro\n  depends_on:\n    - mailserver\n  cap_add:\n    - NET_ADMIN\n    - SYS_MODULE\n  network_mode: \"host\"\n```\n\n- Create a record named `mail` of type `AAAA` with your **public** IPv6 address in your DNS provider.\n\nDone! This is all the configuration needed to enable inbound IPv6 support on this mailserver.\n\nYou can read more on how and why [robbertkl/docker-ipv6nat](https://github.com/robbertkl/docker-ipv6nat) container mimics NAT for IPv6 on his page.\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Persistent files and folders in /mnt/docker/mail Docker volume\n\n```\n/mnt/docker\n└──mail\n   ├──postfix\n   |     custom.conf\n   |     sender_access\n   |  ├──spool (Postfix queues directory)\n   │  │     defer\n   │  │     flush\n   │  │     hold\n   │  │     maildrop\n   │  │     ...\n   ├──dovecot\n   |     instances\n   |     ssl-parameters.dat\n   |  ├──conf.d (Custom dovecot configuration)\n   ├──clamav (ClamAV databases directory)\n   │     bytecode.cvd\n   │     daily.cld\n   │     main.cvd\n   ├──clamav-unofficial-sigs\n   │     user.conf\n   ├──rspamd (Rspamd databases directory)\n   │     rspamd.rrd\n   |     stats.ucl\n   ├──zeyple\n   │  ├──keys (GPG public keyring)\n   │  │     pubring.kbx\n   │  │     trustdb.gpg\n   │  │     ...\n   ├──sieve\n   │     default.sieve\n   │     custom.sieve (custom default sieve rules for all users)\n   ├──dkim\n   │  ├──domain.tld\n   │  │     private.key\n   │  │     public.key\n   ├──ssl\n   │  ├──selfsigned (Auto-generated if no certificate found)\n   │  │     cert.pem\n   │  │     privkey.pem\n   ├──vhosts\n   │  ├──domain.tld\n   │  │  ├──user\n   │  │  │     .dovecot.sieve -> sieve/rainloop.user.sieve\n   │  │  │     .dovecot.svbin\n   │  │  │  ├──mail\n   │  │  │  │  ├──.Archive\n   │  │  │  │  ├──.Drafts\n   │  │  │  │  ├──.Sent\n   │  │  │  │  ├──.Spam\n   │  │  │  │  ├──.Trash\n   │  │  │  │  ├──cur\n   │  │  │  │  ├──new\n   │  │  │  │     ...\n   │  │  │  ├──sieve\n   │  │  │  │     rainloop.user.sieve (if using rainloop webmail)\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Override postfix configuration\n\nPostfix default configuration can be overrided providing a custom configuration file at postfix format. This can be\nused to also add configuration that are not in default configuration. [Postfix documentation](http://www.postfix.org/documentation.html) remains the best place\nto find configuration options.\n\nEach line in the provided file will be loaded into Postfix. Create a new file here `/mnt/docker/mail/postfix/custom.conf`\nand add your custom options inside.\n\nTo edit services in `master.cf` configuration file, SFP prefixes are available to indicate what you want to change.\n\n* `S|` = service entry (service/type=value)\n* `F|` = service field (service/type/field=value)\n* `P|` = service parameter (service/type/parameter=value)\n\nExample :\n\n```ini\n# /mnt/docker/mail/postfix/custom.conf\n\n# main.cf parameters\nsmtpd_banner = $myhostname ESMTP MyGreatMailServer\ninet_protocols = ipv4\ndelay_notice_recipient = admin@domain.tld\ndelay_warning_time = 2h\n\n# master.cf services\nS|submission/inet=submission inet n       -       -       -       -       smtpd\nP|submission/inet/syslog_name=postfix/submission-custom\nP|submission/inet/smtpd_tls_security_level=may\nP|submission/inet/smtpd_tls_ciphers=medium\nF|smtp/unix/chroot=n\n```\n\n```\ndocker logs -f mailserver\n\n[INFO] Override parameter in main.cf : smtpd_banner = $myhostname ESMTP MyGreatMailServer\n[INFO] Override parameter in main.cf : inet_protocols = ipv4\n[INFO] Override parameter in main.cf : delay_notice_recipient = admin@domain.tld\n[INFO] Override parameter in main.cf : delay_warning_time = 2h\n[INFO] Override service entry in master.cf : submission/inet=submission inet n       -       -       -       -       smtpd\n[INFO] Override service parameter in master.cf : submission/inet/syslog_name=postfix/submission-custom\n[INFO] Override service parameter in master.cf : submission/inet/smtpd_tls_security_level=may\n[INFO] Override service parameter in master.cf : submission/inet/smtpd_tls_ciphers=medium\n[INFO] Override service field in master.cf : smtp/unix/chroot=n\n[INFO] Custom Postfix configuration file loaded\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Custom configuration for dovecot\n\nSometimes you might want to add additional configuration parameters or override the default ones. You can do so by placing configuration files to the persistent folder `/mnt/docker/mail/dovecot/conf.d`.\n\nExample:\n\n```bash\n# /mnt/docker/mail/dovecot/conf.d/20-imap.conf\n\nprotocol imap {\n\n  mail_max_userip_connections = 100\n\n}\n\n# /mnt/docker/mail/dovecot/conf.d/90-quota.conf\n\nplugin {\n\n  quota_rule2 = Trash:storage=+200M\n  quota_exceeded_message = You have exceeded your mailbox quota.\n\n}\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Postfix blacklist\n\nTo block some senders or an entire domain, create a new file named `sender_access` in `/mnt/docker/mail/postfix`.\n\n```bash\n# /mnt/docker/mail/postfix/sender_access\n# Format : <address|domain> <action>\n\ndomain.tld REJECT\nspam@domain2.tld REJECT\n```\n\n```\ndocker logs -f mailserver\n\nNOQUEUE: reject: 554 5.7.1 <john.doe@domain.tld>: Sender address rejected: Access denied\n```\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Email client settings\n\n- IMAP/SMTP username : user@domain.tld\n- Incoming IMAP server : mail.domain.tld (your FQDN)\n- Outgoing SMTP server : mail.domain.tld (your FQDN)\n- IMAP port : 993\n- SMTP port : 587\n- IMAP Encryption protocol : SSL/TLS\n- SMTP Encryption protocol : STARTTLS\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Components\n\n- Postfix 3.1.8\n- Dovecot 2.2.27\n- Rspamd 1.9.4\n- Fetchmail 6.3.26\n- ClamAV 0.100.3\n- Clamav Unofficial Sigs 5.6.2\n- Zeyple 1.2.2\n- Unbound 1.6.0\n- s6 2.8.0.1\n- Rsyslog 8.24.0\n- ManageSieve server\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Migration from 1.0 to 1.1\n\nIf you still use 1.0 version (bundled with Spamassassin, Amavisd...etc) which was available with the `latest` tag, you can follow the migration steps here :\n\nhttps://github.com/hardware/mailserver/wiki/Migrating-from-1.0-stable-to-1.1-stable\n\nOr stay with `1.0-legacy` tag (not recommended).\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Community projects\n\n- [ksylvan/docker-mail-server](https://github.com/ksylvan/docker-mail-server) : Ansible playbooks to easily deploy hardware/mailserver.\n- [rubentrancoso/mailserver-quicksetup](https://github.com/rubentrancoso/mailserver-quicksetup) : Automatic hardware/mailserver deployment on a digitalocean droplet.\n- [NickBusey/HomelabOS](https://gitlab.com/NickBusey/HomelabOS) - Automatic deployment on home servers with bastion host relay\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n\n### Some useful Thunderbird extensions\n\n* https://www.enigmail.net/\n* https://github.com/moisseev/rspamd-spamness\n* https://github.com/lieser/dkim_verifier\n\n[![](https://i.imgur.com/Em7M8F0.png)](https://i.imgur.com/Em7M8F0.png)\n\n<p align=\"right\"><a href=\"#summary\">Back to table of contents :arrow_up_small:</a></p>\n"
        },
        {
          "name": "docker-compose.sample.yml",
          "type": "blob",
          "size": 5.8798828125,
          "content": "version: \"3\"\n\n# IPv4 only\n# docker network create http_network\n\n# IPv4/IPv6 network\n# docker network create http_network --ipv6 --subnet \"fd00:0000:0000:0000::/64\"\n# Refer to https://github.com/hardware/mailserver/#ipv6-support for more information.\n\nnetworks:\n  http_network:\n    external: true\n  mail_network:\n    external: false\n\nservices:\n  traefik:\n    image: traefik:1.7-alpine\n    restart: ${RESTART_MODE}\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    labels:\n      - traefik.enable=true\n      - traefik.frontend.rule=Host:mail.${MAILSERVER_DOMAIN}\n      - traefik.port=8080\n      - traefik.docker.network=http_network\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      - ${VOLUMES_ROOT_PATH}/traefik/traefik.toml:/traefik.toml:ro\n      - ${VOLUMES_ROOT_PATH}/traefik/acme:/etc/traefik/acme\n    networks:\n      - http_network\n\n  mailserver:\n    image: hardware/mailserver:${MAILSERVER_DOCKER_TAG}\n    restart: ${RESTART_MODE}\n    domainname: ${MAILSERVER_DOMAIN}                    # Mail server A/MX/FQDN & reverse PTR = mail.domain.tld.\n    hostname: ${MAILSERVER_HOSTNAME}\n    labels:\n      - traefik.enable=true\n      - traefik.frontend.rule=Host:spam.${MAILSERVER_DOMAIN}\n      - traefik.port=11334\n      - traefik.docker.network=http_network\n    # extra_hosts:                          - Required for external database (on other server or for local databases on host without docker)\n    #  - \"mariadb:xx.xx.xx.xx\"              - Replace with IP address of MariaDB server\n    #  - \"redis:xx.xx.xx.xx\"                - Replace with IP address of Redis server\n    ports:\n      - \"25:25\"       # SMTP                - Required\n    # - \"110:110\"     # POP3       STARTTLS - Optional - For webmails/desktop clients\n      - \"143:143\"     # IMAP       STARTTLS - Optional - For webmails/desktop clients\n    # - \"465:465\"     # SMTPS      SSL/TLS  - Optional - Enabled for compatibility reason, otherwise disabled\n      - \"587:587\"     # Submission STARTTLS - Optional - For webmails/desktop clients\n      - \"993:993\"     # IMAPS      SSL/TLS  - Optional - For webmails/desktop clients\n    # - \"995:995\"     # POP3S      SSL/TLS  - Optional - For webmails/desktop clients\n      - \"4190:4190\"   # SIEVE      STARTTLS - Optional - Recommended for mail filtering\n    environment:\n      - DBPASS=${DATABASE_USER_PASSWORD}       # MariaDB database password (required)\n      - RSPAMD_PASSWORD=${RSPAMD_PASSWORD}     # Rspamd WebUI password (required)\n    # - ADD_DOMAINS=aa.tld, www.bb.tld...      # Add additional domains separated by commas (needed for dkim keys etc.)\n    # - DEBUG_MODE=true                        # Enable Postfix, Dovecot, Rspamd and Unbound verbose logging\n    # - ENABLE_POP3=true                       # Enable POP3 protocol\n    # - ENABLE_FETCHMAIL=true                  # Enable fetchmail forwarding\n    # - DISABLE_RATELIMITING=false             # Enable ratelimiting policy\n    # - DISABLE_CLAMAV=true                    # Disable virus scanning\n    # - DISABLE_SIGNING=true                   # Disable DKIM/ARC signing\n    # - DISABLE_GREYLISTING=true               # Disable greylisting policy\n    #\n    # Full list : https://github.com/hardware/mailserver#environment-variables\n    #\n    volumes:\n      - ${VOLUMES_ROOT_PATH}/mail:/var/mail\n    depends_on:\n      - mariadb\n      - redis\n    networks:\n      - mail_network\n      - http_network\n\n  # Administration interface\n  # https://github.com/hardware/postfixadmin\n  # http://postfixadmin.sourceforge.net/\n  # Configuration : https://github.com/hardware/mailserver/wiki/Postfixadmin-initial-configuration\n  postfixadmin:\n    image: hardware/postfixadmin\n    restart: ${RESTART_MODE}\n    domainname: ${MAILSERVER_DOMAIN}\n    hostname: ${MAILSERVER_HOSTNAME}\n    labels:\n      - traefik.enable=true\n      - traefik.frontend.rule=Host:postfixadmin.${MAILSERVER_DOMAIN}\n      - traefik.port=8888\n      - traefik.docker.network=http_network\n    environment:\n      - DBPASS=${DATABASE_USER_PASSWORD}\n    depends_on:\n      - mailserver\n      - mariadb\n    networks:\n      - mail_network\n      - http_network\n\n  # Webmail (Optional)\n  # https://github.com/hardware/rainloop\n  # https://www.rainloop.net/\n  # Configuration : https://github.com/hardware/mailserver/wiki/Rainloop-initial-configuration\n  rainloop:\n    image: hardware/rainloop\n    restart: ${RESTART_MODE}\n    labels:\n      - traefik.enable=true\n      - traefik.port=8888\n      - traefik.frontend.rule=Host:webmail.${MAILSERVER_DOMAIN}\n      - traefik.docker.network=http_network\n    volumes:\n      - ${VOLUMES_ROOT_PATH}/rainloop:/rainloop/data\n    depends_on:\n      - mailserver\n      - mariadb\n    networks:\n      - mail_network\n      - http_network\n\n  # Authoritative DNS server (Optional)\n  # https://github.com/hardware/nsd-dnssec\n  # https://www.nlnetlabs.nl/projects/nsd/\n  # Configuration : https://github.com/hardware/mailserver/wiki/NSD-initial-configuration\n  # nsd:\n  #   image: hardware/nsd-dnssec\n  #   restart: ${RESTART_MODE}\n  #   ports:\n  #     - \"53:53\"\n  #     - \"53:53/udp\"\n  #   volumes:\n  #     - ${VOLUMES_ROOT_PATH}/nsd/conf:/etc/nsd\n  #     - ${VOLUMES_ROOT_PATH}/nsd/zones:/zones\n  #     - ${VOLUMES_ROOT_PATH}/nsd/db:/var/db/nsd\n\n  # Database\n  # https://github.com/docker-library/mariadb\n  # https://mariadb.org/\n  mariadb:\n    image: mariadb:10.2\n    restart: ${RESTART_MODE}\n    # Info : These variables are ignored when the volume already exists (if databases was created before).\n    environment:\n      - MYSQL_RANDOM_ROOT_PASSWORD=yes\n      - MYSQL_DATABASE=postfix\n      - MYSQL_USER=postfix\n      - MYSQL_PASSWORD=${DATABASE_USER_PASSWORD}\n    volumes:\n      - ${VOLUMES_ROOT_PATH}/mysql/db:/var/lib/mysql\n    networks:\n      - mail_network\n\n  # Database\n  # https://github.com/docker-library/redis\n  # https://redis.io/\n  redis:\n    image: redis:4.0-alpine\n    restart: ${RESTART_MODE}\n    command: redis-server --appendonly yes\n    volumes:\n      - ${VOLUMES_ROOT_PATH}/redis/db:/data\n    networks:\n      - mail_network\n"
        },
        {
          "name": "rootfs",
          "type": "tree",
          "content": null
        },
        {
          "name": "sample.env",
          "type": "blob",
          "size": 1.1845703125,
          "content": "# This file is used to define environment variables to be used\n# for variable substitution in your docker compose file.\n# https://docs.docker.com/compose/env-file/\n\n#\n# MANDATORY\n# /!\\ if this variables are unset, the mail server will not start.\n#\n\n# Your domain name (eg. domain.tld)\nMAILSERVER_DOMAIN=\n\n# MariaDB/PostgreSQL database password\nDATABASE_USER_PASSWORD=\n\n# Rspamd WebUI and controller password\nRSPAMD_PASSWORD=\n\n#\n# NOT MANDATORY\n#\n\n# Your mailserver hostname (eg. mail for mail.domain.tld)\nMAILSERVER_HOSTNAME=mail\n\n# Mailserver version\n# 1.1-stable : Stable version (v1.1-stable github branch)\n# 1.1-latest : Latest development build (master github branch)\n# Latest development builds have been validated through\n# the CI automation system but they are not meant for\n# deployment in production.\n# 1.1-stable and 1.1-latest are rebuilt weekly on the docker hub but if you\n# have any problem with a new build you can switch to 1.1-stable-fallback\n# The fallback tag is rebuilt monthly.\nMAILSERVER_DOCKER_TAG=1.1-stable\n\n# Docker volumes parent folder\nVOLUMES_ROOT_PATH=/mnt/docker\n\n# Docker containers restart mode\n# https://docs.docker.com/compose/compose-file/#restart\nRESTART_MODE=unless-stopped\n"
        },
        {
          "name": "test",
          "type": "tree",
          "content": null
        },
        {
          "name": "traefik.sample.toml",
          "type": "blob",
          "size": 0.9521484375,
          "content": "defaultEntryPoints = [\"https\",\"http\"]\n\n[api]\nentryPoint = \"traefik\"\ndashboard = true\n\n[entryPoints]\n  [entryPoints.http]\n  address = \":80\"\n    [entryPoints.http.redirect]\n    entryPoint = \"https\"\n  [entryPoints.https]\n  address = \":443\"\n    [entryPoints.https.tls]\n    minVersion = \"VersionTLS12\"\n    cipherSuites = [\n      \"TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305\",\n      \"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\",\n      \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\",\n      \"TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256\",\n      \"TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\",\n      \"TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\"\n    ]\n  [entryPoints.traefik]\n  address = \":8080\"\n  [entryPoints.traefik.auth.basic]\n  users = [\"admin:{SHA}jLIjfQZ5yojbZGTqxg2pY0VROWQ=\"]\n\n[acme]\nemail = \"{{ EMAIL }}\"\nstorage = \"/etc/traefik/acme/acme.json\"\nentryPoint = \"https\"\nonHostRule = true\n  [acme.tlsChallenge]\n\n[docker]\nendpoint = \"unix:///var/run/docker.sock\"\ndomain = \"{{ DOMAIN }}\"\nwatch = true\nexposedbydefault = false\n"
        }
      ]
    }
  ]
}