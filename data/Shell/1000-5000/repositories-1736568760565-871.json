{
  "metadata": {
    "timestamp": 1736568760565,
    "page": 871,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjg3OQ==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "redis/docker-library-redis",
      "stars": 1128,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitattributes",
          "type": "blob",
          "size": 0.1474609375,
          "content": "/*/**/Dockerfile            linguist-generated\n/*/**/docker-entrypoint.sh  linguist-generated\n/Dockerfile*.template       linguist-language=Dockerfile\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.0166015625,
          "content": ".jq-template.awk\n"
        },
        {
          "name": "6.2",
          "type": "tree",
          "content": null
        },
        {
          "name": "7.0",
          "type": "tree",
          "content": null
        },
        {
          "name": "7.2",
          "type": "tree",
          "content": null
        },
        {
          "name": "7.4-rc",
          "type": "tree",
          "content": null
        },
        {
          "name": "7.4",
          "type": "tree",
          "content": null
        },
        {
          "name": "BUILD.md",
          "type": "blob",
          "size": 1.51171875,
          "content": "# How the official Redis images are built\n\n## Prepare the Docker files and metadata\n\nThe general process seems to involve the following steps:\n\n0. Install command-line tools that are reported as being `not found`. I had to install `wget`, `jq`, and `bashbrew`.\n1. Regenerate the `versions.json` file with the help of the `versions.sh`. This should fetch the latest Redis version from https://raw.githubusercontent.com/redis/redis-hashes/master/README and add it to the `version.json` file. If the version isn't picked up, you can also manually edit the `versions.json` file.\n2. Apply the template on the versions via `apply-templates.sh`. This should create you a new version folder that's named by the `major.minor` Redis version number. This folder contains the `Dockerfile`.\n3. Execute `generate-stackbrew-library.sh`. The script automates the generation of metadata for Redis Docker images, including tags, architectures, git commit hashes, and directories based on the versions.json file. It ensures that the metadata is up-to-date with the latest commits and correctly reflects the supported architectures and versions.\n\n## Test the build locally\n\n1. Change the directory to the recently added version and the target base image flavor, e.g., `cd ./7.4/debian`.\n2. Build the image via `docker build`, e.g., `docker build -t redis-test:7.4-rc1 .`.\n3. Run the image the same way as the official docker image: `docker run --name test-7-4-rc1 -d redis-test:7.4-rc1`.\n4. Open a `redis-cli` on the container `docker exec -it test-7-4-rc1 redis-cli`."
        },
        {
          "name": "Dockerfile.template",
          "type": "blob",
          "size": 8.259765625,
          "content": "{{ if env.variant == \"alpine\" then ( -}}\nFROM alpine:{{ .alpine.version }}\n{{ ) else ( -}}\nFROM debian:{{ .debian.version }}-slim\n{{ ) end -}}\n\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\n{{ if env.variant == \"alpine\" then ( -}}\nRUN set -eux; \\\n# alpine already has a gid 999, so we'll use the next id\n\taddgroup -S -g 1000 redis; \\\n\tadduser -S -G redis -u 999 redis\n{{ ) else ( -}}\nRUN set -eux; \\\n\tgroupadd -r -g 999 redis; \\\n\tuseradd -r -g redis -u 999 redis\n{{ ) end -}}\n\n# runtime dependencies\n{{ if env.variant == \"alpine\" then ( -}}\nRUN set -eux; \\\n\tapk add --no-cache \\\n# add tzdata for https://github.com/docker-library/redis/issues/138\n\t\ttzdata \\\n\t;\n{{ ) else ( -}}\nRUN set -eux; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n# add tzdata explicitly for https://github.com/docker-library/redis/issues/138 (see also https://bugs.debian.org/837060 and related)\n\t\ttzdata \\\n\t; \\\n\trm -rf /var/lib/apt/lists/*\n{{ ) end -}}\n\n# grab gosu for easy step-down from root\n# https://github.com/tianon/gosu/releases\nENV GOSU_VERSION {{ .gosu.version }}\nRUN set -eux; \\\n{{ if env.variant == \"alpine\" then ( -}}\n\tapk add --no-cache --virtual .gosu-fetch gnupg; \\\n\tarch=\"$(apk --print-arch)\"; \\\n{{ ) else ( -}}\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends ca-certificates gnupg wget; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\tarch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \\\n{{ ) end -}}\n\tcase \"$arch\" in \\\n{{\n\t[\n\t\t.gosu.arches\n\t\t| to_entries[]\n\t\t| (\n\t\t\tif env.variant == \"alpine\" then\n\t\t\t\t{\n\t\t\t\t\t# https://dl-cdn.alpinelinux.org/alpine/edge/main/\n\t\t\t\t\t# https://dl-cdn.alpinelinux.org/alpine/latest-stable/main/\n\t\t\t\t\tamd64: \"x86_64\",\n\t\t\t\t\tarm32v6: \"armhf\",\n\t\t\t\t\tarm32v7: \"armv7\",\n\t\t\t\t\tarm64v8: \"aarch64\",\n\t\t\t\t\ti386: \"x86\",\n\t\t\t\t\tppc64le: \"ppc64le\",\n\t\t\t\t\triscv64: \"riscv64\",\n\t\t\t\t\ts390x: \"s390x\",\n\t\t\t\t}\n\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t# https://salsa.debian.org/dpkg-team/dpkg/-/blob/main/data/cputable\n\t\t\t\t\t# https://wiki.debian.org/ArchitectureSpecificsMemo#Architecture_baselines\n\t\t\t\t\t# http://deb.debian.org/debian/dists/unstable/main/\n\t\t\t\t\t# http://deb.debian.org/debian/dists/stable/main/\n\t\t\t\t\t# https://deb.debian.org/debian-ports/dists/unstable/main/\n\t\t\t\t\tamd64: \"amd64\",\n\t\t\t\t\tarm32v5: \"armel\",\n\t\t\t\t\tarm32v7: \"armhf\",\n\t\t\t\t\tarm64v8: \"arm64\",\n\t\t\t\t\ti386: \"i386\",\n\t\t\t\t\tmips64le: \"mips64el\",\n\t\t\t\t\tppc64le: \"ppc64el\",\n\t\t\t\t\triscv64: \"riscv64\",\n\t\t\t\t\ts390x: \"s390x\",\n\t\t\t\t}\n\t\t\tend\n\t\t)[.key] as $arch\n\t\t| select($arch)\n\t\t| .value\n\t\t| (\n-}}\n\t\t{{ $arch | @sh }}) url={{ .url | @sh }}; sha256={{ .sha256 | @sh }} ;; \\\n{{\n\t\t)\n\t] | add\n-}}\n\t\t*) echo >&2 \"error: unsupported gosu architecture: '$arch'\"; exit 1 ;; \\\n\tesac; \\\n\twget -O /usr/local/bin/gosu.asc \"$url.asc\"; \\\n\twget -O /usr/local/bin/gosu \"$url\"; \\\n\techo \"$sha256 */usr/local/bin/gosu\" | sha256sum -c -; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \\\n\tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \\\n\tgpgconf --kill all; \\\n\trm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \\\n{{ if env.variant == \"alpine\" then ( -}}\n\tapk del --no-network .gosu-fetch; \\\n{{ ) else ( -}}\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n{{ ) end -}}\n\tchmod +x /usr/local/bin/gosu; \\\n\tgosu --version; \\\n\tgosu nobody true\n\nENV REDIS_VERSION {{ .version }}\nENV REDIS_DOWNLOAD_URL {{ .url }}\nENV REDIS_DOWNLOAD_SHA {{ .sha256 // error(\"no sha256 for \\(.version) (\\(env.version))\") }}\n\nRUN set -eux; \\\n\t\\\n{{ if env.variant == \"alpine\" then ( -}}\n\tapk add --no-cache --virtual .build-deps \\\n\t\tcoreutils \\\n\t\tdpkg-dev dpkg \\\n\t\tgcc \\\n\t\tlinux-headers \\\n\t\tmake \\\n\t\tmusl-dev \\\n\t\topenssl-dev \\\n# install real \"wget\" to avoid:\n#   + wget -O redis.tar.gz https://download.redis.io/releases/redis-x.y.z.tar.gz\n#   Connecting to download.redis.io (45.60.121.1:80)\n#   wget: bad header line:     XxhODalH: btu; path=/; Max-Age=900\n\t\twget \\\n\t; \\\n{{ ) else ( -}}\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n\t\tca-certificates \\\n\t\twget \\\n\t\t\\\n\t\tdpkg-dev \\\n\t\tgcc \\\n\t\tlibc6-dev \\\n\t\tlibssl-dev \\\n\t\tmake \\\n\t; \\\n\trm -rf /var/lib/apt/lists/*; \\\n{{ ) end -}}\n\t\\\n\twget -O redis.tar.gz \"$REDIS_DOWNLOAD_URL\"; \\\n\techo \"$REDIS_DOWNLOAD_SHA *redis.tar.gz\" | sha256sum -c -; \\\n\tmkdir -p /usr/src/redis; \\\n\ttar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1; \\\n\trm redis.tar.gz; \\\n\t\\\n# disable Redis protected mode [1] as it is unnecessary in context of Docker\n# (ports are not automatically exposed when running inside Docker, but rather explicitly by specifying -p / -P)\n# [1]: https://github.com/redis/redis/commit/edd4d555df57dc84265fdfb4ef59a4678832f6da\n\tgrep -E '^ *createBoolConfig[(]\"protected-mode\",.*, *1 *,.*[)],$' /usr/src/redis/src/config.c; \\\n\tsed -ri 's!^( *createBoolConfig[(]\"protected-mode\",.*, *)1( *,.*[)],)$!\\10\\2!' /usr/src/redis/src/config.c; \\\n\tgrep -E '^ *createBoolConfig[(]\"protected-mode\",.*, *0 *,.*[)],$' /usr/src/redis/src/config.c; \\\n# for future reference, we modify this directly in the source instead of just supplying a default configuration flag because apparently \"if you specify any argument to redis-server, [it assumes] you are going to specify everything\"\n# see also https://github.com/docker-library/redis/issues/4#issuecomment-50780840\n# (more exactly, this makes sure the default behavior of \"save on SIGTERM\" stays functional by default)\n\t\\\n# https://github.com/jemalloc/jemalloc/issues/467 -- we need to patch the \"./configure\" for the bundled jemalloc to match how Debian compiles, for compatibility\n# (also, we do cross-builds, so we need to embed the appropriate \"--build=xxx\" values to that \"./configure\" invocation)\n\tgnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"; \\\n\textraJemallocConfigureFlags=\"--build=$gnuArch\"; \\\n# https://salsa.debian.org/debian/jemalloc/-/blob/c0a88c37a551be7d12e4863435365c9a6a51525f/debian/rules#L8-23\n\tdpkgArch=\"$(dpkg --print-architecture)\"; \\\n\tcase \"${dpkgArch##*-}\" in \\\n\t\tamd64 | i386 | x32) extraJemallocConfigureFlags=\"$extraJemallocConfigureFlags --with-lg-page=12\" ;; \\\n\t\t*) extraJemallocConfigureFlags=\"$extraJemallocConfigureFlags --with-lg-page=16\" ;; \\\n\tesac; \\\n\textraJemallocConfigureFlags=\"$extraJemallocConfigureFlags --with-lg-hugepage=21\"; \\\n\tgrep -F 'cd jemalloc && ./configure ' /usr/src/redis/deps/Makefile; \\\n\tsed -ri 's!cd jemalloc && ./configure !&'\"$extraJemallocConfigureFlags\"' !' /usr/src/redis/deps/Makefile; \\\n\tgrep -F \"cd jemalloc && ./configure $extraJemallocConfigureFlags \" /usr/src/redis/deps/Makefile; \\\n\t\\\n\texport BUILD_TLS=yes; \\\n\tmake -C /usr/src/redis -j \"$(nproc)\" all; \\\n\tmake -C /usr/src/redis install; \\\n\t\\\n# TODO https://github.com/redis/redis/pull/3494 (deduplicate \"redis-server\" copies)\n\tserverMd5=\"$(md5sum /usr/local/bin/redis-server | cut -d' ' -f1)\"; export serverMd5; \\\n\tfind /usr/local/bin/redis* -maxdepth 0 \\\n\t\t-type f -not -name redis-server \\\n\t\t-exec sh -eux -c ' \\\n\t\t\tmd5=\"$(md5sum \"$1\" | cut -d\" \" -f1)\"; \\\n\t\t\ttest \"$md5\" = \"$serverMd5\"; \\\n\t\t' -- '{}' ';' \\\n\t\t-exec ln -svfT 'redis-server' '{}' ';' \\\n\t; \\\n\t\\\n\trm -r /usr/src/redis; \\\n\t\\\n{{ if env.variant == \"alpine\" then ( -}}\n\trunDeps=\"$( \\\n\t\tscanelf --needed --nobanner --format '%n#p' --recursive /usr/local \\\n\t\t\t| tr ',' '\\n' \\\n\t\t\t| sort -u \\\n\t\t\t| awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \\\n\t)\"; \\\n\tapk add --no-network --virtual .redis-rundeps $runDeps; \\\n\tapk del --no-network .build-deps; \\\n{{ ) else ( -}}\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \\\n\tfind /usr/local -type f -executable -exec ldd '{}' ';' \\\n\t\t| awk '/=>/ { so = $(NF-1); if (index(so, \"/usr/local/\") == 1) { next }; gsub(\"^/(usr/)?\", \"\", so); printf \"*%s\\n\", so }' \\\n\t\t| sort -u \\\n\t\t| xargs -r dpkg-query --search \\\n\t\t| cut -d: -f1 \\\n\t\t| sort -u \\\n\t\t| xargs -r apt-mark manual \\\n\t; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n{{ ) end -}}\n\t\\\n\tredis-cli --version; \\\n\tredis-server --version\n\nRUN mkdir /data && chown redis:redis /data\nVOLUME /data\nWORKDIR /data\n\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\nEXPOSE 6379\nCMD [\"redis-server\"]\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.482421875,
          "content": "Copyright (c) 2014 Docker, Inc.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * Neither the name of Docker, Inc. nor the names of its\n      contributors may be used to endorse or promote products derived\n      from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n\"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 4.2666015625,
          "content": "# https://github.com/docker-library/redis\n\n## Maintained by: [the Docker Community](https://github.com/docker-library/redis)\n\nThis is the Git repo of the [Docker \"Official Image\"](https://github.com/docker-library/official-images#what-are-official-images) for [`redis`](https://hub.docker.com/_/redis/) (not to be confused with any official `redis` image provided by `redis` upstream). See [the Docker Hub page](https://hub.docker.com/_/redis/) for the full readme on how to use this Docker image and for information regarding contributing and issues.\n\nThe [full image description on Docker Hub](https://hub.docker.com/_/redis/) is generated/maintained over in [the docker-library/docs repository](https://github.com/docker-library/docs), specifically in [the `redis` directory](https://github.com/docker-library/docs/tree/master/redis).\n\n## See a change merged here that doesn't show up on Docker Hub yet?\n\nFor more information about the full official images change lifecycle, see [the \"An image's source changed in Git, now what?\" FAQ entry](https://github.com/docker-library/faq#an-images-source-changed-in-git-now-what).\n\nFor outstanding `redis` image PRs, check [PRs with the \"library/redis\" label on the official-images repository](https://github.com/docker-library/official-images/labels/library%2Fredis). For the current \"source of truth\" for [`redis`](https://hub.docker.com/_/redis/), see [the `library/redis` file in the official-images repository](https://github.com/docker-library/official-images/blob/master/library/redis).\n\n---\n\n-\t[![build status badge](https://img.shields.io/github/actions/workflow/status/docker-library/redis/ci.yml?branch=master&label=GitHub%20CI)](https://github.com/docker-library/redis/actions?query=workflow%3A%22GitHub+CI%22+branch%3Amaster)\n-\t[![build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/update.sh/job/redis.svg?label=Automated%20update.sh)](https://doi-janky.infosiftr.net/job/update.sh/job/redis/)\n\n| Build | Status | Badges | (per-arch) |\n|:-:|:-:|:-:|:-:|\n| [![amd64 build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/amd64/job/redis.svg?label=amd64)](https://doi-janky.infosiftr.net/job/multiarch/job/amd64/job/redis/) | [![arm32v5 build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/arm32v5/job/redis.svg?label=arm32v5)](https://doi-janky.infosiftr.net/job/multiarch/job/arm32v5/job/redis/) | [![arm32v6 build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/arm32v6/job/redis.svg?label=arm32v6)](https://doi-janky.infosiftr.net/job/multiarch/job/arm32v6/job/redis/) | [![arm32v7 build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/arm32v7/job/redis.svg?label=arm32v7)](https://doi-janky.infosiftr.net/job/multiarch/job/arm32v7/job/redis/) |\n| [![arm64v8 build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/arm64v8/job/redis.svg?label=arm64v8)](https://doi-janky.infosiftr.net/job/multiarch/job/arm64v8/job/redis/) | [![i386 build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/i386/job/redis.svg?label=i386)](https://doi-janky.infosiftr.net/job/multiarch/job/i386/job/redis/) | [![mips64le build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/mips64le/job/redis.svg?label=mips64le)](https://doi-janky.infosiftr.net/job/multiarch/job/mips64le/job/redis/) | [![ppc64le build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/ppc64le/job/redis.svg?label=ppc64le)](https://doi-janky.infosiftr.net/job/multiarch/job/ppc64le/job/redis/) |\n| [![s390x build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/multiarch/job/s390x/job/redis.svg?label=s390x)](https://doi-janky.infosiftr.net/job/multiarch/job/s390x/job/redis/) | [![put-shared build status badge](https://img.shields.io/jenkins/s/https/doi-janky.infosiftr.net/job/put-shared/job/light/job/redis.svg?label=put-shared)](https://doi-janky.infosiftr.net/job/put-shared/job/light/job/redis/) |\n\n<!-- THIS FILE IS GENERATED BY https://github.com/docker-library/docs/blob/master/generate-repo-stub-readme.sh -->\n"
        },
        {
          "name": "apply-templates.sh",
          "type": "blob",
          "size": 1.0068359375,
          "content": "#!/usr/bin/env bash\nset -Eeuo pipefail\n\n[ -f versions.json ] # run \"versions.sh\" first\n\njqt='.jq-template.awk'\nif [ -n \"${BASHBREW_SCRIPTS:-}\" ]; then\n\tjqt=\"$BASHBREW_SCRIPTS/jq-template.awk\"\nelif [ \"$BASH_SOURCE\" -nt \"$jqt\" ]; then\n\t# https://github.com/docker-library/bashbrew/blob/master/scripts/jq-template.awk\n\twget -qO \"$jqt\" 'https://github.com/docker-library/bashbrew/raw/9f6a35772ac863a0241f147c820354e4008edf38/scripts/jq-template.awk'\nfi\n\nif [ \"$#\" -eq 0 ]; then\n\tversions=\"$(jq -r 'keys | map(@sh) | join(\" \")' versions.json)\"\n\teval \"set -- $versions\"\nfi\n\ngenerated_warning() {\n\tcat <<-EOH\n\t\t#\n\t\t# NOTE: THIS DOCKERFILE IS GENERATED VIA \"apply-templates.sh\"\n\t\t#\n\t\t# PLEASE DO NOT EDIT IT DIRECTLY.\n\t\t#\n\n\tEOH\n}\n\nfor version; do\n\trm -rf \"$version\"\n\n\tfor variant in debian alpine; do\n\t\texport version variant\n\n\t\tdir=\"$version/$variant\"\n\n\t\techo \"processing $dir ...\"\n\n\t\tmkdir -p \"$dir\"\n\n\t\t{\n\t\t\tgenerated_warning\n\t\t\tgawk -f \"$jqt\" Dockerfile.template\n\t\t} > \"$dir/Dockerfile\"\n\n\t\tcp -a docker-entrypoint.sh \"$dir/\"\n\tdone\ndone\n"
        },
        {
          "name": "docker-entrypoint.sh",
          "type": "blob",
          "size": 0.6455078125,
          "content": "#!/bin/sh\nset -e\n\n# first arg is `-f` or `--some-option`\n# or first arg is `something.conf`\nif [ \"${1#-}\" != \"$1\" ] || [ \"${1%.conf}\" != \"$1\" ]; then\n\tset -- redis-server \"$@\"\nfi\n\n# allow the container to be started with `--user`\nif [ \"$1\" = 'redis-server' -a \"$(id -u)\" = '0' ]; then\n\tfind . \\! -user redis -exec chown redis '{}' +\n\texec gosu redis \"$0\" \"$@\"\nfi\n\n# set an appropriate umask (if one isn't set already)\n# - https://github.com/docker-library/redis/issues/305\n# - https://github.com/redis/redis/blob/bb875603fb7ff3f9d19aad906bd45d7db98d9a39/utils/systemd-redis_server.service#L37\num=\"$(umask)\"\nif [ \"$um\" = '0022' ]; then\n\tumask 0077\nfi\n\nexec \"$@\"\n"
        },
        {
          "name": "generate-stackbrew-library-mac.sh",
          "type": "blob",
          "size": 3.5263671875,
          "content": "#!/opt/homebrew/bin/bash\n\n## You need to perform the following steps before executing this script:\n## 1. Install a newer version of bash: `brew install bash`.\n## 2. Install additional packages: `brew install coreutils gawk`.\n## 3. Ensure that you have `bashbrew` built and in your PATH.\n\nset -Eeuo pipefail\n\ndeclare -A aliases=(\n\t[7.4]='7 latest'\n\t[6.2]='6'\n)\n\nself=\"$(basename \"$0\")\"\ncd \"$(dirname \"$(greadlink -f \"$0\")\")\"\n\nif [ \"$#\" -eq 0 ]; then\n\tversions=\"$(jq -r 'keys | map(@sh) | join(\" \")' versions.json)\"\n\teval \"set -- $versions\"\nfi\n\n# sort version numbers with highest first\nIFS=$'\\n'; set -- $(sort -rV <<<\"$*\"); unset IFS\n\n# get the most recent commit which modified any of \"$@\"\nfileCommit() {\n\tgit log -1 --format='format:%H' HEAD -- \"$@\"\n}\n\n# get the most recent commit which modified \"$1/Dockerfile\" or any file COPY'd from \"$1/Dockerfile\"\ndirCommit() {\n\tlocal dir=\"$1\"; shift\n\t(\n\t\tcd \"$dir\"\n\t\tfileCommit \\\n\t\t\tDockerfile \\\n\t\t\t$(git show HEAD:./Dockerfile | gawk '\n\t\t\t\ttoupper($1) == \"COPY\" {\n\t\t\t\t\tfor (i = 2; i < NF; i++) {\n\t\t\t\t\t\tprint $i\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t')\n\t)\n}\n\ngetArches() {\n\tlocal repo=\"$1\"; shift\n\tlocal officialImagesUrl='https://github.com/docker-library/official-images/raw/master/library/'\n\n\teval \"declare -g -A parentRepoToArches=( $(\n\t\tfind . -name 'Dockerfile' -exec gawk '\n\t\t\t\ttoupper($1) == \"FROM\" && $2 !~ /^('\"$repo\"'|scratch|.*\\/.*)(:|$)/ {\n\t\t\t\t\tprint \"'\"$officialImagesUrl\"'\" $2\n\t\t\t\t}\n\t\t\t' '{}' + \\\n\t\t\t| sort -u \\\n\t\t\t| xargs bashbrew cat --format '[{{ .RepoName }}:{{ .TagName }}]=\"{{ join \" \" .TagEntry.Architectures }}\"'\n\t) )\"\n}\ngetArches 'redis'\n\ncat <<-EOH\n# This file was generated via https://github.com/redis/docker-library-redis/blob/$(fileCommit \"$self\")/$self\n\nMaintainers: David Maier <david.maier@redis.com> (@dmaier-redislabs),\n             Yossi Gottlieb <yossi@redis.com> (@yossigo)\nGitRepo: https://github.com/redis/docker-library-redis.git\nEOH\n\n# prints \"$2$1$3$1...$N\"\njoin() {\n\tlocal sep=\"$1\"; shift\n\tlocal out; printf -v out \"${sep//%/%%}%s\" \"$@\"\n\techo \"${out#$sep}\"\n}\n\nfor version; do\n\texport version\n\n\tfullVersion=\"$(jq -r '.[env.version].version' versions.json)\"\n\n\tversionAliases=()\n\twhile [ \"$fullVersion\" != \"$version\" ] && [ \"${fullVersion%.*}\" != \"$fullVersion\" ]; do\n\t\tversionAliases+=( $fullVersion )\n\t\tfullVersion=\"${fullVersion%.*}\"\n\tdone\n\tversionAliases+=(\n\t\t$version\n\t\t${aliases[$version]:-}\n\t)\n\n\tfor variant in debian alpine; do\n\t\texport variant\n\t\tdir=\"$version/$variant\"\n\n\t\tcommit=\"$(dirCommit \"$dir\")\"\n\n\t\tif [ \"$variant\" = 'debian' ]; then\n\t\t\tvariantAliases=( \"${versionAliases[@]}\" )\n\t\telse\n\t\t\tvariantAliases=( \"${versionAliases[@]/%/-$variant}\" )\n\t\t\tvariantAliases=( \"${variantAliases[@]//latest-/}\" )\n\t\tfi\n\n\t\tparent=\"$(gawk 'toupper($1) == \"FROM\" { print $2 }' \"$dir/Dockerfile\")\"\n\t\tarches=\"${parentRepoToArches[$parent]}\"\n\n\t\tsuite=\"${parent#*:}\" # \"bookworm-slim\", \"bookworm\"\n\t\tsuite=\"${suite%-slim}\" # \"bookworm\"\n\t\tif [ \"$variant\" = 'alpine' ]; then\n\t\t\tsuite=\"alpine$suite\" # \"alpine3.18\"\n\t\tfi\n\t\tsuiteAliases=( \"${versionAliases[@]/%/-$suite}\" )\n\t\tsuiteAliases=( \"${suiteAliases[@]//latest-/}\" )\n\t\tvariantAliases+=( \"${suiteAliases[@]}\" )\n\n\t\t# calculate the intersection of parent image arches and gosu arches\n\t\tarches=\"$(jq -r --arg arches \"$arches\" '\n\t\t\t(\n\t\t\t\t$arches\n\t\t\t\t| gsub(\"^[[:space:]]+|[[:space:]]+$\"; \"\")\n\t\t\t\t| split(\"[[:space:]]+\"; \"\")\n\t\t\t) as $parentArches\n\t\t\t| .[env.version]\n\t\t\t| $parentArches - ($parentArches - (.gosu.arches | keys))\n\t\t\t| join(\", \")\n\t\t' versions.json)\"\n\n\t\techo\n\t\tcat <<-EOE\n\t\t\tTags: $(join ', ' \"${variantAliases[@]}\")\n\t\t\tArchitectures: $arches\n\t\t\tGitCommit: $commit\n\t\t\tDirectory: $dir\n\t\tEOE\n\tdone\ndone\n"
        },
        {
          "name": "generate-stackbrew-library.sh",
          "type": "blob",
          "size": 3.2783203125,
          "content": "#!/usr/bin/env bash\nset -Eeuo pipefail\n\ndeclare -A aliases=(\n\t[7.4]='7 latest'\n\t[6.2]='6'\n)\n\nself=\"$(basename \"$BASH_SOURCE\")\"\ncd \"$(dirname \"$(readlink -f \"$BASH_SOURCE\")\")\"\n\nif [ \"$#\" -eq 0 ]; then\n\tversions=\"$(jq -r 'keys | map(@sh) | join(\" \")' versions.json)\"\n\teval \"set -- $versions\"\nfi\n\n# sort version numbers with highest first\nIFS=$'\\n'; set -- $(sort -rV <<<\"$*\"); unset IFS\n\n# get the most recent commit which modified any of \"$@\"\nfileCommit() {\n\tgit log -1 --format='format:%H' HEAD -- \"$@\"\n}\n\n# get the most recent commit which modified \"$1/Dockerfile\" or any file COPY'd from \"$1/Dockerfile\"\ndirCommit() {\n\tlocal dir=\"$1\"; shift\n\t(\n\t\tcd \"$dir\"\n\t\tfileCommit \\\n\t\t\tDockerfile \\\n\t\t\t$(git show HEAD:./Dockerfile | awk '\n\t\t\t\ttoupper($1) == \"COPY\" {\n\t\t\t\t\tfor (i = 2; i < NF; i++) {\n\t\t\t\t\t\tprint $i\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t')\n\t)\n}\n\ngetArches() {\n\tlocal repo=\"$1\"; shift\n\tlocal officialImagesUrl='https://github.com/docker-library/official-images/raw/master/library/'\n\n\teval \"declare -g -A parentRepoToArches=( $(\n\t\tfind -name 'Dockerfile' -exec awk '\n\t\t\t\ttoupper($1) == \"FROM\" && $2 !~ /^('\"$repo\"'|scratch|.*\\/.*)(:|$)/ {\n\t\t\t\t\tprint \"'\"$officialImagesUrl\"'\" $2\n\t\t\t\t}\n\t\t\t' '{}' + \\\n\t\t\t| sort -u \\\n\t\t\t| xargs bashbrew cat --format '[{{ .RepoName }}:{{ .TagName }}]=\"{{ join \" \" .TagEntry.Architectures }}\"'\n\t) )\"\n}\ngetArches 'redis'\n\ncat <<-EOH\n# This file was generated via https://github.com/redis/docker-library-redis/blob/$(fileCommit \"$self\")/$self\n\nMaintainers: David Maier <david.maier@redis.com> (@dmaier-redislabs),\n             Yossi Gottlieb <yossi@redis.com> (@yossigo)\nGitRepo: https://github.com/redis/docker-library-redis.git\nEOH\n\n# prints \"$2$1$3$1...$N\"\njoin() {\n\tlocal sep=\"$1\"; shift\n\tlocal out; printf -v out \"${sep//%/%%}%s\" \"$@\"\n\techo \"${out#$sep}\"\n}\n\nfor version; do\n\texport version\n\n\tfullVersion=\"$(jq -r '.[env.version].version' versions.json)\"\n\n\tversionAliases=()\n\twhile [ \"$fullVersion\" != \"$version\" ] && [ \"${fullVersion%.*}\" != \"$fullVersion\" ]; do\n\t\tversionAliases+=( $fullVersion )\n\t\tfullVersion=\"${fullVersion%.*}\"\n\tdone\n\tversionAliases+=(\n\t\t$version\n\t\t${aliases[$version]:-}\n\t)\n\n\tfor variant in debian alpine; do\n\t\texport variant\n\t\tdir=\"$version/$variant\"\n\n\t\tcommit=\"$(dirCommit \"$dir\")\"\n\n\t\tif [ \"$variant\" = 'debian' ]; then\n\t\t\tvariantAliases=( \"${versionAliases[@]}\" )\n\t\telse\n\t\t\tvariantAliases=( \"${versionAliases[@]/%/-$variant}\" )\n\t\t\tvariantAliases=( \"${variantAliases[@]//latest-/}\" )\n\t\tfi\n\n\t\tparent=\"$(awk 'toupper($1) == \"FROM\" { print $2 }' \"$dir/Dockerfile\")\"\n\t\tarches=\"${parentRepoToArches[$parent]}\"\n\n\t\tsuite=\"${parent#*:}\" # \"bookworm-slim\", \"bookworm\"\n\t\tsuite=\"${suite%-slim}\" # \"bookworm\"\n\t\tif [ \"$variant\" = 'alpine' ]; then\n\t\t\tsuite=\"alpine$suite\" # \"alpine3.18\"\n\t\tfi\n\t\tsuiteAliases=( \"${versionAliases[@]/%/-$suite}\" )\n\t\tsuiteAliases=( \"${suiteAliases[@]//latest-/}\" )\n\t\tvariantAliases+=( \"${suiteAliases[@]}\" )\n\n\t\t# calculate the intersection of parent image arches and gosu arches\n\t\tarches=\"$(jq -r --arg arches \"$arches\" '\n\t\t\t(\n\t\t\t\t$arches\n\t\t\t\t| gsub(\"^[[:space:]]+|[[:space:]]+$\"; \"\")\n\t\t\t\t| split(\"[[:space:]]+\"; \"\")\n\t\t\t) as $parentArches\n\t\t\t| .[env.version]\n\t\t\t| $parentArches - ($parentArches - (.gosu.arches | keys))\n\t\t\t| join(\", \")\n\t\t' versions.json)\"\n\n\t\techo\n\t\tcat <<-EOE\n\t\t\tTags: $(join ', ' \"${variantAliases[@]}\")\n\t\t\tArchitectures: $arches\n\t\t\tGitCommit: $commit\n\t\t\tDirectory: $dir\n\t\tEOE\n\tdone\ndone\n"
        },
        {
          "name": "stackbrew-generated",
          "type": "tree",
          "content": null
        },
        {
          "name": "update.sh",
          "type": "blob",
          "size": 0.130859375,
          "content": "#!/usr/bin/env bash\nset -Eeuo pipefail\n\ncd \"$(dirname \"$(readlink -f \"$BASH_SOURCE\")\")\"\n\n./versions.sh \"$@\"\n./apply-templates.sh \"$@\"\n"
        },
        {
          "name": "versions.json",
          "type": "blob",
          "size": 11.7177734375,
          "content": "{\n  \"6.2\": {\n    \"version\": \"6.2.17\",\n    \"url\": \"http://download.redis.io/releases/redis-6.2.17.tar.gz\",\n    \"sha256\": \"f7aab300407aaa005bc1a688e61287111f4ae13ed657ec50ef4ab529893ddc30\",\n    \"debian\": {\n      \"version\": \"bookworm\"\n    },\n    \"alpine\": {\n      \"version\": \"3.21\"\n    },\n    \"gosu\": {\n      \"version\": \"1.17\",\n      \"arches\": {\n        \"amd64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-amd64\",\n          \"sha256\": \"bbc4136d03ab138b1ad66fa4fc051bafc6cc7ffae632b069a53657279a450de3\"\n        },\n        \"arm64v8\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-arm64\",\n          \"sha256\": \"c3805a85d17f4454c23d7059bcb97e1ec1af272b90126e79ed002342de08389b\"\n        },\n        \"arm32v5\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armel\",\n          \"sha256\": \"f9969910fa141140438c998cfa02f603bf213b11afd466dcde8fa940e700945d\"\n        },\n        \"arm32v6\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        },\n        \"i386\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-i386\",\n          \"sha256\": \"087dbb8fe479537e64f9c86fa49ff3b41dee1cbd28739a19aaef83dc8186b1ca\"\n        },\n        \"mips64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-mips64el\",\n          \"sha256\": \"87140029d792595e660be0015341dfa1c02d1181459ae40df9f093e471d75b70\"\n        },\n        \"ppc64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-ppc64el\",\n          \"sha256\": \"1891acdcfa70046818ab6ed3c52b9d42fa10fbb7b340eb429c8c7849691dbd76\"\n        },\n        \"riscv64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-riscv64\",\n          \"sha256\": \"38a6444b57adce135c42d5a3689f616fc7803ddc7a07ff6f946f2ebc67a26ba6\"\n        },\n        \"s390x\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-s390x\",\n          \"sha256\": \"69873bab588192f760547ca1f75b27cfcf106e9f7403fee6fd0600bc914979d0\"\n        },\n        \"arm32v7\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        }\n      }\n    }\n  },\n  \"7.0\": {\n    \"version\": \"7.0.15\",\n    \"url\": \"http://download.redis.io/releases/redis-7.0.15.tar.gz\",\n    \"sha256\": \"98066f5363504b26c34dd20fbcc3c957990d764cdf42576c836fc021073f4341\",\n    \"debian\": {\n      \"version\": \"bookworm\"\n    },\n    \"alpine\": {\n      \"version\": \"3.21\"\n    },\n    \"gosu\": {\n      \"version\": \"1.17\",\n      \"arches\": {\n        \"amd64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-amd64\",\n          \"sha256\": \"bbc4136d03ab138b1ad66fa4fc051bafc6cc7ffae632b069a53657279a450de3\"\n        },\n        \"arm64v8\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-arm64\",\n          \"sha256\": \"c3805a85d17f4454c23d7059bcb97e1ec1af272b90126e79ed002342de08389b\"\n        },\n        \"arm32v5\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armel\",\n          \"sha256\": \"f9969910fa141140438c998cfa02f603bf213b11afd466dcde8fa940e700945d\"\n        },\n        \"arm32v6\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        },\n        \"i386\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-i386\",\n          \"sha256\": \"087dbb8fe479537e64f9c86fa49ff3b41dee1cbd28739a19aaef83dc8186b1ca\"\n        },\n        \"mips64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-mips64el\",\n          \"sha256\": \"87140029d792595e660be0015341dfa1c02d1181459ae40df9f093e471d75b70\"\n        },\n        \"ppc64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-ppc64el\",\n          \"sha256\": \"1891acdcfa70046818ab6ed3c52b9d42fa10fbb7b340eb429c8c7849691dbd76\"\n        },\n        \"riscv64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-riscv64\",\n          \"sha256\": \"38a6444b57adce135c42d5a3689f616fc7803ddc7a07ff6f946f2ebc67a26ba6\"\n        },\n        \"s390x\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-s390x\",\n          \"sha256\": \"69873bab588192f760547ca1f75b27cfcf106e9f7403fee6fd0600bc914979d0\"\n        },\n        \"arm32v7\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        }\n      }\n    }\n  },\n  \"7.2\": {\n    \"version\": \"7.2.7\",\n    \"url\": \"http://download.redis.io/releases/redis-7.2.7.tar.gz\",\n    \"sha256\": \"72c081e3b8cfae7144273d26d76736f08319000af46c01515cad5d29765cead5\",\n    \"debian\": {\n      \"version\": \"bookworm\"\n    },\n    \"alpine\": {\n      \"version\": \"3.21\"\n    },\n    \"gosu\": {\n      \"version\": \"1.17\",\n      \"arches\": {\n        \"amd64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-amd64\",\n          \"sha256\": \"bbc4136d03ab138b1ad66fa4fc051bafc6cc7ffae632b069a53657279a450de3\"\n        },\n        \"arm64v8\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-arm64\",\n          \"sha256\": \"c3805a85d17f4454c23d7059bcb97e1ec1af272b90126e79ed002342de08389b\"\n        },\n        \"arm32v5\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armel\",\n          \"sha256\": \"f9969910fa141140438c998cfa02f603bf213b11afd466dcde8fa940e700945d\"\n        },\n        \"arm32v6\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        },\n        \"i386\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-i386\",\n          \"sha256\": \"087dbb8fe479537e64f9c86fa49ff3b41dee1cbd28739a19aaef83dc8186b1ca\"\n        },\n        \"mips64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-mips64el\",\n          \"sha256\": \"87140029d792595e660be0015341dfa1c02d1181459ae40df9f093e471d75b70\"\n        },\n        \"ppc64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-ppc64el\",\n          \"sha256\": \"1891acdcfa70046818ab6ed3c52b9d42fa10fbb7b340eb429c8c7849691dbd76\"\n        },\n        \"riscv64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-riscv64\",\n          \"sha256\": \"38a6444b57adce135c42d5a3689f616fc7803ddc7a07ff6f946f2ebc67a26ba6\"\n        },\n        \"s390x\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-s390x\",\n          \"sha256\": \"69873bab588192f760547ca1f75b27cfcf106e9f7403fee6fd0600bc914979d0\"\n        },\n        \"arm32v7\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        }\n      }\n    }\n  },\n  \"7.4-rc\": {\n    \"version\": \"7.4-rc2\",\n    \"url\": \"http://download.redis.io/releases/redis-7.4-rc2.tar.gz\",\n    \"sha256\": \"6f3ca6e196b5757bf51752ea9944cbc927731c771aeab661be8c2c05bd1edbce\",\n    \"debian\": {\n      \"version\": \"bookworm\"\n    },\n    \"alpine\": {\n      \"version\": \"3.21\"\n    },\n    \"gosu\": {\n      \"version\": \"1.17\",\n      \"arches\": {\n        \"amd64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-amd64\",\n          \"sha256\": \"bbc4136d03ab138b1ad66fa4fc051bafc6cc7ffae632b069a53657279a450de3\"\n        },\n        \"arm64v8\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-arm64\",\n          \"sha256\": \"c3805a85d17f4454c23d7059bcb97e1ec1af272b90126e79ed002342de08389b\"\n        },\n        \"arm32v5\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armel\",\n          \"sha256\": \"f9969910fa141140438c998cfa02f603bf213b11afd466dcde8fa940e700945d\"\n        },\n        \"arm32v6\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        },\n        \"i386\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-i386\",\n          \"sha256\": \"087dbb8fe479537e64f9c86fa49ff3b41dee1cbd28739a19aaef83dc8186b1ca\"\n        },\n        \"mips64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-mips64el\",\n          \"sha256\": \"87140029d792595e660be0015341dfa1c02d1181459ae40df9f093e471d75b70\"\n        },\n        \"ppc64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-ppc64el\",\n          \"sha256\": \"1891acdcfa70046818ab6ed3c52b9d42fa10fbb7b340eb429c8c7849691dbd76\"\n        },\n        \"riscv64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-riscv64\",\n          \"sha256\": \"38a6444b57adce135c42d5a3689f616fc7803ddc7a07ff6f946f2ebc67a26ba6\"\n        },\n        \"s390x\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-s390x\",\n          \"sha256\": \"69873bab588192f760547ca1f75b27cfcf106e9f7403fee6fd0600bc914979d0\"\n        },\n        \"arm32v7\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        }\n      }\n    }\n  },\n  \"7.4\": {\n    \"version\": \"7.4.2\",\n    \"url\": \"http://download.redis.io/releases/redis-7.4.2.tar.gz\",\n    \"sha256\": \"4ddebbf09061cbb589011786febdb34f29767dd7f89dbe712d2b68e808af6a1f\",\n    \"debian\": {\n      \"version\": \"bookworm\"\n    },\n    \"alpine\": {\n      \"version\": \"3.21\"\n    },\n    \"gosu\": {\n      \"version\": \"1.17\",\n      \"arches\": {\n        \"amd64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-amd64\",\n          \"sha256\": \"bbc4136d03ab138b1ad66fa4fc051bafc6cc7ffae632b069a53657279a450de3\"\n        },\n        \"arm64v8\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-arm64\",\n          \"sha256\": \"c3805a85d17f4454c23d7059bcb97e1ec1af272b90126e79ed002342de08389b\"\n        },\n        \"arm32v5\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armel\",\n          \"sha256\": \"f9969910fa141140438c998cfa02f603bf213b11afd466dcde8fa940e700945d\"\n        },\n        \"arm32v6\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        },\n        \"i386\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-i386\",\n          \"sha256\": \"087dbb8fe479537e64f9c86fa49ff3b41dee1cbd28739a19aaef83dc8186b1ca\"\n        },\n        \"mips64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-mips64el\",\n          \"sha256\": \"87140029d792595e660be0015341dfa1c02d1181459ae40df9f093e471d75b70\"\n        },\n        \"ppc64le\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-ppc64el\",\n          \"sha256\": \"1891acdcfa70046818ab6ed3c52b9d42fa10fbb7b340eb429c8c7849691dbd76\"\n        },\n        \"riscv64\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-riscv64\",\n          \"sha256\": \"38a6444b57adce135c42d5a3689f616fc7803ddc7a07ff6f946f2ebc67a26ba6\"\n        },\n        \"s390x\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-s390x\",\n          \"sha256\": \"69873bab588192f760547ca1f75b27cfcf106e9f7403fee6fd0600bc914979d0\"\n        },\n        \"arm32v7\": {\n          \"url\": \"https://github.com/tianon/gosu/releases/download/1.17/gosu-armhf\",\n          \"sha256\": \"e5866286277ff2a2159fb9196fea13e0a59d3f1091ea46ddb985160b94b6841b\"\n        }\n      }\n    }\n  }\n}\n"
        },
        {
          "name": "versions.sh",
          "type": "blob",
          "size": 3.7646484375,
          "content": "#!/usr/bin/env bash\nset -Eeuo pipefail\n\nalpine=\"$(\n\tbashbrew cat --format '{{ .TagEntry.Tags | join \"\\n\" }}' https://github.com/docker-library/official-images/raw/HEAD/library/alpine:latest \\\n\t\t| grep -E '^[0-9]+[.][0-9]+$'\n)\"\n[ \"$(wc -l <<<\"$alpine\")\" = 1 ]\nexport alpine\n\ndebian=\"$(\n\tbashbrew cat --format '{{ .TagEntry.Tags | join \"\\n\" }}' https://github.com/docker-library/official-images/raw/HEAD/library/debian:latest \\\n\t\t| grep -vE '^latest$|[0-9.-]' \\\n\t\t| head -1\n)\"\n[ \"$(wc -l <<<\"$debian\")\" = 1 ]\nexport debian\n\ngosus=\"$(\n\tgit ls-remote --tags https://github.com/tianon/gosu.git \\\n\t\t| cut -d/ -f3- \\\n\t\t| cut -d^ -f1 \\\n\t\t| grep -E '^[0-9]+' \\\n\t\t| sort -urV\n)\"\ngosu=\nfor possible in $gosus; do\n\turlBase=\"https://github.com/tianon/gosu/releases/download/$possible\"\n\tif shas=\"$(wget -qO- \"$urlBase/SHA256SUMS\")\" && [ -n \"$shas\" ]; then\n\t\tgosu=\"$(jq <<<\"$shas\" -csR --arg version \"$possible\" --arg urlBase \"$urlBase\" '{\n\t\t\tversion: $version,\n\t\t\tarches: (\n\t\t\t\trtrimstr(\"\\n\")\n\t\t\t\t| split(\"\\n\")\n\t\t\t\t| map(\n\t\t\t\t\t# this capture will naturally ignore the \".asc\" file checksums\n\t\t\t\t\tcapture(\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"^(?<sha256>[0-9a-f]{64})\",\n\t\t\t\t\t\t\t\"(  | [*])\",\n\t\t\t\t\t\t\t\"(?<file>\",\n\t\t\t\t\t\t\t\t\"gosu-\",\n\t\t\t\t\t\t\t\t\"(?<dpkgArch>[^_. -]+)\",\n\t\t\t\t\t\t\t\")$\"\n\t\t\t\t\t\t] | join(\"\")\n\t\t\t\t\t)\n\t\t\t\t\t| {\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t# convert dpkg arch into bashbrew arch\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t# https://salsa.debian.org/dpkg-team/dpkg/-/blob/main/data/cputable\n\t\t\t\t\t\t\t\t# https://wiki.debian.org/ArchitectureSpecificsMemo#Architecture_baselines\n\t\t\t\t\t\t\t\t# http://deb.debian.org/debian/dists/unstable/main/\n\t\t\t\t\t\t\t\t# http://deb.debian.org/debian/dists/stable/main/\n\t\t\t\t\t\t\t\t# https://deb.debian.org/debian-ports/dists/unstable/main/\n\t\t\t\t\t\t\t\tamd64: \"amd64\",\n\t\t\t\t\t\t\t\tarmel: \"arm32v5\",\n\t\t\t\t\t\t\t\tarmhf: \"arm32v6\", # https://github.com/tianon/gosu/blob/2dada3bb5dfbc1e7162a29907691b6f45995d54e/Dockerfile#L52-L53\n\t\t\t\t\t\t\t\tarm64: \"arm64v8\",\n\t\t\t\t\t\t\t\ti386: \"i386\",\n\t\t\t\t\t\t\t\tmips64el: \"mips64le\",\n\t\t\t\t\t\t\t\tppc64el: \"ppc64le\",\n\t\t\t\t\t\t\t\triscv64: \"riscv64\",\n\t\t\t\t\t\t\t\ts390x: \"s390x\",\n\t\t\t\t\t\t\t}[.dpkgArch] // empty\n\t\t\t\t\t\t): {\n\t\t\t\t\t\t\turl: ($urlBase + \"/\" + .file),\n\t\t\t\t\t\t\tsha256: .sha256,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t| add\n\t\t\t\t| if has(\"arm32v6\") and (has(\"arm32v7\") | not) then\n\t\t\t\t\t.arm32v7 = .arm32v6\n\t\t\t\telse . end\n\t\t\t),\n\t\t}')\"\n\t\tbreak\n\tfi\ndone\n[ -n \"$gosu\" ]\nexport gosu\n\ncd \"$(dirname \"$(readlink -f \"$BASH_SOURCE\")\")\"\n\nversions=( \"$@\" )\nif [ ${#versions[@]} -eq 0 ]; then\n\tversions=( */ )\n\tjson='{}'\nelse\n\tjson=\"$(< versions.json)\"\nfi\nversions=( \"${versions[@]%/}\" )\n\npackages=\"$(\n\twget -qO- 'https://github.com/redis/redis-hashes/raw/master/README' \\\n\t\t| jq -csR '\n\t\t\trtrimstr(\"\\n\")\n\t\t\t| split(\"\\n\")\n\t\t\t| map(\n\t\t\t\t# this capture will naturally ignore comments and blank lines\n\t\t\t\tcapture(\n\t\t\t\t\t[\n\t\t\t\t\t\t\"^hash[[:space:]]+\",\n\t\t\t\t\t\t\"(?<file>redis-\",\n\t\t\t\t\t\t\"(?<version>([0-9.]+)(-rc[0-9]+)?)\",\n\t\t\t\t\t\t\"[.][^[:space:]]+)[[:space:]]+\",\n\t\t\t\t\t\t\"(?<type>sha256|sha1)[[:space:]]+\", # this filters us down to just the checksum types we are prepared to handle right now\n\t\t\t\t\t\t\"(?<sum>[0-9a-f]{64}|[0-9a-f]{40})[[:space:]]+\",\n\t\t\t\t\t\t\"(?<url>[^[:space:]]+)\",\n\t\t\t\t\t\t\"$\"\n\t\t\t\t\t] | join(\"\")\n\t\t\t\t)\n\t\t\t\t| {\n\t\t\t\t\tversion: .version,\n\t\t\t\t\turl: .url,\n\t\t\t\t\t(.type): .sum,\n\t\t\t\t}\n\t\t\t)\n\t\t'\n)\"\n\nfor version in \"${versions[@]}\"; do\n\texport version rcVersion=\"${version%-rc}\"\n\n\tdoc=\"$(\n\t\tjq <<<\"$packages\" -c '\n\t\t\tmap(\n\t\t\t\tselect(\n\t\t\t\t\t.version\n\t\t\t\t\t| (\n\t\t\t\t\t\tstartswith(env.rcVersion + \".\")\n\t\t\t\t\t\tor startswith(env.rcVersion + \"-\")\n\t\t\t\t\t) and (\n\t\t\t\t\t\tindex(\"-\")\n\t\t\t\t\t\t| if env.version == env.rcVersion then not else . end\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t)[-1]\n\t\t'\n\t)\"\n\n\tfullVersion=\"$(jq <<<\"$doc\" -r '.version')\"\n\techo \"$version: $fullVersion\"\n\n\tjson=\"$(jq <<<\"$json\" -c --argjson doc \"$doc\" '\n\t\t.[env.version] = ($doc + {\n\t\t\tdebian: { version: env.debian },\n\t\t\talpine: { version: env.alpine },\n\t\t\tgosu: (env.gosu | fromjson),\n\t\t})\n\t')\"\ndone\n\njq <<<\"$json\" . > versions.json\n"
        }
      ]
    }
  ]
}