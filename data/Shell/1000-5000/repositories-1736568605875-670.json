{
  "metadata": {
    "timestamp": 1736568605875,
    "page": 670,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjY3OQ==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "konstruktoid/hardening",
      "stars": 1401,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitattributes",
          "type": "blob",
          "size": 0.369140625,
          "content": "# Auto detect text files and perform LF normalization\n* text=auto\n\n# Custom for Visual Studio\n*.cs     diff=csharp\n\n# Standard to msysgit\n*.doc\t diff=astextplain\n*.DOC\t diff=astextplain\n*.docx diff=astextplain\n*.DOCX diff=astextplain\n*.dot  diff=astextplain\n*.DOT  diff=astextplain\n*.pdf  diff=astextplain\n*.PDF\t diff=astextplain\n*.rtf\t diff=astextplain\n*.RTF\t diff=astextplain\n"
        },
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.0771484375,
          "content": "*.html\n*.log\n*.vagrant\n*.vdi\n.scannerwork\n.sonar\nTESTRESULTS.adoc\ntests/*.adoc\n"
        },
        {
          "name": ".pre-commit-config.yaml",
          "type": "blob",
          "size": 0.3154296875,
          "content": "repos:\n- repo: https://github.com/gitleaks/gitleaks\n  rev: v8.16.3\n  hooks:\n  - id: gitleaks\n- repo: https://github.com/jumanjihouse/pre-commit-hooks\n  rev: 3.0.0\n  hooks:\n  - id: shellcheck\n- repo: https://github.com/pre-commit/pre-commit-hooks\n  rev: v4.4.0\n  hooks:\n  - id: end-of-file-fixer\n  - id: trailing-whitespace\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 11.080078125,
          "content": "\n                                 Apache License\n                           Version 2.0, January 2004\n                        http://www.apache.org/licenses/\n\n   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION\n\n   1. Definitions.\n\n      \"License\" shall mean the terms and conditions for use, reproduction,\n      and distribution as defined by Sections 1 through 9 of this document.\n\n      \"Licensor\" shall mean the copyright owner or entity authorized by\n      the copyright owner that is granting the License.\n\n      \"Legal Entity\" shall mean the union of the acting entity and all\n      other entities that control, are controlled by, or are under common\n      control with that entity. For the purposes of this definition,\n      \"control\" means (i) the power, direct or indirect, to cause the\n      direction or management of such entity, whether by contract or\n      otherwise, or (ii) ownership of fifty percent (50%) or more of the\n      outstanding shares, or (iii) beneficial ownership of such entity.\n\n      \"You\" (or \"Your\") shall mean an individual or Legal Entity\n      exercising permissions granted by this License.\n\n      \"Source\" form shall mean the preferred form for making modifications,\n      including but not limited to software source code, documentation\n      source, and configuration files.\n\n      \"Object\" form shall mean any form resulting from mechanical\n      transformation or translation of a Source form, including but\n      not limited to compiled object code, generated documentation,\n      and conversions to other media types.\n\n      \"Work\" shall mean the work of authorship, whether in Source or\n      Object form, made available under the License, as indicated by a\n      copyright notice that is included in or attached to the work\n      (an example is provided in the Appendix below).\n\n      \"Derivative Works\" shall mean any work, whether in Source or Object\n      form, that is based on (or derived from) the Work and for which the\n      editorial revisions, annotations, elaborations, or other modifications\n      represent, as a whole, an original work of authorship. For the purposes\n      of this License, Derivative Works shall not include works that remain\n      separable from, or merely link (or bind by name) to the interfaces of,\n      the Work and Derivative Works thereof.\n\n      \"Contribution\" shall mean any work of authorship, including\n      the original version of the Work and any modifications or additions\n      to that Work or Derivative Works thereof, that is intentionally\n      submitted to Licensor for inclusion in the Work by the copyright owner\n      or by an individual or Legal Entity authorized to submit on behalf of\n      the copyright owner. For the purposes of this definition, \"submitted\"\n      means any form of electronic, verbal, or written communication sent\n      to the Licensor or its representatives, including but not limited to\n      communication on electronic mailing lists, source code control systems,\n      and issue tracking systems that are managed by, or on behalf of, the\n      Licensor for the purpose of discussing and improving the Work, but\n      excluding communication that is conspicuously marked or otherwise\n      designated in writing by the copyright owner as \"Not a Contribution.\"\n\n      \"Contributor\" shall mean Licensor and any individual or Legal Entity\n      on behalf of whom a Contribution has been received by Licensor and\n      subsequently incorporated within the Work.\n\n   2. Grant of Copyright License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      copyright license to reproduce, prepare Derivative Works of,\n      publicly display, publicly perform, sublicense, and distribute the\n      Work and such Derivative Works in Source or Object form.\n\n   3. Grant of Patent License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      (except as stated in this section) patent license to make, have made,\n      use, offer to sell, sell, import, and otherwise transfer the Work,\n      where such license applies only to those patent claims licensable\n      by such Contributor that are necessarily infringed by their\n      Contribution(s) alone or by combination of their Contribution(s)\n      with the Work to which such Contribution(s) was submitted. If You\n      institute patent litigation against any entity (including a\n      cross-claim or counterclaim in a lawsuit) alleging that the Work\n      or a Contribution incorporated within the Work constitutes direct\n      or contributory patent infringement, then any patent licenses\n      granted to You under this License for that Work shall terminate\n      as of the date such litigation is filed.\n\n   4. Redistribution. You may reproduce and distribute copies of the\n      Work or Derivative Works thereof in any medium, with or without\n      modifications, and in Source or Object form, provided that You\n      meet the following conditions:\n\n      (a) You must give any other recipients of the Work or\n          Derivative Works a copy of this License; and\n\n      (b) You must cause any modified files to carry prominent notices\n          stating that You changed the files; and\n\n      (c) You must retain, in the Source form of any Derivative Works\n          that You distribute, all copyright, patent, trademark, and\n          attribution notices from the Source form of the Work,\n          excluding those notices that do not pertain to any part of\n          the Derivative Works; and\n\n      (d) If the Work includes a \"NOTICE\" text file as part of its\n          distribution, then any Derivative Works that You distribute must\n          include a readable copy of the attribution notices contained\n          within such NOTICE file, excluding those notices that do not\n          pertain to any part of the Derivative Works, in at least one\n          of the following places: within a NOTICE text file distributed\n          as part of the Derivative Works; within the Source form or\n          documentation, if provided along with the Derivative Works; or,\n          within a display generated by the Derivative Works, if and\n          wherever such third-party notices normally appear. The contents\n          of the NOTICE file are for informational purposes only and\n          do not modify the License. You may add Your own attribution\n          notices within Derivative Works that You distribute, alongside\n          or as an addendum to the NOTICE text from the Work, provided\n          that such additional attribution notices cannot be construed\n          as modifying the License.\n\n      You may add Your own copyright statement to Your modifications and\n      may provide additional or different license terms and conditions\n      for use, reproduction, or distribution of Your modifications, or\n      for any such Derivative Works as a whole, provided Your use,\n      reproduction, and distribution of the Work otherwise complies with\n      the conditions stated in this License.\n\n   5. Submission of Contributions. Unless You explicitly state otherwise,\n      any Contribution intentionally submitted for inclusion in the Work\n      by You to the Licensor shall be under the terms and conditions of\n      this License, without any additional terms or conditions.\n      Notwithstanding the above, nothing herein shall supersede or modify\n      the terms of any separate license agreement you may have executed\n      with Licensor regarding such Contributions.\n\n   6. Trademarks. This License does not grant permission to use the trade\n      names, trademarks, service marks, or product names of the Licensor,\n      except as required for reasonable and customary use in describing the\n      origin of the Work and reproducing the content of the NOTICE file.\n\n   7. Disclaimer of Warranty. Unless required by applicable law or\n      agreed to in writing, Licensor provides the Work (and each\n      Contributor provides its Contributions) on an \"AS IS\" BASIS,\n      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n      implied, including, without limitation, any warranties or conditions\n      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A\n      PARTICULAR PURPOSE. You are solely responsible for determining the\n      appropriateness of using or redistributing the Work and assume any\n      risks associated with Your exercise of permissions under this License.\n\n   8. Limitation of Liability. In no event and under no legal theory,\n      whether in tort (including negligence), contract, or otherwise,\n      unless required by applicable law (such as deliberate and grossly\n      negligent acts) or agreed to in writing, shall any Contributor be\n      liable to You for damages, including any direct, indirect, special,\n      incidental, or consequential damages of any character arising as a\n      result of this License or out of the use or inability to use the\n      Work (including but not limited to damages for loss of goodwill,\n      work stoppage, computer failure or malfunction, or any and all\n      other commercial damages or losses), even if such Contributor\n      has been advised of the possibility of such damages.\n\n   9. Accepting Warranty or Additional Liability. While redistributing\n      the Work or Derivative Works thereof, You may choose to offer,\n      and charge a fee for, acceptance of support, warranty, indemnity,\n      or other liability obligations and/or rights consistent with this\n      License. However, in accepting such obligations, You may act only\n      on Your own behalf and on Your sole responsibility, not on behalf\n      of any other Contributor, and only if You agree to indemnify,\n      defend, and hold each Contributor harmless for any liability\n      incurred by, or claims asserted against, such Contributor by reason\n      of your accepting any such warranty or additional liability.\n\n   END OF TERMS AND CONDITIONS\n\n   APPENDIX: How to apply the Apache License to your work.\n\n      To apply the Apache License to your work, attach the following\n      boilerplate notice, with the fields enclosed by brackets \"[]\"\n      replaced with your own identifying information. (Don't include\n      the brackets!)  The text should be enclosed in the appropriate\n      comment syntax for the file format. We also recommend that a\n      file or class name and description of purpose be included on the\n      same \"printed page\" as the copyright notice for easier\n      identification within third-party archives.\n\n   Copyright 2018 Thomas Sjögren\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n"
        },
        {
          "name": "README.adoc",
          "type": "blob",
          "size": 22.9853515625,
          "content": "image::logo/horizontal.png[Ubuntu Hardening]\n= Hardening Ubuntu. Systemd edition.\n\n:icons: font\n\nA quick way to make a Ubuntu server a bit more secure.\n\nUse the newly installed and configured system as a reference,\nor golden, image. Use that image as a baseline installation media and ensure\nthat any future installation comply with benchmarks and policies using a\nconfiguration management tool, e.g https://www.ansible.com/[Ansible] or\nhttps://puppet.com/[Puppet].\n\nTested on `Ubuntu 20.04 Focal Fossa` and `Ubuntu 22.04 Jammy Jellyfish`.\n\nIf you're just interested in the security focused systemd configuration, it's\navailable as a link:systemd.adoc[separate document].\n\nIf you're interested in testing your host settings, you'll find the\nlink:README.adoc#tests[instructions here].\n\nNOTE: Read the code and do not run this script without first testing in a\nnon-operational environment. The code is *not* idempotent, use the https://github.com/konstruktoid/ansible-role-hardening[Ansible role] in production environments instead.\n\nNOTE: There is a https://slsa.dev/[SLSA] artifact present under the\nhttps://github.com/konstruktoid/hardening/actions/workflows/slsa.yml[slsa workflow]\nfor file checksum verification.\n\n== Packer template and Ansible playbook\n\nA https://www.packer.io/[Packer] template is available in the link:packer/[Packer directory].\n\nAn Ansible playbook is available in the https://github.com/konstruktoid/ansible-role-hardening[konstruktoid/ansible-role-hardening]\nrepository.\n\n== Howto\n\n. Start the server installation.\n. Pick language and keyboard layout.\n. Select \"Ubuntu Server (minimized)\".\n. Configure network connections.\n. Partition the system, see below for recommendations.\n. Do not install the OpenSSH server, \"Featured Server Snaps\", or any other packages.\n. Finish the installation and reboot.\n. Log in.\n. If wanted, set a Grub2 password with `grub-mkpasswd-pbkdf2`. See https://help.ubuntu.com/community/Grub2/Passwords[https://help.ubuntu.com/community/Grub2/Passwords]\nfor more information.\n. Install necessary packages: `sudo apt-get -y install git net-tools procps --no-install-recommends`.\n. Download the script: `git clone https://github.com/konstruktoid/hardening.git`.\n. Change the configuration options in the `ubuntu.cfg` file. Make sure to update the CHANGEME variable otherwise the script will fail.\n. Run the script: `sudo bash ubuntu.sh`.\n. Reboot.\n\n=== Recommended partitions and options\n\n[source,shell]\n----\n/boot (rw)\n/home (rw,nosuid,nodev)\n/var/log (rw,nosuid,nodev,noexec)\n/var/log/audit (rw,nosuid,nodev,noexec)\n/var/tmp (rw,nosuid,nodev,noexec)\n----\n\nNote that `/tmp` will be added automatically by the script.\n\n== Configuration options\n\n[source,shell]\n----\nFW_ADMIN='127.0.0.1' // <1>\nSSH_GRPS='sudo' // <2>\nSSH_PORT='22' // <3>\nSYSCTL_CONF='./misc/sysctl.conf' // <4>\nAUDITD_MODE='1' // <5>\nAUDITD_RULES='./misc/audit-base.rules ./misc/audit-aggressive.rules ./misc/audit-docker.rules' // <6>\nLOGROTATE_CONF='./misc/logrotate.conf' // <7>\nNTPSERVERPOOL='0.ubuntu.pool.ntp.org 1.ubuntu.pool.ntp.org 2.ubuntu.pool.ntp.org 3.ubuntu.pool.ntp.org pool.ntp.org' // <8>\nTIMEDATECTL='' // <9>\nVERBOSE='N' // <10>\nAUTOFILL='N' // <11>\nADMINEMAIL=\"root@localhost\" // <12>\nKEEP_SNAPD='Y' // <13>\nCHANGEME='' // <14>\n\n# Configuration files // <15>\nADDUSER='/etc/adduser.conf'\nAUDITDCONF='/etc/audit/auditd.conf'\nAUDITRULES='/etc/audit/rules.d/hardening.rules'\nCOMMONPASSWD='/etc/pam.d/common-password'\nCOMMONACCOUNT='/etc/pam.d/common-account'\nCOMMONAUTH='/etc/pam.d/common-auth'\nCOREDUMPCONF='/etc/systemd/coredump.conf'\nDEFAULTGRUB='/etc/default/grub.d'\nDISABLEFS='/etc/modprobe.d/disablefs.conf'\nDISABLEMOD='/etc/modprobe.d/disablemod.conf'\nDISABLENET='/etc/modprobe.d/disablenet.conf'\nFAILLOCKCONF='/etc/security/faillock.conf'\nJOURNALDCONF='/etc/systemd/journald.conf'\nLIMITSCONF='/etc/security/limits.conf'\nLOGINDCONF='/etc/systemd/logind.conf'\nLOGINDEFS='/etc/login.defs'\nLOGROTATE='/etc/logrotate.conf'\nPAMLOGIN='/etc/pam.d/login'\nPSADCONF='/etc/psad/psad.conf'\nPSADDL='/etc/psad/auto_dl'\nRESOLVEDCONF='/etc/systemd/resolved.conf'\nRKHUNTERCONF='/etc/default/rkhunter'\nRSYSLOGCONF='/etc/rsyslog.conf'\nSECURITYACCESS='/etc/security/access.conf'\nSSHFILE='/etc/ssh/ssh_config'\nSSHDFILE='/etc/ssh/sshd_config'\nSYSCTL='/etc/sysctl.conf'\nSYSTEMCONF='/etc/systemd/system.conf'\nTIMESYNCD='/etc/systemd/timesyncd.conf'\nUFWDEFAULT='/etc/default/ufw'\nUSERADD='/etc/default/useradd'\nUSERCONF='/etc/systemd/user.conf'\n\n----\n<1> The IP addresses that will be able to connect with SSH, separated by spaces.\n<2> Which group the users have to be member of in order to acess via SSH, separated by spaces.\n<3> Configure SSH port.\n<4> Stricter sysctl settings.\n<5> Auditd failure mode. 0=silent 1=printk 2=panic.\n<6> Auditd rules.\n<7> Logrotate settings.\n<8> NTP server pool.\n<9> Add a specific time zone or use the system default by leaving it empty.\n<10> If you want all the details or not.\n<11> Let the script guess the `FW_ADMIN` and `SSH_GRPS` settings.\n<12> Add a valid email address, so PSAD can send notifications.\n<13> If `'Y'` then the `snapd` package will be held to prevent removal.\n<14> Add something just to verify that you actually glanced the code.\n<15> Default configuration file locations.\n\n== Functions\n\n=== Function list in execution order\n\nNote that all functions has the `f_` prefix in the code.\n\n==== `pre`\n\nSets `apt` flags and performs basic permission check.\n\nThe `pre` function is located in link:scripts/pre[./scripts/pre].\n\n==== `kernel`\n\nSets https://github.com/jeffmurphy/NetPass/blob/master/doc/netfilter_conntrack_perf.txt#L175[/sys/module/nf_conntrack/parameters/hashsize]\nto 1048576 if `hashsize` exists and is writable.\n\nSets https://man7.org/linux/man-pages/man7/kernel_lockdown.7.html[/sys/kernel/security/lockdown]\nto `confidentiality` if `lockdown` exists and is writable.\n\nThe `kernel` function is located in link:scripts/kernel[./scripts/kernel].\n\n==== `firewall`\n\nConfigures https://help.ubuntu.com/community/UFW[UFW] if installed.\n\nAllows connections from the adresses in `$FW_ADMIN` to the `$SSH_PORT`.\n\nSets logging and `IPT_SYSCTL=/etc/sysctl.conf`.\n\nThe `firewall` function is located in link:scripts/ufw[./scripts/ufw].\n\n==== `disablenet`\n\nDisables the `dccp`, `sctp`, `rds` and `tipc` kernel modules.\n\nThe `disablenet` function is located in link:scripts/disablenet[./scripts/disablenet].\n\n==== `disablefs`\n\nDisables the `cramfs` `freevxfs` `jffs2` `ksmbd` `hfs` `hfsplus` `udf` kernel\nmodules.\n\nThe `disablefs` function is located in link:scripts/disablefs[./scripts/disablefs].\n\n==== `disablemod`\n\nDisables the `bluetooth`, `bnep`, `btusb`, `cpia2`, `firewire-core`, `floppy`,\n`n_hdlc`, `net-pf-31`, `pcspkr`, `soundcore`, `thunderbolt`, `usb-midi`,\n`usb-storage`, `uvcvideo`, `v4l2_common` kernel modules.\n\nNote that disabling the `usb-storage` module will disable any usage of USB\nstorage devices, if such devices are needed `USBGuard` should be configured\naccordingly and `usb-storage` removed from the `disablemod` function.\n\nThe `disablemod` function is located in link:scripts/disablemod[./scripts/disablemod].\n\n==== `systemdconf`\n\nSets `CrashShell=no`, `DefaultLimitCORE=0`, `DefaultLimitNOFILE=1024`,\n`DefaultLimitNPROC=1024`, `DumpCore=no` in `$SYSTEMCONF`\nand `$USERCONF`.\n\nThe `systemdconf` function is located in link:scripts/systemdconf[./scripts/systemdconf].\n\n==== `resolvedconf`\n\nSets `DNS=$dnslist`, `DNSOverTLS=opportunistic`, `DNSSEC=allow-downgrade`, `FallbackDNS=1.0.0.1`\nin `$RESOLVEDCONF`, where `$dnslist` is an array with the nameservers present\nin `/etc/resolv.conf`.\n\nThe `resolvedconf` function is located in link:scripts/resolvedconf[./scripts/resolvedconf].\n\n==== `logindconf`\n\nSets `IdleAction=lock`, `IdleActionSec=15min`, `KillExcludeUsers=root`,\n`KillUserProcesses=1`, `RemoveIPC=yes` in `$LOGINDCONF`.\n\nThe `logindconf` function is located in link:scripts/logindconf[./scripts/logindconf].\n\n==== `journalctl`\n\nCopies link:misc/logrotate.conf[./misc/logrotate.conf] to `$LOGROTATE`.\n\nSets `Compress=yes`, `ForwardToSyslog=yes`, `Storage=persistent` in\n`$JOURNALDCONF`.\n\nSets `$FileCreateMode 0600/` in `$RSYSLOGCONF`.\nif `RSYSLOGCONF` is writable.\n\nThe `journalctl` function is located in link:scripts/journalctl[./scripts/journalctl].\n\n==== `timesyncd`\n\nSets `NTP=${SERVERARRAY}`, `FallbackNTP=${FALLBACKARRAY}`, `RootDistanceMaxSec=1`\nin `$TIMESYNCD` where the arrays are up to four time servers with < 50ms\nlatency.\n\nThe `timesyncd` function is located in link:scripts/timesyncd[./scripts/timesyncd].\n\n==== `fstab`\n\nConfigures the `/boot` and `/home` partitions with `defaults,nosuid,nodev` if\nthey are available in `/etc/fstab`.\n\nConfigures the `/var/log`, `/var/log/audit` and `/var/tmp` partitions with\n`defaults,nosuid,nodev,noexec` if they are available in `/etc/fstab`.\n\nAdds `/run/shm tmpfs rw,noexec,nosuid,nodev`,\n`/dev/shm tmpfs rw,noexec,nosuid,nodev` and\n`/proc proc rw,nosuid,nodev,noexec,relatime,hidepid=2` to `/etc/fstab` if\nthe partition isn't present in `/etc/fstab`.\n\nRemoves any floppy drivers from `/etc/fstab`.\n\nCopies ./config/tmp.mount[./config/tmp.mount] to\n`/etc/systemd/system/tmp.mount`, removes `/tmp` from `/etc/fstab`\nand enables the tmpfs `/tmp` mount instead.\n\nThe `/proc` `hidepid` option is described in https://www.kernel.org/doc/html/latest/filesystems/proc.html#mount-options[https://www.kernel.org/doc/html/latest/filesystems/proc.html#mount-options].\n\nThe `fstab` function is located in link:scripts/fstab[./scripts/fstab].\n\n==== `prelink`\n\nReverts binaries and libraries to their original content before they were\nprelinked and uninstalls `prelink`.\n\nThe `prelink` function is located in link:scripts/prelink[./scripts/prelink].\n\n==== `aptget_configure`\n\nSets `apt` options `Acquire::http::AllowRedirect \"false\";`, `APT::Get::AllowUnauthenticated \"false\";`,\n`APT::Periodic::AutocleanInterval \"7\";`,\n`APT::Install-Recommends \"false\";`, `APT::Get::AutomaticRemove \"true\";`,\n`APT::Install-Suggests \"false\";`, `Acquire::AllowDowngradeToInsecureRepositories \"false\";`,\n`Acquire::AllowInsecureRepositories \"false\";`, `APT::Sandbox::Seccomp \"1\";`\n\nSee https://manpages.ubuntu.com/manpages/jammy/man5/apt.conf.5.html[https://manpages.ubuntu.com/manpages/jammy/man5/apt.conf.5.html].\n\nThe `aptget_configure` function is located in link:scripts/aptget[./scripts/aptget].\n\n==== `aptget`\n\nUpgrades installed packages.\n\nThe `aptget` function is located in link:scripts/aptget[./scripts/aptget].\n\n==== `hosts`\n\nSets `sshd : ALL : ALLOW`, `ALL: LOCAL, 127.0.0.1` in `/etc/hosts.allow` and\n`ALL: ALL` in `/etc/hosts.deny`.\n\nSee https://manpages.ubuntu.com/manpages/jammy/man5/hosts_access.5.html[https://manpages.ubuntu.com/manpages/jammy/man5/hosts_access.5.html]\nfor the format of host access control files.\n\nThe `hosts` function is located in link:scripts/hosts[./scripts/hosts].\n\n==== `issue`\n\nWrites a notice regarding authorized use only to `/etc/issue`, `/etc/issue.net`\nand `/etc/motd`.\n\nRemoves the executable flag from every file in `/etc/update-motd.d/`.\n\nThe `issue` function is located in link:scripts/issue[./scripts/issue].\n\n==== `sudo`\n\nRestricts `su` access to members of the `sudo` group using\nhttps://manpages.ubuntu.com/manpages/jammy/man8/pam_wheel.8.html[pam_wheel].\n\nSets `!pwfeedback`, `!visiblepw`, `logfile=/var/log/sudo.log`, `passwd_timeout=1`,\n`timestamp_timeout=5`, `use_pty` https://manpages.ubuntu.com/manpages/jammy/man5/sudoers.5.html[sudo options].\n\nThe `sudo` function is located in link:scripts/sudo[./scripts/sudo].\n\n==== `logindefs`\n\nWrites `LOG_OK_LOGINS yes`, `UMASK 077`, `PASS_MIN_DAYS 1`, `PASS_MAX_DAYS 60`,\n`DEFAULT_HOME no`, `ENCRYPT_METHOD SHA512`, `USERGROUPS_ENAB no`,\n`SHA_CRYPT_MIN_ROUNDS 10000`, `SHA_CRYPT_MAX_ROUNDS 65536` to\nhttps://manpages.ubuntu.com/manpages/jammy/man5/login.defs.5.html[$LOGINDEFS]\n\nThe `logindefs` function is located in link:scripts/logindefs[./scripts/logindefs].\n\n==== `sysctl`\n\nCopies link:misc/sysctl.conf[./misc/sysctl.conf] to `$SYSCTL`.\n\nFor an explanation of the options set, see\nhttps://www.kernel.org/doc/html/latest/admin-guide/sysctl/[https://www.kernel.org/doc/html/latest/admin-guide/sysctl/].\n\nThe `sysctl` function is located in link:scripts/sysctl[./scripts/sysctl].\n\n==== `limitsconf`\n\nSets `hard maxlogins 10`, `hard core 0`, `soft nproc 512`, `hard nproc 1024` in\nhttps://manpages.ubuntu.com/manpages/jammy/en/man5/limits.conf.5.html[$LIMITSCONF]\n\nThe `limitsconf` function is located in link:scripts/limits[./scripts/limits].\n\n==== `adduser`\n\nSets `DIR_MODE=0750`,`DSHELL=/bin/false`, and `USERGROUPS=yes` in `$ADDUSER`.\n\nSets `INACTIVE=30` and `SHELL=/bin/false` in `$USERADD`.\n\nThe `adduser` function is located in link:scripts/adduser[./scripts/adduser].\n\n==== `rootaccess`\n\nWrites `+:root:127.0.0.1/'` to `$SECURITYACCESS` and `console` to\n`/etc/securetty`.\n\nMasks https://freedesktop.org/wiki/Software/systemd/Debugging/[debug-shell].\n\nThe `rootaccess` function is located in link:scripts/rootaccess[./scripts/rootaccess].\n\n==== `package_install`\n\nInstalls `acct`, `aide-common`, `cracklib-runtime`, `debsums`, `gnupg2`,\n`haveged`, `libpam-pwquality`, `libpam-tmpdir`, `needrestart`, `openssh-server`,\n`postfix`, `psad`, `rkhunter`, `sysstat`, `systemd-coredump`, `tcpd`,\n`update-notifier-common`, `vlock`.\n\nThe `package_install` function is located in link:scripts/packages[./scripts/packages].\n\n==== `psad`\n\nInstalls and configures https://cipherdyne.org/psad/[PSAD]\n\nThe `psad` function is located in link:scripts/psad[./scripts/psad].\n\n==== `coredump`\n\nWrites `Storage=none` and `ProcessSizeMax=0` to `$COREDUMPCONF`.\n\nThe `coredump` function is located in link:scripts/coredump[./scripts/coredump].\n\n==== `usbguard`\n\nInstalls and configures https://usbguard.github.io/[USBGuard].\n\nThe `usbguard` function is located in link:scripts/usbguard[./scripts/usbguard].\n\n==== `postfix`\n\nInstalls `postfix` and sets `disable_vrfy_command=yes`,\n`inet_interfaces=loopback-only`,\n`smtpd_banner=\"\\$myhostname`,\n`smtpd_client_restrictions=permit_mynetworks,reject` using https://manpages.ubuntu.com/manpages/jammy/en/man1/postconf.1.html[postconf].\n\nThe `postfix` function is located in link:scripts/postfix[./scripts/postfix].\n\n==== `apport`\n\nDisables\nhttps://manpages.ubuntu.com/manpages/jammy/man1/apport-cli.1.html[apport],\nhttps://github.com/Ubuntu/ubuntu-report[ubuntu-report] and\nhttps://manpages.ubuntu.com/manpages/jammy/en/man8/popularity-contest.8.html[popularity-contest].\n\nThe `apport` function is located in link:scripts/apport[./scripts/apport].\n\n==== `motdnews`\n\nDisables `apt_news` and https://ubuntu.com/legal/motd[motd-news].\n\nThe `motdnews` function is located in link:scripts/motdnews[./scripts/motdnews].\n\n==== `rkhunter`\n\nSets `CRON_DAILY_RUN=\"yes\"`, `APT_AUTOGEN=\"yes\"` in `$RKHUNTERCONF`.\n\nThe `rkhunter` function is located in link:scripts/rkhunter[./scripts/rkhunter].\n\n==== `sshconfig`\n\nSets `HashKnownHosts yes`, `Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr`\nand `MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256`\nin `$SSHFILE`.\n\nThe `sshconfig` function is located in link:scripts/sshdconfig[./scripts/sshdconfig].\n\n==== `sshdconfig`\n\nConfigures the `OpenSSH` daemon. The configuration changes will be placed in\nthe directory defined by the `Include` option if present, otherwise\nhttps://manpages.ubuntu.com/manpages/jammy/en/man5/sshd_config.5.html[$SSHDFILE]\nwill be modified.\n\nBy default `/etc/ssh/sshd_config.d/hardening.conf` will contain the following:\n\n[source,shell]\n----\nAcceptEnv LANG LC_*\nAllowAgentForwarding no\nAllowGroups sudo\nAllowTcpForwarding no\nBanner /etc/issue.net\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr\nClientAliveCountMax 3\nClientAliveInterval 200\nCompression no\nGSSAPIAuthentication no\nHostbasedAuthentication no\nIgnoreUserKnownHosts yes\nKbdInteractiveAuthentication no\nKerberosAuthentication no\nKexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256\nLogLevel VERBOSE\nLoginGraceTime 20\nMacs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256\nMaxAuthTries 3\nMaxSessions 3\nMaxStartups 10:30:60\nPasswordAuthentication no\nPermitEmptyPasswords no\nPermitRootLogin no\nPermitUserEnvironment no\nPort 22\nPrintLastLog yes\nPrintMotd no\nRekeyLimit 512M 1h\nStrictModes yes\nTCPKeepAlive no\nUseDNS no\nUsePAM yes\nX11Forwarding no\n----\n\nThe `sshdconfig` function is located in link:scripts/sshdconfig[./scripts/sshdconfig].\n\n==== `password`\n\nCopies ./config/pwquality.conf[./config/pwquality.conf] to `/etc/security/pwquality.conf`,\n\nRemoves `nullok` from https://manpages.ubuntu.com/manpages/jammy/man5/pam.conf.5.html[PAM]\n`$COMMONAUTH`.\n\nConfigures https://manpages.ubuntu.com/manpages/jammy/en/man8/faillock.8.html[faillock]\nor https://manpages.ubuntu.com/manpages/jammy/man8/pam_tally2.8.html[pam_tally2]\ndepending on which is installed.\n\nAdds a link:misc/passwords.list[password list] to https://manpages.ubuntu.com/manpages/jammy/man8/update-cracklib.8.html[cracklib].\n\nThe `password` function is located in link:scripts/password[./scripts/password].\n\n==== `cron`\n\nDisables https://manpages.ubuntu.com/manpages/jammy/en/man8/atd.8.html[atd]\nand only allow root to use https://manpages.ubuntu.com/manpages/jammy/en/man1/at.1.html[at]\nor https://manpages.ubuntu.com/manpages/jammy/en/man8/cron.8.html[cron].\n\nThe `cron` function is located in link:scripts/cron[./scripts/cron].\n\n==== `ctrlaltdel`\n\nMasks https://manpages.ubuntu.com/manpages/jammy/man1/systemd.1.html#signals[ctrl-alt-del.target].\n\nThe `ctrlaltdel` function is located in link:scripts/ctraltdel[./scripts/ctraltdel].\n\n==== `auditd`\n\nConfigures https://manpages.ubuntu.com/manpages/jammy/en/man8/auditd.8.html[auditd].\n\nSee link:misc/audit-base.rules[./misc/audit-base.rules],\nlink:misc/audit-aggressive.rules[./misc/audit-aggressive.rules] and link:misc/audit-docker.rules[./misc/audit-docker.rules]\nfor the rules used.\n\nThe `auditd` function is located in link:scripts/auditd[./scripts/auditd].\n\n==== `aide`\n\nExcludes `/var/lib/lxcfs/cgroup` and `/var/lib/docker` from https://manpages.ubuntu.com/manpages/jammy/en/man1/aide.1.html[AIDE].\n\nThe `aide` function is located in link:scripts/aide[./scripts/aide].\n\n==== `rhosts`\n\nRemoves any existing `hosts.equiv` or `.rhosts` files.\n\nThe `rhosts` function is located in link:scripts/rhosts[./scripts/rhosts].\n\n==== `users`\n\nRemoves the `games`, `gnats`, `irc`, `list`, `news`, `sync`, `uucp` users.\n\nThe `users` function is located in link:scripts/users[./scripts/users].\n\n==== `lockroot`\n\nLocks root account\n\nThe `lockroot` function is located in link:scripts/lockroot[./scripts/lockroot].\n\n==== `package_remove`\n\nRemoves the `apport*`, `autofs`, `avahi*`, `beep`, `git`, `pastebinit`,\n`popularity-contest`, `rsh*`, `rsync`, `talk*`, `telnet*`, `tftp*`, `whoopsie`,\n`xinetd`, `yp-tools`, `ypbind` packages.\n\nThe `package_remove` function is located in link:scripts/packages[./scripts/packages].\n\n==== `suid`\n\nEnsures the executables in link:misc/suid.list[./misc/suid.list] don't have suid\nbits set.\n\nThe `suid` function is located in link:scripts/suid[./scripts/suid].\n\n==== `restrictcompilers`\n\nChanges mode to `0750` on any installed compilers.\n\nThe `restrictcompilers` function is located in link:scripts/compilers[./scripts/compilers].\n\n==== `umask`\n\nSets the default https://manpages.ubuntu.com/manpages/jammy/man2/umask.2.html[umask] to `077`\n\nThe `umask` function is located in link:scripts/umask[./scripts/umask].\n\n==== `path`\n\nCopies ./config/initpath.sh[./config/initpath.sh] to `/etc/profile.d/initpath.sh`\nand sets `PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin`\nfor the `root` user and `PATH=/usr/local/bin:/usr/sbin:/usr/bin:/bin:/snap/bin`\nfor everyone else.\n\nThe `path` function is located in link:scripts/path[./scripts/path].\n\n==== `aa_enforce`\n\nEnforces available https://manpages.ubuntu.com/manpages/jammy/en/man7/apparmor.7.html[apparmor]\nprofiles.\n\nThe `aa_enforce` function is located in link:scripts/apparmor[./scripts/apparmor].\n\n==== `aide_post`\n\nCreates a new AIDE database.\n\nThe `aide_post` function is located in link:scripts/aide[./scripts/aide].\n\n==== `aide_timer`\n\nCopies a systemd AIDE check service and timer to /etc/systemd/system/.\n\nThe `aide_timer` function is located in link:scripts/aide[./scripts/aide].\n\n==== `aptget_noexec`\n\nAdds a `DPkg::Pre-Invoke` and `DPkg::Post-Invoke` to ensure package updates\ndon't fail on a `noexec` `/tmp` partition.\n\nThe `aptget_noexec` function is located in link:scripts/aptget[./scripts/aptget].\n\n==== `aptget_clean`\n\nRuns https://manpages.ubuntu.com/manpages/jammy/en/man8/apt-get.8.html[apt-get] `clean` and `autoremove`.\n\nThe `aptget_clean` function is located in link:scripts/aptget[./scripts/aptget].\n\n==== `systemddelta`\n\nRuns https://manpages.ubuntu.com/manpages/jammy/man1/systemd-delta.1.html[systemd-delta] if running in verbose mode.\n\nThe `systemddelta` function is located in link:scripts/systemddelta[./scripts/systemddelta].\n\n==== `post`\n\nEnsures https://manpages.ubuntu.com/manpages/jammy/man1/fwupdmgr.1.html[fwupdmgr]\nand https://packages.ubuntu.com/jammy/secureboot-db[secureboot-db] is installed\nand GRUB is updated.\n\nThe `post` function is located in link:scripts/post[./scripts/post].\n\n==== `checkreboot`\n\nChecks if a reboot is required.\n\nThe `checkreboot` function is located in link:scripts/reboot[./scripts/reboot].\n\n== Tests\nThere are approximately 760 https://github.com/bats-core/bats-core[Bats tests]\nfor most of the above settings available in the link:tests/[tests directory].\n\n[source,shell]\n----\nsudo apt-get -y install bats\ngit clone https://github.com/konstruktoid/hardening.git\ncd hardening/tests/\nsudo bats .\n----\n\n=== Test automation using Vagrant\nRunning `bash ./runTests.sh` will use https://www.vagrantup.com/[Vagrant] to run\nall above tests, https://github.com/CISOfy/Lynis[Lynis] and\nhttps://www.open-scap.org/[OpenSCAP] with a\nhttps://www.cisecurity.org/benchmark/ubuntu_linux[CIS Ubuntu benchmark] on all\nsupported Ubuntu versions.\n\nThe script will generate a file named `TESTRESULTS.adoc` and CIS report in\nHTML-format.\n\n=== Testing a host\nRunning `bash ./runHostTests.sh`, located in the link:tests/[tests directory],\nwill generate a `TESTRESULTS-<HOSTNAME>.adoc` report.\n\nRunning `bash ./runHostTestsCsv.sh`, located in the link:tests/[tests directory],\nwill generate a `TESTRESULTS-<HOSTNAME>.csv` report.\n\n\n== Recommended reading\nhttps://public.cyber.mil/stigs/downloads/?_dl_facet_stigs=operating-systems%2Cunix-linux[Canonical Ubuntu 20.04 LTS STIG - Ver 1, Rel 3] +\nhttps://www.cisecurity.org/benchmark/distribution_independent_linux/[CIS Distribution Independent Linux Benchmark] +\nhttps://www.cisecurity.org/benchmark/ubuntu_linux/[CIS Ubuntu Linux Benchmark] +\nhttps://www.ncsc.gov.uk/collection/end-user-device-security/platform-specific-guidance/ubuntu-18-04-lts[EUD Security Guidance: Ubuntu 18.04 LTS] +\nhttps://wiki.ubuntu.com/Security/Features +\nhttps://help.ubuntu.com/community/StricterDefaults +\n\n== Contributing\nDo you want to contribute? That's great! Contributions are always welcome,\nno matter how large or small. If you found something odd, feel free to\nhttps://github.com/konstruktoid/hardening/issues/[submit a new issue],\nimprove the code by https://github.com/konstruktoid/hardening/pulls[creating a pull request],\nor by https://github.com/sponsors/konstruktoid[sponsoring this project].\n\nLogo by https://github.com/reallinfo[reallinfo].\n"
        },
        {
          "name": "SECURITY.md",
          "type": "blob",
          "size": 0.3740234375,
          "content": "# Security Policy\n\n## Supported Versions\n\nThe current [upstream](https://github.com/konstruktoid/hardening)\nand the [latest published version](https://github.com/konstruktoid/hardening/releases) are supported.\n\n## Reporting a Bug or Vulnerability\n\nIf you found a bug or vulnerability or just something odd, feel free to submit a issue or improve the code by creating a pull request.\n"
        },
        {
          "name": "Vagrantfile",
          "type": "blob",
          "size": 1.005859375,
          "content": "Vagrant.configure(\"2\") do |config|\n  config.vbguest.auto_update = false\n  config.vm.provider \"virtualbox\" do |v|\n    v.default_nic_type = \"Am79C973\"\n    v.memory = 1024\n    v.cpus = 2\n    v.customize [\"modifyvm\", :id, \"--uart1\", \"0x3F8\", \"4\"]\n    v.customize [\"modifyvm\", :id, \"--uartmode1\", \"file\", File::NULL]\n  end\n\n  config.vm.define \"focal\" do |focal|\n    focal.ssh.extra_args = [\"-o\",\"ConnectTimeout=600\"]\n    focal.ssh.insert_key = true\n    focal.vm.boot_timeout = 600\n    focal.vm.box = \"bento/ubuntu-20.04\"\n    focal.vm.hostname = \"focal\"\n  end\n\n  config.vm.define \"jammy\" do |jammy|\n    jammy.ssh.extra_args = [\"-o\",\"ConnectTimeout=600\"]\n    jammy.ssh.insert_key = true\n    jammy.vm.boot_timeout = 600\n    jammy.vm.box = \"bento/ubuntu-22.04\"\n    jammy.vm.hostname = \"jammy\"\n  end\n\n  config.vm.define \"noble\" do |noble|\n    noble.ssh.extra_args = [\"-o\",\"ConnectTimeout=600\"]\n    noble.ssh.insert_key = true\n    noble.vm.boot_timeout = 600\n    noble.vm.box = \"bento/ubuntu-24.04\"\n    noble.vm.hostname = \"noble\"\n  end\nend\n"
        },
        {
          "name": "action-shellcheck",
          "type": "tree",
          "content": null
        },
        {
          "name": "checkScore.sh",
          "type": "blob",
          "size": 0.3779296875,
          "content": "#!/bin/sh\nif command -v apt-get; then\n  PKG=\"apt-get\"\nelif command -v yum; then\n  PKG=\"yum\"\nelse\n  exit 1\nfi\n\ncd ~ || exit 1\n\nsudo \"$PKG\" -y install git\n\ngit clone https://github.com/CISOFy/lynis\n\nsudo chown -R root:root lynis\nsudo chmod a+rx lynis\ncd lynis || exit 1\n\nLANG=C sudo ./lynis audit system\nsudo cp '/var/log/lynis-report.dat' ~/\nsudo chown vagrant:vagrant ~/lynis-report.dat\n"
        },
        {
          "name": "config",
          "type": "tree",
          "content": null
        },
        {
          "name": "createPartitions.sh",
          "type": "blob",
          "size": 0.9169921875,
          "content": "#!/bin/sh\n\nif lsblk | grep '^sdc.*5G'; then\n  mv /home/vagrant/.ssh /root/vagrant-ssh\n\n  fdisk -u /dev/sdc <<EOF\nn\np\n1\n\n+500M\nn\np\n2\n\n+500M\nn\np\n3\n\n+500M\nn\np\n4\n\n+500M\nw\nEOF\n\n  mkfs.xfs /dev/sdc1\n  mkfs.xfs /dev/sdc2\n  mkfs.xfs /dev/sdc3\n  mkfs.xfs /dev/sdc4\n\n  mkdir -p /var/log/audit\n  mkdir -p /var/lib/docker\n\n  {\n    echo '/dev/sdc1 /var/log xfs defaults 0 0'\n    echo '/dev/sdc2 /var/log/audit xfs defaults 0 0'\n    echo '/dev/sdc3 /home xfs defaults 0 0'\n    echo '/dev/sdc4 /var/lib/docker xfs defaults 0 0'\n  } >> /etc/fstab\n\n  mount -t xfs /dev/sdc1 /var/log\n  mount -t xfs /dev/sdc2 /var/log/audit\n  mount -t xfs /dev/sdc3 /home\n  mount -t xfs /dev/sdc4 /var/lib/docker\n\n  if grep '^vagrant' /etc/passwd; then\n    mkdir -p /home/vagrant\n    mv /root/vagrant-ssh /home/vagrant/.ssh\n    chown -R vagrant:vagrant /home/vagrant\n    chmod 0750 /home/vagrant\n    chmod 0700 /home/vagrant/.ssh\n    chmod 0600 /home/vagrant/.ssh/*\n  fi\nfi\n"
        },
        {
          "name": "logo",
          "type": "tree",
          "content": null
        },
        {
          "name": "misc",
          "type": "tree",
          "content": null
        },
        {
          "name": "packer",
          "type": "tree",
          "content": null
        },
        {
          "name": "renovate.json",
          "type": "blob",
          "size": 0.365234375,
          "content": "{\n  \"$schema\": \"https://docs.renovatebot.com/renovate-schema.json\",\n  \"extends\": [\n    \"config:base\"\n  ],\n  \"packageRules\": [\n    {\n      \"matchUpdateTypes\": [\"minor\", \"patch\", \"pin\", \"digest\"],\n      \"automerge\": true,\n      \"automergeType\": \"branch\"\n    },\n    {\n      \"matchDepTypes\": [\"devDependencies\"],\n      \"automerge\": true\n    }\n  ],\n  \"platformAutomerge\": true\n}\n"
        },
        {
          "name": "runTests.sh",
          "type": "blob",
          "size": 4.0380859375,
          "content": "#!/bin/bash\n\nset -u -o pipefail\n\nif ! command -v shellcheck; then\n  exit 1\nfi\n\nif ! shellcheck -x -s bash -f gcc tests/*.bash tests/*.sh scripts/* misc/*.sh ./*.sh; then\n  exit 1\nfi\n\nif ! command -v vagrant; then\n  exit 1\nfi\n\nif ! vagrant validate Vagrantfile; then\n  exit 1\nfi\n\nfind ./ -name '*.log' -exec rm {} \\;\n\nvagrant box update --insecure\nvagrant destroy --force\n\nfor d in $(grep config.vm.define Vagrantfile | grep -o '\".*\"' | tr -d '\"');\n  do rm -v \"/tmp/${d}_disk01.vdi\"\ndone\n\ngrep config.vm.define Vagrantfile | grep -v '^#' | grep -o '\".*\"' | tr -d '\"' |\\\n  while read -r v; do\n    vagrant up \"${v}\"\ndone\n\nwait\n\nfor VM in $(vagrant status | grep -iE 'running.*virtualbox' | awk '{print $1}'); do\n  vagrant ssh \"${VM}\" -c 'cp /vagrant/checkScore.sh ~/'\n  vagrant ssh \"${VM}\" -c 'cp /vagrant/misc/genOSCAPreport.sh ~/'\n  vagrant ssh \"${VM}\" -c 'sudo apt-get -y update && sudo apt-get -y install bats net-tools shellcheck --no-install-recommends'\n  vagrant ssh \"${VM}\" -c 'cp -R /vagrant ~/hardening && sed -i.bak -e \"s/^AUTOFILL=.*/AUTOFILL='\\''Y'\\''/\" -e \"s/^CHANGEME=.*/CHANGEME='\\''changed'\\''/\" ~/hardening/ubuntu.cfg && cd ~/hardening && sudo bash ubuntu.sh && sudo shutdown -h now'\ndone\n\nwait\n\ngrep config.vm.define Vagrantfile | grep -v '^#' | grep -o '\".*\"' | tr -d '\"' |\\\n  while read -r v; do\n    vagrant up --provision \"${v}\"\ndone\n\nfor VM in $(vagrant status | grep -iE 'running.*virtualbox' | awk '{print $1}'); do\n  while ! vagrant ssh \"$VM\" -c 'id'; do\n    echo \"Waiting for $VM.\"\n    sleep 10\n  done\n  vagrant ssh \"${VM}\" -c 'bash ~/genOSCAPreport.sh'\n  vagrant ssh \"${VM}\" -c 'cd ~/hardening/tests && sudo bats . >> ~/bats.log'\n  vagrant ssh \"${VM}\" -c 'cat ~/bats.log' | grep 'not ok'  > \"hardening-$VM-$(date +%y%m%d)-bats.log\"\n  vagrant ssh \"${VM}\" -c 'sh ~/checkScore.sh || exit 1 && cat ~/lynis-report.dat' > \"hardening-$VM-$(date +%y%m%d)-lynis.log\"\n  vagrant scp \"${VM}:*.html\" \".\"\ndone\n\nwait\n\n{\n  TESTS=\"$(grep -Ro '@test' tests/*.bats | wc -l)\"\n\n  echo \"= Vagrant Ubuntu Test results - $(LANG=C date --utc)\"\n  echo \":icons: font\"\n  echo \"Number of tests: ${TESTS}\"\n  echo\n  echo \"The score is calculated using \\`100-(100*FAILED_TESTS/TESTS)\\`.\"\n  echo\n  echo \"NOTE: This is a quick test script using Vagrant boxes and some functions may fail resulting in incorrect output or score. Always verify using systems similar to those used by your organization.\"\n  echo\n  echo \"== System information\"\n  echo \"----\"\n  vagrant --version\n  echo \"VirtualBox $(vboxmanage --version)\"\n\n  for box in $(grep 'vm.box' Vagrantfile | grep -o '\".*\"$' | tr -d '\"'); do\n    vagrant box list | grep -i \"${box}\" | tail -n1 | sed 's/64.*(/86 \\(/g'\n  done\n  echo \"----\"\n\n  # Modified VMs\n  for VM in $(vagrant status | grep -iE 'running.*virtualbox' | awk '{print $1}'); do\n    if [ -z \"${VM}\" ]; then\n      echo \"We dont have any VMs, exiting.\"\n      exit 1\n    fi\n\n    echo\n    echo \"== Ubuntu release: ${VM}\"\n\n    echo \"----\"\n    while read -r f; do\n      if test -s \"${f}\"; then\n        FAILED_TESTS=\"$(grep -c '^not ok' \"${f}\")\"\n        echo \"Failed number of tests: ${FAILED_TESTS}\"\n        STAGE_FAIL=0\n      else\n        echo \"$f is empty, a test stage failed.\"\n        FAILED_TESTS=100\n        STAGE_FAIL=1\n      fi\n    done < <(find ./ -name \"*${VM}*bats.log\" -type f)\n    echo \"----\"\n\n    echo\n    echo \"=== Failed tests:\"\n    echo \"----\"\n    if [ \"${STAGE_FAIL}\" == 0 ]; then\n      grep -shE '^not ok' ./*\"${VM}\"*bats.log | sort -k3n | uniq\n    else\n      echo \"N/A.\"\n    fi\n    echo \"----\"\n\n\n    echo \"=== Lynis score:\"\n    echo \"----\"\n    find ./ -name \"*${VM}*lynis.log\" -type f | while read -r f; do\n      if test -s \"${f}\"; then\n        echo\n        grep -E 'hardening_index|os_version' \"${f}\"\n      else\n        echo \"$f is empty, a test stage failed.\"\n      fi\n    done\n    echo \"----\"\n\n    echo\n    echo \"=== Lynis warnings and suggestions:\"\n    echo \"----\"\n    grep -shE '^warning|^suggestion' ./*\"${VM}\"*lynis.log | sort -r | uniq\n    echo \"----\"\n\n    echo\n    echo \"=== Score: $((100-(100*FAILED_TESTS/TESTS)))\"\n  done\n} > TESTRESULTS.adoc\n\nif command -v dos2unix; then\n  dos2unix TESTRESULTS.adoc\nfi\n"
        },
        {
          "name": "scripts",
          "type": "tree",
          "content": null
        },
        {
          "name": "systemd.adoc",
          "type": "blob",
          "size": 11.3193359375,
          "content": "= Security focused systemd configuration\n:icons: font\n\nhttps://www.freedesktop.org/wiki/Software/systemd/[systemd] configuration\nexamples, hopefully making your server and services a bit more secure.\n\n== Documentation\nhttps://github.com/konstruktoid/hardening[Hardening Ubuntu. Systemd edition.] +\nhttp://0pointer.de/blog/projects/security.html[systemd for Administrators, Part XII: Securing Your Services] +\nhttps://github.com/systemd/systemd[systemd upstream] +\nhttps://www.freedesktop.org/software/systemd/man/systemd.exec.html[systemd execution environment configuration]\n\n=== systemd-analyze and systemd_scan.sh\n\nSince `systemd` version 240, `systemd-analyze` has the https://www.freedesktop.org/software/systemd/man/systemd-analyze.html[security]\noption for analyzing the security and sandboxing settings of services in order\nto determine an exposure level value for them, indicating whether a service\nwould benefit from more sand-boxing options turned on for them.\n\nhttps://github.com/konstruktoid/hardening/blob/master/misc/systemd_scan.sh[systemd_scan.sh]\nis a script to check the current `systemd` configuration of a local service,\nsimilar to a very basic version of `systemd-analyze security`.\n\n[source,shell]\n----\n$ bash systemd_scan.sh mongodb\n[I] mongodb\n    [I] /lib/systemd/system/mongodb.service used.\n    [P] User is set.\n    [P] Group is set.\n    [P] CapabilityBoundingSet is set.\n    [F] PrivateTmp is not set.\n    [F] PrivateDevices is not set.\n    [F] NoNewPrivileges is not set.\n    [F] SELinuxContext is not set.\n    [F] AppArmorProfile is not set.\n    [P] LimitNOFILE is set.\n    [P] LimitNPROC is set.\n    [F] DynamicUser is not set.\n    [P] ProtectSystem=full is set.\n    [P] ProtectHome=true is set.\n    [I] 6 failures, 7 passed.\n----\n\n`systemd-analyze security` calculates an exposure value based on the following\nconfiguration options:\n\n[source,shell]\n----\nAmbientCapabilities=\nCapabilityBoundingSet=\nDelegate=\nDeviceAllow=\nIPAddressDeny=\nKeyringMode=\nLockPersonality=\nMemoryDenyWriteExecute=\nNoNewPrivileges=\nNotifyAccess=\nPrivateDevices=\nPrivateMounts=\nPrivateNetwork=\nPrivateTmp=\nPrivateUsers=\nProtectControlGroups=\nProtectHome=\nProtectHostname=\nProtectKernelLogs=\nProtectKernelModules=\nProtectKernelTunables=\nProtectSystem=\nRestrictAddressFamilies=\nRestrictNamespaces=\nRestrictRealtime=\nRestrictSUIDSGID=\nRootDirectory=/RootImage=\nSystemCallArchitectures=\nSystemCallFilter=\nUMask=\nUser=/DynamicUser=\n----\n\n== Logging\n\n=== /etc/systemd/journald.conf\nSee https://www.freedesktop.org/software/systemd/man/journald.conf.html[journald.conf].\n\n[source,shell]\n----\n[Journal]\nCompress=yes // <1>\nForwardToSyslog=yes // <2>\nStorage=persistent // <3>\n----\n\n<1> \"data objects that shall be stored in the journal and are larger than a certain threshold are compressed before they are written to the file system.\"\n<2> \"log messages received by the journal daemon shall be forwarded to a traditional syslog daemon\"\n<3> \"data will be stored preferably on disk, i.e. below the /var/log/journal hierarchy (which is created if needed), with a fallback to /run/log/journal (which is created if needed), during early boot and if the disk is not writable.\"\n\n=== /etc/systemd/coredump.conf\nSee https://www.freedesktop.org/software/systemd/man/coredump.conf.html[coredump.conf].\n\n[source,shell]\n----\n[Coredump]\nStorage=none // <1>\nProcessSizeMax=0 // <2>\n----\n\n<1> \"When \"none\", the core dumps will be logged but not stored permanently.\"\n<2> \"Setting `Storage=none` and `ProcessSizeMax=0` disables all coredump handling except for a log entry.\"\n\n== Mounts\n\nSee https://www.freedesktop.org/software/systemd/man/systemd.mount.html[systemd.mount].\n\n=== /etc/systemd/system/tmp.mount\n[source,shell]\n----\n[Unit]\nDescription=Temporary Directory\nDocumentation=man:hier(7)\nBefore=local-fs.target\n\n[Mount]\nWhat=tmpfs // <1>\nWhere=/tmp // <2>\nType=tmpfs // <3>\nOptions=mode=1777,strictatime,nodev,noexec,nosuid // <4><5>\n----\n\n<1> \"an absolute path of a device node, file or other resource to mount.\"\n<2> \"an absolute path of a directory of the mount point.\"\n<3> \"a string for the file system type.\"\n<4> \"options to use when mounting.\"\n\n== System\n\n=== /etc/systemd/resolved.conf\n\nSee https://www.freedesktop.org/software/systemd/man/resolved.conf.html[resolved.conf].\n\n[source,shell]\n----\n[Resolve]\nDNS=127.0.0.1 // <1>\nFallbackDNS=1.1.1.1 1.0.0.1 // <2>\nDNSSEC=allow-downgrade // <3>\nDNSOverTLS=opportunistic // <4>\n----\n\n<1> \"space-separated list of IPv4 and IPv6 addresses to use as system DNS servers.\"\n<2> \"space-separated list of IPv4 and IPv6 addresses to use as the fallback DNS servers.\"\n<3> \"If set to `allow-downgrade` DNSSEC validation is attempted, but if the server does not support DNSSEC properly, DNSSEC mode is automatically disabled.\" Should be set to `true` if possible.\n<4> \"When set to `opportunistic` DNS request are attempted to send encrypted with DNS-over-TLS.\" Shoule be set to `true` if possible.\n\n=== /etc/systemd/system.conf\nSee https://www.freedesktop.org/software/systemd/man/systemd-system.conf.html[system.conf] and https://www.freedesktop.org/software/systemd/man/systemd.html[systemd, init].\n\n[source,shell]\n----\n[Manager]\nDumpCore=no // <1>\nCrashShell=no // <2>\nDefaultLimitCORE=0 // <3>\nDefaultLimitNOFILE=100 // <4>\nDefaultLimitNPROC=100 // <5>\nCtrlAltDelBurstAction=none // <6>\n----\n<1> \"If `yes`, the systemd manager (PID 1) dumps core when it crashes. Otherwise, no core dump is created.\"\n<2> \"If `yes`, the system manager (PID 1) spawns a shell when it crashes, after a 10s delay. Otherwise, no shell is spawned.\"\n<3> Don't allow daemons to core dump.\n<4> Default limit for number of open files.\n<5> Default limit for number of processes.\n<6> Defines what action will be performed if user presses Ctrl-Alt-Delete more than 7 times in 2s.\n\n=== /etc/systemd/timesyncd.conf\n\nSee https://www.freedesktop.org/software/systemd/man/timesyncd.conf.html[timesyncd.conf].\n\n[source,shell]\n----\n[Time]\nNTP=0.ubuntu.pool.ntp.org 1.ubuntu.pool.ntp.org // <1>\nFallbackNTP=2.ubuntu.pool.ntp.org 3.ubuntu.pool.ntp.org // <2>\nRootDistanceMaxSec=1 // <3>\n----\n\n<1> \"space-separated list of NTP server host names or IP addresses.\"\n<2> \"space-separated list of NTP server host names or IP addresses to be used as the fallback NTP servers.\"\n<3> \"Maximum acceptable root distance. Takes a time value (in seconds).\"\n\n== Unit configuration\n\nSee https://www.freedesktop.org/software/systemd/man/systemd.exec.html[systemd.exec].\n\n[source,shell]\n----\nPrivateTmp= // <1>\nProtectSystem= // <2>\nProtectHome= // <3>\nNoNewPrivileges= // <4>\nReadWriteDirectories=, ReadOnlyDirectories=, InaccessibleDirectories= // <5>\nCapabilityBoundingSet= // <6>\nPrivateDevices= // <7>\nUser=, Group= // <8>\nDynamicUser= // <9>\nTemporaryFileSystem= // <10>\nPrivateUsers= // <11>\n----\n\n<1> \"Takes a boolean argument. If true, sets up a new file system namespace for the executed processes and mounts private `/tmp` and `/var/tmp` directories inside it that is not shared by processes outside of the namespace.\"\n<2> \"If true, mounts the `/usr` and `/boot` directories read-only for processes invoked by this unit. If set to `full`, the `/etc` directory is mounted read-only, too. If set to `strict` the entire file system hierarchy is mounted read-only, except for the API file system subtrees `/dev`, `/proc` and `/sys`.\"\n<3> \"Takes a boolean argument or the special values `read-only` or `tmpfs`. If `true`, the directories `/home`, `/root`, and `/run/user` are made inaccessible and empty for processes invoked by this unit. If set to `read-only`, the three directories are made read-only instead. If set to `tmpfs`, temporary file systems are mounted on the three directories in read-only mode.\"\n<4> \"If `true`, ensures that the service process and all its children can never gain new privileges.\"\n<5> \"Sets up a new file system namespace for executed processes.\"\n<6> \"Controls which capabilities to include in the capability bounding set for the executed process.\"\n<7> \"If `true`, sets up a new `/dev` namespace for the executed processes and only adds API pseudo devices such as `/dev/null`, `/dev/zero` or `/dev/random` (as well as the pseudo TTY subsystem) to it\"\n<8> \"Sets the Unix user or group that the processes are executed as, respectively\"\n<9> \"User and group pair is allocated dynamically when the unit is started, and released as soon as it is stopped.\"\n<10> \"Takes a space-separated list of mount points for temporary file systems (tmpfs). If set, a new file system namespace is set up for executed processes, and a temporary file system is mounted on each mount point.\"\n<11> \"Takes a boolean argument. If `true`, sets up a new user namespace for the executed processes and configures a minimal user and group mapping, that maps the `root` user and group as well as the unit's own user and group to themselves and everything else to the `nobody` user and group.\"\n\n=== /etc/systemd/system/nginx.service example\n\n[source,shell]\n----\n[Unit]\nDescription=A high performance web server and a reverse proxy server\nDocumentation=man:nginx(8)\nAfter=network.target\n\n[Service]\nType=forking\nPIDFile=/run/nginx.pid\nExecStartPre=/usr/sbin/nginx -t -q -g 'daemon on; master_process on;'\nExecStart=/usr/sbin/nginx -g 'daemon on; master_process on;'\nExecReload=/usr/sbin/nginx -g 'daemon on; master_process on;' -s reload\nExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid\nTimeoutStopSec=5\nKillMode=mixed\nPrivateTmp=yes\nProtectSystem=full\nProtectHome=true\nNoNewPrivileges=true\nReadOnlyDirectories=/var/www/html\nCapabilityBoundingSet=~CAP_SYS_PTRACE\nPrivateDevices=true\n\n[Install]\nWantedBy=multi-user.target\n----\n\n=== /etc/systemd/system/mongod.service example\n\nSee https://github.com/mongodb/mongo/pull/1224[mongo/pull/1224].\n\n[source,shell]\n----\n[Unit]\nDescription=MongoDB Database Server\nAfter=network.target\nDocumentation=https://docs.mongodb.org/manual\n\n[Service]\nUser=mongodb\nGroup=mongodb\nExecStart=/usr/bin/mongod --config /etc/mongod.conf\nPIDFile=/var/run/mongodb/mongod.pid\nLimitFSIZE=infinity\nLimitCPU=infinity\nLimitAS=infinity\nLimitNOFILE=64000\nLimitNPROC=64000\nLimitMEMLOCK=infinity\nTasksMax=infinity\nTasksAccounting=false\nProtectSystem=full\nProtectHome=true\nCapabilityBoundingSet=~CAP_SYS_PTRACE\n\n[Install]\nWantedBy=multi-user.target\n----\n\n== Users\n\n=== /etc/systemd/logind.conf\n\nSee https://www.freedesktop.org/software/systemd/man/logind.conf.html[logind.conf].\n\n[source,shell]\n----\n[Login]\nKillUserProcesses=1 // <1>\nKillExcludeUsers=root // <2>\nIdleAction=lock // <3>\nIdleActionSec=15min // <4>\nRemoveIPC=yes // <5>\n----\n\n<1> \"the processes of a user should be killed when the user completely logs out (i.e. after the user's last session ended).\"\n<2> \"Processes of users listed in `KillExcludeUsers=` are excluded from being killed.\"\n<3> \"the action to take when the system is idle.\"\n<4> \"the delay after which the action configured in `IdleAction=` (see above) is taken after the system is idle.\"\n<5> \"the user may not consume IPC resources after the last of the user's sessions terminated.\"\n\n=== /etc/systemd/user.conf\n\nSee https://www.freedesktop.org/software/systemd/man/systemd-user.conf.html[systemd-user.conf].\n\n[source,shell]\n----\n[Manager]\nDefaultLimitCORE=0 // <1>\nDefaultLimitNOFILE=100 // <2>\nDefaultLimitNPROC=100 // <3>\nCapabilityBoundingSet=~CAP_SYS_PTRACE // <4>\n----\n\n<1> Don't allow core dumps.\n<2> Default limit for number of open files.\n<3> Default limit for number of processes.\n<4> \"capabilities to include in the capability bounding set.\" See http://man7.org/linux/man-pages/man7/capabilities.7.html[capabilities(7)].\n\n"
        },
        {
          "name": "tests",
          "type": "tree",
          "content": null
        },
        {
          "name": "ubuntu.cfg",
          "type": "blob",
          "size": 1.6591796875,
          "content": "FW_ADMIN='127.0.0.1'\nSSH_GRPS='sudo'\nSSH_PORT='22'\nSYSCTL_CONF='./misc/sysctl.conf'\nAUDITD_MODE='1'\nAUDITD_RULES='./misc/audit-base.rules ./misc/audit-aggressive.rules ./misc/audit-docker.rules'\nLOGROTATE_CONF='./misc/logrotate.conf'\nNTPSERVERPOOL='0.ubuntu.pool.ntp.org 1.ubuntu.pool.ntp.org 2.ubuntu.pool.ntp.org 3.ubuntu.pool.ntp.org pool.ntp.org'\nTIMEDATECTL=''\nVERBOSE='N'\nAUTOFILL='N'\nADMINEMAIL='root@localhost'\nKEEP_SNAPD='Y'\nCHANGEME='' # Add something just to verify that you actually glanced the code\n\n# Configuration files\nADDUSER='/etc/adduser.conf'\nAUDITDCONF='/etc/audit/auditd.conf'\nAUDITRULES='/etc/audit/rules.d/hardening.rules'\nCOMMONPASSWD='/etc/pam.d/common-password'\nCOMMONACCOUNT='/etc/pam.d/common-account'\nCOMMONAUTH='/etc/pam.d/common-auth'\nCOREDUMPCONF='/etc/systemd/coredump.conf'\nDEFAULTGRUB='/etc/default/grub.d'\nDISABLEFS='/etc/modprobe.d/disablefs.conf'\nDISABLEMOD='/etc/modprobe.d/disablemod.conf'\nDISABLENET='/etc/modprobe.d/disablenet.conf'\nFAILLOCKCONF='/etc/security/faillock.conf'\nJOURNALDCONF='/etc/systemd/journald.conf'\nLIMITSCONF='/etc/security/limits.conf'\nLOGINDCONF='/etc/systemd/logind.conf'\nLOGINDEFS='/etc/login.defs'\nLOGROTATE='/etc/logrotate.conf'\nPAMLOGIN='/etc/pam.d/login'\nPSADCONF='/etc/psad/psad.conf'\nPSADDL='/etc/psad/auto_dl'\nRESOLVEDCONF='/etc/systemd/resolved.conf'\nRKHUNTERCONF='/etc/default/rkhunter'\nRSYSLOGCONF='/etc/rsyslog.conf'\nSECURITYACCESS='/etc/security/access.conf'\nSSHFILE='/etc/ssh/ssh_config'\nSSHDFILE='/etc/ssh/sshd_config'\nSYSCTL='/etc/sysctl.conf'\nSYSTEMCONF='/etc/systemd/system.conf'\nTIMESYNCD='/etc/systemd/timesyncd.conf'\nUFWDEFAULT='/etc/default/ufw'\nUSERADD='/etc/default/useradd'\nUSERCONF='/etc/systemd/user.conf'\n"
        },
        {
          "name": "ubuntu.sh",
          "type": "blob",
          "size": 3.900390625,
          "content": "#!/bin/bash\n\n# shellcheck disable=1090\n# shellcheck disable=2009\n# shellcheck disable=2034\n\nset -u -o pipefail\n\nif ! ps -p $$ | grep -si bash; then\n  echo \"Sorry, this script requires bash.\"\n  exit 1\nfi\n\nif ! [ -x \"$(command -v systemctl)\" ]; then\n  echo \"systemctl required. Exiting.\"\n  exit 1\nfi\n\nfunction main {\n  clear\n\n  REQUIREDPROGS='arp dig ping w'\n  REQFAILED=0\n  for p in $REQUIREDPROGS; do\n    if ! command -v \"$p\" >/dev/null 2>&1; then\n      echo \"$p is required.\"\n      REQFAILED=1\n    fi\n  done\n\n  if [ $REQFAILED = 1 ]; then\n    apt-get -qq update\n    apt-get -qq install bind9-dnsutils iputils-ping net-tools procps --no-install-recommends\n  fi\n\n  ARPBIN=\"$(command -v arp)\"\n  DIGBIN=\"$(command -v dig)\"\n  PINGBIN=\"$(command -v ping)\"\n  WBIN=\"$(command -v w)\"\n  WHOBIN=\"$(command -v who)\"\n  LXC=\"0\"\n\n  if resolvectl status >/dev/null 2>&1; then\n    SERVERIP=\"$(ip route get \"$(resolvectl status |\\\n      grep -E 'DNS (Server:|Servers:)' | tail -n1 |\\\n      awk '{print $NF}')\" | grep -Eo '[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+' |\\\n      tail -n1)\"\n  else\n    SERVERIP=\"$(ip route get \"$(grep '^nameserver' /etc/resolv.conf |\\\n      tail -n1 | awk '{print $NF}')\" |\\\n      grep -Eo '[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+' | tail -n1)\"\n  fi\n\n  if grep -qE 'container=lxc|container=lxd' /proc/1/environ; then\n    LXC=\"1\"\n  fi\n\n  if grep -s \"AUTOFILL='Y'\" ./ubuntu.cfg; then\n    USERIP=\"$($WHOBIN | awk '{print $NF}' | tr -d '()' |\\\n      grep -E '^[0-9]' | head -n1)\"\n\n    if [[ \"$USERIP\" =~ ^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$ ]]; then\n      ADMINIP=\"$USERIP\"\n    else\n      ADMINIP=\"$(hostname -I | sed -E 's/\\.[0-9]+ /.0\\/24 /g')\"\n    fi\n\n    sed -i \"s/FW_ADMIN='/FW_ADMIN='$ADMINIP /\" ./ubuntu.cfg\n    sed -i \"s/SSH_GRPS='/SSH_GRPS='$(id \"$($WBIN -ih | awk '{print $1}' | head -n1)\" -ng) /\" ./ubuntu.cfg\n    sed -i \"s/CHANGEME=''/CHANGEME='$(date +%s)'/\" ./ubuntu.cfg\n    sed -i \"s/VERBOSE='N'/VERBOSE='Y'/\" ./ubuntu.cfg\n  fi\n\n  source ./ubuntu.cfg\n\n  readonly ADDUSER\n  readonly ADMINEMAIL\n  readonly ARPBIN\n  readonly AUDITDCONF\n  readonly AUDITD_MODE\n  readonly AUDITD_RULES\n  readonly AUDITRULES\n  readonly AUTOFILL\n  readonly CHANGEME\n  readonly COMMONACCOUNT\n  readonly COMMONAUTH\n  readonly COMMONPASSWD\n  readonly COREDUMPCONF\n  readonly DEFAULTGRUB\n  readonly DISABLEFS\n  readonly DISABLEMOD\n  readonly DISABLENET\n  readonly FAILLOCKCONF\n  readonly FW_ADMIN\n  readonly JOURNALDCONF\n  readonly KEEP_SNAPD\n  readonly LIMITSCONF\n  readonly LOGINDCONF\n  readonly LOGINDEFS\n  readonly LOGROTATE\n  readonly LOGROTATE_CONF\n  readonly LXC\n  readonly NTPSERVERPOOL\n  readonly PAMLOGIN\n  readonly PSADCONF\n  readonly PSADDL\n  readonly RESOLVEDCONF\n  readonly RKHUNTERCONF\n  readonly RSYSLOGCONF\n  readonly SECURITYACCESS\n  readonly SERVERIP\n  readonly SSHDFILE\n  readonly SSHFILE\n  readonly SSH_GRPS\n  readonly SSH_PORT\n  readonly SYSCTL\n  readonly SYSCTL_CONF\n  readonly SYSTEMCONF\n  readonly TIMEDATECTL\n  readonly TIMESYNCD\n  readonly UFWDEFAULT\n  readonly USERADD\n  readonly USERCONF\n  readonly VERBOSE\n  readonly WBIN\n\n  for s in ./scripts/*; do\n    [[ -f $s ]] || break\n\n    source \"$s\"\n  done\n\n  f_pre\n  f_kernel\n  f_firewall\n  f_disablenet\n  f_disablefs\n  f_disablemod\n  f_systemdconf\n  f_resolvedconf\n  f_logindconf\n  f_journalctl\n  f_timesyncd\n  f_fstab\n  f_prelink\n  f_aptget_configure\n  f_aptget\n  f_hosts\n  f_issue\n  f_sudo\n  f_logindefs\n  f_sysctl\n  f_limitsconf\n  f_adduser\n  f_rootaccess\n  f_package_install\n  f_psad\n  f_coredump\n  f_usbguard\n  f_postfix\n  f_apport\n  f_motdnews\n  f_rkhunter\n  f_sshconfig\n  f_sshdconfig\n  f_password\n  f_cron\n  f_ctrlaltdel\n  f_auditd\n  f_aide\n  f_rhosts\n  f_users\n  f_lockroot\n  f_package_remove\n  f_suid\n  f_restrictcompilers\n  f_umask\n  f_path\n  f_aa_enforce\n  f_aide_post\n  f_aide_timer\n  f_aptget_noexec\n  f_aptget_clean\n  f_systemddelta\n  f_post\n  f_checkreboot\n\n  echo\n}\n\nLOGFILE=\"hardening-$(hostname --short)-$(date +%y%m%d).log\"\necho \"[HARDENING LOG - $(hostname --fqdn) - $(LANG=C date)]\" >> \"$LOGFILE\"\n\nmain \"$@\" | tee -a \"$LOGFILE\"\n"
        }
      ]
    }
  ]
}