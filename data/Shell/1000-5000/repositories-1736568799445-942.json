{
  "metadata": {
    "timestamp": 1736568799445,
    "page": 942,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjk0OQ==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "dataegret/pg-utils",
      "stars": 1064,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitmodules",
          "type": "blob",
          "size": 0.1005859375,
          "content": "[submodule \"pg_index_watch\"]\n\tpath = pg_index_watch\n\turl = https://github.com/dataegret/pg_index_watch\n"
        },
        {
          "name": "LICENSE.md",
          "type": "blob",
          "size": 1.0986328125,
          "content": "Useful PostgreSQL utilities.\n\nCopyright (c) 2011-2023, Data Egret GmbH (Previously known as PostgreSQL-Consulting.com)\n\nAll the utilities listed on https://github.com/dataegret/pg-utils have been developed by Data Egret DBA as part of company’s ongoing effort to support PostgreSQL adoption and ease of administration. \n\nWe grant permission to use, copy, modify, and distribute them without fee, and without a written agreement, provided that they will carry the copy of this copyright notice.\n\nIn no event shall Data Egret GmbH be liable to any party for direct, indirect, special, incidental, or consequential damages, including lost profits, arising out of the use of these utilities and its documentation, even if Data Egret GmbH has been advised of the possibility of such damage.\n\nData Egret GmbH specifically disclaims any warranties, including, but not limited to, the implied warranties of merchantability and fitness for a particular purpose. The utilities provided hereunder is on an \"as is\" basis, and Data Egret GmbH has no obligations to provide maintenance, support, updates, enhancements, or modifications.\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 16.322265625,
          "content": "## Useful DBA tools by Data Egret\n### 83compat.sql\n\n### check_are_all_subscribed.sql\n\n### check_missing_grants.sql\n\n### check_strange_fk.sql\n\n### check_uniq_indexes.sql\nList all tables which do not have UNIQUE CONSTRAINTs.\n\n### check_config.sql\nThis query is used for getting non default configuration parameters in PostgreSQL.\nFor user/client sessions you can see modified parameters, but reset_val will contain value from configuration file (I hope).\nIf you see (*) before config name it means that parameter has default value.\nIf you see (c) after config name it means that parameter was changed for client session or by another reason (database, user, etc).\nIf you see !!! after config name it means that parameter were changed in file but still not apllied.\nAll fields in report are aligned by width for simplifying a compare procedures.\n\n### create_db_activity_view.sql\n\nCreates more convenient VIEW around pg_stat_activity pg_catalog view. \t\nShows all non idle queries running more then 100ms (optionally 500ms - see a comment in view DDL).\nRequires track_activities=enabled in postgresql.conf to display processes states correctly. \n\nThis view works with PostgreSQL version < 9.2, to use the view with 9.2 or higher please refer create_db_activity_view9.2.sql\n \n\nColumns:\n\n* ts_age - time elapsed since transaction started \n\n* state - process state (active, idle, idle in transaction, idle in transaction (aborted), fastpath function call or disabled when track_activities setting is switched off)\n\n* query_age - time elapsed since current query started\n\n* change_age - time elapsed since the last change of the process state\n\n* datname - database the process is connected to\n\n* pid - process id\n\n* usename - user name which runs the query \n\n* waiting - true is current process is waiting for another one (may not be correct)\n\n* client_addr - remote client ip address \n\n* client_port - remote client port number\n\n* query - current query\n\n### create_db_activity_view9.2.sql\n\nDoes the same for 9.2 and higher\n\n\n### create_query_stat_cpu_time_view.sql\n\nCreates query_stat_cpu_time VIEW to display queries running >= 0.02 seconds (IO time is not taking into account). Require pg_stat_statements extension enabled and optionally track_io_timings enabled in postgresql.conf.\n\nColumns:\n\n* time_percent - total query runtime measured in %, relative to the runtime of all queries;\n\n* iotime_percent - query time spent on block IO in %, relative to the runtime of all queries;\n\n* cputime_percent - query runtime  (without time spent on block IO) in %, relative to the runtime of all queries;\n\n* total_time - total runtime of this query;\n\n* avg_time - average runtime for this query;\n\n* avg_io_time - average time spent on IO for this query;\n\n* calls - numbers of calls for this query;\n\n* calls_percent - numbers of calls for this query in %, relative to the all queries calls;\n\n* rows - number of rows was returned by this query;\n\n* row_percent - row was returned by this query in %, relative to the all rows returned by all others queries;\n\n* query - query text\n\nNote: all queries which runtime less 0.02 seconds, accounts into dedicated 'other' query.\n\n### create_query_stat_io_time_view.sql\nCreating query_stat_io_time VIEW for viewing queries with IO time more or equal 0.02 seconds. Also require pg_stat_statements and track_io_timings in postgresql.conf.\n\nColumns:\n\n* time_percent - total query runtime measured in %, relative to the runtime of all queries;\n\n* iotime_percent - query time spent on block IO in %, relative to the runtime of all queries;\n\n* cputime_percent - query runtime  (without time spent on block IO) in %, relative to the runtime of all queries;\n\n* total_time - total runtime of this query;\n\n* avg_time - average runtime for this query;\n\n* avg_io_time - average time spent on IO for this query;\n\n* calls - numbers of calls for this query;\n\n* calls_percent - numbers of calls for this query in %, relative to the all queries calls;\n\n* rows - number of rows was returned by this query;\n\n* row_percent - row was returned by this query in %, relative to the all rows returned by all others queries;\n\n* query - query text\n\nNote: all queries which runtime less 0.02 seconds, accounts into dedicated 'other' query.\n\n### create_query_stat_log.sql\n\n### create_query_stat_time_view.sql\nCreating query_stat_time VIEW for viewing queries with total runtime more or equal 0.02 seconds (time spent on block IO also included). Require enabled pg_stat_statements and track_io_timings in postgresql.conf.\n\nColumns:\n\n* time_percent - total query runtime measured in %, relative to the runtime of all queries;\n\n* iotime_percent - query time spent on block IO in %, relative to the runtime of all queries;\n\n* cputime_percent - query runtime  (without time spent on block IO) in %, relative to the runtime of all queries;\n\n* total_time - total runtime of this query;\n\n* avg_time - average runtime for this query;\n\n* avg_io_time - average time spent on IO for this query;\n\n* calls - numbers of calls for this query;\n\n* calls_percent - numbers of calls for this query in %, relative to the all queries calls;\n\n* rows - number of rows was returned by this query;\n\n* row_percent - row was returned by this query in %, relative to the all rows returned by all others queries;\n\n* query - query text\n\nNote: all queries which runtime less 0.02 seconds, accounts into dedicated 'other' query.\n\n### create_slonik_set_full.sql\n\n### create slonik_set_incremental.sql\n\n### create_xlog_math_procedures.sql\nThis snippets create following funtions:\n\n* xlog_location_numeric - shows current WAL position in decimal expression.\n\n* replay_lag_mb - shows estimated lag between master and standby server in megabytes.\n\n* all_replayed - returns true if all WAL are replayed (zero lag).\n\nUsage: ???\n\n### db_activity.sql and db_activity9.2.sql\n\n### dirty_to_read_stat.sql\nSome statistics for \"dirty\" buffers. Require pg_buffercache extensions.\n\nColumns: relation - object name and schema which object belongs;\n\n* relkind - object type (r = ordinary table, i = index, S = sequence, v = view, c = composite type, t = TOAST table);\n\n* tblsp - tablespace in which object is stored;\n\n* relsize - object size, in megabytes;\n\n* %_cached - estimated amount of pages in %, which is cached;\n\n* disk_read - read directly from disk (difference between values from pg_stat_get_blocks_fetched and pg_stat_get_blocks_hit);\n\n* dirty_size - dirty pages size, in megabytes;\n\n* buffer_data.%_dirty - dirty pages, in %;\n\n* read_to_dirty_ratio - ratio of the amount of data read from the disk to the amount of dirty pages, i.e. average amount of reading per dirty.\n\nUdage: ???\n\n### generate_drop_items.sql\n\n### index_candidates_from_ssd.sql and index_candidates_to_ssd.sql\nDisplay indexes which should be moved from/to SSD.\n\nColumns:\n\n* table - table which index belongs;\n\n* index - index name;\n\n* tblsp - tablespace where index is stored;\n\n* size - pretty table size\n\n* disk - amount of disk block reads from index;\n\n* disk_rat - amount of disk reads, in %;\n\n* d_w_rat - the ratio of the number of block read from the disk to the total change in rows in a table (insert + update + delete - hot_update);\n\n* write - total writes (in tuples) in the table (insert + update + delete - hot_update);\n\n* idx_scan - number of index scan;\n\n* idx_tup_read - number of rows read through the index;\n\nLow d_w_rat value shows low disk reads with relatively high amount of changes inside relation (this behaviour influnces to the index permanent rebuilding, more changes in table, more changes in index). For displaing indexes which recommended move from SSD, a following conditions are used: display indexes with d_w_rat < 25 and tblsp = \"ssd\".\nHigh d_w_rat value shows high disk reads (bad) with relatively low amount of changes in the table. For displaing indexes which are recommended move on SSD, used following conditions: d_w_rat > 10, disk > 1000 and tblsp != \"ssd\".\n\n### index_disk_activity.sql\nDisplay indexes disk reads statistics.\n\nColumns:\n\n* table - tablename which index is belongs;\n\n* index - index name;\n\n* tblsp - tablespace where index is stored;\n\n* size - pretty index size;\n\n* disk - total amount of disk blocks reads with index;\n\n* disk_rat - amount of disk reads in %;\n\n* d_w_rat - the ratio of the number of block read from the disk to the total change in rows in a tableо (insert + update + delete - hot_update);\n\n* write - total writes (in tuples) in the table (insert + update + delete - hot_update);\n\n* idx_scan - number of index scan;\n\n* buffer_data.dirty - pretty size of dirty data;\n\n* buffer_data.%_dirty - ammount of dirty data, in %.\n\nDisplaing only those indexes which total amount of disk blocks reads (disk column) more than 100 blocks.\n\n### indexes_with_null.sql\nShow indexes with NULL data.\n\nColumns:\n\n* table - table name which index belongs;\n\n* index - index name;\n\n* field - column name;\n\n* statnullfrac - ratio of NULL in column;\n\n* indexsize - index size;\n\n* indexdef - index definition.\n\nShows only indexes with statnullfrac > 0.5 and_size > 81920 bytes.\n\n### low_used_indexes.sql\nShow indexes which low or not used.\n\nColumns:\n\n* schemaname.relname - schema and table which index belongs;\n\n* indexrelname - index name;\n\n* idx_scan - number of index scans;\n\n* write_activity - total amount of writes into table which index belongs (INSERT/UPDATE/DELETE);\n\n* seq_scan - number of sequential scans for this table;\n\n* n_live_tup - number of live rows in the table;\n\n* size - index size.\n\nShow indexes with following conditions: (idx_scan / write_activity) < 0.01 and write_activity > 10000.\n\n### master_wal_position.sql\n\n### query_stat_counts.sql\nDisplay query useful statistics: queries, number of calls, runtime, averages.\n\nColumns:\n\n* time_percent - this query runtime relatively all queries runtime, in %;\n\n* total_time - total amount of time which this query runs;\n\n* avg_time - average query runtime in seconds;\n\n* calls - number of query calls;\n\n* calls_percent - this query number of calls relatively to all queries, in %;\n\n* rows - number of rows returned by this query;\n\n* row_percent - number of rows returned by this query relatively to all rows returned by all other queries, in %;\n\n* query - query text.\n\nAll queries with following condition: (calls / sum(calls)) >= 0.01, are displaing in dedicated query whic named 'other'.\n\n### query_stat_cpu_time.sql, query_stat_io_time.sql, query_stat_rows.sql, query_stat_time.sql \nQueries similar to query_stat_cpu_time, query_stat_io_time, query_stat_time VIEWS and displaing queries runtime with cpu and block IO accounting. Require pg_stat_statement and track_io_timings enabled in postgresql.conf.\n\nColumns:\n\n* time_percent - total query runtime measured in %, relative to the runtime of all queries;\n\n* iotime_percent - query time spent on block IO in %, relative to the runtime of all queries;\n\n* cputime_percent - query runtime  (without time spent on block IO) in %, relative to the runtime of all queries;\n\n* total_time - total runtime of this query;\n\n* avg_time - average runtime for this query;\n\n* avg_io_time - average time spent on IO for this query;\n\n* calls - numbers of calls for this query;\n\n* calls_percent - numbers of calls for this query in %, relative to the all queries calls;\n\n* rows - number of rows was returned by this query;\n\n* row_percent - row was returned by this query in %, relative to the all rows returned by all others queries;\n\n* query - query text\n\nNote: all queries which runtime less 0.02 seconds, accounts into dedicated 'other' query.\n\n### redundant_indexes.sql\nShow redundant indexes - indexes which are built with common column which is present in both indexes.\n\nColumns:\n\n* main_index - index defintion which is estmated as main;\n\n* redundant_index - index definition which is estimated as redundant;\n\n* redundant_index_size - pretty size of redundant index.\n\n### seq_scan_tables.sql\nShow tables with high amount of sequential scans.\n\nColumns:\n\n* schemaname.relname - table name;\n\n* n_live_tup - number of live rows in the table;\n\n* seq_scan - number of sequential scan on that table;\n\n* seq_tup_read - number of rows which returned by sequential sqans;\n\n* write_activity - total amount of writes in the table (INSERT/UPDATE/DELETE);\n\n* index_count - number of indexes which are belongs to the table;\n\n* idx_scan - number of index scans for all table indexes;\n\n* idx_tup_fetch - number of rows which was fetched by index scans.\n\nOnly following tables are shown: with seq_scan > 0 and seq_tup_read > 100000\n\n### set_default_grants.sql\nSetup DEFAUlT PRIVILEGES for all new object created by postgres for role_ro and role_rw roles.\n\nrole_ro: select on sequences; select on tables.\n\nrole_rw: select,usage on sequences; select,insert,update,delete on tables.\n\n### set_missing_grants.sql\nSetup appropriate GRANTs for role_ro (SELECT) and role_rw (SELECT,INSERT,UPDATE,DELETE,USAGE) on tables, views and sequences in case when acl of these objecta are null or not appropriate by this snippet.\n\n### slave_wal_position.sql\nShows current WAL state: position received from master and replayed at this moment.\n\n### slony_tables.sql\nShow tables list from _slony.sl_table\n\n### sync_tablespaces.sql\nFind indexes which stored in different tablespace then their tables and move on indexes (ALTER INDEX indexname SET TABLESPACE tablespace) into tablespace where  the parent table is stored.\n\n### table_candidates_from_ssd.sql and table_candidates_to_ssd.sql\nShow tables which should be moved from SSD (high writes, low reads) or to SSD (low writes, high reads).\n\nColumns:\n\n* nspname.relname - table name;\n\n* tblsp - tablespace where table is stored;\n\n* size - pretty table size, include TOAST;\n\n* ratio - amount of writes (insert/delete/2*update) relatively to all disk reads (pg_stat_get_blocks_fetched - pg_stat_get_blocks_hit), TOAST included;\n\n* disk - amount of disk writes (pg_stat_get_blocks_fetched - pg_stat_get_blocks_hit), TOAST included;\n\n* disk% - amount of disk reads for this table relatively to all disk reads (with TOAST), in %;\n\n* rt_d_rat - ratio of rows returned from table and this table indexes relatively to disk reads for this table;\n\n* r_tuples - number of rows returned from the table and her indexes;\n\n* write - amount of writes in rows (insert/delete/2*update) include TOAST;\n\n* write% - ratio of disk writes related to this table relatively to total amount of writes on all tables (with TOAST);\n\n* n_tup_ins - number of inserted rows, include TOAST;\n\n* n_tup_upd - number of updated rows, include TOAST;\n\n* n_tup_del - number of deleted rows, include TOAST.\n\nTables which should be moved from SSD: tblsp=\"ssd\" and ratio < 20 (high amount pf writes and low reads)\n\nTables which should be moved to SSD: tblsp != \"ssd\" and ratio > 10 (low amount of writes, and high reads)\n\n### table_disk_activity.sql\nShow disk activity for tables.\n\nColumns:\n\n* nspname.relname - table name;\n\n* tblsp - tablespace where table is stored;\n\n* size - pretty table size, include TOAST;\n\n* ratio - ratio of writes (insert/delete/2*update) relatively to disk reads (pg_stat_get_blocks_fetched - pg_stat_get_blocks_hit), include TOAST;\n\n* disk% - ratio of disk reads related to this table relatively to total disk reads from all tables (include TOAST);\n\n* rt_d_rat - ratio of returned rows from this table and indexes relatively to disk reads for this table;\n\n* r_tuples - number of rows returned from this tables and indexes;\n\n* write - amount ow writes in rows (insert/delete/2*update), include TOAST;\n\n* write% - amount of writes for this table relatively to the total amount of writes for all tables, include TOAST;\n\n* dirty - pretty size of dirty pages for this tables;\n\n* %_dirty - amount of dirty pages relatively to the total amount og pages.\n\nOnly that tables are displayed: with pg_stat_get_tuples_fetched > 100 and write > 10\n\n### table_index_write_activity.sql and table_write_activity.sql\nShows amount of index writes (table_index_write_activity.sql) and table writes (table_write_activity.sql).\n\nColumns:\n\n* schemaname.relname - table name;\n\n* size - pretty table size, without indexes;\n\n* tblsp - tablespace where table is stored;\n\n* seq_scan - number of sequential scans for this table;\n\n* idx_scan - number of index scans for this table;\n\n* n_tup_ins - number of inserted rows;\n\n* n_tup_upd - number of updated rows;\n\n* n_tup_del - number of deleted rows;\n\n* total - total amount for writes (INSERT/UPDATE/DELETE) for table_index_write_activity.sql and amount INSERT/2*UPDATE/DELETE for table_write_activity.sql;\n\n* hot_rate - amount of HOT among all update operations;\n\n* fillfactor - fillfactor value for table.\n\nConditions for table_index_write_activity.sql: total > 100\n\nConditions for table_write_activity.sql: total > 0\n"
        },
        {
          "name": "bin",
          "type": "tree",
          "content": null
        },
        {
          "name": "loganalyze",
          "type": "tree",
          "content": null
        },
        {
          "name": "pg_index_watch",
          "type": "commit",
          "content": null
        },
        {
          "name": "slonik_template",
          "type": "tree",
          "content": null
        },
        {
          "name": "sql",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}