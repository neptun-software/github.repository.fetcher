{
  "metadata": {
    "timestamp": 1736568287475,
    "page": 186,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjE5MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "xubiaolin/docker-zerotier-planet",
      "stars": 2726,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".github",
          "type": "tree",
          "content": null
        },
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.0107421875,
          "content": ".idea\n/data"
        },
        {
          "name": "Dockerfile",
          "type": "blob",
          "size": 2.2236328125,
          "content": "FROM alpine:3.14 as builder\n\nENV TZ=Asia/Shanghai\nARG TAG=main\nENV TAG=${TAG}\n\nWORKDIR /app\nADD ./patch/entrypoint.sh /app/entrypoint.sh\nADD ./patch/http_server.js /app/http_server.js\nADD ./patch/mkworld_custom.cpp /app/patch/mkworld_custom.cpp\n\n# init tool\nRUN set -x\\\n    && apk update\\\n    && apk add --no-cache git python3 npm make g++ linux-headers curl pkgconfig openssl-dev  jq build-base  gcc \\\n    && echo \"env prepare success!\"\n\n# make zerotier-one\nRUN set -x\\\n    && curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\\\n    && source \"$HOME/.cargo/env\"\\\n    && git clone https://github.com/zerotier/ZeroTierOne.git\\\n    && cd ZeroTierOne\\\n    && git checkout ${TAG}\\\n    && echo \"åˆ‡æ¢åˆ°tag:${TAG}\"\\\n    && make ZT_SYMLINK=1 \\\n    && make\\\n    && make install\\\n    && echo \"make success!\"\\\n    ; zerotier-one -d  \\\n    ; sleep 5s && ps -ef |grep zerotier-one |grep -v grep |awk '{print $1}' |xargs kill -9\\\n    && echo \"zerotier-one init success!\"\\\n    && cd ./attic/world \\\n    && cp /app/patch/mkworld_custom.cpp .\\\n    && mv mkworld.cpp mkworld.cpp.bak \\\n    && mv mkworld_custom.cpp mkworld.cpp \\\n    && sh build.sh \\\n    && mv mkworld /var/lib/zerotier-one\\\n    && echo \"mkworld build success!\"\n\n\n\n#make ztncui \nRUN set -x \\\n    && mkdir /app -p \\\n    &&  cd /app \\\n    && git clone --progress https://ghproxy.imoyuapp.win/https://github.com/key-networks/ztncui.git\\\n    && cd /app/ztncui/src \\\n    && npm config set registry https://registry.npmmirror.com\\\n    && npm install -g node-gyp\\\n    && npm install \n\nFROM alpine:3.14\n\nWORKDIR /app\n\nENV IP_ADDR4=''\nENV IP_ADDR6=''\n\nENV ZT_PORT=9994\nENV API_PORT=3443\nENV FILE_SERVER_PORT=3000\n\nENV GH_MIRROR=\"https://mirror.ghproxy.com/\"\nENV FILE_KEY=''\nENV TZ=Asia/Shanghai\n\nCOPY --from=builder /app/ztncui /bak/ztncui\nCOPY --from=builder /var/lib/zerotier-one /bak/zerotier-one\n\nCOPY --from=builder /app/ZeroTierOne/zerotier-one /usr/sbin/zerotier-one\nCOPY --from=builder /app/entrypoint.sh /app/entrypoint.sh\nCOPY --from=builder /app/http_server.js /app/http_server.js\n\nRUN set -x \\\n    && apk update \\\n    && apk add --no-cache npm curl jq openssl\\\n    && mkdir /app/config -p \n\n\nVOLUME [ \"/app/dist\",\"/app/ztncui\",\"/var/lib/zerotier-one\",\"/app/config\"]\n\nCMD [\"/bin/sh\",\"/app/entrypoint.sh\"]"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 15.9833984375,
          "content": "# äº¤æµç¾¤\n\n**Telegram**\n- TGäº¤æµç¾¤ï¼šhttps://t.me/+JduuWfhSEPdlNDk1\n\n**QQ Group**\n- 1ç¾¤ï¼ˆå·²æ»¡ï¼‰ï¼š692635772 \n- 2ç¾¤ï¼ˆå·²æ»¡ï¼‰ï¼š785620313\n- 3ç¾¤ï¼š316239544\n\n# åŠŸèƒ½ç‰¹æ€§\n- âœ… æ”¯æŒ Linux/AMD64ã€Linux/ARM64 æ¶æ„\n- ğŸ³ Docker å®¹å™¨åŒ–éƒ¨ç½²\n- ğŸ“¥ æ”¯æŒ URL ä¸‹è½½ planetã€moon é…ç½®\n- ğŸŒ å¯ä½œä¸º Moon æˆ– Planet æœåŠ¡å™¨æ­å»º\n\n# ç›®å½•\n- [0: å¹¿å‘Š](#0-å¹¿å‘Š)\n- [1ï¼šZeroTier ä»‹ç»](#1zerotier-ä»‹ç»)\n- [2ï¼šä¸ºä»€ä¹ˆè¦è‡ªå»ºPLANET æœåŠ¡å™¨](#2ä¸ºä»€ä¹ˆè¦è‡ªå»ºplanet-æœåŠ¡å™¨)\n- [3ï¼šå¼€å§‹å®‰è£…](#3å¼€å§‹å®‰è£…)\n  - [3.1ï¼šå‡†å¤‡æ¡ä»¶](#31å‡†å¤‡æ¡ä»¶)\n    - [3.1.1 å®‰è£…git](#311-å®‰è£…git)\n    - [3.1.2 å®‰è£…docker](#312-å®‰è£…docker)\n    - [3.1.3 å¯åŠ¨docker](#313-å¯åŠ¨docker)\n    - [3.1.4 é…ç½®dockeråŠ é€Ÿé•œåƒï¼ˆå¯é€‰ï¼Œä¸é…ä¹Ÿå¯ä»¥ï¼‰](#314-é…ç½®dockeråŠ é€Ÿé•œåƒå¯é€‰ä¸é…ä¹Ÿå¯ä»¥)\n  - [3.2ï¼šä¸‹è½½é¡¹ç›®æºç ](#32ä¸‹è½½é¡¹ç›®æºç )\n  - [3.3ï¼šæ‰§è¡Œå®‰è£…è„šæœ¬](#33æ‰§è¡Œå®‰è£…è„šæœ¬)\n  - [3.4 ä¸‹è½½ `planet` æ–‡ä»¶](#34-ä¸‹è½½-planet-æ–‡ä»¶)\n  - [3.5 æ–°å»ºç½‘ç»œ](#35-æ–°å»ºç½‘ç»œ)\n    - [3.5.1 åˆ›å»ºç½‘ç»œ](#351-åˆ›å»ºç½‘ç»œ)\n    - [3.5.2 åˆ†é…ç½‘ç»œIP:](#352-åˆ†é…ç½‘ç»œip)\n- [4.å®¢æˆ·ç«¯é…ç½®](#4å®¢æˆ·ç«¯é…ç½®)\n  - [4.1 Windows é…ç½®](#41-windows-é…ç½®)\n    - [4.2 åŠ å…¥ç½‘ç»œ](#42-åŠ å…¥ç½‘ç»œ)\n  - [4.2 Linux å®¢æˆ·ç«¯](#42-linux-å®¢æˆ·ç«¯)\n  - [4.3 å®‰å“å®¢æˆ·ç«¯é…ç½®](#43-å®‰å“å®¢æˆ·ç«¯é…ç½®)\n  - [4.4 MacOS å®¢æˆ·ç«¯é…ç½®](#44-macos-å®¢æˆ·ç«¯é…ç½®)\n  - [4.5 OpenWRT å®¢æˆ·ç«¯é…ç½®](#45-openwrt-å®¢æˆ·ç«¯é…ç½®)\n- [å‚è€ƒé“¾æ¥](#å‚è€ƒé“¾æ¥)\n- [5. ç®¡ç†é¢æ¿SSLé…ç½®](#5-ç®¡ç†é¢æ¿sslé…ç½®)\n- [6. å¸è½½](#6-å¸è½½)\n- [7: Q\\&Aï¼š](#7-qa)\n  - [1. ä¸ºä»€ä¹ˆæˆ‘pingä¸é€šç›®æ ‡æœºå™¨ï¼Ÿ](#1-ä¸ºä»€ä¹ˆæˆ‘pingä¸é€šç›®æ ‡æœºå™¨)\n  - [2. IOSå®¢æˆ·ç«¯æ€ä¹ˆç”¨ï¼Ÿ](#2-ioså®¢æˆ·ç«¯æ€ä¹ˆç”¨)\n  - [3. ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°å®˜æ–¹çš„Planet](#3-ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°å®˜æ–¹çš„planet)\n  - [4. æˆ‘æ›´æ¢äº†IPéœ€è¦æ€ä¹ˆå¤„ç†ï¼Ÿ](#4-æˆ‘æ›´æ¢äº†ipéœ€è¦æ€ä¹ˆå¤„ç†)\n  - [5. PVE lxc å®¹å™¨æ²¡æœ‰åˆ›å»ºç½‘å¡](#5-pve-lxc-å®¹å™¨æ²¡æœ‰åˆ›å»ºç½‘å¡)\n  - [6. ç®¡ç†åå°å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼š](#6-ç®¡ç†åå°å¿˜è®°å¯†ç æ€ä¹ˆåŠ)\n  - [7. ä¸ºä»€ä¹ˆè¿ä¸ä¸Šplanet](#7-ä¸ºä»€ä¹ˆè¿ä¸ä¸Šplanet)\n  - [8. å¦‚ä½•åˆ¤æ–­æ˜¯ç›´è¿è¿˜æ˜¯ä¸­è½¬](#8-å¦‚ä½•åˆ¤æ–­æ˜¯ç›´è¿è¿˜æ˜¯ä¸­è½¬)\n  - [9. ä¸ºä»€ä¹ˆæˆ‘çš„zerotierä¼ è¾“ä¸ç¨³å®š](#9-ä¸ºä»€ä¹ˆæˆ‘çš„zerotierä¼ è¾“ä¸ç¨³å®š)\n  - [10.æ”¯æŒåŸŸåå—ï¼Ÿ](#10æ”¯æŒåŸŸåå—)\n  - [11. ARMæœåŠ¡å™¨å¯ä»¥æ­å»ºå—](#11-armæœåŠ¡å™¨å¯ä»¥æ­å»ºå—)\n  - [12. æ”¯æŒdocker-composeå¯åŠ¨éƒ¨ç½²å—](#12-æ”¯æŒdocker-composeå¯åŠ¨éƒ¨ç½²å—)\n- [å¼€å‘è®¡åˆ’](#å¼€å‘è®¡åˆ’)\n- [é£é™©å£°æ˜](#é£é™©å£°æ˜)\n- [ç±»ä¼¼é¡¹ç›®](#ç±»ä¼¼é¡¹ç›®)\n- [æåŠ©å’Œæ”¯æŒ](#æåŠ©å’Œæ”¯æŒ)\n- [é¸£è°¢](#é¸£è°¢)\n\n# 0: å¹¿å‘Š\n**å¯»æ‰¾ä¾¿æ·çš„è§£å†³æ–¹æ¡ˆï¼Ÿ**\n\næˆ‘ä»¬æä¾›ä¸“ä¸šçš„æ‰˜ç®¡æœåŠ¡ï¼š\n- å…è´¹è¯•ç”¨3å¤©\n- å¹´è´¹ä»…éœ€99ï¿¥\n- é«˜é€Ÿå¸¦å®½ï¼š300Mbit\n- æµé‡æ”¿ç­–ï¼š\n  - æ¯æœˆ100Gè½¬å‘æµé‡\n  - P2Pè¿æ¥åä¸è®¡æµé‡\n  - è¶…å‡ºåæ¯10å…ƒ100G\n- ä¼˜è´¨çº¿è·¯ï¼šå®æ³¢ç”µä¿¡æœºæˆ¿\n- è”ç³»æ–¹å¼ï¼š\n  - Telegramï¼š[https://t.me/uxkram](https://t.me/uxkram)\n  - æˆ–åŠ å…¥QQç¾¤å’¨è¯¢ç¾¤ä¸»\n\næµ‹é€Ÿå›¾å¦‚ä¸‹ï¼š\n\n<img src=\"./asserts/nb-speed-test.png\" width = \"800\" height = \"\" alt=\"å›¾ç‰‡åç§°\" align=center />\n\n\nå¾®ä¿¡å…¬ä¼—å·ï¼šæ¬¢è¿å…³æ³¨å…¬ä¼—å·è·å–æœ€æ–°åŠ¨æ€å’ŒæŠ€æœ¯åˆ†äº«\n\n<img src=\"./asserts/wx_qrcode_pub.jpg\" width = \"300\" height = \"\" alt=\"å›¾ç‰‡åç§°\" align=center />\n\n# 1ï¼šZeroTier ä»‹ç»\n\n`ZeroTier` æ˜¯ä¸€æ¬¾å¼ºå¤§çš„ P2P VPN å·¥å…·ï¼Œå®ƒèƒ½è®©ä½ åœ¨äº’è”ç½‘ä¸Šæ­å»ºå±äºè‡ªå·±çš„è™šæ‹Ÿå±€åŸŸç½‘ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥è½»æ¾å®ç°è¿œç¨‹è®¿é—®å®¶ä¸­è®¾å¤‡çš„éœ€æ±‚ - æ¯”å¦‚åœ¨å…¬å¸ç”¨æ‰‹æœºç›´æ¥è®¿é—®å®¶é‡Œçš„ NASã€‚æœ€é‡è¦çš„æ˜¯ï¼Œè®¾å¤‡ä¹‹é—´æ˜¯ç‚¹å¯¹ç‚¹ç›´è¿çš„ï¼Œæ— éœ€ç»è¿‡ä¸­è½¬æœåŠ¡å™¨ï¼Œæ—¢ä¿è¯äº†é€Ÿåº¦ï¼Œåˆæå‡äº†å®‰å…¨æ€§ã€‚\n\nå®ƒçš„å·¥ä½œåŸç†æ˜¯è¿™æ ·çš„ï¼šé€šè¿‡ `ZeroTier One` å®¢æˆ·ç«¯ï¼Œåœ¨ä¸åŒè®¾å¤‡ï¼ˆå¦‚ç¬”è®°æœ¬ã€æ‰‹æœºã€æœåŠ¡å™¨ç­‰ï¼‰ä¹‹é—´å»ºç«‹ P2P è¿æ¥ï¼Œå³ä½¿è¿™äº›è®¾å¤‡éƒ½åœ¨ NAT åé¢ä¹Ÿæ²¡é—®é¢˜ã€‚å®ƒä½¿ç”¨äº† STUN ç­‰æŠ€æœ¯ï¼Œå¯ä»¥ç©¿é€å¤§å¤šæ•°ç±»å‹çš„ NATï¼Œå®ç°è®¾å¤‡é—´çš„ç›´æ¥é€šä¿¡ã€‚å¦‚æœå®åœ¨æ— æ³•ç›´è¿ï¼Œæ‰ä¼šé€šè¿‡ä¸­è½¬æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚\n\nç®€å•æ¥è¯´ï¼Œ`ZeroTier` å°±åƒæ˜¯ä¸€ä¸ªè·¨è¶Šäº’è”ç½‘çš„\"è™šæ‹Ÿäº¤æ¢æœº\"ï¼Œè®©åˆ†å¸ƒåœ¨ä¸–ç•Œå„åœ°çš„è®¾å¤‡ï¼Œéƒ½èƒ½åƒåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ä¸€æ ·æ–¹ä¾¿åœ°ç›¸äº’è®¿é—®ã€‚\n\n![zerotier](asserts/zerotier-network.png)\n\n**ZeroTier ç½‘ç»œä¸­çš„å…³é”®æ¦‚å¿µ**\n\n`PLANET`ï¼ˆè¡Œæ˜ŸæœåŠ¡å™¨ï¼‰ï¼šZeroTier ç½‘ç»œçš„æ ¸å¿ƒæ ¹æœåŠ¡å™¨ï¼Œè´Ÿè´£ç½‘ç»œå‘ç°å’Œåˆå§‹è¿æ¥ã€‚ç›¸å½“äºæ•´ä¸ªç½‘ç»œçš„\"ä¸­æ¢\"ã€‚\n\n`MOON`ï¼ˆå«æ˜ŸæœåŠ¡å™¨ï¼‰ï¼šç”¨æˆ·å¯ä»¥è‡ªå»ºçš„ç§æœ‰æ ¹æœåŠ¡å™¨ã€‚å®ƒå¯ä»¥ä½œä¸ºåŒºåŸŸæ€§çš„ä»£ç†èŠ‚ç‚¹,å¸®åŠ©å°±è¿‘çš„è®¾å¤‡æ›´å¿«åœ°å»ºç«‹è¿æ¥,æå‡ç½‘ç»œæ€§èƒ½ã€‚\n\n`LEAF`ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰ï¼šæ‰€æœ‰æ¥å…¥ ZeroTier ç½‘ç»œçš„ç»ˆç«¯è®¾å¤‡,å¦‚ç”µè„‘ã€æ‰‹æœºã€æœåŠ¡å™¨ç­‰ã€‚è¿™äº›è®¾å¤‡é€šè¿‡ PLANET å’Œ MOON çš„åè°ƒæ¥ç›¸äº’å‘ç°å’Œé€šä¿¡ã€‚\n\næœ¬æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨æ­å»ºä¸€ä¸ªç§æœ‰çš„ PLANET æœåŠ¡å™¨,è®©æ‚¨å®Œå…¨æŒæ§è‡ªå·±çš„ ZeroTier ç½‘ç»œã€‚\n\n\n# 2ï¼šä¸ºä»€ä¹ˆè¦è‡ªå»ºPLANET æœåŠ¡å™¨\nè‡ªå»º PLANET æœåŠ¡å™¨æœ‰ä»¥ä¸‹å‡ ä¸ªé‡è¦åŸå› ï¼š\n\n1. æå‡ç½‘ç»œç¨³å®šæ€§ï¼šå®˜æ–¹æœåŠ¡å™¨ä½äºæµ·å¤–ï¼Œå›½å†…ç”¨æˆ·è®¿é—®å»¶è¿Ÿé«˜ä¸”ä¸ç¨³å®šã€‚è‡ªå»ºæœåŠ¡å™¨å¯ä»¥å¤§å¹…æå‡è¿æ¥è´¨é‡ã€‚\n\n2. åŠ å¿«è¿æ¥é€Ÿåº¦ï¼šæœ¬åœ°åŒ–çš„ PLANET æœåŠ¡å™¨å¯ä»¥æ›´å¿«åœ°å¸®åŠ©è®¾å¤‡å»ºç«‹ P2P è¿æ¥ã€‚\n\n3. å¢å¼ºç½‘ç»œæ§åˆ¶ï¼šè‡ªå»ºæœåŠ¡å™¨è®©æ‚¨å®Œå…¨æŒæ§ç½‘ç»œé…ç½®ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œä¼˜åŒ–è°ƒæ•´ã€‚\n\n4. æé«˜å®‰å…¨æ€§ï¼šç§æœ‰åŒ–éƒ¨ç½²æ„å‘³ç€ç½‘ç»œæµé‡ä¸ç»è¿‡ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼Œæ›´åŠ å®‰å…¨å¯é ã€‚\n\n5. é™ä½ä¾èµ–ï¼šé¿å…å› å®˜æ–¹æœåŠ¡å™¨æ•…éšœæˆ–ç½‘ç»œæ³¢åŠ¨å½±å“æ‚¨çš„ä¸šåŠ¡æ­£å¸¸è¿è¡Œã€‚\n\n\n# 3ï¼šå¼€å§‹å®‰è£…\n## 3.1ï¼šç¯å¢ƒå‡†å¤‡\nåœ¨å¼€å§‹å®‰è£…ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„æœåŠ¡å™¨æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:\n\n- æœåŠ¡å™¨è¦æ±‚:\n  - æ‹¥æœ‰å…¬ç½‘IPåœ°å€\n  - éœ€å¼€æ”¾ä»¥ä¸‹ç«¯å£:\n    - 3443/tcp (ç®¡ç†é¢æ¿ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´)\n    - 9994/tcp (ZeroTieré€šä¿¡ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´)\n    - 9994/udp (ZeroTieré€šä¿¡ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´)\n\n- è½¯ä»¶ä¾èµ–:\n  - Docker (å®¹å™¨è¿è¡Œç¯å¢ƒ)\n  - Git (è·å–é¡¹ç›®ä»£ç )\n\n- ç³»ç»Ÿè¦æ±‚:\n  - æ¨èä½¿ç”¨è¾ƒæ–°çš„Linuxå‘è¡Œç‰ˆ:\n    - Debian 12\n    - Ubuntu 20.04+\n    - Rocky Linux\n    - å…¶ä»–åŒç±»ç³»ç»Ÿ\n\n### 3.1.1 å®‰è£…git\n```bash\n#debian/ubuntuç­‰\napt update && apt install git -y \n\n#centosç­‰\nyum update && yum install git -y \n```\n\n### 3.1.2 å®‰è£…docker\n```bash\ncurl -fsSL https://get.docker.com |bash \n```\n\nå¦‚æœç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´æ— æ³•å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é•œåƒå®‰è£…ï¼š\n```\ncurl -fsSL get.docker.com -o get-docker.sh\nsudo sh get-docker.sh --mirror Aliyun\n```\n\n### 3.1.3 å¯åŠ¨docker\n```bash\nservice docker start\n```\n\n### 3.1.4 é…ç½®dockeråŠ é€Ÿé•œåƒï¼ˆå¯é€‰ï¼Œä¸é…ä¹Ÿå¯ä»¥ï¼‰\n```\nsudo tee /etc/docker/daemon.json <<EOF\n{\n    \"registry-mirrors\": [\n        \"https://docker.mirrors.aster.edu.pl\",\n        \"https://docker.mirrors.imoyuapp.win\"\n    ]\n}\nEOF\n\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n  \n## 3.2ï¼šä¸‹è½½é¡¹ç›®æºç \nå®˜æ–¹åœ°å€\n```\ngit clone https://github.com/xubiaolin/docker-zerotier-planet.git\n```\n\nåŠ é€Ÿåœ°å€\n```\ngit clone https://ghproxy.imoyuapp.win/https://github.com/xubiaolin/docker-zerotier-planet.git\n```\n\n## 3.3ï¼šæ‰§è¡Œå®‰è£…è„šæœ¬\nè¿›å…¥é¡¹ç›®ç›®å½•\n```\ncd docker-zerotier-planet\n```\n\nè¿è¡Œ `deploy.sh` è„šæœ¬\n```\n./deploy.sh\n```\n\næ ¹æ®æç¤ºæ¥é€‰æ‹©å³å¯ï¼Œæ“ä½œå®Œæˆåä¼šè‡ªåŠ¨éƒ¨ç½²\n```\næ¬¢è¿ä½¿ç”¨zerotier-planetè„šæœ¬ï¼Œè¯·é€‰æ‹©éœ€è¦æ‰§è¡Œçš„æ“ä½œï¼š\n1. å®‰è£…\n2. å¸è½½\n3. æ›´æ–°\n4. æŸ¥çœ‹ä¿¡æ¯\n5. é€€å‡º\nè¯·è¾“å…¥æ•°å­—ï¼š\n```\n\næ•´ä¸ªè„šæœ¬é¢„è®¡éœ€è¦ 1-3 åˆ†é’Ÿ,å…·ä½“éœ€è¦çœ‹ç½‘ç»œä¸æœºå‹\n\n\nå½“æ‚¨çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹å­—æ ·æ—¶ï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸ\n\n![install-finish](./asserts/install_finish.png)\n\n\n## 3.4 ä¸‹è½½ `planet` æ–‡ä»¶\nè„šæœ¬è¿è¡Œå®Œæˆåï¼Œä¼šåœ¨ `./data/zerotier/dist` ç›®å½•ä¸‹ç”Ÿæˆ `planet` å’Œ `moon` é…ç½®æ–‡ä»¶ã€‚\n\næ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è·å–è¿™äº›æ–‡ä»¶:\n\n1. é€šè¿‡å®‰è£…å®Œæˆåæä¾›çš„URLç›´æ¥ä¸‹è½½\n2. ä½¿ç”¨scpæˆ–å…¶ä»–æ–‡ä»¶ä¼ è¾“å·¥å…·ä»æœåŠ¡å™¨ä¸‹è½½\n\nè¯·å¦¥å–„ä¿å­˜è¿™äº›æ–‡ä»¶,åç»­é…ç½®å®¢æˆ·ç«¯æ—¶ä¼šç”¨åˆ°ã€‚\n\n## 3.5 æ–°å»ºç½‘ç»œ\nè®¿é—® `http://ip:3443` è¿›å…¥controlleré¡µé¢\n\n![ui](asserts/ztncui.png)\n\nä½¿ç”¨é»˜è®¤è´¦å·ä¸º:`admin`\n\né»˜è®¤å¯†ç ä¸º:`password`\n\n### 3.5.1 åˆ›å»ºç½‘ç»œ\nç™»å½•åç‚¹å‡»\"Networks\"èœå•ï¼Œç„¶åç‚¹å‡»\"Add Network\"æŒ‰é’®åˆ›å»ºæ–°ç½‘ç»œã€‚\n\nåœ¨åˆ›å»ºç½‘ç»œé¡µé¢ä¸­ï¼Œè¾“å…¥ä¸€ä¸ªä¾¿äºè¯†åˆ«çš„ç½‘ç»œåç§°ï¼Œå…¶ä»–é€‰é¡¹å¯ä¿æŒé»˜è®¤ã€‚ç‚¹å‡»\"Create Network\"æŒ‰é’®å®Œæˆåˆ›å»ºã€‚\n\nåˆ›å»ºæˆåŠŸåç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç½‘ç»œIDï¼Œè¿™ä¸ªIDåœ¨åç»­å®¢æˆ·ç«¯é…ç½®æ—¶ä¼šç”¨åˆ°ï¼Œè¯·è®°å½•ä¸‹æ¥ã€‚\n\n![ui](asserts/ztncui_create_net.png)\n\nå¾—åˆ°ç½‘ç»œ `id`\n\n![ui](asserts/ztncui_net_id.png)\n\n### 3.5.2 åˆ†é…ç½‘ç»œIP:\né€‰ä¸­easy setup\n![assign_id](./asserts/easy_setup.png)\n\nç”ŸæˆipèŒƒå›´\n![ip_addr](./asserts/network_addr.png)\n\n# 4.å®¢æˆ·ç«¯é…ç½®\nZeroTier æ”¯æŒå¤šç§ä¸»æµæ“ä½œç³»ç»Ÿçš„å®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬:\n- Windows\n- macOS \n- Linux\n- Android\n\n## 4.1 Windows é…ç½®\né¦–å…ˆå»zerotierå®˜ç½‘ä¸‹è½½ä¸€ä¸ªzerotierå®¢æˆ·ç«¯\n\nå°† `planet` æ–‡ä»¶è¦†ç›–ç²˜è´´åˆ°`C:\\ProgramData\\ZeroTier\\One`ä¸­(è¿™ä¸ªç›®å½•æ˜¯ä¸ªéšè—ç›®å½•ï¼Œéœ€è¦è¿å…è®¸æŸ¥çœ‹éšè—ç›®å½•æ‰è¡Œ)\n\nWin+S æœç´¢ `æœåŠ¡`\n\n![ui](asserts/service.png)\n\næ‰¾åˆ°ZeroTier Oneï¼Œå¹¶ä¸”é‡å¯æœåŠ¡\n\n![ui](asserts/restart_service.png)\n\n\n### 4.2 åŠ å…¥ç½‘ç»œ\nä½¿ç”¨ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShell\n\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œçœ‹åˆ°join okå­—æ ·å°±æˆåŠŸäº†\n```\nPS C:\\Windows\\system32> zerotier-cli.bat join ç½‘ç»œid(å°±æ˜¯åœ¨ç½‘é¡µé‡Œé¢åˆ›å»ºçš„é‚£ä¸ªç½‘ç»œ)\n200 join OK\nPS C:\\Windows\\system32>\n```\n\nç™»å½•ç®¡ç†åå°å¯ä»¥çœ‹åˆ°æœ‰ä¸ªä¸ªæ–°çš„å®¢æˆ·ç«¯ï¼Œå‹¾é€‰`Authorized`å°±è¡Œ\n\n![ui](asserts/join_net.png)\n\nIP assignment é‡Œé¢ä¼šå‡ºç°zerotierçš„å†…ç½‘ip\n\n![ip](./asserts/allow_devices.png)\n\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n```\nPS C:\\Windows\\system32> zerotier-cli.bat peers\n200 peers\n<ztaddr>   <ver>  <role> <lat> <link> <lastTX> <lastRX> <path>\nfcbaeb9b6c 1.8.7  PLANET    52 DIRECT 16       8994     1.1.1.1/9993\nfe92971aad 1.8.7  LEAF      14 DIRECT -1       4150     2.2.2.2/9993\nPS C:\\Windows\\system32>\n```\nå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª PLANTET å’Œ LEAF è§’è‰²ï¼Œè¿æ¥æ–¹å¼å‡ä¸º DIRECT(ç›´è¿)\n\nåˆ°è¿™é‡Œå°±åŠ å…¥ç½‘ç»œæˆåŠŸäº†\n\n## 4.2 Linux å®¢æˆ·ç«¯\næ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. å®‰è£…linuxå®¢æˆ·ç«¯è½¯ä»¶\n2. è¿›å…¥ç›®å½• `/var/lib/zerotier-one`\n3. æ›¿æ¢ç›®å½•ä¸‹çš„ `planet` æ–‡ä»¶\n4. é‡å¯ `zerotier-one` æœåŠ¡(`service zerotier-one restart`)\n5. åŠ å…¥ç½‘ç»œ `zerotier-cli join` ç½‘ç»œ `id`\n6. ç®¡ç†åå°åŒæ„åŠ å…¥è¯·æ±‚\n7. `zerotier-cli peers` å¯ä»¥çœ‹åˆ°` planet` è§’è‰²\n\n## 4.3 å®‰å“å®¢æˆ·ç«¯é…ç½®\n[Zerotier éå®˜æ–¹å®‰å“å®¢æˆ·ç«¯](https://github.com/kaaass/ZerotierFix)\n\n## 4.4 MacOS å®¢æˆ·ç«¯é…ç½®\næ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. è¿›å…¥ `/Library/Application\\ Support/ZeroTier/One/` ç›®å½•ï¼Œå¹¶æ›¿æ¢ç›®å½•ä¸‹çš„ `planet` æ–‡ä»¶\n2. é‡å¯ ZeroTier-Oneï¼š`cat /Library/Application\\ Support/ZeroTier/One/zerotier-one.pid | sudo xargs kill`\n3. åŠ å…¥ç½‘ç»œ `zerotier-cli join` ç½‘ç»œ `id`\n4. ç®¡ç†åå°åŒæ„åŠ å…¥è¯·æ±‚\n5. `zerotier-cli peers` å¯ä»¥çœ‹åˆ°` planet` è§’è‰²\n\n## 4.5 OpenWRT å®¢æˆ·ç«¯é…ç½®\næ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. å®‰è£…zerotierå®¢æˆ·ç«¯\n2. è¿›å…¥ç›®å½• `/etc/config/zero/planet`\n3. æ›¿æ¢ç›®å½•ä¸‹çš„ `planet` æ–‡ä»¶\n4. åœ¨openwrtç½‘é¡µåå°é‡å¯zerotieræœåŠ¡\n5. åœ¨openwrtç½‘é¡µåå°åŠ å…¥ç½‘ç»œ\n6. ç®¡ç†åå°åŒæ„åŠ å…¥è¯·æ±‚\n7. `zerotier-cli peers` å¯ä»¥çœ‹åˆ°` planet` è§’è‰²\n\n## 4.6 iOS å®¢æˆ·ç«¯é…ç½®\næ–¹æ¡ˆä¸€ï¼š\nè¶Šç‹±åå®‰è£…ZeroTieï¼Œç„¶åæ›¿æ¢`planet`æ–‡ä»¶\n\næ–¹æ¡ˆäºŒï¼š\nä½¿ç”¨Wireguardæ¥å…¥åˆ°ZeroTierç½‘ç»œ\n\n\n# 5. ç®¡ç†é¢æ¿SSLé…ç½®\nç®¡ç†é¢æ¿çš„SSLæ”¯æŒéœ€è¦è‡ªè¡Œé…ç½®ï¼Œå‚è€ƒNginxé…ç½®å¦‚ä¸‹ï¼š\n```\nupstream zerotier {\n  server 127.0.0.1:3443;\n}\n\nserver {\n\n  listen 443 ssl;\n\n  server_name {CUSTOME_DOMAIN}; #æ›¿æ¢è‡ªå·±çš„åŸŸå\n\n  # sslè¯ä¹¦åœ°å€\n  ssl_certificate    pemå’Œæˆ–è€…crtæ–‡ä»¶çš„è·¯å¾„;\n  ssl_certificate_key keyæ–‡ä»¶çš„è·¯å¾„;\n\n  # ssléªŒè¯ç›¸å…³é…ç½®\n  ssl_session_timeout  5m;    #ç¼“å­˜æœ‰æ•ˆæœŸ\n  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;    #åŠ å¯†ç®—æ³•\n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;    #å®‰å…¨é“¾æ¥å¯é€‰çš„åŠ å¯†åè®®\n  ssl_prefer_server_ciphers on;   #ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„é¦–é€‰ç®—æ³•\n\n\n  location / {\n    proxy_pass http://zerotier;\n    proxy_set_header HOST $host;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\nserver {\n    listen       80;\n    server_name  {CUSTOME_DOMAIN}; #æ›¿æ¢è‡ªå·±çš„åŸŸå\n    return 301 https://$server_name$request_uri;\n}\n```\n\n# 6. å¸è½½\n```bash\ndocker rm -f zerotier-planet\n```\n\n# 7: Q&Aï¼š\n## 1. ä¸ºä»€ä¹ˆæˆ‘pingä¸é€šç›®æ ‡æœºå™¨ï¼Ÿ\nè¯·æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œ`Windows` ç³»ç»Ÿéœ€è¦å…è®¸ `ICMP` å…¥ç«™ï¼Œ`Linux` åŒç†\n\n## 2. IOSå®¢æˆ·ç«¯æ€ä¹ˆç”¨ï¼Ÿ\niOS å®¢æˆ·ç«¯æ’ä»¶åœ¨è¿™é‡Œï¼Œè®¾å¤‡éœ€è¦è¶Šç‹±ï¼š https://github.com/lemon4ex/ZeroTieriOSFix\n\n## 3. ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°å®˜æ–¹çš„Planet\nè¯¥é¡¹ç›®å‰”é™¤äº†å®˜æ–¹æœåŠ¡å™¨ï¼Œåªä¿ç•™äº†è‡ªå®šä¹‰çš„PlanetèŠ‚ç‚¹\n\n## 4. æˆ‘æ›´æ¢äº†IPéœ€è¦æ€ä¹ˆå¤„ç†ï¼Ÿ\nå¦‚æœIPæ›´æ¢äº†ï¼Œåˆ™éœ€è¦é‡æ–°éƒ¨ç½²ï¼Œç›¸å½“äºå…¨æ–°éƒ¨ç½²\n\n## 5. PVE lxc å®¹å™¨æ²¡æœ‰åˆ›å»ºç½‘å¡\néœ€è¦ä¿®æ”¹lxcå®¹å™¨çš„é…ç½®ï¼ŒåŒæ—¶lxcå®¹å™¨éœ€è¦å–æ¶ˆå‹¾é€‰`æ— ç‰¹æƒ`\n\n\né…ç½®æ–‡ä»¶ä½ç½®åœ¨`/etc/pve/lxc/{ID}.conf`\n\nåœ¨Proxmox7.0ä¹‹å‰çš„ç‰ˆæœ¬æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n```\nlxc.cgroup.devices.allow: c 10:200 rwm\nlxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file\n```\nåœ¨Proxmox7.0ä¹‹åçš„ç‰ˆæœ¬æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n```\nlxc.cgroup2.devices.allow: c 10:200 rwm\nlxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file\n```\n\n## 6. ç®¡ç†åå°å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼š\næ‰§è¡Œ`./deploy.sh`ï¼Œé€‰æ‹©é‡ç½®å¯†ç å³å¯\n\n## 7. ä¸ºä»€ä¹ˆè¿ä¸ä¸Šplanet\nè¯·æ£€æŸ¥é˜²ç«å¢™ï¼Œå¦‚æœæ˜¯é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç”¨æˆ·ï¼Œéœ€è¦åœ¨å¯¹åº”å¹³å°åå°é˜²ç«å¢™æ”¾è¡Œç«¯å£ã€‚linuxæœºå™¨ä¸Šä¹Ÿè¦æ”¾è¡Œï¼Œå¦‚æœå®‰è£…äº†ufwç­‰é˜²ç«å¢™å·¥å…·ã€‚\n\n## 8. å¦‚ä½•åˆ¤æ–­æ˜¯ç›´è¿è¿˜æ˜¯ä¸­è½¬\nç®¡ç†å‘˜æƒé™æ‰§è¡Œç»ˆç«¯ï¼Œè¿è¡Œ`zerotier-cli peers`\n```\n<ztaddr>   <ver>  <role> <lat> <link>   <lastTX> <lastRX> <path>\n69c0d507d0 -      LEAF      -1 RELAY\n93caa675b0 1.12.2 PLANET  -894 DIRECT   4142     4068     110.42.99.46/9994\nab403e2074 1.10.2 LEAF      -1 RELAY\n```\nå¦‚æœä½ çš„ztaddræ˜¯REPLAY, å°±è¯´æ˜æ˜¯ä¸­è½¬\n\n## 9. ä¸ºä»€ä¹ˆæˆ‘çš„zerotierä¼ è¾“ä¸ç¨³å®š\nç”±äºzerotierä½¿ç”¨çš„æ˜¯udpåè®®ï¼Œéƒ¨åˆ†åœ°åŒºå¯èƒ½å¯¹udpè¿›è¡Œäº†qos, å¯ä»¥è€ƒè™‘ä½¿ç”¨openvpnã€‚\n\n## 10.æ”¯æŒåŸŸåå—ï¼Ÿ\næš‚ä¸æ”¯æŒ\n\n## 11. ARMæœåŠ¡å™¨å¯ä»¥æ­å»ºå—\nå¯ä»¥\n\n## 12. æ”¯æŒdocker-composeå¯åŠ¨éƒ¨ç½²å—\nå‚è€ƒdocker-composeæ–‡ä»¶å¦‚ä¸‹\n\n```\nversion: '3'\n\nservices:\n  myztplanet:\n    image: xubiaolin/zerotier-planet:latest\n    container_name: ztplanet\n    ports:\n      - 9994:9994\n      - 9994:9994/udp\n      - 3443:3443\n      - 3000:3000\n    environment:\n      - IP_ADDR4=[IPV4IP ADDRESS]\n      - IP_ADDR6=\n      - ZT_PORT=9994\n      - API_PORT=3443\n      - FILE_SERVER_PORT=3000\n    volumes:\n      - ./data/zerotier/dist:/app/dist\n      - ./data/zerotier/ztncui:/app/ztncui\n      - ./data/zerotier/one:/var/lib/zerotier-one\n      - ./data/zerotier/config:/app/config\n    restart: unless-stopped\n\n```\n\n# å¼€å‘è®¡åˆ’\nğŸ¥°æ‚¨çš„æåŠ©å¯ä»¥è®©å¼€å‘è®¡åˆ’çš„é€Ÿåº¦æ›´å¿«ğŸ¥°\n- [ ] å¤šplanetæ”¯æŒ\n- [x] 3443ç«¯å£è‡ªå®šä¹‰æ”¯æŒ\n- [ ] planetå’Œcontrolleråˆ†ç¦»éƒ¨ç½²\n\n\n\n# é£é™©å£°æ˜\n\næœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œä¸é¼“åŠ±ç”¨äºå•†ä¸šç”¨é€”ã€‚æˆ‘ä»¬ä¸å¯¹ä»»ä½•å› ä½¿ç”¨æœ¬é¡¹ç›®è€Œå¯¼è‡´çš„ä»»ä½•æŸå¤±è´Ÿè´£ã€‚\n\n\n# ç±»ä¼¼é¡¹ç›®\n- [wireguardä¸€é”®è„šæœ¬](https://github.com/xubiaolin/wireguard-onekey)\n\n\n# æåŠ©å’Œæ”¯æŒ\n\nå¦‚æœè§‰å¾—æœ¬é¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œæ¬¢è¿é€šè¿‡æ‰«æä¸‹æ–¹èµèµç æåŠ©é¡¹ç›® :)\n\n<img src=\"asserts/donate.png\" alt=\"donate\" width=\"400\" height=\"400\" />\n\n# é¸£è°¢\næ„Ÿè°¢ä»¥ä¸‹ç½‘å‹æŠ•å–‚ï¼Œä½ ä»¬çš„æ”¯æŒå’Œé¼“åŠ±æ˜¯æˆ‘ä¸æ‡ˆæ›´æ–°çš„åŠ¨åŠ›\n\næŒ‰æ—¶é—´é¡ºåºæ’åºï¼š\n- éšæ€§\n- æˆ‘\n- ä½ å¥½\n- Calvin\n- å°çŒªçŒªçš„é¥²å…»å‘˜\n- æƒ…è‹¥çŠ¹åœ¨\n- å¤©å¤©æ˜ŸæœŸå¤©\n- å•Šä¹\n- å¤æœ«ç§‹è‡³\n- **å¿ \n- å²¸èŠ·æ±€å…°\n- Kimi Chen\n- åŒ¿å\n- é˜³å…‰æŠ¥å‘Šæ—·è¯¾\n- æ¿‚æºªå…ˆç”Ÿ\n- Water\n- åŒ¿å\n- åŒ¿å\n- é™†\n- ç²¾é’¢è‘«èŠ¦å¨ƒ\n- å”¯\n- ç‹å°æ–°\n- åŒ¿å\n\n\n# å‚è€ƒé“¾æ¥\n[ZeroTier-è™šæ‹Ÿå±€åŸŸç½‘è¯¦è§£](https://www.glimmer.ltd/2021/3299983056/)\n\n[äº”åˆ†é’Ÿè‡ªå»º ZeroTier çš„ Planet/Controller](https://v2ex.com/t/799623)\n\n\n"
        },
        {
          "name": "asserts",
          "type": "tree",
          "content": null
        },
        {
          "name": "build.sh",
          "type": "blob",
          "size": 0.748046875,
          "content": "#!/bin/bash\n\nUSER=zerotier\nREPO=ZeroTierOne\nDOCKER_IMAGE=\"xubiaolin/zerotier-planet\"\n\n\nlatest_tag=$(curl -s \"https://api.github.com/repos/$USER/$REPO/tags\" | jq -r '.[].name' | grep -E \"^[0-9]+\\.[0-9]+\\.[0-9]+$\" | sort -V | tail -n 1)\nlatest_docker_tag=$(curl -s \"https://hub.docker.com/v2/repositories/${DOCKER_IMAGE}/tags/\" | jq -r '.results[].name' | grep -E \"^[0-9]+\\.[0-9]+\\.[0-9]+$\" | sort -V | tail -n 1)\n\nif [ \"$latest_tag\" == \"$latest_docker_tag\" ]; then\n    echo \"No new version found\"\n    exit 0\nfi\n\necho \"Latest tag for $USER/$REPO matching latest is: $latest_tag\"\ndocker buildx build --platform linux/arm64,linux/amd64 -t \"$DOCKER_IMAGE\":latest --push .\ndocker buildx build --platform linux/arm64,linux/amd64 -t \"${DOCKER_IMAGE}:${latest_tag}\" --push .\n"
        },
        {
          "name": "deploy.sh",
          "type": "blob",
          "size": 11.7900390625,
          "content": "#!/bin/bash\n\nCONTAINER_NAME=\"myztplanet\"\nZEROTIER_PATH=\"$(pwd)/data/zerotier\"\nCONFIG_PATH=\"${ZEROTIER_PATH}/config\"\nDIST_PATH=\"${ZEROTIER_PATH}/dist\"\nZTNCUI_PATH=\"${ZEROTIER_PATH}/ztncui\"\nDOCKER_IMAGE_THRID=\"docker.mirrors.imoyuapp.win/xubiaolin/zerotier-planet:latest\"\nDOCKER_IMAGE_SRC=\"xubiaolin/zerotier-planet:latest\"\nDOCKER_IMAGE=$DOCKER_IMAGE_THRID\nprint_message() {\n    local message=$1\n    local color_code=$2\n    echo -e \"\\033[${color_code}m${message}\\033[0m\"\n}\ncheck_proxy(){\n# æ£€æŸ¥daemon.jsonæ–‡ä»¶æ˜¯å¦å­˜åœ¨\nif [ -f /etc/docker/daemon.json ]; then\n    echo \"daemon.json æ–‡ä»¶å­˜åœ¨.\"\n    # æ£€æŸ¥daemon.jsonä¸­æ˜¯å¦æœ‰ä»£ç†é…ç½®\n  \t  if grep -q 'proxy' /etc/docker/daemon.json; then\n        DOCKER_IMAGE=$DOCKER_IMAGE_SRC\n        echo \"ä»£ç†é…ç½®å·²è®¾ç½®.å°†ç›´æ¥ä»å®˜æ–¹æºæ‹‰å–é•œåƒã€$DOCKER_IMAGE_SRCã€‘\"\n    else\n        DOCKER_IMAGE=$DOCKER_IMAGE_THRID\n        echo \"ä»£ç†é…ç½®æœªè®¾ç½®,å°†ä»ç¬¬ä¸‰æ–¹æœåŠ¡å™¨æ‹‰å–é•œåƒã€$DOCKER_IMAGE_THRIDã€‘\"\n    fi\nelse\n    echo \"daemon.json æ–‡ä»¶ä¸å­˜åœ¨.\"\nfi\n\n}\n# æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬\nkernel_check() {\n    os_name=$(grep ^ID= /etc/os-release | cut -d'=' -f2 | tr -d '\"')\n    kernel_version=$(uname -r | cut -d'.' -f1)\n    if ((kernel_version < 5)); then\n        if [[ \"$os_name\" == \"centos\" ]]; then\n            print_message \"å†…æ ¸ç‰ˆæœ¬å¤ªä½,è¯·åœ¨èœå•ä¸­é€‰æ‹©CentOSå†…æ ¸å‡çº§\" \"31\"\n        else\n            print_message \"è¯·è‡ªè¡Œå‡çº§ç³»ç»Ÿå†…æ ¸åˆ°5.*åŠå…¶ä»¥ä¸Šç‰ˆæœ¬\" \"31\"\n        fi\n        exit 1\n    else\n        print_message \"ç³»ç»Ÿå’Œå†…æ ¸ç‰ˆæœ¬æ£€æŸ¥é€šè¿‡ï¼Œå½“å‰å†…æ ¸ç‰ˆæœ¬ä¸ºï¼š$kernel_version\" \"32\"\n    fi\n}\n\n# å‡çº§CentOSå†…æ ¸\nupdate_centos_kernel() {\n    echo \"è¯·æ³¨æ„å¤‡ä»½æ•°æ®ï¼Œå‡çº§å†…æ ¸æœ‰é£é™©\"\n    read -p \"æ˜¯å¦ç»§ç»­å‡çº§å†…æ ¸?(y/n) \" continue_update\n    if [[ \"$continue_update\" =~ ^[Yy]$ ]]; then\n        echo \"å‡çº§æ—¶é—´è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼å¼€å§‹å‡çº§å†…æ ¸...\"\n        yum update -y\n        rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\n        yum install -y https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm\n        yum --disablerepo=\"*\" --enablerepo=\"elrepo-kernel\" install -y kernel-lt-devel kernel-lt\n        sudo awk -F\\' '$1==\"menuentry \" {print i++ \" : \" $2}' /etc/grub2.cfg\n        grub2-set-default 0\n        grub2-mkconfig -o /boot/grub2/grub.cfg\n        read -p \"å†…æ ¸å‡çº§å®Œæˆï¼Œè¯·é‡å¯ç³»ç»Ÿï¼Œæ˜¯å¦ç«‹åˆ»é‡å¯?(y/n) \" reboot\n        if [[ \"$reboot\" =~ ^[Yy]$ ]]; then\n            reboot now\n        else\n            echo \"å·²å–æ¶ˆé‡å¯\"\n            exit 0\n        fi\n    else\n        echo \"å·²å–æ¶ˆå‡çº§å†…æ ¸\"\n        exit 0\n    fi\n}\n\n# å®‰è£…lsofå·¥å…·\ninstall_lsof() {\n    if ! command -v lsof &>/dev/null; then\n        echo \"å¼€å§‹å®‰è£…lsofå·¥å…·...\"\n        if command -v apt &>/dev/null; then\n            apt update && apt install -y lsof\n        elif command -v yum &>/dev/null; then\n            yum install -y lsof\n        elif command -v opkg &>/dev/null; then\n            opkg update&&opkg install lsof\n        else\n            echo \"æ“ä½œå¹³å°æœªè¯†åˆ«!æ— æ³•å®‰è£…lsof...\"\n        fi\n    fi\n}\n\n# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨\ncheck_port() {\n    local port=$1\n    if lsof -i:${port} &>/dev/null; then\n        echo \"ç«¯å£${port}å·²è¢«å ç”¨ï¼Œè¯·é‡æ–°è¾“å…¥\"\n        exit 1\n    fi\n}\n\n# è¯»å–ç«¯å£å·\nread_port() {\n    local port\n    local prompt=$1\n    while :; do\n        read -p \"${prompt}\" port\n        [[ \"$port\" =~ ^[0-9]+$ ]] && break\n        echo \"ç«¯å£å·å¿…é¡»æ˜¯æ•°å­—ï¼Œè¯·é‡æ–°è¾“å…¥: \"\n    done\n    check_port $port\n    echo $port\n}\n\n# è·å–IPåœ°å€\nconfigure_ip() {\n    ipv4=$(curl -s https://ipv4.icanhazip.com/)\n    ipv6=$(curl -s https://ipv6.icanhazip.com/)\n    echo \"è·å–åˆ°çš„IPv4åœ°å€ä¸º: $ipv4\"\n    echo \"è·å–åˆ°çš„IPv6åœ°å€ä¸º: $ipv6\"\n}\n\n# å®‰è£…zerotier-planet\ninstall() {\n    # kernel_check\n    check_proxy\n    \n    if docker inspect ${CONTAINER_NAME} &>/dev/null; then\n        echo \"å®¹å™¨${CONTAINER_NAME}å·²ç»å­˜åœ¨\"\n        read -p \"æ˜¯å¦æ›´æ–°ç‰ˆæœ¬?(y/n) \" update_version\n        if [[ \"$update_version\" =~ ^[Yy]$ ]]; then\n            upgrade\n            exit 0\n        fi\n    fi\n\n    echo \"å¼€å§‹å®‰è£…ï¼Œå¦‚æœä½ å·²ç»å®‰è£…äº†ï¼Œå°†ä¼šåˆ é™¤æ—§çš„æ•°æ®ï¼Œ10ç§’åå¼€å§‹å®‰è£…...\"\n\n    \n    sleep 10\n\n    install_lsof\n\n    docker rm -f ${CONTAINER_NAME} || true\n    rm -rf ${ZEROTIER_PATH}\n\n    ZT_PORT=$(read_port \"è¯·è¾“å…¥zerotier-planetè¦ä½¿ç”¨çš„ç«¯å£å·ï¼Œä¾‹å¦‚9994: \")\n    API_PORT=$(read_port \"è¯·è¾“å…¥zerotier-planetçš„APIç«¯å£å·ï¼Œä¾‹å¦‚3443: \")\n    FILE_PORT=$(read_port \"è¯·è¾“å…¥zerotier-planetçš„FILEç«¯å£å·ï¼Œä¾‹å¦‚3000: \")\n\n    read -p \"æ˜¯å¦è‡ªåŠ¨è·å–å…¬ç½‘IPåœ°å€?(y/n) \" use_auto_ip\n    if [[ \"$use_auto_ip\" =~ ^[Yy]$ ]]; then\n        configure_ip\n        read -p \"æ˜¯å¦ä½¿ç”¨ä¸Šé¢è·å–åˆ°çš„IPåœ°å€?(y/n) \" use_auto_ip_result\n        if [[ \"$use_auto_ip_result\" =~ ^[Nn]$ ]]; then\n            read -p \"è¯·è¾“å…¥IPv4åœ°å€: \" ipv4\n            read -p \"è¯·è¾“å…¥IPv6åœ°å€(å¯ç•™ç©º): \" ipv6\n        fi\n    else\n        read -p \"è¯·è¾“å…¥IPv4åœ°å€: \" ipv4\n        read -p \"è¯·è¾“å…¥IPv6åœ°å€(å¯ç•™ç©º): \" ipv6\n    fi\n\n    echo \"---------------------------\"\n    echo \"ä½¿ç”¨çš„ç«¯å£å·ä¸ºï¼š${ZT_PORT}\"\n    echo \"APIç«¯å£å·ä¸ºï¼š${API_PORT}\"\n    echo \"FILEç«¯å£å·ä¸ºï¼š${FILE_PORT}\"\n    echo \"IPv4åœ°å€ä¸ºï¼š${ipv4}\"\n    echo \"IPv6åœ°å€ä¸ºï¼š${ipv6}\"\n    echo \"---------------------------\"\n\n    docker run -d \\\n        --name ${CONTAINER_NAME} \\\n        -p ${ZT_PORT}:${ZT_PORT} \\\n        -p ${ZT_PORT}:${ZT_PORT}/udp \\\n        -p ${API_PORT}:${API_PORT} \\\n        -p ${FILE_PORT}:${FILE_PORT} \\\n        -e IP_ADDR4=${ipv4} \\\n        -e IP_ADDR6=${ipv6} \\\n        -e ZT_PORT=${ZT_PORT} \\\n        -e API_PORT=${API_PORT} \\\n        -e FILE_SERVER_PORT=${FILE_PORT} \\\n        -v ${DIST_PATH}:/app/dist \\\n        -v ${ZTNCUI_PATH}:/app/ztncui \\\n        -v ${ZEROTIER_PATH}/one:/var/lib/zerotier-one \\\n        -v ${CONFIG_PATH}:/app/config \\\n        --restart unless-stopped \\\n        ${DOCKER_IMAGE}\n\n    sleep 10\n\n    KEY=$(docker exec -it ${CONTAINER_NAME} sh -c 'cat /app/config/file_server.key' | tr -d '\\r')\n    MOON_NAME=$(docker exec -it ${CONTAINER_NAME} sh -c 'ls /app/dist | grep moon' | tr -d '\\r')\n\n    echo \"å®‰è£…å®Œæˆ\"\n    echo \"---------------------------\"\n    echo \"è¯·è®¿é—® http://${ipv4}:${API_PORT} è¿›è¡Œé…ç½®\"\n    echo \"é»˜è®¤ç”¨æˆ·åï¼šadmin\"\n    echo \"é»˜è®¤å¯†ç ï¼špassword\"\n    echo \"è¯·åŠæ—¶ä¿®æ”¹å¯†ç \"\n    echo \"---------------------------\"\n    echo \"mooné…ç½®å’Œplaneté…ç½®åœ¨ ${DIST_PATH} ç›®å½•ä¸‹\"\n    echo \"moons æ–‡ä»¶ä¸‹è½½ï¼š http://${ipv4}:${FILE_PORT}/${MOON_NAME}?key=${KEY} \"\n    echo \"planetæ–‡ä»¶ä¸‹è½½ï¼š http://${ipv4}:${FILE_PORT}/planet?key=${KEY} \"\n    echo \"---------------------------\"\n    echo \"è¯·æ”¾è¡Œä»¥ä¸‹ç«¯å£ï¼š${ZT_PORT}/tcp,${ZT_PORT}/udpï¼Œ${API_PORT}/tcpï¼Œ${FILE_PORT}/tcp\"\n    echo \"---------------------------\"\n}\n\ninstall_from_config() {\n    if [ ! -d \"${CONFIG_PATH}\" ] || [ ! \"$(ls -A ${CONFIG_PATH})\" ]; then\n        echo \"é…ç½®æ–‡ä»¶ç›®å½•ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œè¯·å…ˆä¸Šä¼ é…ç½®æ–‡ä»¶\"\n        exit 1\n    fi\n\n    extract_config() {\n        local config_name=$1\n        cat ${CONFIG_PATH}/${config_name} | tr -d '\\r'\n    }\n\n    ipv4=$(extract_config \"ip_addr4\")\n    ipv6=$(extract_config \"ip_addr6\")\n    API_PORT=$(extract_config \"ztncui.port\")\n    FILE_PORT=$(extract_config \"file_server.port\")\n    ZT_PORT=$(extract_config \"zerotier-one.port\")\n    KEY=$(extract_config \"file_server.key\")\n    MOON_NAME=$(ls ${DIST_PATH}/ | grep moon | tr -d '\\r')\n\n    echo \"---------------------------\"\n    echo \"ipv4:${ipv4}\"\n    echo \"ipv6:${ipv6}\"\n    echo \"API_PORT:${API_PORT}\"\n    echo \"FILE_PORT:${FILE_PORT}\"\n    echo \"ZT_PORT:${ZT_PORT}\"\n    echo \"KEY:${KEY}\"\n    echo \"MOON_NAME:${MOON_NAME}\"\n    echo \"---------------------------\"\n\n    docker run -d \\\n        --name ${CONTAINER_NAME} \\\n        -p ${ZT_PORT}:${ZT_PORT} \\\n        -p ${ZT_PORT}:${ZT_PORT}/udp \\\n        -p ${API_PORT}:${API_PORT} \\\n        -p ${FILE_PORT}:${FILE_PORT} \\\n        -e IP_ADDR4=${ipv4} \\\n        -e IP_ADDR6=${ipv6} \\\n        -e ZT_PORT=${ZT_PORT} \\\n        -e API_PORT=${API_PORT} \\\n        -e FILE_SERVER_PORT=${FILE_PORT} \\\n        -v ${DIST_PATH}:/app/dist \\\n        -v ${ZTNCUI_PATH}:/app/ztncui \\\n        -v ${ZEROTIER_PATH}/one:/var/lib/zerotier-one \\\n        -v ${CONFIG_PATH}:/app/config \\\n        --restart unless-stopped \\\n        ${DOCKER_IMAGE}\n}\n\nupgrade() {\n    if ! docker inspect ${CONTAINER_NAME} &>/dev/null; then\n        echo \"å®¹å™¨${CONTAINER_NAME}ä¸å­˜åœ¨ï¼Œè¯·å…ˆå®‰è£…\"\n        exit 1\n    fi\n\n    docker pull ${DOCKER_IMAGE}\n    new_image_id=$(docker inspect ${DOCKER_IMAGE} --format='{{.Id}}')\n    old_image_id=$(docker inspect ${CONTAINER_NAME} --format='{{.Image}}')\n    if [ \"$new_image_id\" == \"$old_image_id\" ]; then\n        print_message \"å½“å‰ç‰ˆæœ¬å·²ç»æ˜¯æœ€æ–°ç‰ˆæœ¬\" \"32\"\n        exit 0\n    else\n        echo \"å‘ç°æ–°ç‰ˆæœ¬ï¼Œå¼€å§‹å‡çº§...new_image_id:${new_image_id},old_image_id:${old_image_id}\"\n        echo \"æ›´æ–°å¯èƒ½å­˜åœ¨é£é™©ï¼Œè¯·æ‰‹åŠ¨å¤‡ä»½dataç›®å½•ä¸­çš„æ•°æ®,è°¨æ…æ“ä½œ\"\n        read -p \"æ˜¯å¦ç»§ç»­å‡çº§?(y/n) \" continue_upgrade\n        if [[ ! \"$continue_upgrade\" =~ ^[Yy]$ ]]; then\n            echo \"å·²å–æ¶ˆå‡çº§\"\n            exit 0\n        fi\n    fi\n\n    echo \"å¼€å§‹å‡çº§ï¼Œå°†ä¼šåˆ é™¤æ—§çš„å®¹å™¨ï¼Œ10ç§’åå¼€å§‹å‡çº§...\"\n    sleep 10\n\n    docker rm -f ${CONTAINER_NAME} || true\n    install_from_config\n}\n\ninfo() {\n    if ! docker inspect ${CONTAINER_NAME} &>/dev/null; then\n        echo \"å®¹å™¨${CONTAINER_NAME}ä¸å­˜åœ¨ï¼Œè¯·å…ˆå®‰è£…\"\n        exit 1\n    fi\n\n    extract_config() {\n        local config_name=$1\n        cat ${CONFIG_PATH}/${config_name} | tr -d '\\r'\n    }\n\n    ipv4=$(extract_config \"ip_addr4\")\n    ipv6=$(extract_config \"ip_addr6\")\n    API_PORT=$(extract_config \"ztncui.port\")\n    FILE_PORT=$(extract_config \"file_server.port\")\n    ZT_PORT=$(extract_config \"zerotier-one.port\")\n    KEY=$(extract_config \"file_server.key\")\n    MOON_NAME=$(ls ${DIST_PATH}/ | grep moon | tr -d '\\r')\n\n    echo \"---------------------------\"\n    print_message \"ä»¥ä¸‹ç«¯å£çš„tcpå’Œudpåè®®è¯·æ”¾è¡Œï¼š${ZT_PORT}ï¼Œ${API_PORT}ï¼Œ${FILE_PORT}\" \"32\"\n    echo \"---------------------------\"\n    echo \"è¯·è®¿é—® http://${ipv4}:${API_PORT} è¿›è¡Œé…ç½®\"\n    echo \"é»˜è®¤ç”¨æˆ·åï¼šadmin\"\n    echo \"é»˜è®¤å¯†ç ï¼špassword\"\n    echo \"è¯·åŠæ—¶ä¿®æ”¹å¯†ç \"\n    echo \"---------------------------\"\n    print_message \"mooné…ç½®å’Œplaneté…ç½®åœ¨ ${DIST_PATH} ç›®å½•ä¸‹\" \"32\"\n    print_message \"planetæ–‡ä»¶ä¸‹è½½ï¼š http://${ipv4}:${FILE_PORT}/planet?key=${KEY} \" \"32\"\n    print_message \"moonæ–‡ä»¶ä¸‹è½½ï¼š http://${ipv4}:${FILE_PORT}/${MOON_NAME}?key=${KEY} \" \"32\"\n}\n\nuninstall() {\n    echo \"å¼€å§‹å¸è½½...\"\n\n    docker stop ${CONTAINER_NAME}\n    docker rm ${CONTAINER_NAME}\n    docker rmi ${DOCKER_IMAGE}\n\n    read -p \"æ˜¯å¦åˆ é™¤æ•°æ®?(y/n) \" delete_data\n    if [[ \"$delete_data\" =~ ^[Yy]$ ]]; then\n        rm -rf ${ZEROTIER_PATH}\n    fi\n\n    echo \"å¸è½½å®Œæˆ\"\n}\n\nresetpwd() {\n    docker exec -it ${CONTAINER_NAME} sh -c 'cp /app/ztncui/src/etc/default.passwd /app/ztncui/src/etc/passwd'\n    if [ $? -ne 0 ]; then\n        echo \"é‡ç½®å¯†ç å¤±è´¥\"\n        exit 1\n    fi\n\n    docker restart ${CONTAINER_NAME}\n    if [ $? -ne 0 ]; then\n        echo \"é‡å¯æœåŠ¡å¤±è´¥\"\n        exit 1\n    fi\n\n    echo \"--------------------------------\"\n    echo \"é‡ç½®å¯†ç æˆåŠŸ\"\n    echo \"å½“å‰ç”¨æˆ·å admin, å¯†ç ä¸º password\"\n    echo \"--------------------------------\"\n}\n\nmenu() {\n    echo \"æ¬¢è¿ä½¿ç”¨zerotier-planetè„šæœ¬ï¼Œè¯·é€‰æ‹©éœ€è¦æ‰§è¡Œçš„æ“ä½œï¼š\"\n    echo \"1. å®‰è£…\"\n    echo \"2. å¸è½½\"\n    echo \"3. æ›´æ–°\"\n    echo \"4. æŸ¥çœ‹ä¿¡æ¯\"\n    echo \"5. é‡ç½®å¯†ç \"\n    echo \"6. CentOSå†…æ ¸å‡çº§\"\n    echo \"7. æ£€æŸ¥æ˜¯å¦è®¾ç½®ä»£ç†\"\n    echo \"0. é€€å‡º\"\n    read -p \"è¯·è¾“å…¥æ•°å­—ï¼š\" num\n    case \"$num\" in\n    1) install ;;\n    2) uninstall ;;\n    3) upgrade ;;\n    4) info ;;\n    5) resetpwd ;;\n    6) update_centos_kernel ;;\n    7) check_proxy ;;\n    0) exit ;;\n    *) echo \"è¯·è¾“å…¥æ­£ç¡®æ•°å­— [0-7]\" ;;\n    esac\n}\n\nmenu\n"
        },
        {
          "name": "patch",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}