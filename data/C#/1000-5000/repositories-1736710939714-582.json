{
  "metadata": {
    "timestamp": 1736710939714,
    "page": 582,
    "hasNextPage": true,
    "endCursor": "Y3Vyc29yOjU5MA==",
    "completionStatus": "IN_PROGRESS"
  },
  "repositories": [
    {
      "nameWithOwner": "leinlin/Miku-LuaProfiler",
      "stars": 1925,
      "defaultBranch": "master",
      "files": [
        {
          "name": ".gitignore",
          "type": "blob",
          "size": 0.828125,
          "content": ".vs\n.idea\nLibrary\nProjectSettings\ncapture*\n*.sample\nTemp\n/Assets/XLua/Gen\n/Assets/XLua/Gen.meta\nAssets/StreamingAssets.meta\nAssets/StreamingAssets/\nAssets/xLuaTest.meta\nAssets/xLuaTest/\n/build/build*\nUnityVS\n/Assets/UnityVS.meta\n.DS_Store\n*.o\n/build/*/*.a\n\nobj\nbin\nPackages\nmanifest.json\n\n/LuaProfiler/LuaProfilerClient/Resources\n\n/Server\n/LuaProfiler/LuaProfilerServer/*.userprefs\n/LuaProfiler/LuaProfilerServer/Assets/Diff.meta\n/LuaProfiler/LuaProfilerServer/Assets/Diff\n/LuaProfiler/LuaProfilerServer/Diff\n/LuaProfiler/LuaProfilerServer/Ref\n/LuaProfiler/Tools/mikuhook_runtime/.vscode\nLuaDeepProfilerSettings.config\nLuaDeepProfilerAssetSetting.asset\nLuaDeepProfilerAssetSetting.asset.meta\nLuaDeepProfilerSetting.asset\nLuaDeepProfilerSetting.asset.meta\nAssembly-CSharp.csproj\nAssembly-CSharp-Editor.csproj\n/LuaProfiler/Tools/InjectLuaCPP/.vscode\n"
        },
        {
          "name": "LICENSE",
          "type": "blob",
          "size": 11.0908203125,
          "content": "                                 Apache License\n                           Version 2.0, January 2004\n                        http://www.apache.org/licenses/\n\n   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION\n\n   1. Definitions.\n\n      \"License\" shall mean the terms and conditions for use, reproduction,\n      and distribution as defined by Sections 1 through 9 of this document.\n\n      \"Licensor\" shall mean the copyright owner or entity authorized by\n      the copyright owner that is granting the License.\n\n      \"Legal Entity\" shall mean the union of the acting entity and all\n      other entities that control, are controlled by, or are under common\n      control with that entity. For the purposes of this definition,\n      \"control\" means (i) the power, direct or indirect, to cause the\n      direction or management of such entity, whether by contract or\n      otherwise, or (ii) ownership of fifty percent (50%) or more of the\n      outstanding shares, or (iii) beneficial ownership of such entity.\n\n      \"You\" (or \"Your\") shall mean an individual or Legal Entity\n      exercising permissions granted by this License.\n\n      \"Source\" form shall mean the preferred form for making modifications,\n      including but not limited to software source code, documentation\n      source, and configuration files.\n\n      \"Object\" form shall mean any form resulting from mechanical\n      transformation or translation of a Source form, including but\n      not limited to compiled object code, generated documentation,\n      and conversions to other media types.\n\n      \"Work\" shall mean the work of authorship, whether in Source or\n      Object form, made available under the License, as indicated by a\n      copyright notice that is included in or attached to the work\n      (an example is provided in the Appendix below).\n\n      \"Derivative Works\" shall mean any work, whether in Source or Object\n      form, that is based on (or derived from) the Work and for which the\n      editorial revisions, annotations, elaborations, or other modifications\n      represent, as a whole, an original work of authorship. For the purposes\n      of this License, Derivative Works shall not include works that remain\n      separable from, or merely link (or bind by name) to the interfaces of,\n      the Work and Derivative Works thereof.\n\n      \"Contribution\" shall mean any work of authorship, including\n      the original version of the Work and any modifications or additions\n      to that Work or Derivative Works thereof, that is intentionally\n      submitted to Licensor for inclusion in the Work by the copyright owner\n      or by an individual or Legal Entity authorized to submit on behalf of\n      the copyright owner. For the purposes of this definition, \"submitted\"\n      means any form of electronic, verbal, or written communication sent\n      to the Licensor or its representatives, including but not limited to\n      communication on electronic mailing lists, source code control systems,\n      and issue tracking systems that are managed by, or on behalf of, the\n      Licensor for the purpose of discussing and improving the Work, but\n      excluding communication that is conspicuously marked or otherwise\n      designated in writing by the copyright owner as \"Not a Contribution.\"\n\n      \"Contributor\" shall mean Licensor and any individual or Legal Entity\n      on behalf of whom a Contribution has been received by Licensor and\n      subsequently incorporated within the Work.\n\n   2. Grant of Copyright License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      copyright license to reproduce, prepare Derivative Works of,\n      publicly display, publicly perform, sublicense, and distribute the\n      Work and such Derivative Works in Source or Object form.\n\n   3. Grant of Patent License. Subject to the terms and conditions of\n      this License, each Contributor hereby grants to You a perpetual,\n      worldwide, non-exclusive, no-charge, royalty-free, irrevocable\n      (except as stated in this section) patent license to make, have made,\n      use, offer to sell, sell, import, and otherwise transfer the Work,\n      where such license applies only to those patent claims licensable\n      by such Contributor that are necessarily infringed by their\n      Contribution(s) alone or by combination of their Contribution(s)\n      with the Work to which such Contribution(s) was submitted. If You\n      institute patent litigation against any entity (including a\n      cross-claim or counterclaim in a lawsuit) alleging that the Work\n      or a Contribution incorporated within the Work constitutes direct\n      or contributory patent infringement, then any patent licenses\n      granted to You under this License for that Work shall terminate\n      as of the date such litigation is filed.\n\n   4. Redistribution. You may reproduce and distribute copies of the\n      Work or Derivative Works thereof in any medium, with or without\n      modifications, and in Source or Object form, provided that You\n      meet the following conditions:\n\n      (a) You must give any other recipients of the Work or\n          Derivative Works a copy of this License; and\n\n      (b) You must cause any modified files to carry prominent notices\n          stating that You changed the files; and\n\n      (c) You must retain, in the Source form of any Derivative Works\n          that You distribute, all copyright, patent, trademark, and\n          attribution notices from the Source form of the Work,\n          excluding those notices that do not pertain to any part of\n          the Derivative Works; and\n\n      (d) If the Work includes a \"NOTICE\" text file as part of its\n          distribution, then any Derivative Works that You distribute must\n          include a readable copy of the attribution notices contained\n          within such NOTICE file, excluding those notices that do not\n          pertain to any part of the Derivative Works, in at least one\n          of the following places: within a NOTICE text file distributed\n          as part of the Derivative Works; within the Source form or\n          documentation, if provided along with the Derivative Works; or,\n          within a display generated by the Derivative Works, if and\n          wherever such third-party notices normally appear. The contents\n          of the NOTICE file are for informational purposes only and\n          do not modify the License. You may add Your own attribution\n          notices within Derivative Works that You distribute, alongside\n          or as an addendum to the NOTICE text from the Work, provided\n          that such additional attribution notices cannot be construed\n          as modifying the License.\n\n      You may add Your own copyright statement to Your modifications and\n      may provide additional or different license terms and conditions\n      for use, reproduction, or distribution of Your modifications, or\n      for any such Derivative Works as a whole, provided Your use,\n      reproduction, and distribution of the Work otherwise complies with\n      the conditions stated in this License.\n\n   5. Submission of Contributions. Unless You explicitly state otherwise,\n      any Contribution intentionally submitted for inclusion in the Work\n      by You to the Licensor shall be under the terms and conditions of\n      this License, without any additional terms or conditions.\n      Notwithstanding the above, nothing herein shall supersede or modify\n      the terms of any separate license agreement you may have executed\n      with Licensor regarding such Contributions.\n\n   6. Trademarks. This License does not grant permission to use the trade\n      names, trademarks, service marks, or product names of the Licensor,\n      except as required for reasonable and customary use in describing the\n      origin of the Work and reproducing the content of the NOTICE file.\n\n   7. Disclaimer of Warranty. Unless required by applicable law or\n      agreed to in writing, Licensor provides the Work (and each\n      Contributor provides its Contributions) on an \"AS IS\" BASIS,\n      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n      implied, including, without limitation, any warranties or conditions\n      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A\n      PARTICULAR PURPOSE. You are solely responsible for determining the\n      appropriateness of using or redistributing the Work and assume any\n      risks associated with Your exercise of permissions under this License.\n\n   8. Limitation of Liability. In no event and under no legal theory,\n      whether in tort (including negligence), contract, or otherwise,\n      unless required by applicable law (such as deliberate and grossly\n      negligent acts) or agreed to in writing, shall any Contributor be\n      liable to You for damages, including any direct, indirect, special,\n      incidental, or consequential damages of any character arising as a\n      result of this License or out of the use or inability to use the\n      Work (including but not limited to damages for loss of goodwill,\n      work stoppage, computer failure or malfunction, or any and all\n      other commercial damages or losses), even if such Contributor\n      has been advised of the possibility of such damages.\n\n   9. Accepting Warranty or Additional Liability. While redistributing\n      the Work or Derivative Works thereof, You may choose to offer,\n      and charge a fee for, acceptance of support, warranty, indemnity,\n      or other liability obligations and/or rights consistent with this\n      License. However, in accepting such obligations, You may act only\n      on Your own behalf and on Your sole responsibility, not on behalf\n      of any other Contributor, and only if You agree to indemnify,\n      defend, and hold each Contributor harmless for any liability\n      incurred by, or claims asserted against, such Contributor by reason\n      of your accepting any such warranty or additional liability.\n\n   END OF TERMS AND CONDITIONS\n\n   APPENDIX: How to apply the Apache License to your work.\n\n      To apply the Apache License to your work, attach the following\n      boilerplate notice, with the fields enclosed by brackets \"[]\"\n      replaced with your own identifying information. (Don't include\n      the brackets!)  The text should be enclosed in the appropriate\n      comment syntax for the file format. We also recommend that a\n      file or class name and description of purpose be included on the\n      same \"printed page\" as the copyright notice for easier\n      identification within third-party archives.\n\n   Copyright [yyyy] [name of copyright owner]\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n"
        },
        {
          "name": "LICENSE.meta",
          "type": "blob",
          "size": 0.1513671875,
          "content": "fileFormatVersion: 2\nguid: fe5b8fa7a2c395e44ac29b955b1961aa\nDefaultImporter:\n  externalObjects: {}\n  userData: \n  assetBundleName: \n  assetBundleVariant: \n"
        },
        {
          "name": "LuaProfiler.meta",
          "type": "blob",
          "size": 0.16796875,
          "content": "fileFormatVersion: 2\nguid: f451af3b1f90bff4b87ced4daf91df1c\nfolderAsset: yes\nDefaultImporter:\n  externalObjects: {}\n  userData: \n  assetBundleName: \n  assetBundleVariant: \n"
        },
        {
          "name": "LuaProfiler",
          "type": "tree",
          "content": null
        },
        {
          "name": "LuaProfiler~",
          "type": "tree",
          "content": null
        },
        {
          "name": "README.md",
          "type": "blob",
          "size": 6.9443359375,
          "content": "## Lua Profiler For Unity\n\n![](doc~/logo.png)\n\n### 支持情况\n| 系统                  | 支持情况|\n| ----------------------- | ------------ |\n| `windows`| ✔  |\n| `android`| ✔  |\n| `MAC`| 支持中  |\n| `IOS`| 支持中  |\n\n![](doc~/use.gif)\n\n### 部署和安装\n1. 推荐安装Unity2019可以直接用PackageManager 用add by git路径添加,国内网络不好可以使用gitee代理\n![](doc~/package_clone.png)\n>https://github.com/leinlin/Miku-LuaProfiler.git\n\n2. Unity5.6以上版本建议把代码clone下来，然后把LuaProfiler目录copy到Assets中\n\n3. 看到这个菜单说明安装成功了\n![](doc~/install_success.png)\n\n### 如何使用\n- 编辑器使用推荐使用local模式，打开DeepLua开关即可\n![](doc~/2022-12-14-21-50-20.png)\n\n- 真机目前只支持android系统，打包的时候加上宏 `USE_LUA_PROFILER`\n- 打包后，使用四根手指同时连续敲击屏幕5下以上后，就会出现以下菜单\n![](doc~/2022-12-14-21-58-59.png)\n\n- 点击 `Open Lua Profiler`就会打上标记，下一次启动游戏就会出现一个黑屏\n\n编辑器中点击local mode 按钮就可以切换remote mode,输入手机ip就可以查看数据了\n\n![](doc~/2022-12-14-22-04-21.png)\n如果公司网络不允许你直接访问手机ip，那么可以用USB数据线连接手机和电脑输入以下指令\n```\nadb forward tcp:2333 tcp:2333\n```\n之后直接在ip栏中输入`127.0.0.1`即可\n\n### 数据说明\n| Name                    | Descriptions                                                                                              |\n| ----------------------- | -------------------------------------------------------------------------------------------------------   |\n| `Overview`              | 函数名称                                                                                                  |\n| `totalLuaMemory`        | 此函数生成的所有Lua GC的总和                                                                              |\n| `self`                  | 函数本身产生的GC量                                                                                        |\n| `totalMonoMemory`       | 此函数生成的所有Mono GC的总和                                                                             |\n| `self`                  | 函数本身产生的GC量                                                                                        |\n| `currentTime`           | 函数在当前帧中运行所需的时间                                                                              |\n| `averageTime`           | 计算在函数上花费的时间的平均值                                                                            |\n| `totalTime`             | 此功能消耗的所有时间                                                                                      |\n| `LuaGC`                 | 由当前帧生成的Lua GC                                                                                      |\n| `MonoGC`                | 由当前帧生成的Mono GC                                                                                     |\n| `totalCalls`            | 游戏开始后此功能的运行次数                                                                                |\n| `Calls`                 | 函数当前帧的执行次数                                                                                      |\n\n### FAQ\n\n有的Unity版本不支持 `[RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]`这个属性的时候，你可以在lua虚拟机启动之前调用代码\n```\nMikuLuaProfiler.HookLuaSetup.OnStartGame();\n```\n\n打开DeepLua之后会有很多空异常报错\n> 有的项目组会使用debug.getupvalue去获取变量并进行修改，但是MikuLuaProfiler会在所有代码执行之前添加一个Upvalue函数进行BeginSample和EndSample。这个会导致原先的upvalue表混乱，解决办法就是遍历Upvalue表，然后根据upvalue的命名获取到相应的变量，如下代码：\n```\nfunction debug.getupvalue_byname(func, name)\n    local i = 1\n    while true do\n        local n, v = debug.getupvalue(func, i)\n        if not n then break end\n        if n == name then return v end\n        i = i + 1\n    end\nend\n\nfunction debug.setupvalue_byname(func, name, value)\n    local i = 1\n    while true do\n        local n, v = debug.getupvalue(func, i)\n        if not n then break end\n        if n == name then\n            debug.setupvalue(func, i, value)\n            break\n        end\n        i = i + 1\n    end\nend\n```\n\n真机数据只有resume或者协程数据\n> 不要用luac加密代码，请直接使用明码字符串\n\n\n运行了性能调试之后，用代码调用luaGC无效\n> 为了防止lua的GC导致内存统计出现负数，本项目直接用hook技术接管了lua的GC函数，让用户的自动促发无效，GC会根据内存是否增长到上次GC的1.2倍左右就触发，如果项目的Update GC优化的较好，内存曲线是基本一致的。\n\n\n关于XLua demo跑不起来的问题\n> 把Demo里面LuaBehaviour 中 internal static LuaEnv luaEnv = new LuaEnv()的赋值改到Awake里面\n\n关于自定义profiler点\n```\nlocal LuaProfiler = MikuLuaProfiler.LuaProfiler\nLuaProfiler.BeginSampleCustom(\"profiler name\")\n-- your code\nLuaProfiler.EndSampleCustom()\n```\n\n\nMarkStaticRecord、MarkLuaRecord、DiffRecord、ClearDiff有什么用\n>这一组功能是查泄漏使用的。举一个例子，你可以在打开UI前MarkStaticRecord，进行一次内存快照，然后打开UI后MarkLuaRecord，记录第二次快照，最后你在调用UI释放的函数这里DiffRecord。如果打开UI前不持有，而打开UI后\n与释放UI后都持有的对象为泄漏。\n函数API为：\n```\nfunction miku_do_record(val, prefix, key, record, history, null_list, staticRecord)\n\nfunction miku_diff(record, staticRecord)\n```\n\n运行起来后totalLuaMemory为负数\n>底层统计lua内存申请采用记录lua虚拟机总量来记录对应的GC，如果函数运行的中间发生了GC就会导致内存差值为负数，你可以把自动GC关闭掉后进行统计。\n\n如何对Lua函数进行各种数据排序\n>在搜索框中输入：[lua],然后点击右上角的merge按钮,最后点击各个数据标签进行排序\n![](doc~/sort.png)\n\n如何定位Lua函数内存暴涨的点\n>使用Record模式启动游戏，在想采样的地方点击StartRecord,截取完记录后，找一段明显内存上涨的地方，采样出来分析函数即可.（鼠标点击上去，然后按键盘的左右键）\n![](doc~/record.png)\n\nref的function代表什么\n>这里存储的一般都是C#这里持有的回调函数，你可以每一次打开UI前先clear数据，然后进入UI后记录数据，释放UI后如果 还持有不少委托，就代表说泄漏了。\n\n<span id=\"contact_zh\"></span>\n### [联系](#zh)\n如果您发现任何错误或有任何建议加入QQ群：[882425563](https://jq.qq.com/?_wv=1027&k=5QkOBSc) 与我们联系\n\n<span id=\"contact_zh\"></span>\n## 投食\n![](doc~/zfb.png)\n\n##\n![](doc~/meizi.gif)\n\n"
        },
        {
          "name": "README.md.meta",
          "type": "blob",
          "size": 0.154296875,
          "content": "fileFormatVersion: 2\nguid: 1c4a07c0f22cdd84e9607b2ff0fab661\nTextScriptImporter:\n  externalObjects: {}\n  userData: \n  assetBundleName: \n  assetBundleVariant: \n"
        },
        {
          "name": "doc~",
          "type": "tree",
          "content": null
        },
        {
          "name": "package.json",
          "type": "blob",
          "size": 0.2421875,
          "content": "{\n  \"name\": \"com.miku.luaprofiler\",\n  \"displayName\": \"Miku Luaprofiler\",\n  \"version\": \"1.0.0\",\n  \"unity\": \"2019.4\",\n  \"keywords\": [\n    \"luaprofiler\"\n  ],\n  \"description\": \"luaprofiler tool for unity\",\n  \"relatedPackages\": {},\n  \"repository\": {}\n}\n"
        },
        {
          "name": "package.json.meta",
          "type": "blob",
          "size": 0.154296875,
          "content": "fileFormatVersion: 2\nguid: f3b12d27e56675a40ac6315243a9e52b\nTextScriptImporter:\n  externalObjects: {}\n  userData: \n  assetBundleName: \n  assetBundleVariant: \n"
        }
      ]
    }
  ]
}